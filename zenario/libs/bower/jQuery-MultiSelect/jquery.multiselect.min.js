(function(b){function n(a,c){this.element=a;this.options=b.extend(!0,{},r,c);this.updatePlaceholder=this.updateSelectAll=!0;if(this.options.search&&!this.options.searchOptions.searchText&&!this.options.searchOptions.searchValue)throw Error("Either searchText or searchValue should be true.");"placeholder"in this.options&&(this.options.texts.placeholder=this.options.placeholder,delete this.options.placeholder);"default"in this.options.searchOptions&&(this.options.texts.search=this.options.searchOptions["default"],
delete this.options.searchOptions["default"]);this.load()}var r={columns:1,search:!1,searchOptions:{delay:250,showOptGroups:!1,searchText:!0,searchValue:!1,onSearch:function(a){}},texts:{placeholder:"Select options",search:"Search",selectedOptions:" selected",selectAll:"Select all",unselectAll:"Unselect all",noneSelected:"None Selected"},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,maxWidth:null,maxPlaceholderWidth:null,maxPlaceholderOpts:10,showCheckbox:!0,optionAttributes:[],onLoad:function(a){},
onOptionClick:function(a,b){},onControlClose:function(a){},minSelect:!1,maxSelect:!1},m=1;"function"!==typeof Array.prototype.map&&(Array.prototype.map=function(a,c){"undefined"===typeof c&&(c=this);return b.isArray(c)?b.map(c,a):[]});"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});n.prototype={load:function(){var a=this;if("SELECT"!=a.element.nodeName||b(a.element).hasClass("jqmsLoaded"))return!0;b(a.element).addClass("jqmsLoaded").data("plugin_multiselect-instance",
a);b(a.element).after('<div class="ms-options-wrap"><button><span>None Selected</span></button><div class="ms-options"><ul></ul></div></div>');var c=b(a.element).next(".ms-options-wrap").find("> button:first-child"),e=b(a.element).next(".ms-options-wrap").find("> .ms-options"),d=e.find("> ul");b(a.element).find("optgroup");a.options.showCheckbox||e.addClass("hide-checkbox");b(a.element).prop("disabled")&&c.prop("disabled",!0);a.options.maxPlaceholderWidth&&c.css("maxWidth",a.options.maxPlaceholderWidth);
var f=b(window).height()-e.offset().top+b(window).scrollTop()-20;a.options.maxHeight&&(f=a.options.maxHeight);f=f<a.options.minHeight?a.options.minHeight:f;e.css({maxWidth:a.options.maxWidth,minHeight:a.options.minHeight,maxHeight:f});e.bind("touchmove mousewheel DOMMouseScroll",function(a){if(b(this).outerHeight()<b(this)[0].scrollHeight){var c=a.originalEvent,c=c.wheelDelta||-c.detail;b(this).outerHeight()+b(this)[0].scrollTop>b(this)[0].scrollHeight&&(a.preventDefault(),this.scrollTop+=0>c?1:-1)}});
b(document).off("click.ms-hideopts").on("click.ms-hideopts",function(a){b(a.target).closest(".ms-options-wrap").length||b(".ms-options-wrap > .ms-options.ms-active").each(function(){b(this).removeClass("ms-active");var a=b(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)})});c.bind("mousedown",function(c){if(1!=c.which)return!0;b(".ms-options-wrap > .ms-options.ms-active").each(function(){if(b(this).parent().prev()[0]!=
e.parent().prev()[0]){b(this).removeClass("ms-active");var a=b(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)}});e.toggleClass("ms-active");if(e.hasClass("ms-active"))e.css("maxHeight",""),c=b(window).height()-e.offset().top+b(window).scrollTop()-20,a.options.maxHeight&&(c=a.options.maxHeight),c=c<a.options.minHeight?a.options.minHeight:c,e.css("maxHeight",c);else if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)}).click(function(a){a.preventDefault()});
a.options.texts.placeholder&&c.find("span").text(a.options.texts.placeholder);if(a.options.search){d.before('<div class="ms-search"><input type="text" value="" placeholder="'+a.options.texts.search+'" /></div>');var k=e.find(".ms-search input");k.on("keyup",function(){if(b(this).data("lastsearch")==b(this).val())return!0;b(this).data("searchTimeout")&&clearTimeout(b(this).data("searchTimeout"));var c=b(this);b(this).data("searchTimeout",setTimeout(function(){c.data("lastsearch",c.val());if("function"==
typeof a.options.searchOptions.onSearch)a.options.searchOptions.onSearch(a.element);var e=b.trim(k.val().toLowerCase());e?(d.find('li[data-search-term*="'+e+'"]:not(.optgroup)').removeClass("ms-hidden"),d.find('li:not([data-search-term*="'+e+'"], .optgroup)').addClass("ms-hidden")):d.find(".ms-hidden").removeClass("ms-hidden");a.options.searchOptions.showOptGroups||d.find(".optgroup").each(function(){b(this).find("li:not(.ms-hidden)").length?b(this).show():b(this).hide()});a._updateSelectAllText()},
a.options.searchOptions.delay))})}a.options.selectAll&&d.before('<a href="#" class="ms-selectall global">'+a.options.texts.selectAll+"</a>");e.on("click",".ms-selectall",function(c){c.preventDefault();a.updateSelectAll=!1;a.updatePlaceholder=!1;c=e.parent().prev();if(b(this).hasClass("global"))d.find("li:not(.optgroup, .selected, .ms-hidden)").length?(d.find("li:not(.optgroup, .selected, .ms-hidden)").addClass("selected"),d.find('li.selected input[type="checkbox"]').prop("checked",!0)):(d.find("li:not(.optgroup, .ms-hidden).selected").removeClass("selected"),
d.find('li:not(.optgroup, .ms-hidden, .selected) input[type="checkbox"]').prop("checked",!1));else if(b(this).closest("li").hasClass("optgroup")){var h=b(this).closest("li.optgroup");h.find("> .label").text();h.find("li:not(.selected, .ms-hidden)").length?(h.find("li:not(.selected, .ms-hidden)").addClass("selected"),h.find('li.selected input[type="checkbox"]').prop("checked",!0)):(h.find("li:not(.ms-hidden).selected").removeClass("selected"),h.find('li:not(.ms-hidden, .selected) input[type="checkbox"]').prop("checked",
!1))}var f=[];d.find('li.selected input[type="checkbox"]').each(function(){f.push(b(this).val())});c.val(f);a.updateSelectAll=!0;a.updatePlaceholder=!0;a._updateSelectAllText();a._updatePlaceholderText()});var p=[];b(a.element).children().each(function(){if("OPTGROUP"==this.nodeName){var c=[];b(this).children("option").each(function(){for(var e={},d=0;d<a.options.optionAttributes.length;d++){var f=a.options.optionAttributes[d];void 0!==b(this).attr(f)&&(e[f]=b(this).attr(f))}c.push({name:b(this).text(),
value:b(this).val(),checked:b(this).prop("selected"),attributes:e})});p.push({label:b(this).attr("label"),options:c})}else if("OPTION"==this.nodeName){for(var e={},d=0;d<a.options.optionAttributes.length;d++){var f=a.options.optionAttributes[d];void 0!==b(this).attr(f)&&(e[f]=b(this).attr(f))}p.push({name:b(this).text(),value:b(this).val(),checked:b(this).prop("selected"),attributes:e})}else return!0});a.loadOptions(p,!0,!1);a._updateSelectAllText(!1);e.on("click",'input[type="checkbox"]',function(){b(this).closest("li").toggleClass("selected");
e.parent().prev().find('option[value="'+b(this).val()+'"]').prop("selected",b(this).is(":checked")).closest("select").trigger("change");if("function"==typeof a.options.onOptionClick)a.options.onOptionClick(a.element,this);a._updateSelectAllText();a._updatePlaceholderText()});e.on("focusin",'input[type="checkbox"]',function(){b(this).closest("label").addClass("focused")}).on("focusout",'input[type="checkbox"]',function(){b(this).closest("label").removeClass("focused")});if("function"===typeof a.options.onLoad)a.options.onLoad(a.element);
b(a.element).hide()},loadOptions:function(a,c,e){c="boolean"==typeof c?c:!0;e="boolean"==typeof e?e:!0;var d=b(this.element).next(".ms-options-wrap").find("> .ms-options > ul"),f=b(this.element).next(".ms-options-wrap").find("> .ms-options"),k=f.parent().prev();c&&(d.find("> li").remove(),e&&k.find("> *").remove());for(var p in a)if(a.hasOwnProperty(p)){var g=a[p],h=b("<li/>"),m=!0;if(g.hasOwnProperty("options")){d.find("> li.optgroup > span.label").each(function(){b(this).text()==g.label&&(h=b(this).closest(".optgroup"),
m=!1)});if(e)if(k.find('optgroup[label="'+g.label+'"]').length)var n=k.find('optgroup[label="'+g.label+'"]');else n=b('<optgroup label="'+g.label+'"></optgroup>'),k.append(n);m&&(h.addClass("optgroup"),h.append('<span class="label">'+g.label+"</span>"),h.find("> .label").css({clear:"both"}),this.options.selectGroup&&h.append('<a href="#" class="ms-selectall">'+this.options.texts.selectAll+"</a>"),h.append("<ul/>"));for(var q in g.options)if(g.options.hasOwnProperty(q)){c=g.options[q];var l=b("<li/>").addClass("ms-reflow");
c.hasOwnProperty("value")&&(this._addOption(l,c),h.find("> ul").append(l),e&&(l=b('<option value="'+c.value+'">'+c.name+"</option>"),c.hasOwnProperty("attributes")&&Object.keys(c.attributes),c.checked&&l.prop("selected",!0),n.append(l)))}}else if(g.hasOwnProperty("value"))h.addClass("ms-reflow"),this._addOption(h,g),e&&(l=b('<option value="'+g.value+'">'+g.name+"</option>"),g.hasOwnProperty("attributes")&&Object.keys(g.attributes).length&&l.attr(g.attributes),g.checked&&l.prop("selected",!0),k.append(l));
else continue;m&&d.append(h)}a=d.find('.ms-reflow input[type="checkbox"]').eq(0);a.length&&a.css("display").match(/block$/)&&(e=(e=a.outerWidth())?e:15,d.find(".ms-reflow label").css("padding-left",2*parseInt(a.closest("label").css("padding-left"))+e),d.find(".ms-reflow").removeClass("ms-reflow"));this._updatePlaceholderText();f.find("ul").css({"column-count":"","column-gap":"","-webkit-column-count":"","-webkit-column-gap":"","-moz-column-count":"","-moz-column-gap":""});k.find("optgroup").length?
(d.find("> li:not(.optgroup)").css({"float":"left",width:100/this.options.columns+"%"}),d.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":this.options.columns,"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),this._ieVersion()&&10>this._ieVersion()&&d.find("li.optgroup > ul > li").css({"float":"left",width:100/this.options.columns+"%"})):(d.css({"column-count":this.options.columns,
"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),this._ieVersion()&&10>this._ieVersion()&&d.find("> li").css({"float":"left",width:100/this.options.columns+"%"}))},settings:function(a){this.options=b.extend(!0,{},this.options,a);this.reload()},unload:function(){b(this.element).next(".ms-options-wrap").remove();b(this.element).show(function(){b(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){b(this.element).next(".ms-options-wrap").remove();
b(this.element).removeClass("jqmsLoaded");this.load()},reset:function(){var a=[];b(this.element).find("option").each(function(){b(this).prop("defaultSelected")&&a.push(b(this).val())});b(this.element).val(a);this.reload()},disable:function(a){a="boolean"===typeof a?a:!0;b(this.element).prop("disabled",a);b(this.element).next(".ms-options-wrap").find("button:first-child").prop("disabled",a)},_updateSelectAllText:function(a){if(this.updateSelectAll){"boolean"!==typeof a&&(a=!0);var c=this;(c.options.selectAll||
c.options.selectGroup)&&b(c.element).next(".ms-options-wrap").find("> .ms-options").find(".ms-selectall").each(function(){var a=b(this).parent().find("li:not(.optgroup,.selected,.ms-hidden)");b(this).text(a.length?c.options.texts.selectAll:c.options.texts.unselectAll)})}},_updatePlaceholderText:function(){if(this.updatePlaceholder){var a=b(this.element).next(".ms-options-wrap").find("> button:first-child"),c=a.find("span"),e=b(this.element).next(".ms-options-wrap").find("> .ms-options").parent().prev(),
d=e.val()?e.val():[],f=[];for(key in d)if(f.push(b.trim(e.find('option[value="'+d[key]+'"]').text())),f.length>=this.options.maxPlaceholderOpts)break;c.text(f.join(", "));c.width()>a.width()||f.length!=d.length?c.text(e.val().length+this.options.texts.selectedOptions):f.length||c.text(this.options.texts.placeholder)}},_addOption:function(a,c){var e=b("<label/>",{"for":"ms-opt-"+m,text:c.name}),d=b("<input>",{type:"checkbox",title:c.name,id:"ms-opt-"+m,value:c.value});c.hasOwnProperty("attributes")&&
Object.keys(c.attributes).length&&d.attr(c.attributes);c.checked&&(a.addClass("default selected"),d.prop("checked",!0));e.prepend(d);d="";this.options.searchOptions.searchText&&(d+=" "+c.name.toLowerCase());this.options.searchOptions.searchValue&&(d+=" "+c.value.toLowerCase());a.attr("data-search-term",b.trim(d)).prepend(e);m+=1},_ieVersion:function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")?parseInt(a.split("msie")[1]):!1}};b.fn.multiselect=function(a){var c=arguments,
e;if(void 0===a||"object"===typeof a)return this.each(function(){b.data(this,"plugin_multiselect")||b.data(this,"plugin_multiselect",new n(this,a))});if("string"===typeof a&&"_"!==a[0]&&"init"!==a)return this.each(function(){var d=b.data(this,"plugin_multiselect");d instanceof n&&"function"===typeof d[a]&&(e=d[a].apply(d,Array.prototype.slice.call(c,1)));"unload"===a&&b.data(this,"plugin_multiselect",null)}),e}})(jQuery);
