(function(e){"function"===typeof define&&define.amd?define("jquery load-image load-image-meta load-image-scale load-image-exif load-image-orientation canvas-to-blob ./jquery.fileupload-process".split(" "),e):"object"===typeof exports?e(require("jquery"),require("blueimp-load-image/js/load-image"),require("blueimp-load-image/js/load-image-meta"),require("blueimp-load-image/js/load-image-scale"),require("blueimp-load-image/js/load-image-exif"),require("blueimp-load-image/js/load-image-orientation"),
require("blueimp-canvas-to-blob"),require("./jquery.fileupload-process")):e(window.jQuery,window.loadImage)})(function(e,h){e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",maxMetaDataSize:"@",disableImageHead:"@",disableMetaDataParsers:"@",disableExif:"@",disableExifOffsets:"@",includeExifTags:"@",excludeExifTags:"@",disableIptc:"@",disableIptcOffsets:"@",includeIptcTags:"@",excludeIptcTags:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,
fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize",imageSmoothingQuality:"@imageSmoothingQuality"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",
minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"});e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1E7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!0,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,
previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(a,b){if(b.disabled)return a;var g=this,c=a.files[a.index],f=e.Deferred();return"number"===e.type(b.maxFileSize)&&c.size>b.maxFileSize||b.fileTypes&&!b.fileTypes.test(c.type)||!h(c,function(d){d.src&&(a.img=d);f.resolveWith(g,[a])},b)?a:f.promise()},resizeImage:function(a,b){if(b.disabled||!a.canvas&&!a.img)return a;b=e.extend({canvas:!0},b);var g=this,c=e.Deferred(),f=
b.canvas&&a.canvas||a.img,d=function(k){k&&(k.width!==f.width||k.height!==f.height||b.forceResize)&&(a[k.getContext?"canvas":"img"]=k);a.preview=k;c.resolveWith(g,[a])},l;if(a.exif&&b.thumbnail&&(l=(l=a.exif.get("Thumbnail"))&&l.get("Blob")))return b.orientation=a.exif.get("Orientation"),h(l,d,b),c.promise();a.orientation?delete b.orientation:a.orientation=b.orientation||h.orientation;return f?(d(h.scale(f,b,a)),c.promise()):a},saveImage:function(a,b){if(!a.canvas||b.disabled)return a;var g=this,
c=a.files[a.index],f=e.Deferred();if(a.canvas.toBlob)a.canvas.toBlob(function(d){d.name||(c.type===d.type?d.name=c.name:c.name&&(d.name=c.name.replace(/\.\w+$/,"."+d.type.substr(6))));c.type!==d.type&&delete a.imageHead;a.files[a.index]=d;f.resolveWith(g,[a])},b.type||c.type,b.quality);else return a;return f.promise()},loadImageMetaData:function(a,b){if(b.disabled)return a;var g=this,c=e.Deferred();h.parseMetaData(a.files[a.index],function(f){e.extend(a,f);c.resolveWith(g,[a])},b);return c.promise()},
saveImageMetaData:function(a,b){if(!(a.imageHead&&a.canvas&&a.canvas.toBlob)||b.disabled)return a;var g=this,c=a.files[a.index],f=e.Deferred();!0===a.orientation&&a.exifOffsets&&h.writeExifData(a.imageHead,a,"Orientation",1);h.replaceHead(c,a.imageHead,function(d){d.name=c.name;a.files[a.index]=d;f.resolveWith(g,[a])});return f.promise()},setImage:function(a,b){a.preview&&!b.disabled&&(a.files[a.index][b.name||"preview"]=a.preview);return a},deleteImageReferences:function(a,b){b.disabled||(delete a.img,
delete a.canvas,delete a.preview,delete a.imageHead);return a}}})});
