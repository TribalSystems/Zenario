(function(){var p={},q=function(c){var a=p[c];if(void 0===a)throw"module ["+c+"] was undefined";if(void 0===a.instance){for(var g=p[c],b=g.deps,h=g.defn,d=b.length,e=Array(d),f=0;f<d;++f)e[f]=q(b[f]);b=h.apply(null,e);if(void 0===b)throw"module ["+c+"] returned undefined";g.instance=b}return a.instance},k=function(c,a,g){if("string"!==typeof c)throw"module id must be a string";if(void 0===a)throw"no dependencies for "+c;if(void 0===g)throw"no definition function for "+c;p[c]={deps:a,defn:g,instance:void 0}},
r=function(c,a){k(c,[],function(){return a})};k("ephox.katamari.api.Cell",[],function(){var c=function(a){var g=a;return{get:function(){return g},set:function(b){g=b},clone:function(){return c(g)}}};return c});r("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);k("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.PluginManager")});k("tinymce.plugins.textpattern.api.Api",[],function(){return{get:function(c){return{setPatterns:function(a){c.set(a)},
getPatterns:function(){return c.get()}}}}});k("tinymce.plugins.textpattern.api.Settings",[],function(){var c=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];
return{getPatterns:function(a){return void 0!==a.textpattern_patterns?a.textpattern_patterns:c}}});k("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.Delay")});k("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.VK")});r("global!document",document);k("tinymce.core.dom.TreeWalker",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.dom.TreeWalker")});k("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(c){return c("tinymce.util.Tools")});k("tinymce.plugins.textpattern.core.Patterns",[],function(){var c=function(a){return a.sort(function(a,b){return a.start.length>b.start.length?-1:a.start.length<b.start.length?1:0})};return{findPattern:function(a,c){for(var b=0;b<a.length;b++)if(0===c.indexOf(a[b].start)&&(!a[b].end||c.lastIndexOf(a[b].end)===c.length-a[b].end.length))return a[b]},findEndPattern:function(a,g,b,h){var d,e=c(a);for(d=0;d<e.length;d++){a=e[d];var f;if(f=void 0!==a.end)f=a,
f=g.substr(b-f.end.length-h,f.end.length)===f.end&&0<b-h-a.end.length-a.start.length;if(f)return a}}}});k("tinymce.plugins.textpattern.core.Formatter",["global!document","tinymce.core.dom.TreeWalker","tinymce.core.util.Tools","tinymce.plugins.textpattern.core.Patterns"],function(c,a,g,b){var h=function(b,a,c,d,e){b=0<d?b.splitText(d):b;b.splitText(c-d+a.end.length);b.deleteData(0,a.start.length);b.deleteData(b.data.length-a.end.length,a.end.length);return b},d=function(a,d,e){if(!1!==d.collapsed){var g=
d.startContainer,f=g.data,h=!0===e?1:0;if(3===g.nodeType&&(e=b.findEndPattern(a,f,d.startOffset,h),void 0!==e&&(d=f.lastIndexOf(e.end,d.startOffset-h),h=f.lastIndexOf(e.start,d-e.end.length),d=f.indexOf(e.end,h+e.start.length),-1!==h&&(f=c.createRange(),f.setStart(g,h),f.setEnd(g,d+e.end.length),a=b.findPattern(a,f.toString()),!(void 0===e||a!==e||g.data.length<=e.start.length+e.end.length)))))return{pattern:e,startOffset:h,endOffset:d}}},e=function(b,a,d,e){var c=g.isArray(d.pattern.format)?d.pattern.format:
[d.pattern.format];if(0!==g.grep(c,function(a){return(a=b.formatter.get(a))&&a[0].inline}).length)return b.undoManager.transact(function(){a=h(a,d.pattern,d.endOffset,d.startOffset,e);c.forEach(function(d){b.formatter.apply(d,{},a)})}),a},f=function(a,b,c){var f=a.selection.getRng(!0);if(b=d(b,f,c))return e(a,f.startContainer,b,c)};return{patternFromRng:d,applyInlineFormatSpace:function(b,a){return f(b,a,!0)},applyInlineFormatEnter:function(b,a){return f(b,a,!1)},applyBlockFormat:function(d,e){var c,
f,h,k,l,m,n;c=d.selection;f=d.dom;if(c.isCollapsed()&&(f=f.getParent(c.getStart(),"p"))){for(k=new a(f,f);f=k.next();)if(3===f.nodeType){h=f;break}h&&(l=b.findPattern(e,h.data))&&(m=c.getRng(!0),f=m.startContainer,n=m.startOffset,h===f&&(n=Math.max(0,n-l.start.length)),g.trim(h.data).length!==l.start.length&&(l.format&&(k=d.formatter.get(l.format))&&k[0].block&&(h.deleteData(0,l.start.length),d.formatter.apply(l.format,{},h),m.setStart(f,n),m.collapse(!0),c.setRng(m)),l.cmd&&d.undoManager.transact(function(){h.deleteData(0,
l.start.length);d.execCommand(l.cmd)})))}}}});k("tinymce.plugins.textpattern.core.KeyHandler",["tinymce.core.util.VK","tinymce.plugins.textpattern.core.Formatter"],function(c,a){var g=function(b,a,d){for(var c=0;c<b.length;c++)if(d(b[c],a))return!0};return{handleEnter:function(b,c){var d,e;if(d=a.applyInlineFormatEnter(b,c))e=b.dom.createRng(),e.setStart(d,d.data.length),e.setEnd(d,d.data.length),b.selection.setRng(e);a.applyBlockFormat(b,c)},handleInlineKey:function(b,c){var d,e,f;if(d=a.applyInlineFormatSpace(b,
c))f=b.dom,e=d.data.slice(-1),/[\u00a0 ]/.test(e)&&(d.deleteData(d.data.length-1,1),e=f.doc.createTextNode(e),f.insertAfter(e,d.parentNode),d=f.createRng(),d.setStart(e,1),d.setEnd(e,1),b.selection.setRng(d))},checkCharCode:function(a,c){return g(a,c,function(a,b){return a.charCodeAt(0)===b.charCode})},checkKeyCode:function(a,h){return g(a,h,function(a,b){return a===b.keyCode&&!1===c.modifierPressed(b)})}}});k("tinymce.plugins.textpattern.core.Keyboard",["tinymce.core.util.Delay","tinymce.core.util.VK",
"tinymce.plugins.textpattern.core.KeyHandler"],function(c,a,g){return{setup:function(b,h){var d=",.;:!?".split(""),e=[32];b.on("keydown",function(c){13!==c.keyCode||a.modifierPressed(c)||g.handleEnter(b,h.get())},!0);b.on("keyup",function(a){g.checkKeyCode(e,a)&&g.handleInlineKey(b,h.get())});b.on("keypress",function(a){g.checkCharCode(d,a)&&c.setEditorTimeout(b,function(){g.handleInlineKey(b,h.get())})})}}});k("tinymce.plugins.textpattern.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager",
"tinymce.plugins.textpattern.api.Api","tinymce.plugins.textpattern.api.Settings","tinymce.plugins.textpattern.core.Keyboard"],function(c,a,g,b,h){a.add("textpattern",function(a){var e=c(b.getPatterns(a.settings));h.setup(a,e);return g.get(e)});return function(){}});q("tinymce.plugins.textpattern.Plugin")()})();
