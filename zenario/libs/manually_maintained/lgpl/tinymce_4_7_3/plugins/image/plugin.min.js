'use strict';(function(){var D={},w=function(c,h,q){if("string"!==typeof c)throw"module id must be a string";if(void 0===h)throw"no dependencies for "+c;if(void 0===q)throw"no definition function for "+c;D[c]={deps:h,defn:q,instance:void 0}},E=function(c){var h=D[c];if(void 0===h)throw"module ["+c+"] was undefined";if(void 0===h.instance){for(var q=D[c],g=q.deps,d=q.defn,l=g.length,f=Array(l),k=0;k<l;++k)f[k]=E(g[k]);g=d.apply(null,f);if(void 0===g)throw"module ["+c+"] returned undefined";q.instance=
g}return h.instance},A=function(c,h){w(c,[],function(){return h})};A("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);w("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.PluginManager")});A("global!Math",Math);A("global!RegExp",RegExp);w("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.Tools")});w("tinymce.plugins.image.api.Settings",[],function(){return{hasDimensions:function(c){return!1===
c.settings.image_dimensions?!1:!0},hasAdvTab:function(c){return!0===c.settings.image_advtab?!0:!1},getPrependUrl:function(c){return c.getParam("image_prepend_url","")},getClassList:function(c){return c.getParam("image_class_list")},hasDescription:function(c){return!1===c.settings.image_description?!1:!0},hasImageTitle:function(c){return!0===c.settings.image_title?!0:!1},hasImageCaption:function(c){return!0===c.settings.image_caption?!0:!1},getImageList:function(c){return c.getParam("image_list",!1)},
hasUploadUrl:function(c){return c.getParam("images_upload_url",!1)},hasUploadHandler:function(c){return c.getParam("images_upload_handler",!1)},getUploadUrl:function(c){return c.getParam("images_upload_url")},getUploadHandler:function(c){return c.getParam("images_upload_handler")},getUploadBasePath:function(c){return c.getParam("images_upload_base_path")},getUploadCredentials:function(c){return c.getParam("images_upload_credentials")}}});A("global!document",document);w("ephox.katamari.api.Global",
[],function(){return"undefined"!==typeof window?window:Function("return this;")()});w("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(c){var h=function(g,d){d=void 0!==d?d:c;for(var l=0;l<g.length&&void 0!==d&&null!==d;++l)d=d[g[l]];return d},q=function(g,d){var l=void 0!==d?d:c;for(d=0;d<g.length;++d){var f=g[d];if(void 0===l[f]||null===l[f])l[f]={};l=l[f]}return l};return{path:h,resolve:function(g,d){g=g.split(".");return h(g,d)},forge:q,namespace:function(g,d){g=g.split(".");
return q(g,d)}}});w("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(c){return{getOrDie:function(h,q){q=c.resolve(h,q);if(void 0===q)throw h+" not available on this browser";return q}}});w("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(c){return function(){return new (c.getOrDie("FileReader"))}});w("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.Promise")});w("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],
function(c){return c("tinymce.util.XHR")});w("tinymce.plugins.image.core.Utils","global!Math global!document ephox.sand.api.FileReader tinymce.core.util.Promise tinymce.core.util.Tools tinymce.core.util.XHR tinymce.plugins.image.api.Settings".split(" "),function(c,h,q,g,d,l,f){var k=function(b,a){return c.max(parseInt(b,10),parseInt(a,10))};return{getImageSize:function(b,a){function n(r,e){p.parentNode&&p.parentNode.removeChild(p);a({width:r,height:e})}var p=h.createElement("img");p.onload=function(){var r=
k(p.width,p.clientWidth),e=k(p.height,p.clientHeight);n(r,e)};p.onerror=function(){n()};var t=p.style;t.visibility="hidden";t.position="fixed";t.bottom=t.left=0;t.width=t.height="auto";h.body.appendChild(p);p.src=b},buildListItems:function(b,a,n){function p(t,r){r=r||[];d.each(t,function(e){var v={text:e.text||e.title};e.menu?v.menu=p(e.menu):(v.value=e.value,a(v));r.push(v)});return r}return p(b,n||[])},removePixelSuffix:function(b){b&&(b=b.replace(/px$/,""));return b},addPixelSuffix:function(b){0<
b.length&&/^[0-9]+$/.test(b)&&(b+="px");return b},mergeMargins:function(b){if(b.margin){var a=b.margin.split(" ");switch(a.length){case 1:b["margin-top"]=b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[0];b["margin-bottom"]=b["margin-bottom"]||a[0];b["margin-left"]=b["margin-left"]||a[0];break;case 2:b["margin-top"]=b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[1];b["margin-bottom"]=b["margin-bottom"]||a[0];b["margin-left"]=b["margin-left"]||a[1];break;case 3:b["margin-top"]=
b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[1];b["margin-bottom"]=b["margin-bottom"]||a[2];b["margin-left"]=b["margin-left"]||a[1];break;case 4:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[3]}delete b.margin}return b},createImageList:function(b,a){b=f.getImageList(b);"string"===typeof b?l.send({url:b,success:function(n){a(JSON.parse(n))}}):"function"===typeof b?b(a):
a(b)},waitLoadImage:function(b,a,n){function p(){n.onload=n.onerror=null;b.selection&&(b.selection.select(n),b.nodeChanged())}n.onload=function(){a.width||a.height||!f.hasDimensions(b)||b.dom.setAttribs(n,{width:n.clientWidth,height:n.clientHeight});p()};n.onerror=p},blobToDataUri:function(b){return new g(function(a,n){var p=new q;p.onload=function(){a(p.result)};p.onerror=function(){n(q.error.message)};p.readAsDataURL(b)})}}});w("tinymce.plugins.image.ui.AdvTab",["tinymce.plugins.image.api.Settings",
"tinymce.plugins.image.core.Utils"],function(c,h){var q=function(g){return function(d){var l=g.dom;d=d.control.rootControl;if(c.hasAdvTab(g)){var f=d.toJSON();f=l.parseStyle(f.style);d.find("#vspace").value("");d.find("#hspace").value("");f=h.mergeMargins(f);if(f["margin-top"]&&f["margin-bottom"]||f["margin-right"]&&f["margin-left"])f["margin-top"]===f["margin-bottom"]?d.find("#vspace").value(h.removePixelSuffix(f["margin-top"])):d.find("#vspace").value(""),f["margin-right"]===f["margin-left"]?d.find("#hspace").value(h.removePixelSuffix(f["margin-right"])):
d.find("#hspace").value("");f["border-width"]&&d.find("#border").value(h.removePixelSuffix(f["border-width"]));d.find("#style").value(l.serializeStyle(l.parseStyle(l.serializeStyle(f))))}}};return{makeTab:function(g,d){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:q(g)},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:function(l){d(g,l.control.rootControl)}},
items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}}}});w("tinymce.plugins.image.ui.SizeManager",[],function(){var c=function(d,l){d.state.set("oldVal",d.value());l.state.set("oldVal",l.value())},h=function(d,l){var f=d.find("#width")[0],k=d.find("#height")[0];d=d.find("#constrain")[0];f&&k&&d&&l(f,k,d.checked())},q=function(d,l,f){var k=d.state.get("oldVal"),b=l.state.get("oldVal"),a=d.value(),n=l.value();f&&k&&b&&a&&n&&(a!==k?
(n=Math.round(a/k*n),isNaN(n)||l.value(n)):(a=Math.round(n/b*a),isNaN(a)||d.value(a)));c(d,l)},g=function(d){h(d,q)};return{createUi:function(){var d=function(l){g(l.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:d,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:d,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,
text:"Constrain proportions"}]}},syncSize:function(d){h(d,c)},updateSize:g}});w("tinymce.plugins.image.ui.MainTab",["tinymce.core.util.Tools","tinymce.plugins.image.api.Settings","tinymce.plugins.image.core.Utils","tinymce.plugins.image.ui.SizeManager"],function(c,h,q,g){var d=function(k,b){var a;var n=k.meta||{};k=k.control;var p=k.rootControl;(a=p.find("#image-list")[0])&&a.value(b.convertURL(k.value(),"src"));c.each(n,function(r,e){p.find("#"+e).value(r)});if(!n.width&&!n.height){n=b.convertURL(k.value(),
"src");a=h.getPrependUrl(b);var t=/^(?:[a-z]+:)?\/\//i;a&&!t.test(n)&&n.substring(0,a.length)!==a&&(n=a+n);k.value(n);q.getImageSize(b.documentBaseURI.toAbsolute(k.value()),function(r){r.width&&r.height&&h.hasDimensions(b)&&(p.find("#width").value(r.width),p.find("#height").value(r.height),g.updateSize(p))})}},l=function(k){k.meta=k.control.rootControl.toJSON()},f=function(k,b){b=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(a){d(a,k)},onbeforecall:l},
b];h.hasDescription(k)&&b.push({name:"alt",type:"textbox",label:"Image alt tag",classes:"image_alt"});h.hasImageTitle(k)&&b.push({name:"title",type:"textbox",label:"Image Title"});h.hasDimensions(k)&&b.push(g.createUi());!1!==k.settings.image_class&&(k.settings.image_class_list?h.getClassList(k)&&b.push({name:"class",type:"listbox",label:"Class",values:q.buildListItems(h.getClassList(k),function(a){a.value&&(a.textStyle=function(){return k.formatter.getCssText({inline:"img",classes:[a.value]})})})}):
b.push({name:"class",type:"textbox",size:40,label:"CSS class name(s)"}));!1!==k.settings.image_alignment&&b.push({type:"listbox",name:"align",label:"Alignment",values:[{text:"-- Not Set --",value:""},{text:"Left",value:"left"},{text:"Right",value:"right"},{text:"Middle",value:"middle"},{text:"Top",value:"top"},{text:"Bottom",value:"bottom"}]});h.hasImageCaption(k)&&b.push({name:"caption",type:"checkbox",label:"Caption"});return b};return{makeTab:function(k,b){return{title:"General",type:"form",items:f(k,
b)}},getGeneralItems:f}});w("ephox.sand.api.URL",["ephox.sand.util.Global"],function(c){return{createObjectURL:function(h){return c.getOrDie("URL").createObjectURL(h)},revokeObjectURL:function(h){c.getOrDie("URL").revokeObjectURL(h)}}});w("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.ui.Factory")});w("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(c){return function(){return new (c.getOrDie("XMLHttpRequest"))}});A("global!window",
window);w("tinymce.plugins.image.core.Uploader",["ephox.sand.api.XMLHttpRequest","global!document","global!window","tinymce.core.util.Promise","tinymce.core.util.Tools"],function(c,h,q,g,d){var l=function(){};return function(f){var k=function(a,n,p,t){var r=new c;r.open("POST",f.url);r.withCredentials=f.credentials;r.upload.onprogress=function(v){t(v.loaded/v.total*100)};r.onerror=function(){p("Image upload failed due to a XHR Transport error. Code: "+r.status)};r.onload=function(){var v;if(200>r.status||
300<=r.status)p("HTTP Error: "+r.status);else if((v=JSON.parse(r.responseText))&&"string"===typeof v.location){var u=f.basePath;v=v.location;u=u?u.replace(/\/$/,"")+"/"+v.replace(/^\//,""):v;n(u)}else p("Invalid JSON: "+r.responseText)};var e=new q.FormData;e.append("file",a.blob(),a.filename());r.send(e)},b=function(a,n){return new g(function(p,t){try{n(a,p,t,l)}catch(r){t(r.message)}})};f=d.extend({credentials:!1,handler:k},f);return{upload:function(a){return f.url||f.handler!==k?b(a,f.handler):
g.reject("Upload url missing from the settings.")}}}});w("tinymce.plugins.image.ui.UploadTab",["ephox.sand.api.URL","tinymce.core.ui.Factory","tinymce.plugins.image.api.Settings","tinymce.plugins.image.core.Utils","tinymce.plugins.image.core.Uploader"],function(c,h,q,g,d){var l=function(f){return function(k){var b=h.get("Throbber"),a=k.control.rootControl,n=new b(a.getEl()),p=k.control.value(),t=c.createObjectURL(p),r=new d({url:q.getUploadUrl(f),basePath:q.getUploadBasePath(f),credentials:q.getUploadCredentials(f),
handler:q.getUploadHandler(f)});n.show();return g.blobToDataUri(p).then(function(e){e=f.editorUpload.blobCache.create({blob:p,blobUri:t,name:p.name?p.name.replace(/\.[^\.]+$/,""):null,base64:e.split(",")[1]});return r.upload(e).then(function(v){var u=a.find("#src");u.value(v);a.find("tabpanel")[0].activateTab(0);u.fire("change");n.hide();c.revokeObjectURL(t);return v})})["catch"](function(e){f.windowManager.alert(e);n.hide();c.revokeObjectURL(t)})}};return{makeTab:function(f){return{title:"Upload",
type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",onchange:l(f)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:l(f)}]}}}});w("tinymce.plugins.image.ui.Dialog","global!Math global!RegExp tinymce.core.util.Tools tinymce.plugins.image.api.Settings tinymce.plugins.image.core.Utils tinymce.plugins.image.ui.AdvTab tinymce.plugins.image.ui.MainTab tinymce.plugins.image.ui.SizeManager tinymce.plugins.image.ui.UploadTab".split(" "),
function(c,h,q,g,d,l,f,k,b){return function(a){function n(t){function r(){var x,y;k.updateSize(z);p(a,z);e=q.extend(e,z.toJSON());e.alt||(e.alt="");e.title||(e.title="");""===e.width&&(e.width=null);""===e.height&&(e.height=null);e.style||(e.style=null);""===e.align&&(e.align=null);e={src:e.src,alt:e.alt,align:e.align,title:e.title,width:e.width,height:e.height,style:e.style,caption:e.caption,"class":e["class"]};a.undoManager.transact(function(){if(e.src)if(""===e.title&&(e.title=null),m?u.setAttribs(m,
e):(e.id="__mcenew",a.focus(),a.selection.setContent(u.createHTML("img",e)),m=u.get("__mcenew"),u.setAttrib(m,"id",null)),a.editorUpload.uploadImagesAuto(),!1===e.caption&&u.is(m.parentNode,"figure.image")&&(x=m.parentNode,u.insertAfter(m,x),u.remove(x)),!0===e.caption){if(!u.is(m.parentNode,"figure.image")){y=m;m=m.cloneNode(!0);x=u.create("figure",{"class":"image"});x.appendChild(m);x.appendChild(u.create("figcaption",{contentEditable:!0},"Caption"));x.contentEditable=!1;var B=u.getParent(y,function(F){return a.schema.getTextBlockElements()[F.nodeName]});
B?u.split(B,y,x):u.replace(x,y);a.selection.select(x)}}else d.waitLoadImage(a,e,m);else m&&(B=u.is(m.parentNode,"figure.image")?m.parentNode:m,u.remove(B),a.focus(),a.nodeChanged(),u.isEmpty(a.getBody())&&(a.setContent(""),a.selection.setCursorLocation()))})}var e={},v,u=a.dom,C;var m=a.selection.getNode();(v=u.getParent(m,"figure.image"))&&(m=u.select("img",v)[0]);m&&("IMG"!==m.nodeName||m.getAttribute("data-mce-object")||m.getAttribute("data-mce-placeholder"))&&(m=null);m&&(e={src:u.getAttrib(m,
"src"),alt:u.getAttrib(m,"alt"),align:u.getAttrib(m,"align"),title:u.getAttrib(m,"title"),"class":u.getAttrib(m,"class"),width:u.getAttrib(m,"width"),height:u.getAttrib(m,"height"),caption:!!v});t&&(C={type:"listbox",label:"Image list",name:"image-list",values:d.buildListItems(t,function(x){x.value=a.convertURL(x.value||x.url,"src")},[{text:"None",value:""}]),value:e.src&&a.convertURL(e.src,"src"),onselect:function(x){var y=z.find("#alt");(!y.value()||x.lastControl&&y.value()===x.lastControl.text())&&
y.value(x.control.text());z.find("#src").value(x.control.value()).fire("change")},onPostRender:function(){C=this}});if(g.hasAdvTab(a)||g.hasUploadUrl(a)||g.hasUploadHandler(a)){t=[f.makeTab(a,C)];g.hasAdvTab(a)&&(m&&(m.style.marginLeft&&m.style.marginRight&&m.style.marginLeft===m.style.marginRight&&(e.hspace=d.removePixelSuffix(m.style.marginLeft)),m.style.marginTop&&m.style.marginBottom&&m.style.marginTop===m.style.marginBottom&&(e.vspace=d.removePixelSuffix(m.style.marginTop)),m.style.borderWidth&&
(e.border=d.removePixelSuffix(m.style.borderWidth)),e.style=a.dom.serializeStyle(a.dom.parseStyle(a.dom.getAttrib(m,"style")))),t.push(l.makeTab(a,p)));(g.hasUploadUrl(a)||g.hasUploadHandler(a))&&t.push(b.makeTab(a));var z=a.windowManager.open({title:"Insert/edit image",data:e,bodyType:"tabpanel",body:t,onSubmit:r})}else z=a.windowManager.open({title:"Insert/edit image",data:e,body:f.getGeneralItems(a,C),onSubmit:r});k.syncSize(z)}var p=function(t,r){if(g.hasAdvTab(t)){t=t.dom;var e=r.toJSON(),v=
t.parseStyle(e.style);v=d.mergeMargins(v);e.vspace&&(v["margin-top"]=v["margin-bottom"]=d.addPixelSuffix(e.vspace));e.hspace&&(v["margin-left"]=v["margin-right"]=d.addPixelSuffix(e.hspace));e.border&&(v["border-width"]=d.addPixelSuffix(e.border));r.find("#style").value(t.serializeStyle(t.parseStyle(t.serializeStyle(v))))}};return{open:function(){d.createImageList(a,n)}}}});w("tinymce.plugins.image.api.Commands",["tinymce.plugins.image.ui.Dialog"],function(c){return{register:function(h){h.addCommand("mceImage",
c(h).open)}}});w("tinymce.plugins.image.core.FilterContent",["tinymce.core.util.Tools"],function(c){var h=function(g){return(g=g.attr("class"))&&/\bimage\b/.test(g)},q=function(g){return function(d){for(var l=d.length,f,k=function(b){b.attr("contenteditable",g?"true":null)};l--;)f=d[l],h(f)&&(f.attr("contenteditable",g?"false":null),c.each(f.getAll("figcaption"),k))}};return{setup:function(g){g.on("preInit",function(){g.parser.addNodeFilter("figure",q(!0));g.serializer.addNodeFilter("figure",q(!1))})}}});
w("tinymce.plugins.image.ui.Buttons",["tinymce.plugins.image.ui.Dialog"],function(c){return{register:function(h){h.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:c(h).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"});h.addMenuItem("image",{icon:"image",text:"Image",onclick:c(h).open,context:"insert",prependToContext:!0})}}});w("tinymce.plugins.image.Plugin",["tinymce.core.PluginManager","tinymce.plugins.image.api.Commands","tinymce.plugins.image.core.FilterContent",
"tinymce.plugins.image.ui.Buttons"],function(c,h,q,g){c.add("image",function(d){q.setup(d);g.register(d);h.register(d)});return function(){}});E("tinymce.plugins.image.Plugin")()})();
