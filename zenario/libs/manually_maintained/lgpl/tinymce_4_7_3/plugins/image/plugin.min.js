(function(){var w={},x=function(a){var d=w[a];if(void 0===d)throw"module ["+a+"] was undefined";if(void 0===d.instance){for(var l=w[a],g=l.deps,e=l.defn,h=g.length,c=Array(h),b=0;b<h;++b)c[b]=x(g[b]);g=e.apply(null,c);if(void 0===g)throw"module ["+a+"] returned undefined";l.instance=g}return d.instance},n=function(a,d,l){if("string"!==typeof a)throw"module id must be a string";if(void 0===d)throw"no dependencies for "+a;if(void 0===l)throw"no definition function for "+a;w[a]={deps:d,defn:l,instance:void 0}},
s=function(a,d){n(a,[],function(){return d})};s("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);n("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});s("global!Math",Math);s("global!RegExp",RegExp);n("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Tools")});n("tinymce.plugins.image.api.Settings",[],function(){return{hasDimensions:function(a){return!1===a.settings.image_dimensions?
!1:!0},hasAdvTab:function(a){return!0===a.settings.image_advtab?!0:!1},getPrependUrl:function(a){return a.getParam("image_prepend_url","")},getClassList:function(a){return a.getParam("image_class_list")},hasDescription:function(a){return!1===a.settings.image_description?!1:!0},hasImageTitle:function(a){return!0===a.settings.image_title?!0:!1},hasImageCaption:function(a){return!0===a.settings.image_caption?!0:!1},getImageList:function(a){return a.getParam("image_list",!1)},hasUploadUrl:function(a){return a.getParam("images_upload_url",
!1)},hasUploadHandler:function(a){return a.getParam("images_upload_handler",!1)},getUploadUrl:function(a){return a.getParam("images_upload_url")},getUploadHandler:function(a){return a.getParam("images_upload_handler")},getUploadBasePath:function(a){return a.getParam("images_upload_base_path")},getUploadCredentials:function(a){return a.getParam("images_upload_credentials")}}});s("global!document",document);n("ephox.katamari.api.Global",[],function(){return"undefined"!==typeof window?window:Function("return this;")()});
n("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(a){var d=function(g,e){for(var d=void 0!==e?e:a,c=0;c<g.length&&void 0!==d&&null!==d;++c)d=d[g[c]];return d},l=function(d,e){for(var h=void 0!==e?e:a,c=0;c<d.length;++c){var b=d[c];if(void 0===h[b]||null===h[b])h[b]={};h=h[b]}return h};return{path:d,resolve:function(a,e){var h=a.split(".");return d(h,e)},forge:l,namespace:function(a,e){var d=a.split(".");return l(d,e)}}});n("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],
function(a){return{getOrDie:function(d,l){var g=a.resolve(d,l);if(void 0===g)throw d+" not available on this browser";return g}}});n("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("FileReader"))}});n("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Promise")});n("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.XHR")});n("tinymce.plugins.image.core.Utils",
"global!Math global!document ephox.sand.api.FileReader tinymce.core.util.Promise tinymce.core.util.Tools tinymce.core.util.XHR tinymce.plugins.image.api.Settings".split(" "),function(a,d,l,g,e,h,c){return{getImageSize:function(b,e){function f(b,f){c.parentNode&&c.parentNode.removeChild(c);e({width:b,height:f})}var c=d.createElement("img");c.onload=function(){var b=a.max(parseInt(c.width,10),parseInt(c.clientWidth,10)),e=a.max(parseInt(c.height,10),parseInt(c.clientHeight,10));f(b,e)};c.onerror=function(){f()};
var g=c.style;g.visibility="hidden";g.position="fixed";g.bottom=g.left=0;g.width=g.height="auto";d.body.appendChild(c);c.src=b},buildListItems:function(b,a,f){function c(b,f){f=f||[];e.each(b,function(b){var e={text:b.text||b.title};b.menu?e.menu=c(b.menu):(e.value=b.value,a(e));f.push(e)});return f}return c(b,f||[])},removePixelSuffix:function(b){b&&(b=b.replace(/px$/,""));return b},addPixelSuffix:function(b){0<b.length&&/^[0-9]+$/.test(b)&&(b+="px");return b},mergeMargins:function(b){if(b.margin){var a=
b.margin.split(" ");switch(a.length){case 1:b["margin-top"]=b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[0];b["margin-bottom"]=b["margin-bottom"]||a[0];b["margin-left"]=b["margin-left"]||a[0];break;case 2:b["margin-top"]=b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[1];b["margin-bottom"]=b["margin-bottom"]||a[0];b["margin-left"]=b["margin-left"]||a[1];break;case 3:b["margin-top"]=b["margin-top"]||a[0];b["margin-right"]=b["margin-right"]||a[1];b["margin-bottom"]=b["margin-bottom"]||
a[2];b["margin-left"]=b["margin-left"]||a[1];break;case 4:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[3]}delete b.margin}return b},createImageList:function(b,a){var f=c.getImageList(b);"string"===typeof f?h.send({url:f,success:function(b){a(JSON.parse(b))}}):"function"===typeof f?f(a):a(f)},waitLoadImage:function(b,a,f){function e(){f.onload=f.onerror=null;b.selection&&(b.selection.select(f),
b.nodeChanged())}f.onload=function(){a.width||a.height||!c.hasDimensions(b)||b.dom.setAttribs(f,{width:f.clientWidth,height:f.clientHeight});e()};f.onerror=e},blobToDataUri:function(b){return new g(function(a,f){var e=new l;e.onload=function(){a(e.result)};e.onerror=function(){f(l.error.message)};e.readAsDataURL(b)})}}});n("tinymce.plugins.image.ui.AdvTab",["tinymce.plugins.image.api.Settings","tinymce.plugins.image.core.Utils"],function(a,d){var l=function(g){return function(e){var h=g.dom;e=e.control.rootControl;
if(a.hasAdvTab(g)){var c=e.toJSON(),c=h.parseStyle(c.style);e.find("#vspace").value("");e.find("#hspace").value("");c=d.mergeMargins(c);if(c["margin-top"]&&c["margin-bottom"]||c["margin-right"]&&c["margin-left"])c["margin-top"]===c["margin-bottom"]?e.find("#vspace").value(d.removePixelSuffix(c["margin-top"])):e.find("#vspace").value(""),c["margin-right"]===c["margin-left"]?e.find("#hspace").value(d.removePixelSuffix(c["margin-right"])):e.find("#hspace").value("");c["border-width"]&&e.find("#border").value(d.removePixelSuffix(c["border-width"]));
e.find("#style").value(h.serializeStyle(h.parseStyle(h.serializeStyle(c))))}}};return{makeTab:function(a,e){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:l(a)},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:function(d){e(a,d.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}}}});
n("tinymce.plugins.image.ui.SizeManager",[],function(){var a=function(a,d){a.state.set("oldVal",a.value());d.state.set("oldVal",d.value())},d=function(a,d){var c=a.find("#width")[0],b=a.find("#height")[0],g=a.find("#constrain")[0];c&&b&&g&&d(c,b,g.checked())},l=function(e,d,c){var b=e.state.get("oldVal"),g=d.state.get("oldVal"),f=e.value(),l=d.value();c&&b&&g&&f&&l&&(f!==b?(l=Math.round(f/b*l),isNaN(l)||d.value(l)):(f=Math.round(l/g*f),isNaN(f)||e.value(f)));a(e,d)},g=function(a){d(a,l)};return{createUi:function(){var a=
function(a){g(a.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},syncSize:function(e){d(e,a)},updateSize:g}});n("tinymce.plugins.image.ui.MainTab",["tinymce.core.util.Tools","tinymce.plugins.image.api.Settings",
"tinymce.plugins.image.core.Utils","tinymce.plugins.image.ui.SizeManager"],function(a,d,l,g){var e=function(b,c){var f,e,h;f=b.meta||{};var n=b.control,r=n.rootControl;(e=r.find("#image-list")[0])&&e.value(c.convertURL(n.value(),"src"));a.each(f,function(a,b){r.find("#"+b).value(a)});f.width||f.height||(f=c.convertURL(n.value(),"src"),e=d.getPrependUrl(c),h=/^(?:[a-z]+:)?\/\//i,e&&!h.test(f)&&f.substring(0,e.length)!==e&&(f=e+f),n.value(f),l.getImageSize(c.documentBaseURI.toAbsolute(n.value()),function(a){a.width&&
a.height&&d.hasDimensions(c)&&(r.find("#width").value(a.width),r.find("#height").value(a.height),g.updateSize(r))}))},h=function(a){a.meta=a.control.rootControl.toJSON()},c=function(a,c){var f=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(f){e(f,a)},onbeforecall:h},c];d.hasDescription(a)&&f.push({name:"alt",type:"textbox",label:"Image alt tag",classes:"image_alt"});d.hasImageTitle(a)&&f.push({name:"title",type:"textbox",label:"Image Title"});d.hasDimensions(a)&&
f.push(g.createUi());!1!==a.settings.image_class&&(a.settings.image_class_list?d.getClassList(a)&&f.push({name:"class",type:"listbox",label:"Class",values:l.buildListItems(d.getClassList(a),function(f){f.value&&(f.textStyle=function(){return a.formatter.getCssText({inline:"img",classes:[f.value]})})})}):f.push({name:"class",type:"textbox",size:40,label:"CSS class name(s)"}));!1!==a.settings.image_alignment&&f.push({type:"listbox",name:"align",label:"Alignment",values:[{text:"-- Not Set --",value:""},
{text:"Left",value:"left"},{text:"Right",value:"right"},{text:"Middle",value:"middle"},{text:"Top",value:"top"},{text:"Bottom",value:"bottom"}]});d.hasImageCaption(a)&&f.push({name:"caption",type:"checkbox",label:"Caption"});return f};return{makeTab:function(a,e){return{title:"General",type:"form",items:c(a,e)}},getGeneralItems:c}});n("ephox.sand.api.URL",["ephox.sand.util.Global"],function(a){return{createObjectURL:function(d){return a.getOrDie("URL").createObjectURL(d)},revokeObjectURL:function(d){a.getOrDie("URL").revokeObjectURL(d)}}});
n("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Factory")});n("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("XMLHttpRequest"))}});s("global!window",window);n("tinymce.plugins.image.core.Uploader",["ephox.sand.api.XMLHttpRequest","global!document","global!window","tinymce.core.util.Promise","tinymce.core.util.Tools"],function(a,d,l,g,e){var h=function(){};return function(c){var b=function(b,
e,d,g){var h,n;h=new a;h.open("POST",c.url);h.withCredentials=c.credentials;h.upload.onprogress=function(a){g(100*(a.loaded/a.total))};h.onerror=function(){d("Image upload failed due to a XHR Transport error. Code: "+h.status)};h.onload=function(){var a;if(200>h.status||300<=h.status)d("HTTP Error: "+h.status);else if((a=JSON.parse(h.responseText))&&"string"===typeof a.location){var b;b=c.basePath;a=a.location;b=b?b.replace(/\/$/,"")+"/"+a.replace(/^\//,""):a;e(b)}else d("Invalid JSON: "+h.responseText)};
n=new l.FormData;n.append("file",b.blob(),b.filename());h.send(n)},d=function(a,b){return new g(function(c,e){try{b(a,c,e,h)}catch(d){e(d.message)}})};c=e.extend({credentials:!1,handler:b},c);return{upload:function(a){return c.url||c.handler!==b?d(a,c.handler):g.reject("Upload url missing from the settings.")}}}});n("tinymce.plugins.image.ui.UploadTab",["ephox.sand.api.URL","tinymce.core.ui.Factory","tinymce.plugins.image.api.Settings","tinymce.plugins.image.core.Utils","tinymce.plugins.image.core.Uploader"],
function(a,d,l,g,e){var h=function(c){return function(b){var h=d.get("Throbber"),f=b.control.rootControl,n=new h(f.getEl()),t=b.control.value(),q=a.createObjectURL(t),r=new e({url:l.getUploadUrl(c),basePath:l.getUploadBasePath(c),credentials:l.getUploadCredentials(c),handler:l.getUploadHandler(c)});n.show();return g.blobToDataUri(t).then(function(b){b=c.editorUpload.blobCache.create({blob:t,blobUri:q,name:t.name?t.name.replace(/\.[^\.]+$/,""):null,base64:b.split(",")[1]});return r.upload(b).then(function(b){var c=
f.find("#src");c.value(b);f.find("tabpanel")[0].activateTab(0);c.fire("change");n.hide();a.revokeObjectURL(q);return b})})["catch"](function(b){c.windowManager.alert(b);n.hide();a.revokeObjectURL(q)})}};return{makeTab:function(a){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",
onchange:h(a)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:h(a)}]}}}});n("tinymce.plugins.image.ui.Dialog","global!Math global!RegExp tinymce.core.util.Tools tinymce.plugins.image.api.Settings tinymce.plugins.image.core.Utils tinymce.plugins.image.ui.AdvTab tinymce.plugins.image.ui.MainTab tinymce.plugins.image.ui.SizeManager tinymce.plugins.image.ui.UploadTab".split(" "),function(a,d,l,g,e,h,c,b,n){return function(a){function d(q){function r(){var c,
d;b.updateSize(u);t(a,u);m=l.extend(m,u.toJSON());m.alt||(m.alt="");m.title||(m.title="");""===m.width&&(m.width=null);""===m.height&&(m.height=null);m.style||(m.style=null);""===m.align&&(m.align=null);m={src:m.src,alt:m.alt,align:m.align,title:m.title,width:m.width,height:m.height,style:m.style,caption:m.caption,"class":m["class"]};a.undoManager.transact(function(){if(m.src)if(""===m.title&&(m.title=null),k?p.setAttribs(k,m):(m.id="__mcenew",a.focus(),a.selection.setContent(p.createHTML("img",m)),
k=p.get("__mcenew"),p.setAttrib(k,"id",null)),a.editorUpload.uploadImagesAuto(),!1===m.caption&&p.is(k.parentNode,"figure.image")&&(c=k.parentNode,p.insertAfter(k,c),p.remove(c)),!0===m.caption){if(!p.is(k.parentNode,"figure.image")){d=k;k=k.cloneNode(!0);c=p.create("figure",{"class":"image"});c.appendChild(k);c.appendChild(p.create("figcaption",{contentEditable:!0},"Caption"));c.contentEditable=!1;var b=p.getParent(d,function(b){return a.schema.getTextBlockElements()[b.nodeName]});b?p.split(b,d,
c):p.replace(c,d);a.selection.select(c)}}else e.waitLoadImage(a,m,k);else k&&(b=p.is(k.parentNode,"figure.image")?k.parentNode:k,p.remove(b),a.focus(),a.nodeChanged(),p.isEmpty(a.getBody())&&(a.setContent(""),a.selection.setCursorLocation()))})}var u,m={},k,s,p=a.dom,v;k=a.selection.getNode();(s=p.getParent(k,"figure.image"))&&(k=p.select("img",s)[0]);k&&("IMG"!==k.nodeName||k.getAttribute("data-mce-object")||k.getAttribute("data-mce-placeholder"))&&(k=null);k&&(m={src:p.getAttrib(k,"src"),alt:p.getAttrib(k,
"alt"),align:p.getAttrib(k,"align"),title:p.getAttrib(k,"title"),"class":p.getAttrib(k,"class"),width:p.getAttrib(k,"width"),height:p.getAttrib(k,"height"),caption:!!s});q&&(v={type:"listbox",label:"Image list",name:"image-list",values:e.buildListItems(q,function(b){b.value=a.convertURL(b.value||b.url,"src")},[{text:"None",value:""}]),value:m.src&&a.convertURL(m.src,"src"),onselect:function(a){var b=u.find("#alt");(!b.value()||a.lastControl&&b.value()===a.lastControl.text())&&b.value(a.control.text());
u.find("#src").value(a.control.value()).fire("change")},onPostRender:function(){v=this}});g.hasAdvTab(a)||g.hasUploadUrl(a)||g.hasUploadHandler(a)?(q=[c.makeTab(a,v)],g.hasAdvTab(a)&&(k&&(k.style.marginLeft&&k.style.marginRight&&k.style.marginLeft===k.style.marginRight&&(m.hspace=e.removePixelSuffix(k.style.marginLeft)),k.style.marginTop&&k.style.marginBottom&&k.style.marginTop===k.style.marginBottom&&(m.vspace=e.removePixelSuffix(k.style.marginTop)),k.style.borderWidth&&(m.border=e.removePixelSuffix(k.style.borderWidth)),
m.style=a.dom.serializeStyle(a.dom.parseStyle(a.dom.getAttrib(k,"style")))),q.push(h.makeTab(a,t))),(g.hasUploadUrl(a)||g.hasUploadHandler(a))&&q.push(n.makeTab(a)),u=a.windowManager.open({title:"Insert/edit image",data:m,bodyType:"tabpanel",body:q,onSubmit:r})):u=a.windowManager.open({title:"Insert/edit image",data:m,body:c.getGeneralItems(a,v),onSubmit:r});b.syncSize(u)}var t=function(a,b){if(g.hasAdvTab(a)){var c=a.dom,d=b.toJSON(),f=c.parseStyle(d.style),f=e.mergeMargins(f);d.vspace&&(f["margin-top"]=
f["margin-bottom"]=e.addPixelSuffix(d.vspace));d.hspace&&(f["margin-left"]=f["margin-right"]=e.addPixelSuffix(d.hspace));d.border&&(f["border-width"]=e.addPixelSuffix(d.border));b.find("#style").value(c.serializeStyle(c.parseStyle(c.serializeStyle(f))))}};return{open:function(){e.createImageList(a,d)}}}});n("tinymce.plugins.image.api.Commands",["tinymce.plugins.image.ui.Dialog"],function(a){return{register:function(d){d.addCommand("mceImage",a(d).open)}}});n("tinymce.plugins.image.core.FilterContent",
["tinymce.core.util.Tools"],function(a){var d=function(a){return(a=a.attr("class"))&&/\bimage\b/.test(a)},l=function(g){return function(e){for(var h=e.length,c,b=function(a){a.attr("contenteditable",g?"true":null)};h--;)c=e[h],d(c)&&(c.attr("contenteditable",g?"false":null),a.each(c.getAll("figcaption"),b))}};return{setup:function(a){a.on("preInit",function(){a.parser.addNodeFilter("figure",l(!0));a.serializer.addNodeFilter("figure",l(!1))})}}});n("tinymce.plugins.image.ui.Buttons",["tinymce.plugins.image.ui.Dialog"],
function(a){return{register:function(d){d.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:a(d).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"});d.addMenuItem("image",{icon:"image",text:"Image",onclick:a(d).open,context:"insert",prependToContext:!0})}}});n("tinymce.plugins.image.Plugin",["tinymce.core.PluginManager","tinymce.plugins.image.api.Commands","tinymce.plugins.image.core.FilterContent","tinymce.plugins.image.ui.Buttons"],function(a,
d,l,g){a.add("image",function(a){l.setup(a);g.register(a);d.register(a)});return function(){}});x("tinymce.plugins.image.Plugin")()})();
