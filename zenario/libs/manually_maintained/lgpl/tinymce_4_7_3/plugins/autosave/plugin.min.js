(function(){var l={},m=function(a){var b=l[a];if(void 0===b)throw"module ["+a+"] was undefined";if(void 0===b.instance){for(var c=l[a],e=c.deps,f=c.defn,h=e.length,d=Array(h),k=0;k<h;++k)d[k]=m(e[k]);e=f.apply(null,d);if(void 0===e)throw"module ["+a+"] returned undefined";c.instance=e}return b.instance},d=function(a,b,c){if("string"!==typeof a)throw"module id must be a string";if(void 0===b)throw"no dependencies for "+a;if(void 0===c)throw"no definition function for "+a;l[a]={deps:b,defn:c,instance:void 0}},
g=function(a,b){d(a,[],function(){return b})};d("ephox.katamari.api.Cell",[],function(){var a=function(b){var c=b;return{get:function(){return c},set:function(a){c=a},clone:function(){return a(c)}}};return a});g("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);d("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});g("global!setInterval",setInterval);d("tinymce.core.util.LocalStorage",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.util.LocalStorage")});d("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Tools")});d("tinymce.plugins.autosave.api.Events",[],function(){return{fireRestoreDraft:function(a){return a.fire("RestoreDraft")},fireStoreDraft:function(a){return a.fire("StoreDraft")},fireRemoveDraft:function(a){return a.fire("RemoveDraft")}}});g("global!document",document);d("tinymce.plugins.autosave.core.Time",[],function(){return{parse:function(a,
b){var c={s:1E3,m:6E4};a=/^(\d+)([ms]?)$/.exec(""+(a||b));return(a[2]?c[a[2]]:1)*parseInt(a,10)}}});d("tinymce.plugins.autosave.api.Settings",["global!document","tinymce.plugins.autosave.core.Time"],function(a,b){return{shouldAskBeforeUnload:function(a){return a.getParam("autosave_ask_before_unload",!0)},getAutoSavePrefix:function(c){var b=c.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-"),b=b.replace(/\{path\}/g,a.location.pathname),b=b.replace(/\{query\}/g,a.location.search),
b=b.replace(/\{hash\}/g,a.location.hash);return b=b.replace(/\{id\}/g,c.id)},shouldRestoreWhenEmpty:function(a){return a.getParam("autosave_restore_when_empty",!1)},getAutoSaveInterval:function(a){return b.parse(a.settings.autosave_interval,"30s")},getAutoSaveRetention:function(a){return b.parse(a.settings.autosave_retention,"20m")}}});d("tinymce.plugins.autosave.core.Storage",["global!setInterval","tinymce.core.util.LocalStorage","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Events","tinymce.plugins.autosave.api.Settings"],
function(a,b,c,e,f){var h=function(a,b){var e=a.settings.forced_root_block;b=c.trim("undefined"===typeof b?a.getBody().innerHTML:b);return""===b||RegExp("^<"+e+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+e+">|<br>$","i").test(b)},d=function(a){var c=parseInt(b.getItem(f.getAutoSavePrefix(a)+"time"),10)||0;return(new Date).getTime()-c>f.getAutoSaveRetention(a)?(k(a,!1),!1):!0},k=function(a,c){var d=f.getAutoSavePrefix(a);b.removeItem(d+"draft");b.removeItem(d+"time");!1!==c&&e.fireRemoveDraft(a)},
g=function(a){var c=f.getAutoSavePrefix(a);!h(a)&&a.isDirty()&&(b.setItem(c+"draft",a.getContent({format:"raw",no_events:!0})),b.setItem(c+"time",(new Date).getTime()),e.fireStoreDraft(a))},l=function(a){var c=f.getAutoSavePrefix(a);d(a)&&(a.setContent(b.getItem(c+"draft"),{format:"raw"}),e.fireRestoreDraft(a))};return{isEmpty:h,hasDraft:d,removeDraft:k,storeDraft:g,restoreDraft:l,startStoreDraft:function(b,c){var e=f.getAutoSaveInterval(b);c.get()||(a(function(){b.removed||g(b)},e),c.set(!0))},restoreLastDraft:function(a){a.undoManager.transact(function(){l(a);
k(a)});a.focus()}}});d("tinymce.plugins.autosave.api.Api",["tinymce.plugins.autosave.core.Storage"],function(a){var b=function(a,b){return function(){var d=Array.prototype.slice.call(arguments);return a.apply(null,[b].concat(d))}};return{get:function(c){return{hasDraft:b(a.hasDraft,c),storeDraft:b(a.storeDraft,c),restoreDraft:b(a.restoreDraft,c),removeDraft:b(a.removeDraft,c),isEmpty:b(a.isEmpty,c)}}}});g("global!window",window);d("tinymce.core.EditorManager",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.EditorManager")});d("tinymce.plugins.autosave.core.BeforeUnload",["global!window","tinymce.core.EditorManager","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Settings"],function(a,b,c,d){b._beforeUnloadHandler=function(){var a;c.each(b.get(),function(b){b.plugins.autosave&&b.plugins.autosave.storeDraft();!a&&b.isDirty()&&d.shouldAskBeforeUnload(b)&&(a=b.translate("You have unsaved changes are you sure you want to navigate away?"))});return a};return{setup:function(c){a.onbeforeunload=
b._beforeUnloadHandler}}});d("tinymce.plugins.autosave.ui.Buttons",["tinymce.plugins.autosave.core.Storage"],function(a){var b=function(b,d){return function(f){var h=f.control;h.disabled(!a.hasDraft(b));b.on("StoreDraft RestoreDraft RemoveDraft",function(){h.disabled(!a.hasDraft(b))});a.startStoreDraft(b,d)}};return{register:function(c,d){c.addButton("restoredraft",{title:"Restore last draft",onclick:function(){a.restoreLastDraft(c)},onPostRender:b(c,d)});c.addMenuItem("restoredraft",{text:"Restore last draft",
onclick:function(){a.restoreLastDraft(c)},onPostRender:b(c,d),context:"file"})}}});d("tinymce.plugins.autosave.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.autosave.api.Api","tinymce.plugins.autosave.core.BeforeUnload","tinymce.plugins.autosave.ui.Buttons"],function(a,b,c,d,f){b.add("autosave",function(b){var g=a(!1);d.setup(b);f.register(b,g);return c.get(b)});return function(){}});m("tinymce.plugins.autosave.Plugin")()})();
