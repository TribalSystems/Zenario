'use strict';(function(){var t={},n=function(a,d,k){if("string"!==typeof a)throw"module id must be a string";if(void 0===d)throw"no dependencies for "+a;if(void 0===k)throw"no definition function for "+a;t[a]={deps:d,defn:k,instance:void 0}},u=function(a){var d=t[a];if(void 0===d)throw"module ["+a+"] was undefined";if(void 0===d.instance){for(var k=t[a],h=k.deps,c=k.defn,m=h.length,r=Array(m),q=0;q<m;++q)r[q]=u(h[q]);h=c.apply(null,r);if(void 0===h)throw"module ["+a+"] returned undefined";k.instance=
h}return d.instance};(function(a,d){n(a,[],function(){return d})})("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);n("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});n("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DOMUtils")});n("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.I18n")});n("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.util.Tools")});n("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(a){return a.getParam("toc_class","mce-toc")},getTocHeader:function(a){a=a.getParam("toc_header","h2");return/^h[1-6]$/.test(a)?a:"h2"},getTocDepth:function(a){a=parseInt(a.getParam("toc_depth","3"),10);return 1<=a&&9>=a?a:3}}});n("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(a){var d=0;return function(){var k=(new Date).getTime().toString(32);return a+
k+(d++).toString(32)}}}});n("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(a,d,k,h,c){var m=c.create("mcetoc_"),r=function(b){var e,l=[];for(e=1;e<=b;e++)l.push("h"+e);return l.join(",")},q=function(b){var e=h.getTocClass(b),l=h.getTocHeader(b),g=r(h.getTocDepth(b));g=b.$(g);g.length&&/^h[1-9]$/i.test(l)&&(g=g.filter(function(f,p){return!b.dom.hasClass(p.parentNode,
e)}));return k.map(g,function(f){return{id:f.id?f.id:m(),level:parseInt(f.nodeName.replace(/^H/i,""),10),title:b.$.text(f),element:f}})},x=function(b){var e=v(b);return'<div class="'+b.dom.encode(h.getTocClass(b))+'" contenteditable="false">'+e+"</div>"},v=function(b){var e="",l=q(b),g;a:{var f=9;for(g=0;g<l.length;g++)if(l[g].level<f&&(f=l[g].level),1===f){g=f;break a}g=f}--g;if(!l.length)return"";b=h.getTocHeader(b);f=d.translate("Table of Contents");var p="</"+b+">";b="<"+b+' contenteditable="true">'+
a.DOM.encode(f)+p;e+=b;for(b=0;b<l.length;b++){f=l[b];f.element.id=f.id;p=l[b+1]&&l[b+1].level;if(g===f.level)e+="<li>";else for(;g<f.level;g++)e+="<ul><li>";e+='<a href="#'+f.id+'">'+f.title+"</a>";if(p!==f.level&&p)for(g=f.level;g>p;g--)e+="</li></ul><li>";else e+="</li>",p||(e+="</ul>");g=f.level}return e},w=function(b){var e=h.getTocClass(b),l=b.$("."+e);l.length&&b.undoManager.transact(function(){l.html(v(b))})};return{hasHeaders:function(b){return 0<q(b).length},insertToc:function(b){var e=
h.getTocClass(b);e=b.$("."+e);!e.length||0<b.dom.getParents(e[0],".mce-offscreen-selection").length?b.insertContent(x(b)):w(b)},updateToc:w}});n("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(a){return{register:function(d){d.addCommand("mceInsertToc",function(){a.insertToc(d)});d.addCommand("mceUpdateToc",function(){a.updateToc(d)})}}});n("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(a){return{setup:function(d){var k=d.$,h=a.getTocClass(d);
d.on("PreProcess",function(c){c=k("."+h,c.node);c.length&&(c.removeAttr("contentEditable"),c.find("[contenteditable]").removeAttr("contentEditable"))});d.on("SetContent",function(){var c=k("."+h);c.length&&(c.attr("contentEditable",!1),c.children(":first-child").attr("contentEditable",!0))})}}});n("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(a,d){var k=function(c){return function(m){var r=m.control;c.on("LoadContent SetContent change",
function(){r.disabled(c.readonly||!d.hasHeaders(c))})}},h=function(c){return function(m){return m&&c.dom.is(m,"."+a.getTocClass(c))&&c.getBody().contains(m)}};return{register:function(c){c.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:k(c)});c.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"});c.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:k(c)});c.addContextToolbar(h(c),"tocupdate")}}});
n("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(a,d,k,h,c){a.add("toc",function(m){d.register(m);c.register(m);h.setup(m)});return function(){}});u("tinymce.plugins.toc.Plugin")()})();
