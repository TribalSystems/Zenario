(function(){var m={},n=function(b){var g=m[b];if(void 0===g)throw"module ["+b+"] was undefined";if(void 0===g.instance){for(var d=m[b],f=d.deps,a=d.defn,k=f.length,c=Array(k),l=0;l<k;++l)c[l]=n(f[l]);f=a.apply(null,c);if(void 0===f)throw"module ["+b+"] returned undefined";d.instance=f}return g.instance},c=function(b,g,d){if("string"!==typeof b)throw"module id must be a string";if(void 0===g)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;m[b]={deps:g,defn:d,instance:void 0}};
(function(b,g){c(b,[],function(){return g})})("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);c("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.PluginManager")});c("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.dom.DOMUtils")});c("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.util.I18n")});c("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(b){return b("tinymce.util.Tools")});c("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(b){return b.getParam("toc_class","mce-toc")},getTocHeader:function(b){b=b.getParam("toc_header","h2");return/^h[1-6]$/.test(b)?b:"h2"},getTocDepth:function(b){b=parseInt(b.getParam("toc_depth","3"),10);return 1<=b&&9>=b?b:3}}});c("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(b){var g=0;return function(){var d=(new Date).getTime().toString(32);return b+
d+(g++).toString(32)}}}});c("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(b,g,d,f,a){var c=a.create("mcetoc_"),m=function(b){var a,g=[];for(a=1;a<=b;a++)g.push("h"+a);return g.join(",")},l=function(b){var a=f.getTocClass(b),g=f.getTocHeader(b),e=m(f.getTocDepth(b)),e=b.$(e);e.length&&/^h[1-9]$/i.test(g)&&(e=e.filter(function(g,e){return!b.dom.hasClass(e.parentNode,
a)}));return d.map(e,function(a){return{id:a.id?a.id:c(),level:parseInt(a.nodeName.replace(/^H/i,""),10),title:b.$.text(a),element:a}})},n=function(b){var a=p(b);return'<div class="'+b.dom.encode(f.getTocClass(b))+'" contenteditable="false">'+a+"</div>"},p=function(a){var h="",d=l(a),e;a:{var c=9;for(e=0;e<d.length;e++)if(d[e].level<c&&(c=d[e].level),1===c){e=c;break a}e=c}e-=1;var k;if(!d.length)return"";a=f.getTocHeader(a);c=g.translate("Table of Contents");k="</"+a+">";a="<"+a+' contenteditable="true">'+
b.DOM.encode(c)+k;h+=a;for(a=0;a<d.length;a++){c=d[a];c.element.id=c.id;k=d[a+1]&&d[a+1].level;if(e===c.level)h+="<li>";else for(;e<c.level;e++)h+="<ul><li>";h+='<a href="#'+c.id+'">'+c.title+"</a>";if(k!==c.level&&k)for(e=c.level;e>k;e--)h+="</li></ul><li>";else h+="</li>",k||(h+="</ul>");e=c.level}return h},q=function(a){var b=f.getTocClass(a),c=a.$("."+b);c.length&&a.undoManager.transact(function(){c.html(p(a))})};return{hasHeaders:function(a){return 0<l(a).length},insertToc:function(a){var b=
f.getTocClass(a),b=a.$("."+b);!b.length||0<a.dom.getParents(b[0],".mce-offscreen-selection").length?a.insertContent(n(a)):q(a)},updateToc:q}});c("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(b){return{register:function(c){c.addCommand("mceInsertToc",function(){b.insertToc(c)});c.addCommand("mceUpdateToc",function(){b.updateToc(c)})}}});c("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(b){return{setup:function(c){var d=c.$,f=b.getTocClass(c);
c.on("PreProcess",function(a){a=d("."+f,a.node);a.length&&(a.removeAttr("contentEditable"),a.find("[contenteditable]").removeAttr("contentEditable"))});c.on("SetContent",function(){var a=d("."+f);a.length&&(a.attr("contentEditable",!1),a.children(":first-child").attr("contentEditable",!0))})}}});c("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(b,c){var d=function(a){return function(b){var d=b.control;a.on("LoadContent SetContent change",
function(){d.disabled(a.readonly||!c.hasHeaders(a))})}},f=function(a){return function(c){return c&&a.dom.is(c,"."+b.getTocClass(a))&&a.getBody().contains(c)}};return{register:function(a){a.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:d(a)});a.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"});a.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:d(a)});a.addContextToolbar(f(a),"tocupdate")}}});
c("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(b,c,d,f,a){b.add("toc",function(b){c.register(b);a.register(b);f.setup(b)});return function(){}});n("tinymce.plugins.toc.Plugin")()})();
