(function(){var H={},Q=function(a){var b=H[a];if(void 0===b)throw"module ["+a+"] was undefined";if(void 0===b.instance){for(var c=H[a],f=c.deps,g=c.defn,e=f.length,d=Array(e),k=0;k<e;++k)d[k]=Q(f[k]);f=g.apply(null,d);if(void 0===f)throw"module ["+a+"] returned undefined";c.instance=f}return b.instance},h=function(a,b,c){if("string"!==typeof a)throw"module id must be a string";if(void 0===b)throw"no dependencies for "+a;if(void 0===c)throw"no definition function for "+a;H[a]={deps:b,defn:c,instance:void 0}},
x=function(a,b){h(a,[],function(){return b})};h("ephox.katamari.api.Cell",[],function(){var a=function(b){var c=b;return{get:function(){return c},set:function(a){c=a},clone:function(){return a(c)}}};return a});x("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);h("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});h("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Tools")});
h("ephox.imagetools.util.Canvas",[],function(){function a(a,b){return c(document.createElement("canvas"),a,b)}function b(a){return a.getContext("2d")}function c(a,b,e){a.width=b;a.height=e;return a}return{create:a,clone:function(c){var g;g=a(c.width,c.height);b(g).drawImage(c,0,0);return g},resize:c,get2dContext:b,get3dContext:function(a){var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(e){}b||(b=null);return b}}});h("ephox.imagetools.util.ImageSize",[],function(){return{getWidth:function(a){return a.naturalWidth||
a.width},getHeight:function(a){return a.naturalHeight||a.height}}});h("ephox.imagetools.util.Mime",[],function(){return{guessMimeType:function(a){if(0===a.indexOf("data:"))return a=a.split(","),(a=/data:([^;]+)/.exec(a[0]))?a[1]:"";var b=document.createElement("a");b.href=a;a=b.pathname.split(".");(a=a[a.length-1])&&(a=a.toLowerCase());return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[a]}}});h("ephox.imagetools.util.Promise",[],function(){function a(a,b){return function(){a.apply(b,arguments)}}
function b(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];k(b,a(f,this),a(g,this))}function c(a){var b=this;null===this._state?this._deferreds.push(a):u(function(){var e=b._state?a.onFulfilled:a.onRejected;if(null===e)(b._state?a.resolve:a.reject)(b._value);else{var d;try{d=e(b._value)}catch(c){a.reject(c);return}a.resolve(d)}})}function f(b){try{if(b===
this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===typeof b||"function"===typeof b)){var d=b.then;if("function"===typeof d){k(a(d,b),a(f,this),a(g,this));return}}this._state=!0;this._value=b;e.call(this)}catch(c){g.call(this,c)}}function g(a){this._state=!1;this._value=a;e.call(this)}function e(){for(var a=0,b=this._deferreds.length;a<b;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function d(a,b,d,e){this.onFulfilled="function"===typeof a?a:null;this.onRejected=
"function"===typeof b?b:null;this.resolve=d;this.reject=e}function k(a,b,d){var e=!1;try{a(function(a){e||(e=!0,b(a))},function(a){e||(e=!0,d(a))})}catch(c){e||(e=!0,d(c))}}if(window.Promise)return window.Promise;var u=b.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.prototype["catch"]=function(a){return this.then(null,a)};b.prototype.then=function(a,e){var k=this;
return new b(function(b,l){c.call(k,new d(a,e,b,l))})};b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new b(function(b,e){function d(k,l){try{if(l&&("object"===typeof l||"function"===typeof l)){var f=l.then;if("function"===typeof f){f.call(l,function(a){d(k,a)},e);return}}a[k]=l;0===--c&&b(a)}catch(r){e(r)}}if(0===a.length)return b([]);for(var c=a.length,k=0;k<a.length;k++)d(k,a[k])})};b.resolve=function(a){return a&&"object"===
typeof a&&a.constructor===b?a:new b(function(b){b(a)})};b.reject=function(a){return new b(function(b,e){e(a)})};b.race=function(a){return new b(function(b,e){for(var d=0,c=a.length;d<c;d++)a[d].then(b,e)})};return b});x("global!Array",Array);x("global!Error",Error);h("ephox.katamari.api.Fun",["global!Array","global!Error"],function(a,b){var c=function(a){return function(){return a}},f=c(!1),g=c(!0);return{noop:function(){},compose:function(a,b){return function(){return a(b.apply(null,arguments))}},
constant:c,identity:function(a){return a},tripleEquals:function(a,b){return a===b},curry:function(b){for(var d=new a(arguments.length-1),c=1;c<arguments.length;c++)d[c-1]=arguments[c];return function(){for(var c=new a(arguments.length),k=0;k<c.length;k++)c[k]=arguments[k];c=d.concat(c);return b.apply(null,c)}},not:function(a){return function(){return!a.apply(null,arguments)}},die:function(a){return function(){throw new b(a);}},apply:function(a){return a()},call:function(a){a()},never:f,always:g}});
x("global!Object",Object);h("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(a,b){var c=a.never,f=a.always,g=function(){return e},e=function(){var d=function(a){return a.isNone()},e=function(a){return a()},l=function(a){return a},d={fold:function(a,b){return a()},is:c,isSome:c,isNone:f,getOr:l,getOrThunk:e,getOrDie:function(a){throw Error(a||"error: getOrDie called on none.");},or:l,orThunk:e,map:g,ap:g,each:function(){},bind:g,flatten:g,exists:c,forall:f,filter:g,equals:d,
equals_:d,toArray:function(){return[]},toString:a.constant("none()")};b.freeze&&b.freeze(d);return d}(),d=function(a){var b=function(){return a},l=function(){return n},m=function(b){return b(a)},n={fold:function(b,d){return d(a)},is:function(b){return a===b},isSome:f,isNone:c,getOr:b,getOrThunk:b,getOrDie:b,or:l,orThunk:l,map:function(b){return d(b(a))},ap:function(b){return b.fold(g,function(b){return d(b(a))})},each:function(b){b(a)},bind:m,flatten:b,exists:m,forall:m,filter:function(b){return b(a)?
n:e},equals:function(b){return b.is(a)},equals_:function(b,d){return b.fold(c,function(b){return d(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return n};return{some:d,none:g,from:function(a){return null===a||void 0===a?e:d(a)}}});h("ephox.katamari.api.Global",[],function(){return"undefined"!==typeof window?window:Function("return this;")()});h("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(a){var b=function(b,c){for(var e=void 0!==c?c:a,d=0;d<
b.length&&void 0!==e&&null!==e;++d)e=e[b[d]];return e},c=function(b,c){for(var e=void 0!==c?c:a,d=0;d<b.length;++d){var k=b[d];if(void 0===e[k]||null===e[k])e[k]={};e=e[k]}return e};return{path:b,resolve:function(a,c){var e=a.split(".");return b(e,c)},forge:c,namespace:function(a,b){var e=a.split(".");return c(e,b)}}});h("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(a){return{getOrDie:function(b,c){var f=a.resolve(b,c);if(void 0===f)throw b+" not available on this browser";return f}}});
h("ephox.sand.api.Blob",["ephox.sand.util.Global"],function(a){return function(b,c){return new (a.getOrDie("Blob"))(b,c)}});h("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("FileReader"))}});h("ephox.sand.api.Uint8Array",["ephox.sand.util.Global"],function(a){return function(b){return new (a.getOrDie("Uint8Array"))(b)}});h("ephox.sand.api.Window",["ephox.sand.util.Global"],function(a){return{atob:function(b){return a.getOrDie("atob")(b)},
requestAnimationFrame:function(b){a.getOrDie("requestAnimationFrame")(b)}}});x("global!Math",Math);h("ephox.imagetools.util.Conversions","ephox.imagetools.util.Canvas ephox.imagetools.util.ImageSize ephox.imagetools.util.Mime ephox.imagetools.util.Promise ephox.katamari.api.Option ephox.sand.api.Blob ephox.sand.api.FileReader ephox.sand.api.Uint8Array ephox.sand.api.Window global!Array global!Math".split(" "),function(a,b,c,f,g,e,d,k,u,l,m){function n(a){return new f(function(b){function c(){a.removeEventListener("load",
c);b(a)}a.complete?b(a):a.addEventListener("load",c)})}function p(c){return n(c).then(function(c){var d;d=a.create(b.getWidth(c),b.getHeight(c));a.get2dContext(d).drawImage(c,0,0);return d})}function q(a){return new f(function(b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(){200==this.status&&b(this.response)};c.send()})}function E(a){var b=a.split(",");a=/data:([^;]+)/.exec(b[0]);if(!a)return g.none();a=a[1];for(var b=u.atob(b[1]),c=b.length,d=m.ceil(c/1024),
r=new l(d),f=0;f<d;++f){for(var v=1024*f,n=m.min(v+1024,c),s=new l(n-v),p=0;v<n;++p,++v)s[p]=b[v].charCodeAt(0);r[f]=k(s)}return g.some(e(r,{type:a}))}function r(a){return new f(function(b,c){E(a).fold(function(){c("uri is not base64: "+a)},b)})}function s(a,b,c){b=b||"image/png";return HTMLCanvasElement.prototype.toBlob?new f(function(d){a.toBlob(function(a){d(a)},b,c)}):r(a.toDataURL(b,c))}function v(a){return new f(function(b){var c=new d;c.onloadend=function(){b(c.result)};c.readAsDataURL(a)})}
return{blobToImage:function(a){return new f(function(b){function c(){d.removeEventListener("load",c);b(d)}var d=new Image;d.addEventListener("load",c);d.src=URL.createObjectURL(a);d.complete&&c()})},imageToBlob:function(a){return n(a).then(function(a){var b=a.src;return 0===b.indexOf("blob:")?q(b):0===b.indexOf("data:")?r(b):p(a).then(function(a){return s(a,c.guessMimeType(b))})})},blobToDataUri:v,blobToBase64:function(a){return v(a).then(function(a){return a.split(",")[1]})},imageToCanvas:p,canvasToBlob:s,
revokeImageUrl:function(a){URL.revokeObjectURL(a.src)},uriToBlob:function(a){return 0===a.indexOf("blob:")?q(a):0===a.indexOf("data:")?r(a):null},dataUriToBlobSync:E,isDataUrl:function(a){a=a.split(",");return null!==/data:([^;]+)/.exec(a[0])}}});h("ephox.imagetools.api.BlobConversions",["ephox.imagetools.util.Conversions"],function(a){return{blobToImage:function(b){return a.blobToImage(b)},imageToBlob:function(b){return a.imageToBlob(b)},blobToDataUri:function(b){return a.blobToDataUri(b)},blobToBase64:function(b){return a.blobToBase64(b)},
dataUriToBlobSync:function(b){return a.dataUriToBlobSync(b)}}});h("ephox.imagetools.util.ImageResult","ephox.imagetools.util.Canvas ephox.imagetools.util.Conversions ephox.imagetools.util.Mime ephox.imagetools.util.Promise ephox.katamari.api.Fun ephox.katamari.api.Option".split(" "),function(a,b,c,f,g,e){function d(c,d,e){function k(a,b){var d=a||p,l=function(){return c.toDataURL(d,b)};return e.fold(l,function(a){return void 0===b&&d===p?a:l()})}var p=d.type;return{getType:g.constant(p),toBlob:function(a,
e){var r=a||p;return a===p&&void 0===e?f.resolve(d):b.canvasToBlob(c,r,e)},toDataURL:k,toBase64:function(a,b){return k(a,b).split(",")[1]},toCanvas:function(){return a.clone(c)}}}function k(a,c){return b.canvasToBlob(a,c).then(function(b){return d(a,b,e.none())})}return{fromBlob:function(a){return b.blobToImage(a).then(function(a){var c=b.imageToCanvas(a);b.revokeImageUrl(a);return c}).then(function(c){return b.blobToDataUri(a).then(function(b){return d(c,a,e.some(b))})})},fromCanvas:k,fromImage:function(a){var d=
c.guessMimeType(a.src);return b.imageToCanvas(a).then(function(a){return b.canvasToBlob(a,d).then(function(b){return k(a,b,e.none())})})},fromBlobAndUrlSync:function(a,c){var d=e.none();b.blobToImage(a).then(function(a){var c=b.imageToCanvas(a);b.revokeImageUrl(a);d=e.some(c)});return{getType:g.constant(a.type),toBlob:function(){return f.resolve(a)},toDataURL:g.constant(c),toBase64:function(){return c.split(",")[1]},toCanvas:function(){return d.getOrDie("image has not loaded yet")}}}}});h("ephox.imagetools.transformations.ColorMatrix",
[],function(){function a(a,b,c){a=parseFloat(a);a>c?a=c:a<b&&(a=b);return a}function b(a,b){var c,f,u,l,m=[],n=Array(10);for(c=0;5>c;c++){for(f=0;5>f;f++)m[f]=b[f+5*c];for(f=0;5>f;f++){for(u=l=0;5>u;u++)l+=a[f+5*u]*m[u];n[f+5*c]=l}}return n}function c(b,c){c=a(c,0,1);return b.map(function(b,f){b=0===f%6?1-(1-b)*c:b*c;return a(b,0,1)})}var f=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,
0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:c,multiply:b,adjustContrast:function(c,e){var d;e=a(e,-1,1);e*=100;0>e?d=127+127*(e/100):(d=e%1,d=0===d?f[e]:f[Math.floor(e)]*
(1-d)+f[Math.floor(e)+1]*d,d=127*d+127);return b(c,[d/127,0,0,0,0.5*(127-d),0,d/127,0,0,0.5*(127-d),0,0,d/127,0,0.5*(127-d),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(c,e){e=a(255*e,-255,255);return b(c,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(c,e){var d;e=a(e,-1,1);d=1+(0<e?3*e:e);return b(c,[0.3086*(1-d)+d,0.6094*(1-d),0.082*(1-d),0,0,0.3086*(1-d),0.6094*(1-d)+d,0.082*(1-d),0,0,0.3086*(1-d),0.6094*(1-d),0.082*(1-d)+d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(c,
e){var d,f;e=a(e,-180,180)/180*Math.PI;d=Math.cos(e);f=Math.sin(e);return b(c,[0.213+0.787*d+-0.213*f,0.715+-0.715*d+-0.715*f,0.072+-0.072*d+0.928*f,0,0,0.213+-0.213*d+0.143*f,0.715+d*(1-0.715)+0.14*f,0.072+-0.072*d+-0.283*f,0,0,0.213+-0.213*d+-0.787*f,0.715+-0.715*d+0.715*f,0.072+0.928*d+0.072*f,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(c,f,d,k){f=a(f,0,2);d=a(d,0,2);k=a(k,0,2);return b(c,[f,0,0,0,0,0,d,0,0,0,0,0,k,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(f,e){e=a(e,0,1);return b(f,
c([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],e))},adjustGrayscale:function(f,e){e=a(e,0,1);return b(f,c([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],e))}}});h("ephox.imagetools.transformations.Filters",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ColorMatrix"],function(a,b,c){function f(c,d){var f=c.toCanvas(),e=a.get2dContext(f),k=e.getImageData(0,0,f.width,f.height),
g=k.data,h,r,s,v,t,C=d[0],w=d[1],oa=d[2],I=d[3],A=d[4],W=d[5],R=d[6],T=d[7],O=d[8],X=d[9],z=d[10],J=d[11],F=d[12],K=d[13],x=d[14],L=d[15],y=d[16],G=d[17],S=d[18],U=d[19];for(t=0;t<g.length;t+=4)h=g[t],r=g[t+1],s=g[t+2],v=g[t+3],g[t]=h*C+r*w+s*oa+v*I+A,g[t+1]=h*W+r*R+s*T+v*O+X,g[t+2]=h*z+r*J+s*F+v*K+x,g[t+3]=h*L+r*y+s*G+v*S+U;e.putImageData(k,0,0);return b.fromCanvas(f,c.getType())}function g(c,d){var f=c.toCanvas(),e=a.get2dContext(f),k,g;k=e.getImageData(0,0,f.width,f.height);g=e.getImageData(0,
0,f.width,f.height);g=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var f,e,k,l,g,m,n,u,p,h,q,z,J,F;k=Math.round(Math.sqrt(c.length));l=Math.floor(k/2);f=a.data;e=b.data;J=a.width;F=a.height;for(g=0;g<F;g++)for(a=0;a<J;a++){for(h=m=n=u=0;h<k;h++)for(p=0;p<k;p++)q=d(a+p-l,0,J-1),z=d(g+h-l,0,F-1),q=4*(z*J+q),z=c[h*k+p],m+=f[q]*z,n+=f[q+1]*z,u+=f[q+2]*z;q=4*(g*J+a);e[q]=d(m,0,255);e[q+1]=d(n,0,255);e[q+2]=d(u,0,255)}return b}(k,g,d);e.putImageData(g,0,0);return b.fromCanvas(f,c.getType())}
function e(c){return function(d,f){var e=d.toCanvas(),k=a.get2dContext(e),g,h=Array(256);for(g=0;g<h.length;g++)h[g]=c(g,f);g=k.getImageData(0,0,e.width,e.height);var r=g.data,s;for(s=0;s<r.length;s+=4)r[s]=h[r[s]],r[s+1]=h[r[s+1]],r[s+2]=h[r[s+2]];k.putImageData(g,0,0);return b.fromCanvas(e,d.getType())}}function d(a){return function(b,d){return f(b,a(c.identity(),d))}}function k(a){return function(b){return g(b,a)}}return{invert:function(a){return function(b){return f(b,a)}}([-1,0,0,0,255,0,-1,
0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:d(c.adjustBrightness),hue:d(c.adjustHue),saturate:d(c.adjustSaturation),contrast:d(c.adjustContrast),grayscale:d(c.adjustGrayscale),sepia:d(c.adjustSepia),colorize:function(a,b,d,e){return f(a,c.adjustColors(c.identity(),b,d,e))},sharpen:k([0,-1,0,-1,5,-1,0,-1,0]),emboss:k([-2,-1,0,-1,1,1,0,1,2]),gamma:e(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:e(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:f,convoluteFilter:g}});h("ephox.imagetools.transformations.ImageResizerCanvas",
["ephox.imagetools.util.Promise","ephox.imagetools.util.Conversions","ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageSize"],function(a,b,c,f){function g(a,b,c){var l=f.getWidth(a),m=f.getHeight(a),l=b/l,n=c/m,m=!1;if(0.5>l||2<l)l=0.5>l?0.5:2,m=!0;if(0.5>n||2<n)n=0.5>n?0.5:2,m=!0;a=e(a,l,n);return m?a.then(function(a){return g(a,b,c)}):a}function e(b,e,g){return new a(function(a){var m=f.getWidth(b),n=f.getHeight(b),h=Math.floor(m*e),q=Math.floor(n*g),E=c.create(h,q);c.get2dContext(E).drawImage(b,
0,0,m,n,0,0,h,q);a(E)})}return{scale:g}});h("ephox.imagetools.transformations.ImageTools",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ImageResizerCanvas"],function(a,b,c){return{rotate:function(c,g){var e=c.toCanvas(),d=a.create(e.width,e.height),k=a.get2dContext(d),h=0,l=0;g=0>g?360+g:g;90!=g&&270!=g||a.resize(d,d.height,d.width);if(90==g||180==g)h=d.width;if(270==g||180==g)l=d.height;k.translate(h,l);k.rotate(g*Math.PI/180);k.drawImage(e,
0,0);return b.fromCanvas(d,c.getType())},flip:function(c,g){var e=c.toCanvas(),d=a.create(e.width,e.height),k=a.get2dContext(d);"v"==g?(k.scale(1,-1),k.drawImage(e,0,-d.height)):(k.scale(-1,1),k.drawImage(e,-d.width,0));return b.fromCanvas(d,c.getType())},crop:function(c,g,e,d,k){var h=c.toCanvas();d=a.create(d,k);a.get2dContext(d).drawImage(h,-g,-e);return b.fromCanvas(d,c.getType())},resize:function(a,g,e){return c.scale(a.toCanvas(),g,e).then(function(c){return b.fromCanvas(c,a.getType())})}}});
h("ephox.imagetools.api.ImageTransformations",["ephox.imagetools.transformations.Filters","ephox.imagetools.transformations.ImageTools"],function(a,b){return{invert:function(b){return a.invert(b)},sharpen:function(b){return a.sharpen(b)},emboss:function(b){return a.emboss(b)},brightness:function(b,f){return a.brightness(b,f)},hue:function(b,f){return a.hue(b,f)},saturate:function(b,f){return a.saturate(b,f)},contrast:function(b,f){return a.contrast(b,f)},grayscale:function(b,f){return a.grayscale(b,
f)},sepia:function(b,f){return a.sepia(b,f)},colorize:function(b,f,g,e){return a.colorize(b,f,g,e)},gamma:function(b,f){return a.gamma(b,f)},exposure:function(b,f){return a.exposure(b,f)},flip:function(a,f){return b.flip(a,f)},crop:function(a,f,g,e,d){return b.crop(a,f,g,e,d)},resize:function(a,f,g){return b.resize(a,f,g)},rotate:function(a,f){return b.rotate(a,f)}}});h("ephox.imagetools.api.ResultConversions",["ephox.imagetools.util.ImageResult"],function(a){return{blobToImageResult:function(b){return a.fromBlob(b)},
fromBlobAndUrlSync:function(b,c){return a.fromBlobAndUrlSync(b,c)},imageToImageResult:function(b){return a.fromImage(b)},imageResultToBlob:function(a,c,f){return a.toBlob(c,f)},imageResultToOriginalBlob:function(a){return a.toBlob()},imageResultToDataURL:function(a,c,f){return a.toDataURL(c,f)}}});h("ephox.sand.api.URL",["ephox.sand.util.Global"],function(a){return{createObjectURL:function(b){return a.getOrDie("URL").createObjectURL(b)},revokeObjectURL:function(b){a.getOrDie("URL").revokeObjectURL(b)}}});
x("global!clearTimeout",clearTimeout);h("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Delay")});h("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Promise")});h("tinymce.core.util.URI",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.URI")});h("tinymce.plugins.imagetools.api.Settings",[],function(){return{getToolbarItems:function(a){return a.getParam("imagetools_toolbar",
"rotateleft rotateright | flipv fliph | crop editimage imageoptions")},getProxyUrl:function(a){return a.getParam("imagetools_proxy")}}});h("tinymce.plugins.imagetools.core.ImageSize",[],function(){return{getImageSize:function(a){var b,c;b=a.style.width;c=a.style.height;if(b||c)return/^[0-9\.]+px$/.test(b)&&/^[0-9\.]+px$/.test(c)?{w:parseInt(b,10),h:parseInt(c,10)}:null;b=a.width;c=a.height;return b&&c?{w:parseInt(b,10),h:parseInt(c,10)}:null},setImageSize:function(a,b){var c,f;if(b){c=a.style.width;
f=a.style.height;if(c||f)a.style.width=b.w+"px",a.style.height=b.h+"px",a.removeAttribute("data-mce-style");c=a.width;f=a.height;if(c||f)a.setAttribute("width",b.w),a.setAttribute("height",b.h)}},getNaturalImageSize:function(a){return{w:a.naturalWidth,h:a.naturalHeight}}}});x("global!String",String);h("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(a,b,c,f){var g=function(){var a=b.prototype.indexOf,c=function(b,c){return a.call(b,c)},
d=function(a,b){var c;a:{c=0;for(var d=a.length;c<d;++c)if(a[c]===b)break a;c=-1}return c};return void 0===a?d:c}(),e=function(a,b){return-1<g(a,b)},d=function(a,c){for(var d=a.length,f=new b(d),e=0;e<d;e++)f[e]=c(a[e],e,a);return f},k=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c,a)},h=function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c,a)},l=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];b(f,d,a)&&c.push(f)}return c},m=function(b,c){for(var d=0,e=b.length;d<e;d++)if(c(b[d],
d,b))return a.some(d);return a.none()},n=b.prototype.push,p=function(a){for(var d=[],e=0,f=a.length;e<f;++e){if(!b.prototype.isPrototypeOf(a[e]))throw new c("Arr.flatten item "+e+" was not an array, input: "+a);n.apply(d,a[e])}return d},q=function(a,b){for(var c=0,d=a.length;c<d;++c)if(!0!==b(a[c],c,a))return!1;return!0},E=b.prototype.slice;return{map:d,each:k,eachr:h,partition:function(a,b){for(var c=[],d=[],e=0,f=a.length;e<f;e++){var g=a[e];(b(g,e,a)?c:d).push(g)}return{pass:c,fail:d}},filter:l,
groupBy:function(a,b){if(0===a.length)return[];for(var c=b(a[0]),d=[],e=[],f=0,g=a.length;f<g;f++){var k=a[f],l=b(k);l!==c&&(d.push(e),e=[]);c=l;e.push(k)}0!==e.length&&d.push(e);return d},indexOf:function(b,c){var d=g(b,c);return-1===d?a.none():a.some(d)},foldr:function(a,b,c){h(a,function(a){c=b(c,a)});return c},foldl:function(a,b,c){k(a,function(a){c=b(c,a)});return c},find:function(b,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];if(c(f,d,b))return a.some(f)}return a.none()},findIndex:m,flatten:p,
bind:function(a,b){var c=d(a,b);return p(c)},forall:q,exists:function(a,b){return m(a,b).isSome()},contains:e,equal:function(a,b){return a.length===b.length&&q(a,function(a,c){return a===b[c]})},reverse:function(a){a=E.call(a,0);a.reverse();return a},chunk:function(a,b){for(var c=[],d=0;d<a.length;d+=b){var e=a.slice(d,d+b);c.push(e)}return c},difference:function(a,b){return l(a,function(a){return!e(b,a)})},mapToObject:function(a,b){for(var c={},d=0,e=a.length;d<e;d++){var g=a[d];c[f(g)]=b(g,d)}return c},
pure:function(a){return[a]},sort:function(a,b){var c=E.call(a,0);c.sort(b);return c},range:function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));return c},head:function(b){return 0===b.length?a.none():a.some(b[0])},last:function(b){return 0===b.length?a.none():a.some(b[b.length-1])}}});h("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("XMLHttpRequest"))}});h("tinymce.plugins.imagetools.core.Utils",["ephox.sand.api.FileReader","ephox.sand.api.XMLHttpRequest",
"tinymce.core.util.Promise","tinymce.core.util.Tools"],function(a,b,c,f){return{traverse:function(a,b){var c;c=b.reduce(function(a,b){return null!==a&&void 0!==a?a[b]:void 0},a);return null!==c&&void 0!==c?c:null},readBlob:function(b){return new c(function(c){var d=new a;d.onload=function(a){c(a.target.result)};d.readAsText(b)})},requestUrlAsBlob:function(a,e){return new c(function(c){var k;k=new b;k.onreadystatechange=function(){4===k.readyState&&c({status:k.status,blob:this.response})};k.open("GET",
a,!0);f.each(e,function(a,b){k.setRequestHeader(b,a)});k.responseType="blob";k.send()})},parseJson:function(a){var b;try{b=JSON.parse(a)}catch(c){}return b}}});h("tinymce.plugins.imagetools.core.Errors",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","tinymce.core.util.Promise","tinymce.plugins.imagetools.core.Utils"],function(a,b,c,f){var g=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],e=[{type:"key_missing",
message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],d=function(c){return"ImageProxy HTTP error: "+a.find(g,function(a){return c===a.code}).fold(b.constant("Unknown ImageProxy error"),function(a){return a.message})},k=function(a){a=d(a);return c.reject(a)},h=function(c){return a.find(e,function(a){return a.type===c}).fold(b.constant("Unknown service error"),
function(a){return a.message})},l=function(a,b){return f.readBlob(b).then(function(a){a=f.parseJson(a);a=(a=f.traverse(a,["error","type"]))?h(a):"Invalid JSON in service error message";return c.reject("ImageProxy Service error: "+a)})};return{handleServiceErrorResponse:function(a,b){return 400===a||403===a||500===a?l(a,b):k(a)},handleHttpError:k,getHttpErrorMsg:d,getServiceErrorMsg:h}});h("tinymce.plugins.imagetools.core.Proxy",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Errors",
"tinymce.plugins.imagetools.core.Utils"],function(a,b,c,f){function g(b){return f.requestUrlAsBlob(b,{}).then(function(b){return 200>b.status||300<=b.status?c.handleHttpError(b.status):a.resolve(b.blob)})}var e=function(a,b){var c=-1===a.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(a)||!b?a:a+c+"apiKey="+encodeURIComponent(b)},d=function(b,d){return f.requestUrlAsBlob(e(b,d),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":d}).then(function(b){return 200>b.status||300<=b.status?c.handleServiceErrorResponse(b.status,
b.blob):a.resolve(b.blob)})};return{getUrl:function(a,b){return b?d(a,b):g(a)}}});x("global!setTimeout",setTimeout);h("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DOMUtils")});h("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Factory")});h("tinymce.plugins.imagetools.core.UndoStack",[],function(){return function(){function a(){return-1!==c&&c<b.length-1}var b=[],c=-1;return{data:b,add:function(a){var g;
g=b.splice(++c);b.push(a);return{state:a,removed:g}},undo:function(){if(0<c)return b[--c]},redo:function(){if(a())return b[++c]},canUndo:function(){return 0<c},canRedo:a}}});x("global!document",document);x("global!Image",Image);h("tinymce.core.geom.Rect",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.geom.Rect")});h("tinymce.plugins.imagetools.core.LoadImage",["tinymce.core.util.Promise"],function(a){return{loadImage:function(b){return new a(function(a){var f=function(){b.removeEventListener("load",
f);a(b)};b.complete?a(b):b.addEventListener("load",f)})}}});h("tinymce.core.dom.DomQuery",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DomQuery")});h("tinymce.core.util.Observable",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Observable")});h("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.VK")});h("tinymce.plugins.imagetools.ui.CropRect","tinymce.core.dom.DomQuery tinymce.core.geom.Rect tinymce.core.ui.Factory tinymce.core.util.Observable tinymce.core.util.Tools tinymce.core.util.VK".split(" "),
function(a,b,c,f,g,e){var d=0;return function(k,h,l,m,n){function p(a,c,d,e){var f,g,h;f=c.x;g=c.y;h=c.w;c=c.h;f+=d*a.deltaX;g+=e*a.deltaY;h+=d*a.deltaW;c+=e*a.deltaH;20>h&&(h=20);20>c&&(c=20);a=k=b.clamp({x:f,y:g,w:h,h:c},l,"move"===a.name);a={x:a.x-l.x,y:a.y-l.y,w:a.w,h:a.h};s.fire("updateRect",{rect:a});r(a)}function q(b){function c(b,d){0>d.h&&(d.h=0);0>d.w&&(d.w=0);a("#"+w+"-"+b,m).css({left:d.x,top:d.y,width:d.w,height:d.h})}g.each(v,function(c){a("#"+w+"-"+c.name,m).css({left:b.w*c.xMul+b.x,
top:b.h*c.yMul+b.y})});c("top",{x:h.x,y:h.y,w:h.w,h:b.y-h.y});c("right",{x:b.x+b.w,y:b.y,w:h.w-b.x-b.w+h.x,h:b.h});c("bottom",{x:h.x,y:b.y+b.h,w:h.w,h:h.h-b.y-b.h+h.y});c("left",{x:h.x,y:b.y,w:b.x-h.x,h:b.h});c("move",b)}function E(a){k=a;q(k)}function r(a){E({x:a.x+l.x,y:a.y+l.y,w:a.w,h:a.h})}var s,v,t,C,w="mce-crid-"+d++;v=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},
{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];C=["top","right","bottom","left"];(function(){a('<div id="'+w+'" class="mce-croprect-container" role="grid" aria-dropeffect="execute">').appendTo(m);g.each(C,function(b){a("#"+w,m).append('<div id="'+w+"-"+b+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});
g.each(v,function(b){a("#"+w,m).append('<div id="'+w+"-"+b.name+'" class="mce-croprect-handle mce-croprect-handle-'+b.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+b.label+'" aria-grabbed="false">')});t=g.map(v,function(a){var b;return new (c.get("DragHelper"))(w,{document:m.ownerDocument,handle:w+"-"+a.name,start:function(){b=k},drag:function(c){p(a,b,c.deltaX,c.deltaY)}})});q(k);a(m).on("focusin focusout",function(b){a(b.target).attr("aria-grabbed",
"focus"===b.type)});a(m).on("keydown",function(a){function b(a,d,e,f,g){a.stopPropagation();a.preventDefault();p(c,e,f,g)}var c;g.each(v,function(b){if(a.target.id===w+"-"+b.name)return c=b,!1});switch(a.keyCode){case e.LEFT:b(a,c,k,-10,0);break;case e.RIGHT:b(a,c,k,10,0);break;case e.UP:b(a,c,k,0,-10);break;case e.DOWN:b(a,c,k,0,10);break;case e.ENTER:case e.SPACEBAR:a.preventDefault(),n()}})})(m);return s=g.extend({toggleVisibility:function(b){var c;c=g.map(v,function(a){return"#"+w+"-"+a.name}).concat(g.map(C,
function(a){return"#"+w+"-"+a})).join(",");b?a(c,m).show():a(c,m).hide()},setClampRect:function(a){l=a;q(k)},setRect:E,getInnerRect:function(){return{x:k.x-l.x,y:k.y-l.y,w:k.w,h:k.h}},setInnerRect:r,setViewPortRect:function(a){h=a;q(k)},destroy:function(){g.each(t,function(a){a.destroy()});t=[]}},f)}});h("tinymce.plugins.imagetools.ui.ImagePanel","global!document global!Image tinymce.core.geom.Rect tinymce.core.ui.Factory tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.core.LoadImage tinymce.plugins.imagetools.ui.CropRect".split(" "),
function(a,b,c,f,g,e,d,k){return{create:function(e){return new (f.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(e){var f=this,g=new b;g.src=e;d.loadImage(g).then(function(){var b,d=f.state.get("viewRect");b=f.$el.find("img");b[0]?b.replaceWith(g):
(b=a.createElement("div"),b.className="mce-imagepanel-bg",f.getEl().appendChild(b),f.getEl().appendChild(g));b={x:0,y:0,w:g.naturalWidth,h:g.naturalHeight};f.state.set("viewRect",b);f.state.set("rect",c.inflate(b,-20,-20));d&&d.w===b.w&&d.h===b.h||f.zoomFit();f.repaintImage();f.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var a,b,
c;a=this.$el.find("img");b=this.getEl().clientWidth;c=this.getEl().clientHeight;a=Math.min((b-10)/a[0].naturalWidth,(c-10)/a[0].naturalHeight);1<=a&&(a=1);this.zoom(a)},repaintImage:function(){var a,b,c,d,e,f,g,k,h,t;a=this.getEl();h=this.zoom();t=this.state.get("rect");g=this.$el.find("img");k=this.$el.find(".mce-imagepanel-bg");e=a.offsetWidth;f=a.offsetHeight;c=g[0].naturalWidth*h;d=g[0].naturalHeight*h;a=Math.max(0,e/2-c/2);b=Math.max(0,f/2-d/2);g.css({left:a,top:b,width:c,height:d});k.css({left:a,
top:b,width:c,height:d});this.cropRect&&(this.cropRect.setRect({x:t.x*h+a,y:t.y*h+b,w:t.w*h,h:t.h*h}),this.cropRect.setClampRect({x:a,y:b,w:c,h:d}),this.cropRect.setViewPortRect({x:0,y:0,w:e,h:f}))},bindStates:function(){function a(c){b.cropRect=new k(c,b.state.get("viewRect"),b.state.get("viewRect"),b.getEl(),function(){b.fire("crop")});b.cropRect.on("updateRect",function(a){a=a.rect;var c=b.zoom();a={x:Math.round(a.x/c),y:Math.round(a.y/c),w:Math.round(a.w/c),h:Math.round(a.h/c)};b.state.set("rect",
a)});b.on("remove",b.cropRect.destroy)}var b=this;b.state.on("change:cropEnabled",function(a){b.cropRect.toggleVisibility(a.value);b.repaintImage()});b.state.on("change:zoom",function(){b.repaintImage()});b.state.on("change:rect",function(c){c=c.value;b.cropRect||a(c);b.cropRect.setRect(c)})}}))(e)}}});h("tinymce.plugins.imagetools.ui.Dialog","ephox.imagetools.api.ImageTransformations ephox.imagetools.api.ResultConversions ephox.sand.api.URL global!Math global!setTimeout tinymce.core.dom.DOMUtils tinymce.core.ui.Factory tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.core.UndoStack tinymce.plugins.imagetools.ui.ImagePanel".split(" "),
function(a,b,c,f,g,e,d,h,u,l,m){function n(a){return{blob:a,url:c.createObjectURL(a)}}function p(a){a&&c.revokeObjectURL(a.url)}function q(c,h,k,q){function t(a){var b,c,d,e;b=y.find("#w")[0];c=y.find("#h")[0];d=parseInt(b.value(),10);e=parseInt(c.value(),10);y.find("#constrain")[0].checked()&&M&&N&&d&&e&&("w"===a.control.settings.name?(e=f.round(d*Y),c.value(e)):(d=f.round(e*Z),b.value(d)));M=d;N=e}function C(a){return f.round(100*a)+"%"}function w(){y.find("#undo").disabled(!G.canUndo());y.find("#redo").disabled(!G.canRedo());
y.statusbar.find("#save").disabled(!G.canUndo())}function x(){y.find("#undo").disabled(!0);y.find("#redo").disabled(!0)}function I(a){a&&D.imageSrc(a.url)}function A(a){return function(){var b=u.grep($,function(b){return b.settings.name!==a});u.each(b,function(a){a.hide()});a.show();a.focus()}}function W(a){B=n(a);I(B)}function R(a){h=n(a);I(h);a=G.add(h).removed;u.each(a,p);w()}function T(){var c=D.selection();b.blobToImageResult(h.blob).then(function(b){a.crop(b,c.x,c.y,c.w,c.h).then(P).then(function(a){R(a);
z()})})}function O(a){var c=[].slice.call(arguments,1);return function(){b.blobToImageResult((B||h).blob).then(function(b){a.apply(this,[b].concat(c)).then(P).then(W)})}}function X(a){var c=[].slice.call(arguments,1);return function(){b.blobToImageResult(h.blob).then(function(b){a.apply(this,[b].concat(c)).then(P).then(R)})}}function z(){I(h);p(B);A(S)();w()}function J(a,b){B?b():g(function(){0<a--?J(a,b):c.windowManager.alert("Error: failed to apply image operation.")},10)}function F(){B?(R(B.blob),
z()):J(100,F)}function K(a){return d.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:a})}function H(a,c){return K([{text:"Back",onclick:z},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:F}]).hide().on("show",function(){x();b.blobToImageResult(h.blob).then(function(a){return c(a)}).then(P).then(function(a){a=n(a);I(a);p(B);B=a})})}
function L(a,c,d,e,f){function g(a){b.blobToImageResult(h.blob).then(function(b){return c(b,a)}).then(P).then(function(a){a=n(a);I(a);p(B);B=a})}return K([{text:"Back",onclick:z},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){g(a.value)},minValue:e,maxValue:f,value:d,previewFilter:C},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:F}]).hide().on("show",function(){this.find("slider").value(d);x()})}var y,G=new l,S,U,B,aa,ba,ca,D,V,da,ea,fa,ga,ha,Q,ia,ja,ka,la,ma,
na,$,M,N,Y,Z,P=function(a){return a.toBlob()};aa=K([{text:"Back",onclick:z},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show hide",function(a){D.toggleCropRect("show"===a.type)}).on("show",x);ba=K([{text:"Back",onclick:z},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:t},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:t},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(a){!0===a.control.value()&&
(Y=N/M,Z=M/N)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(b){var c=parseInt(y.find("#w").value(),10),d=parseInt(y.find("#h").value(),10);b.preventDefault();X(a.resize,c,d)();z()}).on("show",x);ca=K([{text:"Back",onclick:z},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:O(a.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:O(a.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:O(a.rotate,
-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:O(a.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:F}]).hide().on("show",x);da=H("Invert",a.invert);ka=H("Sharpen",a.sharpen);la=H("Emboss",a.emboss);ea=L("Brightness",a.brightness,0,-1,1);fa=L("Hue",a.hue,180,0,360);ga=L("Saturate",a.saturate,0,-1,1);ha=L("Contrast",a.contrast,0,-1,1);Q=L("Grayscale",a.grayscale,0,0,1);ia=L("Sepia",a.sepia,0,0,1);ja=function(a,c){function d(){var a,e,f;a=y.find("#r")[0].value();
e=y.find("#g")[0].value();f=y.find("#b")[0].value();b.blobToImageResult(h.blob).then(function(b){return c(b,a,e,f)}).then(P).then(function(a){a=n(a);I(a);p(B);B=a})}return K([{text:"Back",onclick:z},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:d,previewFilter:C},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:d,previewFilter:C},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:d,previewFilter:C},
{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:F}]).hide().on("show",function(){y.find("#r,#g,#b").value(1);x()})}("Colorize",a.colorize);ma=L("Gamma",a.gamma,0,-1,1);na=L("Exposure",a.exposure,1,0,2);U=K([{text:"Back",onclick:z},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:A(fa)},{text:"saturate",icon:"saturate",onclick:A(ga)},{text:"sepia",icon:"sepia",onclick:A(ia)},{text:"emboss",icon:"emboss",onclick:A(la)},{text:"exposure",icon:"exposure",onclick:A(na)},{type:"spacer",
flex:1}]).hide();S=K([{tooltip:"Crop",icon:"crop",onclick:A(aa)},{tooltip:"Resize",icon:"resize2",onclick:A(ba)},{tooltip:"Orientation",icon:"orientation",onclick:A(ca)},{tooltip:"Brightness",icon:"sun",onclick:A(ea)},{tooltip:"Sharpen",icon:"sharpen",onclick:A(ka)},{tooltip:"Contrast",icon:"contrast",onclick:A(ha)},{tooltip:"Color levels",icon:"drop",onclick:A(ja)},{tooltip:"Gamma",icon:"gamma",onclick:A(ma)},{tooltip:"Invert",icon:"invert",onclick:A(da)}]);D=m.create({flex:1,imageSrc:h.url});V=
d.create("Container",{layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){h=G.undo();I(h);w()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){h=G.redo();I(h);w()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=D.zoom();2>a&&(a+=0.1);D.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=D.zoom();0.1<a&&(a-=0.1);D.zoom(a)}}]});
V=d.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[V,D]});$=[S,aa,ba,ca,U,da,ea,fa,ga,ha,Q,ia,ja,ka,la,ma,na];y=c.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:f.min(e.DOM.getViewPort().w,800),minHeight:f.min(e.DOM.getViewPort().h,650),title:"Edit image",items:$.concat([V]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){k(h.blob);y.close()}},{text:"Cancel",onclick:"close"}]});y.on("close",function(){q();
u.each(G.data,p);B=G=null});G.add(h);w();D.on("load",function(){M=D.imageSize().w;N=D.imageSize().h;Y=N/M;Z=M/N;y.find("#w").value(M);y.find("#h").value(N)});D.on("crop",T)}return{edit:function(a,b){return new h(function(c,d){return b.toBlob().then(function(b){q(a,n(b),c,d)})})}}});h("tinymce.plugins.imagetools.core.Actions","ephox.imagetools.api.BlobConversions ephox.imagetools.api.ImageTransformations ephox.imagetools.api.ResultConversions ephox.katamari.api.Fun ephox.sand.api.URL global!clearTimeout tinymce.core.util.Delay tinymce.core.util.Promise tinymce.core.util.Tools tinymce.core.util.URI tinymce.plugins.imagetools.api.Settings tinymce.plugins.imagetools.core.ImageSize tinymce.plugins.imagetools.core.Proxy tinymce.plugins.imagetools.ui.Dialog".split(" "),
function(a,b,c,f,g,e,d,h,u,l,m,n,p,q){var x=0,r=function(a,b){var c=b.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return c?a.dom.encode(c[1]):null},s=function(a,b){var c=b.src;return 0===c.indexOf("data:")||0===c.indexOf("blob:")||(new l(c)).host===a.documentBaseURI.host},v=function(b){var c;if(c=b.editorUpload.blobCache.getByUri(b.selection.getNode().src))return h.resolve(c.blob());var d=b.selection.getNode();c=d.src;-1!==u.inArray(b.settings.imagetools_cors_hosts,(new l(d.src)).host)?
b=p.getUrl(d.src,null):s(b,d)?b=a.imageToBlob(d):(c=m.getProxyUrl(b),c+=(-1===c.indexOf("?")?"?":"&")+"url="+encodeURIComponent(d.src),b=b.settings.api_key||b.settings.imagetools_api_key,b=p.getUrl(c,b));return b},t=function(a,b){var c=d.setEditorTimeout(a,function(){a.editorUpload.uploadImagesAuto()},a.settings.images_upload_timeout||3E4);b.set(c)},C=function(a){e(a.get())},w=function(a,b,c,d){return b.toBlob().then(function(e){var f,g,h,k,l;h=a.editorUpload.blobCache;l=a.selection.getNode();f=l.src;
a.settings.images_reuse_filename&&((k=h.getByUri(f))?(f=k.uri(),g=k.name()):g=r(a,f));k=h.create({id:"imagetools"+x++,blob:e,base64:b.toBase64(),uri:f,name:g});h.add(k);a.undoManager.transact(function(){function b(){a.$(l).off("load",b);a.nodeChanged();c?a.editorUpload.uploadImagesAuto():(C(d),t(a,d))}a.$(l).on("load",b);a.$(l).attr({src:k.blobUri()}).removeAttr("data-mce-src")});return k})},H=function(a,b,d){return function(){return a._scanForImages().then(f.curry(v,a)).then(c.blobToImageResult).then(d).then(function(c){return w(a,
c,!1,b)},function(b){a.notificationManager.open({text:b,type:"error"})})}};return{rotate:function(a,c,d){return function(){return H(a,c,function(c){var e=n.getImageSize(a.selection.getNode());e&&n.setImageSize(a.selection.getNode(),{w:e.h,h:e.w});return b.rotate(c,d)})()}},flip:function(a,c,d){return function(){return H(a,c,function(a){return b.flip(a,d)})()}},editImageDialog:function(b,d){return function(){var e=b.selection.getNode(),l=n.getNaturalImageSize(e),m=function(b){return new h(function(c){a.blobToImage(b).then(function(a){var d=
n.getNaturalImageSize(a);(l.w!==d.w||l.h!==d.h)&&n.getImageSize(e)&&n.setImageSize(e,d);g.revokeObjectURL(a.src);c(b)})})};v(b).then(c.blobToImageResult).then(f.curry(function(a,b){return q.edit(a,b).then(m).then(c.blobToImageResult).then(function(b){return w(a,b,!0,d)},function(){})},b),function(a){b.notificationManager.open({text:a,type:"error"})})}},isEditableImage:function(a,b){return a.dom.is(b,"img:not([data-mce-object],[data-mce-placeholder])")&&(s(a,b)||-1!==u.inArray(a.settings.imagetools_cors_hosts,
(new l(b.src)).host)||a.settings.imagetools_proxy)},cancelTimedUpload:C}});h("tinymce.plugins.imagetools.api.Commands",["tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Actions"],function(a,b){return{register:function(c,f){a.each({mceImageRotateLeft:b.rotate(c,f,-90),mceImageRotateRight:b.rotate(c,f,90),mceImageFlipVertical:b.flip(c,f,"v"),mceImageFlipHorizontal:b.flip(c,f,"h"),mceEditImage:b.editImageDialog(c,f)},function(a,b){c.addCommand(b,a)})}}});h("tinymce.plugins.imagetools.core.UploadSelectedImage",
["tinymce.plugins.imagetools.core.Actions"],function(a){return{setup:function(b,c,f){b.on("NodeChange",function(g){var e=f.get();e&&e.src!==g.element.src&&(a.cancelTimedUpload(c),b.editorUpload.uploadImagesAuto(),f.set(null));a.isEditableImage(b,g.element)&&f.set(g.element)})}}});h("tinymce.plugins.imagetools.ui.Buttons",[],function(){return{register:function(a){a.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"});a.addButton("rotateright",{title:"Rotate clockwise",
cmd:"mceImageRotateRight"});a.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"});a.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"});a.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"});a.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}}});h("tinymce.plugins.imagetools.ui.ContextToolbar",["ephox.katamari.api.Fun","tinymce.plugins.imagetools.api.Settings","tinymce.plugins.imagetools.core.Actions"],function(a,
b,c){return{register:function(f){f.addContextToolbar(a.curry(c.isEditableImage,f),b.getToolbarItems(f))}}});h("tinymce.plugins.imagetools.Plugin","ephox.katamari.api.Cell tinymce.core.PluginManager tinymce.plugins.imagetools.api.Commands tinymce.plugins.imagetools.core.UploadSelectedImage tinymce.plugins.imagetools.ui.Buttons tinymce.plugins.imagetools.ui.ContextToolbar".split(" "),function(a,b,c,f,g,e){b.add("imagetools",function(b){var h=a(0),u=a(null);c.register(b,h);g.register(b);e.register(b);
f.setup(b,h,u)});return function(){}});Q("tinymce.plugins.imagetools.Plugin")()})();
