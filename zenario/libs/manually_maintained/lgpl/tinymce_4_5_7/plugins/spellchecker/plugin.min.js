(function(s,C){function M(f,d){for(var a,p=[],h=0;h<f.length;++h){if(!(a=t[f[h]]))a:{a=s;for(var q=f[h].split(/[.\/]/),A=0;A<q.length;++A){if(!a[q[A]]){a=void 0;break a}a=a[q[A]]}}if(!a)throw"module definition dependecy not found: "+f[h];p.push(a)}d.apply(null,p)}function D(f,d,a){if("string"!==typeof f)throw"invalid module definition, module id must be defined and be a string";if(d===C)throw"invalid module definition, dependencies must be specified";if(a===C)throw"invalid module definition, definition function must be specified";
M(d,function(){t[f]=a.apply(null,arguments)})}var t={};D("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){function f(d){return d&&1==d.nodeType&&"false"===d.contentEditable}return function(d,a){function p(b,l){if(!b[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:b.index,end:b.index+b[0].length,text:b[0],data:l}}function h(b){var l;if(3===b.nodeType)return b.data;if(y[b.nodeName]&&!u[b.nodeName])return"";if(f(b))return"\n";l="";if(u[b.nodeName]||v[b.nodeName])l+=
"\n";if(b=b.firstChild){do l+=h(b);while(b=b.nextSibling)}return l}function q(b,l,c){var a,w,d,g,h=[],r=0,e=b,m,n=0;l=l.slice(0);l.sort(function(b,l){return b.start-l.start});m=l.shift();a:for(;;){(u[e.nodeName]||v[e.nodeName]||f(e))&&r++;3===e.nodeType&&(!w&&e.length+r>=m.end?(w=e,g=m.end-r):a&&h.push(e),!a&&e.length+r>m.start&&(a=e,d=m.start-r),r+=e.length);if(a&&w){if(e=c({startNode:a,startNodeIndex:d,endNode:w,endNodeIndex:g,innerNodes:h,match:m.text,matchIndex:n}),r-=w.length-g,w=a=null,h=[],
m=l.shift(),n++,!m)break}else if((!y[e.nodeName]||u[e.nodeName])&&e.firstChild){if(!f(e)){e=e.firstChild;continue}}else if(e.nextSibling){e=e.nextSibling;continue}for(;;)if(e.nextSibling){e=e.nextSibling;break}else if(e.parentNode!==b)e=e.parentNode;else break a}}function A(b){function l(l,c){var a=k[c];a.stencil||(a.stencil=b(a));a=a.stencil.cloneNode(!1);a.setAttribute("data-mce-index",c);l&&a.appendChild(G.doc.createTextNode(l));return a}return function(b){var c,a,d,g=b.startNode,h=b.endNode,f=
b.matchIndex;a=G.doc;if(g===h)return d=g.parentNode,0<b.startNodeIndex&&(c=a.createTextNode(g.data.substring(0,b.startNodeIndex)),d.insertBefore(c,g)),c=l(b.match,f),d.insertBefore(c,g),b.endNodeIndex<g.length&&(a=a.createTextNode(g.data.substring(b.endNodeIndex)),d.insertBefore(a,g)),g.parentNode.removeChild(g),c;c=a.createTextNode(g.data.substring(0,b.startNodeIndex));a=a.createTextNode(h.data.substring(b.endNodeIndex));var e=l(g.data.substring(b.startNodeIndex),f);d=[];for(var m=0,n=b.innerNodes.length;m<
n;++m){var k=b.innerNodes[m],p=l(k.data,f);k.parentNode.replaceChild(p,k);d.push(p)}b=l(h.data.substring(0,b.endNodeIndex),f);d=g.parentNode;d.insertBefore(c,g);d.insertBefore(e,g);d.removeChild(g);d=h.parentNode;d.insertBefore(b,h);d.insertBefore(a,h);d.removeChild(h);return b}}function s(b){var a=d.getElementsByTagName("*"),c=[];b="number"==typeof b?""+b:null;for(var h=0;h<a.length;h++){var f=a[h],k=f.getAttribute("data-mce-index");null!==k&&k.length&&(k!==b&&null!==b||c.push(f))}return c}function c(b){for(var a=
k.length;a--;)if(k[a]===b)return a;return-1}function t(b){for(var a=0,c=k.length;a<c&&!1!==b(k[a],a);a++);return this}function z(b){var a=s(b?c(b):null);for(b=a.length;b--;){var d=a[b];d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}return this}function H(b){b=s(c(b));var d=a.dom.createRng();d.setStartBefore(b[0]);d.setEndAfter(b[b.length-1]);return d}var I,k=[],x,G=a.dom,u,y,v;u=a.schema.getBlockElements();y=a.schema.getWhiteSpaceElements();v=a.schema.getShortEndedElements();
x=h(d);return{text:x,matches:k,each:t,filter:function(b){var a=[];t(function(c,d){b(c,d)&&a.push(c)});k=a;return this},reset:function(){k.splice(0,k.length);z();return this},matchFromElement:function(b){return k[b.getAttribute("data-mce-index")]},elementFromMatch:function(b){return s(c(b))[0]},find:function(b,a){if(x&&b.global)for(;I=b.exec(x);)k.push(p(I,a));return this},add:function(b,a,c){k.push({start:b,end:b+a,text:x.substr(b,a),data:c});return this},wrap:function(a){k.length&&q(d,k,A(a));return this},
unwrap:z,replace:function(b,c){var d=H(b);d.deleteContents();0<c.length&&d.insertNode(a.dom.doc.createTextNode(c));return d},rangeFromMatch:H,indexOf:c}}});D("tinymce/spellcheckerplugin/Plugin","tinymce/spellcheckerplugin/DomTextMatcher tinymce/PluginManager tinymce/util/Tools tinymce/ui/Menu tinymce/dom/DOMUtils tinymce/util/XHR tinymce/util/URI tinymce/util/JSON".split(" "),function(f,d,a,p,h,q,s,t){d.add("spellchecker",function(c,C){function z(){E.textMatcher||(E.textMatcher=new f(c.getBody(),
c));return E.textMatcher}function H(b,c){var d=[];a.each(c,function(a){d.push({selectable:!0,text:a.name,data:a.value})});return d}function I(a){for(var b in a)return!1;return!0}function k(d,e){var B=[];a.each(r[d],function(a){B.push({text:a,onclick:function(){c.insertContent(c.dom.encode(a));c.dom.remove(e);v()}})});B.push({text:"-"});L&&B.push({text:"Add to Dictionary",onclick:function(){b(d,e)}});B.push.apply(B,[{text:"Ignore",onclick:function(){l(d,e)}},{text:"Ignore all",onclick:function(){l(d,
e,!0)}}]);m=new p({items:B,context:"contextmenu",onautohide:function(a){-1!=a.target.className.indexOf("spellchecker")&&a.preventDefault()},onhide:function(){m.remove();m=null}});m.renderTo(document.body);var f=h.DOM.getPos(c.getContentAreaContainer()),g=c.dom.getPos(e[0]),k=c.dom.getRoot();"BODY"==k.nodeName?(g.x-=k.ownerDocument.documentElement.scrollLeft||k.scrollLeft,g.y-=k.ownerDocument.documentElement.scrollTop||k.scrollTop):(g.x-=k.scrollLeft,g.y-=k.scrollTop);f.x+=g.x;f.y+=g.y;m.moveTo(f.x,
f.y+e[0].offsetHeight)}function x(){return c.getParam("spellchecker_wordchar_pattern")||RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009]+',"g")}function G(b,d,e,g){var h={method:b,lang:n.spellchecker_language},f="";h["addToDictionary"==b?"word":"text"]=d;a.each(h,function(a,b){f&&(f+="&");f+=b+"="+encodeURIComponent(a)});q.send({url:(new s(C)).toAbsolute(n.spellchecker_rpc_url),
type:"post",content_type:"application/x-www-form-urlencoded",data:f,success:function(a){(a=t.parse(a))?a.error?g(a.error):e(a):(a=c.translate("Server response wasn't proper JSON."),g(a))},error:function(){var a=c.translate("The spelling service was not found: (")+n.spellchecker_rpc_url+c.translate(")");g(a)}})}function u(a,b,c,d){(n.spellchecker_callback||G).call(E,a,b,c,d)}function y(){function a(b){c.notificationManager.open({text:b,type:"error"});c.setProgressState(!1);J()}J()||(c.setProgressState(!0),
u("spellcheck",z().text,K,a),c.focus())}function v(){c.dom.select("span.mce-spellchecker-word").length||J()}function b(a,b){c.setProgressState(!0);u("addToDictionary",a,function(){c.setProgressState(!1);c.dom.remove(b,!0);v()},function(a){c.notificationManager.open({text:a,type:"error"});c.setProgressState(!1)})}function l(b,d,e){c.selection.collapse();e?a.each(c.dom.select("span.mce-spellchecker-word"),function(a){a.getAttribute("data-mce-word")==b&&c.dom.remove(a,!0)}):c.dom.remove(d,!0);v()}function J(){z().reset();
E.textMatcher=null;if(e)return e=!1,c.fire("SpellcheckEnd"),!0}function D(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function w(a){var b=n.spellchecker_language;a.control.items().each(function(a){a.active(a.settings.data===b)})}function K(a){var b;a.words?(L=!!a.dictionary,b=a.words):b=a;c.setProgressState(!1);I(b)?(a=c.translate("No misspellings found."),c.notificationManager.open({text:a,type:"info"}),e=!1):(r=b,z().find(x()).filter(function(a){return!!b[a.text]}).wrap(function(a){return c.dom.create("span",
{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":a.text})}),e=!0,c.fire("SpellcheckStart"))}var g,E=this,r,e,m,n=c.settings,L;if(/(^|[ ,])tinymcespellchecker([, ]|$)/.test(n.plugins)&&d.get("tinymcespellchecker"))"undefined"!==typeof console&&console.log&&console.log("Spell Checker Pro is incompatible with Spell Checker plugin! Remove 'spellchecker' from the 'plugins' option.");else{g=H("Language",a.map((n.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),
function(a){a=a.split("=");return{name:a[0],value:a[1]}}));c.on("click",function(b){var d=b.target;if("mce-spellchecker-word"==d.className){b.preventDefault();var e=D(d),f;b=[];f=a.toArray(c.getBody().getElementsByTagName("span"));if(f.length)for(var g=0;g<f.length;g++){var h=D(f[g]);null!==h&&h.length&&h===e.toString()&&b.push(f[g])}0<b.length&&(e=c.dom.createRng(),e.setStartBefore(b[0]),e.setEndAfter(b[b.length-1]),c.selection.setRng(e),k(d.getAttribute("data-mce-word"),b))}});c.addMenuItem("spellchecker",
{text:"Spellcheck",context:"tools",onclick:y,selectable:!0,onPostRender:function(){var a=this;a.active(e);c.on("SpellcheckStart SpellcheckEnd",function(){a.active(e)})}});var F={tooltip:"Spellcheck",onclick:y,onPostRender:function(){var a=this;c.on("SpellcheckStart SpellcheckEnd",function(){a.active(e)})}};1<g.length&&(F.type="splitbutton",F.menu=g,F.onshow=w,F.onselect=function(a){n.spellchecker_language=a.control.settings.data});c.addButton("spellchecker",F);c.addCommand("mceSpellCheck",y);c.on("remove",
function(){m&&(m.remove(),m=null)});c.on("change",v);this.getTextMatcher=z;this.getWordCharPattern=x;this.markErrors=K;this.getLanguage=function(){return n.spellchecker_language};n.spellchecker_language=n.spellchecker_language||n.language||"en"}})});(function(f){var d,a,p,h;for(d=0;d<f.length;d++){a=s;p=f[d];h=p.split(/[.\/]/);for(var q=0;q<h.length-1;++q)a[h[q]]===C&&(a[h[q]]={}),a=a[h[q]];a[h[h.length-1]]=t[p]}if(s.AMDLC_TESTS){a=s.privateModules||{};for(p in t)a[p]=t[p];for(d=0;d<f.length;d++)delete a[f[d]];
s.privateModules=a}})(["tinymce/spellcheckerplugin/DomTextMatcher"])})(window);
