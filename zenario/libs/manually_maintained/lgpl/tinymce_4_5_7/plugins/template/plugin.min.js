tinymce.PluginManager.add("template",function(b){function k(a){return function(){var c=b.settings.templates;"function"==typeof c?c(a):"string"==typeof c?tinymce.util.XHR.send({url:c,success:function(b){a(tinymce.util.JSON.parse(b))}}):a(c)}}function m(a){function c(a){function c(a){if(-1==a.indexOf("<html>")){var d="";tinymce.each(b.contentCSS,function(a){d+='<link type="text/css" rel="stylesheet" href="'+b.documentBaseURI.toAbsolute(a)+'">'});var f=b.settings.body_class||"";-1!=f.indexOf("=")&&(f=
b.getParam("body_class","","hash"),f=f[b.id]||"");a="<!DOCTYPE html><html><head>"+d+'</head><body class="'+f+'">'+a+"</body></html>"}a=n(a,"template_preview_replace_values");f=e.find("iframe")[0].getEl().contentWindow.document;f.open();f.write(a);f.close()}var d=a.control.value();d.url?tinymce.util.XHR.send({url:d.url,success:function(a){g=a;c(g)}}):(g=d.content,c(g));e.find("#description")[0].text(a.control.value().description)}var e,d=[],g;a&&0!==a.length?(tinymce.each(a,function(a){d.push({selected:!d.length,
text:a.title,value:{url:a.url,content:a.content,description:a.description}})}),e=b.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:d,onselect:c}}]},{type:"label",name:"description",label:"Description",text:"\u00a0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){p(!1,g)},minWidth:Math.min(tinymce.DOM.getViewPort().w,
b.getParam("template_popup_width",600)),minHeight:Math.min(tinymce.DOM.getViewPort().h,b.getParam("template_popup_height",500))}),e.find("listbox")[0].fire("select")):(a=b.translate("No templates defined."),b.notificationManager.open({text:a,type:"info"}))}function l(a,c){function e(a,c){a=""+a;if(a.length<c)for(var b=0;b<c-a.length;b++)a="0"+a;return a}c=c||new Date;a=a.replace("%D","%m/%d/%Y");a=a.replace("%r","%I:%M:%S %p");a=a.replace("%Y",""+c.getFullYear());a=a.replace("%y",""+c.getYear());
a=a.replace("%m",e(c.getMonth()+1,2));a=a.replace("%d",e(c.getDate(),2));a=a.replace("%H",""+e(c.getHours(),2));a=a.replace("%M",""+e(c.getMinutes(),2));a=a.replace("%S",""+e(c.getSeconds(),2));a=a.replace("%I",""+((c.getHours()+11)%12+1));a=a.replace("%p",""+(12>c.getHours()?"AM":"PM"));a=a.replace("%B",""+b.translate("January February March April May June July August September October November December".split(" ")[c.getMonth()]));a=a.replace("%b",""+b.translate("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[c.getMonth()]));
a=a.replace("%A",""+b.translate("Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ")[c.getDay()]));a=a.replace("%a",""+b.translate("Sun Mon Tue Wed Thu Fri Sat Sun".split(" ")[c.getDay()]));return a=a.replace("%%","%")}function q(a){var c=b.dom,e=b.getParam("template_replace_values");h(c.select("*",a),function(a){h(e,function(b,f){if(c.hasClass(a,f)&&"function"==typeof e[f])e[f](a)})})}function n(a,c){h(b.getParam(c),function(b,c){"function"==typeof b&&(b=b(c));a=a.replace(RegExp("\\{\\$"+
c+"\\}","g"),b)});return a}function p(a,c){function e(a,b){return RegExp("\\b"+b+"\\b","g").test(a.className)}var d,g,f=b.dom,k=b.selection.getContent();c=n(c,"template_replace_values");d=f.create("div",null,c);(g=f.select(".mceTmpl",d))&&0<g.length&&(d=f.create("div",null),d.appendChild(g[0].cloneNode(!0)));h(f.select("*",d),function(a){e(a,b.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(b.getParam("template_cdate_format",b.getLang("template.cdate_format"))));e(a,
b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(b.getParam("template_mdate_format",b.getLang("template.mdate_format"))));e(a,b.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(a.innerHTML=k)});q(d);b.execCommand("mceInsertContent",!1,d.innerHTML);b.addVisual()}var h=tinymce.each;b.addCommand("mceInsertTemplate",p);b.addButton("template",{title:"Insert template",onclick:k(m)});b.addMenuItem("template",{text:"Template",onclick:k(m),
context:"insert"});b.on("PreProcess",function(a){var c=b.dom;h(c.select("div",a.node),function(a){c.hasClass(a,"mceTmpl")&&(h(c.select("*",a),function(a){c.hasClass(a,b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(b.getParam("template_mdate_format",b.getLang("template.mdate_format"))))}),q(a))})})});
