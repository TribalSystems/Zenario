(function(){var s={},v=function(d){var k=s[d];if(void 0===k)throw"module ["+d+"] was undefined";if(void 0===k.instance){for(var l=s[d],g=l.deps,m=l.defn,b=g.length,e=Array(b),f=0;f<b;++f)e[f]=v(g[f]);g=m.apply(null,e);if(void 0===g)throw"module ["+d+"] returned undefined";l.instance=g}return k.instance},p=function(d,k,l){if("string"!==typeof d)throw"module id must be a string";if(void 0===k)throw"no dependencies for "+d;if(void 0===l)throw"no definition function for "+d;s[d]={deps:k,defn:l,instance:void 0}},
q=function(d,k){p(d,[],function(){return k})};q("global!tinymce.PluginManager",tinymce.PluginManager);q("global!tinymce.util.Delay",tinymce.util.Delay);q("global!tinymce.util.Tools",tinymce.util.Tools);q("global!tinymce.html.SaxParser",tinymce.html.SaxParser);q("global!tinymce.html.Schema",tinymce.html.Schema);q("global!tinymce.dom.DOMUtils.DOM",tinymce.dom.DOMUtils.DOM);p("tinymce.media.core.VideoScript",[],function(){return{getVideoScriptMatch:function(d,k){if(d)for(var l=0;l<d.length;l++)if(-1!==
k.indexOf(d[l].filter))return d[l]}}});p("tinymce.media.core.Size",[],function(){var d=function(d){return function(g){return g?g.style[d].replace(/px$/,""):""}},k=function(d){return function(g,m){g&&(g.style[d]=/^[0-9.]+$/.test(m)?m+"px":m)}};return{getMaxWidth:d("maxWidth"),getMaxHeight:d("maxHeight"),setMaxWidth:k("maxWidth"),setMaxHeight:k("maxHeight")}});p("tinymce.media.core.HtmlToData","global!tinymce.util.Tools global!tinymce.html.SaxParser global!tinymce.html.Schema global!tinymce.dom.DOMUtils.DOM tinymce.media.core.VideoScript tinymce.media.core.Size".split(" "),
function(d,k,l,g,m,b){var e=function(b,c){var a={};(new k({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(c,h){a.source1||"param"!==c||(a.source1=h.map.movie);if("iframe"===c||"object"===c||"embed"===c||"video"===c||"audio"===c)a.type||(a.type=c),a=d.extend(h.map,a);if("script"===c){var e=m.getVideoScriptMatch(b,h.map.src);if(!e)return;a={type:"script",source1:h.map.src,width:e.width,height:e.height}}"source"===c&&(a.source1?a.source2||(a.source2=h.map.src):a.source1=
h.map.src);"img"!==c||a.poster||(a.poster=h.map.src)}})).parse(c);a.source1=a.source1||a.src||a.data;a.source2=a.source2||"";a.poster=a.poster||"";return a};return{htmlToData:function(f,c){var a=g.createFragment(c);""!==g.getAttrib(a.firstChild,"data-ephox-embed-iri")?(a=g.createFragment(c).firstChild,a={type:"ephox-embed-iri",source1:g.getAttrib(a,"data-ephox-embed-iri"),source2:"",poster:"",width:b.getMaxWidth(a),height:b.getMaxHeight(a)}):a=e(f,c);return a}}});q("global!tinymce.html.Writer",tinymce.html.Writer);
p("tinymce.media.core.UpdateHtml",["global!tinymce.html.Writer","global!tinymce.html.SaxParser","global!tinymce.html.Schema","global!tinymce.dom.DOMUtils.DOM","tinymce.media.core.Size"],function(d,k,l,g,m){var b=function(b,c){var a,e,h,r;for(a in c)if(h=""+c[a],b.map[a])for(e=b.length;e--;)r=b[e],r.name===a&&(h?(b.map[a]=h,r.value=h):(delete b.map[a],b.splice(e,1)));else h&&(b.push({name:a,value:h}),b.map[a]=h)},e=function(e,c,a){var n=new d,h=0,r;(new k({validate:!1,allow_conditional_comments:!0,
special:"script,noscript",comment:function(a){n.comment(a)},cdata:function(a){n.cdata(a)},text:function(a,c){n.text(a,c)},start:function(e,f,d){switch(e){case "video":case "object":case "embed":case "img":case "iframe":b(f,{width:c.width,height:c.height})}if(a)switch(e){case "video":b(f,{poster:c.poster,src:""});c.source2&&b(f,{src:""});break;case "iframe":b(f,{src:c.source1});break;case "source":h++;if(2>=h&&(b(f,{src:c["source"+h],type:c["source"+h+"mime"]}),!c["source"+h]))return;break;case "img":if(!c.poster)return;
r=!0}n.start(e,f,d)},end:function(e){if("video"===e&&a)for(var f=1;2>=f;f++)if(c["source"+f]){var d=[];d.map={};h<f&&(b(d,{src:c["source"+f],type:c["source"+f+"mime"]}),n.start("source",d,!0))}c.poster&&"object"===e&&a&&!r&&(f=[],f.map={},b(f,{src:c.poster,width:c.width,height:c.height}),n.start("img",f,!0));n.end(e)}},new l({}))).parse(e);return n.getContent()};return{updateHtml:function(b,c,a){var n=g.createFragment(b);""!==g.getAttrib(n.firstChild,"data-ephox-embed-iri")?(b=g.createFragment(b).firstChild,
m.setMaxWidth(b,c.width),m.setMaxHeight(b,c.height),c=b.outerHTML,b=new d,(new k(b)).parse(c),c=b.getContent()):c=e(b,c,a);return c}}});p("tinymce.media.core.Mime",[],function(){return{guess:function(d){return(d={mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[d.toLowerCase().split(".").pop()])?d:""}}});p("tinymce.media.core.UrlPatterns",[],function(){return{urlPatterns:[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,
url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",
w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0}]}});p("tinymce.media.core.DataToHtml","tinymce.media.core.Mime tinymce.media.core.HtmlToData tinymce.media.core.UrlPatterns tinymce.media.core.VideoScript tinymce.media.core.UpdateHtml global!tinymce.util.Tools".split(" "),
function(d,k,l,g,m,b){return{dataToHtml:function(e,f){var c="",a=b.extend({},f);if(!a.source1&&(b.extend(a,k.htmlToData(e.settings.media_scripts,a.embed)),!a.source1))return"";a.source2||(a.source2="");a.poster||(a.poster="");a.source1=e.convertURL(a.source1,"source");a.source2=e.convertURL(a.source2,"source");a.source1mime=d.guess(a.source1);a.source2mime=d.guess(a.source2);a.poster=e.convertURL(a.poster,"poster");b.each(l.urlPatterns,function(c){var b,e,f=c.regex.exec(a.source1);if(f){e=c.url;for(b=
0;f[b];b++)e=e.replace("$"+b,function(){return f[b]});a.source1=e;a.type=c.type;a.allowFullscreen=c.allowFullscreen;a.width=a.width||c.w;a.height=a.height||c.h}});if(a.embed)c=m.updateHtml(a.embed,a,!0);else{var n=g.getVideoScriptMatch(e.settings.media_scripts,a.source1);n&&(a.type="script",a.width=n.width,a.height=n.height);a.width=a.width||300;a.height=a.height||150;b.each(a,function(c,b){a[b]=e.dom.encode(c)});"iframe"===a.type?c+='<iframe src="'+a.source1+'" width="'+a.width+'" height="'+a.height+
'"'+(a.allowFullscreen?' allowFullscreen="1"':"")+"></iframe>":"application/x-shockwave-flash"===a.source1mime?(c+='<object data="'+a.source1+'" width="'+a.width+'" height="'+a.height+'" type="application/x-shockwave-flash">',a.poster&&(c+='<img src="'+a.poster+'" width="'+a.width+'" height="'+a.height+'" />'),c+="</object>"):c=-1!==a.source1mime.indexOf("audio")?e.settings.audio_template_callback?e.settings.audio_template_callback(a):c+('<audio controls="controls" src="'+a.source1+'">'+(a.source2?
'\n<source src="'+a.source2+'"'+(a.source2mime?' type="'+a.source2mime+'"':"")+" />\n":"")+"</audio>"):"script"===a.type?c+('<script src="'+a.source1+'">\x3c/script>'):e.settings.video_template_callback?e.settings.video_template_callback(a):'<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source1+'"'+(a.source1mime?' type="'+a.source1mime+'"':"")+" />\n"+(a.source2?'<source src="'+a.source2+'"'+(a.source2mime?' type="'+
a.source2mime+'"':"")+" />\n":"")+"</video>"}return c}}});q("global!tinymce.util.Promise",tinymce.util.Promise);p("tinymce.media.core.Service",["tinymce.media.core.DataToHtml","global!tinymce.util.Promise"],function(d,k){var l=function(b,e,f){var c={};return new k(function(a,d){var h=function(h){h.html&&(c[b.source1]=h);return a({url:b.source1,html:h.html?h.html:e(b)})};c[b.source1]?h(c[b.source1]):f({url:b.source1},h,d)})},g=function(b,e){return new k(function(f){f({html:e(b),url:b.source1})})},
m=function(b){return function(e){return d.dataToHtml(b,e)}};return{getEmbedHtml:function(b,e){var f=b.settings.media_url_resolver;return f?l(e,m(b),f):g(e,m(b))}}});q("global!tinymce.Env",tinymce.Env);p("tinymce.media.ui.SizeManager",[],function(){var d=function(d,b){d.state.set("oldVal",d.value());b.state.set("oldVal",b.value())},k=function(d,b){var e=d.find("#width")[0],f=d.find("#height")[0],c=d.find("#constrain")[0];e&&f&&c&&b(e,f,c.checked())},l=function(g,b,e){var f=g.state.get("oldVal"),c=
b.state.get("oldVal"),a=g.value(),n=b.value();e&&f&&c&&a&&n&&(a!==f?(n=Math.round(a/f*n),isNaN(n)||b.value(n)):(a=Math.round(n/c*a),isNaN(a)||g.value(a)));d(g,b)},g=function(d){k(d,l)};return{createUi:function(d){var b=function(){d(function(b){g(b)})};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:b,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:b,
ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},syncSize:function(g){k(g,d)},updateSize:g}});p("tinymce.media.ui.Dialog","global!tinymce.util.Delay tinymce.media.core.HtmlToData tinymce.media.core.UpdateHtml tinymce.media.core.Service tinymce.media.core.Size global!tinymce.util.Tools global!tinymce.Env tinymce.media.ui.SizeManager".split(" "),function(d,k,l,g,m,b,e,f){var c=e.ie&&8>=e.ie?"onChange":"onInput",a=function(a){return function(c){a.notificationManager.open({type:"error",
text:c&&c.msg?"Media embed handler error: "+c.msg:"Media embed handler threw unknown error."})}},n=function(a){var c=a.selection.getNode(),b=c.getAttribute("data-ephox-embed-iri");return b?{source1:b,"data-ephox-embed-iri":b,width:m.getMaxWidth(c),height:m.getMaxHeight(c)}:c.getAttribute("data-mce-object")?k.htmlToData(a.settings.media_scripts,a.serializer.serialize(c,{selection:!0})):{}},h=function(a){var c=a.selection.getNode();if(c.getAttribute("data-mce-object")||c.getAttribute("data-ephox-embed-iri"))return a.selection.getContent()},
r=function(a,c){return function(e){var h=e.html,d=a.find("#embed")[0];e=b.extend(k.htmlToData(c.settings.media_scripts,h),{source1:e.url});a.fromJSON(e);d&&(d.value(h),f.updateSize(a))}},u=function(a,c){var b=a.dom.select("img[data-mce-object]");a.insertContent(c);var e,h,f=a.dom.select("img[data-mce-object]");for(e=0;e<b.length;e++)for(h=f.length-1;0<=h;h--)b[e]===f[h]&&f.splice(h,1);a.selection.select(f[0]);a.nodeChanged()},p=function(c,b){var e=c.toJSON();e.embed=l.updateHtml(e.embed,e);if(e.embed)u(b,
e.embed);else g.getEmbedHtml(b,e).then(function(a){u(b,a.html)})["catch"](a(b))},q=function(a,c){b.each(c,function(c,b){a.find("#"+b).value(c)})};return{showDialog:function(e){var d,m,u=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source",onpaste:function(){setTimeout(function(){g.getEmbedHtml(e,d.toJSON()).then(r(d,e))["catch"](a(e))},1)},onchange:function(c){g.getEmbedHtml(e,d.toJSON()).then(r(d,e))["catch"](a(e));q(d,c.meta)},onbeforecall:function(a){a.meta=d.toJSON()}}],
s=[],t=function(a){a(d);m=d.toJSON();d.find("#embed").value(l.updateHtml(m.embed,m))};!1!==e.settings.media_alt_source&&s.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"});!1!==e.settings.media_poster&&s.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"});!1!==e.settings.media_dimensions&&(t=f.createUi(t),u.push(t));m=n(e);t={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:h(e),multiline:!0,rows:5,label:"Source"};
t[c]=function(){m=b.extend({},k.htmlToData(e.settings.media_scripts,this.value()));this.parent().parent().fromJSON(m)};d=e.windowManager.open({title:"Insert/edit media",data:m,bodyType:"tabpanel",body:[{title:"General",type:"form",items:u},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},t]},{title:"Advanced",type:"form",items:s}],onSubmit:function(){f.updateSize(d);
p(d,e)}});f.syncSize(d)}}});p("tinymce.media.core.Sanitize",["global!tinymce.util.Tools","global!tinymce.html.Writer","global!tinymce.html.SaxParser","global!tinymce.html.Schema"],function(d,k,l,g){return{sanitize:function(d,b){if(!1===d.settings.media_filter_html)return b;var e=new k,f;(new l({validate:!1,allow_conditional_comments:!1,special:"script,noscript",comment:function(c){e.comment(c)},cdata:function(c){e.cdata(c)},text:function(c,a){e.text(c,a)},start:function(c,a,b){f=!0;if("script"!==
c&&"noscript"!==c){for(var h=0;h<a.length;h++){if(0===a[h].name.indexOf("on"))return;"style"===a[h].name&&(a[h].value=d.dom.serializeStyle(d.dom.parseStyle(a[h].value),c))}e.start(c,a,b);f=!1}},end:function(c){f||e.end(c)}},new g({}))).parse(b);return e.getContent()}}});q("global!tinymce.html.Node",tinymce.html.Node);p("tinymce.media.core.Nodes",["tinymce.media.core.Sanitize","tinymce.media.core.VideoScript","global!tinymce.html.Node","global!tinymce.Env"],function(d,k,l,g){var m=function(c,a){var b,
h=a.name;b=new l("img",1);b.shortEnded=!0;e(c,a,b);b.attr({width:a.attr("width")||"300",height:a.attr("height")||("audio"===h?"30":"150"),style:a.attr("style"),src:g.transparentSrc,"data-mce-object":h,"class":"mce-object mce-object-"+h});return b},b=function(c,a){var b,h,d;d=a.name;b=new l("span",1);b.attr({contentEditable:"false",style:a.attr("style"),"data-mce-object":d,"class":"mce-preview-object mce-object-"+d});e(c,a,b);h=new l(d,1);h.attr({src:a.attr("src"),allowfullscreen:a.attr("allowfullscreen"),
width:a.attr("width")||"300",height:a.attr("height")||("audio"===d?"30":"150"),frameborder:"0"});d=new l("span",1);d.attr("class","mce-shim");b.append(h);b.append(d);return b},e=function(c,a,b){var e,f,g,k;g=a.attributes;for(k=g.length;k--;)if(e=g[k].name,f=g[k].value,"width"!==e&&"height"!==e&&"style"!==e){if("data"===e||"src"===e)f=c.convertURL(f,e);b.attr("data-mce-p-"+e,f)}if(a=a.firstChild&&a.firstChild.value)b.attr("data-mce-html",escape(d.sanitize(c,a))),b.firstChild=null},f=function(c){for(;c=
c.parent;)if(c.attr("data-ephox-embed-iri"))return!0;return!1};return{createPreviewIframeNode:b,createPlaceholderNode:m,placeHolderConverter:function(c){return function(a){for(var e=a.length,d,l;e--;)if(d=a[e],d.parent&&!d.parent.attr("data-mce-object")){if("script"===d.name&&(l=k.getVideoScriptMatch(c.settings.media_scripts,d.attr("src")),!l))continue;l&&(l.width&&d.attr("width",l.width.toString()),l.height&&d.attr("height",l.height.toString()));"iframe"===d.name&&!1!==c.settings.media_live_embeds&&
g.ceFalse?f(d)||d.replace(b(c,d)):f(d)||d.replace(m(c,d))}}}}});p("tinymce.media.Plugin",["global!tinymce.PluginManager","tinymce.media.ui.Dialog","tinymce.media.core.Sanitize","tinymce.media.core.UpdateHtml","tinymce.media.core.Nodes"],function(d,k,l,g,m){d.add("media",function(b){b.on("ResolveName",function(b){var d;1===b.target.nodeType&&(d=b.target.getAttribute("data-mce-object"))&&(b.name=d)});b.on("preInit",function(){var e=b.schema.getSpecialElements();tinymce.each(["video","audio","iframe",
"object"],function(c){e[c]=RegExp("</"+c+"[^>]*>","gi")});var d=b.schema.getBoolAttrs();tinymce.each(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"],function(c){d[c]={}});b.parser.addNodeFilter("iframe,video,audio,object,embed,script",m.placeHolderConverter(b));b.serializer.addAttributeFilter("data-mce-object",function(c,a){for(var e=c.length,d,f,g,k,m;e--;)if(d=c[e],d.parent){m=d.attr(a);f=new tinymce.html.Node(m,1);"audio"!==m&&"script"!==m&&((g=d.attr("class"))&&-1!==g.indexOf("mce-preview-object")?
f.attr({width:d.firstChild.attr("width"),height:d.firstChild.attr("height")}):f.attr({width:d.attr("width"),height:d.attr("height")}));f.attr({style:d.attr("style")});k=d.attributes;for(g=k.length;g--;){var p=k[g].name;0===p.indexOf("data-mce-p-")&&f.attr(p.substr(11),k[g].value)}"script"===m&&f.attr("type","text/javascript");if(m=d.attr("data-mce-html"))g=new tinymce.html.Node("#text",3),g.raw=!0,g.value=l.sanitize(b,unescape(m)),f.append(g);d.replace(f)}})});b.on("click keyup",function(){var e=
b.selection.getNode();e&&b.dom.hasClass(e,"mce-preview-object")&&b.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")});b.on("ObjectSelected",function(b){var d=b.target.getAttribute("data-mce-object");"audio"!==d&&"script"!==d||b.preventDefault()});b.on("objectResized",function(b){var d=b.target,c;d.getAttribute("data-mce-object")&&(c=d.getAttribute("data-mce-html"))&&(c=unescape(c),d.setAttribute("data-mce-html",escape(g.updateHtml(c,{width:b.width,height:b.height}))))});
this.showDialog=function(){k.showDialog(b)};b.addButton("media",{tooltip:"Insert/edit media",onclick:this.showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"]});b.addMenuItem("media",{icon:"media",text:"Media",onclick:this.showDialog,context:"insert",prependToContext:!0});b.on("setContent",function(){b.$("span.mce-preview-object").each(function(d,f){var c=b.$(f);0===c.find("span.mce-shim",f).length&&c.append('<span class="mce-shim"></span>')})});b.addCommand("mceMedia",
this.showDialog)});return function(){}});v("tinymce.media.Plugin")()})();
