(function(){var q={},k=function(a,c,b){if("string"!==typeof a)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+a;if(void 0===b)throw"no definition function for "+a;q[a]={deps:c,defn:b,instance:void 0}},r=function(a){var c=q[a];if(void 0===c)throw"module ["+a+"] was undefined";if(void 0===c.instance){for(var b=q[a],d=b.deps,f=b.defn,g=d.length,m=Array(g),l=0;l<g;++l)m[l]=r(d[l]);d=f.apply(null,m);if(void 0===d)throw"module ["+a+"] returned undefined";b.instance=d}return c.instance},
p=function(a,c){k(a,[],function(){return c})};k("ephox.katamari.api.Cell",[],function(){var a=function(c){var b=c;return{get:function(){return b},set:function(d){b=d},clone:function(){return a(b)}}};return a});p("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);k("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});p("global!setInterval",setInterval);k("tinymce.core.util.LocalStorage",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.util.LocalStorage")});k("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Tools")});k("tinymce.plugins.autosave.api.Events",[],function(){return{fireRestoreDraft:function(a){return a.fire("RestoreDraft")},fireStoreDraft:function(a){return a.fire("StoreDraft")},fireRemoveDraft:function(a){return a.fire("RemoveDraft")}}});p("global!document",document);k("tinymce.plugins.autosave.core.Time",[],function(){return{parse:function(a,
c){var b={s:1E3,m:6E4};a=/^(\d+)([ms]?)$/.exec(""+(a||c));return(a[2]?b[a[2]]:1)*parseInt(a,10)}}});k("tinymce.plugins.autosave.api.Settings",["global!document","tinymce.plugins.autosave.core.Time"],function(a,c){return{shouldAskBeforeUnload:function(b){return b.getParam("autosave_ask_before_unload",!0)},getAutoSavePrefix:function(b){var d=b.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-");d=d.replace(/\{path\}/g,a.location.pathname);d=d.replace(/\{query\}/g,a.location.search);
d=d.replace(/\{hash\}/g,a.location.hash);return d=d.replace(/\{id\}/g,b.id)},shouldRestoreWhenEmpty:function(b){return b.getParam("autosave_restore_when_empty",!1)},getAutoSaveInterval:function(b){return c.parse(b.settings.autosave_interval,"30s")},getAutoSaveRetention:function(b){return c.parse(b.settings.autosave_retention,"20m")}}});k("tinymce.plugins.autosave.core.Storage",["global!setInterval","tinymce.core.util.LocalStorage","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Events","tinymce.plugins.autosave.api.Settings"],
function(a,c,b,d,f){var g=function(e,h){var n=e.settings.forced_root_block;h=b.trim("undefined"===typeof h?e.getBody().innerHTML:h);return""===h||(new RegExp("^<"+n+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+n+">|<br>$","i")).test(h)},m=function(e){var h=parseInt(c.getItem(f.getAutoSavePrefix(e)+"time"),10)||0;return(new Date).getTime()-h>f.getAutoSaveRetention(e)?(l(e,!1),!1):!0},l=function(e,h){var n=f.getAutoSavePrefix(e);c.removeItem(n+"draft");c.removeItem(n+"time");!1!==h&&d.fireRemoveDraft(e)},
t=function(e){var h=f.getAutoSavePrefix(e);!g(e)&&e.isDirty()&&(c.setItem(h+"draft",e.getContent({format:"raw",no_events:!0})),c.setItem(h+"time",(new Date).getTime()),d.fireStoreDraft(e))},u=function(e){var h=f.getAutoSavePrefix(e);m(e)&&(e.setContent(c.getItem(h+"draft"),{format:"raw"}),d.fireRestoreDraft(e))};return{isEmpty:g,hasDraft:m,removeDraft:l,storeDraft:t,restoreDraft:u,startStoreDraft:function(e,h){var n=f.getAutoSaveInterval(e);h.get()||(a(function(){e.removed||t(e)},n),h.set(!0))},restoreLastDraft:function(e){e.undoManager.transact(function(){u(e);
l(e)});e.focus()}}});k("tinymce.plugins.autosave.api.Api",["tinymce.plugins.autosave.core.Storage"],function(a){var c=function(b,d){return function(){var f=Array.prototype.slice.call(arguments);return b.apply(null,[d].concat(f))}};return{get:function(b){return{hasDraft:c(a.hasDraft,b),storeDraft:c(a.storeDraft,b),restoreDraft:c(a.restoreDraft,b),removeDraft:c(a.removeDraft,b),isEmpty:c(a.isEmpty,b)}}}});p("global!window",window);k("tinymce.core.EditorManager",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.EditorManager")});k("tinymce.plugins.autosave.core.BeforeUnload",["global!window","tinymce.core.EditorManager","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Settings"],function(a,c,b,d){c._beforeUnloadHandler=function(){var f;b.each(c.get(),function(g){g.plugins.autosave&&g.plugins.autosave.storeDraft();!f&&g.isDirty()&&d.shouldAskBeforeUnload(g)&&(f=g.translate("You have unsaved changes are you sure you want to navigate away?"))});return f};return{setup:function(f){a.onbeforeunload=
c._beforeUnloadHandler}}});k("tinymce.plugins.autosave.ui.Buttons",["tinymce.plugins.autosave.core.Storage"],function(a){var c=function(b,d){return function(f){var g=f.control;g.disabled(!a.hasDraft(b));b.on("StoreDraft RestoreDraft RemoveDraft",function(){g.disabled(!a.hasDraft(b))});a.startStoreDraft(b,d)}};return{register:function(b,d){b.addButton("restoredraft",{title:"Restore last draft",onclick:function(){a.restoreLastDraft(b)},onPostRender:c(b,d)});b.addMenuItem("restoredraft",{text:"Restore last draft",
onclick:function(){a.restoreLastDraft(b)},onPostRender:c(b,d),context:"file"})}}});k("tinymce.plugins.autosave.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.autosave.api.Api","tinymce.plugins.autosave.core.BeforeUnload","tinymce.plugins.autosave.ui.Buttons"],function(a,c,b,d,f){c.add("autosave",function(g){var m=a(!1);d.setup(g);f.register(g,m);return b.get(g)});return function(){}});r("tinymce.plugins.autosave.Plugin")()})();
