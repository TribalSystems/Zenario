(function(){var da={},C=function(a,c,f){if("string"!==typeof a)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+a;if(void 0===f)throw"no definition function for "+a;da[a]={deps:c,defn:f,instance:void 0}},ja=function(a){var c=da[a];if(void 0===c)throw"module ["+a+"] was undefined";if(void 0===c.instance){for(var f=da[a],e=f.deps,g=f.defn,d=e.length,l=Array(d),m=0;m<d;++m)l[m]=ja(e[m]);e=g.apply(null,l);if(void 0===e)throw"module ["+a+"] returned undefined";f.instance=e}return c.instance},
V=function(a,c){C(a,[],function(){return c})};C("ephox.katamari.api.Cell",[],function(){var a=function(c){var f=c;return{get:function(){return f},set:function(e){f=e},clone:function(){return a(f)}}};return a});V("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);C("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});C("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Tools")});
C("ephox.imagetools.util.Canvas",[],function(){function a(e,g){return f(document.createElement("canvas"),e,g)}function c(e){return e.getContext("2d")}function f(e,g,d){e.width=g;e.height=d;return e}return{create:a,clone:function(e){var g=a(e.width,e.height);c(g).drawImage(e,0,0);return g},resize:f,get2dContext:c,get3dContext:function(e){var g=null;try{g=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(d){}g||(g=null);return g}}});C("ephox.imagetools.util.ImageSize",[],function(){return{getWidth:function(a){return a.naturalWidth||
a.width},getHeight:function(a){return a.naturalHeight||a.height}}});C("ephox.imagetools.util.Mime",[],function(){return{guessMimeType:function(a){if(0===a.indexOf("data:"))return a=a.split(","),(a=/data:([^;]+)/.exec(a[0]))?a[1]:"";var c=document.createElement("a");c.href=a;a=c.pathname.split(".");(a=a[a.length-1])&&(a=a.toLowerCase());return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[a]}}});C("ephox.imagetools.util.Promise",[],function(){function a(b,p){return function(){b.apply(p,arguments)}}
function c(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];m(b,a(e,this),a(g,this))}function f(b){var p=this;null===this._state?this._deferreds.push(b):q(function(){var v=p._state?b.onFulfilled:b.onRejected;if(null===v)(p._state?b.resolve:b.reject)(p._value);else{try{var w=v(p._value)}catch(z){b.reject(z);return}b.resolve(w)}})}function e(b){try{if(b===
this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===typeof b||"function"===typeof b)){var p=b.then;if("function"===typeof p){m(a(p,b),a(e,this),a(g,this));return}}this._state=!0;this._value=b;d.call(this)}catch(v){g.call(this,v)}}function g(b){this._state=!1;this._value=b;d.call(this)}function d(){for(var b=0,p=this._deferreds.length;b<p;b++)f.call(this,this._deferreds[b]);this._deferreds=null}function l(b,p,v,w){this.onFulfilled="function"===typeof b?b:null;this.onRejected=
"function"===typeof p?p:null;this.resolve=v;this.reject=w}function m(b,p,v){var w=!1;try{b(function(z){w||(w=!0,p(z))},function(z){w||(w=!0,v(z))})}catch(z){w||(w=!0,v(z))}}if(window.Promise)return window.Promise;var q=c.immediateFn||"function"===typeof setImmediate&&setImmediate||function(b){setTimeout(b,1)},k=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};c.prototype["catch"]=function(b){return this.then(null,b)};c.prototype.then=function(b,p){var v=this;
return new c(function(w,z){f.call(v,new l(b,p,w,z))})};c.all=function(){var b=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(p,v){function w(A,u){try{if(u&&("object"===typeof u||"function"===typeof u)){var n=u.then;if("function"===typeof n){n.call(u,function(y){w(A,y)},v);return}}b[A]=u;0===--z&&p(b)}catch(y){v(y)}}if(0===b.length)return p([]);for(var z=b.length,h=0;h<b.length;h++)w(h,b[h])})};c.resolve=function(b){return b&&"object"===
typeof b&&b.constructor===c?b:new c(function(p){p(b)})};c.reject=function(b){return new c(function(p,v){v(b)})};c.race=function(b){return new c(function(p,v){for(var w=0,z=b.length;w<z;w++)b[w].then(p,v)})};return c});V("global!Array",Array);V("global!Error",Error);C("ephox.katamari.api.Fun",["global!Array","global!Error"],function(a,c){var f=function(d){return function(){return d}},e=f(!1),g=f(!0);return{noop:function(){},compose:function(d,l){return function(){return d(l.apply(null,arguments))}},
constant:f,identity:function(d){return d},tripleEquals:function(d,l){return d===l},curry:function(d){for(var l=new a(arguments.length-1),m=1;m<arguments.length;m++)l[m-1]=arguments[m];return function(){for(var q=new a(arguments.length),k=0;k<q.length;k++)q[k]=arguments[k];q=l.concat(q);return d.apply(null,q)}},not:function(d){return function(){return!d.apply(null,arguments)}},die:function(d){return function(){throw new c(d);}},apply:function(d){return d()},call:function(d){d()},never:e,always:g}});
V("global!Object",Object);C("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(a,c){var f=a.never,e=a.always,g=function(){return d},d=function(){var m=function(b){return b.isNone()},q=function(b){return b()},k=function(b){return b};m={fold:function(b,p){return b()},is:f,isSome:f,isNone:e,getOr:k,getOrThunk:q,getOrDie:function(b){throw Error(b||"error: getOrDie called on none.");},or:k,orThunk:q,map:g,ap:g,each:function(){},bind:g,flatten:g,exists:f,forall:e,filter:g,equals:m,
equals_:m,toArray:function(){return[]},toString:a.constant("none()")};c.freeze&&c.freeze(m);return m}(),l=function(m){var q=function(){return m},k=function(){return p},b=function(v){return v(m)},p={fold:function(v,w){return w(m)},is:function(v){return m===v},isSome:e,isNone:f,getOr:q,getOrThunk:q,getOrDie:q,or:k,orThunk:k,map:function(v){return l(v(m))},ap:function(v){return v.fold(g,function(w){return l(w(m))})},each:function(v){v(m)},bind:b,flatten:q,exists:b,forall:b,filter:function(v){return v(m)?
p:d},equals:function(v){return v.is(m)},equals_:function(v,w){return v.fold(f,function(z){return w(m,z)})},toArray:function(){return[m]},toString:function(){return"some("+m+")"}};return p};return{some:l,none:g,from:function(m){return null===m||void 0===m?d:l(m)}}});C("ephox.katamari.api.Global",[],function(){return"undefined"!==typeof window?window:Function("return this;")()});C("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(a){var c=function(e,g){g=void 0!==g?g:a;for(var d=0;d<
e.length&&void 0!==g&&null!==g;++d)g=g[e[d]];return g},f=function(e,g){var d=void 0!==g?g:a;for(g=0;g<e.length;++g){var l=e[g];if(void 0===d[l]||null===d[l])d[l]={};d=d[l]}return d};return{path:c,resolve:function(e,g){e=e.split(".");return c(e,g)},forge:f,namespace:function(e,g){e=e.split(".");return f(e,g)}}});C("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(a){return{getOrDie:function(c,f){f=a.resolve(c,f);if(void 0===f)throw c+" not available on this browser";return f}}});C("ephox.sand.api.Blob",
["ephox.sand.util.Global"],function(a){return function(c,f){return new (a.getOrDie("Blob"))(c,f)}});C("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("FileReader"))}});C("ephox.sand.api.Uint8Array",["ephox.sand.util.Global"],function(a){return function(c){return new (a.getOrDie("Uint8Array"))(c)}});C("ephox.sand.api.Window",["ephox.sand.util.Global"],function(a){return{atob:function(c){return a.getOrDie("atob")(c)},requestAnimationFrame:function(c){a.getOrDie("requestAnimationFrame")(c)}}});
V("global!Math",Math);C("ephox.imagetools.util.Conversions","ephox.imagetools.util.Canvas ephox.imagetools.util.ImageSize ephox.imagetools.util.Mime ephox.imagetools.util.Promise ephox.katamari.api.Option ephox.sand.api.Blob ephox.sand.api.FileReader ephox.sand.api.Uint8Array ephox.sand.api.Window global!Array global!Math".split(" "),function(a,c,f,e,g,d,l,m,q,k,b){function p(n){return new e(function(y){function B(){n.removeEventListener("load",B);y(n)}n.complete?y(n):n.addEventListener("load",B)})}
function v(n){return p(n).then(function(y){var B=a.create(c.getWidth(y),c.getHeight(y));a.get2dContext(B).drawImage(y,0,0);return B})}function w(n){return new e(function(y){var B=new XMLHttpRequest;B.open("GET",n,!0);B.responseType="blob";B.onload=function(){200==this.status&&y(this.response)};B.send()})}function z(n){var y=n.split(",");n=/data:([^;]+)/.exec(y[0]);if(!n)return g.none();n=n[1];y=q.atob(y[1]);for(var B=y.length,t=b.ceil(B/1024),r=new k(t),x=0;x<t;++x){for(var D=1024*x,G=b.min(D+1024,
B),J=new k(G-D),F=0;D<G;++F,++D)J[F]=y[D].charCodeAt(0);r[x]=m(J)}return g.some(d(r,{type:n}))}function h(n){return new e(function(y,B){z(n).fold(function(){B("uri is not base64: "+n)},y)})}function A(n,y,B){y=y||"image/png";return HTMLCanvasElement.prototype.toBlob?new e(function(t){n.toBlob(function(r){t(r)},y,B)}):h(n.toDataURL(y,B))}function u(n){return new e(function(y){var B=new l;B.onloadend=function(){y(B.result)};B.readAsDataURL(n)})}return{blobToImage:function(n){return new e(function(y){function B(){t.removeEventListener("load",
B);y(t)}var t=new Image;t.addEventListener("load",B);t.src=URL.createObjectURL(n);t.complete&&B()})},imageToBlob:function(n){return p(n).then(function(y){var B=y.src;return 0===B.indexOf("blob:")?w(B):0===B.indexOf("data:")?h(B):v(y).then(function(t){return A(t,f.guessMimeType(B))})})},blobToDataUri:u,blobToBase64:function(n){return u(n).then(function(y){return y.split(",")[1]})},imageToCanvas:v,canvasToBlob:A,revokeImageUrl:function(n){URL.revokeObjectURL(n.src)},uriToBlob:function(n){return 0===
n.indexOf("blob:")?w(n):0===n.indexOf("data:")?h(n):null},dataUriToBlobSync:z,isDataUrl:function(n){n=n.split(",");return null!==/data:([^;]+)/.exec(n[0])}}});C("ephox.imagetools.api.BlobConversions",["ephox.imagetools.util.Conversions"],function(a){return{blobToImage:function(c){return a.blobToImage(c)},imageToBlob:function(c){return a.imageToBlob(c)},blobToDataUri:function(c){return a.blobToDataUri(c)},blobToBase64:function(c){return a.blobToBase64(c)},dataUriToBlobSync:function(c){return a.dataUriToBlobSync(c)}}});
C("ephox.imagetools.util.ImageResult","ephox.imagetools.util.Canvas ephox.imagetools.util.Conversions ephox.imagetools.util.Mime ephox.imagetools.util.Promise ephox.katamari.api.Fun ephox.katamari.api.Option".split(" "),function(a,c,f,e,g,d){function l(q,k,b){function p(w,z){var h=w||v,A=function(){return q.toDataURL(h,z)};return b.fold(A,function(u){return void 0===z&&h===v?u:A()})}var v=k.type;return{getType:g.constant(v),toBlob:function(w,z){var h=w||v;return w===v&&void 0===z?e.resolve(k):c.canvasToBlob(q,
h,z)},toDataURL:p,toBase64:function(w,z){return p(w,z).split(",")[1]},toCanvas:function(){return a.clone(q)}}}function m(q,k){return c.canvasToBlob(q,k).then(function(b){return l(q,b,d.none())})}return{fromBlob:function(q){return c.blobToImage(q).then(function(k){var b=c.imageToCanvas(k);c.revokeImageUrl(k);return b}).then(function(k){return c.blobToDataUri(q).then(function(b){return l(k,q,d.some(b))})})},fromCanvas:m,fromImage:function(q){var k=f.guessMimeType(q.src);return c.imageToCanvas(q).then(function(b){return c.canvasToBlob(b,
k).then(function(p){return m(b,p,d.none())})})},fromBlobAndUrlSync:function(q,k){var b=d.none();c.blobToImage(q).then(function(p){var v=c.imageToCanvas(p);c.revokeImageUrl(p);b=d.some(v)});return{getType:g.constant(q.type),toBlob:function(){return e.resolve(q)},toDataURL:g.constant(k),toBase64:function(){return k.split(",")[1]},toCanvas:function(){return b.getOrDie("image has not loaded yet")}}}}});C("ephox.imagetools.transformations.ColorMatrix",[],function(){function a(g,d,l){g=parseFloat(g);g>
l?g=l:g<d&&(g=d);return g}function c(g,d){var l,m,q,k,b=[],p=Array(10);for(l=0;5>l;l++){for(m=0;5>m;m++)b[m]=d[m+5*l];for(m=0;5>m;m++){for(q=k=0;5>q;q++)k+=g[m+5*q]*b[q];p[m+5*l]=k}}return p}function f(g,d){d=a(d,0,1);return g.map(function(l,m){l=0===m%6?1-(1-l)*d:l*d;return a(l,0,1)})}var e=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,
1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:f,multiply:c,adjustContrast:function(g,d){d=a(d,-1,1);d*=100;if(0>d)var l=127+d/100*127;else l=d%1,l=0===l?e[d]:e[Math.floor(d)]*(1-l)+e[Math.floor(d)+1]*l,l=127*l+127;return c(g,[l/127,0,0,0,.5*(127-l),0,l/127,0,0,.5*(127-
l),0,0,l/127,0,.5*(127-l),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(g,d){d=a(255*d,-255,255);return c(g,[1,0,0,0,d,0,1,0,0,d,0,0,1,0,d,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(g,d){d=a(d,-1,1);d=1+(0<d?3*d:d);return c(g,[.3086*(1-d)+d,.6094*(1-d),.082*(1-d),0,0,.3086*(1-d),.6094*(1-d)+d,.082*(1-d),0,0,.3086*(1-d),.6094*(1-d),.082*(1-d)+d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(g,d){d=a(d,-180,180)/180*Math.PI;var l=Math.cos(d);d=Math.sin(d);return c(g,[.213+.787*l+-.213*d,.715+
-.715*l+-.715*d,.072+-.072*l+.928*d,0,0,.213+-.213*l+.143*d,.715+l*(1-.715)+.14*d,.072+-.072*l+-.283*d,0,0,.213+-.213*l+-.787*d,.715+-.715*l+.715*d,.072+.928*l+.072*d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(g,d,l,m){d=a(d,0,2);l=a(l,0,2);m=a(m,0,2);return c(g,[d,0,0,0,0,0,l,0,0,0,0,0,m,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(g,d){d=a(d,0,1);return c(g,f([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],d))},adjustGrayscale:function(g,d){d=a(d,0,1);return c(g,
f([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],d))}}});C("ephox.imagetools.transformations.Filters",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ColorMatrix"],function(a,c,f){function e(q,k){var b=q.toCanvas(),p=a.get2dContext(b),v=p.getImageData(0,0,b.width,b.height),w=v.data,z,h=k[0],A=k[1],u=k[2],n=k[3],y=k[4],B=k[5],t=k[6],r=k[7],x=k[8],D=k[9],G=k[10],J=k[11],F=k[12],O=k[13],I=k[14],K=k[15],Q=k[16],M=k[17],Z=k[18],
S=k[19];for(z=0;z<w.length;z+=4){k=w[z];var R=w[z+1];var N=w[z+2];var T=w[z+3];w[z]=k*h+R*A+N*u+T*n+y;w[z+1]=k*B+R*t+N*r+T*x+D;w[z+2]=k*G+R*J+N*F+T*O+I;w[z+3]=k*K+R*Q+N*M+T*Z+S}p.putImageData(v,0,0);return c.fromCanvas(b,q.getType())}function g(q,k){var b=q.toCanvas(),p=a.get2dContext(b);var v=p.getImageData(0,0,b.width,b.height);var w=p.getImageData(0,0,b.width,b.height);w=function(z,h,A){function u(M,Z,S){M>S?M=S:M<Z&&(M=Z);return M}var n,y,B,t,r,x;var D=Math.round(Math.sqrt(A.length));var G=Math.floor(D/
2);var J=z.data;var F=h.data;var O=z.width;var I=z.height;for(n=0;n<I;n++)for(z=0;z<O;z++){for(x=y=B=t=0;x<D;x++)for(r=0;r<D;r++){var K=u(z+r-G,0,O-1);var Q=u(n+x-G,0,I-1);K=4*(Q*O+K);Q=A[x*D+r];y+=J[K]*Q;B+=J[K+1]*Q;t+=J[K+2]*Q}K=4*(n*O+z);F[K]=u(y,0,255);F[K+1]=u(B,0,255);F[K+2]=u(t,0,255)}return h}(v,w,k);p.putImageData(w,0,0);return c.fromCanvas(b,q.getType())}function d(q){return function(k,b){var p=k.toCanvas(),v=a.get2dContext(p),w,z=Array(256);for(w=0;w<z.length;w++)z[w]=q(w,b);b=v.getImageData(0,
0,p.width,p.height);w=b.data;var h;for(h=0;h<w.length;h+=4)w[h]=z[w[h]],w[h+1]=z[w[h+1]],w[h+2]=z[w[h+2]];v.putImageData(b,0,0);return c.fromCanvas(p,k.getType())}}function l(q){return function(k,b){return e(k,q(f.identity(),b))}}function m(q){return function(k){return g(k,q)}}return{invert:function(q){return function(k){return e(k,q)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:l(f.adjustBrightness),hue:l(f.adjustHue),saturate:l(f.adjustSaturation),contrast:l(f.adjustContrast),
grayscale:l(f.adjustGrayscale),sepia:l(f.adjustSepia),colorize:function(q,k,b,p){return e(q,f.adjustColors(f.identity(),k,b,p))},sharpen:m([0,-1,0,-1,5,-1,0,-1,0]),emboss:m([-2,-1,0,-1,1,1,0,1,2]),gamma:d(function(q,k){return 255*Math.pow(q/255,1-k)}),exposure:d(function(q,k){return 255*(1-Math.exp(-(q/255)*k))}),colorFilter:e,convoluteFilter:g}});C("ephox.imagetools.transformations.ImageResizerCanvas",["ephox.imagetools.util.Promise","ephox.imagetools.util.Conversions","ephox.imagetools.util.Canvas",
"ephox.imagetools.util.ImageSize"],function(a,c,f,e){function g(l,m,q){var k=e.getWidth(l),b=e.getHeight(l);k=m/k;var p=q/b;b=!1;if(.5>k||2<k)k=.5>k?.5:2,b=!0;if(.5>p||2<p)p=.5>p?.5:2,b=!0;l=d(l,k,p);return b?l.then(function(v){return g(v,m,q)}):l}function d(l,m,q){return new a(function(k){var b=e.getWidth(l),p=e.getHeight(l),v=Math.floor(b*m),w=Math.floor(p*q),z=f.create(v,w);f.get2dContext(z).drawImage(l,0,0,b,p,0,0,v,w);k(z)})}return{scale:g}});C("ephox.imagetools.transformations.ImageTools",["ephox.imagetools.util.Canvas",
"ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ImageResizerCanvas"],function(a,c,f){return{rotate:function(e,g){var d=e.toCanvas(),l=a.create(d.width,d.height),m=a.get2dContext(l),q=0,k=0;g=0>g?360+g:g;90!=g&&270!=g||a.resize(l,l.height,l.width);if(90==g||180==g)q=l.width;if(270==g||180==g)k=l.height;m.translate(q,k);m.rotate(g*Math.PI/180);m.drawImage(d,0,0);return c.fromCanvas(l,e.getType())},flip:function(e,g){var d=e.toCanvas(),l=a.create(d.width,d.height),m=a.get2dContext(l);
"v"==g?(m.scale(1,-1),m.drawImage(d,0,-l.height)):(m.scale(-1,1),m.drawImage(d,-l.width,0));return c.fromCanvas(l,e.getType())},crop:function(e,g,d,l,m){var q=e.toCanvas();l=a.create(l,m);a.get2dContext(l).drawImage(q,-g,-d);return c.fromCanvas(l,e.getType())},resize:function(e,g,d){return f.scale(e.toCanvas(),g,d).then(function(l){return c.fromCanvas(l,e.getType())})}}});C("ephox.imagetools.api.ImageTransformations",["ephox.imagetools.transformations.Filters","ephox.imagetools.transformations.ImageTools"],
function(a,c){return{invert:function(f){return a.invert(f)},sharpen:function(f){return a.sharpen(f)},emboss:function(f){return a.emboss(f)},brightness:function(f,e){return a.brightness(f,e)},hue:function(f,e){return a.hue(f,e)},saturate:function(f,e){return a.saturate(f,e)},contrast:function(f,e){return a.contrast(f,e)},grayscale:function(f,e){return a.grayscale(f,e)},sepia:function(f,e){return a.sepia(f,e)},colorize:function(f,e,g,d){return a.colorize(f,e,g,d)},gamma:function(f,e){return a.gamma(f,
e)},exposure:function(f,e){return a.exposure(f,e)},flip:function(f,e){return c.flip(f,e)},crop:function(f,e,g,d,l){return c.crop(f,e,g,d,l)},resize:function(f,e,g){return c.resize(f,e,g)},rotate:function(f,e){return c.rotate(f,e)}}});C("ephox.imagetools.api.ResultConversions",["ephox.imagetools.util.ImageResult"],function(a){return{blobToImageResult:function(c){return a.fromBlob(c)},fromBlobAndUrlSync:function(c,f){return a.fromBlobAndUrlSync(c,f)},imageToImageResult:function(c){return a.fromImage(c)},
imageResultToBlob:function(c,f,e){return c.toBlob(f,e)},imageResultToOriginalBlob:function(c){return c.toBlob()},imageResultToDataURL:function(c,f,e){return c.toDataURL(f,e)}}});C("ephox.sand.api.URL",["ephox.sand.util.Global"],function(a){return{createObjectURL:function(c){return a.getOrDie("URL").createObjectURL(c)},revokeObjectURL:function(c){a.getOrDie("URL").revokeObjectURL(c)}}});V("global!clearTimeout",clearTimeout);C("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Delay")});
C("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Promise")});C("tinymce.core.util.URI",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.URI")});C("tinymce.plugins.imagetools.api.Settings",[],function(){return{getToolbarItems:function(a){return a.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")},getProxyUrl:function(a){return a.getParam("imagetools_proxy")}}});C("tinymce.plugins.imagetools.core.ImageSize",
[],function(){return{getImageSize:function(a){var c=a.style.width;var f=a.style.height;if(c||f)return/^[0-9\.]+px$/.test(c)&&/^[0-9\.]+px$/.test(f)?{w:parseInt(c,10),h:parseInt(f,10)}:null;c=a.width;f=a.height;return c&&f?{w:parseInt(c,10),h:parseInt(f,10)}:null},setImageSize:function(a,c){if(c){var f=a.style.width;var e=a.style.height;if(f||e)a.style.width=c.w+"px",a.style.height=c.h+"px",a.removeAttribute("data-mce-style");f=a.width;e=a.height;if(f||e)a.setAttribute("width",c.w),a.setAttribute("height",
c.h)}},getNaturalImageSize:function(a){return{w:a.naturalWidth,h:a.naturalHeight}}}});V("global!String",String);C("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(a,c,f,e){var g=function(){var h=c.prototype.indexOf,A=function(n,y){return h.call(n,y)},u=function(n,y){a:{for(var B=0,t=n.length;B<t;++B)if(n[B]===y){n=B;break a}n=-1}return n};return void 0===h?u:A}(),d=function(h,A){return-1<g(h,A)},l=function(h,A){for(var u=h.length,n=new c(u),
y=0;y<u;y++)n[y]=A(h[y],y,h);return n},m=function(h,A){for(var u=0,n=h.length;u<n;u++)A(h[u],u,h)},q=function(h,A){for(var u=h.length-1;0<=u;u--)A(h[u],u,h)},k=function(h,A){for(var u=[],n=0,y=h.length;n<y;n++){var B=h[n];A(B,n,h)&&u.push(B)}return u},b=function(h,A){for(var u=0,n=h.length;u<n;u++)if(A(h[u],u,h))return a.some(u);return a.none()},p=c.prototype.push,v=function(h){for(var A=[],u=0,n=h.length;u<n;++u){if(!c.prototype.isPrototypeOf(h[u]))throw new f("Arr.flatten item "+u+" was not an array, input: "+
h);p.apply(A,h[u])}return A},w=function(h,A){for(var u=0,n=h.length;u<n;++u)if(!0!==A(h[u],u,h))return!1;return!0},z=c.prototype.slice;return{map:l,each:m,eachr:q,partition:function(h,A){for(var u=[],n=[],y=0,B=h.length;y<B;y++){var t=h[y];(A(t,y,h)?u:n).push(t)}return{pass:u,fail:n}},filter:k,groupBy:function(h,A){if(0===h.length)return[];for(var u=A(h[0]),n=[],y=[],B=0,t=h.length;B<t;B++){var r=h[B],x=A(r);x!==u&&(n.push(y),y=[]);u=x;y.push(r)}0!==y.length&&n.push(y);return n},indexOf:function(h,
A){h=g(h,A);return-1===h?a.none():a.some(h)},foldr:function(h,A,u){q(h,function(n){u=A(u,n)});return u},foldl:function(h,A,u){m(h,function(n){u=A(u,n)});return u},find:function(h,A){for(var u=0,n=h.length;u<n;u++){var y=h[u];if(A(y,u,h))return a.some(y)}return a.none()},findIndex:b,flatten:v,bind:function(h,A){h=l(h,A);return v(h)},forall:w,exists:function(h,A){return b(h,A).isSome()},contains:d,equal:function(h,A){return h.length===A.length&&w(h,function(u,n){return u===A[n]})},reverse:function(h){h=
z.call(h,0);h.reverse();return h},chunk:function(h,A){for(var u=[],n=0;n<h.length;n+=A){var y=h.slice(n,n+A);u.push(y)}return u},difference:function(h,A){return k(h,function(u){return!d(A,u)})},mapToObject:function(h,A){for(var u={},n=0,y=h.length;n<y;n++){var B=h[n];u[e(B)]=A(B,n)}return u},pure:function(h){return[h]},sort:function(h,A){h=z.call(h,0);h.sort(A);return h},range:function(h,A){for(var u=[],n=0;n<h;n++)u.push(A(n));return u},head:function(h){return 0===h.length?a.none():a.some(h[0])},
last:function(h){return 0===h.length?a.none():a.some(h[h.length-1])}}});C("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(a){return function(){return new (a.getOrDie("XMLHttpRequest"))}});C("tinymce.plugins.imagetools.core.Utils",["ephox.sand.api.FileReader","ephox.sand.api.XMLHttpRequest","tinymce.core.util.Promise","tinymce.core.util.Tools"],function(a,c,f,e){return{traverse:function(g,d){g=d.reduce(function(l,m){return null!==l&&void 0!==l?l[m]:void 0},g);return null!==g&&void 0!==
g?g:null},readBlob:function(g){return new f(function(d){var l=new a;l.onload=function(m){d(m.target.result)};l.readAsText(g)})},requestUrlAsBlob:function(g,d){return new f(function(l){var m=new c;m.onreadystatechange=function(){4===m.readyState&&l({status:m.status,blob:this.response})};m.open("GET",g,!0);e.each(d,function(q,k){m.setRequestHeader(k,q)});m.responseType="blob";m.send()})},parseJson:function(g){try{var d=JSON.parse(g)}catch(l){}return d}}});C("tinymce.plugins.imagetools.core.Errors",
["ephox.katamari.api.Arr","ephox.katamari.api.Fun","tinymce.core.util.Promise","tinymce.plugins.imagetools.core.Utils"],function(a,c,f,e){var g=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],d=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],
l=function(b){return"ImageProxy HTTP error: "+a.find(g,function(p){return b===p.code}).fold(c.constant("Unknown ImageProxy error"),function(p){return p.message})},m=function(b){b=l(b);return f.reject(b)},q=function(b){return a.find(d,function(p){return p.type===b}).fold(c.constant("Unknown service error"),function(p){return p.message})},k=function(b,p){return e.readBlob(p).then(function(v){v=e.parseJson(v);v=e.traverse(v,["error","type"]);v="ImageProxy Service error: "+(v?q(v):"Invalid JSON in service error message");
return f.reject(v)})};return{handleServiceErrorResponse:function(b,p){return 400===b||403===b||500===b?k(b,p):m(b)},handleHttpError:m,getHttpErrorMsg:l,getServiceErrorMsg:q}});C("tinymce.plugins.imagetools.core.Proxy",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Errors","tinymce.plugins.imagetools.core.Utils"],function(a,c,f,e){function g(m){return e.requestUrlAsBlob(m,{}).then(function(q){return 200>q.status||300<=q.status?f.handleHttpError(q.status):a.resolve(q.blob)})}
var d=function(m,q){var k=-1===m.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(m)||!q?m:m+k+"apiKey="+encodeURIComponent(q)},l=function(m,q){return e.requestUrlAsBlob(d(m,q),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":q}).then(function(k){return 200>k.status||300<=k.status?f.handleServiceErrorResponse(k.status,k.blob):a.resolve(k.blob)})};return{getUrl:function(m,q){return q?l(m,q):g(m)}}});V("global!setTimeout",setTimeout);C("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.dom.DOMUtils")});C("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Factory")});C("tinymce.plugins.imagetools.core.UndoStack",[],function(){return function(){function a(){return-1!==f&&f<c.length-1}var c=[],f=-1;return{data:c,add:function(e){var g=c.splice(++f);c.push(e);return{state:e,removed:g}},undo:function(){if(0<f)return c[--f]},redo:function(){if(a())return c[++f]},canUndo:function(){return 0<f},canRedo:a}}});V("global!document",
document);V("global!Image",Image);C("tinymce.core.geom.Rect",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.geom.Rect")});C("tinymce.plugins.imagetools.core.LoadImage",["tinymce.core.util.Promise"],function(a){return{loadImage:function(c){return new a(function(f){var e=function(){c.removeEventListener("load",e);f(c)};c.complete?f(c):c.addEventListener("load",e)})}}});C("tinymce.core.dom.DomQuery",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DomQuery")});
C("tinymce.core.util.Observable",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Observable")});C("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.VK")});C("tinymce.plugins.imagetools.ui.CropRect","tinymce.core.dom.DomQuery tinymce.core.geom.Rect tinymce.core.ui.Factory tinymce.core.util.Observable tinymce.core.util.Tools tinymce.core.util.VK".split(" "),function(a,c,f,e,g,d){var l=0;return function(m,q,k,b,p){function v(t,r,
x,D){var G=r.x;var J=r.y;var F=r.w;r=r.h;G+=x*t.deltaX;J+=D*t.deltaY;F+=x*t.deltaW;r+=D*t.deltaH;20>F&&(F=20);20>r&&(r=20);t=m=c.clamp({x:G,y:J,w:F,h:r},k,"move"===t.name);t={x:t.x-k.x,y:t.y-k.y,w:t.w,h:t.h};A.fire("updateRect",{rect:t});h(t)}function w(t){function r(x,D){0>D.h&&(D.h=0);0>D.w&&(D.w=0);a("#"+n+"-"+x,b).css({left:D.x,top:D.y,width:D.w,height:D.h})}g.each(y,function(x){a("#"+n+"-"+x.name,b).css({left:t.w*x.xMul+t.x,top:t.h*x.yMul+t.y})});r("top",{x:q.x,y:q.y,w:q.w,h:t.y-q.y});r("right",
{x:t.x+t.w,y:t.y,w:q.w-t.x-t.w+q.x,h:t.h});r("bottom",{x:q.x,y:t.y+t.h,w:q.w,h:q.h-t.y-t.h+q.y});r("left",{x:q.x,y:t.y,w:t.x-q.x,h:t.h});r("move",t)}function z(t){m=t;w(m)}function h(t){z({x:t.x+k.x,y:t.y+k.y,w:t.w,h:t.h})}var A,u,n="mce-crid-"+l++;var y=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},
{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];var B=["top","right","bottom","left"];(function(){a('<div id="'+n+'" class="mce-croprect-container" role="grid" aria-dropeffect="execute">').appendTo(b);g.each(B,function(t){a("#"+n,b).append('<div id="'+n+"-"+t+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});g.each(y,function(t){a("#"+
n,b).append('<div id="'+n+"-"+t.name+'" class="mce-croprect-handle mce-croprect-handle-'+t.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+t.label+'" aria-grabbed="false">')});u=g.map(y,function(t){var r;return new (f.get("DragHelper"))(n,{document:b.ownerDocument,handle:n+"-"+t.name,start:function(){r=m},drag:function(x){v(t,r,x.deltaX,x.deltaY)}})});w(m);a(b).on("focusin focusout",function(t){a(t.target).attr("aria-grabbed","focus"===t.type)});a(b).on("keydown",
function(t){function r(D,G,J,F,O){D.stopPropagation();D.preventDefault();v(x,J,F,O)}var x;g.each(y,function(D){if(t.target.id===n+"-"+D.name)return x=D,!1});switch(t.keyCode){case d.LEFT:r(t,x,m,-10,0);break;case d.RIGHT:r(t,x,m,10,0);break;case d.UP:r(t,x,m,0,-10);break;case d.DOWN:r(t,x,m,0,10);break;case d.ENTER:case d.SPACEBAR:t.preventDefault(),p()}})})(b);return A=g.extend({toggleVisibility:function(t){var r=g.map(y,function(x){return"#"+n+"-"+x.name}).concat(g.map(B,function(x){return"#"+n+
"-"+x})).join(",");t?a(r,b).show():a(r,b).hide()},setClampRect:function(t){k=t;w(m)},setRect:z,getInnerRect:function(){return{x:m.x-k.x,y:m.y-k.y,w:m.w,h:m.h}},setInnerRect:h,setViewPortRect:function(t){q=t;w(m)},destroy:function(){g.each(u,function(t){t.destroy()});u=[]}},e)}});C("tinymce.plugins.imagetools.ui.ImagePanel","global!document global!Image tinymce.core.geom.Rect tinymce.core.ui.Factory tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.core.LoadImage tinymce.plugins.imagetools.ui.CropRect".split(" "),
function(a,c,f,e,g,d,l,m){return{create:function(q){return new (e.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(k){return arguments.length?(this.state.set("rect",k),this):this.state.get("rect")},imageSize:function(){var k=this.state.get("viewRect");return{w:k.w,h:k.h}},toggleCropRect:function(k){this.state.set("cropEnabled",k)},imageSrc:function(k){var b=this,p=new c;p.src=k;l.loadImage(p).then(function(){var v=b.state.get("viewRect");var w=b.$el.find("img");w[0]?w.replaceWith(p):
(w=a.createElement("div"),w.className="mce-imagepanel-bg",b.getEl().appendChild(w),b.getEl().appendChild(p));w={x:0,y:0,w:p.naturalWidth,h:p.naturalHeight};b.state.set("viewRect",w);b.state.set("rect",f.inflate(w,-20,-20));v&&v.w===w.w&&v.h===w.h||b.zoomFit();b.repaintImage();b.fire("load")})},zoom:function(k){return arguments.length?(this.state.set("zoom",k),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var k=this.$el.find("img");
var b=this.getEl().clientWidth;var p=this.getEl().clientHeight;k=Math.min((b-10)/k[0].naturalWidth,(p-10)/k[0].naturalHeight);1<=k&&(k=1);this.zoom(k)},repaintImage:function(){var k=this.getEl();var b=this.zoom();var p=this.state.get("rect");var v=this.$el.find("img");var w=this.$el.find(".mce-imagepanel-bg");var z=k.offsetWidth;var h=k.offsetHeight;var A=v[0].naturalWidth*b;var u=v[0].naturalHeight*b;k=Math.max(0,z/2-A/2);var n=Math.max(0,h/2-u/2);v.css({left:k,top:n,width:A,height:u});w.css({left:k,
top:n,width:A,height:u});this.cropRect&&(this.cropRect.setRect({x:p.x*b+k,y:p.y*b+n,w:p.w*b,h:p.h*b}),this.cropRect.setClampRect({x:k,y:n,w:A,h:u}),this.cropRect.setViewPortRect({x:0,y:0,w:z,h}))},bindStates:function(){function k(p){b.cropRect=new m(p,b.state.get("viewRect"),b.state.get("viewRect"),b.getEl(),function(){b.fire("crop")});b.cropRect.on("updateRect",function(v){v=v.rect;var w=b.zoom();v={x:Math.round(v.x/w),y:Math.round(v.y/w),w:Math.round(v.w/w),h:Math.round(v.h/w)};b.state.set("rect",
v)});b.on("remove",b.cropRect.destroy)}var b=this;b.state.on("change:cropEnabled",function(p){b.cropRect.toggleVisibility(p.value);b.repaintImage()});b.state.on("change:zoom",function(){b.repaintImage()});b.state.on("change:rect",function(p){p=p.value;b.cropRect||k(p);b.cropRect.setRect(p)})}}))(q)}}});C("tinymce.plugins.imagetools.ui.Dialog","ephox.imagetools.api.ImageTransformations ephox.imagetools.api.ResultConversions ephox.sand.api.URL global!Math global!setTimeout tinymce.core.dom.DOMUtils tinymce.core.ui.Factory tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.core.UndoStack tinymce.plugins.imagetools.ui.ImagePanel".split(" "),
function(a,c,f,e,g,d,l,m,q,k,b){function p(z){return{blob:z,url:f.createObjectURL(z)}}function v(z){z&&f.revokeObjectURL(z.url)}function w(z,h,A,u){function n(E){var L=P.find("#w")[0];var H=P.find("#h")[0];var X=parseInt(L.value(),10);var Y=parseInt(H.value(),10);P.find("#constrain")[0].checked()&&T&&aa&&X&&Y&&("w"===E.control.settings.name?(Y=e.round(X*ea),H.value(Y)):(X=e.round(Y*fa),L.value(X)));T=X;aa=Y}function y(E){return e.round(100*E)+"%"}function B(){P.find("#undo").disabled(!R.canUndo());
P.find("#redo").disabled(!R.canRedo());P.statusbar.find("#save").disabled(!R.canUndo())}function t(){P.find("#undo").disabled(!0);P.find("#redo").disabled(!0)}function r(E){E&&U.imageSrc(E.url)}function x(E){return function(){var L=q.grep(ka,function(H){return H.settings.name!==E});q.each(L,function(H){H.hide()});E.show();E.focus()}}function D(E){N=p(E);r(N)}function G(E){h=p(E);r(h);q.each(R.add(h).removed,v);B()}function J(){var E=U.selection();c.blobToImageResult(h.blob).then(function(L){a.crop(L,
E.x,E.y,E.w,E.h).then(ba).then(function(H){G(H);I()})})}function F(E){var L=[].slice.call(arguments,1);return function(){c.blobToImageResult((N||h).blob).then(function(H){E.apply(this,[H].concat(L)).then(ba).then(D)})}}function O(E){var L=[].slice.call(arguments,1);return function(){c.blobToImageResult(h.blob).then(function(H){E.apply(this,[H].concat(L)).then(ba).then(G)})}}function I(){r(h);v(N);x(la)();B()}function K(E,L){N?L():g(function(){0<E--?K(E,L):z.windowManager.alert("Error: failed to apply image operation.")},
10)}function Q(){N?(G(N.blob),I()):K(100,Q)}function M(E){return l.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:E})}function Z(E,L){return M([{text:"Back",onclick:I},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Q}]).hide().on("show",function(){t();c.blobToImageResult(h.blob).then(function(H){return L(H)}).then(ba).then(function(H){H=
p(H);r(H);v(N);N=H})})}function S(E,L,H,X,Y){function ha(W){c.blobToImageResult(h.blob).then(function(ca){return L(ca,W)}).then(ba).then(function(ca){ca=p(ca);r(ca);v(N);N=ca})}return M([{text:"Back",onclick:I},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(W){ha(W.value)},minValue:X,maxValue:Y,value:H,previewFilter:y},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Q}]).hide().on("show",function(){this.find("slider").value(H);t()})}var R=new k,N,T,aa,ea,fa,ba=function(E){return E.toBlob()};
var ma=M([{text:"Back",onclick:I},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:J}]).hide().on("show hide",function(E){U.toggleCropRect("show"===E.type)}).on("show",t);var na=M([{text:"Back",onclick:I},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:n},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:n},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(E){!0===E.control.value()&&(ea=aa/T,fa=T/aa)}},{type:"spacer",
flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(E){var L=parseInt(P.find("#w").value(),10),H=parseInt(P.find("#h").value(),10);E.preventDefault();O(a.resize,L,H)();I()}).on("show",t);var oa=M([{text:"Back",onclick:I},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:F(a.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:F(a.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:F(a.rotate,-90)},{icon:"rotateright",
tooltip:"Rotate clockwise",onclick:F(a.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Q}]).hide().on("show",t);var pa=Z("Invert",a.invert);var qa=Z("Sharpen",a.sharpen);var ra=Z("Emboss",a.emboss);var sa=S("Brightness",a.brightness,0,-1,1);var ta=S("Hue",a.hue,180,0,360);var ua=S("Saturate",a.saturate,0,-1,1);var va=S("Contrast",a.contrast,0,-1,1);var Aa=S("Grayscale",a.grayscale,0,0,1);var wa=S("Sepia",a.sepia,0,0,1);var xa=function(E,L){function H(){var X=P.find("#r")[0].value();
var Y=P.find("#g")[0].value();var ha=P.find("#b")[0].value();c.blobToImageResult(h.blob).then(function(W){return L(W,X,Y,ha)}).then(ba).then(function(W){W=p(W);r(W);v(N);N=W})}return M([{text:"Back",onclick:I},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:H,previewFilter:y},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:H,previewFilter:y},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:H,previewFilter:y},
{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Q}]).hide().on("show",function(){P.find("#r,#g,#b").value(1);t()})}("Colorize",a.colorize);var ya=S("Gamma",a.gamma,0,-1,1);var za=S("Exposure",a.exposure,1,0,2);var Ba=M([{text:"Back",onclick:I},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:x(ta)},{text:"saturate",icon:"saturate",onclick:x(ua)},{text:"sepia",icon:"sepia",onclick:x(wa)},{text:"emboss",icon:"emboss",onclick:x(ra)},{text:"exposure",icon:"exposure",onclick:x(za)},
{type:"spacer",flex:1}]).hide();var la=M([{tooltip:"Crop",icon:"crop",onclick:x(ma)},{tooltip:"Resize",icon:"resize2",onclick:x(na)},{tooltip:"Orientation",icon:"orientation",onclick:x(oa)},{tooltip:"Brightness",icon:"sun",onclick:x(sa)},{tooltip:"Sharpen",icon:"sharpen",onclick:x(qa)},{tooltip:"Contrast",icon:"contrast",onclick:x(va)},{tooltip:"Color levels",icon:"drop",onclick:x(xa)},{tooltip:"Gamma",icon:"gamma",onclick:x(ya)},{tooltip:"Invert",icon:"invert",onclick:x(pa)}]);var U=b.create({flex:1,
imageSrc:h.url});var ia=l.create("Container",{layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){h=R.undo();r(h);B()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){h=R.redo();r(h);B()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var E=U.zoom();2>E&&(E+=.1);U.zoom(E)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var E=U.zoom();
.1<E&&(E-=.1);U.zoom(E)}}]});ia=l.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ia,U]});var ka=[la,ma,na,oa,Ba,pa,sa,ta,ua,va,Aa,wa,xa,qa,ra,ya,za];var P=z.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:e.min(d.DOM.getViewPort().w,800),minHeight:e.min(d.DOM.getViewPort().h,650),title:"Edit image",items:ka.concat([ia]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){A(h.blob);P.close()}},{text:"Cancel",
onclick:"close"}]});P.on("close",function(){u();q.each(R.data,v);N=R=null});R.add(h);B();U.on("load",function(){T=U.imageSize().w;aa=U.imageSize().h;ea=aa/T;fa=T/aa;P.find("#w").value(T);P.find("#h").value(aa)});U.on("crop",J)}return{edit:function(z,h){return new m(function(A,u){return h.toBlob().then(function(n){w(z,p(n),A,u)})})}}});C("tinymce.plugins.imagetools.core.Actions","ephox.imagetools.api.BlobConversions ephox.imagetools.api.ImageTransformations ephox.imagetools.api.ResultConversions ephox.katamari.api.Fun ephox.sand.api.URL global!clearTimeout tinymce.core.util.Delay tinymce.core.util.Promise tinymce.core.util.Tools tinymce.core.util.URI tinymce.plugins.imagetools.api.Settings tinymce.plugins.imagetools.core.ImageSize tinymce.plugins.imagetools.core.Proxy tinymce.plugins.imagetools.ui.Dialog".split(" "),
function(a,c,f,e,g,d,l,m,q,k,b,p,v,w){var z=0,h=function(r,x){return(x=x.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?r.dom.encode(x[1]):null},A=function(r,x){x=x.src;return 0===x.indexOf("data:")||0===x.indexOf("blob:")||(new k(x)).host===r.documentBaseURI.host},u=function(r){var x;if(x=r.editorUpload.blobCache.getByUri(r.selection.getNode().src))return m.resolve(x.blob());var D=r.selection.getNode();-1!==q.inArray(r.settings.imagetools_cors_hosts,(new k(D.src)).host)?r=v.getUrl(D.src,
null):A(r,D)?r=a.imageToBlob(D):(x=b.getProxyUrl(r),x+=(-1===x.indexOf("?")?"?":"&")+"url="+encodeURIComponent(D.src),r=r.settings.api_key||r.settings.imagetools_api_key,r=v.getUrl(x,r));return r},n=function(r,x){var D=l.setEditorTimeout(r,function(){r.editorUpload.uploadImagesAuto()},r.settings.images_upload_timeout||3E4);x.set(D)},y=function(r){d(r.get())},B=function(r,x,D,G){return x.toBlob().then(function(J){var F;var O=r.editorUpload.blobCache;var I=r.selection.getNode();var K=I.src;if(r.settings.images_reuse_filename)if(F=
O.getByUri(K)){K=F.uri();var Q=F.name()}else Q=h(r,K);F=O.create({id:"imagetools"+z++,blob:J,base64:x.toBase64(),uri:K,name:Q});O.add(F);r.undoManager.transact(function(){function M(){r.$(I).off("load",M);r.nodeChanged();D?r.editorUpload.uploadImagesAuto():(y(G),n(r,G))}r.$(I).on("load",M);r.$(I).attr({src:F.blobUri()}).removeAttr("data-mce-src")});return F})},t=function(r,x,D){return function(){return r._scanForImages().then(e.curry(u,r)).then(f.blobToImageResult).then(D).then(function(G){return B(r,
G,!1,x)},function(G){r.notificationManager.open({text:G,type:"error"})})}};return{rotate:function(r,x,D){return function(){return t(r,x,function(G){var J=p.getImageSize(r.selection.getNode());J&&p.setImageSize(r.selection.getNode(),{w:J.h,h:J.w});return c.rotate(G,D)})()}},flip:function(r,x,D){return function(){return t(r,x,function(G){return c.flip(G,D)})()}},editImageDialog:function(r,x){return function(){var D=r.selection.getNode(),G=p.getNaturalImageSize(D),J=function(F){return new m(function(O){a.blobToImage(F).then(function(I){var K=
p.getNaturalImageSize(I);(G.w!==K.w||G.h!==K.h)&&p.getImageSize(D)&&p.setImageSize(D,K);g.revokeObjectURL(I.src);O(F)})})};u(r).then(f.blobToImageResult).then(e.curry(function(F,O){return w.edit(F,O).then(J).then(f.blobToImageResult).then(function(I){return B(F,I,!0,x)},function(){})},r),function(F){r.notificationManager.open({text:F,type:"error"})})}},isEditableImage:function(r,x){return r.dom.is(x,"img:not([data-mce-object],[data-mce-placeholder])")&&(A(r,x)||-1!==q.inArray(r.settings.imagetools_cors_hosts,
(new k(x.src)).host)||r.settings.imagetools_proxy)},cancelTimedUpload:y}});C("tinymce.plugins.imagetools.api.Commands",["tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Actions"],function(a,c){return{register:function(f,e){a.each({mceImageRotateLeft:c.rotate(f,e,-90),mceImageRotateRight:c.rotate(f,e,90),mceImageFlipVertical:c.flip(f,e,"v"),mceImageFlipHorizontal:c.flip(f,e,"h"),mceEditImage:c.editImageDialog(f,e)},function(g,d){f.addCommand(d,g)})}}});C("tinymce.plugins.imagetools.core.UploadSelectedImage",
["tinymce.plugins.imagetools.core.Actions"],function(a){return{setup:function(c,f,e){c.on("NodeChange",function(g){var d=e.get();d&&d.src!==g.element.src&&(a.cancelTimedUpload(f),c.editorUpload.uploadImagesAuto(),e.set(null));a.isEditableImage(c,g.element)&&e.set(g.element)})}}});C("tinymce.plugins.imagetools.ui.Buttons",[],function(){return{register:function(a){a.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"});a.addButton("rotateright",{title:"Rotate clockwise",
cmd:"mceImageRotateRight"});a.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"});a.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"});a.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"});a.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}}});C("tinymce.plugins.imagetools.ui.ContextToolbar",["ephox.katamari.api.Fun","tinymce.plugins.imagetools.api.Settings","tinymce.plugins.imagetools.core.Actions"],function(a,
c,f){return{register:function(e){e.addContextToolbar(a.curry(f.isEditableImage,e),c.getToolbarItems(e))}}});C("tinymce.plugins.imagetools.Plugin","ephox.katamari.api.Cell tinymce.core.PluginManager tinymce.plugins.imagetools.api.Commands tinymce.plugins.imagetools.core.UploadSelectedImage tinymce.plugins.imagetools.ui.Buttons tinymce.plugins.imagetools.ui.ContextToolbar".split(" "),function(a,c,f,e,g,d){c.add("imagetools",function(l){var m=a(0),q=a(null);f.register(l,m);g.register(l);d.register(l);
e.setup(l,m,q)});return function(){}});ja("tinymce.plugins.imagetools.Plugin")()})();
