(function(){var u={},r=function(c,b,e){if("string"!==typeof c)throw"module id must be a string";if(void 0===b)throw"no dependencies for "+c;if(void 0===e)throw"no definition function for "+c;u[c]={deps:b,defn:e,instance:void 0}},w=function(c){var b=u[c];if(void 0===b)throw"module ["+c+"] was undefined";if(void 0===b.instance){for(var e=u[c],a=e.deps,f=e.defn,k=a.length,g=Array(k),p=0;p<k;++p)g[p]=w(a[p]);a=f.apply(null,g);if(void 0===a)throw"module ["+c+"] returned undefined";e.instance=a}return b.instance},
x=function(c,b){r(c,[],function(){return b})};r("ephox.katamari.api.Cell",[],function(){var c=function(b){var e=b;return{get:function(){return e},set:function(a){e=a},clone:function(){return c(e)}}};return c});x("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);r("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.PluginManager")});r("tinymce.plugins.textpattern.api.Api",[],function(){return{get:function(c){return{setPatterns:function(b){c.set(b)},
getPatterns:function(){return c.get()}}}}});r("tinymce.plugins.textpattern.api.Settings",[],function(){var c=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];
return{getPatterns:function(b){return void 0!==b.textpattern_patterns?b.textpattern_patterns:c}}});r("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.Delay")});r("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.util.VK")});x("global!document",document);r("tinymce.core.dom.TreeWalker",["global!tinymce.util.Tools.resolve"],function(c){return c("tinymce.dom.TreeWalker")});r("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(c){return c("tinymce.util.Tools")});r("tinymce.plugins.textpattern.core.Patterns",[],function(){var c=function(b){return b.sort(function(e,a){return e.start.length>a.start.length?-1:e.start.length<a.start.length?1:0})};return{findPattern:function(b,e){for(var a=0;a<b.length;a++)if(0===e.indexOf(b[a].start)&&(!b[a].end||e.lastIndexOf(b[a].end)===e.length-b[a].end.length))return b[a]},findEndPattern:function(b,e,a,f){var k,g=c(b);for(k=0;k<g.length;k++){b=g[k];var p;if(p=void 0!==b.end)p=b,
p=e.substr(a-p.end.length-f,p.end.length)===p.end;if(p&&0<a-f-b.end.length-b.start.length)return b}}}});r("tinymce.plugins.textpattern.core.Formatter",["global!document","tinymce.core.dom.TreeWalker","tinymce.core.util.Tools","tinymce.plugins.textpattern.core.Patterns"],function(c,b,e,a){var f=function(l,h,d,m,q){l=0<m?l.splitText(m):l;l.splitText(d-m+h.end.length);l.deleteData(0,h.start.length);l.deleteData(l.data.length-h.end.length,h.end.length);return l},k=function(l,h,d){if(!1!==h.collapsed){var m=
h.startContainer,q=m.data,n=!0===d?1:0;if(3===m.nodeType&&(d=a.findEndPattern(l,q,h.startOffset,n),void 0!==d&&(h=q.lastIndexOf(d.end,h.startOffset-n),n=q.lastIndexOf(d.start,h-d.end.length),h=q.indexOf(d.end,n+d.start.length),-1!==n&&(q=c.createRange(),q.setStart(m,n),q.setEnd(m,h+d.end.length),l=a.findPattern(l,q.toString()),!(void 0===d||l!==d||m.data.length<=d.start.length+d.end.length)))))return{pattern:d,startOffset:n,endOffset:h}}},g=function(l,h,d,m){var q=e.isArray(d.pattern.format)?d.pattern.format:
[d.pattern.format];if(0!==e.grep(q,function(n){return(n=l.formatter.get(n))&&n[0].inline}).length)return l.undoManager.transact(function(){h=f(h,d.pattern,d.endOffset,d.startOffset,m);q.forEach(function(n){l.formatter.apply(n,{},h)})}),h},p=function(l,h,d){var m=l.selection.getRng(!0);if(h=k(h,m,d))return g(l,m.startContainer,h,d)};return{patternFromRng:k,applyInlineFormatSpace:function(l,h){return p(l,h,!0)},applyInlineFormatEnter:function(l,h){return p(l,h,!1)},applyBlockFormat:function(l,h){var d,
m;var q=l.selection;var n=l.dom;if(q.isCollapsed()&&(n=n.getParent(q.getStart(),"p"))){for(m=new b(n,n);n=m.next();)if(3===n.nodeType){var t=n;break}if(t&&(d=a.findPattern(h,t.data))){m=q.getRng(!0);h=m.startContainer;var v=m.startOffset;t===h&&(v=Math.max(0,v-d.start.length));e.trim(t.data).length!==d.start.length&&(d.format&&(n=l.formatter.get(d.format))&&n[0].block&&(t.deleteData(0,d.start.length),l.formatter.apply(d.format,{},t),m.setStart(h,v),m.collapse(!0),q.setRng(m)),d.cmd&&l.undoManager.transact(function(){t.deleteData(0,
d.start.length);l.execCommand(d.cmd)}))}}}}});r("tinymce.plugins.textpattern.core.KeyHandler",["tinymce.core.util.VK","tinymce.plugins.textpattern.core.Formatter"],function(c,b){var e=function(a,f,k){for(var g=0;g<a.length;g++)if(k(a[g],f))return!0};return{handleEnter:function(a,f){var k;if(k=b.applyInlineFormatEnter(a,f)){var g=a.dom.createRng();g.setStart(k,k.data.length);g.setEnd(k,k.data.length);a.selection.setRng(g)}b.applyBlockFormat(a,f)},handleInlineKey:function(a,f){if(f=b.applyInlineFormatSpace(a,
f)){var k=a.dom;var g=f.data.slice(-1);/[\u00a0 ]/.test(g)&&(f.deleteData(f.data.length-1,1),g=k.doc.createTextNode(g),k.insertAfter(g,f.parentNode),f=k.createRng(),f.setStart(g,1),f.setEnd(g,1),a.selection.setRng(f))}},checkCharCode:function(a,f){return e(a,f,function(k,g){return k.charCodeAt(0)===g.charCode})},checkKeyCode:function(a,f){return e(a,f,function(k,g){return k===g.keyCode&&!1===c.modifierPressed(g)})}}});r("tinymce.plugins.textpattern.core.Keyboard",["tinymce.core.util.Delay","tinymce.core.util.VK",
"tinymce.plugins.textpattern.core.KeyHandler"],function(c,b,e){return{setup:function(a,f){var k=",.;:!?".split(""),g=[32];a.on("keydown",function(p){13!==p.keyCode||b.modifierPressed(p)||e.handleEnter(a,f.get())},!0);a.on("keyup",function(p){e.checkKeyCode(g,p)&&e.handleInlineKey(a,f.get())});a.on("keypress",function(p){e.checkCharCode(k,p)&&c.setEditorTimeout(a,function(){e.handleInlineKey(a,f.get())})})}}});r("tinymce.plugins.textpattern.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager",
"tinymce.plugins.textpattern.api.Api","tinymce.plugins.textpattern.api.Settings","tinymce.plugins.textpattern.core.Keyboard"],function(c,b,e,a,f){b.add("textpattern",function(k){var g=c(a.getPatterns(k.settings));f.setup(k,g);return e.get(g)});return function(){}});w("tinymce.plugins.textpattern.Plugin")()})();
