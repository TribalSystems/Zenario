(function(c){var r,s,e;c.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(a,b,c){return{x:Math.sin(a+b),y:Math.sin(a+3*Math.PI/2+b)/8*c,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+0.5}}}});r={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:0.4,maxOpacity:1,minScale:0.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:!0,clickToFocusCallback:function(){},
focusBearing:0,shape:"lazySusan",debug:!1,childSelector:"li",startingChild:null,reflect:!1,floatComparisonThreshold:0.001,autoplay:!1,autoplayDuration:1E3,autoplayPauseOnHover:!1,autoplayCallback:function(){},autoplayInitialDelay:0,enableDrag:!1,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:!0,triggerBlurEvents:!0,responsive:!1};s={autoplayInterval:null,autoplayIsRunning:!1,autoplayStartTimeout:null,animating:!1,
childInFocus:-1,touchMoveStartPosition:null,stopAnimation:!1,lastAnimationStep:!1};e={init:function(a,b,g){var d;(new Date).getTime();a="object"===typeof a?a:{};b=c.isFunction(b)?b:function(){};b=c.isFunction(a)?a:b;d=c.extend({},r,a,s);return this.each(function(){var a=c(this),l=a.children(d.childSelector).length,h=360/l,l=d.startingChild&&d.startingChild>l-1?l-1:d.startingChild,m=null===d.startingChild?d.bearing:360-l*h,n="static"!==a.css("position")?a.css("position"):"relative";a.css({padding:0,
position:n}).addClass("roundabout-holder").data("roundabout",c.extend({},d,{startingChild:l,bearing:m,oppositeOfFocusBearing:e.normalize.apply(null,[d.focusBearing-180]),dragBearing:m,period:h}));g?a.unbind(".roundabout").children(d.childSelector).unbind(".roundabout"):d.responsive&&c(window).bind("resize",function(){e.stopAutoplay.apply(a);e.relayoutChildren.apply(a)});d.clickToFocus&&a.children(d.childSelector).each(function(b){c(this).bind("click.roundabout",function(){var d=e.getPlacement.apply(a,
[b]);if(!e.isInFocus.apply(a,[d]))return e.stopAnimation.apply(c(this)),a.data("roundabout").animating||e.animateBearingToFocus.apply(a,[d,a.data("roundabout").clickToFocusCallback]),!1})});d.btnNext&&c(d.btnNext).bind("click.roundabout",function(){a.data("roundabout").animating||e.animateToNextChild.apply(a,[a.data("roundabout").btnNextCallback]);return!1});d.btnPrev&&c(d.btnPrev).bind("click.roundabout",function(){e.animateToPreviousChild.apply(a,[a.data("roundabout").btnPrevCallback]);return!1});
d.btnToggleAutoplay&&c(d.btnToggleAutoplay).bind("click.roundabout",function(){e.toggleAutoplay.apply(a);return!1});d.btnStartAutoplay&&c(d.btnStartAutoplay).bind("click.roundabout",function(){e.startAutoplay.apply(a);return!1});d.btnStopAutoplay&&c(d.btnStopAutoplay).bind("click.roundabout",function(){e.stopAutoplay.apply(a);return!1});d.autoplayPauseOnHover&&a.bind("mouseenter.roundabout.autoplay",function(){e.stopAutoplay.apply(a,[!0])}).bind("mouseleave.roundabout.autoplay",function(){e.startAutoplay.apply(a)});
d.enableDrag&&(c.isFunction(a.drag)?c.isFunction(a.drop)?a.drag(function(b,d){var c=a.data("roundabout"),g="x"===c.dragAxis.toLowerCase()?"deltaX":"deltaY";e.stopAnimation.apply(a);e.setBearing.apply(a,[c.dragBearing+d[g]/c.dragFactor])}).drop(function(b){b=a.data("roundabout");var d=e.getAnimateToMethod(b.dropAnimateTo);e.allowAnimation.apply(a);e[d].apply(a,[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*e.getNearestChild.apply(a)}):d.debug&&alert("You do not have the drop plugin loaded."):
d.debug&&alert("You do not have the drag plugin loaded."),a.each(function(){var a=c(this).get(0),b=c(this).data("roundabout"),d="x"===b.dragAxis.toLowerCase()?"pageX":"pageY",g=e.getAnimateToMethod(b.dropAnimateTo);a.addEventListener&&(a.addEventListener("touchstart",function(a){b.touchMoveStartPosition=a.touches[0][d]},!1),a.addEventListener("touchmove",function(a){var g=(a.touches[0][d]-b.touchMoveStartPosition)/b.dragFactor;a.preventDefault();e.stopAnimation.apply(c(this));e.setBearing.apply(c(this),
[b.dragBearing+g])},!1),a.addEventListener("touchend",function(a){a.preventDefault();e.allowAnimation.apply(c(this));g=e.getAnimateToMethod(b.dropAnimateTo);e[g].apply(c(this),[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*e.getNearestChild.apply(c(this))},!1))}));e.initChildren.apply(a,[b,g])})},initChildren:function(a,b){var g=c(this),d=g.data("roundabout");a=a||function(){};g.children(d.childSelector).each(function(a){var d,h,m,n=e.getPlacement.apply(g,[a]);b&&c(this).data("roundabout")&&
(d=c(this).data("roundabout").startWidth,h=c(this).data("roundabout").startHeight,m=c(this).data("roundabout").startFontSize);c(this).addClass("roundabout-moveable-item").css("position","absolute");c(this).data("roundabout",{startWidth:d||c(this).width(),startHeight:h||c(this).height(),startFontSize:m||parseInt(c(this).css("font-size"),10),degrees:n,backDegrees:e.normalize.apply(null,[n-180]),childNumber:a,currentScale:1,parent:g})});e.updateChildren.apply(g);d.autoplay&&(d.autoplayStartTimeout=setTimeout(function(){e.startAutoplay.apply(g)},
d.autoplayInitialDelay));g.trigger("ready");a.apply(g);return g},updateChildren:function(){return this.each(function(){var a=c(this),b=a.data("roundabout"),g=-1,d={bearing:b.bearing,tilt:b.tilt,stage:{width:Math.floor(0.9*c(this).width()),height:Math.floor(0.9*c(this).height())},animating:b.animating,inFocus:b.childInFocus,focusBearingRadian:e.degToRad.apply(null,[b.focusBearing]),shape:c.roundaboutShapes[b.shape]||c.roundaboutShapes[c.roundaboutShapes.def]};d.midStage={width:d.stage.width/2,height:d.stage.height/
2};d.nudge={width:d.midStage.width+0.05*d.stage.width,height:d.midStage.height+0.05*d.stage.height};d.zValues={min:b.minZ,max:b.maxZ,diff:b.maxZ-b.minZ};d.opacity={min:b.minOpacity,max:b.maxOpacity,diff:b.maxOpacity-b.minOpacity};d.scale={min:b.minScale,max:b.maxScale,diff:b.maxScale-b.minScale};a.children(b.childSelector).each(function(f){!e.updateChild.apply(a,[c(this),d,f,function(){c(this).trigger("ready")}])||d.animating&&!b.lastAnimationStep?c(this).removeClass("roundabout-in-focus"):(g=f,c(this).addClass("roundabout-in-focus"))});
g!==d.inFocus&&(b.triggerBlurEvents&&a.children(b.childSelector).eq(d.inFocus).trigger("blur"),b.childInFocus=g,b.triggerFocusEvents&&-1!==g&&a.children(b.childSelector).eq(g).trigger("focus"));a.trigger("childrenUpdated")})},updateChild:function(a,b,g,d){var f;a=c(a);var l=a.data("roundabout"),h=[];f=e.degToRad.apply(null,[360-l.degrees+b.bearing]);d=d||function(){};f=e.normalizeRad.apply(null,[f]);f=b.shape(f,b.focusBearingRadian,b.tilt);f.scale=1<f.scale?1:f.scale;f.adjustedScale=(b.scale.min+
b.scale.diff*f.scale).toFixed(4);f.width=(f.adjustedScale*l.startWidth).toFixed(4);f.height=(f.adjustedScale*l.startHeight).toFixed(4);a.css({left:(f.x*b.midStage.width+b.nudge.width-f.width/2).toFixed(0)+"px",top:(f.y*b.midStage.height+b.nudge.height-f.height/2).toFixed(0)+"px",width:f.width+"px",height:f.height+"px",opacity:(b.opacity.min+b.opacity.diff*f.scale).toFixed(2),zIndex:Math.round(b.zValues.min+b.zValues.diff*f.z),fontSize:(f.adjustedScale*l.startFontSize).toFixed(1)+"px"});l.currentScale=
f.adjustedScale;this.data("roundabout").debug&&(h.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+a.css("width")+'; background-color: #ffc;">'),h.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+g+"</strong><br />"),h.push("<strong>left:</strong> "+a.css("left")+"<br />"),h.push("<strong>top:</strong> "+a.css("top")+"<br />"),h.push("<strong>width:</strong> "+a.css("width")+"<br />"),h.push("<strong>opacity:</strong> "+a.css("opacity")+"<br />"),h.push("<strong>height:</strong> "+
a.css("height")+"<br />"),h.push("<strong>z-index:</strong> "+a.css("z-index")+"<br />"),h.push("<strong>font-size:</strong> "+a.css("font-size")+"<br />"),h.push("<strong>scale:</strong> "+a.data("roundabout").currentScale),h.push("</div>"),a.html(h.join("")));a.trigger("reposition");d.apply(this);return e.isInFocus.apply(this,[l.degrees])},setBearing:function(a,b){b=b||function(){};a=e.normalize.apply(null,[a]);this.each(function(){var b,d=c(this),f=d.data("roundabout"),l=f.bearing;f.bearing=a;
d.trigger("bearingSet");e.updateChildren.apply(d);b=Math.abs(l-a);!f.animating||180<b||(b=Math.abs(l-a),d.children(f.childSelector).each(function(b){e.isChildBackDegreesBetween.apply(c(this),[a,l])&&(b=l>a?"Clockwise":"Counterclockwise",c(this).trigger("move"+b+"ThroughBack"))}))});b.apply(this);return this},adjustBearing:function(a,b){b=b||function(){};if(0===a)return this;this.each(function(){e.setBearing.apply(c(this),[c(this).data("roundabout").bearing+a])});b.apply(this);return this},setTilt:function(a,
b){b=b||function(){};this.each(function(){c(this).data("roundabout").tilt=a;e.updateChildren.apply(c(this))});b.apply(this);return this},adjustTilt:function(a,b){b=b||function(){};this.each(function(){e.setTilt.apply(c(this),[c(this).data("roundabout").tilt+a])});b.apply(this);return this},animateToBearing:function(a,b,g,d,f){var l=(new Date).getTime();f=f||function(){};c.isFunction(d)?(f=d,d=null):c.isFunction(g)?(f=g,g=null):c.isFunction(b)&&(f=b,b=null);this.each(function(){var h,m,n=c(this),k=
n.data("roundabout"),p=b?b:k.duration,q=g?g:k.easing||"swing";d||(d={timerStart:l,start:k.bearing,totalTime:p});h=l-d.timerStart;k.stopAnimation?(e.allowAnimation.apply(n),k.animating=!1):h<p?(k.animating||n.trigger("animationStart"),k.animating=!0,"string"===typeof c.easing.def?(m=c.easing[q]||c.easing[c.easing.def],h=m(null,h,d.start,a-d.start,d.totalTime)):h=c.easing[q](h/d.totalTime,h,d.start,a-d.start,d.totalTime),0<=e.compareVersions.apply(null,[c().jquery,"1.7.2"])&&(h=d.start+(a-d.start)*
h),h=e.normalize.apply(null,[h]),k.dragBearing=h,e.setBearing.apply(n,[h,function(){setTimeout(function(){e.animateToBearing.apply(n,[a,p,q,d,f])},0)}])):(k.lastAnimationStep=!0,a=e.normalize.apply(null,[a]),e.setBearing.apply(n,[a,function(){n.trigger("animationEnd")}]),k.animating=!1,k.lastAnimationStep=!1,k.dragBearing=a,f.apply(n))});return this},animateToNearbyChild:function(a,b){var g=a[0],d=a[1],f=a[2]||function(){};c.isFunction(d)?(f=d,d=null):c.isFunction(g)&&(f=g,g=null);return this.each(function(){var a,
h,m,n=c(this),k=n.data("roundabout"),p=k.reflect?k.bearing:k.bearing%360,q=n.children(k.childSelector).length;if(!k.animating)if(k.reflect&&"previous"===b||!k.reflect&&"next"===b)for(p=Math.abs(p)<k.floatComparisonThreshold?360:p,m=0;m<q;m+=1){if(a=k.period*m,h=k.period*(m+1),h=m===q-1?360:h,p<=Math.ceil(h)&&p>=Math.floor(a)){2===q&&360===p?e.animateToDelta.apply(n,[-180,g,d,f]):e.animateBearingToFocus.apply(n,[a,g,d,f]);break}}else for(p=Math.abs(p)<k.floatComparisonThreshold||360-Math.abs(p)<k.floatComparisonThreshold?
0:p,m=q-1;0<=m;m-=1)if(a=k.period*m,h=k.period*(m+1),h=m===q-1?360:h,p>=Math.floor(a)&&p<Math.ceil(h)){2===q&&360===p?e.animateToDelta.apply(n,[180,g,d,f]):e.animateBearingToFocus.apply(n,[h,g,d,f]);break}})},animateToNearestChild:function(a,b,g){g=g||function(){};c.isFunction(b)?(g=b,b=null):c.isFunction(a)&&(g=a,a=null);return this.each(function(){var d=e.getNearestChild.apply(c(this));e.animateToChild.apply(c(this),[d,a,b,g])})},animateToChild:function(a,b,g,d){d=d||function(){};c.isFunction(g)?
(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var f,l=c(this);f=l.data("roundabout");f.childInFocus===a||f.animating||(f=l.children(f.childSelector).eq(a),e.animateBearingToFocus.apply(l,[f.data("roundabout").degrees,b,g,d]))})},animateToNextChild:function(a,b,c){return e.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(a,b,c){return e.animateToNearbyChild.apply(this,[arguments,"previous"])},animateToDelta:function(a,b,g,d){d=d||function(){};
c.isFunction(g)?(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var f=c(this).data("roundabout").bearing+a;e.animateToBearing.apply(c(this),[f,b,g,d])})},animateBearingToFocus:function(a,b,g,d){d=d||function(){};c.isFunction(g)?(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var f=c(this).data("roundabout").bearing-a,f=Math.abs(360-f)<Math.abs(f)?360-f:-f,f=180<f?-(360-f):f;0!==f&&e.animateToDelta.apply(c(this),[f,b,g,d])})},stopAnimation:function(){return this.each(function(){c(this).data("roundabout").stopAnimation=
!0})},allowAnimation:function(){return this.each(function(){c(this).data("roundabout").stopAnimation=!1})},startAutoplay:function(a){return this.each(function(){var b=c(this),g=b.data("roundabout");a=a||g.autoplayCallback||function(){};clearInterval(g.autoplayInterval);g.autoplayInterval=setInterval(function(){e.animateToNextChild.apply(b,[a])},g.autoplayDuration);g.autoplayIsRunning=!0;b.trigger("autoplayStart")})},stopAutoplay:function(a){return this.each(function(){clearInterval(c(this).data("roundabout").autoplayInterval);
c(this).data("roundabout").autoplayInterval=null;c(this).data("roundabout").autoplayIsRunning=!1;a||c(this).unbind(".autoplay");c(this).trigger("autoplayStop")})},toggleAutoplay:function(a){return this.each(function(){var b=c(this).data("roundabout");a=a||b.autoplayCallback||function(){};e.isAutoplaying.apply(c(this))?e.stopAutoplay.apply(c(this),[a]):e.startAutoplay.apply(c(this),[a])})},isAutoplaying:function(){return this.data("roundabout").autoplayIsRunning},changeAutoplayDuration:function(a){return this.each(function(){var b=
c(this);b.data("roundabout").autoplayDuration=a;e.isAutoplaying.apply(b)&&(e.stopAutoplay.apply(b),setTimeout(function(){e.startAutoplay.apply(b)},10))})},normalize:function(a){a%=360;return 0>a?360+a:a},normalizeRad:function(a){for(;0>a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;return a},isChildBackDegreesBetween:function(a,b){var g=c(this).data("roundabout").backDegrees;return a>b?g>=b&&g<a:g<b&&g>=a},getAnimateToMethod:function(a){a=a.toLowerCase();return"next"===a?"animateToNextChild":"previous"===
a?"animateToPreviousChild":"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var a=c(this),b=c.extend({},a.data("roundabout"));b.startingChild=a.data("roundabout").childInFocus;e.init.apply(a,[b,null,!0])})},getNearestChild:function(){var a=c(this),b=a.data("roundabout"),a=a.children(b.childSelector).length;return b.reflect?Math.round(b.bearing/b.period)%a:(a-Math.round(b.bearing/b.period)%a)%a},degToRad:function(a){return e.normalize.apply(null,[a])*Math.PI/180},getPlacement:function(a){var b=
this.data("roundabout");return b.reflect?b.period*a:360-b.period*a},isInFocus:function(a){var b=this.data("roundabout"),c=e.normalize.apply(null,[b.bearing]);a=e.normalize.apply(null,[a]);a=Math.abs(c-a);return a<=b.floatComparisonThreshold||a>=360-b.floatComparisonThreshold},getChildInFocus:function(){var a=c(this).data("roundabout");return-1<a.childInFocus?a.childInFocus:!1},compareVersions:function(a,b){var c,d=a.split(/\./i),f=b.split(/\./i),e=d.length>f.length?d.length:f.length;for(c=0;c<=e;c++){if(d[c]&&
!f[c]&&0!==parseInt(d[c],10))return 1;if(f[c]&&!d[c]&&0!==parseInt(f[c],10))return-1;if(d[c]!==f[c]&&d[c]&&f[c])return parseInt(d[c],10)>parseInt(f[c],10)?1:-1}return 0}};c.fn.roundabout=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||c.isFunction(a)||!a)return e.init.apply(this,arguments);c.error("Method "+a+" does not exist for jQuery.roundabout.")}})(jQuery);
