(function(b){function m(a,c){this.element=a;this.options=b.extend(!0,{},r,c);this.updatePlaceholder=!0;"placeholder"in this.options&&(this.options.texts.placeholder=this.options.placeholder,delete this.options.placeholder);"default"in this.options.searchOptions&&(this.options.texts.search=this.options.searchOptions["default"],delete this.options.searchOptions["default"]);this.load()}var r={columns:1,search:!1,searchOptions:{delay:250,showOptGroups:!1,onSearch:function(a){}},texts:{placeholder:"Select options",
search:"Search",selectedOptions:" selected",selectAll:"Select all",unselectAll:"Unselect all",noneSelected:"None Selected"},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,showCheckbox:!0,jqActualOpts:{},optionAttributes:[],onLoad:function(a){},onOptionClick:function(a,b){},onControlClose:function(a){},maxWidth:null,minSelect:!1,maxSelect:!1},h=1;"function"!==typeof Array.prototype.map&&(Array.prototype.map=function(a,c){"undefined"===typeof c&&(c=this);return b.isArray(c)?b.map(c,a):[]});
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});m.prototype={load:function(){var a=this;if("SELECT"!=a.element.nodeName||b(a.element).hasClass("jqmsLoaded"))return!0;b(a.element).addClass("jqmsLoaded").data("plugin_multiselect-instance",a);b(a.element).after('<div class="ms-options-wrap"><button>None Selected</button><div class="ms-options"><ul></ul></div></div>');var c=b(a.element).next(".ms-options-wrap").find("> button:first-child"),
d=b(a.element).next(".ms-options-wrap").find("> .ms-options"),e=d.find("> ul");b(a.element).find("optgroup");a.options.showCheckbox||d.addClass("hide-checkbox");b(a.element).prop("disabled")&&c.prop("disabled",!0);var n=null;"number"==typeof a.options.width?(d.parent().css("position","relative"),n=a.options.width):"string"==typeof a.options.width?(b(a.options.width).css("position","relative"),n="100%"):d.parent().css("position","relative");var g=b(window).height()-d.offset().top+b(window).scrollTop()-
20;a.options.maxHeight&&(g=a.options.maxHeight);g=g<a.options.minHeight?a.options.minHeight:g;d.css({maxWidth:n,minHeight:a.options.minHeight,maxHeight:g,overflow:"auto"}).hide();d.bind("touchmove mousewheel DOMMouseScroll",function(a){if(b(this).outerHeight()<b(this)[0].scrollHeight){var c=a.originalEvent,c=c.wheelDelta||-c.detail;b(this).outerHeight()+b(this)[0].scrollTop>b(this)[0].scrollHeight&&(a.preventDefault(),this.scrollTop+=0>c?1:-1)}});b(document).off("click.ms-hideopts").on("click.ms-hideopts",
function(a){b(a.target).closest(".ms-options-wrap").length||b(".ms-options-wrap > .ms-options:visible").length&&b(".ms-options-wrap > .ms-options:visible").each(function(){b(this).hide();var a=b(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)})});c.bind("mousedown",function(c){if(1!=c.which)return!0;b(".ms-options-wrap > .ms-options:visible").each(function(){if(b(this).parent().prev()[0]!=d.parent().prev()[0]){b(this).hide();
var a=b(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)}});d.toggle();if(d.is(":visible"))d.css("maxHeight",""),c=b(window).height()-d.offset().top+b(window).scrollTop()-20,a.options.maxHeight&&(c=a.options.maxHeight),c=c<a.options.minHeight?a.options.minHeight:c,d.css("maxHeight",c);else if("function"==typeof a.options.onControlClose)a.options.onControlClose(a.element)}).click(function(a){a.preventDefault()});
a.options.texts.overridePlaceholder?c.text(a.options.texts.overridePlaceholder):a.options.texts.placeholder&&c.text(a.options.texts.placeholder);if(a.options.search){e.before('<div class="ms-search"><input type="text" value="" placeholder="'+a.options.texts.search+'" /></div>');var p=d.find(".ms-search input");p.on("keyup",function(){if(b(this).data("lastsearch")==b(this).val())return!0;b(this).data("searchTimeout")&&clearTimeout(b(this).data("searchTimeout"));var c=b(this);b(this).data("searchTimeout",
setTimeout(function(){c.data("lastsearch",c.val());if("function"==typeof a.options.searchOptions.onSearch)a.options.searchOptions.onSearch(a.element);e.find("li:not(.optgroup)").each(function(){-1<b(this).text().toLowerCase().indexOf(p.val().toLowerCase())?b(this).show():b(this).hasClass("selected")||b(this).hide();var c=b(this).closest("li.optgroup");!a.options.searchOptions.showOptGroups&&c&&(c.show(),c.find("li:visible").length?c.show():c.hide())});a._updateSelectAllText()},a.options.searchOptions.delay))})}a.options.selectAll&&
e.before('<a href="#" class="ms-selectall global">'+a.options.texts.selectAll+"</a>");d.on("click",".ms-selectall",function(c){c.preventDefault();a.updatePlaceholder=!1;b(this).hasClass("global")?e.find("li:not(.optgroup)").filter(":not(.selected)").filter(":visible").length?e.find("li:not(.optgroup)").filter(":not(.selected)").filter(":visible").find('input[type="checkbox"]').trigger("click"):e.find('li:not(.optgroup).selected:visible input[type="checkbox"]').trigger("click"):b(this).closest("li").hasClass("optgroup")&&
(c=b(this).closest("li.optgroup"),c.find("li:not(.selected)").filter(":visible").length?c.find('li:not(.selected):visible input[type="checkbox"]').trigger("click"):c.find('li.selected:visible input[type="checkbox"]').trigger("click"));a._updateSelectAllText();a.updatePlaceholder=!0;a._updatePlaceholderText()});var f=[];b(a.element).children().each(function(){if("OPTGROUP"==this.nodeName){var c=[];b(this).children("option").each(function(){for(var d={},e=0;e<a.options.optionAttributes.length;e++){var f=
a.options.optionAttributes[e];void 0!==b(this).attr(f)&&(d[f]=b(this).attr(f))}c.push({name:b(this).text(),value:b(this).val(),checked:b(this).prop("selected"),attributes:d})});f.push({label:b(this).attr("label"),options:c})}else if("OPTION"==this.nodeName){for(var d={},e=0;e<a.options.optionAttributes.length;e++){var g=a.options.optionAttributes[e];void 0!==b(this).attr(g)&&(d[g]=b(this).attr(g))}f.push({name:b(this).text(),value:b(this).val(),checked:b(this).prop("selected"),attributes:d})}else return!0});
a.loadOptions(f,!0,!1);a._updateSelectAllText(!1);d.on("click",'input[type="checkbox"]',function(){b(this).closest("li").toggleClass("selected");d.parent().prev().find('option[value="'+b(this).val()+'"]').prop("selected",b(this).is(":checked")).closest("select").trigger("change");if("function"==typeof a.options.onOptionClick)a.options.onOptionClick(a.element,this);a._updateSelectAllText();a._updatePlaceholderText()});d.on("focusin",'input[type="checkbox"]',function(){b(this).closest("label").addClass("focused")}).on("focusout",
'input[type="checkbox"]',function(){b(this).closest("label").removeClass("focused")});if("function"===typeof a.options.onLoad)a.options.onLoad(a.element);b(a.element).hide()},loadOptions:function(a,c,d){c="boolean"==typeof c?c:!0;d="boolean"==typeof d?d:!0;var e=b(this.element).next(".ms-options-wrap").find("> .ms-options > ul"),n=b(this.element).next(".ms-options-wrap").find("> .ms-options"),g=n.parent().prev();c&&(e.find("> li").remove(),d&&g.find("> *").remove());for(var p in a)if(a.hasOwnProperty(p)){var f=
a[p],k=b("<li></li>"),h=!0;if(f.hasOwnProperty("options")){e.find("> li.optgroup > span.label").each(function(){b(this).text()==f.label&&(k=b(this).closest(".optgroup"),h=!1)});if(d)if(g.find('optgroup[label="'+f.label+'"]').length)var m=g.find('optgroup[label="'+f.label+'"]');else m=b('<optgroup label="'+f.label+'"></optgroup>'),g.append(m);h&&(k.addClass("optgroup"),k.append('<span class="label">'+f.label+"</span>"),k.find("> .label").css({clear:"both"}),this.options.selectGroup&&k.append('<a href="#" class="ms-selectall">'+
this.options.texts.selectAll+"</a>"),k.append("<ul></ul>"));for(var q in f.options)if(f.options.hasOwnProperty(q)){c=f.options[q];var l=b("<li></li>").addClass("ms-reflow");c.hasOwnProperty("value")&&(this._addOption(l,c),k.find("> ul").append(l),d&&(l=b('<option value="'+c.value+'">'+c.name+"</option>"),c.hasOwnProperty("attributes")&&Object.keys(c.attributes),c.checked&&l.prop("selected",!0),m.append(l)))}}else if(f.hasOwnProperty("value"))k.addClass("ms-reflow"),this._addOption(k,f),d&&(l=b('<option value="'+
f.value+'">'+f.name+"</option>"),f.hasOwnProperty("attributes")&&Object.keys(f.attributes).length&&l.attr(f.attributes),f.checked&&l.prop("selected",!0),g.append(l));else continue;h&&e.append(k)}e.find('.ms-reflow input[type="checkbox"]').each(function(a){b(this).css("display").match(/block$/)&&(a=(a=b(this).outerWidth())?a:15,b(this).closest("label").css("padding-left",2*parseInt(b(this).closest("label").css("padding-left"))+a),b(this).closest(".ms-reflow").removeClass("ms-reflow"))});this._updatePlaceholderText();
n.find("ul").css({"column-count":"","column-gap":"","-webkit-column-count":"","-webkit-column-gap":"","-moz-column-count":"","-moz-column-gap":""});g.find("optgroup").length?(e.find("> li:not(.optgroup)").css({"float":"left",width:100/this.options.columns+"%"}),e.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":this.options.columns,"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),
this._ieVersion()&&10>this._ieVersion()&&e.find("li.optgroup > ul > li").css({"float":"left",width:100/this.options.columns+"%"})):(e.css({"column-count":this.options.columns,"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),this._ieVersion()&&10>this._ieVersion()&&e.find("> li").css({"float":"left",width:100/this.options.columns+"%"}))},settings:function(a){this.options=b.extend(!0,{},this.options,a);this.reload()},
unload:function(){b(this.element).next(".ms-options-wrap").remove();b(this.element).show(function(){b(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){b(this.element).next(".ms-options-wrap").remove();b(this.element).removeClass("jqmsLoaded");this.load()},reset:function(){var a=[];b(this.element).find("option").each(function(){b(this).prop("defaultSelected")&&a.push(b(this).val())});b(this.element).val(a);this.reload()},disable:function(a){a="boolean"!==typeof a?!0:!1;b(this.element).prop("disabled",
a);b(this.element).next(".ms-options-wrap").find("button:first-child").prop("disabled",a)},_updateSelectAllText:function(a){"boolean"!==typeof a&&(a=!0);var c=this;(c.options.selectAll||c.options.selectGroup)&&b(c.element).next(".ms-options-wrap").find("> .ms-options").find(".ms-selectall").each(function(){var d=b(this).parent().find("li:not(.optgroup)").filter(":not(.selected)");a&&(d=d.filter(":visible"));b(this).text(d.length?c.options.texts.selectAll:c.options.texts.unselectAll)})},_updatePlaceholderText:function(){if(this.updatePlaceholder){var a=
b(this.element).next(".ms-options-wrap").find("> button:first-child"),c=b(this.element).next(".ms-options-wrap").find("> .ms-options"),d=[];c.parent().prev().find("option:selected").each(function(){d.push(b(this).text())});a.text(d.join(", "));var c=a.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo(c.parent()),e="undefined"!==typeof b.fn.actual?c.actual("width",this.options.jqActualOpts):c.width(),h="undefined"!==typeof b.fn.actual?a.actual("width",this.options.jqActualOpts):
a.width();e>h?a.text(d.length+this.options.texts.selectedOptions):d.length?a.text(d.map(function(a){return a.trim()}).join(", ")):a.text(this.options.texts.placeholder);this.options.texts.overridePlaceholder&&a.text(this.options.texts.overridePlaceholder);c.remove()}},_addOption:function(a,c){a.text(c.name);var d=b('<input type="checkbox" value="" title="" />').val(c.value).attr("title",c.name).attr("id","ms-opt-"+h);c.hasOwnProperty("attributes")&&Object.keys(c.attributes).length&&d.attr(c.attributes);
a.prepend(d);c.checked&&(a.addClass("default"),a.addClass("selected"),a.find('input[type="checkbox"]').prop("checked",!0));d=b("<label></label>").attr("for","ms-opt-"+h);a.wrapInner(d);h+=1},_ieVersion:function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")?parseInt(a.split("msie")[1]):!1}};b.fn.multiselect=function(a){var c=arguments,d;if(void 0===a||"object"===typeof a)return this.each(function(){b.data(this,"plugin_multiselect")||b.data(this,"plugin_multiselect",new m(this,
a))});if("string"===typeof a&&"_"!==a[0]&&"init"!==a)return this.each(function(){var e=b.data(this,"plugin_multiselect");e instanceof m&&"function"===typeof e[a]&&(d=e[a].apply(e,Array.prototype.slice.call(c,1)));"unload"===a&&b.data(this,"plugin_multiselect",null)}),d}})(jQuery);
