(function(d){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload"],d):"object"===typeof exports?d(require("jquery")):d(window.jQuery)})(function(d){var k=d.blueimp.fileupload.prototype.options.add;d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{processQueue:[],add:function(b,a){var c=d(this);a.process(function(){return c.fileupload("process",a)});k.call(this,b,a)}},processActions:{},_processFile:function(b,a){var c=this,e=d.Deferred().resolveWith(c,[b]).promise();
this._trigger("process",null,b);d.each(b.processQueue,function(b,f){var h=function(b){return a.errorThrown?d.Deferred().rejectWith(c,[a]).promise():c.processActions[f.action].call(c,b,f)};e=e.pipe(h,f.always&&h)});e.done(function(){c._trigger("processdone",null,b);c._trigger("processalways",null,b)}).fail(function(){c._trigger("processfail",null,b);c._trigger("processalways",null,b)});return e},_transformProcessQueue:function(b){var a=[];d.each(b.processQueue,function(){var c={},e=this.action,g=!0===
this.prefix?e:this.prefix;d.each(this,function(a,e){"string"===d.type(e)&&"@"===e.charAt(0)?c[a]=b[e.slice(1)||(g?g+a.charAt(0).toUpperCase()+a.slice(1):a)]:c[a]=e});a.push(c)});b.processQueue=a},processing:function(){return this._processing},process:function(b){var a=this,c=d.extend({},this.options,b);c.processQueue&&c.processQueue.length&&(this._transformProcessQueue(c),0===this._processing&&this._trigger("processstart"),d.each(b.files,function(e){var g=e?d.extend({},c):c,f=function(){return b.errorThrown?
d.Deferred().rejectWith(a,[b]).promise():a._processFile(g,b)};g.index=e;a._processing+=1;a._processingQueue=a._processingQueue.pipe(f,f).always(function(){a._processing-=1;0===a._processing&&a._trigger("processstop")})}));return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=d.Deferred().resolveWith(this).promise()}})});
