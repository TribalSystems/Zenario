tinymce.PluginManager.add("image",function(b){function w(b,g){function n(b,a){d.parentNode&&d.parentNode.removeChild(d);g({width:b,height:a})}var d=document.createElement("img");d.onload=function(){n(d.clientWidth,d.clientHeight)};d.onerror=function(){n()};var k=d.style;k.visibility="hidden";k.position="fixed";k.bottom=k.left=0;k.width=k.height="auto";document.body.appendChild(d);d.src=b}function v(b,g,n){function d(b,e){e=e||[];tinymce.each(b,function(a){var b={text:a.text||a.title};a.menu?b.menu=
d(a.menu):(b.value=a.value,g(b));e.push(b)});return e}return d(b,n||[])}function p(l){return function(){var g=b.settings.image_list;"string"==typeof g?tinymce.util.XHR.send({url:g,success:function(b){l(tinymce.util.JSON.parse(b))}}):"function"==typeof g?g(l):l(g)}}function u(l){function g(){var b,a,c,q;b=e.find("#width")[0];a=e.find("#height")[0];b&&a&&(c=b.value(),q=a.value(),e.find("#constrain")[0].checked()&&m&&r&&c&&q&&(m!=c?(q=Math.round(c/m*q),a.value(q)):(c=Math.round(q/r*c),b.value(c))),m=
c,r=q)}function n(){function h(h){function c(){h.onload=h.onerror=null;b.selection&&(b.selection.select(h),b.nodeChanged())}h.onload=function(){a.width||a.height||!p||f.setAttribs(h,{width:h.clientWidth,height:h.clientHeight});c()};h.onerror=c}k();g();a=tinymce.extend(a,e.toJSON());a.alt||(a.alt="");""===a.width&&(a.width=null);""===a.height&&(a.height=null);a.style||(a.style=null);""===a.align&&(a.align=null);a={src:a.src,alt:a.alt,width:a.width,height:a.height,style:a.style,"class":a["class"],align:a.align};
b.undoManager.transact(function(){a.src?(c?f.setAttribs(c,a):(a.id="__mcenew",b.focus(),b.selection.setContent(f.createHTML("img",a)),c=f.get("__mcenew"),f.setAttrib(c,"id",null)),h(c)):c&&(f.remove(c),b.focus(),b.nodeChanged())})}function d(b){b&&(b=b.replace(/px$/,""));return b}function k(){function a(b){0<b.length&&/^[0-9]+$/.test(b)&&(b+="px");return b}if(b.settings.image_advtab){var c=e.toJSON(),d=f.parseStyle(c.style);delete d.margin;d["margin-top"]=d["margin-bottom"]=a(c.vspace);d["margin-left"]=
d["margin-right"]=a(c.hspace);d["border-width"]=a(c.border);e.find("#style").value(f.serializeStyle(f.parseStyle(f.serializeStyle(d))))}}var e,a={},f=b.dom,c=b.selection.getNode(),m,r,t,p=!1!==b.settings.image_dimensions;m=f.getAttrib(c,"width");r=f.getAttrib(c,"height");"IMG"!=c.nodeName||c.getAttribute("data-mce-object")||c.getAttribute("data-mce-placeholder")?c=null:a={src:f.getAttrib(c,"src"),alt:f.getAttrib(c,"alt"),align:f.getAttrib(c,"align"),"class":f.getAttrib(c,"class"),width:m,height:r};
l&&(t={type:"listbox",label:"Image list",values:v(l,function(a){a.value=b.convertURL(a.value||a.url,"src")},[{text:"None",value:""}]),value:a.src&&b.convertURL(a.src,"src"),onselect:function(b){var a=e.find("#alt");(!a.value()||b.lastControl&&a.value()==b.lastControl.text())&&a.value(b.control.text());e.find("#src").value(b.control.value()).fire("change")},onPostRender:function(){t=this}});l=b.settings.image_class_list?{name:"class",type:"listbox",label:"Class",values:v(b.settings.image_class_list,
function(a){a.value&&(a.textStyle=function(){return b.formatter.getCssText({inline:"img",classes:[a.value]})})})}:{name:"class",type:"textbox",size:40,label:"CSS class name(s)"};var s=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(a){a=a.meta||{};t&&t.value(b.convertURL(this.value(),"src"));tinymce.each(a,function(a,b){e.find("#"+b).value(a)});if(!a.width&&!a.height){a=this.value();var c=/^(?:[a-z]+:)?\/\//i,d=b.settings.document_base_url;d&&!c.test(a)&&
a.substring(0,d.length)!==d&&this.value(d+a);w(this.value(),function(a){a.width&&a.height&&p&&(m=a.width,r=a.height,e.find("#width").value(m),e.find("#height").value(r))})}}},t];!1!==b.settings.image_description&&s.push({name:"alt",type:"textbox",label:"Image description",classes:"image_alt"});p&&s.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:g,ariaLabel:"Width"},{type:"label",text:"x"},
{name:"height",type:"textbox",maxLength:5,size:3,onchange:g,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});s.push(l);s.push({type:"listbox",name:"align",label:"Alignment",values:[{text:"-- Not Set --",value:""},{text:"Left",value:"left"},{text:"Right",value:"right"},{text:"Middle",value:"middle"},{text:"Top",value:"top"},{text:"Bottom",value:"bottom"}]});b.settings.image_advtab?(c&&(a.hspace=d(c.style.marginLeft||c.style.marginRight),a.vspace=d(c.style.marginTop||
c.style.marginBottom),a.border=d(c.style.borderWidth),a.style=b.dom.serializeStyle(b.dom.parseStyle(b.dom.getAttrib(c,"style")))),e=b.windowManager.open({title:"Insert/edit image",data:a,bodyType:"tabpanel",body:[{title:"General",type:"form",items:s},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:k},items:[{label:"Vertical space",
name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:n})):e=b.windowManager.open({title:"Insert/edit image",data:a,body:s,onSubmit:n})}b.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:p(u),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"});b.addMenuItem("image",{icon:"image",text:"Insert/edit image",onclick:p(u),context:"insert",prependToContext:!0});b.addCommand("mceImage",p(u))});
