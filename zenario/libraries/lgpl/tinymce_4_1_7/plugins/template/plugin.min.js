tinymce.PluginManager.add("template",function(c){function k(a){return function(){var b=c.settings.templates;"string"==typeof b?tinymce.util.XHR.send({url:b,success:function(b){a(tinymce.util.JSON.parse(b))}}):a(b)}}function m(a){function b(a){function b(a){if(-1==a.indexOf("<html>")){var d="";tinymce.each(c.contentCSS,function(a){d+='<link type="text/css" rel="stylesheet" href="'+c.documentBaseURI.toAbsolute(a)+'">'});a="<!DOCTYPE html><html><head>"+d+"</head><body>"+a+"</body></html>"}a=n(a,"template_preview_replace_values");
var f=e.find("iframe")[0].getEl().contentWindow.document;f.open();f.write(a);f.close()}var d=a.control.value();d.url?tinymce.util.XHR.send({url:d.url,success:function(a){g=a;b(g)}}):(g=d.content,b(g));e.find("#description")[0].text(a.control.value().description)}var e,d=[],g;a&&0!==a.length?(tinymce.each(a,function(a){d.push({selected:!d.length,text:a.title,value:{url:a.url,content:a.content,description:a.description}})}),e=c.windowManager.open({title:"Insert template",layout:"flex",direction:"column",
align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:d,onselect:b}}]},{type:"label",name:"description",label:"Description",text:"\u00a0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){p(!1,g)},width:c.getParam("template_popup_width",600),height:c.getParam("template_popup_height",500)}),e.find("listbox")[0].fire("select")):c.windowManager.alert("No templates defined")}
function l(a,b){function e(a,b){a=""+a;if(a.length<b)for(var c=0;c<b-a.length;c++)a="0"+a;return a}b=b||new Date;a=a.replace("%D","%m/%d/%Y");a=a.replace("%r","%I:%M:%S %p");a=a.replace("%Y",""+b.getFullYear());a=a.replace("%y",""+b.getYear());a=a.replace("%m",e(b.getMonth()+1,2));a=a.replace("%d",e(b.getDate(),2));a=a.replace("%H",""+e(b.getHours(),2));a=a.replace("%M",""+e(b.getMinutes(),2));a=a.replace("%S",""+e(b.getSeconds(),2));a=a.replace("%I",""+((b.getHours()+11)%12+1));a=a.replace("%p",
""+(12>b.getHours()?"AM":"PM"));a=a.replace("%B",""+c.translate("January February March April May June July August September October November December".split(" ")[b.getMonth()]));a=a.replace("%b",""+c.translate("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[b.getMonth()]));a=a.replace("%A",""+c.translate("Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ")[b.getDay()]));a=a.replace("%a",""+c.translate("Sun Mon Tue Wed Thu Fri Sat Sun".split(" ")[b.getDay()]));
return a=a.replace("%%","%")}function q(a){var b=c.dom,e=c.getParam("template_replace_values");h(b.select("*",a),function(a){h(e,function(c,f){if(b.hasClass(a,f)&&"function"==typeof e[f])e[f](a)})})}function n(a,b){h(c.getParam(b),function(b,c){"function"!=typeof b&&(a=a.replace(RegExp("\\{\\$"+c+"\\}","g"),b))});return a}function p(a,b){function e(a,b){return RegExp("\\b"+b+"\\b","g").test(a.className)}var d,g,f=c.dom,k=c.selection.getContent();b=n(b,"template_replace_values");d=f.create("div",null,
b);(g=f.select(".mceTmpl",d))&&0<g.length&&(d=f.create("div",null),d.appendChild(g[0].cloneNode(!0)));h(f.select("*",d),function(a){e(a,c.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(c.getParam("template_cdate_format",c.getLang("template.cdate_format"))));e(a,c.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(c.getParam("template_mdate_format",c.getLang("template.mdate_format"))));e(a,c.getParam("template_selected_content_classes",
"selcontent").replace(/\s+/g,"|"))&&(a.innerHTML=k)});q(d);c.execCommand("mceInsertContent",!1,d.innerHTML);c.addVisual()}var h=tinymce.each;c.addCommand("mceInsertTemplate",p);c.addButton("template",{title:"Insert template",onclick:k(m)});c.addMenuItem("template",{text:"Insert template",onclick:k(m),context:"insert"});c.on("PreProcess",function(a){var b=c.dom;h(b.select("div",a.node),function(a){b.hasClass(a,"mceTmpl")&&(h(b.select("*",a),function(a){b.hasClass(a,c.getParam("template_mdate_classes",
"mdate").replace(/\s+/g,"|"))&&(a.innerHTML=l(c.getParam("template_mdate_format",c.getLang("template.mdate_format"))))}),q(a))})})});
