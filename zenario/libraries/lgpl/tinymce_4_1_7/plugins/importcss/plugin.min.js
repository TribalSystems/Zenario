tinymce.PluginManager.add("importcss",function(e){function l(b){return"string"==typeof b?function(a){return-1!==a.indexOf(b)}:b instanceof RegExp?function(a){return b.test(a)}:b}function q(b,a){function f(c,r){var b=c.href,e;if(b&&a(b,r)){d(c.imports,function(a){f(a,!0)});try{e=c.cssRules||c.rules}catch(h){}d(e,function(a){a.styleSheet?f(a.styleSheet,!0):a.selectorText&&d(a.selectorText.split(","),function(a){g.push(tinymce.trim(a))})})}}var g=[],h={};d(e.contentCSS,function(a){h[a]=!0});a||(a=function(a,
b){return b||h[a]});try{d(b.styleSheets,function(a){f(a)})}catch(m){}return g}function n(b){var a,f=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(b);if(f){var g=f[1],h=f[2].substr(1).split(".").join(" "),d=tinymce.makeMap("a,img");f[1]?(a={title:b},e.schema.getTextBlockElements()[g]?a.block=g:e.schema.getBlockElements()[g]||d[g.toLowerCase()]?a.selector=g:a.inline=g):f[2]&&(a={inline:"span",title:b.substr(1),classes:h});!1!==e.settings.importcss_merge_classes?a.classes=h:a.attributes={"class":h};
return a}}var p=this,d=tinymce.each;e.on("renderFormatsMenu",function(b){var a=e.settings,f={},g=a.importcss_selector_converter||n,h=l(a.importcss_selector_filter),m=b.control;e.settings.importcss_append||m.items().remove();var c=[];tinymce.each(a.importcss_groups,function(a){a=tinymce.extend({},a);a.filter=l(a.filter);c.push(a)});d(q(b.doc||e.getDoc(),l(a.importcss_file_filter)),function(a){if(-1===a.indexOf(".mce-")&&!f[a]&&(!h||h(a))){var b=g.call(p,a),d;if(b){var l=b.name||tinymce.DOM.uniqueId();
if(c)for(var k=0;k<c.length;k++)if(!c[k].filter||c[k].filter(a)){c[k].item||(c[k].item={text:c[k].title,menu:[]});d=c[k].item.menu;break}e.formatter.register(l,b);b=tinymce.extend({},m.settings.itemDefaults,{text:b.title,format:l});d?d.push(b):m.add(b)}f[a]=!0}});d(c,function(a){m.add(a.item)});b.control.renderNew()});p.convertSelectorToFormat=n});
