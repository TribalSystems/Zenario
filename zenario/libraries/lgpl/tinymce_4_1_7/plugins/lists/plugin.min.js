tinymce.PluginManager.add("lists",function(e){function h(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)}function v(n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]}var w=this;e.on("init",function(){function n(a){function c(c){var k,g,e;g=a[c?"startContainer":"endContainer"];e=a[c?"startOffset":"endOffset"];1==g.nodeType&&(k=d.create("span",{"data-mce-type":"bookmark"}),g.hasChildNodes()?(e=Math.min(e,g.childNodes.length-1),c?g.insertBefore(k,g.childNodes[e]):d.insertAfter(k,g.childNodes[e])):
g.appendChild(k),g=k,e=0);b[c?"startContainer":"endContainer"]=g;b[c?"startOffset":"endOffset"]=e}var b={};c(!0);a.collapsed||c();return b}function s(a){function c(b){var c,g,e;c=e=a[b?"startContainer":"endContainer"];g=a[b?"startOffset":"endOffset"];if(c){if(1==c.nodeType){a:{g=c;for(var m=g.parentNode.firstChild,t=0;m;){if(m==g){g=t;break a}1==m.nodeType&&"bookmark"==m.getAttribute("data-mce-type")||t++;m=m.nextSibling}g=-1}c=c.parentNode;d.remove(e)}a[b?"startContainer":"endContainer"]=c;a[b?"startOffset":
"endOffset"]=g}}c(!0);c();var b=d.createRng();b.setStart(a.startContainer,a.startOffset);a.endContainer&&b.setEnd(a.endContainer,a.endOffset);p.setRng(b)}function l(a,c){var b,f,k=d.createFragment(),g,E=e.schema.getBlockElements();e.settings.forced_root_block&&(c=c||e.settings.forced_root_block);c&&(f=d.create(c),f.tagName===e.settings.forced_root_block&&d.setAttribs(f,e.settings.forced_root_block_attrs),k.appendChild(f));if(a)for(;b=a.firstChild;){var m=b.nodeName;g||"SPAN"==m&&"bookmark"==b.getAttribute("data-mce-type")||
(g=!0);E[m]?(k.appendChild(b),f=null):c?(f||(f=d.create(c),k.appendChild(f)),f.appendChild(b)):k.appendChild(b)}e.settings.forced_root_block?g||tinymce.Env.ie&&!(10<tinymce.Env.ie)||f.appendChild(d.create("br",{"data-mce-bogus":"1"})):k.appendChild(d.create("br"));return k}function q(){return tinymce.grep(p.getSelectedBlocks(),function(a){return/^(LI|DT|DD)$/.test(a.nodeName)})}function u(a,c,b){var f,e=d.select('span[data-mce-type="bookmark"]',a);b=b||l(c);f=d.createRng();f.setStartAfter(c);f.setEndAfter(a);
f=f.extractContents();d.isEmpty(f)||d.insertAfter(f,a);d.insertAfter(b,a);d.isEmpty(c.parentNode)&&(tinymce.each(e,function(a){c.parentNode.parentNode.insertBefore(a,c.parentNode)}),d.remove(c.parentNode));d.remove(c)}function z(a){var c,b;if((c=a.nextSibling)&&h(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.appendChild(b);d.remove(c)}if((c=a.previousSibling)&&h(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.insertBefore(b,a.firstChild);d.remove(c)}}function F(a){tinymce.each(tinymce.grep(d.select("ol,ul",
a)),function(a){var b,f=a.parentNode;"LI"==f.nodeName&&f.firstChild==a&&(b=f.previousSibling)&&"LI"==b.nodeName&&(b.appendChild(a),d.isEmpty(f)&&d.remove(f));h(f)&&(b=f.previousSibling)&&"LI"==b.nodeName&&b.appendChild(a)})}function A(a){var c=a.parentNode,b=c.parentNode;if("DD"==a.nodeName)return d.rename(a,"DT"),!0;a.parentNode.firstChild==a&&a.parentNode.lastChild==a?"LI"==b.nodeName?(d.insertAfter(a,b),d.isEmpty(b)&&d.remove(b),d.remove(c)):h(b)?d.remove(c,!0):(b.insertBefore(l(a),c),d.remove(c)):
a.parentNode.firstChild==a?"LI"==b.nodeName?(d.insertAfter(a,b),a.appendChild(c),d.isEmpty(b)&&d.remove(b)):h(b)?b.insertBefore(a,c):(b.insertBefore(l(a),c),d.remove(a)):a.parentNode.lastChild==a?"LI"==b.nodeName?d.insertAfter(a,b):h(b)?d.insertAfter(a,c):(d.insertAfter(l(a),c),d.remove(a)):("LI"==b.nodeName?(c=b,b=l(a,"LI")):b=h(b)?l(a,"LI"):l(a),u(c,a,b),F(c.parentNode));return!0}function G(a){function c(b,c){var f;if(h(b)){for(;f=a.lastChild.firstChild;)c.appendChild(f);d.remove(b)}}var b,f;return"DT"==
a.nodeName?(d.rename(a,"DD"),!0):(b=a.previousSibling)&&h(b)?(b.appendChild(a),!0):b&&"LI"==b.nodeName&&h(b.lastChild)?(b.lastChild.appendChild(a),c(a.lastChild,b.lastChild),!0):(b=a.nextSibling)&&h(b)?(b.insertBefore(a,b.firstChild),!0):b&&"LI"==b.nodeName&&h(a.lastChild)?!1:(b=a.previousSibling)&&"LI"==b.nodeName?(f=d.create(a.parentNode.nodeName),b.appendChild(f),f.appendChild(a),c(a.lastChild,f),!0):!1}function B(){var a=q();if(a.length){for(var c=n(p.getRng(!0)),b=0;b<a.length&&(G(a[b])||0!==
b);b++);s(c);e.nodeChanged();return!0}}function C(){var a=q();if(a.length){var c=n(p.getRng(!0)),b,d,k=e.getBody();for(b=a.length;b--;)for(var g=a[b].parentNode;g&&g!=k;){for(d=a.length;d--;)if(a[d]===g){a.splice(b,1);break}g=g.parentNode}for(b=0;b<a.length&&(A(a[b])||0!==b);b++);s(c);e.nodeChanged();return!0}}function H(a){var c=p.getRng(!0),b=n(c),f="LI";a=a.toUpperCase();"DL"==a&&(f="DT");tinymce.each(function(){function a(b){var d;d=c[b?"startContainer":"endContainer"];b=c[b?"startOffset":"endOffset"];
for(1==d.nodeType&&(d=d.childNodes[Math.min(b,d.childNodes.length-1)]||d);d.parentNode!=f&&!v(d)&&!/^(TD|TH)$/.test(d.parentNode.nodeName);)d=d.parentNode;return d}for(var b=[],f=e.getBody(),m=a(!0),t=a(),r,n=[];m&&(n.push(m),m!=t);m=m.nextSibling);tinymce.each(n,function(a){if(v(a))b.push(a),r=null;else if(d.isBlock(a)||"BR"==a.nodeName)"BR"==a.nodeName&&d.remove(a),r=null;else{var c=a.nextSibling;tinymce.dom.BookmarkManager.isBookmarkNode(a)&&(v(c)||!c&&a.parentNode==f)?r=null:(r||(r=d.create("p"),
a.parentNode.insertBefore(r,a),b.push(r)),r.appendChild(a))}});return b}(),function(b){var c,e;(e=b.previousSibling)&&h(e)&&e.nodeName==a?(c=e,b=d.rename(b,f),e.appendChild(b)):(c=d.create(a),b.parentNode.insertBefore(c,b),c.appendChild(b),d.rename(b,f));z(c)});s(b)}function D(){var a=n(p.getRng(!0)),c=e.getBody();tinymce.each(q(),function(a){var f,e;if(d.isEmpty(a))A(a);else{for(f=a;f&&f!=c;f=f.parentNode)h(f)&&(e=f);u(e,a)}});s(a)}function x(a){var c=d.getParent(p.getStart(),"OL,UL,DL");if(c)if(c.nodeName==
a)D(a);else{var b=n(p.getRng(!0));z(d.rename(c,a));s(b)}else H(a)}function y(a){return function(){var c=d.getParent(e.selection.getStart(),"UL,OL,DL");return c&&c.nodeName==a}}var d=e.dom,p=e.selection;w.backspaceDelete=function(a){function c(a,b){var c=a.startContainer,d=a.startOffset,f;if(3==c.nodeType&&(b?d<c.data.length:0<d))return c;d=e.schema.getNonEmptyElements();for(f=new tinymce.dom.TreeWalker(a.startContainer);c=f[b?"next":"prev"]();)if("LI"==c.nodeName&&!c.hasChildNodes()||d[c.nodeName]||
3==c.nodeType&&0<c.data.length)return c}function b(a,b){var c,f,e=a.parentNode;h(b.lastChild)&&(f=b.lastChild);(c=b.lastChild)&&"BR"==c.nodeName&&a.hasChildNodes()&&d.remove(c);d.isEmpty(b)&&d.$(b).empty();if(!d.isEmpty(a))for(;c=a.firstChild;)b.appendChild(c);f&&b.appendChild(f);d.remove(a);d.isEmpty(e)&&d.remove(e)}if(p.isCollapsed()){var f=d.getParent(p.getStart(),"LI");if(f){var k=p.getRng(!0),g=d.getParent(c(k,a),"LI");if(g&&g!=f)return k=n(k),a?b(g,f):b(f,g),s(k),!0;if(!g&&!a&&D(f.parentNode.nodeName))return!0}}};
e.addCommand("Indent",function(){if(!B())return!0});e.addCommand("Outdent",function(){if(!C())return!0});e.addCommand("InsertUnorderedList",function(){x("UL")});e.addCommand("InsertOrderedList",function(){x("OL")});e.addCommand("InsertDefinitionList",function(){x("DL")});e.addQueryStateHandler("InsertUnorderedList",y("UL"));e.addQueryStateHandler("InsertOrderedList",y("OL"));e.addQueryStateHandler("InsertDefinitionList",y("DL"));e.on("keydown",function(a){9==a.keyCode&&!tinymce.util.VK.metaKeyPressed(a)&&
e.dom.getParent(e.selection.getStart(),"LI,DT,DD")&&(a.preventDefault(),a.shiftKey?C():B())})});e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var n=this;e.on("nodechange",function(){for(var h=e.selection.getSelectedBlocks(),l=!1,q=0,u=h.length;!l&&q<u;q++)l=h[q].nodeName,l="LI"==l&&h[q].parentNode.firstChild==h[q]||"UL"==l||"OL"==l||"DD"==l;n.disabled(l)})}});e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?w.backspaceDelete()&&e.preventDefault():
e.keyCode==tinymce.util.VK.DELETE&&w.backspaceDelete(!0)&&e.preventDefault()})});
