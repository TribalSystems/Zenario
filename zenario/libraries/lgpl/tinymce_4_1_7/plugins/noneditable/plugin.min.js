tinymce.PluginManager.add("noneditable",function(b){function p(d){var f;if(1===d.nodeType){if((f=d.getAttribute(l))&&"inherit"!==f)return f;f=d.contentEditable;if("inherit"!==f)return f}return null}function r(d){for(var f;d;){if(f=p(d))return"false"===f?d:null;d=d.parentNode}}function w(){function d(a){for(;a;){if(a.id===l)return a;a=a.parentNode}}function f(a){var d;if(a)for(d=new t(a,a),a=d.current();a;a=d.next())if(3===a.nodeType)return a}function c(a,d){var c,f;if("false"===p(a)&&n.isBlock(a))k.select(a);
else return f=n.createRng(),"true"===p(a)&&(a.firstChild||a.appendChild(b.getDoc().createTextNode("\u00a0")),a=a.firstChild,d=!0),c=n.create("span",{id:l,"data-mce-bogus":!0},s),d?a.parentNode.insertBefore(c,a):n.insertAfter(c,a),f.setStart(c.firstChild,1),f.collapse(!0),k.setRng(f),c}function u(a){var c,b;if(a)c=k.getRng(!0),c.setStartBefore(a),c.setEndBefore(a),(b=f(a))&&b.nodeValue.charAt(0)==s&&b.deleteData(0,1),n.remove(a,!0),k.setRng(c);else for(c=d(k.getStart());(a=n.get(l))&&a!==b;)c!==a&&
((b=f(a))&&b.nodeValue.charAt(0)==s&&b.deleteData(0,1),n.remove(a,!0)),b=a}function m(){function a(a,d){var c,b,f;c=e.startContainer;b=e.startOffset;if(3==c.nodeType){if(f=c.nodeValue.length,0<b&&b<f||(d?b==f:0===b))return}else if(b<c.childNodes.length)c=c.childNodes[!d&&0<b?b-1:b],c.hasChildNodes()&&(c=c.firstChild);else return d?null:a;for(c=new t(c,a);b=c[d?"prev":"next"]();){if(3===b.nodeType&&0<b.nodeValue.length)return;if("true"===p(b))return b}return a}var d,b,f,e,g;u();f=k.isCollapsed();d=
r(k.getStart());b=r(k.getEnd());if(d||b)e=k.getRng(!0),f?(d=d||b,(g=a(d,!0))?c(g,!0):(g=a(d,!1))?c(g,!1):k.select(d)):(e=k.getRng(!0),d&&e.setStartBefore(d),b&&e.setEndAfter(b),k.setRng(e))}var n=b.dom,k=b.selection,l="mce_noneditablecaret",s="\ufeff";b.on("mousedown",function(a){var c=b.selection.getNode();"false"===p(c)&&c==a.target&&m()});b.on("mouseup keyup",m);b.on("keydown",function(a){function c(a,b){for(;a=a[b?"previousSibling":"nextSibling"];)if(3!==a.nodeType||0<a.nodeValue.length)return a}
function f(a,c){k.select(a);k.collapse(c)}function l(a){function c(a){for(var b=g;b;){if(b===a)return;b=b.parentNode}n.remove(a);m()}function f(){var d,e,k=b.schema.getNonEmptyElements();for(e=new tinymce.dom.TreeWalker(g,b.getBody());(d=a?e.prev():e.next())&&!k[d.nodeName.toLowerCase()]&&!(3===d.nodeType&&0<tinymce.trim(d.nodeValue).length);)if("false"===p(d))return c(d),!0;return r(d)?!0:!1}var e,g,h;if(k.isCollapsed()){e=k.getRng(!0);g=e.startContainer;e=e.startOffset;g=d(g)||g;if(h=r(g))return c(h),
!1;if(3==g.nodeType&&(a?0<e:e<g.nodeValue.length))return!0;1==g.nodeType&&(g=g.childNodes[e]||g);if(f())return!1}return!0}var e=a.keyCode,g,q;q=k.getStart();g=k.getEnd();if((g=r(q)||r(g))&&(112>e||124<e)&&e!=h.DELETE&&e!=h.BACKSPACE){if((tinymce.isMac?!a.metaKey:!a.ctrlKey)||67!=e&&88!=e&&86!=e)if(a.preventDefault(),e==h.LEFT||e==h.RIGHT)a=e==h.LEFT,b.dom.isBlock(g)?(e=a?g.previousSibling:g.nextSibling,e=new t(e,e),e=a?e.prev():e.next(),f(e,!a)):f(g,a)}else if(e==h.LEFT||e==h.RIGHT||e==h.BACKSPACE||
e==h.DELETE){if(q=d(q)){if(e==h.LEFT||e==h.BACKSPACE)if((g=c(q,!0))&&"false"===p(g))if(a.preventDefault(),e==h.LEFT)f(g,!0);else{n.remove(g);return}else u(q);if(e==h.RIGHT||e==h.DELETE)if((g=c(q))&&"false"===p(g))if(a.preventDefault(),e==h.RIGHT)f(g,!1);else{n.remove(g);return}else u(q)}if((e==h.BACKSPACE||e==h.DELETE)&&!l(e==h.BACKSPACE))return a.preventDefault(),!1}})}function x(d){var f=m.length,c=d.content,h=tinymce.trim(s);if("raw"!=d.format){for(;f--;)c=c.replace(m[f],function(d){var f=arguments,
k=f[f.length-2];return 0<k&&'"'==c.charAt(k-1)?d:'<span class="'+h+'" data-mce-content="'+b.dom.encode(f[0])+'">'+b.dom.encode("string"===typeof f[1]?f[1]:f[0])+"</span>"});d.content=c}}var t=tinymce.dom.TreeWalker,l="data-mce-contenteditable",h=tinymce.util.VK,v,s,m;v=" "+tinymce.trim(b.getParam("noneditable_editable_class","mceEditable"))+" ";s=" "+tinymce.trim(b.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";(m=b.getParam("noneditable_regexp"))&&!m.length&&(m=[m]);b.on("PreInit",
function(){w();if(m)b.on("BeforeSetContent",x);b.parser.addAttributeFilter("class",function(d){for(var b=d.length,c,h;b--;)h=d[b],c=" "+h.attr("class")+" ",-1!==c.indexOf(v)?h.attr(l,"true"):-1!==c.indexOf(s)&&h.attr(l,"false")});b.serializer.addAttributeFilter(l,function(b){for(var f=b.length,c;f--;)c=b[f],m&&c.attr("data-mce-content")?(c.name="#text",c.type=3,c.raw=!0,c.value=c.attr("data-mce-content")):(c.attr("contenteditable",null),c.attr(l,null))});b.parser.addAttributeFilter("contenteditable",
function(b){for(var f=b.length,c;f--;)c=b[f],c.attr(l,c.attr("contenteditable")),c.attr("contenteditable",null)})});b.on("drop",function(b){r(b.target)&&b.preventDefault()})});
