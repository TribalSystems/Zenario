(function(){var H={},O=function(a){var e=H[a];if(void 0===e)throw"module ["+a+"] was undefined";if(void 0===e.instance){for(var c=H[a],g=c.deps,h=c.defn,f=g.length,b=Array(f),d=0;d<f;++d)b[d]=O(g[d]);g=h.apply(null,b);if(void 0===g)throw"module ["+a+"] returned undefined";c.instance=g}return e.instance},k=function(a,e,c){if("string"!==typeof a)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+a;if(void 0===c)throw"no definition function for "+a;H[a]={deps:e,defn:c,instance:void 0}},
K=function(a,e){k(a,[],function(){return e})};k("ephox.imagetools.util.Promise",[],function(){function a(l,a){return function(){l.apply(a,arguments)}}function e(l){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof l)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];d(l,a(g,this),a(h,this))}function c(l){var a=this;null===this._state?this._deferreds.push(l):m(function(){var d=a._state?l.onFulfilled:l.onRejected;
if(null===d)(a._state?l.resolve:l.reject)(a._value);else{var f;try{f=d(a._value)}catch(b){l.reject(b);return}l.resolve(f)}})}function g(l){try{if(l===this)throw new TypeError("A promise cannot be resolved with itself.");if(l&&("object"===typeof l||"function"===typeof l)){var q=l.then;if("function"===typeof q){d(a(q,l),a(g,this),a(h,this));return}}this._state=!0;this._value=l;f.call(this)}catch(b){h.call(this,b)}}function h(l){this._state=!1;this._value=l;f.call(this)}function f(){for(var l=0,a=this._deferreds.length;l<
a;l++)c.call(this,this._deferreds[l]);this._deferreds=null}function b(a,d,f,b){this.onFulfilled="function"===typeof a?a:null;this.onRejected="function"===typeof d?d:null;this.resolve=f;this.reject=b}function d(a,d,f){var b=!1;try{a(function(a){b||(b=!0,d(a))},function(a){b||(b=!0,f(a))})}catch(m){b||(b=!0,f(m))}}if(window.Promise)return window.Promise;var m=e.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},r=Array.isArray||function(a){return"[object Array]"===
Object.prototype.toString.call(a)};e.prototype["catch"]=function(a){return this.then(null,a)};e.prototype.then=function(a,d){var f=this;return new e(function(m,g){c.call(f,new b(a,d,m,g))})};e.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&r(arguments[0])?arguments[0]:arguments);return new e(function(d,b){function f(c,g){try{if(g&&("object"===typeof g||"function"===typeof g)){var r=g.then;if("function"===typeof r){r.call(g,function(a){f(c,a)},b);return}}a[c]=g;0===--m&&d(a)}catch(e){b(e)}}
if(0===a.length)return d([]);for(var m=a.length,c=0;c<a.length;c++)f(c,a[c])})};e.resolve=function(a){return a&&"object"===typeof a&&a.constructor===e?a:new e(function(d){d(a)})};e.reject=function(a){return new e(function(d,b){b(a)})};e.race=function(a){return new e(function(d,b){for(var f=0,m=a.length;f<m;f++)a[f].then(d,b)})};return e});k("ephox.imagetools.util.Canvas",[],function(){function a(a,e){return c(document.createElement("canvas"),a,e)}function e(a){return a.getContext("2d")}function c(a,
c,f){a.width=c;a.height=f;return a}return{create:a,clone:function(c){var h;h=a(c.width,c.height);e(h).drawImage(c,0,0);return h},resize:c,get2dContext:e,get3dContext:function(a){var c=null;try{c=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(f){}c||(c=null);return c}}});k("ephox.imagetools.util.Mime",[],function(){return{guessMimeType:function(a){if(0===a.indexOf("data:"))return a=a.split(","),(a=/data:([^;]+)/.exec(a[0]))?a[1]:"";var e=document.createElement("a");e.href=a;a=e.pathname.split(".");
(a=a[a.length-1])&&(a=a.toLowerCase());return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[a]}}});k("ephox.imagetools.util.ImageSize",[],function(){return{getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}}});k("ephox.imagetools.util.Conversions",["ephox.imagetools.util.Promise","ephox.imagetools.util.Canvas","ephox.imagetools.util.Mime","ephox.imagetools.util.ImageSize"],function(a,e,c,g){function h(d){return new a(function(a){function b(){d.removeEventListener("load",
b);a(d)}d.complete?a(d):d.addEventListener("load",b)})}function f(a){return h(a).then(function(a){var d;d=e.create(g.getWidth(a),g.getHeight(a));e.get2dContext(d).drawImage(a,0,0);return d})}function b(d){return new a(function(a){var b=new XMLHttpRequest;b.open("GET",d,!0);b.responseType="blob";b.onload=function(){200==this.status&&a(this.response)};b.send()})}function d(a){var d,b,f,c;a=a.split(",");(d=/data:([^;]+)/.exec(a[0]))&&(f=d[1]);a=atob(a[1]);if(window.WebKitBlobBuilder){c=new WebKitBlobBuilder;
d=new ArrayBuffer(a.length);for(b=0;b<d.length;b++)d[b]=a.charCodeAt(b);c.append(d);return c.getBlob(f)}d=new Uint8Array(a.length);for(b=0;b<d.length;b++)d[b]=a.charCodeAt(b);return new Blob([d],{type:f})}function m(b){return new a(function(a){a(d(b))})}function r(d){return new a(function(a){var b=new FileReader;b.onloadend=function(){a(b.result)};b.readAsDataURL(d)})}return{blobToImage:function(d){return new a(function(a){function b(){f.removeEventListener("load",b);a(f)}var f=new Image;f.addEventListener("load",
b);f.src=URL.createObjectURL(d);f.complete&&b()})},imageToBlob:function(a){return h(a).then(function(a){var d=a.src;return 0===d.indexOf("blob:")?b(d):0===d.indexOf("data:")?m(d):f(a).then(function(a){return m(a.toDataURL(c.guessMimeType(d)))})})},blobToDataUri:r,blobToBase64:function(a){return r(a).then(function(a){return a.split(",")[1]})},imageToCanvas:f,canvasToBlob:function(d,b,f){b=b||"image/png";return HTMLCanvasElement.prototype.toBlob?new a(function(a){d.toBlob(function(d){a(d)},b,f)}):m(d.toDataURL(b,
f))},revokeImageUrl:function(a){URL.revokeObjectURL(a.src)},uriToBlob:function(a){return 0===a.indexOf("blob:")?b(a):0===a.indexOf("data:")?m(a):null},dataUriToBlobSync:d}});k("ephox.imagetools.util.ImageResult",["ephox.imagetools.util.Promise","ephox.imagetools.util.Conversions","ephox.imagetools.util.Mime","ephox.imagetools.util.Canvas"],function(a,e,c,g){function h(a,b){function d(d,c){return a.toDataURL(d||b,c)}return{getType:function(){return b},toBlob:function(d,c){return e.canvasToBlob(a,d||
b,c)},toDataURL:d,toBase64:function(a,b){return d(a,b).split(",")[1]},toCanvas:function(){return g.clone(a)}}}return{fromBlob:function(a){return e.blobToImage(a).then(function(a){var d=e.imageToCanvas(a);e.revokeImageUrl(a);return d}).then(function(b){return h(b,a.type)})},fromCanvas:function(f,b){return new a(function(a){a(h(f,b))})},fromImage:function(a){var b=c.guessMimeType(a.src);return e.imageToCanvas(a).then(function(a){return h(a,b)})}}});k("ephox.imagetools.api.BlobConversions",["ephox.imagetools.util.Conversions",
"ephox.imagetools.util.ImageResult"],function(a,e){return{blobToImage:function(c){return a.blobToImage(c)},imageToBlob:function(c){return a.imageToBlob(c)},blobToDataUri:function(c){return a.blobToDataUri(c)},blobToBase64:function(c){return a.blobToBase64(c)},blobToImageResult:function(a){return e.fromBlob(a)},dataUriToImageResult:function(c){return a.uriToBlob(c).then(e.fromBlob)},imageToImageResult:function(a){return e.fromImage(a)},imageResultToBlob:function(a,e,h){return a.toBlob(e,h)},imageResultToBlobSync:function(c,
e,h){return a.dataUriToBlobSync(c.toDataURL(e,h))}}});k("ephox.imagetools.transformations.ColorMatrix",[],function(){function a(a,f,b){a=parseFloat(a);a>b?a=b:a<f&&(a=f);return a}function e(a,f){var b,d,c,e,l=[],g=Array(10);for(b=0;5>b;b++){for(d=0;5>d;d++)l[d]=f[d+5*b];for(d=0;5>d;d++){for(c=e=0;5>c;c++)e+=a[d+5*c]*l[c];g[d+5*b]=e}}return g}function c(c,f){f=a(f,0,1);return c.map(function(b,d){b=0===d%6?1-(1-b)*f:b*f;return a(b,0,1)})}var g=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,
0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:c,multiply:e,adjustContrast:function(c,
f){var b;f=a(f,-1,1);f*=100;0>f?b=127+127*(f/100):(b=f%1,b=0===b?g[f]:g[Math.floor(f)]*(1-b)+g[Math.floor(f)+1]*b,b=127*b+127);return e(c,[b/127,0,0,0,0.5*(127-b),0,b/127,0,0,0.5*(127-b),0,0,b/127,0,0.5*(127-b),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(c,f){f=a(255*f,-255,255);return e(c,[1,0,0,0,f,0,1,0,0,f,0,0,1,0,f,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(c,f){var b;f=a(f,-1,1);b=1+(0<f?3*f:f);return e(c,[0.3086*(1-b)+b,0.6094*(1-b),0.082*(1-b),0,0,0.3086*(1-b),0.6094*(1-b)+b,0.082*
(1-b),0,0,0.3086*(1-b),0.6094*(1-b),0.082*(1-b)+b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(c,f){var b,d;f=a(f,-180,180)/180*Math.PI;b=Math.cos(f);d=Math.sin(f);return e(c,[0.213+0.787*b+-0.213*d,0.715+-0.715*b+-0.715*d,0.072+-0.072*b+0.928*d,0,0,0.213+-0.213*b+0.143*d,0.715+b*(1-0.715)+0.14*d,0.072+-0.072*b+-0.283*d,0,0,0.213+-0.213*b+-0.787*d,0.715+-0.715*b+0.715*d,0.072+0.928*b+0.072*d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(c,f,b,d){f=a(f,0,2);b=a(b,0,2);d=a(d,0,2);return e(c,[f,
0,0,0,0,0,b,0,0,0,0,0,d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(g,f){f=a(f,0,1);return e(g,c([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],f))},adjustGrayscale:function(g,f){f=a(f,0,1);return e(g,c([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],f))}}});k("ephox.imagetools.transformations.Filters",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ColorMatrix"],function(a,
e,c){function g(d,b){var c=d.toCanvas(),f=a.get2dContext(c),g=f.getImageData(0,0,c.width,c.height),h=g.data,k,p,n,y,t,A=b[0],s=b[1],z=b[2],X=b[3],R=b[4],P=b[5],L=b[6],la=b[7],C=b[8],J=b[9],v=b[10],F=b[11],D=b[12],w=b[13],G=b[14],S=b[15],V=b[16],B=b[17],T=b[18],U=b[19];for(t=0;t<h.length;t+=4)k=h[t],p=h[t+1],n=h[t+2],y=h[t+3],h[t]=k*A+p*s+n*z+y*X+R,h[t+1]=k*P+p*L+n*la+y*C+J,h[t+2]=k*v+p*F+n*D+y*w+G,h[t+3]=k*S+p*V+n*B+y*T+U;f.putImageData(g,0,0);return e.fromCanvas(c,d.getType())}function h(d,b){var c=
d.toCanvas(),f=a.get2dContext(c),g,h;g=f.getImageData(0,0,c.width,c.height);h=f.getImageData(0,0,c.width,c.height);h=function(a,d,b){function c(a,d,b){a>b?a=b:a<d&&(a=d);return a}var f,e,g,m,l,h,r,q,u,k,x,v,F,D;g=Math.round(Math.sqrt(b.length));m=Math.floor(g/2);f=a.data;e=d.data;F=a.width;D=a.height;for(l=0;l<D;l++)for(a=0;a<F;a++){for(k=h=r=q=0;k<g;k++)for(u=0;u<g;u++)x=c(a+u-m,0,F-1),v=c(l+k-m,0,D-1),x=4*(v*F+x),v=b[k*g+u],h+=f[x]*v,r+=f[x+1]*v,q+=f[x+2]*v;x=4*(l*F+a);e[x]=c(h,0,255);e[x+1]=c(r,
0,255);e[x+2]=c(q,0,255)}return d}(g,h,b);f.putImageData(h,0,0);return e.fromCanvas(c,d.getType())}function f(d){return function(b,c){var f=b.toCanvas(),g=a.get2dContext(f),h,k=Array(256);for(h=0;h<k.length;h++)k[h]=d(h,c);h=g.getImageData(0,0,f.width,f.height);var p=h.data,n;for(n=0;n<p.length;n+=4)p[n]=k[p[n]],p[n+1]=k[p[n+1]],p[n+2]=k[p[n+2]];g.putImageData(h,0,0);return e.fromCanvas(f,b.getType())}}function b(a){return function(d,b){return g(d,a(c.identity(),b))}}function d(a){return function(d){return h(d,
a)}}return{invert:function(a){return function(d){return g(d,a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:b(c.adjustBrightness),hue:b(c.adjustHue),saturate:b(c.adjustSaturation),contrast:b(c.adjustContrast),grayscale:b(c.adjustGrayscale),sepia:b(c.adjustSepia),colorize:function(a,d,b,f){return g(a,c.adjustColors(c.identity(),d,b,f))},sharpen:d([0,-1,0,-1,5,-1,0,-1,0]),emboss:d([-2,-1,0,-1,1,1,0,1,2]),gamma:f(function(a,d){return 255*Math.pow(a/255,1-d)}),exposure:f(function(a,
d){return 255*(1-Math.exp(-(a/255)*d))}),colorFilter:g,convoluteFilter:h}});k("ephox.imagetools.transformations.ImageResizerCanvas",["ephox.imagetools.util.Promise","ephox.imagetools.util.Conversions","ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageSize"],function(a,e,c,g){function h(a,d,c){var e=g.getWidth(a),l=g.getHeight(a),e=d/e,q=c/l,l=!1;if(0.5>e||2<e)e=0.5>e?0.5:2,l=!0;if(0.5>q||2<q)q=0.5>q?0.5:2,l=!0;a=f(a,e,q);return l?a.then(function(a){return h(a,d,c)}):a}function f(b,d,f){return new a(function(a){var e=
g.getWidth(b),h=g.getHeight(b),k=Math.floor(e*d),u=Math.floor(h*f),I=c.create(k,u);c.get2dContext(I).drawImage(b,0,0,e,h,0,0,k,u);a(I)})}return{scale:h}});k("ephox.imagetools.transformations.ImageTools",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ImageResizerCanvas"],function(a,e,c){return{rotate:function(c,h){var f=c.toCanvas(),b=a.create(f.width,f.height),d=a.get2dContext(b),m=0,r=0;h=0>h?360+h:h;90!=h&&270!=h||a.resize(b,b.height,b.width);
if(90==h||180==h)m=b.width;if(270==h||180==h)r=b.height;d.translate(m,r);d.rotate(h*Math.PI/180);d.drawImage(f,0,0);return e.fromCanvas(b,c.getType())},flip:function(c,h){var f=c.toCanvas(),b=a.create(f.width,f.height),d=a.get2dContext(b);"v"==h?(d.scale(1,-1),d.drawImage(f,0,-b.height)):(d.scale(-1,1),d.drawImage(f,-b.width,0));return e.fromCanvas(b,c.getType())},crop:function(c,h,f,b,d){var m=c.toCanvas();b=a.create(b,d);a.get2dContext(b).drawImage(m,-h,-f);return e.fromCanvas(b,c.getType())},resize:function(a,
h,f){return c.scale(a.toCanvas(),h,f).then(function(b){return e.fromCanvas(b,a.getType())})}}});k("ephox.imagetools.api.ImageTransformations",["ephox.imagetools.transformations.Filters","ephox.imagetools.transformations.ImageTools"],function(a,e){return{invert:function(c){return a.invert(c)},sharpen:function(c){return a.sharpen(c)},emboss:function(c){return a.emboss(c)},brightness:function(c,e){return a.brightness(c,e)},hue:function(c,e){return a.hue(c,e)},saturate:function(c,e){return a.saturate(c,
e)},contrast:function(c,e){return a.contrast(c,e)},grayscale:function(c,e){return a.grayscale(c,e)},sepia:function(c,e){return a.sepia(c,e)},colorize:function(c,e,h,f){return a.colorize(c,e,h,f)},gamma:function(c,e){return a.gamma(c,e)},exposure:function(c,e){return a.exposure(c,e)},flip:function(a,g){return e.flip(a,g)},crop:function(a,g,h,f,b){return e.crop(a,g,h,f,b)},resize:function(a,g,h){return e.resize(a,g,h)},rotate:function(a,g){return e.rotate(a,g)}}});K("global!tinymce.util.Tools.resolve",
tinymce.util.Tools.resolve);k("tinymce.core.Env",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.Env")});k("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});k("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Delay")});k("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Promise")});k("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.util.Tools")});k("tinymce.core.util.URI",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.URI")});k("tinymce.plugins.imagetools.core.ImageSize",[],function(){return{getImageSize:function(a){var e,c;e=a.style.width;c=a.style.height;if(e||c)return/^[0-9\.]+px$/.test(e)&&/^[0-9\.]+px$/.test(c)?{w:parseInt(e,10),h:parseInt(c,10)}:null;e=a.width;c=a.height;return e&&c?{w:parseInt(e,10),h:parseInt(c,10)}:null},setImageSize:function(a,e){var c,g;if(e){c=
a.style.width;g=a.style.height;if(c||g)a.style.width=e.w+"px",a.style.height=e.h+"px",a.removeAttribute("data-mce-style");c=a.width;g=a.height;if(c||g)a.setAttribute("width",e.w),a.setAttribute("height",e.h)}},getNaturalImageSize:function(a){return{w:a.naturalWidth,h:a.naturalHeight}}}});K("global!Array",Array);K("global!Error",Error);k("ephox.katamari.api.Fun",["global!Array","global!Error"],function(a,e){var c=function(a){return function(){return a}},g=c(!1),h=c(!0);return{noop:function(){},compose:function(a,
b){return function(){return a(b.apply(null,arguments))}},constant:c,identity:function(a){return a},tripleEquals:function(a,b){return a===b},curry:function(c){for(var b=new a(arguments.length-1),d=1;d<arguments.length;d++)b[d-1]=arguments[d];return function(){for(var d=new a(arguments.length),e=0;e<d.length;e++)d[e]=arguments[e];d=b.concat(d);return c.apply(null,d)}},not:function(a){return function(){return!a.apply(null,arguments)}},die:function(a){return function(){throw new e(a);}},apply:function(a){return a()},
call:function(a){a()},never:g,always:h}});K("global!Object",Object);k("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(a,e){var c=a.never,g=a.always,h=function(){return f},f=function(){var d=function(a){return a.isNone()},b=function(a){return a()},f=function(a){return a},d={fold:function(a,d){return a()},is:c,isSome:c,isNone:g,getOr:f,getOrThunk:b,getOrDie:function(a){throw Error(a||"error: getOrDie called on none.");},or:f,orThunk:b,map:h,ap:h,each:function(){},bind:h,
flatten:h,exists:c,forall:g,filter:h,equals:d,equals_:d,toArray:function(){return[]},toString:a.constant("none()")};e.freeze&&e.freeze(d);return d}(),b=function(a){var e=function(){return a},r=function(){return q},l=function(b){return b(a)},q={fold:function(b,c){return c(a)},is:function(b){return a===b},isSome:g,isNone:c,getOr:e,getOrThunk:e,getOrDie:e,or:r,orThunk:r,map:function(c){return b(c(a))},ap:function(c){return c.fold(h,function(c){return b(c(a))})},each:function(b){b(a)},bind:l,flatten:e,
exists:l,forall:l,filter:function(b){return b(a)?q:f},equals:function(b){return b.is(a)},equals_:function(b,e){return b.fold(c,function(b){return e(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return q};return{some:b,none:h,from:function(a){return null===a||void 0===a?f:b(a)}}});K("global!String",String);k("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(a,e,c,g){var h=function(){var a=e.prototype.indexOf,
b=function(b,d){return a.call(b,d)},d=function(a,b){var d;a:{d=0;for(var c=a.length;d<c;++d)if(a[d]===b)break a;d=-1}return d};return void 0===a?d:b}(),f=function(a,b){return-1<h(a,b)},b=function(a,b){for(var d=a.length,c=new e(d),f=0;f<d;f++)c[f]=b(a[f],f,a);return c},d=function(a,b){for(var d=0,c=a.length;d<c;d++)b(a[d],d,a)},m=function(a,d){for(var b=a.length-1;0<=b;b--)d(a[b],b,a)},r=function(a,b){for(var d=[],c=0,e=a.length;c<e;c++){var f=a[c];b(f,c,a)&&d.push(f)}return d},l=function(b,d){for(var c=
0,e=b.length;c<e;c++)if(d(b[c],c,b))return a.some(c);return a.none()},q=e.prototype.push,k=function(a){for(var b=[],d=0,f=a.length;d<f;++d){if(!e.prototype.isPrototypeOf(a[d]))throw new c("Arr.flatten item "+d+" was not an array, input: "+a);q.apply(b,a[d])}return b},u=function(a,d){for(var b=0,c=a.length;b<c;++b)if(!0!==d(a[b],b,a))return!1;return!0},I=e.prototype.slice;return{map:b,each:d,eachr:m,partition:function(a,b){for(var d=[],c=[],e=0,f=a.length;e<f;e++){var h=a[e];(b(h,e,a)?d:c).push(h)}return{pass:d,
fail:c}},filter:r,groupBy:function(a,b){if(0===a.length)return[];for(var d=b(a[0]),c=[],e=[],f=0,h=a.length;f<h;f++){var g=a[f],l=b(g);l!==d&&(c.push(e),e=[]);d=l;e.push(g)}0!==e.length&&c.push(e);return c},indexOf:function(b,d){var c=h(b,d);return-1===c?a.none():a.some(c)},foldr:function(a,b,d){m(a,function(a){d=b(d,a)});return d},foldl:function(a,b,c){d(a,function(a){c=b(c,a)});return c},find:function(b,d){for(var c=0,e=b.length;c<e;c++){var f=b[c];if(d(f,c,b))return a.some(f)}return a.none()},
findIndex:l,flatten:k,bind:function(a,d){var c=b(a,d);return k(c)},forall:u,exists:function(a,b){return l(a,b).isSome()},contains:f,equal:function(a,b){return a.length===b.length&&u(a,function(a,d){return a===b[d]})},reverse:function(a){a=I.call(a,0);a.reverse();return a},chunk:function(a,b){for(var d=[],c=0;c<a.length;c+=b){var e=a.slice(c,c+b);d.push(e)}return d},difference:function(a,b){return r(a,function(a){return!f(b,a)})},mapToObject:function(a,b){for(var d={},c=0,e=a.length;c<e;c++){var f=
a[c];d[g(f)]=b(f,c)}return d},pure:function(a){return[a]},sort:function(a,b){var d=I.call(a,0);d.sort(b);return d},range:function(a,b){for(var d=[],c=0;c<a;c++)d.push(b(c));return d}}});k("tinymce.plugins.imagetools.core.Utils",["tinymce.core.util.Promise","tinymce.core.util.Tools"],function(a,e){return{traverse:function(a,e){var h;h=e.reduce(function(a,b){return null!==a&&void 0!==a?a[b]:void 0},a);return null!==h&&void 0!==h?h:null},readBlob:function(c){return new a(function(a){var e=new FileReader;
e.onload=function(c){a(c.target.result)};e.readAsText(c)})},requestUrlAsBlob:function(c,g){return new a(function(a){var f;f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&a({status:f.status,blob:this.response})};f.open("GET",c,!0);e.each(g,function(a,d){f.setRequestHeader(d,a)});f.responseType="blob";f.send()})},parseJson:function(a){var e;try{e=JSON.parse(a)}catch(h){}return e}}});k("tinymce.plugins.imagetools.core.Errors",["ephox.katamari.api.Arr","ephox.katamari.api.Fun",
"tinymce.core.util.Promise","tinymce.plugins.imagetools.core.Utils"],function(a,e,c,g){var h=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],f=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],b=function(b){return"ImageProxy HTTP error: "+
a.find(h,function(a){return b===a.code}).fold(e.constant("Unknown ImageProxy error"),function(a){return a.message})},d=function(a){a=b(a);return c.reject(a)},m=function(b){return a.find(f,function(a){return a.type===b}).fold(e.constant("Unknown service error"),function(a){return a.message})},r=function(a,b){return g.readBlob(b).then(function(a){a=g.parseJson(a);a=(a=g.traverse(a,["error","type"]))?m(a):"Invalid JSON in service error message";return c.reject("ImageProxy Service error: "+a)})};return{handleServiceErrorResponse:function(a,
b){return 400===a||403===a||500===a?r(a,b):d(a)},handleHttpError:d,getHttpErrorMsg:b,getServiceErrorMsg:m}});k("tinymce.plugins.imagetools.core.Proxy",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Errors","tinymce.plugins.imagetools.core.Utils"],function(a,e,c,g){function h(b){return g.requestUrlAsBlob(b,{}).then(function(b){return 200>b.status||300<=b.status?c.handleHttpError(b.status):a.resolve(b.blob)})}var f=function(a,b){var c=-1===a.indexOf("?")?"?":
"&";return/[?&]apiKey=/.test(a)||!b?a:a+c+"apiKey="+encodeURIComponent(b)},b=function(b,e){return g.requestUrlAsBlob(f(b,e),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e}).then(function(b){return 200>b.status||300<=b.status?c.handleServiceErrorResponse(b.status,b.blob):a.resolve(b.blob)})};return{getUrl:function(a,c){return c?b(a,c):h(a)}}});k("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DOMUtils")});k("tinymce.core.ui.Container",
["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Container")});k("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Factory")});k("tinymce.core.ui.Form",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Form")});k("tinymce.core.geom.Rect",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.geom.Rect")});k("tinymce.core.ui.Control",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.Control")});
k("tinymce.core.ui.DragHelper",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.ui.DragHelper")});k("tinymce.core.dom.DomQuery",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.dom.DomQuery")});k("tinymce.core.util.Observable",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.Observable")});k("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.VK")});k("tinymce.plugins.imagetools.ui.CropRect",
"tinymce.core.dom.DomQuery tinymce.core.ui.DragHelper tinymce.core.geom.Rect tinymce.core.util.Tools tinymce.core.util.Observable tinymce.core.util.VK".split(" "),function(a,e,c,g,h,f){var b=0;return function(d,m,k,l,q){function x(a,b,e,f){var h,g,l;h=b.x;g=b.y;l=b.w;b=b.h;h+=e*a.deltaX;g+=f*a.deltaY;l+=e*a.deltaW;b+=f*a.deltaH;20>l&&(l=20);20>b&&(b=20);a=d=c.clamp({x:h,y:g,w:l,h:b},k,"move"==a.name);a={x:a.x-k.x,y:a.y-k.y,w:a.w,h:a.h};n.fire("updateRect",{rect:a});p(a)}function u(b){function d(b,
c){0>c.h&&(c.h=0);0>c.w&&(c.w=0);a("#"+s+"-"+b,l).css({left:c.x,top:c.y,width:c.w,height:c.h})}g.each(y,function(d){a("#"+s+"-"+d.name,l).css({left:b.w*d.xMul+b.x,top:b.h*d.yMul+b.y})});d("top",{x:m.x,y:m.y,w:m.w,h:b.y-m.y});d("right",{x:b.x+b.w,y:b.y,w:m.w-b.x-b.w+m.x,h:b.h});d("bottom",{x:m.x,y:b.y+b.h,w:m.w,h:m.h-b.y-b.h+m.y});d("left",{x:m.x,y:b.y,w:b.x-m.x,h:b.h});d("move",b)}function I(a){d=a;u(d)}function p(a){I({x:a.x+k.x,y:a.y+k.y,w:a.w,h:a.h})}var n,y,t,A,s="mce-crid-"+b++;y=[{name:"move",
xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];A=["top","right","bottom","left"];(function(){a('<div id="'+
s+'" class="mce-croprect-container" role="grid" aria-dropeffect="execute">').appendTo(l);g.each(A,function(b){a("#"+s,l).append('<div id="'+s+"-"+b+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});g.each(y,function(b){a("#"+s,l).append('<div id="'+s+"-"+b.name+'" class="mce-croprect-handle mce-croprect-handle-'+b.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+b.label+'" aria-grabbed="false">')});t=g.map(y,function(a){var b;
return new e(s,{document:l.ownerDocument,handle:s+"-"+a.name,start:function(){b=d},drag:function(d){x(a,b,d.deltaX,d.deltaY)}})});u(d);a(l).on("focusin focusout",function(b){a(b.target).attr("aria-grabbed","focus"===b.type)});a(l).on("keydown",function(a){function b(a,d,e,f,h){a.stopPropagation();a.preventDefault();x(c,e,f,h)}var c;g.each(y,function(b){if(a.target.id==s+"-"+b.name)return c=b,!1});switch(a.keyCode){case f.LEFT:b(a,c,d,-10,0);break;case f.RIGHT:b(a,c,d,10,0);break;case f.UP:b(a,c,d,
0,-10);break;case f.DOWN:b(a,c,d,0,10);break;case f.ENTER:case f.SPACEBAR:a.preventDefault(),q()}})})(l);return n=g.extend({toggleVisibility:function(b){var d;d=g.map(y,function(a){return"#"+s+"-"+a.name}).concat(g.map(A,function(a){return"#"+s+"-"+a})).join(",");b?a(d,l).show():a(d,l).hide()},setClampRect:function(a){k=a;u(d)},setRect:I,getInnerRect:function(){return{x:d.x-k.x,y:d.y-k.y,w:d.w,h:d.h}},setInnerRect:p,setViewPortRect:function(a){m=a;u(d)},destroy:function(){g.each(t,function(a){a.destroy()});
t=[]}},h)}});k("tinymce.plugins.imagetools.ui.ImagePanel","tinymce.core.geom.Rect tinymce.core.ui.Control tinymce.core.ui.DragHelper tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.ui.CropRect".split(" "),function(a,e,c,g,h,f){function b(a){return new g(function(b){function c(){a.removeEventListener("load",c);b(a)}a.complete?b(a):a.addEventListener("load",c)})}return e.extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",
a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(d){var c=this,e=new Image;e.src=d;b(e).then(function(){var b,d=c.state.get("viewRect");b=c.$el.find("img");b[0]?b.replaceWith(e):(b=document.createElement("div"),b.className="mce-imagepanel-bg",c.getEl().appendChild(b),c.getEl().appendChild(e));b={x:0,y:0,w:e.naturalWidth,h:e.naturalHeight};c.state.set("viewRect",
b);c.state.set("rect",a.inflate(b,-20,-20));d&&d.w==b.w&&d.h==b.h||c.zoomFit();c.repaintImage();c.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var a,b,c;a=this.$el.find("img");b=this.getEl().clientWidth;c=this.getEl().clientHeight;a=Math.min((b-10)/a[0].naturalWidth,(c-10)/a[0].naturalHeight);1<=a&&(a=1);this.zoom(a)},repaintImage:function(){var a,
b,c,e,f,h,g,k,p,n;a=this.getEl();p=this.zoom();n=this.state.get("rect");g=this.$el.find("img");k=this.$el.find(".mce-imagepanel-bg");f=a.offsetWidth;h=a.offsetHeight;c=g[0].naturalWidth*p;e=g[0].naturalHeight*p;a=Math.max(0,f/2-c/2);b=Math.max(0,h/2-e/2);g.css({left:a,top:b,width:c,height:e});k.css({left:a,top:b,width:c,height:e});this.cropRect&&(this.cropRect.setRect({x:n.x*p+a,y:n.y*p+b,w:n.w*p,h:n.h*p}),this.cropRect.setClampRect({x:a,y:b,w:c,h:e}),this.cropRect.setViewPortRect({x:0,y:0,w:f,h:h}))},
bindStates:function(){function a(c){b.cropRect=new f(c,b.state.get("viewRect"),b.state.get("viewRect"),b.getEl(),function(){b.fire("crop")});b.cropRect.on("updateRect",function(a){a=a.rect;var c=b.zoom();a={x:Math.round(a.x/c),y:Math.round(a.y/c),w:Math.round(a.w/c),h:Math.round(a.h/c)};b.state.set("rect",a)});b.on("remove",b.cropRect.destroy)}var b=this;b.state.on("change:cropEnabled",function(a){b.cropRect.toggleVisibility(a.value);b.repaintImage()});b.state.on("change:zoom",function(){b.repaintImage()});
b.state.on("change:rect",function(c){c=c.value;b.cropRect||a(c);b.cropRect.setRect(c)})}})});k("tinymce.plugins.imagetools.core.UndoStack",[],function(){return function(){function a(){return-1!=c&&c<e.length-1}var e=[],c=-1;return{data:e,add:function(a){var h;h=e.splice(++c);e.push(a);return{state:a,removed:h}},undo:function(){if(0<c)return e[--c]},redo:function(){if(a())return e[++c]},canUndo:function(){return 0<c},canRedo:a}}});k("tinymce.plugins.imagetools.ui.Dialog","ephox.imagetools.api.BlobConversions ephox.imagetools.api.ImageTransformations tinymce.core.dom.DOMUtils tinymce.core.ui.Container tinymce.core.ui.Factory tinymce.core.ui.Form tinymce.core.util.Promise tinymce.core.util.Tools tinymce.plugins.imagetools.ui.ImagePanel tinymce.plugins.imagetools.core.UndoStack".split(" "),
function(a,e,c,g,h,f,b,d,k,r){function l(a){return{blob:a,url:URL.createObjectURL(a)}}function q(a){a&&URL.revokeObjectURL(a.url)}function x(b,x,p){function n(a){var b,c,d,e;b=w.find("#w")[0];c=w.find("#h")[0];d=parseInt(b.value(),10);e=parseInt(c.value(),10);w.find("#constrain")[0].checked()&&M&&N&&d&&e&&("w"==a.control.settings.name?(e=Math.round(d*Y),c.value(e)):(d=Math.round(e*Z),b.value(d)));M=d;N=e}function y(a){return Math.round(100*a)+"%"}function t(){w.find("#undo").disabled(!G.canUndo());
w.find("#redo").disabled(!G.canRedo());w.statusbar.find("#save").disabled(!G.canUndo())}function A(){w.find("#undo").disabled(!0);w.find("#redo").disabled(!0)}function s(a){a&&E.imageSrc(a.url)}function z(a){return function(){var b=d.grep($,function(b){return b.settings.name!=a});d.each(b,function(a){a.hide()});a.show();a.focus()}}function X(a){B=l(a);s(B)}function R(a){b=l(a);s(b);a=G.add(b).removed;d.each(a,q);t()}function P(){var c=E.selection();a.blobToImageResult(b.blob).then(function(a){e.crop(a,
c.x,c.y,c.w,c.h).then(Q).then(function(a){R(a);C()})})}function L(c){var d=[].slice.call(arguments,1);return function(){a.blobToImageResult((B||b).blob).then(function(a){c.apply(this,[a].concat(d)).then(Q).then(X)})}}function K(c){var d=[].slice.call(arguments,1);return function(){a.blobToImageResult(b.blob).then(function(a){c.apply(this,[a].concat(d)).then(Q).then(R)})}}function C(){s(b);q(B);z(S)();t()}function J(){B&&(R(B.blob),C())}function v(a){return new f({layout:"flex",direction:"row",labelGap:5,
border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:a})}function F(c,d){return v([{text:"Back",onclick:C},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:J}]).hide().on("show",function(){A();a.blobToImageResult(b.blob).then(function(a){return d(a)}).then(Q).then(function(a){a=l(a);s(a);q(B);B=a})})}function D(c,d,e,f,h){function g(c){a.blobToImageResult(b.blob).then(function(a){return d(a,
c)}).then(Q).then(function(a){a=l(a);s(a);q(B);B=a})}return v([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){g(a.value)},minValue:f,maxValue:h,value:e,previewFilter:y},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:J}]).hide().on("show",function(){this.find("slider").value(e);A()})}var w,G=new r,S,V,B,T,U,H,E,W,aa,ba,ca,da,ea,O,fa,ga,ha,ia,ja,ka,$,M,N,Y,Z,Q=function(a){return a.toBlob()};T=v([{text:"Back",onclick:C},{type:"spacer",flex:1},
{text:"Apply",subtype:"primary",onclick:P}]).hide().on("show hide",function(a){E.toggleCropRect("show"==a.type)}).on("show",A);U=v([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:n},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:n},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(a){!0===a.control.value()&&(Y=N/M,Z=M/N)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",
function(a){var b=parseInt(w.find("#w").value(),10),c=parseInt(w.find("#h").value(),10);a.preventDefault();K(e.resize,b,c)();C()}).on("show",A);H=v([{text:"Back",onclick:C},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:L(e.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:L(e.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:L(e.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:L(e.rotate,90)},{type:"spacer",flex:1},{text:"Apply",
subtype:"primary",onclick:J}]).hide().on("show",A);aa=F("Invert",e.invert);ha=F("Sharpen",e.sharpen);ia=F("Emboss",e.emboss);ba=D("Brightness",e.brightness,0,-1,1);ca=D("Hue",e.hue,180,0,360);da=D("Saturate",e.saturate,0,-1,1);ea=D("Contrast",e.contrast,0,-1,1);O=D("Grayscale",e.grayscale,0,0,1);fa=D("Sepia",e.sepia,0,0,1);ga=function(c,d){function e(){var c,f,h;c=w.find("#r")[0].value();f=w.find("#g")[0].value();h=w.find("#b")[0].value();a.blobToImageResult(b.blob).then(function(a){return d(a,c,
f,h)}).then(Q).then(function(a){a=l(a);s(a);q(B);B=a})}return v([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:e,previewFilter:y},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:e,previewFilter:y},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:e,previewFilter:y},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:J}]).hide().on("show",function(){w.find("#r,#g,#b").value(1);
A()})}("Colorize",e.colorize);ja=D("Gamma",e.gamma,0,-1,1);ka=D("Exposure",e.exposure,1,0,2);V=v([{text:"Back",onclick:C},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:z(ca)},{text:"saturate",icon:"saturate",onclick:z(da)},{text:"sepia",icon:"sepia",onclick:z(fa)},{text:"emboss",icon:"emboss",onclick:z(ia)},{text:"exposure",icon:"exposure",onclick:z(ka)},{type:"spacer",flex:1}]).hide();S=v([{tooltip:"Crop",icon:"crop",onclick:z(T)},{tooltip:"Resize",icon:"resize2",onclick:z(U)},{tooltip:"Orientation",
icon:"orientation",onclick:z(H)},{tooltip:"Brightness",icon:"sun",onclick:z(ba)},{tooltip:"Sharpen",icon:"sharpen",onclick:z(ha)},{tooltip:"Contrast",icon:"contrast",onclick:z(ea)},{tooltip:"Color levels",icon:"drop",onclick:z(ga)},{tooltip:"Gamma",icon:"gamma",onclick:z(ja)},{tooltip:"Invert",icon:"invert",onclick:z(aa)}]);E=new k({flex:1,imageSrc:b.url});W=new g({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){b=
G.undo();s(b);t()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){b=G.redo();s(b);t()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=E.zoom();2>a&&(a+=0.1);E.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=E.zoom();0.1<a&&(a-=0.1);E.zoom(a)}}]});W=new g({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[W,E]});$=[S,T,U,H,V,aa,ba,ca,da,ea,O,fa,ga,ha,ia,ja,ka];w=h.create("window",{layout:"flex",
direction:"column",align:"stretch",minWidth:Math.min(c.DOM.getViewPort().w,800),minHeight:Math.min(c.DOM.getViewPort().h,650),title:"Edit image",items:$.concat([W]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){x(b.blob);w.close()}},{text:"Cancel",onclick:"close"}]});w.renderTo(document.body).reflow();w.on("close",function(){p();d.each(G.data,q);B=G=null});G.add(b);t();E.on("load",function(){M=E.imageSize().w;N=E.imageSize().h;Y=N/M;Z=M/N;w.find("#w").value(M);w.find("#h").value(N)});
E.on("crop",P)}return{edit:function(a){return new b(function(b,c){return a.toBlob().then(function(a){x(l(a),b,c)})})}}});k("tinymce.plugins.imagetools.Plugin","ephox.imagetools.api.BlobConversions ephox.imagetools.api.ImageTransformations tinymce.core.Env tinymce.core.PluginManager tinymce.core.util.Delay tinymce.core.util.Promise tinymce.core.util.Tools tinymce.core.util.URI tinymce.plugins.imagetools.core.ImageSize tinymce.plugins.imagetools.core.Proxy tinymce.plugins.imagetools.ui.Dialog".split(" "),
function(a,e,c,g,h,f,b,d,k,r,l){g.add("imagetools",function(g){function x(a){g.notificationManager.open({text:a,type:"error"})}function u(){return g.selection.getNode()}function I(a){return(a=a.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?g.dom.encode(a[1]):null}function p(a){a=a.src;return 0===a.indexOf("data:")||0===a.indexOf("blob:")||(new d(a)).host===g.documentBaseURI.host}function n(a){return-1!==b.inArray(g.settings.imagetools_cors_hosts,(new d(a.src)).host)}function y(){var b;if(b=
g.editorUpload.blobCache.getByUri(u().src))return f.resolve(b.blob());var c=u();b=c.src;n(c)?b=r.getUrl(c.src,null):p(c)?b=a.imageToBlob(c):(b=g.settings.imagetools_proxy,b+=(-1===b.indexOf("?")?"?":"&")+"url="+encodeURIComponent(c.src),c=g.settings.api_key||g.settings.imagetools_api_key,b=r.getUrl(b,c));return b}function t(){J=h.setEditorTimeout(g,function(){g.editorUpload.uploadImagesAuto()},g.settings.images_upload_timeout||3E4)}function A(a,b){return a.toBlob().then(function(c){var d,e,f,h,k;
f=g.editorUpload.blobCache;k=u();d=k.src;g.settings.images_reuse_filename&&((h=f.getByUri(d))?(d=h.uri(),e=h.name()):e=I(d));h=f.create({id:"imagetools"+C++,blob:c,base64:a.toBase64(),uri:d,name:e});f.add(h);g.undoManager.transact(function(){function a(){g.$(k).off("load",a);g.nodeChanged();b?g.editorUpload.uploadImagesAuto():(clearTimeout(J),t())}g.$(k).on("load",a);g.$(k).attr({src:h.blobUri()}).removeAttr("data-mce-src")});return h})}function s(b){return function(){return g._scanForImages().then(y).then(a.blobToImageResult).then(b).then(A,
x)}}function z(a){return function(){return s(function(b){var c=k.getImageSize(u());c&&k.setImageSize(u(),{w:c.h,h:c.w});return e.rotate(b,a)})()}}function H(a){return function(){return s(function(b){return e.flip(b,a)})()}}function K(){var b=u(),c=k.getNaturalImageSize(b),d=function(d){return new f(function(e){a.blobToImage(d).then(function(a){var f=k.getNaturalImageSize(a);(c.w!=f.w||c.h!=f.h)&&k.getImageSize(b)&&k.setImageSize(b,f);URL.revokeObjectURL(a.src);e(d)})})};y().then(a.blobToImageResult).then(function(b){return l.edit(b).then(d).then(a.blobToImageResult).then(function(a){return A(a,
!0)},function(){})},x)}function P(){g.on("NodeChange",function(a){v&&v.src!=a.element.src&&(clearTimeout(J),g.editorUpload.uploadImagesAuto(),v=void 0);L(a.element)&&(v=a.element)})}function L(a){return g.dom.is(a,"img:not([data-mce-object],[data-mce-placeholder])")&&(p(a)||n(a)||g.settings.imagetools_proxy)}function O(){var a=g.settings.imagetools_toolbar;a||(a="rotateleft rotateright | flipv fliph | crop editimage imageoptions");g.addContextToolbar(L,a)}var C=0,J,v;c.fileApi&&(b.each({mceImageRotateLeft:z(-90),
mceImageRotateRight:z(90),mceImageFlipVertical:H("v"),mceImageFlipHorizontal:H("h"),mceEditImage:K},function(a,b){g.addCommand(b,a)}),g.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),g.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),g.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),g.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),g.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),
g.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),O(),P())});return function(){}});O("tinymce.plugins.imagetools.Plugin")()})();
