(function(){var p={},t=function(b){var k=p[b];if(void 0===k)throw"module ["+b+"] was undefined";if(void 0===k.instance){for(var m=p[b],q=m.deps,l=m.defn,e=q.length,f=Array(e),s=0;s<e;++s)f[s]=t(q[s]);q=l.apply(null,f);if(void 0===q)throw"module ["+b+"] returned undefined";m.instance=q}return k.instance},e=function(b,k,m){if("string"!==typeof b)throw"module id must be a string";if(void 0===k)throw"no dependencies for "+b;if(void 0===m)throw"no definition function for "+b;p[b]={deps:k,defn:m,instance:void 0}};
(function(b,k){e(b,[],function(){return k})})("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);e("tinymce.core.html.DomParser",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.html.DomParser")});e("tinymce.core.html.Node",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.html.Node")});e("tinymce.core.html.Serializer",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.html.Serializer")});e("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],
function(b){return b("tinymce.PluginManager")});e("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(b){return b("tinymce.util.Tools")});e("tinymce.plugins.fullpage.Protect",["tinymce.core.util.Tools"],function(b){return{protectHtml:function(k,m){b.each(k,function(b){m=m.replace(b,function(b){return"\x3c!--mce:protected "+escape(b)+"--\x3e"})});return m},unprotectHtml:function(b){return b.replace(/\x3c!--mce:protected ([\s\S]*?)--\x3e/g,function(b,k){return unescape(k)})}}});
e("tinymce.plugins.fullpage.Plugin","tinymce.core.html.DomParser tinymce.core.html.Node tinymce.core.html.Serializer tinymce.core.PluginManager tinymce.core.util.Tools tinymce.plugins.fullpage.Protect".split(" "),function(b,k,m,e,l,p){e.add("fullpage",function(f){function e(){var a=w(),h={},d;h.fontface=f.getParam("fullpage_default_fontface","");h.fontsize=f.getParam("fullpage_default_fontsize","");d=a.firstChild;7==d.type&&(h.xml_pi=!0,d=/encoding="([^"]+)"/.exec(d.value))&&(h.docencoding=d[1]);
if(d=a.getAll("#doctype")[0])h.doctype="<!DOCTYPE"+d.value+">";(d=a.getAll("title")[0])&&d.firstChild&&(h.title=d.firstChild.value);u(a.getAll("meta"),function(a){var d=a.attr("name"),b=a.attr("http-equiv");d?h[d.toLowerCase()]=a.attr("content"):"Content-Type"==b&&(a=/charset\s*=\s*(.*)\s*/gi.exec(a.attr("content")))&&(h.docencoding=a[1])});if(d=a.getAll("html")[0])h.langcode=d.attr("lang")||""||d.attr("xml:lang")||"";h.stylesheets=[];l.each(a.getAll("link"),function(a){"stylesheet"==a.attr("rel")&&
h.stylesheets.push(a.attr("href"))});if(d=a.getAll("body")[0])h.langdir=d.attr("dir")||"",h.style=d.attr("style")||"",h.visited_color=d.attr("vlink")||"",h.link_color=d.attr("link")||"",h.active_color=d.attr("alink")||"";return h}function q(a){function h(a,c,d){a.attr(c,d?d:void 0)}function d(a){g.firstChild?g.insert(a,g.firstChild):g.append(a)}var b,g,e,c,p=f.dom;b=w();g=b.getAll("head")[0];g||(c=b.getAll("html")[0],g=new k("head",1),c.firstChild?c.insert(g,c.firstChild,!0):c.append(g));c=b.firstChild;
a.xml_pi?(e='version="1.0"',a.docencoding&&(e+=' encoding="'+a.docencoding+'"'),7!=c.type&&(c=new k("xml",7),b.insert(c,b.firstChild,!0)),c.value=e):c&&7==c.type&&c.remove();c=b.getAll("#doctype")[0];a.doctype?(c||(c=new k("#doctype",10),a.xml_pi?b.insert(c,b.firstChild):d(c)),c.value=a.doctype.substring(9,a.doctype.length-1)):c&&c.remove();c=null;u(b.getAll("meta"),function(a){"Content-Type"==a.attr("http-equiv")&&(c=a)});a.docencoding?(c||(c=new k("meta",1),c.attr("http-equiv","Content-Type"),c.shortEnded=
!0,d(c)),c.attr("content","text/html; charset="+a.docencoding)):c&&c.remove();c=b.getAll("title")[0];a.title?(c?c.empty():(c=new k("title",1),d(c)),c.append(new k("#text",3)).value=a.title):c&&c.remove();u(["keywords","description","author","copyright","robots"],function(h){var f=b.getAll("meta"),g,e,l=a[h];for(g=0;g<f.length;g++)if(e=f[g],e.attr("name")==h){l?e.attr("content",l):e.remove();return}l&&(c=new k("meta",1),c.attr("name",h),c.attr("content",l),c.shortEnded=!0,d(c))});var n={};l.each(b.getAll("link"),
function(a){"stylesheet"==a.attr("rel")&&(n[a.attr("href")]=a)});l.each(a.stylesheets,function(a){n[a]||(c=new k("link",1),c.attr({rel:"stylesheet",text:"text/css",href:a}),c.shortEnded=!0,d(c));delete n[a]});l.each(n,function(a){a.remove()});if(c=b.getAll("body")[0])h(c,"dir",a.langdir),h(c,"style",a.style),h(c,"vlink",a.visited_color),h(c,"link",a.link_color),h(c,"alink",a.active_color),p.setAttribs(f.getBody(),{style:a.style,dir:a.dir,vLink:a.visited_color,link:a.link_color,aLink:a.active_color});
if(c=b.getAll("html")[0])h(c,"lang",a.langcode),h(c,"xml:lang",a.langcode);g.firstChild||g.remove();e=(new m({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"})).serialize(b);r=e.substring(0,e.indexOf("</body>"))}function w(){return(new b({validate:!1,root_name:"#document"})).parse(r)}function t(){var a="",b,d="";f.getParam("fullpage_default_xml_pi")&&(a+='<?xml version="1.0" encoding="'+
f.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n');a+=f.getParam("fullpage_default_doctype","<!DOCTYPE html>");a+="\n<html>\n<head>\n";if(b=f.getParam("fullpage_default_title"))a+="<title>"+b+"</title>\n";if(b=f.getParam("fullpage_default_encoding"))a+='<meta http-equiv="Content-Type" content="text/html; charset='+b+'" />\n';if(b=f.getParam("fullpage_default_font_family"))d+="font-family: "+b+";";if(b=f.getParam("fullpage_default_font_size"))d+="font-size: "+b+";";if(b=f.getParam("fullpage_default_text_color"))d+=
"color: "+b+";";return a+("</head>\n<body"+(d?' style="'+d+'"':"")+">\n")}var u=l.each,r,v;f.addCommand("mceFullPageProperties",function(){var a=e();f.windowManager.open({title:"Document properties",data:a,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(b){q(l.extend(a,b.data))}})});f.addButton("fullpage",
{title:"Document properties",cmd:"mceFullPageProperties"});f.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"});f.on("BeforeSetContent",function(a){function b(a){return a.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase()})}var d,e,g,k="",c=f.dom;if(!(a.selection||(g=p.protectHtml(f.settings.protect,a.content),"raw"==a.format&&r)||a.source_view&&f.getParam("fullpage_hide_in_source_view"))){0!==g.length||a.source_view||(g=l.trim(r)+"\n"+l.trim(g)+
"\n"+l.trim(v));g=g.replace(/<(\/?)BODY/gi,"<$1body");d=g.indexOf("<body");-1!=d?(d=g.indexOf(">",d),r=b(g.substring(0,d+1)),e=g.indexOf("</body",d),-1==e&&(e=g.length),a.content=l.trim(g.substring(d+1,e)),v=b(g.substring(e))):(r=t(),v="\n</body>\n</html>");a=w();u(a.getAll("style"),function(a){a.firstChild&&(k+=a.firstChild.value)});(d=a.getAll("body")[0])&&c.setAttribs(f.getBody(),{style:d.attr("style")||"",dir:d.attr("dir")||"",vLink:d.attr("vlink")||"",link:d.attr("link")||"",aLink:d.attr("alink")||
""});c.remove("fullpage_styles");var m=f.getDoc().getElementsByTagName("head")[0];k&&(c.add(m,"style",{id:"fullpage_styles"},k),d=c.get("fullpage_styles"),d.styleSheet&&(d.styleSheet.cssText=k));var n={};l.each(m.getElementsByTagName("link"),function(a){"stylesheet"==a.rel&&a.getAttribute("data-mce-fullpage")&&(n[a.href]=a)});l.each(a.getAll("link"),function(a){var b=a.attr("href");if(!b)return!0;n[b]||"stylesheet"!=a.attr("rel")||c.add(m,"link",{rel:"stylesheet",text:"text/css",href:b,"data-mce-fullpage":"1"});
delete n[b]});l.each(n,function(a){a.parentNode.removeChild(a)})}});f.on("GetContent",function(a){a.selection||a.source_view&&f.getParam("fullpage_hide_in_source_view")||(a.content=p.unprotectHtml(l.trim(r)+"\n"+l.trim(a.content)+"\n"+l.trim(v)))})});return function(){}});t("tinymce.plugins.fullpage.Plugin")()})();
