(function(){var s={},C=function(e){var m=s[e];if(void 0===m)throw"module ["+e+"] was undefined";if(void 0===m.instance){for(var n=s[e],p=n.deps,k=n.defn,b=p.length,B=Array(b),z=0;z<b;++z)B[z]=C(p[z]);p=k.apply(null,B);if(void 0===p)throw"module ["+e+"] returned undefined";n.instance=p}return m.instance},k=function(e,m,k){if("string"!==typeof e)throw"module id must be a string";if(void 0===m)throw"no dependencies for "+e;if(void 0===k)throw"no definition function for "+e;s[e]={deps:m,defn:k,instance:void 0}};
(function(e,m){k(e,[],function(){return m})})("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);k("tinymce.core.Env",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.Env")});k("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")});k("tinymce.core.util.JSON",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.JSON")});k("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")});
k("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.XHR")});k("tinymce.plugins.image.Plugin",["tinymce.core.Env","tinymce.core.PluginManager","tinymce.core.util.JSON","tinymce.core.util.Tools","tinymce.core.util.XHR"],function(e,k,n,p,s){k.add("image",function(b){function k(b,e){function x(b,l){g.parentNode&&g.parentNode.removeChild(g);e({width:b,height:l})}var g=document.createElement("img");g.onload=function(){x(Math.max(g.width,g.clientWidth),Math.max(g.height,
g.clientHeight))};g.onerror=function(){x()};var r=g.style;r.visibility="hidden";r.position="fixed";r.bottom=r.left=0;r.width=r.height="auto";document.body.appendChild(g);g.src=b}function m(b,e,k){function g(b,l){l=l||[];p.each(b,function(b){var h={text:b.text||b.title};b.menu?h.menu=g(b.menu):(h.value=b.value,e(h));l.push(h)});return l}return g(b,k||[])}function w(e){return function(){var k=b.settings.image_list;"string"==typeof k?s.send({url:k,success:function(b){e(n.parse(b))}}):"function"==typeof k?
k(e):e(k)}}function u(l){function A(){var a,b,c,d;a=h.find("#width")[0];b=h.find("#height")[0];a&&b&&(c=a.value(),d=b.value(),h.find("#constrain")[0].checked()&&t&&v&&c&&d&&(t!=c?(d=Math.round(c/t*d),isNaN(d)||b.value(d)):(c=Math.round(d/v*c),isNaN(c)||a.value(c))),t=c,v=d)}function x(){function a(a){function c(){a.onload=a.onerror=null;b.selection&&(b.selection.select(a),b.nodeChanged())}a.onload=function(){d.width||d.height||!u||f.setAttribs(a,{width:a.clientWidth,height:a.clientHeight});c()};a.onerror=
c}var q,e;s();A();d=p.extend(d,h.toJSON());d.alt||(d.alt="");d.title||(d.title="");""===d.width&&(d.width=null);""===d.height&&(d.height=null);d.style||(d.style=null);""===d.align&&(d.align=null);d={src:d.src,alt:d.alt,align:d.align,title:d.title,width:d.width,height:d.height,style:d.style,caption:d.caption,"class":d["class"]};b.undoManager.transact(function(){function h(a){return b.schema.getTextBlockElements()[a.nodeName]}if(d.src)if(""===d.title&&(d.title=null),c?f.setAttribs(c,d):(d.id="__mcenew",
b.focus(),b.selection.setContent(f.createHTML("img",d)),c=f.get("__mcenew"),f.setAttrib(c,"id",null)),b.editorUpload.uploadImagesAuto(),!1===d.caption&&f.is(c.parentNode,"figure.image")&&(q=c.parentNode,f.insertAfter(c,q),f.remove(q)),!0===d.caption){if(!f.is(c.parentNode,"figure.image")){e=c;c=c.cloneNode(!0);q=f.create("figure",{"class":"image"});q.appendChild(c);q.appendChild(f.create("figcaption",{contentEditable:!0},"Caption"));q.contentEditable=!1;var g=f.getParent(e,h);g?f.split(g,e,q):f.replace(q,
e);b.selection.select(q)}}else a(c);else c&&(f.remove(c),b.focus(),b.nodeChanged())});var g=zenario.scrollTop();setTimeout(function(){zenario.scrollTop(g)},0)}function g(a){a&&(a=a.replace(/px$/,""));return a}function r(a){if(a.margin){var b=a.margin.split(" ");switch(b.length){case 1:a["margin-top"]=a["margin-top"]||b[0];a["margin-right"]=a["margin-right"]||b[0];a["margin-bottom"]=a["margin-bottom"]||b[0];a["margin-left"]=a["margin-left"]||b[0];break;case 2:a["margin-top"]=a["margin-top"]||b[0];
a["margin-right"]=a["margin-right"]||b[1];a["margin-bottom"]=a["margin-bottom"]||b[0];a["margin-left"]=a["margin-left"]||b[1];break;case 3:a["margin-top"]=a["margin-top"]||b[0];a["margin-right"]=a["margin-right"]||b[1];a["margin-bottom"]=a["margin-bottom"]||b[2];a["margin-left"]=a["margin-left"]||b[1];break;case 4:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[1],a["margin-bottom"]=a["margin-bottom"]||b[2],a["margin-left"]=a["margin-left"]||b[3]}delete a.margin}return a}
function s(){function a(a){0<a.length&&/^[0-9]+$/.test(a)&&(a+="px");return a}if(b.settings.image_advtab){var c=h.toJSON(),d=f.parseStyle(c.style),d=r(d);c.vspace&&(d["margin-top"]=d["margin-bottom"]=a(c.vspace));c.hspace&&(d["margin-left"]=d["margin-right"]=a(c.hspace));c.border&&(d["border-width"]=a(c.border));h.find("#style").value(f.serializeStyle(f.parseStyle(f.serializeStyle(d))))}}function D(){if(b.settings.image_advtab){var a=h.toJSON(),a=f.parseStyle(a.style);h.find("#vspace").value("");
h.find("#hspace").value("");a=r(a);if(a["margin-top"]&&a["margin-bottom"]||a["margin-right"]&&a["margin-left"])a["margin-top"]===a["margin-bottom"]?h.find("#vspace").value(g(a["margin-top"])):h.find("#vspace").value(""),a["margin-right"]===a["margin-left"]?h.find("#hspace").value(g(a["margin-right"])):h.find("#hspace").value("");a["border-width"]&&h.find("#border").value(g(a["border-width"]));h.find("#style").value(f.serializeStyle(f.parseStyle(f.serializeStyle(a))))}}var h,d={},f=b.dom,c,n,t,v,y,
w,u=!1!==b.settings.image_dimensions;c=b.selection.getNode();(n=f.getParent(c,"figure.image"))&&(c=f.select("img",n)[0]);c&&("IMG"!=c.nodeName||c.getAttribute("data-mce-object")||c.getAttribute("data-mce-placeholder"))&&(c=null);c&&(t=f.getAttrib(c,"width"),v=f.getAttrib(c,"height"),d={src:f.getAttrib(c,"src"),alt:f.getAttrib(c,"alt"),align:f.getAttrib(c,"align"),title:f.getAttrib(c,"title"),"class":f.getAttrib(c,"class"),width:t,height:v,caption:!!n});l&&(y={type:"listbox",label:"Image list",values:m(l,
function(a){a.value=b.convertURL(a.value||a.url,"src")},[{text:"None",value:""}]),value:d.src&&b.convertURL(d.src,"src"),onselect:function(a){var b=h.find("#alt");(!b.value()||a.lastControl&&b.value()==a.lastControl.text())&&b.value(a.control.text());h.find("#src").value(a.control.value()).fire("change")},onPostRender:function(){y=this}});!1!==b.settings.image_class&&(w=b.settings.image_class_list?{name:"class",type:"listbox",label:"Class",values:m(b.settings.image_class_list,function(a){a.value&&
(a.textStyle=function(){return b.formatter.getCssText({inline:"img",classes:[a.value]})})})}:{name:"class",type:"textbox",size:40,label:"CSS class name(s)"});l=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(a){var c,d;a=a.meta||{};y&&y.value(b.convertURL(this.value(),"src"));p.each(a,function(a,b){h.find("#"+b).value(a)});a.width||a.height||(a=b.convertURL(this.value(),"src"),c=b.settings.image_prepend_url,d=/^(?:[a-z]+:)?\/\//i,c&&!d.test(a)&&a.substring(0,
c.length)!==c&&(a=c+a),this.value(a),k(b.documentBaseURI.toAbsolute(this.value()),function(a){a.width&&a.height&&u&&(t=a.width,v=a.height,h.find("#width").value(t),h.find("#height").value(v))}))},onbeforecall:function(a){a.meta=h.toJSON()}},y];!1!==b.settings.image_description&&l.push({name:"alt",type:"textbox",label:"Image alt tag",classes:"image_alt"});b.settings.image_title&&l.push({name:"title",type:"textbox",label:"Image Title"});u&&l.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",
align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:A,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:A,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});l.push(w);!1!==b.settings.image_alignment&&l.push({type:"listbox",name:"align",label:"Alignment",values:[{text:"-- Not Set --",value:""},{text:"Left",value:"left"},{text:"Right",value:"right"},{text:"Middle",value:"middle"},
{text:"Top",value:"top"},{text:"Bottom",value:"bottom"}]});b.settings.image_caption&&e.ceFalse&&l.push({name:"caption",type:"checkbox",label:"Caption"});b.settings.image_advtab?(c&&(c.style.marginLeft&&c.style.marginRight&&c.style.marginLeft===c.style.marginRight&&(d.hspace=g(c.style.marginLeft)),c.style.marginTop&&c.style.marginBottom&&c.style.marginTop===c.style.marginBottom&&(d.vspace=g(c.style.marginTop)),c.style.borderWidth&&(d.border=g(c.style.borderWidth)),d.style=b.dom.serializeStyle(b.dom.parseStyle(b.dom.getAttrib(c,
"style")))),h=b.windowManager.open({title:"Insert/edit image",data:d,bodyType:"tabpanel",body:[{title:"General",type:"form",items:l},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:D},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:s},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:x})):
h=b.windowManager.open({title:"Insert/edit image",data:d,body:l,onSubmit:x})}b.on("preInit",function(){function e(b){return(b=b.attr("class"))&&/\bimage\b/.test(b)}function k(b){return function(g){function k(e){e.attr("contenteditable",b?"true":null)}for(var m=g.length,n;m--;)n=g[m],e(n)&&(n.attr("contenteditable",b?"false":null),p.each(n.getAll("figcaption"),k))}}b.parser.addNodeFilter("figure",k(!0));b.serializer.addNodeFilter("figure",k(!1))});b.addButton("image",{icon:"image",tooltip:"Insert/edit image",
onclick:w(u),stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"});b.addMenuItem("image",{icon:"image",text:"Image",onclick:w(u),context:"insert",prependToContext:!0});b.addCommand("mceImage",w(u))});return function(){}});C("tinymce.plugins.image.Plugin")()})();
