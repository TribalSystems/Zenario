(function(){var k={},m=function(a){var d=k[a];if(void 0===d)throw"module ["+a+"] was undefined";if(void 0===d.instance){for(var c=k[a],l=c.deps,f=c.defn,b=l.length,s=Array(b),g=0;g<b;++g)s[g]=m(l[g]);l=f.apply(null,s);if(void 0===l)throw"module ["+a+"] returned undefined";c.instance=l}return d.instance},f=function(a,d,c){if("string"!==typeof a)throw"module id must be a string";if(void 0===d)throw"no dependencies for "+a;if(void 0===c)throw"no definition function for "+a;k[a]={deps:d,defn:c,instance:void 0}},
n=function(a,d){f(a,[],function(){return d})};n("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve);f("tinymce.core.EditorManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.EditorManager")});f("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.PluginManager")});f("tinymce.core.util.LocalStorage",["global!tinymce.util.Tools.resolve"],function(a){return a("tinymce.util.LocalStorage")});f("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],
function(a){return a("tinymce.util.Tools")});n("global!window",window);f("tinymce.plugins.autosave.Plugin",["tinymce.core.EditorManager","tinymce.core.PluginManager","tinymce.core.util.LocalStorage","tinymce.core.util.Tools","global!window"],function(a,d,c,f,k){a._beforeUnloadHandler=function(){var b;f.each(a.editors,function(a){a.plugins.autosave&&a.plugins.autosave.storeDraft();!b&&a.isDirty()&&a.getParam("autosave_ask_before_unload",!0)&&(b=a.translate("You have unsaved changes are you sure you want to navigate away?"))});
return b};d.add("autosave",function(b){function d(a,b){var c={s:1E3,m:6E4};a=/^(\d+)([ms]?)$/.exec(""+(a||b));return(a[2]?c[a[2]]:1)*parseInt(a,10)}function g(){var a=parseInt(c.getItem(e+"time"),10)||0;return(new Date).getTime()-a>h.autosave_retention?(p(!1),!1):!0}function p(a){c.removeItem(e+"draft");c.removeItem(e+"time");!1!==a&&b.fire("RemoveDraft")}function m(){!q()&&b.isDirty()&&(c.setItem(e+"draft",b.getContent({format:"raw",no_events:!0})),c.setItem(e+"time",(new Date).getTime()),b.fire("StoreDraft"))}
function r(){g()&&(b.setContent(c.getItem(e+"draft"),{format:"raw"}),b.fire("RestoreDraft"))}function n(){t||(setInterval(function(){b.removed||m()},h.autosave_interval),t=!0)}function u(){var a=this;a.disabled(!g());b.on("StoreDraft RestoreDraft RemoveDraft",function(){a.disabled(!g())});n()}function v(){b.undoManager.beforeChange();r();p();b.undoManager.add()}function q(a){var c=b.settings.forced_root_block;a=f.trim("undefined"==typeof a?b.getBody().innerHTML:a);return""===a||RegExp("^<"+c+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+
c+">|<br>$","i").test(a)}var h=b.settings,e,t;e=h.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";e=e.replace(/\{path\}/g,document.location.pathname);e=e.replace(/\{query\}/g,document.location.search);e=e.replace(/\{id\}/g,b.id);h.autosave_interval=d(h.autosave_interval,"30s");h.autosave_retention=d(h.autosave_retention,"20m");b.addButton("restoredraft",{title:"Restore last draft",onclick:v,onPostRender:u});b.addMenuItem("restoredraft",{text:"Restore last draft",onclick:v,onPostRender:u,context:"file"});
!1!==b.settings.autosave_restore_when_empty&&(b.on("init",function(){g()&&q()&&r()}),b.on("saveContent",function(){p()}));k.onbeforeunload=a._beforeUnloadHandler;this.hasDraft=g;this.storeDraft=m;this.restoreDraft=r;this.removeDraft=p;this.isEmpty=q});return function(){}});m("tinymce.plugins.autosave.Plugin")()})();
