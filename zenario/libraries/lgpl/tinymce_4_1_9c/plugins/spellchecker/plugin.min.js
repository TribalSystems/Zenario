(function(D,z){function L(f,d){for(var c,r=[],n=0;n<f.length;++n){if(!(c=A[f[n]]))a:{c=D;for(var p=f[n].split(/[.\/]/),s=0;s<p.length;++s){if(!c[p[s]]){c=void 0;break a}c=c[p[s]]}}if(!c)throw"module definition dependecy not found: "+f[n];r.push(c)}d.apply(null,r)}function J(f,d,c){if("string"!==typeof f)throw"invalid module definition, module id must be defined and be a string";if(d===z)throw"invalid module definition, dependencies must be specified";if(c===z)throw"invalid module definition, definition function must be specified";
L(d,function(){A[f]=c.apply(null,arguments)})}var A={};J("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(f,d){function c(b,k){if(!b[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:b.index,end:b.index+b[0].length,text:b[0],data:k}}function r(b){var k;if(3===b.nodeType)return b.data;if(x[b.nodeName]&&!u[b.nodeName])return"";k="";if(u[b.nodeName]||v[b.nodeName])k+="\n";if(b=b.firstChild){do k+=r(b);while(b=b.nextSibling)}return k}function n(b,
k,B){var a,g,c,h,d=[],q=0,e=b,m,f=0;k=k.slice(0);k.sort(function(b,k){return b.start-k.start});m=k.shift();a:for(;;){(u[e.nodeName]||v[e.nodeName])&&q++;3===e.nodeType&&(!g&&e.length+q>=m.end?(g=e,h=m.end-q):a&&d.push(e),!a&&e.length+q>m.start&&(a=e,c=m.start-q),q+=e.length);if(a&&g){if(e=B({startNode:a,startNodeIndex:c,endNode:g,endNodeIndex:h,innerNodes:d,match:m.text,matchIndex:f}),q-=g.length-h,g=a=null,d=[],m=k.shift(),f++,!m)break}else if((!x[e.nodeName]||u[e.nodeName])&&e.firstChild){e=e.firstChild;
continue}else if(e.nextSibling){e=e.nextSibling;continue}for(;;)if(e.nextSibling){e=e.nextSibling;break}else if(e.parentNode!==b)e=e.parentNode;else break a}}function p(b){function k(k,a){var g=l[a];g.stencil||(g.stencil=b(g));g=g.stencil.cloneNode(!1);g.setAttribute("data-mce-index",a);k&&g.appendChild(G.doc.createTextNode(k));return g}return function(b){var a,g,c,h=b.startNode,d=b.endNode,f=b.matchIndex;g=G.doc;if(h===d)return c=h.parentNode,0<b.startNodeIndex&&(a=g.createTextNode(h.data.substring(0,
b.startNodeIndex)),c.insertBefore(a,h)),a=k(b.match,f),c.insertBefore(a,h),b.endNodeIndex<h.length&&(g=g.createTextNode(h.data.substring(b.endNodeIndex)),c.insertBefore(g,h)),h.parentNode.removeChild(h),a;a=g.createTextNode(h.data.substring(0,b.startNodeIndex));g=g.createTextNode(d.data.substring(b.endNodeIndex));var e=k(h.data.substring(b.startNodeIndex),f);c=[];for(var m=0,n=b.innerNodes.length;m<n;++m){var l=b.innerNodes[m],p=k(l.data,f);l.parentNode.replaceChild(p,l);c.push(p)}b=k(d.data.substring(0,
b.endNodeIndex),f);c=h.parentNode;c.insertBefore(a,h);c.insertBefore(e,h);c.removeChild(h);c=d.parentNode;c.insertBefore(b,d);c.insertBefore(g,d);c.removeChild(d);return b}}function s(b){var a=f.getElementsByTagName("*"),c=[];b="number"==typeof b?""+b:null;for(var d=0;d<a.length;d++){var g=a[d],l=g.getAttribute("data-mce-index");null!==l&&l.length&&(l!==b&&null!==b||c.push(g))}return c}function C(b){for(var a=l.length;a--;)if(l[a]===b)return a;return-1}function a(b){for(var a=0,c=l.length;a<c&&!1!==
b(l[a],a);a++);return this}function K(b){var a=s(b?C(b):null);for(b=a.length;b--;){var c=a[b];c.parentNode.insertBefore(c.firstChild,c);c.parentNode.removeChild(c)}return this}function y(b){b=s(C(b));var a=d.dom.createRng();a.setStartBefore(b[0]);a.setEndAfter(b[b.length-1]);return a}var H,l=[],w,G=d.dom,u,x,v;u=d.schema.getBlockElements();x=d.schema.getWhiteSpaceElements();v=d.schema.getShortEndedElements();w=r(f);return{text:w,matches:l,each:a,filter:function(b){var c=[];a(function(a,d){b(a,d)&&
c.push(a)});l=c;return this},reset:function(){l.splice(0,l.length);K();return this},matchFromElement:function(a){return l[a.getAttribute("data-mce-index")]},elementFromMatch:function(a){return s(C(a))[0]},find:function(a,d){if(w&&a.global)for(;H=a.exec(w);)l.push(c(H,d));return this},add:function(a,c,d){l.push({start:a,end:a+c,text:w.substr(a,c),data:d});return this},wrap:function(a){l.length&&n(f,l,p(a));return this},unwrap:K,replace:function(a,c){var f=y(a);f.deleteContents();0<c.length&&f.insertNode(d.dom.doc.createTextNode(c));
return f},rangeFromMatch:y,indexOf:C}}});J("tinymce/spellcheckerplugin/Plugin","tinymce/spellcheckerplugin/DomTextMatcher tinymce/PluginManager tinymce/util/Tools tinymce/ui/Menu tinymce/dom/DOMUtils tinymce/util/XHR tinymce/util/URI tinymce/util/JSON".split(" "),function(f,d,c,r,n,p,s,C){d.add("spellchecker",function(a,d){function y(){E.textMatcher||(E.textMatcher=new f(a.getBody(),a));return E.textMatcher}function H(a){for(var b in a)return!1;return!0}function l(I,d){var e=[];c.each(q[I],function(b){e.push({text:b,
onclick:function(){a.insertContent(a.dom.encode(b));a.dom.remove(d);v()}})});e.push({text:"-"});D&&e.push({text:"Add to Dictionary",onclick:function(){b(I,d)}});e.push.apply(e,[{text:"Ignore",onclick:function(){k(I,d)}},{text:"Ignore all",onclick:function(){k(I,d,!0)}}]);m=new r({items:e,context:"contextmenu",onautohide:function(a){-1!=a.target.className.indexOf("spellchecker")&&a.preventDefault()},onhide:function(){m.remove();m=null}});m.renderTo(document.body);var g=n.DOM.getPos(a.getContentAreaContainer()),
f=a.dom.getPos(d[0]),h=a.dom.getRoot();"BODY"==h.nodeName?(f.x-=h.ownerDocument.documentElement.scrollLeft||h.scrollLeft,f.y-=h.ownerDocument.documentElement.scrollTop||h.scrollTop):(f.x-=h.scrollLeft,f.y-=h.scrollTop);g.x+=f.x;g.y+=f.y;m.moveTo(g.x,g.y+d[0].offsetHeight)}function w(){return a.getParam("spellchecker_wordchar_pattern")||RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009]+',
"g")}function G(a,b,e,f){var g={method:a},h="";"spellcheck"==a&&(g.text=b,g.lang=t.spellchecker_language);"addToDictionary"==a&&(g.word=b);c.each(g,function(a,b){h&&(h+="&");h+=b+"="+encodeURIComponent(a)});p.send({url:(new s(d)).toAbsolute(t.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:h,success:function(a){(a=C.parse(a))?a.error?f(a.error):e(a):f("Sever response wasn't proper JSON.")},error:function(a,b){f("Spellchecker request error: "+b.status)}})}function u(a,
b,c,d){(t.spellchecker_callback||G).call(E,a,b,c,d)}function x(){function b(c){a.windowManager.alert(c);a.setProgressState(!1);B()}e?B():(B(),a.setProgressState(!0),u("spellcheck",y().text,A,b),a.focus())}function v(){a.dom.select("span.mce-spellchecker-word").length||B()}function b(b,c){a.setProgressState(!0);u("addToDictionary",b,function(){a.setProgressState(!1);a.dom.remove(c,!0);v()},function(b){a.windowManager.alert(b);a.setProgressState(!1)})}function k(b,d,e){a.selection.collapse();e?c.each(a.dom.select("span.mce-spellchecker-word"),
function(c){c.getAttribute("data-mce-word")==b&&a.dom.remove(c,!0)}):a.dom.remove(d,!0);v()}function B(){y().reset();E.textMatcher=null;e&&(e=!1,a.fire("SpellcheckEnd"))}function z(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function g(a){var b=t.spellchecker_language;a.control.items().each(function(a){a.active(a.settings.data===b)})}function A(b){var c;b.words?(D=!!b.dictionary,c=b.words):c=b;a.setProgressState(!1);H(c)?(a.windowManager.alert("No misspellings found"),e=
!1):(q=c,y().find(w()).filter(function(a){return!!c[a.text]}).wrap(function(b){return a.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":b.text})}),e=!0,a.fire("SpellcheckStart"))}var h,E=this,q,e,m,t=a.settings,D;h=function(a,b){var d=[];c.each(b,function(a){d.push({selectable:!0,text:a.name,data:a.value})});return d}("Language",c.map((t.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),
function(a){a=a.split("=");return{name:a[0],value:a[1]}}));a.on("click",function(b){var d=b.target;if("mce-spellchecker-word"==d.className){b.preventDefault();var e=z(d),f;b=[];f=c.toArray(a.getBody().getElementsByTagName("span"));if(f.length)for(var g=0;g<f.length;g++){var h=z(f[g]);null!==h&&h.length&&h===e.toString()&&b.push(f[g])}0<b.length&&(e=a.dom.createRng(),e.setStartBefore(b[0]),e.setEndAfter(b[b.length-1]),a.selection.setRng(e),l(d.getAttribute("data-mce-word"),b))}});a.addMenuItem("spellchecker",
{text:"Spellcheck",context:"tools",onclick:x,selectable:!0,onPostRender:function(){var b=this;b.active(e);a.on("SpellcheckStart SpellcheckEnd",function(){b.active(e)})}});var F={tooltip:"Spellcheck",onclick:x,onPostRender:function(){var b=this;a.on("SpellcheckStart SpellcheckEnd",function(){b.active(e)})}};1<h.length&&(F.type="splitbutton",F.menu=h,F.onshow=g,F.onselect=function(a){t.spellchecker_language=a.control.settings.data});a.addButton("spellchecker",F);a.addCommand("mceSpellCheck",x);a.on("remove",
function(){m&&(m.remove(),m=null)});a.on("change",v);this.getTextMatcher=y;this.getWordCharPattern=w;this.markErrors=A;this.getLanguage=function(){return t.spellchecker_language};t.spellchecker_language=t.spellchecker_language||t.language||"en"})});(function(f){for(var d=0;d<f.length;d++){for(var c=D,r=f[d],n=r.split(/[.\/]/),p=0;p<n.length-1;++p)c[n[p]]===z&&(c[n[p]]={}),c=c[n[p]];c[n[n.length-1]]=A[r]}})(["tinymce/spellcheckerplugin/DomTextMatcher"])})(this);
