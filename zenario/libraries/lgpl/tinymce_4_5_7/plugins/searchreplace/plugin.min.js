(function(){function u(d){return d&&1==d.nodeType&&"false"===d.contentEditable}function y(d,l,n,v,f){function p(a,b){b=b||0;if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var g=a.index;if(0<b){var c=a[b];if(!c)throw"Invalid capture group";g+=a[0].indexOf(c);a[0]=c}return[g,g+a[0].length,[a[0]]]}function w(a){var b;if(3===a.nodeType)return a.data;if(c[a.nodeName]&&!e[a.nodeName])return"";b="";if(u(a))return"\n";if(e[a.nodeName]||s[a.nodeName])b+="\n";if(a=a.firstChild){do b+=
w(a);while(a=a.nextSibling)}return b}function z(a,b,g){var t,d,h,m,x=[],q=0,k=a,f=b.shift(),l=0;a:for(;;){(e[k.nodeName]||s[k.nodeName]||u(k))&&q++;3===k.nodeType&&(!d&&k.length+q>=f[1]?(d=k,m=f[1]-q):t&&x.push(k),!t&&k.length+q>f[0]&&(t=k,h=f[0]-q),q+=k.length);if(t&&d){if(k=g({startNode:t,startNodeIndex:h,endNode:d,endNodeIndex:m,innerNodes:x,match:f[2],matchIndex:l}),q-=d.length-m,d=t=null,x=[],f=b.shift(),l++,!f)break}else if((!c[k.nodeName]||e[k.nodeName])&&k.firstChild){if(!u(k)){k=k.firstChild;
continue}}else if(k.nextSibling){k=k.nextSibling;continue}for(;;)if(k.nextSibling){k=k.nextSibling;break}else if(k.parentNode!==a)k=k.parentNode;else break a}}function m(a){var b;if("function"!=typeof a){var c=a.nodeType?a:g.createElement(a);b=function(a,b){var e=c.cloneNode(!1);e.setAttribute("data-mce-index",b);a&&e.appendChild(g.createTextNode(a));return e}}else b=a;return function(a){var c,e,d,f=a.startNode,h=a.endNode,k=a.matchIndex;if(f===h)return d=f.parentNode,0<a.startNodeIndex&&(c=g.createTextNode(f.data.substring(0,
a.startNodeIndex)),d.insertBefore(c,f)),c=b(a.match[0],k),d.insertBefore(c,f),a.endNodeIndex<f.length&&(e=g.createTextNode(f.data.substring(a.endNodeIndex)),d.insertBefore(e,f)),f.parentNode.removeChild(f),c;c=g.createTextNode(f.data.substring(0,a.startNodeIndex));e=g.createTextNode(h.data.substring(a.endNodeIndex));var m=b(f.data.substring(a.startNodeIndex),k);d=[];for(var s=0,l=a.innerNodes.length;s<l;++s){var r=a.innerNodes[s],n=b(r.data,k);r.parentNode.replaceChild(n,r);d.push(n)}a=b(h.data.substring(0,
a.endNodeIndex),k);d=f.parentNode;d.insertBefore(c,f);d.insertBefore(m,f);d.removeChild(f);d=h.parentNode;d.insertBefore(a,h);d.insertBefore(e,h);d.removeChild(h);return a}}var h=[],a,b=0,g,e,c,s;g=l.ownerDocument;e=f.getBlockElements();c=f.getWhiteSpaceElements();s=f.getShortEndedElements();if(a=w(l)){if(d.global)for(;f=d.exec(a);)h.push(p(f,v));else f=a.match(d),h.push(p(f,v));h.length&&(b=h.length,z(l,h,m(n)));return b}}tinymce.PluginManager.add("searchreplace",function(d){function l(){function a(){c.statusbar.find("#next").disabled(!f(h+
1).length);c.statusbar.find("#prev").disabled(!f(h-1).length)}function b(){d.windowManager.alert("Could not find the specified string.",function(){c.find("#find")[0].focus()})}var g={},e;e=tinymce.trim(d.selection.getContent({format:"text"}));var c=d.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){d.focus();m.done()},onSubmit:function(d){var e,l,n;d.preventDefault();e=c.find("#case").checked();n=c.find("#words").checked();l=c.find("#find").value();l.length?g.text==
l&&g.caseState==e&&g.wholeWord==n?0===f(h+1).length?b():(m.next(),a()):((d=m.find(l,e,n))||b(),c.statusbar.items().slice(1).disabled(0===d),a(),g={text:l,caseState:e,wholeWord:n}):(m.done(!1),c.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){c.submit()}},{text:"Replace",disabled:!0,onclick:function(){m.replace(c.find("#replace").value())||(c.statusbar.items().slice(1).disabled(!0),h=-1,g={})}},{text:"Replace all",disabled:!0,onclick:function(){m.replace(c.find("#replace").value(),
!0,!0);c.statusbar.items().slice(1).disabled(!0);g={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){m.prev();a()}},{text:"Next",name:"next",disabled:!0,onclick:function(){m.next();a()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:e},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",
name:"words",text:"Whole words",label:" "}]}})}function n(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function v(a){var b=a.parentNode;a.firstChild&&b.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}function f(a){var b,g=[];b=tinymce.toArray(d.getBody().getElementsByTagName("span"));if(b.length)for(var e=0;e<b.length;e++){var c=n(b[e]);null!==c&&c.length&&c===a.toString()&&g.push(b[e])}return g}function p(a){var b=h,g=d.dom;!1!==a?b++:b--;g.removeClass(f(h),"mce-match-marker-selected");
a=f(b);return a.length?(g.addClass(f(b),"mce-match-marker-selected"),d.selection.scrollIntoView(a[0]),b):-1}function w(a){var b=d.dom,g=a.parentNode;b.remove(a);b.isEmpty(g)&&b.remove(g)}function u(a){a=n(a);return null!==a&&0<a.length}var m=this,h=-1;m.init=function(a){a.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:l,separator:"before",context:"edit"});a.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:l});a.addCommand("SearchReplace",
l);a.shortcuts.add("Meta+F","",l)};m.find=function(a,b,g){a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");a=RegExp(g?"\\b"+a+"\\b":a,b?"g":"gi");g=d.dom.create("span",{"data-mce-bogus":1});g.className="mce-match-marker";b=d.getBody();m.done(!1);if(a=y(a,b,g,!1,d.schema))h=-1,h=p(!0);return a};m.next=function(){var a=p(!0);-1!==a&&(h=a)};m.prev=function(){var a=p(!1);-1!==a&&(h=a)};m.replace=function(a,b,g){var e,c,l,r,p=h;b=!1!==b;e=d.getBody();c=tinymce.grep(tinymce.toArray(e.getElementsByTagName("span")),
u);for(e=0;e<c.length;e++)if(l=n(c[e]),l=r=parseInt(l,10),g||l===h){a.length?(c[e].firstChild.nodeValue=a,v(c[e])):w(c[e]);for(;c[++e];)if(l=parseInt(n(c[e]),10),l===r)w(c[e]);else{e--;break}b&&p--}else r>h&&c[e].setAttribute("data-mce-index",r-1);d.undoManager.add();h=p;b?(a=0<f(p+1).length,m.next()):(a=0<f(p-1).length,m.prev());return!g&&a};m.done=function(a){var b,g,e,c;g=tinymce.toArray(d.getBody().getElementsByTagName("span"));for(b=0;b<g.length;b++){var f=n(g[b]);null!==f&&f.length&&(f===h.toString()&&
(e||(e=g[b].firstChild),c=g[b].firstChild),v(g[b]))}if(e&&c)return b=d.dom.createRng(),b.setStart(e,0),b.setEnd(c,c.data.length),!1!==a&&d.selection.setRng(b),b}})})();
