tinymce.PluginManager.add("textpattern",function(f){function l(){m&&(k.sort(function(b,a){return b.start.length>a.start.length?-1:b.start.length<a.start.length?1:0}),m=!1);return k}function n(b){for(var a=l(),c=0;c<a.length;c++)if(0===b.indexOf(a[c].start)&&(!a[c].end||b.lastIndexOf(a[c].end)==b.length-a[c].end.length))return a[c]}function p(b){var a,c,g,e,h,d;a=f.selection;c=f.dom;if(a.isCollapsed()&&(g=a.getRng(!0),a=g.startContainer,g=g.startOffset,h=a.data,b=b?1:0,3==a.nodeType)){a:{var k;e=l();
for(k=0;k<e.length;k++)if(d=e[k],d.end&&h.substr(g-d.end.length-b,d.end.length)==d.end)break a;d=void 0}if(d&&(e=Math.max(0,g-b),e=h.lastIndexOf(d.start,e-d.end.length-1),-1!==e&&(c=c.createRng(),c.setStart(a,e),c.setEnd(a,g-b),(d=n(c.toString()))&&d.end&&!(a.data.length<=d.start.length+d.end.length)&&(c=f.formatter.get(d.format))&&c[0].inline)))return a=a.splitText(e),a.splitText(g-e-b),a.deleteData(0,d.start.length),a.deleteData(a.data.length-d.end.length,d.end.length),f.formatter.apply(d.format,
{},a),a}}function q(){var b,a,c,g,e,h,d;b=f.selection;a=f.dom;if(b.isCollapsed()&&(a=a.getParent(b.getStart(),"p"))){for(g=new tinymce.dom.TreeWalker(a,a);a=g.next();)if(3==a.nodeType){c=a;break}c&&(e=n(c.data))&&(h=b.getRng(!0),a=h.startContainer,d=h.startOffset,c==a&&(d=Math.max(0,d-e.start.length)),tinymce.trim(c.data).length!=e.start.length&&(e.format&&(g=f.formatter.get(e.format))&&g[0].block&&(c.deleteData(0,e.start.length),f.formatter.apply(e.format,{},c),h.setStart(a,d),h.collapse(!0),b.setRng(h)),
e.cmd&&f.undoManager.transact(function(){c.deleteData(0,e.start.length);f.execCommand(e.cmd)})))}}var m=!0,k;k=f.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];f.on("keydown",
function(b){if(13==b.keyCode&&!tinymce.util.VK.modifierPressed(b)){var a;if(a=p())b=f.dom.createRng(),b.setStart(a,a.data.length),b.setEnd(a,a.data.length),f.selection.setRng(b);q()}},!0);f.on("keyup",function(b){if(32==b.keyCode&&!tinymce.util.VK.modifierPressed(b)){var a,c;if(b=p(!0))c=f.dom,a=b.data.slice(-1),/[\u00a0 ]/.test(a)&&(b.deleteData(b.data.length-1,1),a=c.doc.createTextNode(a),b.nextSibling?c.insertAfter(a,b.nextSibling):b.parentNode.appendChild(a),b=c.createRng(),b.setStart(a,1),b.setEnd(a,
1),f.selection.setRng(b))}});this.getPatterns=l;this.setPatterns=function(b){k=b;m=!0}});
