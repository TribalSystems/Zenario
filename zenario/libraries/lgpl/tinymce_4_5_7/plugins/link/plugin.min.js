tinymce.PluginManager.add("link",function(a){function q(a){return a&&"A"===a.nodeName&&a.href}function r(a){return 0<tinymce.util.Tools.grep(a,q).length}function n(c){return a.dom.getParent(c,"a[href]")}function y(c){var b,h;if(b=a.settings.link_context_toolbar)b=a.plugins.contextmenu,b=!(b&&b.isContextMenuVisible())&&q(c);return b&&(c=a.selection,b=c.getRng(),h=b.startContainer,3==h.nodeType&&c.isCollapsed()&&0<b.startOffset&&b.startOffset<h.data.length)?!0:!1}function p(c){if(c){var b;b=(b=c.getAttribute("data-mce-href"))?
b:c.getAttribute("href");if(/^#/.test(b))c=a.$(b),c.length&&a.selection.scrollIntoView(c[0],!0);else if(c=c.href,!tinymce.Env.ie||10<tinymce.Env.ie)b=document.createElement("a"),b.target="_blank",b.href=c,b.rel="noreferrer noopener",c=document.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(b),b.dispatchEvent(c),document.body.removeChild(b);else if(b=window.open("","_blank"))b.opener=null,b=b.document,b.open(),b.write('<meta http-equiv="refresh" content="0; url='+
tinymce.DOM.encode(c)+'">'),b.close()}}function s(){p(n(a.selection.getStart()))}function l(c){return function(){var b=a.settings.link_list;"string"==typeof b?tinymce.util.XHR.send({url:b,success:function(a){c(tinymce.util.JSON.parse(a))}}):"function"==typeof b?b(c):c(b)}}function w(a,b,h){function d(a,c){c=c||[];tinymce.each(a,function(a){var e={text:a.text||a.title};a.menu?e.menu=d(a.menu):(e.value=a.value,b&&b(e));c.push(e)});return c}return d(a,h||[])}function k(c){function b(a){var b=t.find("#text");
(!b.value()||a.lastControl&&b.value()==a.lastControl.text())&&b.value(a.control.text());t.find("#href").value(a.control.value())}function h(){!l&&0===d.text.length&&u&&this.parent().parent().find("#text")[0].value(this.value())}var d={},k=a.selection,m=a.dom,f,e,l,t,u,n,v,p,q,r,s;f=k.getNode();e=m.getParent(f,"a[href]");u=function(a){var b=k.getContent();if(/</.test(b)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(b)||-1==b.indexOf("href=")))return!1;if(a){a=a.childNodes;if(0===a.length)return!1;for(b=a.length-
1;0<=b;b--)if(3!=a[b].nodeType)return!1}return!0}();d.text=l=e?e.innerText||e.textContent:k.getContent({format:"text"});d.href=e?m.getAttrib(e,"href"):"";e?d.target=m.getAttrib(e,"target"):a.settings.default_link_target&&(d.target=a.settings.default_link_target);if(f=m.getAttrib(e,"rel"))d.rel=f;if(f=m.getAttrib(e,"class"))d["class"]=f;if(f=m.getAttrib(e,"title"))d.title=f;u&&(n={name:"text",type:"textbox",size:40,label:"Text to display",classes:"link_text_to_display",onchange:function(){d.text=this.value()}});
c&&(v={type:"listbox",label:"Link list",values:w(c,function(b){b.value=a.convertURL(b.value||b.url,"href")},[{text:"None",value:""}]),onselect:b,value:a.convertURL(d.href,"href"),onPostRender:function(){v=this}});!1!==a.settings.target_list&&(a.settings.target_list||(a.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),q={name:"target",type:"listbox",label:"Target",values:w(a.settings.target_list)});a.settings.rel_list&&(p={name:"rel",type:"listbox",label:"Rel",values:w(a.settings.rel_list)});
!1!==a.settings.link_class&&(r=a.settings.link_class_list?{name:"class",type:"listbox",label:"Class",values:w(a.settings.link_class_list,function(b){b.value&&(b.textStyle=function(){return a.formatter.getCssText({inline:"a",classes:[b.value]})})})}:{name:"class",type:"textbox",size:40,label:"CSS class name(s)"});!1!==a.settings.link_title&&(s={name:"title",type:"textbox",label:"Title",value:d.title});t=a.windowManager.open({title:"Insert link",data:d,body:[{name:"href",type:"filepicker",filetype:"file",
size:40,autofocus:!0,label:"Url",classes:"zenario_link_picker",onchange:function(b){var c=b.meta||{};v&&v.value(a.convertURL(this.value(),"href"));tinymce.each(b.meta,function(a,b){var c=t.find("#"+b);"text"===b?0===l.length&&(c.value(a),d.text=a):c.value(a)});c.attach&&(x={href:this.value(),attach:c.attach});c.text||h.call(this)},onkeyup:h,onbeforecall:function(a){a.meta=t.toJSON()}},n,s,function(c){var d=[];tinymce.each(a.dom.select("a:not([href])"),function(a){(a=a.name||a.id)&&d.push({text:a,
value:"#"+a,selected:-1!=c.indexOf("#"+a)})});if(d.length)return d.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:d,onselect:b}}(d.href),v,p,q,r],onSubmit:function(b){function c(b,d){var e=a.selection.getRng();tinymce.util.Delay.setEditorTimeout(a,function(){a.windowManager.confirm(b,function(b){a.selection.setRng(e);d(b)})})}function h(a,b){function c(a){return(a=d(a))?[a,e].join(" "):e}function d(a){var b=RegExp("("+e.replace(" ","|")+")","g");a&&(a=tinymce.trim(a.replace(b,
"")));return a?a:null}var e="noopener noreferrer";return b?c(a):d(a)}function f(){var b={href:g,target:d.target?d.target:null,rel:d.rel?d.rel:null,"class":d["class"]?d["class"]:null,title:d.title?d.title:null};a.settings.allow_unsafe_link_target||(b.rel=h(b.rel,"_blank"==b.target));g===x.href&&(x.attach(),x={});e?(a.focus(),u&&d.text!=l&&("innerText"in e?e.innerText=d.text:e.textContent=d.text),m.setAttribs(e,b),k.select(e),a.undoManager.add()):u?a.insertContent(m.createHTML("a",b,m.encode(d.text))):
a.execCommand("mceInsertLink",!1,b)}var g;d=tinymce.extend(d,b.data);(g=d.href)?0<g.indexOf("@")&&-1==g.indexOf("//")&&-1==g.indexOf("mailto:")?c("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(b){b&&(g="mailto:"+g);a.undoManager.transact(f)}):a.settings.link_assume_external_targets&&!/^\w+:/i.test(g)||!a.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(g)?c("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",
function(b){b&&(g="http://"+g);a.undoManager.transact(f)}):a.undoManager.transact(f):a.execCommand("unlink")}});zenarioA.setLinkPickerOnTinyMCE()}var x={};a.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Meta+K",onclick:l(k),stateSelector:"a[href]"});a.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"});a.addContextToolbar&&(a.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:s}),a.addContextToolbar(y,"openlink | link unlink"));
a.addShortcut("Meta+K","",l(k));a.addCommand("mceLink",l(k));a.on("click",function(a){var b=n(a.target);b&&tinymce.util.VK.metaKeyPressed(a)&&(a.preventDefault(),p(b))});a.on("keydown",function(c){var b=n(a.selection.getStart());b&&13===c.keyCode&&!0===c.altKey&&!1===c.shiftKey&&!1===c.ctrlKey&&!1===c.metaKey&&(c.preventDefault(),p(b))});this.showDialog=k;a.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:s,onPostRender:function(){var c=this,b=function(a){r(a.parents)?c.show():c.hide()};
r(a.dom.getParents(a.selection.getStart()))||c.hide();a.on("nodechange",b);c.on("remove",function(){a.off("nodechange",b)})},prependToContext:!0});a.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:l(k),stateSelector:"a[href]",context:"insert",prependToContext:!0})});
