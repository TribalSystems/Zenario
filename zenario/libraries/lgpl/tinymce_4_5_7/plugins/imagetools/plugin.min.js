(function(){var F={},G=function(b){var e=F[b];if(void 0===e)throw"module ["+b+"] was undefined";if(void 0===e.instance){for(var c=F[b],d=c.deps,l=c.defn,k=d.length,g=Array(k),a=0;a<k;++a)g[a]=G(d[a]);d=l.apply(null,g);if(void 0===d)throw"module ["+b+"] returned undefined";c.instance=d}return e.instance},n=function(b,e,c){if("string"!==typeof b)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+b;if(void 0===c)throw"no definition function for "+b;F[b]={deps:e,defn:c,instance:void 0}},
r=function(b,e){n(b,[],function(){return e})};r("global!tinymce.PluginManager",tinymce.PluginManager);r("global!tinymce.Env",tinymce.Env);r("global!tinymce.util.Promise",tinymce.util.Promise);r("global!tinymce.util.URI",tinymce.util.URI);r("global!tinymce.util.Tools",tinymce.util.Tools);r("global!tinymce.util.Delay",tinymce.util.Delay);n("ephox/imagetools/util/Canvas",[],function(){function b(b,c,d){b.width=c;b.height=d;return b}return{create:function(e,c){return b(document.createElement("canvas"),
e,c)},resize:b,get2dContext:function(b){return b.getContext("2d")},get3dContext:function(b){var c=null;try{c=b.getContext("webgl")||b.getContext("experimental-webgl")}catch(d){}c||(c=null);return c}}});n("ephox/imagetools/util/ImageSize",[],function(){return{getWidth:function(b){return b.naturalWidth||b.width},getHeight:function(b){return b.naturalHeight||b.height}}});n("ephox/imagetools/util/Promise",[],function(){function b(f,h){return function(){f.apply(h,arguments)}}function e(f){if("object"!==
typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof f)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];a(f,b(d,this),b(l,this))}function c(f){var h=this;null===this._state?this._deferreds.push(f):p(function(){var a=h._state?f.onFulfilled:f.onRejected;if(null===a)(h._state?f.resolve:f.reject)(h._value);else{var b;try{b=a(h._value)}catch(m){f.reject(m);return}f.resolve(b)}})}function d(f){try{if(f===this)throw new TypeError("A promise cannot be resolved with itself.");
if(f&&("object"===typeof f||"function"===typeof f)){var h=f.then;if("function"===typeof h){a(b(h,f),b(d,this),b(l,this));return}}this._state=!0;this._value=f;k.call(this)}catch(m){l.call(this,m)}}function l(f){this._state=!1;this._value=f;k.call(this)}function k(){for(var f=0,h=this._deferreds.length;f<h;f++)c.call(this,this._deferreds[f]);this._deferreds=null}function g(f,h,a,b){this.onFulfilled="function"===typeof f?f:null;this.onRejected="function"===typeof h?h:null;this.resolve=a;this.reject=
b}function a(f,h,a){var b=!1;try{f(function(f){b||(b=!0,h(f))},function(f){b||(b=!0,a(f))})}catch(m){b||(b=!0,a(m))}}if(window.Promise)return window.Promise;var p=e.immediateFn||"function"===typeof setImmediate&&setImmediate||function(f){setTimeout(f,1)},m=Array.isArray||function(f){return"[object Array]"===Object.prototype.toString.call(f)};e.prototype["catch"]=function(f){return this.then(null,f)};e.prototype.then=function(f,h){var a=this;return new e(function(b,m){c.call(a,new g(f,h,b,m))})};e.all=
function(){var f=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new e(function(h,a){function b(c,g){try{if(g&&("object"===typeof g||"function"===typeof g)){var e=g.then;if("function"===typeof e){e.call(g,function(f){b(c,f)},a);return}}f[c]=g;0===--m&&h(f)}catch(p){a(p)}}if(0===f.length)return h([]);for(var m=f.length,c=0;c<f.length;c++)b(c,f[c])})};e.resolve=function(f){return f&&"object"===typeof f&&f.constructor===e?f:new e(function(a){a(f)})};e.reject=
function(f){return new e(function(a,b){b(f)})};e.race=function(f){return new e(function(a,b){for(var m=0,c=f.length;m<c;m++)f[m].then(a,b)})};return e});n("ephox/imagetools/util/Mime",[],function(){return{guessMimeType:function(b){var e=document.createElement("a");e.href=b;b=e.pathname.split(".");(b=b[b.length-1])&&(b=b.toLowerCase());return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[b]}}});n("ephox/imagetools/util/Conversions",["ephox/imagetools/util/Promise","ephox/imagetools/util/Canvas",
"ephox/imagetools/util/Mime","ephox/imagetools/util/ImageSize"],function(b,e,c,d){function l(a){return new b(function(f){function b(){a.removeEventListener("load",b);f(a)}a.complete?f(a):a.addEventListener("load",b)})}function k(a){return l(a).then(function(a){var b;b=e.create(d.getWidth(a),d.getHeight(a));e.get2dContext(b).drawImage(a,0,0);return b})}function g(a){return new b(function(b){var h=new XMLHttpRequest;h.open("GET",a,!0);h.responseType="blob";h.onload=function(){200==this.status&&b(this.response)};
h.send()})}function a(a){return new b(function(b){var h,c,g,e,p;a=a.split(",");(h=/data:([^;]+)/.exec(a[0]))&&(e=h[1]);h=atob(a[1]);if(window.WebKitBlobBuilder){p=new WebKitBlobBuilder;c=new ArrayBuffer(h.length);for(g=0;g<c.length;g++)c[g]=h.charCodeAt(g);p.append(c);b(p.getBlob(e))}else{c=new Uint8Array(h.length);for(g=0;g<c.length;g++)c[g]=h.charCodeAt(g);b(new Blob([c],{type:e}))}})}function p(a){return new b(function(b){var h=new FileReader;h.onloadend=function(){b(h.result)};h.readAsDataURL(a)})}
return{blobToImage:function(a){return new b(function(b){function h(){c.removeEventListener("load",h);b(c)}var c=new Image;c.addEventListener("load",h);c.src=URL.createObjectURL(a);c.complete&&h()})},imageToBlob:function(b){return l(b).then(function(b){var h=b.src;return 0===h.indexOf("blob:")?g(h):0===h.indexOf("data:")?a(h):k(b).then(function(b){return a(b.toDataURL(c.guessMimeType(h)))})})},blobToDataUri:p,blobToBase64:function(a){return p(a).then(function(a){return a.split(",")[1]})},imageToCanvas:k,
canvasToBlob:function(b,f){return a(b.toDataURL(f))},revokeImageUrl:function(a){URL.revokeObjectURL(a.src)},uriToBlob:function(b){return 0===b.indexOf("blob:")?g(b):0===b.indexOf("data:")?a(b):null}}});n("ephox/imagetools/transformations/ColorMatrix",[],function(){function b(b,c,g){b=parseFloat(b);b>g?b=g:b<c&&(b=c);return b}function e(b,c){var g,a,e,m,f=[],h=Array(10);for(g=0;5>g;g++){for(a=0;5>a;a++)f[a]=c[a+5*g];for(a=0;5>a;a++){for(e=m=0;5>e;e++)m+=b[a+5*e]*f[e];h[a+5*g]=m}}return h}function c(c,
e){e=b(e,0,1);return c.map(function(c,a){c=0===a%6?1-(1-c)*e:c*e;return b(c,0,1)})}var d=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,
7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:c,multiply:e,adjustContrast:function(c,k){var g;k=b(k,-1,1);k*=100;0>k?g=127+127*(k/100):(g=k%1,g=0===g?d[k]:d[Math.floor(k)]*(1-g)+d[Math.floor(k)+1]*g,g=127*g+127);return e(c,[g/127,0,0,0,0.5*(127-g),0,g/127,0,0,0.5*(127-g),0,0,g/127,0,0.5*(127-g),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(c,d){d=b(255*d,-255,255);return e(c,[1,0,0,0,d,0,1,0,0,d,0,0,1,0,d,0,0,0,1,0,
0,0,0,0,1])},adjustSaturation:function(c,d){var g;d=b(d,-1,1);g=1+(0<d?3*d:d);return e(c,[0.3086*(1-g)+g,0.6094*(1-g),0.082*(1-g),0,0,0.3086*(1-g),0.6094*(1-g)+g,0.082*(1-g),0,0,0.3086*(1-g),0.6094*(1-g),0.082*(1-g)+g,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(c,d){var g,a;d=b(d,-180,180)/180*Math.PI;g=Math.cos(d);a=Math.sin(d);return e(c,[0.213+0.787*g+-0.213*a,0.715+-0.715*g+-0.715*a,0.072+-0.072*g+0.928*a,0,0,0.213+-0.213*g+0.143*a,0.715+g*(1-0.715)+0.14*a,0.072+-0.072*g+-0.283*a,0,0,0.213+
-0.213*g+-0.787*a,0.715+-0.715*g+0.715*a,0.072+0.928*g+0.072*a,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(c,d,g,a){d=b(d,0,2);g=b(g,0,2);a=b(a,0,2);return e(c,[d,0,0,0,0,0,g,0,0,0,0,0,a,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(d,k){k=b(k,0,1);return e(d,c([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],k))},adjustGrayscale:function(d,k){k=b(k,0,1);return e(d,c([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],k))}}});
n("ephox/imagetools/transformations/Filters",["ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/util/Conversions","ephox/imagetools/transformations/ColorMatrix"],function(b,e,c,d){function l(a,h){return c.blobToImage(a).then(function(a){var f=b.create(e.getWidth(a),e.getHeight(a)),d=b.get2dContext(f);d.drawImage(a,0,0);m(a);a=d.getImageData(0,0,f.width,f.height);var g=a.data,p,k,l,u,q,t=h[0],L=h[1],I=h[2],M=h[3],n=h[4],O=h[5],A=h[6],r=h[7],B=h[8],E=h[9],v=h[10],s=
h[11],w=h[12],R=h[13],V=h[14],x=h[15],S=h[16],T=h[17],U=h[18],y=h[19];for(q=0;q<g.length;q+=4)p=g[q],k=g[q+1],l=g[q+2],u=g[q+3],g[q]=p*t+k*L+l*I+u*M+n,g[q+1]=p*O+k*A+l*r+u*B+E,g[q+2]=p*v+k*s+l*w+u*R+V,g[q+3]=p*x+k*S+l*T+u*U+y;d.putImageData(a,0,0);return c.canvasToBlob(f)})}function k(a,h){return c.blobToImage(a).then(function(a){var f=b.create(e.getWidth(a),e.getHeight(a)),g=b.get2dContext(f),d;g.drawImage(a,0,0);m(a);a=g.getImageData(0,0,f.width,f.height);d=g.getImageData(0,0,f.width,f.height);
d=function(a,b,f){function c(a,b,f){a>f?a=f:a<b&&(a=b);return a}var h,g,d,e,m,p,k,l,D,H,n,v,s,w;d=Math.round(Math.sqrt(f.length));e=Math.floor(d/2);h=a.data;g=b.data;s=a.width;w=a.height;for(m=0;m<w;m++)for(a=0;a<s;a++){for(H=p=k=l=0;H<d;H++)for(D=0;D<d;D++)n=c(a+D-e,0,s-1),v=c(m+H-e,0,w-1),n=4*(v*s+n),v=f[H*d+D],p+=h[n]*v,k+=h[n+1]*v,l+=h[n+2]*v;n=4*(m*s+a);g[n]=c(p,0,255);g[n+1]=c(k,0,255);g[n+2]=c(l,0,255)}return b}(a,d,h);g.putImageData(d,0,0);return c.canvasToBlob(f)})}function g(a){return function(h,
g){return c.blobToImage(h).then(function(h){var d=b.create(e.getWidth(h),e.getHeight(h)),p=b.get2dContext(d),k,l=Array(256);for(k=0;k<l.length;k++)l[k]=a(k,g);p.drawImage(h,0,0);m(h);h=p.getImageData(0,0,d.width,d.height);k=h.data;var n;for(n=0;n<k.length;n+=4)k[n]=l[k[n]],k[n+1]=l[k[n+1]],k[n+2]=l[k[n+2]];p.putImageData(h,0,0);return c.canvasToBlob(d)})}}function a(a){return function(b,c){return l(b,a(d.identity(),c))}}function p(a){return function(b){return k(b,a)}}var m=c.revokeImageUrl;return{invert:function(a){return function(b){return l(b,
a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:a(d.adjustBrightness),hue:a(d.adjustHue),saturate:a(d.adjustSaturation),contrast:a(d.adjustContrast),grayscale:a(d.adjustGrayscale),sepia:a(d.adjustSepia),colorize:function(a,b,c,g){return l(a,d.adjustColors(d.identity(),b,c,g))},sharpen:p([0,-1,0,-1,5,-1,0,-1,0]),emboss:p([-2,-1,0,-1,1,1,0,1,2]),gamma:g(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:g(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:l,convoluteFilter:k}});
n("ephox/imagetools/transformations/ImageResizerCanvas",["ephox/imagetools/util/Promise","ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize"],function(b,e,c,d){function l(b,a,c){var e=d.getWidth(b),f=d.getHeight(b),e=a/e,h=c/f,f=!1;if(0.5>e||2<e)e=0.5>e?0.5:2,f=!0;if(0.5>h||2<h)h=0.5>h?0.5:2,f=!0;b=k(b,e,h);return f?b.then(function(b){return l(b,a,c)}):b}function k(g,a,e){return new b(function(b){var f=d.getWidth(g),h=d.getHeight(g),k=Math.floor(f*
a),l=Math.floor(h*e),n=c.create(k,l);c.get2dContext(n).drawImage(g,0,0,f,h,0,0,k,l);b(n)})}return{scale:l}});n("ephox/imagetools/transformations/ImageTools",["ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/transformations/ImageResizerCanvas"],function(b,e,c,d){var l=b.revokeImageUrl,k=function(b){return function(a){l(b);return a}};return{rotate:function(d,a){return b.blobToImage(d).then(function(p){var m=e.create(c.getWidth(p),
c.getHeight(p)),f=e.get2dContext(m),h=0,k=0;a=0>a?360+a:a;90!=a&&270!=a||e.resize(m,m.height,m.width);if(90==a||180==a)h=m.width;if(270==a||180==a)k=m.height;f.translate(h,k);f.rotate(a*Math.PI/180);f.drawImage(p,0,0);l(p);return b.canvasToBlob(m,d.type)})},flip:function(d,a){return b.blobToImage(d).then(function(d){var g=e.create(c.getWidth(d),c.getHeight(d)),f=e.get2dContext(g);"v"==a?(f.scale(1,-1),f.drawImage(d,0,-g.height)):(f.scale(-1,1),f.drawImage(d,-g.width,0));l(d);return b.canvasToBlob(g)})},
crop:function(c,a,d,m,f){return b.blobToImage(c).then(function(c){var g=e.create(m,f);e.get2dContext(g).drawImage(c,-a,-d);l(c);return b.canvasToBlob(g)})},resize:function(c,a,e){return b.blobToImage(c).then(function(m){return d.scale(m,a,e).then(function(a){return b.canvasToBlob(a,c.type)}).then(k(m))["catch"](k(m))})}}});n("ephox/imagetools/api/ImageTransformations",["ephox/imagetools/transformations/Filters","ephox/imagetools/transformations/ImageTools"],function(b,e){return{invert:function(c){return b.invert(c)},
sharpen:function(c){return b.sharpen(c)},emboss:function(c){return b.emboss(c)},brightness:function(c,d){return b.brightness(c,d)},hue:function(c,d){return b.hue(c,d)},saturate:function(c,d){return b.saturate(c,d)},contrast:function(c,d){return b.contrast(c,d)},grayscale:function(c,d){return b.grayscale(c,d)},sepia:function(c,d){return b.sepia(c,d)},colorize:function(c,d,e,k){return b.colorize(c,d,e,k)},gamma:function(c,d){return b.gamma(c,d)},exposure:function(c,d){return b.exposure(c,d)},flip:function(b,
d){return e.flip(b,d)},crop:function(b,d,l,k,g){return e.crop(b,d,l,k,g)},resize:function(b,d,l){return e.resize(b,d,l)},rotate:function(b,d){return e.rotate(b,d)}}});n("ephox/imagetools/api/BlobConversions",["ephox/imagetools/util/Conversions"],function(b){return{blobToImage:function(e){return b.blobToImage(e)},imageToBlob:function(e){return b.imageToBlob(e)},blobToDataUri:function(e){return b.blobToDataUri(e)},blobToBase64:function(e){return b.blobToBase64(e)}}});r("global!tinymce.dom.DOMUtils",
tinymce.dom.DOMUtils);r("global!tinymce.ui.Factory",tinymce.ui.Factory);r("global!tinymce.ui.Form",tinymce.ui.Form);r("global!tinymce.ui.Container",tinymce.ui.Container);r("global!tinymce.ui.Control",tinymce.ui.Control);r("global!tinymce.ui.DragHelper",tinymce.ui.DragHelper);r("global!tinymce.geom.Rect",tinymce.geom.Rect);r("global!tinymce.dom.DomQuery",tinymce.dom.DomQuery);r("global!tinymce.util.Observable",tinymce.util.Observable);r("global!tinymce.util.VK",tinymce.util.VK);n("tinymce/imagetoolsplugin/CropRect",
"global!tinymce.dom.DomQuery global!tinymce.ui.DragHelper global!tinymce.geom.Rect global!tinymce.util.Tools global!tinymce.util.Observable global!tinymce.util.VK".split(" "),function(b,e,c,d,l,k){var g=0;return function(a,p,m,f,h){function n(b,f,h,d){var e,g,p;e=f.x;g=f.y;p=f.w;f=f.h;e+=h*b.deltaX;g+=d*b.deltaY;p+=h*b.deltaW;f+=d*b.deltaH;20>p&&(p=20);20>f&&(f=20);b=a=c.clamp({x:e,y:g,w:p,h:f},m,"move"==b.name);b={x:b.x-m.x,y:b.y-m.y,w:b.w,h:b.h};Q.fire("updateRect",{rect:b});ja(b)}function D(a){function c(a,
h){0>h.h&&(h.h=0);0>h.w&&(h.w=0);b("#"+q+"-"+a,f).css({left:h.x,top:h.y,width:h.w,height:h.h})}d.each(z,function(c){b("#"+q+"-"+c.name,f).css({left:a.w*c.xMul+a.x,top:a.h*c.yMul+a.y})});c("top",{x:p.x,y:p.y,w:p.w,h:a.y-p.y});c("right",{x:a.x+a.w,y:a.y,w:p.w-a.x-a.w+p.x,h:a.h});c("bottom",{x:p.x,y:a.y+a.h,w:p.w,h:p.h-a.y-a.h+p.y});c("left",{x:p.x,y:a.y,w:a.x-p.x,h:a.h});c("move",a)}function r(b){a=b;D(a)}function ja(a){r({x:a.x+m.x,y:a.y+m.y,w:a.w,h:a.h})}var Q,z,C,u,q="mce-crid-"+g++;z=[{name:"move",
xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];u=["top","right","bottom","left"];(function(){b('<div id="'+
q+'" class="mce-croprect-container" role="grid" aria-dropeffect="execute">').appendTo(f);d.each(u,function(a){b("#"+q,f).append('<div id="'+q+"-"+a+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});d.each(z,function(a){b("#"+q,f).append('<div id="'+q+"-"+a.name+'" class="mce-croprect-handle mce-croprect-handle-'+a.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+a.label+'" aria-grabbed="false">')});C=d.map(z,function(b){var c;
return new e(q,{document:f.ownerDocument,handle:q+"-"+b.name,start:function(){c=a},drag:function(a){n(b,c,a.deltaX,a.deltaY)}})});D(a);b(f).on("focusin focusout",function(a){b(a.target).attr("aria-grabbed","focus"===a.type)});b(f).on("keydown",function(b){function c(a,b,h,d,e){a.stopPropagation();a.preventDefault();n(f,h,d,e)}var f;d.each(z,function(a){if(b.target.id==q+"-"+a.name)return f=a,!1});switch(b.keyCode){case k.LEFT:c(b,f,a,-10,0);break;case k.RIGHT:c(b,f,a,10,0);break;case k.UP:c(b,f,a,
0,-10);break;case k.DOWN:c(b,f,a,0,10);break;case k.ENTER:case k.SPACEBAR:b.preventDefault(),h()}})})(f);return Q=d.extend({toggleVisibility:function(a){var c;c=d.map(z,function(a){return"#"+q+"-"+a.name}).concat(d.map(u,function(a){return"#"+q+"-"+a})).join(",");a?b(c,f).show():b(c,f).hide()},setClampRect:function(b){m=b;D(a)},setRect:r,getInnerRect:function(){return{x:a.x-m.x,y:a.y-m.y,w:a.w,h:a.h}},setInnerRect:ja,setViewPortRect:function(b){p=b;D(a)},destroy:function(){d.each(C,function(a){a.destroy()});
C=[]}},l)}});n("tinymce/imagetoolsplugin/ImagePanel","global!tinymce.ui.Control global!tinymce.ui.DragHelper global!tinymce.geom.Rect global!tinymce.util.Tools global!tinymce.util.Promise tinymce/imagetoolsplugin/CropRect".split(" "),function(b,e,c,d,l,k){function g(a){return new l(function(b){function c(){a.removeEventListener("load",c);b(a)}a.complete?b(a):a.addEventListener("load",c)})}return b.extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",
a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(a){var b=this,d=new Image;d.src=a;g(d).then(function(){var a,h=b.state.get("viewRect");a=b.$el.find("img");a[0]?a.replaceWith(d):(a=document.createElement("div"),a.className="mce-imagepanel-bg",b.getEl().appendChild(a),b.getEl().appendChild(d));a={x:0,y:0,w:d.naturalWidth,h:d.naturalHeight};b.state.set("viewRect",
a);b.state.set("rect",c.inflate(a,-20,-20));h&&h.w==a.w&&h.h==a.h||b.zoomFit();b.repaintImage();b.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var a,b,c;a=this.$el.find("img");b=this.getEl().clientWidth;c=this.getEl().clientHeight;a=Math.min((b-10)/a[0].naturalWidth,(c-10)/a[0].naturalHeight);1<=a&&(a=1);this.zoom(a)},repaintImage:function(){var a,
b,c,d,h,e,g,k,l,n;a=this.getEl();l=this.zoom();n=this.state.get("rect");g=this.$el.find("img");k=this.$el.find(".mce-imagepanel-bg");h=a.offsetWidth;e=a.offsetHeight;c=g[0].naturalWidth*l;d=g[0].naturalHeight*l;a=Math.max(0,h/2-c/2);b=Math.max(0,e/2-d/2);g.css({left:a,top:b,width:c,height:d});k.css({left:a,top:b,width:c,height:d});this.cropRect&&(this.cropRect.setRect({x:n.x*l+a,y:n.y*l+b,w:n.w*l,h:n.h*l}),this.cropRect.setClampRect({x:a,y:b,w:c,h:d}),this.cropRect.setViewPortRect({x:0,y:0,w:h,h:e}))},
bindStates:function(){function a(a){b.cropRect=new k(a,b.state.get("viewRect"),b.state.get("viewRect"),b.getEl(),function(){b.fire("crop")});b.cropRect.on("updateRect",function(a){a=a.rect;var c=b.zoom();a={x:Math.round(a.x/c),y:Math.round(a.y/c),w:Math.round(a.w/c),h:Math.round(a.h/c)};b.state.set("rect",a)});b.on("remove",b.cropRect.destroy)}var b=this;b.state.on("change:cropEnabled",function(a){b.cropRect.toggleVisibility(a.value);b.repaintImage()});b.state.on("change:zoom",function(){b.repaintImage()});
b.state.on("change:rect",function(c){c=c.value;b.cropRect||a(c);b.cropRect.setRect(c)})}})});n("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function b(){return-1!=c&&c<e.length-1}var e=[],c=-1;return{data:e,add:function(b){var l;l=e.splice(++c);e.push(b);return{state:b,removed:l}},undo:function(){if(0<c)return e[--c]},redo:function(){if(b())return e[++c]},canUndo:function(){return 0<c},canRedo:b}}});n("tinymce/imagetoolsplugin/Dialog","global!tinymce.dom.DOMUtils global!tinymce.util.Tools global!tinymce.util.Promise global!tinymce.ui.Factory global!tinymce.ui.Form global!tinymce.ui.Container tinymce/imagetoolsplugin/ImagePanel ephox/imagetools/api/ImageTransformations ephox/imagetools/api/BlobConversions tinymce/imagetoolsplugin/UndoStack".split(" "),
function(b,e,c,d,l,k,g,a,p,m){function f(a){return{blob:a,url:URL.createObjectURL(a)}}function h(a){a&&URL.revokeObjectURL(a.url)}function n(c,p,r){function H(a){var b,c,d,h;b=s.find("#w")[0];c=s.find("#h")[0];d=parseInt(b.value(),10);h=parseInt(c.value(),10);s.find("#constrain")[0].checked()&&J&&K&&d&&h&&("w"==a.control.settings.name?(h=Math.round(d*X),c.value(h)):(d=Math.round(h*Y),b.value(d)));J=d;K=h}function z(a){return Math.round(100*a)+"%"}function C(){s.find("#undo").disabled(!w.canUndo());
s.find("#redo").disabled(!w.canRedo());s.statusbar.find("#save").disabled(!w.canUndo())}function u(){s.find("#undo").disabled(!0);s.find("#redo").disabled(!0)}function q(a){a&&y.imageSrc(a.url)}function t(a){return function(){var b=e.grep(Z,function(b){return b.settings.name!=a});e.each(b,function(a){a.hide()});a.show();a.focus()}}function L(a){x=f(a);q(x)}function I(a){c=f(a);q(c);a=w.add(c).removed;e.each(a,h);C()}function M(){var b=y.selection();a.crop(c.blob,b.x,b.y,b.w,b.h).then(function(a){I(a);
A()})}function N(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[(x||c).blob].concat(b)).then(L)}}function O(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[c.blob].concat(b)).then(I)}}function A(){q(c);h(x);t(R)();C()}function P(){x&&(I(x.blob),A())}function B(a){return new l({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},
items:a})}function E(a,b){return B([{text:"Back",onclick:A},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:P}]).hide().on("show",function(){u();b(c.blob).then(function(a){a=f(a);q(a);h(x);x=a})})}function v(a,b,d,e,g){function k(a){b(c.blob,a).then(function(a){a=f(a);q(a);h(x);x=a})}return B([{text:"Back",onclick:A},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){k(a.value)},minValue:e,maxValue:g,value:d,previewFilter:z},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",
onclick:P}]).hide().on("show",function(){this.find("slider").value(d);u()})}var s,w=new m,R,V,x,S,T,U,y,W,F,$,aa,ba,ca,G,da,ea,fa,ga,ha,ia,Z,J,K,X,Y;S=B([{text:"Back",onclick:A},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:M}]).hide().on("show hide",function(a){y.toggleCropRect("show"==a.type)}).on("show",u);T=B([{text:"Back",onclick:A},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:H},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:H},{type:"checkbox",
name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(a){!0===a.control.value()&&(X=K/J,Y=J/K)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(b){var c=parseInt(s.find("#w").value(),10),d=parseInt(s.find("#h").value(),10);b.preventDefault();O(a.resize,c,d)();A()}).on("show",u);U=B([{text:"Back",onclick:A},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:N(a.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",
onclick:N(a.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:N(a.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:N(a.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:P}]).hide().on("show",u);F=E("Invert",a.invert);fa=E("Sharpen",a.sharpen);ga=E("Emboss",a.emboss);$=v("Brightness",a.brightness,0,-1,1);aa=v("Hue",a.hue,180,0,360);ba=v("Saturate",a.saturate,0,-1,1);ca=v("Contrast",a.contrast,0,-1,1);G=v("Grayscale",a.grayscale,0,0,
1);da=v("Sepia",a.sepia,0,0,1);ea=function(a,b){function d(){var a,e,g;a=s.find("#r")[0].value();e=s.find("#g")[0].value();g=s.find("#b")[0].value();b(c.blob,a,e,g).then(function(a){a=f(a);q(a);h(x);x=a})}return B([{text:"Back",onclick:A},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:d,previewFilter:z},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:d,previewFilter:z},{type:"slider",label:"B",name:"b",minValue:0,value:1,
maxValue:2,ondragend:d,previewFilter:z},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:P}]).hide().on("show",function(){s.find("#r,#g,#b").value(1);u()})}("Colorize",a.colorize);ha=v("Gamma",a.gamma,0,-1,1);ia=v("Exposure",a.exposure,1,0,2);V=B([{text:"Back",onclick:A},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:t(aa)},{text:"saturate",icon:"saturate",onclick:t(ba)},{text:"sepia",icon:"sepia",onclick:t(da)},{text:"emboss",icon:"emboss",onclick:t(ga)},{text:"exposure",icon:"exposure",
onclick:t(ia)},{type:"spacer",flex:1}]).hide();R=B([{tooltip:"Crop",icon:"crop",onclick:t(S)},{tooltip:"Resize",icon:"resize2",onclick:t(T)},{tooltip:"Orientation",icon:"orientation",onclick:t(U)},{tooltip:"Brightness",icon:"sun",onclick:t($)},{tooltip:"Sharpen",icon:"sharpen",onclick:t(fa)},{tooltip:"Contrast",icon:"contrast",onclick:t(ca)},{tooltip:"Color levels",icon:"drop",onclick:t(ea)},{tooltip:"Gamma",icon:"gamma",onclick:t(ha)},{tooltip:"Invert",icon:"invert",onclick:t(F)}]);y=new g({flex:1,
imageSrc:c.url});W=new k({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){c=w.undo();q(c);C()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){c=w.redo();q(c);C()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=y.zoom();2>a&&(a+=0.1);y.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=y.zoom();0.1<a&&(a-=0.1);y.zoom(a)}}]});
W=new k({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[W,y]});Z=[R,S,T,U,V,F,$,aa,ba,ca,G,da,ea,fa,ga,ha,ia];s=d.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(b.DOM.getViewPort().w,800),minHeight:Math.min(b.DOM.getViewPort().h,650),title:"Edit image",items:Z.concat([W]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){p(c.blob);s.close()}},{text:"Cancel",onclick:"close"}]});s.renderTo(document.body).reflow();
s.on("close",function(){r();e.each(w.data,h);x=w=null});w.add(c);C();y.on("load",function(){J=y.imageSize().w;K=y.imageSize().h;X=K/J;Y=J/K;s.find("#w").value(J);s.find("#h").value(K)});y.on("crop",M)}return{edit:function(a){return new c(function(b,c){n(f(a),b,c)})}}});n("tinymce/imagetoolsplugin/ImageSize",[],function(){return{getImageSize:function(b){var e,c;e=b.style.width;c=b.style.height;if(e||c)return/^[0-9\.]+px$/.test(e)&&/^[0-9\.]+px$/.test(c)?{w:parseInt(e,10),h:parseInt(c,10)}:null;e=b.width;
c=b.height;return e&&c?{w:parseInt(e,10),h:parseInt(c,10)}:null},setImageSize:function(b,e){var c,d;if(e){c=b.style.width;d=b.style.height;if(c||d)b.style.width=e.w+"px",b.style.height=e.h+"px",b.removeAttribute("data-mce-style");c=b.width;d=b.height;if(c||d)b.setAttribute("width",e.w),b.setAttribute("height",e.h)}},getNaturalImageSize:function(b){return{w:b.naturalWidth,h:b.naturalHeight}}}});n("tinymce/imagetoolsplugin/Utils",["global!tinymce.util.Promise","global!tinymce.util.Tools"],function(b,
e){return{traverse:function(b,d){var e;e=d.reduce(function(b,c){return null!==b&&void 0!==b?b[c]:void 0},b);return null!==e&&void 0!==e?e:null},readBlob:function(c){return new b(function(b){var e=new FileReader;e.onload=function(c){b(c.target.result)};e.readAsText(c)})},requestUrlAsBlob:function(c,d){return new b(function(b){var k;k=new XMLHttpRequest;k.onreadystatechange=function(){4===k.readyState&&b({status:k.status,blob:this.response})};k.open("GET",c,!0);e.each(d,function(b,a){k.setRequestHeader(a,
b)});k.responseType="blob";k.send()})},parseJson:function(b){var d;try{d=JSON.parse(b)}catch(e){}return d}}});n("tinymce/imagetoolsplugin/Proxy",["global!tinymce.util.Promise","global!tinymce.util.Tools","tinymce/imagetoolsplugin/Utils"],function(b,e,c){function d(a){return c.requestUrlAsBlob(a,{}).then(function(a){return 400<=a.status?b.reject("ImageProxy HTTP error: "+a.status):b.resolve(a.blob)})}var l=function(a){b.reject("ImageProxy Service error: "+a)},k=function(a,b){return c.readBlob(b).then(function(a){a=
c.parseJson(a);return(a=c.traverse(a,["error","type"]))?l(a):l("Invalid JSON")})},g=function(a,d){return c.requestUrlAsBlob(a,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":d}).then(function(a){return 400<=a.status?400===a.status||403===a.status||500===a.status?k(a.status,a.blob):b.reject("ImageProxy HTTP error: "+a.status):b.resolve(a.blob)})};return{getUrl:function(a,b){return b?g(a,b):d(a)}}});n("tinymce/imagetoolsplugin/Plugin","global!tinymce.PluginManager global!tinymce.Env global!tinymce.util.Promise global!tinymce.util.URI global!tinymce.util.Tools global!tinymce.util.Delay ephox/imagetools/api/ImageTransformations ephox/imagetools/api/BlobConversions tinymce/imagetoolsplugin/Dialog tinymce/imagetoolsplugin/ImageSize tinymce/imagetoolsplugin/Proxy".split(" "),
function(b,e,c,d,l,k,g,a,p,m,f){b.add("imagetools",function(b){function n(a){b.notificationManager.open({text:a,type:"error"})}function r(){return b.selection.getNode()}function F(a){return(a=a.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?b.dom.encode(a[1]):null}function G(a){a=a.src;return 0===a.indexOf("data:")||0===a.indexOf("blob:")||(new d(a)).host===b.documentBaseURI.host}function Q(a){return-1!==l.inArray(b.settings.imagetools_cors_hosts,(new d(a.src)).host)}function z(c){var d=c.src;
return Q(c)?f.getUrl(c.src,null):G(c)?a.imageToBlob(c):(d=b.settings.imagetools_proxy,d+=(-1===d.indexOf("?")?"?":"&")+"url="+encodeURIComponent(c.src),c=b.settings.api_key||b.settings.imagetools_api_key,f.getUrl(d,c))}function C(){var a;return(a=b.editorUpload.blobCache.getByUri(r().src))?a.blob():z(r())}function u(){B=k.setEditorTimeout(b,function(){b.editorUpload.uploadImagesAuto()},b.settings.images_upload_timeout||3E4)}function q(c,e){return a.blobToDataUri(c).then(function(a){var f,g,k,l,m;
m=r();k=b.editorUpload.blobCache;l=k.getByUri(m.src);g=d.parseDataUri(a).data;a="imagetools"+P++;b.settings.images_reuse_filename&&(f=l?l.filename():F(m.src));l=k.create(a,c,g,f);k.add(l);b.undoManager.transact(function(){function a(){b.$(m).off("load",a);b.nodeChanged();e?b.editorUpload.uploadImagesAuto():(clearTimeout(B),u())}b.$(m).on("load",a);b.$(m).attr({src:l.blobUri()}).removeAttr("data-mce-src")});return l})}function t(a){return function(){return b._scanForImages().then(C).then(a).then(q,
n)}}function L(a){return function(){return t(function(b){var c=m.getImageSize(r());c&&m.setImageSize(r(),{w:c.h,h:c.w});return g.rotate(b,a)})()}}function I(a){return function(){return t(function(b){return g.flip(b,a)})()}}function M(){var b=r(),d=m.getNaturalImageSize(b),e=function(e){return new c(function(c){a.blobToImage(e).then(function(a){var f=m.getNaturalImageSize(a);(d.w!=f.w||d.h!=f.h)&&m.getImageSize(b)&&m.setImageSize(b,f);URL.revokeObjectURL(a.src);c(e)})})},f=function(a){return p.edit(a).then(e).then(function(a){q(a,
!0)},function(){})};b&&z(b).then(f,n)}function N(){b.on("NodeChange",function(a){E&&E.src!=a.element.src&&(clearTimeout(B),b.editorUpload.uploadImagesAuto(),E=void 0);O(a.element)&&(E=a.element)})}function O(a){return b.dom.is(a,"img:not([data-mce-object],[data-mce-placeholder])")&&(G(a)||Q(a)||b.settings.imagetools_proxy)}function A(){var a=b.settings.imagetools_toolbar;a||(a="rotateleft rotateright | flipv fliph | crop editimage imageoptions");b.addContextToolbar(O,a)}var P=0,B,E;e.fileApi&&(l.each({mceImageRotateLeft:L(-90),
mceImageRotateRight:L(90),mceImageFlipVertical:I("v"),mceImageFlipHorizontal:I("h"),mceEditImage:M},function(a,c){b.addCommand(c,a)}),b.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),b.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),b.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),b.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),b.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),
b.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),A(),N())});return function(){}});G("tinymce/imagetoolsplugin/Plugin")()})();
