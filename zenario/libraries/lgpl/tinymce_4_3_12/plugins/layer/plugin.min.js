tinymce.PluginManager.add("layer",function(b){function h(a){do if(a.className&&-1!=a.className.indexOf("mceItemLayer"))return a;while(a=a.parentNode)}function k(a){var c,d=[],k=h(b.selection.getNode()),e=-1,g=-1,f;f=[];tinymce.walk(b.getBody(),function(a){1==a.nodeType&&/^(absolute|relative|static)$/i.test(a.style.position)&&f.push(a)},"childNodes");for(c=0;c<f.length;c++)d[c]=f[c].style.zIndex?parseInt(f[c].style.zIndex,10):0,0>e&&f[c]==k&&(e=c);if(0>a){for(c=0;c<d.length;c++)if(d[c]<d[e]){g=c;break}-1<
g?(f[e].style.zIndex=d[g],f[g].style.zIndex=d[e]):0<d[e]&&(f[e].style.zIndex=d[e]-1)}else{for(c=0;c<d.length;c++)if(d[c]>d[e]){g=c;break}-1<g?(f[e].style.zIndex=d[g],f[g].style.zIndex=d[e]):f[e].style.zIndex=d[e]+1}b.execCommand("mceRepaint")}b.addCommand("mceInsertLayer",function(){var a=b.dom,c=a.getPos(a.getParent(b.selection.getNode(),"*")),d=b.getBody();b.dom.add(d,"div",{style:{position:"absolute",left:c.x,top:20<c.y?c.y:20,width:100,height:100},"class":"mceItemVisualAid mceItemLayer"},b.selection.getContent()||
b.getLang("layer.content"));tinymce.Env.ie&&a.setHTML(d,d.innerHTML)});b.addCommand("mceMoveForward",function(){k(1)});b.addCommand("mceMoveBackward",function(){k(-1)});b.addCommand("mceMakeAbsolute",function(){var a=h(b.selection.getNode());a||(a=b.dom.getParent(b.selection.getNode(),"DIV,P,IMG"));a&&("absolute"==a.style.position.toLowerCase()?(b.dom.setStyles(a,{position:"",left:"",top:"",width:"",height:""}),b.dom.removeClass(a,"mceItemVisualAid"),b.dom.removeClass(a,"mceItemLayer")):(a.style.left||
(a.style.left="20px"),a.style.top||(a.style.top="20px"),a.style.width||(a.style.width=a.width?a.width+"px":"100px"),a.style.height||(a.style.height=a.height?a.height+"px":"100px"),a.style.position="absolute",b.dom.setAttrib(a,"data-mce-style",""),b.addVisual(b.getBody())),b.execCommand("mceRepaint"),b.nodeChanged())});b.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"});b.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"});b.addButton("absolute",{title:"layer.absolute_desc",
cmd:"mceMakeAbsolute"});b.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"});b.on("init",function(){tinymce.Env.ie&&b.getDoc().execCommand("2D-Position",!1,!0)});b.on("mouseup",function(a){(a=h(a.target))&&b.dom.setAttrib(a,"data-mce-style","")});b.on("mousedown",function(a){a=a.target;var c=b.getDoc();tinymce.Env.gecko&&(h(a)?"on"!==c.designMode&&(c.designMode="on",a=c.body,c=a.parentNode,c.removeChild(a),c.appendChild(a)):"on"==c.designMode&&(c.designMode="off"))});b.on("NodeChange",
function(a){var c=b.dom;tinymce.each(c.select("div,p",a),function(a){/^(absolute|relative|fixed)$/i.test(a.style.position)&&(a.hasVisual?c.addClass(a,"mceItemVisualAid"):c.removeClass(a,"mceItemVisualAid"),c.addClass(a,"mceItemLayer"))})})});
