(function(A,I){function K(g,m){for(var c,l=[],b=0;b<g.length;++b){if(!(c=B[g[b]]))a:{c=A;for(var a=g[b].split(/[.\/]/),r=0;r<a.length;++r){if(!c[a[r]]){c=void 0;break a}c=c[a[r]]}}if(!c)throw"module definition dependecy not found: "+g[b];l.push(c)}m.apply(null,l)}function C(g,m,c){if("string"!==typeof g)throw"invalid module definition, module id must be defined and be a string";if(m===I)throw"invalid module definition, dependencies must be specified";if(c===I)throw"invalid module definition, definition function must be specified";
K(m,function(){B[g]=c.apply(null,arguments)})}var B={};C("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(g,m,c){function l(b,a){g.each(a,function(a){b=a.constructor==RegExp?b.replace(a,""):b.replace(a[0],a[1])});return b}return{filter:l,innerText:function(b){function a(b){var c=b.name,g=b;if("br"===c)d+="\n";else if(s[c]&&(d+=" "),h[c])d+=" ";else{3==b.type&&(d+=b.value);if(!b.shortEnded&&(b=b.firstChild)){do a(b);while(b=b.next)}x[c]&&g.next&&
(d+="\n","p"==c&&(d+="\n"))}}var r=new c,p=new m({},r),d="",s=r.getShortEndedElements(),h=g.makeMap("script noscript style textarea video audio iframe object"," "),x=r.getBlockElements();b=l(b,[/<!\[[^\]]+\]>/g]);a(p.parse(b));return d},trimHtml:function(b){return b=l(b,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/\x3c!--StartFragment--\x3e|\x3c!--EndFragment--\x3e/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,function(a,b,c){return b||c?"\u00a0":" "}],/<br class="Apple-interchange-newline">/g,
/<br>$/i])},createIdGenerator:function(b){var a=0;return function(){return b+a++}}}});C("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils","tinymce/util/Delay"],function(g,m,c,l,b){return function(a){function r(f){var k,n=a.dom;k=a.fire("BeforePastePreProcess",{content:f});k=a.fire("PastePreProcess",k);f=k.content;k.isDefaultPrevented()||(a.hasEventListeners("PastePostProcess")&&!k.isDefaultPrevented()&&(f=n.add(a.getBody(),"div",
{style:"display:none"},f),k=a.fire("PastePostProcess",{node:f}),n.remove(f),f=k.node.innerHTML),k.isDefaultPrevented()||a.insertContent(f,{merge:!1!==a.settings.paste_merge_formats,data:{paste:!0}}))}function p(f){f=a.dom.encode(f).replace(/\r\n/g,"\n");var k=a.dom.getParent(a.selection.getStart(),a.dom.isBlock),n=a.settings.forced_root_block,e;n&&(e=a.dom.createHTML(n,a.settings.forced_root_block_attrs),e=e.substr(0,e.length-3)+">");k&&/^(PRE|DIV)$/.test(k.nodeName)||!n?f=l.filter(f,[[/\n/g,"<br>"]]):
(f=l.filter(f,[[/\n\n/g,"</p>"+e],[/^(.*<\/p>)(<p>)$/,e+"$1"],[/\n/g,"<br />"]]),-1!=f.indexOf("<p>")&&(f=e+f));r(f)}function d(){function f(a){var f,e;e=a.startContainer;f=a.getClientRects();if(f.length)return f[0];if(a.collapsed&&1==e.nodeType){for(a=e.childNodes[q.startOffset];a&&3==a.nodeType&&!a.data.length;)a=a.nextSibling;if(a&&("BR"==a.tagName&&(e=k.doc.createTextNode("\ufeff"),a.parentNode.insertBefore(e,a),a=k.createRng(),a.setStartBefore(e),a.setEndAfter(e),f=a.getClientRects(),k.remove(e)),
f.length))return f[0]}}var k=a.dom,n=a.getBody(),e=a.dom.getViewPort(a.getWin()).y,b=20,z;q=a.selection.getRng();a.inline&&(z=a.selection.getScrollContainer())&&0<z.scrollTop&&(e=z.scrollTop);if(q.getClientRects)if(b=f(q))b=e+(b.top-k.getPos(n).y);else if(b=e,e=q.startContainer)3==e.nodeType&&e.parentNode!=n&&(e=e.parentNode),1==e.nodeType&&(b=k.getPos(e,z||n).y);t=k.add(a.getBody(),"div",{id:"mcepastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: absolute; top: "+b+"px;width: 10px; height: 10px; overflow: hidden; opacity: 0"},
H);(g.ie||g.gecko)&&k.setStyle(t,"left","rtl"==k.getStyle(n,"direction",!0)?65535:-65535);k.bind(t,"beforedeactivate focusin focusout",function(a){a.stopPropagation()});t.focus();a.selection.select(t,!0)}function s(){if(t){for(var f;f=a.dom.get("mcepastebin");)a.dom.remove(f),a.dom.unbind(f);q&&a.selection.setRng(q)}t=q=null}function h(){var f="",k,b,e;k=a.dom.select("div[id=mcepastebin]");for(b=0;b<k.length;b++)e=k[b],e.firstChild&&"mcepastebin"==e.firstChild.id&&(e=e.firstChild),e=e.innerHTML,f!=
H&&(f+=e);return f}function x(a){var k={};if(a){if(a.getData){var b=a.getData("Text");b&&0<b.length&&-1==b.indexOf(L)&&(k["text/plain"]=b)}if(a.types)for(b=0;b<a.types.length;b++){var e=a.types[b];k[e]=a.getData(e)}}return k}function F(a){return y(a,"text/html")||y(a,"text/plain")}function G(b,k){function q(a){var b;b=a.indexOf(",");return-1!==b?a.substr(b+1):null}function e(e){function d(b,e){k&&(a.selection.setRng(k),k=null);var f=a.editorUpload.blobCache,c=f.create(M(),e,q(b.result));f.add(c);
r('<img src="'+c.blobUri()+'">')}var s,c,u=!1;if(e)for(s=0;s<e.length;s++)c=e[s],/^image\/(jpeg|png|gif|bmp)$/.test(c.type)&&(u=c.getAsFile?c.getAsFile():c,c=new FileReader,c.onload=d.bind(null,c,u),c.readAsDataURL(u),b.preventDefault(),u=!0);return u}var d=b.clipboardData||b.dataTransfer;if(a.settings.paste_data_images&&d)return e(d.items)||e(d.files)}function v(a){a=a.clipboardData;return-1!=navigator.userAgent.indexOf("Android")&&a&&a.items&&0===a.items.length}function y(a,b){return b in a&&0<
a[b].length}function D(){function f(b,c,e){var f;y(b,"text/html")?f=b["text/html"]:(f=h(),f==H&&(e=!0));f=l.trimHtml(f);t&&t.firstChild&&"mcepastebin"===t.firstChild.id&&(e=!0);s();f.length||(e=!0);e&&(f=y(b,"text/plain")&&-1==f.indexOf("</p>")?b["text/plain"]:l.innerText(f));f==H?c||a.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents."):e?p(f):r(f)}a.on("keydown",function(b){function f(a){(c.metaKeyPressed(a)&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&!a.isDefaultPrevented()&&
s()}(c.metaKeyPressed(b)&&86==b.keyCode||b.shiftKey&&45==b.keyCode)&&!b.isDefaultPrevented()&&(E=b.shiftKey&&86==b.keyCode,E&&g.webkit&&-1!=navigator.userAgent.indexOf("Version/")||(b.stopImmediatePropagation(),J=(new Date).getTime(),g.ie&&E?(b.preventDefault(),a.fire("paste",{ieFake:!0})):(s(),d(),a.once("keyup",f),a.once("paste",function(){a.off("keyup",f)}))))});a.on("paste",function(k){var c=(new Date).getTime(),e=x(k.clipboardData||a.getDoc().dataTransfer),c=(new Date).getTime()-c,u=1E3>(new Date).getTime()-
J-c,z="text"==w.pasteFormat||E;E=!1;k.isDefaultPrevented()||v(k)?s():!F(e)&&G(k,q||a.selection.getRng())?s():(u||k.preventDefault(),!g.ie||u&&!k.ieFake||(d(),a.dom.bind(t,"paste",function(a){a.stopPropagation()}),a.getDoc().execCommand("Paste",!1,null),e["text/html"]=h()),y(e,"text/html")?(k.preventDefault(),f(e,u,z)):b.setEditorTimeout(a,function(){f(e,u,z)},0))});a.on("dragstart dragend",function(a){u="dragstart"==a.type});a.on("drop",function(f){var c,e;e=m.getCaretRangeFromPoint(f.clientX,f.clientY,
a.getDoc());if(!f.isDefaultPrevented()&&!u&&(c=x(f.dataTransfer),(F(c)&&0!==c["text/plain"].indexOf("file://")||!G(f,e))&&e&&!1!==a.settings.paste_filter_drop)){var q=c["mce-internal"]||c["text/html"]||c["text/plain"];q&&(f.preventDefault(),b.setEditorTimeout(a,function(){a.undoManager.transact(function(){c["mce-internal"]&&a.execCommand("Delete");a.selection.setRng(e);q=l.trimHtml(q);c["text/html"]?r(q):p(q)})}))}});a.on("dragover dragend",function(b){a.settings.paste_data_images&&b.preventDefault()})}
var w=this,t,q,J=0,u=!1,H="%MCEPASTEBIN%",E,L="data:text/mce-internal,",M=l.createIdGenerator("mceclip");w.pasteHtml=r;w.pasteText=p;a.on("preInit",function(){D();a.parser.addNodeFilter("img",function(b,c,q){function e(a){a.attr("data-mce-object")||d===g.transparentSrc||a.remove()}if(!a.settings.paste_data_images&&q.data&&!0===q.data.paste)for(c=b.length;c--;){var d=b[c].attributes.map.src;d&&(0===d.indexOf("webkit-fake-url")?e(b[c]):a.settings.allow_html_data_urls||0!==d.indexOf("data:")||e(b[c]))}})})}});
C("tinymce/pasteplugin/WordFilter","tinymce/util/Tools tinymce/html/DomParser tinymce/html/Schema tinymce/html/Serializer tinymce/html/Node tinymce/pasteplugin/Utils".split(" "),function(g,m,c,l,b,a){function r(a){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)||/class="OutlineElement/.test(a)||/id="?docs\-internal\-guid\-/.test(a)}function p(a){var b;a=a.replace(/^[\u00a0 ]+/,"");g.each([/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,
/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/],function(c){if(c.test(a))return b=!0,!1});return b}function d(d){var h=d.settings;d.on("BeforePastePreProcess",function(x){function F(a){function c(a){var b="";if(3===a.type)return a.value;if(a=a.firstChild){do b+=c(a);while(a=a.next)}return b}function d(a,b){if(3===
a.type&&b.test(a.value))return a.value=a.value.replace(b,""),!1;if(a=a.firstChild){do if(!d(a,b))return!1;while(a=a.next)}return!0}function s(a){if(a._listIgnore)a.remove();else if(a=a.firstChild){do s(a);while(a=a.next)}}function g(a,c,e){var q=a._listLevel||f;q!=f&&(q<f?h&&(h=h.parent.parent):(l=h,h=null));h&&h.name==c?h.append(a):(l=l||h,h=new b(c,1),1<e&&h.attr("start",""+e),a.wrap(h));a.name="li";q>f&&l&&l.lastChild.append(h);f=q;s(a);d(a,/^\u00a0+/);d(a,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);
d(a,/^\u00a0+/)}for(var h,l,f=1,k=[],n=a.firstChild;"undefined"!==typeof n&&null!==n;)if(k.push(n),n=n.walk(),null!==n)for(;"undefined"!==typeof n&&n.parent!==a;)n=n.walk();for(n=0;n<k.length;n++)if(a=k[n],"p"==a.name&&a.firstChild){var e=c(a);if(/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(e))g(a,"ul");else if(p(e)){var e=/([0-9]+)\./.exec(e),m=1;e&&(m=parseInt(e[1],10));g(a,"ol",m)}else a._listLevel?g(a,"ul",1):h=null}else l=h,h=null}function G(a,c){var h={},l,m=d.dom.parseStyle(c);g.each(m,
function(b,d){switch(d){case "mso-list":if(l=/\w+ \w+([0-9]+)/i.exec(c))a._listLevel=parseInt(l[1],10);/Ignore/i.test(b)&&a.firstChild&&(a._listIgnore=!0,a.firstChild._listIgnore=!0);break;case "horiz-align":d="text-align";break;case "vert-align":d="vertical-align";break;case "font-color":case "mso-foreground":d="color";break;case "mso-background":case "mso-highlight":d="background";break;case "font-weight":case "font-style":"normal"!=b&&(h[d]=b);return;case "mso-element":if(/^(comment|comment-list)$/i.test(b)){a.remove();
return}}0===d.indexOf("mso-comment")?a.remove():0!==d.indexOf("mso-")&&("all"==y||D&&D[d])&&(h[d]=b)});/(bold)/i.test(h["font-weight"])&&(delete h["font-weight"],a.wrap(new b("b",1)));/(italic)/i.test(h["font-style"])&&(delete h["font-style"],a.wrap(new b("i",1)));return(h=d.dom.serializeStyle(h,a.name))?h:null}var v=x.content,y,D,v=v.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,""),v=v.replace(/<br class="?Apple-interchange-newline"?>/gi,"");(y=h.paste_retain_style_properties)&&(D=g.makeMap(y.split(/[, ]/)));
if(!1!==h.paste_enable_default_filters&&r(x.content)){x.wordContent=!0;var v=a.filter(v,[/\x3c!--[\s\S]+?--\x3e/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,b){return 0<b.length?b.replace(/./," ").slice(Math.floor(b.length/2)).split("").join("\u00a0"):""}]]),w=h.paste_word_valid_elements;w||
(w="-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody");w=new c({valid_elements:w,valid_children:"-li[p]"});g.each(w.elements,function(a){a.attributes["class"]||(a.attributes["class"]={},a.attributesOrder.push("class"));a.attributes.style||(a.attributes.style={},a.attributesOrder.push("style"))});var t=new m({},w);t.addAttributeFilter("style",function(a){for(var b=
a.length,c;b--;)c=a[b],c.attr("style",G(c,c.attr("style"))),"span"==c.name&&c.parent&&!c.attributes.length&&c.unwrap()});t.addAttributeFilter("class",function(a){for(var b=a.length,c,d;b--;)c=a[b],d=c.attr("class"),/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(d)&&c.remove(),c.attr("class",null)});t.addNodeFilter("del",function(a){for(var b=a.length;b--;)a[b].remove()});t.addNodeFilter("a",function(a){for(var b=a.length,c,d,h;b--;)c=a[b],d=c.attr("href"),h=c.attr("name"),d&&-1!=d.indexOf("#_msocom_")?
c.remove():(d&&0===d.indexOf("file://")&&(d=d.split("#")[1])&&(d="#"+d),d||h?h&&!/^_?(?:toc|edn|ftn)/i.test(h)?c.unwrap():c.attr({href:d,name:h}):c.unwrap())});v=t.parse(v);!1!==h.paste_convert_word_fake_lists&&F(v);x.content=(new l({validate:h.validate},w)).serialize(v)}})}d.isWordContent=r;return d});C("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(g,m,c,l){return function(b){function a(a){b.on("BeforePastePreProcess",
function(b){b.content=a(b.content)})}function r(a){if(!c.isWordContent(a))return a;var g=[];m.each(b.schema.getBlockElements(),function(a,b){g.push(b)});var h=RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+g.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g");a=l.filter(a,[[h,"$1"]]);return a=l.filter(a,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}function p(a){if(c.isWordContent(a))return a;var g=b.settings.paste_webkit_styles;if(!1===b.settings.paste_remove_styles_if_webkit||
"all"==g)return a;g&&(g=g.split(/[, ]/));if(g){var h=b.dom,l=b.selection.getNode();a=a.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(a,b,c,d){a=h.parseStyle(c,"span");c={};if("none"===g)return b+d;for(var m=0;m<g.length;m++){var r=a[g[m]],p=h.getStyle(l,g[m],!0);/color/.test(g[m])&&(r=h.toHex(r),p=h.toHex(p));p!=r&&(c[g[m]]=r)}return(c=h.serializeStyle(c,"span"))?b+' style="'+c+'"'+d:b+d})}else a=a.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3");return a=a.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,
function(a,b,c,d){return b+' style="'+c+'"'+d})}g.webkit&&a(p);g.ie&&a(r)}});C("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(g,m,c,l){var b;g.add("paste",function(a){function g(){if("text"==d.pasteFormat)this.active(!1),d.pasteFormat="html",a.fire("PastePlainTextToggle",{state:!1});else if(d.pasteFormat="text",this.active(!0),!b&&!1!==a.settings.paste_plaintext_inform){var c=a.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.");
a.notificationManager.open({text:c,type:"info"});b=!0;a.fire("PastePlainTextToggle",{state:!0})}a.focus()}var p=this,d,s=a.settings;p.clipboard=d=new m(a);p.quirks=new l(a);p.wordFilter=new c(a);a.settings.paste_as_text&&(p.clipboard.pasteFormat="text");if(s.paste_preprocess)a.on("PastePreProcess",function(a){s.paste_preprocess.call(p,p,a)});if(s.paste_postprocess)a.on("PastePostProcess",function(a){s.paste_postprocess.call(p,p,a)});a.addCommand("mceInsertClipboardContent",function(a,b){b.content&&
p.clipboard.pasteHtml(b.content);b.text&&p.clipboard.pasteText(b.text)});if(a.settings.paste_block_drop)a.on("dragend dragover draggesture dragdrop drop drag",function(a){a.preventDefault();a.stopPropagation()});if(!a.settings.paste_data_images)a.on("drop",function(a){var b=a.dataTransfer;b&&b.files&&0<b.files.length&&a.preventDefault()});a.addButton("pastetext",{icon:"pastetext",tooltip:"Paste as text",onclick:g,active:"text"==p.clipboard.pasteFormat});a.addMenuItem("pastetext",{text:"Paste as text",
selectable:!0,active:d.pasteFormat,onclick:g})})});(function(g){var m,c,l,b;for(m=0;m<g.length;m++){c=A;l=g[m];b=l.split(/[.\/]/);for(var a=0;a<b.length-1;++a)c[b[a]]===I&&(c[b[a]]={}),c=c[b[a]];c[b[b.length-1]]=B[l]}if(A.AMDLC_TESTS){c=A.privateModules||{};for(l in B)c[l]=B[l];for(m=0;m<g.length;m++)delete c[g[m]];A.privateModules=c}})(["tinymce/pasteplugin/Utils"])})(this);
