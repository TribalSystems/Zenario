tinymce.PluginManager.add("visualchars",function(b){function h(a){function n(a){return'<span data-mce-bogus="1" class="mce-'+f[a]+'">'+a+"</span>"}function h(){var a,b="";for(a in f)b&&(b+=","),b+="span.mce-"+f[a];return b}var c,d;c=b.getBody();var g=b.selection,l,m,f,k;f={"\u00a0":"nbsp","\u00ad":"shy"};e=!e;p.state=e;b.fire("VisualChars",{state:e});k=function(){var a,b="";for(a in f)b+=a;return RegExp("["+b+"]","g")}();a&&(m=g.getBookmark());if(e)for(d=[],tinymce.walk(c,function(a){3==a.nodeType&&
a.nodeValue&&k.test(a.nodeValue)&&d.push(a)},"childNodes"),a=0;a<d.length;a++){c=d[a].nodeValue;c=c.replace(k,n);for(l=b.dom.create("div",null,c);c=l.lastChild;)b.dom.insertAfter(c,d[a]);b.dom.remove(d[a])}else for(d=b.dom.select(h(),c),a=d.length-1;0<=a;a--)b.dom.remove(d[a],1);g.moveToBookmark(m)}function g(){var a=this;b.on("VisualChars",function(b){a.active(b.state)})}var p=this,e;b.addCommand("mceVisualChars",h);b.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",
onPostRender:g});b.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:g,selectable:!0,context:"view",prependToContext:!0});b.on("beforegetcontent",function(a){e&&"raw"!=a.format&&!a.draft&&(e=!0,h(!1))})});
