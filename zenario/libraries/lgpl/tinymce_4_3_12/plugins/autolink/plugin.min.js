tinymce.PluginManager.add("autolink",function(c){function f(e,d,c){function f(a,b){0>b&&(b=0);if(3==a.nodeType){var c=a.data.length;b>c&&(b=c)}return b}function g(a,c){1!=a.nodeType||a.hasChildNodes()?b.setStart(a,f(a,c)):b.setStartBefore(a)}function h(a,c){1!=a.nodeType||a.hasChildNodes()?b.setEnd(a,f(a,c)):b.setEndAfter(a)}var b,l,a,k;if("A"!=e.selection.getNode().tagName){b=e.selection.getRng(!0).cloneRange();if(5>b.startOffset){a=b.endContainer.previousSibling;if(!a){if(!b.endContainer.firstChild||
!b.endContainer.firstChild.nextSibling)return;a=b.endContainer.firstChild.nextSibling}d=a.length;g(a,d);h(a,d);if(5>b.endOffset)return;d=b.endOffset}else{a=b.endContainer;if(3!=a.nodeType&&a.firstChild){for(;3!=a.nodeType&&a.firstChild;)a=a.firstChild;3==a.nodeType&&(g(a,0),h(a,a.nodeValue.length))}d=1==b.endOffset?2:b.endOffset-1-d}l=d;do g(a,2<=d?d-2:0),h(a,1<=d?d-1:0),d-=1,k=b.toString();while(" "!=k&&""!==k&&160!=k.charCodeAt(0)&&0<=d-2&&k!=c);b.toString()==c||160==b.toString().charCodeAt(0)?
(g(a,d),h(a,l),d+=1):(0===b.startOffset?g(a,0):g(a,d),h(a,l));c=b.toString();"."==c.charAt(c.length-1)&&h(a,l-1);c=b.toString();if(a=c.match(m))"www."==a[1]?a[1]="http://www.":/@$/.test(a[1])&&!/^mailto:/.test(a[1])&&(a[1]="mailto:"+a[1]),c=e.selection.getBookmark(),e.selection.setRng(b),e.execCommand("createlink",!1,a[1]+a[2]),e.selection.moveToBookmark(c),e.nodeChanged()}}var n,m=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;c.settings.autolink_pattern&&(m=
c.settings.autolink_pattern);c.on("keydown",function(e){13==e.keyCode&&f(c,-1,"",!1)});if(tinymce.Env.ie)c.on("focus",function(){if(!n){n=!0;try{c.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}});else c.on("keypress",function(e){41==e.keyCode&&f(c,-1,"(",!0)}),c.on("keyup",function(e){32==e.keyCode&&f(c,0,"",!0)})});
