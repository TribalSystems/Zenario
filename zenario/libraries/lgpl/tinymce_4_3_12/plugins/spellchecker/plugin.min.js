(function(r,y){function M(e,d){for(var a,p=[],h=0;h<e.length;++h){if(!(a=s[e[h]]))a:{a=r;for(var q=e[h].split(/[.\/]/),z=0;z<q.length;++z){if(!a[q[z]]){a=void 0;break a}a=a[q[z]]}}if(!a)throw"module definition dependecy not found: "+e[h];p.push(a)}d.apply(null,p)}function G(e,d,a){if("string"!==typeof e)throw"invalid module definition, module id must be defined and be a string";if(d===y)throw"invalid module definition, dependencies must be specified";if(a===y)throw"invalid module definition, definition function must be specified";
M(d,function(){s[e]=a.apply(null,arguments)})}var s={};G("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){function e(d){return d&&1==d.nodeType&&"false"===d.contentEditable}return function(d,a){function p(b,k){if(!b[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:b.index,end:b.index+b[0].length,text:b[0],data:k}}function h(b){var k;if(3===b.nodeType)return b.data;if(v[b.nodeName]&&!t[b.nodeName])return"";if(e(b))return"\n";k="";if(t[b.nodeName]||D[b.nodeName])k+=
"\n";if(b=b.firstChild){do k+=h(b);while(b=b.nextSibling)}return k}function q(b,k,c){var a,u,A,f,d=[],n=0,g=b,l,h=0;k=k.slice(0);k.sort(function(b,H){return b.start-H.start});l=k.shift();a:for(;;){(t[g.nodeName]||D[g.nodeName]||e(g))&&n++;3===g.nodeType&&(!u&&g.length+n>=l.end?(u=g,f=l.end-n):a&&d.push(g),!a&&g.length+n>l.start&&(a=g,A=l.start-n),n+=g.length);if(a&&u){if(g=c({startNode:a,startNodeIndex:A,endNode:u,endNodeIndex:f,innerNodes:d,match:l.text,matchIndex:h}),n-=u.length-f,u=a=null,d=[],
l=k.shift(),h++,!l)break}else if((!v[g.nodeName]||t[g.nodeName])&&g.firstChild){if(!e(g)){g=g.firstChild;continue}}else if(g.nextSibling){g=g.nextSibling;continue}for(;;)if(g.nextSibling){g=g.nextSibling;break}else if(g.parentNode!==b)g=g.parentNode;else break a}}function z(b){function k(k,c){var a=m[c];a.stencil||(a.stencil=b(a));a=a.stencil.cloneNode(!1);a.setAttribute("data-mce-index",c);k&&a.appendChild(F.doc.createTextNode(k));return a}return function(b){var c,a,d,f=b.startNode,h=b.endNode,n=
b.matchIndex;a=F.doc;if(f===h)return d=f.parentNode,0<b.startNodeIndex&&(c=a.createTextNode(f.data.substring(0,b.startNodeIndex)),d.insertBefore(c,f)),c=k(b.match,n),d.insertBefore(c,f),b.endNodeIndex<f.length&&(a=a.createTextNode(f.data.substring(b.endNodeIndex)),d.insertBefore(a,f)),f.parentNode.removeChild(f),c;c=a.createTextNode(f.data.substring(0,b.startNodeIndex));a=a.createTextNode(h.data.substring(b.endNodeIndex));var g=k(f.data.substring(b.startNodeIndex),n);d=[];for(var l=0,e=b.innerNodes.length;l<
e;++l){var m=b.innerNodes[l],H=k(m.data,n);m.parentNode.replaceChild(H,m);d.push(H)}b=k(h.data.substring(0,b.endNodeIndex),n);d=f.parentNode;d.insertBefore(c,f);d.insertBefore(g,f);d.removeChild(f);d=h.parentNode;d.insertBefore(b,h);d.insertBefore(a,h);d.removeChild(h);return b}}function r(b){var a=d.getElementsByTagName("*"),c=[];b="number"==typeof b?""+b:null;for(var h=0;h<a.length;h++){var m=a[h],e=m.getAttribute("data-mce-index");null!==e&&e.length&&(e!==b&&null!==b||c.push(m))}return c}function c(b){for(var a=
m.length;a--;)if(m[a]===b)return a;return-1}function s(b){for(var a=0,c=m.length;a<c&&!1!==b(m[a],a);a++);return this}function w(b){var a=r(b?c(b):null);for(b=a.length;b--;){var d=a[b];d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}return this}function I(b){b=r(c(b));var d=a.dom.createRng();d.setStartBefore(b[0]);d.setEndAfter(b[b.length-1]);return d}var J,m=[],x,F=a.dom,t,v,D;t=a.schema.getBlockElements();v=a.schema.getWhiteSpaceElements();D=a.schema.getShortEndedElements();
x=h(d);return{text:x,matches:m,each:s,filter:function(b){var a=[];s(function(c,d){b(c,d)&&a.push(c)});m=a;return this},reset:function(){m.splice(0,m.length);w();return this},matchFromElement:function(b){return m[b.getAttribute("data-mce-index")]},elementFromMatch:function(b){return r(c(b))[0]},find:function(b,a){if(x&&b.global)for(;J=b.exec(x);)m.push(p(J,a));return this},add:function(b,a,c){m.push({start:b,end:b+a,text:x.substr(b,a),data:c});return this},wrap:function(a){m.length&&q(d,m,z(a));return this},
unwrap:w,replace:function(b,c){var d=I(b);d.deleteContents();0<c.length&&d.insertNode(a.dom.doc.createTextNode(c));return d},rangeFromMatch:I,indexOf:c}}});G("tinymce/spellcheckerplugin/Plugin","tinymce/spellcheckerplugin/DomTextMatcher tinymce/PluginManager tinymce/util/Tools tinymce/ui/Menu tinymce/dom/DOMUtils tinymce/util/XHR tinymce/util/URI tinymce/util/JSON".split(" "),function(e,d,a,p,h,q,r,s){d.add("spellchecker",function(c,d){function w(){f.textMatcher||(f.textMatcher=new e(c.getBody(),
c));return f.textMatcher}function I(a){for(var b in a)return!1;return!0}function J(d,B){var C=[];a.each(K[d],function(a){C.push({text:a,onclick:function(){c.insertContent(c.dom.encode(a));c.dom.remove(B);v()}})});C.push({text:"-"});L&&C.push({text:"Add to Dictionary",onclick:function(){D(d,B)}});C.push.apply(C,[{text:"Ignore",onclick:function(){b(d,B)}},{text:"Ignore all",onclick:function(){b(d,B,!0)}}]);g=new p({items:C,context:"contextmenu",onautohide:function(a){-1!=a.target.className.indexOf("spellchecker")&&
a.preventDefault()},onhide:function(){g.remove();g=null}});g.renderTo(document.body);var k=h.DOM.getPos(c.getContentAreaContainer()),f=c.dom.getPos(B[0]),e=c.dom.getRoot();"BODY"==e.nodeName?(f.x-=e.ownerDocument.documentElement.scrollLeft||e.scrollLeft,f.y-=e.ownerDocument.documentElement.scrollTop||e.scrollTop):(f.x-=e.scrollLeft,f.y-=e.scrollTop);k.x+=f.x;k.y+=f.y;g.moveTo(k.x,k.y+B[0].offsetHeight)}function m(){return c.getParam("spellchecker_wordchar_pattern")||RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009]+',
"g")}function x(b,f,g,h){var k={method:b,lang:l.spellchecker_language},e="";k["addToDictionary"==b?"word":"text"]=f;a.each(k,function(a,b){e&&(e+="&");e+=b+"="+encodeURIComponent(a)});q.send({url:(new r(d)).toAbsolute(l.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:e,success:function(a){(a=s.parse(a))?a.error?h(a.error):g(a):(a=c.translate("Server response wasn't proper JSON."),h(a))},error:function(){var a=c.translate("The spelling service was not found: (")+
l.spellchecker_rpc_url+c.translate(")");h(a)}})}function F(a,b,c,d){(l.spellchecker_callback||x).call(f,a,b,c,d)}function t(){function a(b){c.notificationManager.open({text:b,type:"error"});c.setProgressState(!1);k()}k()||(c.setProgressState(!0),F("spellcheck",w().text,u,a),c.focus())}function v(){c.dom.select("span.mce-spellchecker-word").length||k()}function D(a,b){c.setProgressState(!0);F("addToDictionary",a,function(){c.setProgressState(!1);c.dom.remove(b,!0);v()},function(a){c.notificationManager.open({text:a,
type:"error"});c.setProgressState(!1)})}function b(b,d,e){c.selection.collapse();e?a.each(c.dom.select("span.mce-spellchecker-word"),function(a){a.getAttribute("data-mce-word")==b&&c.dom.remove(a,!0)}):c.dom.remove(d,!0);v()}function k(){w().reset();f.textMatcher=null;if(n)return n=!1,c.fire("SpellcheckEnd"),!0}function y(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function G(a){var b=l.spellchecker_language;a.control.items().each(function(a){a.active(a.settings.data===b)})}
function u(a){var b;a.words?(L=!!a.dictionary,b=a.words):b=a;c.setProgressState(!1);I(b)?(a=c.translate("No misspellings found."),c.notificationManager.open({text:a,type:"info"}),n=!1):(K=b,w().find(m()).filter(function(a){return!!b[a.text]}).wrap(function(a){return c.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":a.text})}),n=!0,c.fire("SpellcheckStart"))}var A,f=this,K,n,g,l=c.settings,L;A=function(b,c){var d=[];a.each(c,function(a){d.push({selectable:!0,text:a.name,
data:a.value})});return d}("Language",a.map((l.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),function(a){a=a.split("=");return{name:a[0],value:a[1]}}));c.on("click",function(b){var d=b.target;if("mce-spellchecker-word"==d.className){b.preventDefault();var e=y(d),f;b=[];f=a.toArray(c.getBody().getElementsByTagName("span"));if(f.length)for(var g=0;g<f.length;g++){var h=y(f[g]);null!==
h&&h.length&&h===e.toString()&&b.push(f[g])}0<b.length&&(e=c.dom.createRng(),e.setStartBefore(b[0]),e.setEndAfter(b[b.length-1]),c.selection.setRng(e),J(d.getAttribute("data-mce-word"),b))}});c.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:t,selectable:!0,onPostRender:function(){var a=this;a.active(n);c.on("SpellcheckStart SpellcheckEnd",function(){a.active(n)})}});var E={tooltip:"Spellcheck",onclick:t,onPostRender:function(){var a=this;c.on("SpellcheckStart SpellcheckEnd",
function(){a.active(n)})}};1<A.length&&(E.type="splitbutton",E.menu=A,E.onshow=G,E.onselect=function(a){l.spellchecker_language=a.control.settings.data});c.addButton("spellchecker",E);c.addCommand("mceSpellCheck",t);c.on("remove",function(){g&&(g.remove(),g=null)});c.on("change",v);this.getTextMatcher=w;this.getWordCharPattern=m;this.markErrors=u;this.getLanguage=function(){return l.spellchecker_language};l.spellchecker_language=l.spellchecker_language||l.language||"en"})});(function(e){var d,a,p,
h;for(d=0;d<e.length;d++){a=r;p=e[d];h=p.split(/[.\/]/);for(var q=0;q<h.length-1;++q)a[h[q]]===y&&(a[h[q]]={}),a=a[h[q]];a[h[h.length-1]]=s[p]}if(r.AMDLC_TESTS){a=r.privateModules||{};for(p in s)a[p]=s[p];for(d=0;d<e.length;d++)delete a[e[d]];r.privateModules=a}})(["tinymce/spellcheckerplugin/DomTextMatcher"])})(this);
