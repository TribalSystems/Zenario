(function(){var G={},N=function(c){var d=G[c];if(void 0===d)throw"module ["+c+"] was undefined";if(void 0===d.instance){for(var f=G[c],g=f.deps,l=f.defn,b=g.length,e=Array(b),a=0;a<b;++a)e[a]=N(g[a]);g=l.apply(null,e);if(void 0===g)throw"module ["+c+"] returned undefined";f.instance=g}return d.instance},n=function(c,d,f){if("string"!==typeof c)throw"module id must be a string";if(void 0===d)throw"no dependencies for "+c;if(void 0===f)throw"no definition function for "+c;G[c]={deps:d,defn:f,instance:void 0}},
q=function(c,d){n(c,[],function(){return d})};q("global!tinymce.PluginManager",tinymce.PluginManager);q("global!tinymce.Env",tinymce.Env);q("global!tinymce.util.Promise",tinymce.util.Promise);q("global!tinymce.util.URI",tinymce.util.URI);q("global!tinymce.util.Tools",tinymce.util.Tools);q("global!tinymce.util.Delay",tinymce.util.Delay);n("ephox/imagetools/util/Canvas",[],function(){function c(c,f,g){c.width=f;c.height=g;return c}return{create:function(d,f){return c(document.createElement("canvas"),
d,f)},resize:c,get2dContext:function(c){return c.getContext("2d")}}});n("ephox/imagetools/util/ImageSize",[],function(){return{getWidth:function(c){return c.naturalWidth||c.width},getHeight:function(c){return c.naturalHeight||c.height}}});n("ephox/imagetools/util/Promise",[],function(){function c(k,a){return function(){k.apply(a,arguments)}}function d(k){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof k)throw new TypeError("not a function");
this._value=this._state=null;this._deferreds=[];a(k,c(g,this),c(l,this))}function f(k){var a=this;null===this._state?this._deferreds.push(k):h(function(){var m=a._state?k.onFulfilled:k.onRejected;if(null===m)(a._state?k.resolve:k.reject)(a._value);else{var c;try{c=m(a._value)}catch(b){k.reject(b);return}k.resolve(c)}})}function g(k){try{if(k===this)throw new TypeError("A promise cannot be resolved with itself.");if(k&&("object"===typeof k||"function"===typeof k)){var m=k.then;if("function"===typeof m){a(c(m,
k),c(g,this),c(l,this));return}}this._state=!0;this._value=k;b.call(this)}catch(e){l.call(this,e)}}function l(k){this._state=!1;this._value=k;b.call(this)}function b(){for(var k=0,a=this._deferreds.length;k<a;k++)f.call(this,this._deferreds[k]);this._deferreds=null}function e(k,a,m,c){this.onFulfilled="function"===typeof k?k:null;this.onRejected="function"===typeof a?a:null;this.resolve=m;this.reject=c}function a(a,m,c){var b=!1;try{a(function(a){b||(b=!0,m(a))},function(a){b||(b=!0,c(a))})}catch(e){b||
(b=!0,c(e))}}if(window.Promise)return window.Promise;var h=d.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.prototype["catch"]=function(a){return this.then(null,a)};d.prototype.then=function(a,m){var c=this;return new d(function(b,d){f.call(c,new e(a,m,b,d))})};d.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);
return new d(function(m,c){function b(d,h){try{if(h&&("object"===typeof h||"function"===typeof h)){var f=h.then;if("function"===typeof f){f.call(h,function(a){b(d,a)},c);return}}a[d]=h;0===--e&&m(a)}catch(g){c(g)}}if(0===a.length)return m([]);for(var e=a.length,d=0;d<a.length;d++)b(d,a[d])})};d.resolve=function(a){return a&&"object"===typeof a&&a.constructor===d?a:new d(function(m){m(a)})};d.reject=function(a){return new d(function(m,c){c(a)})};d.race=function(a){return new d(function(m,c){for(var b=
0,e=a.length;b<e;b++)a[b].then(m,c)})};return d});n("ephox/imagetools/util/Mime",[],function(){return{guessMimeType:function(c){var d=document.createElement("a");d.href=c;c=d.pathname.split(".");(c=c[c.length-1])&&(c=c.toLowerCase());return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[c]}}});n("ephox/imagetools/util/Conversions",["ephox/imagetools/util/Promise","ephox/imagetools/util/Canvas","ephox/imagetools/util/Mime","ephox/imagetools/util/ImageSize"],function(c,d,f,g){function l(a){return new c(function(c){function b(){a.removeEventListener("load",
b);c(a)}a.complete?c(a):a.addEventListener("load",b)})}function b(a){return l(a).then(function(a){var m;m=d.create(g.getWidth(a),g.getHeight(a));d.get2dContext(m).drawImage(a,0,0);return m})}function e(a){return new c(function(c){var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="blob";b.onload=function(){200==this.status&&c(this.response)};b.send()})}function a(a){return new c(function(c){var b,e,d,h,f;a=a.split(",");(b=/data:([^;]+)/.exec(a[0]))&&(h=b[1]);b=atob(a[1]);if(window.WebKitBlobBuilder){f=
new WebKitBlobBuilder;e=new ArrayBuffer(b.length);for(d=0;d<e.length;d++)e[d]=b.charCodeAt(d);f.append(e);c(f.getBlob(h))}else{e=new Uint8Array(b.length);for(d=0;d<e.length;d++)e[d]=b.charCodeAt(d);c(new Blob([e],{type:h}))}})}function h(a){return new c(function(c){var b=new FileReader;b.onloadend=function(){c(b.result)};b.readAsDataURL(a)})}return{blobToImage:function(a){return new c(function(c){function b(){e.removeEventListener("load",b);c(e)}var e=new Image;e.addEventListener("load",b);e.src=
URL.createObjectURL(a);e.complete&&b()})},imageToBlob:function(c){return l(c).then(function(c){var m=c.src;return 0===m.indexOf("blob:")?e(m):0===m.indexOf("data:")?a(m):b(c).then(function(c){return a(c.toDataURL(f.guessMimeType(m)))})})},blobToDataUri:h,blobToBase64:function(a){return h(a).then(function(a){return a.split(",")[1]})},imageToCanvas:b,canvasToBlob:function(c,b){return a(c.toDataURL(b))},revokeImageUrl:function(a){URL.revokeObjectURL(a.src)},uriToBlob:function(c){return 0===c.indexOf("blob:")?
e(c):0===c.indexOf("data:")?a(c):null}}});n("ephox/imagetools/transformations/ColorMatrix",[],function(){function c(c,b,e){c=parseFloat(c);c>e?c=e:c<b&&(c=b);return c}function d(c,b){var e,a,d,m,k=[],f=Array(10);for(e=0;5>e;e++){for(a=0;5>a;a++)k[a]=b[a+5*e];for(a=0;5>a;a++){for(d=m=0;5>d;d++)m+=c[a+5*d]*k[d];f[a+5*e]=m}}return f}function f(d,b){b=c(b,0,1);return d.map(function(e,a){e=0===a%6?1-(1-e)*b:e*b;return c(e,0,1)})}var g=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,
0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:f,multiply:d,adjustContrast:function(f,
b){var e;b=c(b,-1,1);b*=100;0>b?e=127+127*(b/100):(e=b%1,e=0===e?g[b]:g[Math.floor(b)]*(1-e)+g[Math.floor(b)+1]*e,e=127*e+127);return d(f,[e/127,0,0,0,0.5*(127-e),0,e/127,0,0,0.5*(127-e),0,0,e/127,0,0.5*(127-e),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(f,b){b=c(255*b,-255,255);return d(f,[1,0,0,0,b,0,1,0,0,b,0,0,1,0,b,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(f,b){var e;b=c(b,-1,1);e=1+(0<b?3*b:b);return d(f,[0.3086*(1-e)+e,0.6094*(1-e),0.082*(1-e),0,0,0.3086*(1-e),0.6094*(1-e)+e,0.082*
(1-e),0,0,0.3086*(1-e),0.6094*(1-e),0.082*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(f,b){var e,a;b=c(b,-180,180)/180*Math.PI;e=Math.cos(b);a=Math.sin(b);return d(f,[0.213+0.787*e+-0.213*a,0.715+-0.715*e+-0.715*a,0.072+-0.072*e+0.928*a,0,0,0.213+-0.213*e+0.143*a,0.715+e*(1-0.715)+0.14*a,0.072+-0.072*e+-0.283*a,0,0,0.213+-0.213*e+-0.787*a,0.715+-0.715*e+0.715*a,0.072+0.928*e+0.072*a,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(f,b,e,a){b=c(b,0,2);e=c(e,0,2);a=c(a,0,2);return d(f,[b,
0,0,0,0,0,e,0,0,0,0,0,a,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(g,b){b=c(b,0,1);return d(g,f([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],b))},adjustGrayscale:function(g,b){b=c(b,0,1);return d(g,f([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],b))}}});n("ephox/imagetools/transformations/Filters",["ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/util/Conversions","ephox/imagetools/transformations/ColorMatrix"],
function(c,d,f,g){function l(a,b){return f.blobToImage(a).then(function(a){var e=c.create(d.getWidth(a),d.getHeight(a)),k=c.get2dContext(e);k.drawImage(a,0,0);m(a);a=k.getImageData(0,0,e.width,e.height);var h=a.data,g,l,r,u,p,t=b[0],O=b[1],K=b[2],P=b[3],I=b[4],U=b[5],x=b[6],H=b[7],y=b[8],w=b[9],v=b[10],s=b[11],z=b[12],Q=b[13],n=b[14],A=b[15],q=b[16],R=b[17],S=b[18],B=b[19];for(p=0;p<h.length;p+=4)g=h[p],l=h[p+1],r=h[p+2],u=h[p+3],h[p]=g*t+l*O+r*K+u*P+I,h[p+1]=g*U+l*x+r*H+u*y+w,h[p+2]=g*v+l*s+r*z+
u*Q+n,h[p+3]=g*A+l*q+r*R+u*S+B;k.putImageData(a,0,0);return f.canvasToBlob(e)})}function b(a,b){return f.blobToImage(a).then(function(a){var e=c.create(d.getWidth(a),d.getHeight(a)),k=c.get2dContext(e),h;k.drawImage(a,0,0);m(a);a=k.getImageData(0,0,e.width,e.height);h=k.getImageData(0,0,e.width,e.height);h=function(a,c,b){function e(a,c,b){a>b?a=b:a<c&&(a=c);return a}var m,d,k,h,f,g,E,l,C,F,w,v,s,z;k=Math.round(Math.sqrt(b.length));h=Math.floor(k/2);m=a.data;d=c.data;s=a.width;z=a.height;for(f=0;f<
z;f++)for(a=0;a<s;a++){for(F=g=E=l=0;F<k;F++)for(C=0;C<k;C++)w=e(a+C-h,0,s-1),v=e(f+F-h,0,z-1),w=4*(v*s+w),v=b[F*k+C],g+=m[w]*v,E+=m[w+1]*v,l+=m[w+2]*v;w=4*(f*s+a);d[w]=e(g,0,255);d[w+1]=e(E,0,255);d[w+2]=e(l,0,255)}return c}(a,h,b);k.putImageData(h,0,0);return f.canvasToBlob(e)})}function e(a){return function(b,e){return f.blobToImage(b).then(function(b){var h=c.create(d.getWidth(b),d.getHeight(b)),g=c.get2dContext(h),l,C=Array(256);for(l=0;l<C.length;l++)C[l]=a(l,e);g.drawImage(b,0,0);m(b);b=g.getImageData(0,
0,h.width,h.height);l=b.data;var r;for(r=0;r<l.length;r+=4)l[r]=C[l[r]],l[r+1]=C[l[r+1]],l[r+2]=C[l[r+2]];g.putImageData(b,0,0);return f.canvasToBlob(h)})}}function a(a){return function(b,c){return l(b,a(g.identity(),c))}}function h(a){return function(c){return b(c,a)}}var m=f.revokeImageUrl;return{invert:function(a){return function(b){return l(b,a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:a(g.adjustBrightness),hue:a(g.adjustHue),saturate:a(g.adjustSaturation),contrast:a(g.adjustContrast),
grayscale:a(g.adjustGrayscale),sepia:a(g.adjustSepia),colorize:function(a,b,c,e){return l(a,g.adjustColors(g.identity(),b,c,e))},sharpen:h([0,-1,0,-1,5,-1,0,-1,0]),emboss:h([-2,-1,0,-1,1,1,0,1,2]),gamma:e(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:e(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:l,convoluteFilter:b}});n("ephox/imagetools/transformations/ImageTools",["ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize"],
function(c,d,f){var g=c.revokeImageUrl;return{rotate:function(l,b){return c.blobToImage(l).then(function(e){var a=d.create(f.getWidth(e),f.getHeight(e)),h=d.get2dContext(a),m=0,k=0;b=0>b?360+b:b;90!=b&&270!=b||d.resize(a,a.height,a.width);if(90==b||180==b)m=a.width;if(270==b||180==b)k=a.height;h.translate(m,k);h.rotate(b*Math.PI/180);h.drawImage(e,0,0);g(e);return c.canvasToBlob(a,l.type)})},flip:function(l,b){return c.blobToImage(l).then(function(e){var a=d.create(f.getWidth(e),f.getHeight(e)),h=
d.get2dContext(a);"v"==b?(h.scale(1,-1),h.drawImage(e,0,-a.height)):(h.scale(-1,1),h.drawImage(e,-a.width,0));g(e);return c.canvasToBlob(a)})},crop:function(f,b,e,a,h){return c.blobToImage(f).then(function(m){var f=d.create(a,h);d.get2dContext(f).drawImage(m,-b,-e);g(m);return c.canvasToBlob(f)})},resize:function(f,b,e){return c.blobToImage(f).then(function(a){var h=d.create(b,e);d.get2dContext(h).drawImage(a,0,0,b,e);g(a);return c.canvasToBlob(h,f.type)})}}});n("ephox/imagetools/api/ImageTransformations",
["ephox/imagetools/transformations/Filters","ephox/imagetools/transformations/ImageTools"],function(c,d){return{invert:function(d){return c.invert(d)},sharpen:function(d){return c.sharpen(d)},emboss:function(d){return c.emboss(d)},brightness:function(d,g){return c.brightness(d,g)},hue:function(d,g){return c.hue(d,g)},saturate:function(d,g){return c.saturate(d,g)},contrast:function(d,g){return c.contrast(d,g)},grayscale:function(d,g){return c.grayscale(d,g)},sepia:function(d,g){return c.sepia(d,g)},
colorize:function(d,g,l,b){return c.colorize(d,g,l,b)},gamma:function(d,g){return c.gamma(d,g)},exposure:function(d,g){return c.exposure(d,g)},flip:function(c,g){return d.flip(c,g)},crop:function(c,g,l,b,e){return d.crop(c,g,l,b,e)},resize:function(c,g,l){return d.resize(c,g,l)},rotate:function(c,g){return d.rotate(c,g)}}});n("ephox/imagetools/api/BlobConversions",["ephox/imagetools/util/Conversions"],function(c){return{blobToImage:function(d){return c.blobToImage(d)},imageToBlob:function(d){return c.imageToBlob(d)},
blobToDataUri:function(d){return c.blobToDataUri(d)},blobToBase64:function(d){return c.blobToBase64(d)}}});q("global!tinymce.dom.DOMUtils",tinymce.dom.DOMUtils);q("global!tinymce.ui.Factory",tinymce.ui.Factory);q("global!tinymce.ui.Form",tinymce.ui.Form);q("global!tinymce.ui.Container",tinymce.ui.Container);q("global!tinymce.ui.Control",tinymce.ui.Control);q("global!tinymce.ui.DragHelper",tinymce.ui.DragHelper);q("global!tinymce.geom.Rect",tinymce.geom.Rect);q("global!tinymce.dom.DomQuery",tinymce.dom.DomQuery);
q("global!tinymce.util.Observable",tinymce.util.Observable);q("global!tinymce.util.VK",tinymce.util.VK);n("tinymce/imagetoolsplugin/CropRect","global!tinymce.dom.DomQuery global!tinymce.ui.DragHelper global!tinymce.geom.Rect global!tinymce.util.Tools global!tinymce.util.Observable global!tinymce.util.VK".split(" "),function(c,d,f,g,l,b){var e=0;return function(a,h,m,k,C){function n(b,c,d,e){var h,g,k;h=c.x;g=c.y;k=c.w;c=c.h;h+=d*b.deltaX;g+=e*b.deltaY;k+=d*b.deltaW;c+=e*b.deltaH;20>k&&(k=20);20>c&&
(c=20);b=a=f.clamp({x:h,y:g,w:k,h:c},m,"move"==b.name);b={x:b.x-m.x,y:b.y-m.y,w:b.w,h:b.h};J.fire("updateRect",{rect:b});q(b)}function E(a){function b(a,d){0>d.h&&(d.h=0);0>d.w&&(d.w=0);c("#"+p+"-"+a,k).css({left:d.x,top:d.y,width:d.w,height:d.h})}g.each(D,function(b){c("#"+p+"-"+b.name,k).css({left:a.w*b.xMul+a.x,top:a.h*b.yMul+a.y})});b("top",{x:h.x,y:h.y,w:h.w,h:a.y-h.y});b("right",{x:a.x+a.w,y:a.y,w:h.w-a.x-a.w+h.x,h:a.h});b("bottom",{x:h.x,y:a.y+a.h,w:h.w,h:h.h-a.y-a.h+h.y});b("left",{x:h.x,
y:a.y,w:a.x-h.x,h:a.h});b("move",a)}function F(b){a=b;E(a)}function q(a){F({x:a.x+m.x,y:a.y+m.y,w:a.w,h:a.h})}var J,D,r,u,p="mce-crid-"+e++;D=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},
{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}];u=["top","right","bottom","left"];(function(){c('<div id="'+p+'" class="mce-croprect-container" role="grid" aria-dropeffect="execute">').appendTo(k);g.each(u,function(a){c("#"+p,k).append('<div id="'+p+"-"+a+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});g.each(D,function(a){c("#"+p,k).append('<div id="'+p+"-"+a.name+'" class="mce-croprect-handle mce-croprect-handle-'+a.name+
'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+a.label+'" aria-grabbed="false">')});r=g.map(D,function(b){var c;return new d(p,{document:k.ownerDocument,handle:p+"-"+b.name,start:function(){c=a},drag:function(a){n(b,c,a.deltaX,a.deltaY)}})});E(a);c(k).on("focusin focusout",function(a){c(a.target).attr("aria-grabbed","focus"===a.type)});c(k).on("keydown",function(c){function d(a,b,c,m,h){a.stopPropagation();a.preventDefault();n(e,c,m,h)}var e;g.each(D,function(a){if(c.target.id==
p+"-"+a.name)return e=a,!1});switch(c.keyCode){case b.LEFT:d(c,e,a,-10,0);break;case b.RIGHT:d(c,e,a,10,0);break;case b.UP:d(c,e,a,0,-10);break;case b.DOWN:d(c,e,a,0,10);break;case b.ENTER:case b.SPACEBAR:c.preventDefault(),C()}})})(k);return J=g.extend({toggleVisibility:function(a){var b;b=g.map(D,function(a){return"#"+p+"-"+a.name}).concat(g.map(u,function(a){return"#"+p+"-"+a})).join(",");a?c(b,k).show():c(b,k).hide()},setClampRect:function(b){m=b;E(a)},setRect:F,getInnerRect:function(){return{x:a.x-
m.x,y:a.y-m.y,w:a.w,h:a.h}},setInnerRect:q,setViewPortRect:function(b){h=b;E(a)},destroy:function(){g.each(r,function(a){a.destroy()});r=[]}},l)}});n("tinymce/imagetoolsplugin/ImagePanel","global!tinymce.ui.Control global!tinymce.ui.DragHelper global!tinymce.geom.Rect global!tinymce.util.Tools global!tinymce.util.Promise tinymce/imagetoolsplugin/CropRect".split(" "),function(c,d,f,g,l,b){function e(a){return new l(function(b){function c(){a.removeEventListener("load",c);b(a)}a.complete?b(a):a.addEventListener("load",
c)})}return c.extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(a){var b=this,c=new Image;c.src=a;e(c).then(function(){var a,d=b.state.get("viewRect");a=b.$el.find("img");a[0]?a.replaceWith(c):b.getEl().appendChild(c);a={x:0,y:0,w:c.naturalWidth,h:c.naturalHeight};
b.state.set("viewRect",a);b.state.set("rect",f.inflate(a,-20,-20));d&&d.w==a.w&&d.h==a.h||b.zoomFit();b.repaintImage();b.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var a,b,c;a=this.$el.find("img");b=this.getEl().clientWidth;c=this.getEl().clientHeight;a=Math.min((b-10)/a[0].naturalWidth,(c-10)/a[0].naturalHeight);1<=a&&(a=1);this.zoom(a)},
repaintImage:function(){var a,b,c,d,e,g,f,l,n;a=this.getEl();l=this.zoom();n=this.state.get("rect");f=this.$el.find("img");e=a.offsetWidth;g=a.offsetHeight;c=f[0].naturalWidth*l;d=f[0].naturalHeight*l;a=Math.max(0,e/2-c/2);b=Math.max(0,g/2-d/2);f.css({left:a,top:b,width:c,height:d});this.cropRect&&(this.cropRect.setRect({x:n.x*l+a,y:n.y*l+b,w:n.w*l,h:n.h*l}),this.cropRect.setClampRect({x:a,y:b,w:c,h:d}),this.cropRect.setViewPortRect({x:0,y:0,w:e,h:g}))},bindStates:function(){function a(a){c.cropRect=
new b(a,c.state.get("viewRect"),c.state.get("viewRect"),c.getEl(),function(){c.fire("crop")});c.cropRect.on("updateRect",function(a){a=a.rect;var b=c.zoom();a={x:Math.round(a.x/b),y:Math.round(a.y/b),w:Math.round(a.w/b),h:Math.round(a.h/b)};c.state.set("rect",a)});c.on("remove",c.cropRect.destroy)}var c=this;c.state.on("change:cropEnabled",function(a){c.cropRect.toggleVisibility(a.value);c.repaintImage()});c.state.on("change:zoom",function(){c.repaintImage()});c.state.on("change:rect",function(b){b=
b.value;c.cropRect||a(b);c.cropRect.setRect(b)})}})});n("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function c(){return-1!=f&&f<d.length-1}var d=[],f=-1;return{data:d,add:function(c){var l;l=d.splice(++f);d.push(c);return{state:c,removed:l}},undo:function(){if(0<f)return d[--f]},redo:function(){if(c())return d[++f]},canUndo:function(){return 0<f},canRedo:c}}});n("tinymce/imagetoolsplugin/Dialog","global!tinymce.dom.DOMUtils global!tinymce.util.Tools global!tinymce.util.Promise global!tinymce.ui.Factory global!tinymce.ui.Form global!tinymce.ui.Container tinymce/imagetoolsplugin/ImagePanel ephox/imagetools/api/ImageTransformations ephox/imagetools/api/BlobConversions tinymce/imagetoolsplugin/UndoStack".split(" "),
function(c,d,f,g,l,b,e,a,h,m){function k(a){return{blob:a,url:URL.createObjectURL(a)}}function n(a){a&&URL.revokeObjectURL(a.url)}function q(f,h,ja){function J(a){var b,c,d,e;b=s.find("#w")[0];c=s.find("#h")[0];d=parseInt(b.value(),10);e=parseInt(c.value(),10);s.find("#constrain")[0].checked()&&L&&M&&d&&e&&("w"==a.control.settings.name?(e=Math.round(d*W),c.value(e)):(d=Math.round(e*X),b.value(d)));L=d;M=e}function D(a){return Math.round(100*a)+"%"}function r(){s.find("#undo").disabled(!z.canUndo());
s.find("#redo").disabled(!z.canRedo());s.statusbar.find("#save").disabled(!z.canUndo())}function u(){s.find("#undo").disabled(!0);s.find("#redo").disabled(!0)}function p(a){a&&B.imageSrc(a.url)}function t(a){return function(){var b=d.grep(Y,function(b){return b.settings.name!=a});d.each(b,function(a){a.hide()});a.show();a.focus()}}function O(a){A=k(a);p(A)}function K(a){f=k(a);p(f);a=z.add(f).removed;d.each(a,n);r()}function P(){var b=B.selection();a.crop(f.blob,b.x,b.y,b.w,b.h).then(function(a){K(a);
x()})}function I(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[(A||f).blob].concat(b)).then(O)}}function U(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[f.blob].concat(b)).then(K)}}function x(){p(f);n(A);t(Q)();r()}function H(){A&&(K(A.blob),x())}function y(a){return new l({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},
items:a})}function w(a,b){return y([{text:"Back",onclick:x},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",function(){u();b(f.blob).then(function(a){a=k(a);p(a);n(A);A=a})})}function v(a,b,c,d,e){function g(a){b(f.blob,a).then(function(a){a=k(a);p(a);n(A);A=a})}return y([{text:"Back",onclick:x},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){g(a.value)},minValue:d,maxValue:e,value:c,previewFilter:D},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",
onclick:H}]).hide().on("show",function(){this.find("slider").value(c);u()})}var s,z=new m,Q,ia,A,V,R,S,B,T,G,Z,$,aa,ba,N,ca,da,ea,fa,ga,ha,Y,L,M,W,X;V=y([{text:"Back",onclick:x},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:P}]).hide().on("show hide",function(a){B.toggleCropRect("show"==a.type)}).on("show",u);R=y([{text:"Back",onclick:x},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:J},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:J},{type:"checkbox",
name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(a){!0===a.control.value()&&(W=M/L,X=L/M)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(b){var c=parseInt(s.find("#w").value(),10),d=parseInt(s.find("#h").value(),10);b.preventDefault();U(a.resize,c,d)();x()}).on("show",u);S=y([{text:"Back",onclick:x},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:I(a.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",
onclick:I(a.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:I(a.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:I(a.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",u);G=w("Invert",a.invert);ea=w("Sharpen",a.sharpen);fa=w("Emboss",a.emboss);Z=v("Brightness",a.brightness,0,-1,1);$=v("Hue",a.hue,180,0,360);aa=v("Saturate",a.saturate,0,-1,1);ba=v("Contrast",a.contrast,0,-1,1);N=v("Grayscale",a.grayscale,0,0,1);
ca=v("Sepia",a.sepia,0,0,1);da=function(a,b){function c(){var a,d,e;a=s.find("#r")[0].value();d=s.find("#g")[0].value();e=s.find("#b")[0].value();b(f.blob,a,d,e).then(function(a){a=k(a);p(a);n(A);A=a})}return y([{text:"Back",onclick:x},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:D},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:D},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,
ondragend:c,previewFilter:D},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",function(){s.find("#r,#g,#b").value(1);u()})}("Colorize",a.colorize);ga=v("Gamma",a.gamma,0,-1,1);ha=v("Exposure",a.exposure,1,0,2);ia=y([{text:"Back",onclick:x},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:t($)},{text:"saturate",icon:"saturate",onclick:t(aa)},{text:"sepia",icon:"sepia",onclick:t(ca)},{text:"emboss",icon:"emboss",onclick:t(fa)},{text:"exposure",icon:"exposure",
onclick:t(ha)},{type:"spacer",flex:1}]).hide();Q=y([{tooltip:"Crop",icon:"crop",onclick:t(V)},{tooltip:"Resize",icon:"resize2",onclick:t(R)},{tooltip:"Orientation",icon:"orientation",onclick:t(S)},{tooltip:"Brightness",icon:"sun",onclick:t(Z)},{tooltip:"Sharpen",icon:"sharpen",onclick:t(ea)},{tooltip:"Contrast",icon:"contrast",onclick:t(ba)},{tooltip:"Color levels",icon:"drop",onclick:t(da)},{tooltip:"Gamma",icon:"gamma",onclick:t(ga)},{tooltip:"Invert",icon:"invert",onclick:t(G)}]);B=new e({flex:1,
imageSrc:f.url});T=new b({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){f=z.undo();p(f);r()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){f=z.redo();p(f);r()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=B.zoom();2>a&&(a+=0.1);B.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=B.zoom();0.1<a&&(a-=0.1);B.zoom(a)}}]});
T=new b({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[T,B]});Y=[Q,V,R,S,ia,G,Z,$,aa,ba,N,ca,da,ea,fa,ga,ha];s=g.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(c.DOM.getViewPort().w,800),minHeight:Math.min(c.DOM.getViewPort().h,650),title:"Edit image",items:Y.concat([T]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){h(f.blob);s.close()}},{text:"Cancel",onclick:"close"}]});s.renderTo(document.body).reflow();
s.on("close",function(){ja();d.each(z.data,n);A=z=null});z.add(f);r();B.on("load",function(){L=B.imageSize().w;M=B.imageSize().h;W=M/L;X=L/M;s.find("#w").value(L);s.find("#h").value(M)});B.on("crop",P)}return{edit:function(a){return new f(function(b,c){q(k(a),b,c)})}}});n("tinymce/imagetoolsplugin/Plugin","global!tinymce.PluginManager global!tinymce.Env global!tinymce.util.Promise global!tinymce.util.URI global!tinymce.util.Tools global!tinymce.util.Delay ephox/imagetools/api/ImageTransformations ephox/imagetools/api/BlobConversions tinymce/imagetoolsplugin/Dialog".split(" "),
function(c,d,f,g,l,b,e,a,h){c.add("imagetools",function(c){function k(a){var b,d;b=a.style.width;d=a.style.height;if(b||d)return b.indexOf("px")==b.length-2&&d.indexOf("px")==d.length-2?{w:parseInt(b,10),h:parseInt(d,10)}:null;b=c.$(a).attr("width");d=c.$(a).attr("height");return b&&d?{w:parseInt(b,10),h:parseInt(d,10)}:null}function n(a,b){var d,e;b&&(d=a.style.width,e=a.style.height,(d||e)&&c.$(a).css({width:b.w,height:b.h}).removeAttr("data-mce-style"),d=a.width,e=a.height,(d||e)&&c.$(a).attr({width:b.w,
height:b.h}))}function q(){return c.selection.getNode()}function E(a){a=a.src;return 0===a.indexOf("data:")||0===a.indexOf("blob:")||(new g(a)).host===c.documentBaseURI.host}function F(a){return-1!==l.inArray(c.settings.imagetools_cors_hosts,(new g(a.src)).host)}function G(a){return new f(function(b){var d,e;d=new XMLHttpRequest;d.onload=function(){b(this.response)};d.open("GET",a,!0);if(e=c.settings.api_key||c.settings.imagetools_api_key)d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),
d.setRequestHeader("tiny-api-key",e);d.responseType="blob";d.send()})}function J(b){var d=b.src;if(F(b))return G(b.src);if(!E(b)){d=c.settings.imagetools_proxy;d+=(-1===d.indexOf("?")?"?":"&")+"url="+encodeURIComponent(b.src);if(c.settings.api_key||c.settings.imagetools_api_key)return G(d);b=new Image;b.src=d}return a.imageToBlob(b)}function D(){var b;return(b=c.editorUpload.blobCache.getByUri(q().src))?b:J(q()).then(function(b){return a.blobToBase64(b).then(function(a){var d=c.editorUpload.blobCache;
a=d.create("imagetools"+x++,b,a);d.add(a);return a})})}function r(){H=b.setEditorTimeout(c,function(){c.editorUpload.uploadImagesAuto()},3E4)}function u(b,d){return a.blobToDataUri(b).then(function(a){var e,f,h,k;k=q();e="imagetools"+x++;f=c.editorUpload.blobCache;a=g.parseDataUri(a).data;h=f.create(e,b,a);f.add(h);c.undoManager.transact(function(){function a(){c.$(k).off("load",a);c.nodeChanged();d?c.editorUpload.uploadImagesAuto():(clearTimeout(H),r())}c.$(k).on("load",a);c.$(k).attr({src:h.blobUri()}).removeAttr("data-mce-src")});
return h})}function p(a){return function(){return c._scanForImages().then(D).then(a).then(u)}}function t(a){return function(){return p(function(b){var c=k(q());c&&n(q(),{w:c.h,h:c.w});return e.rotate(b.blob(),a)})()}}function O(a){return function(){return p(function(b){return e.flip(b.blob(),a)})()}}function K(){var b=q(),c=b.naturalWidth,d=b.naturalHeight;b&&J(b).then(h.edit).then(function(e){return new f(function(f){a.blobToImage(e).then(function(a){var g={w:a.naturalWidth,h:a.naturalHeight};(c!=
g.w||d!=g.h)&&k(b)&&n(b,g);URL.revokeObjectURL(a.src);f(e)})})}).then(function(a){u(a,!0)},function(){})}function P(){c.on("NodeChange",function(a){y&&y.src!=a.element.src&&(clearTimeout(H),c.editorUpload.uploadImagesAuto(),y=void 0);I(a.element)&&(y=a.element)})}function I(a){return c.dom.is(a,"img:not([data-mce-object],[data-mce-placeholder])")&&(E(a)||F(a)||c.settings.imagetools_proxy)}function N(){var a=c.settings.imagetools_toolbar;a||(a="rotateleft rotateright | flipv fliph | crop editimage imageoptions");
c.addContextToolbar(I,a)}var x=0,H,y;d.fileApi&&(c.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:t(-90)}),c.addButton("rotateright",{title:"Rotate clockwise",onclick:t(90)}),c.addButton("flipv",{title:"Flip vertically",onclick:O("v")}),c.addButton("fliph",{title:"Flip horizontally",onclick:O("h")}),c.addButton("editimage",{title:"Edit image",onclick:K}),c.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),N(),P(),c.addCommand("mceEditImage",K))});return function(){}});
N("tinymce/imagetoolsplugin/Plugin")()})();
