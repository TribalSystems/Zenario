tinymce.PluginManager.add("noneditable",function(h){function u(a){var c;if(1===a.nodeType){if((c=a.getAttribute(q))&&"inherit"!==c)return c;c=a.contentEditable;if("inherit"!==c)return c}return null}function v(a){for(var c;a;){if(c=u(a))return"false"===c?a:null;a=a.parentNode}}function z(){function a(b){for(;b;){if(b.id===q)return b;b=b.parentNode}}function c(b){var n;if(b)for(n=new w(b,b),b=n.current();b;b=n.next())if(3===b.nodeType)return b}function e(b,n){var a,e;if("false"===u(b)&&k.isBlock(b))l.select(b);
else return e=k.createRng(),"true"===u(b)&&(b.firstChild||b.appendChild(h.getDoc().createTextNode("\u00a0")),b=b.firstChild,n=!0),a=k.create("span",{id:q,"data-mce-bogus":!0},s),n?b.parentNode.insertBefore(a,b):k.insertAfter(a,b),e.setStart(a.firstChild,1),e.collapse(!0),l.setRng(e),a}function x(b){var n,a;if(b)n=l.getRng(!0),n.setStartBefore(b),n.setEndBefore(b),(a=c(b))&&a.nodeValue.charAt(0)==s&&a.deleteData(0,1),k.remove(b,!0),l.setRng(n);else for(;(b=k.get(q))&&b!==n;)(a=c(b))&&a.nodeValue.charAt(0)==
s&&a.deleteData(0,1),k.remove(b,!0),n=b}function p(){function b(b,a){var f,e,c;f=d.startContainer;e=d.startOffset;if(3==f.nodeType){if(c=f.nodeValue.length,0<e&&e<c||(a?e==c:0===e))return}else if(e<f.childNodes.length)f=f.childNodes[!a&&0<e?e-1:e],f.hasChildNodes()&&(f=f.firstChild);else return a?null:b;for(f=new w(f,b);e=f[a?"prev":"next"]();){if(3===e.nodeType&&0<e.nodeValue.length)return;if("true"===u(e))return e}return b}var a,c,k,d,f;x();k=l.isCollapsed();a=v(l.getStart());c=v(l.getEnd());if(a||
c)d=l.getRng(!0),k?(a=a||c,(f=b(a,!0))?e(f,!0):(f=b(a,!1))?e(f,!1):l.select(a)):(d=l.getRng(!0),a&&d.setStartBefore(a),c&&d.setEndAfter(c),l.setRng(d))}var k=h.dom,l=h.selection,q="mce_noneditablecaret",s="\ufeff";h.on("mousedown",function(b){var a=h.selection.getNode();a&&-1!==a.className.indexOf("mceTmpParagraph")&&a!==b.target&&("&nbsp;"===a.innerHTML||""===a.innerHTML||" "===a.innerHTML?k.remove(a):a.className=a.className.replace("mceTmpParagraph",""));"false"===u(a)&&a==b.target&&p()});h.on("mouseup",
p);h.on("keydown",function(b){function e(a,b){for(;a=a[b?"previousSibling":"nextSibling"];)if(3!==a.nodeType||0<a.nodeValue.length)return a}function c(a,b){l.select(a);l.collapse(b)}function q(b){function e(a){for(var b=d;b;){if(b===a)return;b=b.parentNode}k.remove(a);p()}function f(){var a,c,k=h.schema.getNonEmptyElements();for(c=new tinymce.dom.TreeWalker(d,h.getBody());(a=b?c.prev():c.next())&&!k[a.nodeName.toLowerCase()]&&!(3===a.nodeType&&0<tinymce.trim(a.nodeValue).length);)if("false"===u(a))return e(a),
!0;return v(a)?!0:!1}var c,d,g;if(l.isCollapsed()){c=l.getRng(!0);d=c.startContainer;c=c.startOffset;d=a(d)||d;if(g=v(d))return e(g),!1;if(3==d.nodeType&&(b?0<c:c<d.nodeValue.length))return!0;1==d.nodeType&&(d=d.childNodes[c]||d);if(f())return!1}return!0}var d=b.keyCode,f,t;p();t=l.getStart();f=l.getEnd();f=v(t)||v(f);var m=h.selection.getNode(),s=d==g.LEFT||d==g.RIGHT||d==g.UP||d==g.DOWN,r=d==g.LEFT||d==g.UP;if(f&&(112>d||124<d)&&d!=g.DELETE&&d!=g.BACKSPACE){if((tinymce.isMac?!b.metaKey:!b.ctrlKey)||
67!=d&&88!=d&&86!=d)if(b.preventDefault(),s)if(h.dom.isBlock(f)){b=r?f.previousSibling:f.nextSibling;if(!b||b&&"false"===u(b))d=k.create("p",null,"&nbsp;"),d.className="mceTmpParagraph",(m=r?f:b)&&m.parentNode?m.parentNode.insertBefore(d,m):b||r||f.parentNode.appendChild(d),b=d;f=new w(b,b);f=r?f.prev():f.next();c(f,!r)}else c(f,r)}else if(s||d==g.BACKSPACE||d==g.DELETE){if(t=a(t)){if(d==g.LEFT||d==g.BACKSPACE)if((f=e(t,!0))&&"false"===u(f))if(b.preventDefault(),d==g.LEFT)c(f,!0);else{k.remove(f);
return}else x(t);if(d==g.RIGHT||d==g.DELETE)if((f=e(t,!0))&&"false"===u(f))if(b.preventDefault(),d==g.RIGHT)c(f,!1);else{k.remove(f);return}else x(t)}else if(s&&m&&-1!==m.className.indexOf("mceTmpParagraph")&&m[r?"previousSibling":"nextSibling"]&&(t=m[r?"previousSibling":"nextSibling"],"&nbsp;"===m.innerHTML||""===m.innerHTML||" "===m.innerHTML?k.remove(m):m.className=m.className.replace("mceTmpParagraph",""),c(t,!r)),r=l.getRng(!0),m=r.endContainer,k.isBlock(m)&&k.isBlock(m.nextSibling)&&1==r.endOffset&&
d==g.DELETE&&(f=v(m.nextSibling)),f&&(d==g.DELETE||d==g.BACKSPACE)&&k.isBlock(f)){b.preventDefault();k.remove(f);return}if((d==g.BACKSPACE||d==g.DELETE)&&!q(d==g.BACKSPACE))return b.preventDefault(),!1}})}function A(a){var c=p.length,e=a.content,g=tinymce.trim(s);if("raw"!=a.format){for(;c--;)e=e.replace(p[c],function(a){var c=arguments,l=c[c.length-2];return 0<l&&'"'==e.charAt(l-1)?a:'<span class="'+g+'" data-mce-content="'+h.dom.encode(c[0])+'">'+h.dom.encode("string"===typeof c[1]?c[1]:c[0])+"</span>"});
a.content=e}}var w=tinymce.dom.TreeWalker,q="data-mce-contenteditable",g=tinymce.util.VK,y,s,p;y=" "+tinymce.trim(h.getParam("noneditable_editable_class","mceEditable"))+" ";s=" "+tinymce.trim(h.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";(p=h.getParam("noneditable_regexp"))&&!p.length&&(p=[p]);h.on("PreInit",function(){z();if(p)h.on("BeforeSetContent",A);h.parser.addAttributeFilter("class",function(a){for(var c=a.length,e,g;c--;)g=a[c],e=" "+g.attr("class")+" ",-1!==e.indexOf(y)?
g.attr(q,"true"):-1!==e.indexOf(s)&&g.attr(q,"false")});h.serializer.addAttributeFilter(q,function(a){for(var c=a.length,e;c--;)e=a[c],p&&e.attr("data-mce-content")?(e.name="#text",e.type=3,e.raw=!0,e.value=e.attr("data-mce-content")):(e.attr("contenteditable",null),e.attr(q,null))});h.parser.addAttributeFilter("contenteditable",function(a){for(var c=a.length,e;c--;)e=a[c],e.attr(q,e.attr("contenteditable")),e.attr("contenteditable",null)})});h.on("drop",function(a){v(a.target)&&a.preventDefault()})});
