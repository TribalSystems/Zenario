(function(){function w(e,n,r,t,m){function s(a,b){b=b||0;if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var c=a.index;if(0<b){var g=a[b];if(!g)throw"Invalid capture group";c+=a[0].indexOf(g);a[0]=g}return[c,c+a[0].length,[a[0]]]}function l(a){var b;if(3===a.nodeType)return a.data;if(q[a.nodeName]&&!f[a.nodeName])return"";b="";if(f[a.nodeName]||p[a.nodeName])b+="\n";if(a=a.firstChild){do b+=l(a);while(a=a.nextSibling)}return b}function h(a,b,c){var g,d,l,u,v=[],e=0,k=a,h=b.shift(),
m=0;a:for(;;){(f[k.nodeName]||p[k.nodeName])&&e++;3===k.nodeType&&(!d&&k.length+e>=h[1]?(d=k,u=h[1]-e):g&&v.push(k),!g&&k.length+e>h[0]&&(g=k,l=h[0]-e),e+=k.length);if(g&&d){if(k=c({startNode:g,startNodeIndex:l,endNode:d,endNodeIndex:u,innerNodes:v,match:h[2],matchIndex:m}),e-=d.length-u,d=g=null,v=[],h=b.shift(),m++,!h)break}else if((!q[k.nodeName]||f[k.nodeName])&&k.firstChild){k=k.firstChild;continue}else if(k.nextSibling){k=k.nextSibling;continue}for(;;)if(k.nextSibling){k=k.nextSibling;break}else if(k.parentNode!==
a)k=k.parentNode;else break a}}function a(a){var b;if("function"!=typeof a){var c=a.nodeType?a:g.createElement(a);b=function(a,b){var d=c.cloneNode(!1);d.setAttribute("data-mce-index",b);a&&d.appendChild(g.createTextNode(a));return d}}else b=a;return function(a){var c,d,e,f=a.startNode,h=a.endNode,k=a.matchIndex;if(f===h)return e=f.parentNode,0<a.startNodeIndex&&(c=g.createTextNode(f.data.substring(0,a.startNodeIndex)),e.insertBefore(c,f)),c=b(a.match[0],k),e.insertBefore(c,f),a.endNodeIndex<f.length&&
(d=g.createTextNode(f.data.substring(a.endNodeIndex)),e.insertBefore(d,f)),f.parentNode.removeChild(f),c;c=g.createTextNode(f.data.substring(0,a.startNodeIndex));d=g.createTextNode(h.data.substring(a.endNodeIndex));var l=b(f.data.substring(a.startNodeIndex),k);e=[];for(var m=0,q=a.innerNodes.length;m<q;++m){var p=a.innerNodes[m],n=b(p.data,k);p.parentNode.replaceChild(n,p);e.push(n)}a=b(h.data.substring(0,a.endNodeIndex),k);e=f.parentNode;e.insertBefore(c,f);e.insertBefore(l,f);e.removeChild(f);e=
h.parentNode;e.insertBefore(a,h);e.insertBefore(d,h);e.removeChild(h);return a}}var b=[],d,c=0,g,f,q,p;g=n.ownerDocument;f=m.getBlockElements();q=m.getWhiteSpaceElements();p=m.getShortEndedElements();if(d=l(n)){if(e.global)for(;m=e.exec(d);)b.push(s(m,t));else m=d.match(e),b.push(s(m,t));b.length&&(c=b.length,h(n,b,a(r)));return c}}tinymce.PluginManager.add("searchreplace",function(e){function n(){function a(){c.statusbar.find("#next").disabled(!m(h+1).length);c.statusbar.find("#prev").disabled(!m(h-
1).length)}function b(){tinymce.ui.MessageBox.alert("Could not find the specified string.",function(){c.find("#find")[0].focus()})}var d={},c=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){e.focus();l.done()},onSubmit:function(e){var f,q,p;e.preventDefault();f=c.find("#case").checked();p=c.find("#words").checked();q=c.find("#find").value();q.length?d.text==q&&d.caseState==f&&d.wholeWord==p?0===m(h+1).length?b():(l.next(),a()):((e=l.find(q,f,
p))||b(),c.statusbar.items().slice(1).disabled(0===e),a(),d={text:q,caseState:f,wholeWord:p}):(l.done(!1),c.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){c.submit()}},{text:"Replace",disabled:!0,onclick:function(){l.replace(c.find("#replace").value())||(c.statusbar.items().slice(1).disabled(!0),h=-1,d={})}},{text:"Replace all",disabled:!0,onclick:function(){l.replace(c.find("#replace").value(),!0,!0);c.statusbar.items().slice(1).disabled(!0);
d={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){l.prev();a()}},{text:"Next",name:"next",disabled:!0,onclick:function(){l.next();a()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:e.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",
label:" "}]}}).renderTo().reflow()}function r(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function t(a){var b=a.parentNode;a.firstChild&&b.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}function m(a){var b,d=[];b=tinymce.toArray(e.getBody().getElementsByTagName("span"));if(b.length)for(var c=0;c<b.length;c++){var g=r(b[c]);null!==g&&g.length&&g===a.toString()&&d.push(b[c])}return d}function s(a){var b=h,d=e.dom;!1!==a?b++:b--;d.removeClass(m(h),"mce-match-marker-selected");
a=m(b);return a.length?(d.addClass(m(b),"mce-match-marker-selected"),e.selection.scrollIntoView(a[0]),b):-1}var l=this,h=-1;l.init=function(a){a.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:n,separator:"before",context:"edit"});a.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:n});a.addCommand("SearchReplace",n);a.shortcuts.add("Meta+F","",n)};l.find=function(a,b,d){a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");a=RegExp(d?
"\\b"+a+"\\b":a,b?"g":"gi");d=e.dom.create("span",{"data-mce-bogus":1});d.className="mce-match-marker";b=e.getBody();l.done(!1);if(a=w(a,b,d,!1,e.schema))h=-1,h=s(!0);return a};l.next=function(){var a=s(!0);-1!==a&&(h=a)};l.prev=function(){var a=s(!1);-1!==a&&(h=a)};l.replace=function(a,b,d){var c,g,f,q,p=h;b=!1!==b;c=e.getBody();g=tinymce.toArray(c.getElementsByTagName("span"));for(c=0;c<g.length;c++){var n=r(g[c]);if(null!==n&&n.length)if(f=q=parseInt(n,10),d||f===h){a.length?(g[c].firstChild.nodeValue=
a,t(g[c])):(f=g[c],f.parentNode.removeChild(f));for(;g[++c];)if(f=r(g[c]),null!==n&&n.length)if(f===q)f=g[c],f.parentNode.removeChild(f);else{c--;break}b&&p--}else q>h&&g[c].setAttribute("data-mce-index",q-1)}e.undoManager.add();h=p;b?(a=0<m(p+1).length,l.next()):(a=0<m(p-1).length,l.prev());return!d&&a};l.done=function(a){var b,d,c,g;d=tinymce.toArray(e.getBody().getElementsByTagName("span"));for(b=0;b<d.length;b++){var f=r(d[b]);null!==f&&f.length&&(f===h.toString()&&(c||(c=d[b].firstChild),g=d[b].firstChild),
t(d[b]))}if(c&&g)return b=e.dom.createRng(),b.setStart(c,0),b.setEnd(g,g.data.length),!1!==a&&e.selection.setRng(b),b}})})();
