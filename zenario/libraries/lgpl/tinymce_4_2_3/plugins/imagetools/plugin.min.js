(function(M,F){function ja(d,h){for(var g,k=[],f=0;f<d.length;++f){if(!(g=H[d[f]]))a:{g=M;for(var e=d[f].split(/[.\/]/),c=0;c<e.length;++c){if(!g[e[c]]){g=void 0;break a}g=g[e[c]]}}if(!g)throw"module definition dependecy not found: "+d[f];k.push(g)}h.apply(null,k)}function p(d,h,g){if("string"!==typeof d)throw"invalid module definition, module id must be defined and be a string";if(h===F)throw"invalid module definition, dependencies must be specified";if(g===F)throw"invalid module definition, definition function must be specified";
ja(h,function(){H[d]=g.apply(null,arguments)})}var H={};p("tinymce/imagetoolsplugin/Canvas",[],function(){function d(d,g,k){d.width=g;d.height=k;return d}return{create:function(h,g){return d(document.createElement("canvas"),h,g)},resize:d,get2dContext:function(d){return d.getContext("2d")}}});p("tinymce/imagetoolsplugin/Mime",[],function(){return{guessMimeType:function(d){var h=document.createElement("a");h.href=d;d=h.pathname.split(".");(d=d[d.length-1])&&(d=d.toLowerCase());return{jpg:"image/jpeg",
jpeg:"image/jpeg",png:"image/png"}[d]}}});p("tinymce/imagetoolsplugin/ImageSize",[],function(){return{getWidth:function(d){return d.naturalWidth||d.width},getHeight:function(d){return d.naturalHeight||d.height}}});p("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(d,h,g,k){function f(b){return new d(function(a){function c(){b.removeEventListener("load",c);a(b)}b.complete?
a(b):b.addEventListener("load",c)})}function e(b){return f(b).then(function(b){var a;a=h.create(k.getWidth(b),k.getHeight(b));h.get2dContext(a).drawImage(b,0,0);return a})}function c(b){return new d(function(a){var c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType="blob";c.onload=function(){200==this.status&&a(this.response)};c.send()})}function b(b){return new d(function(a){var c,e,d,f,h;b=b.split(",");(c=/data:([^;]+)/.exec(b[0]))&&(f=c[1]);c=atob(b[1]);if(window.WebKitBlobBuilder){h=new WebKitBlobBuilder;
e=new ArrayBuffer(c.length);for(d=0;d<e.length;d++)e[d]=c.charCodeAt(d);h.append(e);a(h.getBlob(f))}else{e=new Uint8Array(c.length);for(d=0;d<e.length;d++)e[d]=c.charCodeAt(d);a(new Blob([e],{type:f}))}})}function a(b){return new d(function(a){var c=new FileReader;c.onloadend=function(){a(c.result)};c.readAsDataURL(b)})}return{blobToImage:function(b){return new d(function(a){function c(){e.removeEventListener("load",c);a(e)}var e=new Image;e.addEventListener("load",c);e.src=URL.createObjectURL(b);
e.complete&&c()})},imageToBlob:function(a){return f(a).then(function(a){var d=a.src;return 0===d.indexOf("blob:")?c(d):0===d.indexOf("data:")?b(d):e(a).then(function(a){return b(a.toDataURL(g.guessMimeType(d)))})})},uriToBlob:function(a){return 0===a.indexOf("blob:")?c(a):0===a.indexOf("data:")?b(a):null},blobToDataUri:a,blobToBase64:function(b){return a(b).then(function(a){return a.split(",")[1]})},imageToCanvas:e,canvasToBlob:function(a,c){return b(a.toDataURL(c))},revokeImageUrl:function(a){URL.revokeObjectURL(a.src)}}});
p("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(d,h,g){var k=d.revokeImageUrl;return{rotate:function(f,e){return d.blobToImage(f).then(function(c){var b=h.create(g.getWidth(c),g.getHeight(c)),a=h.get2dContext(b),r=0,m=0;e=0>e?360+e:e;90!=e&&270!=e||h.resize(b,b.height,b.width);if(90==e||180==e)r=b.width;if(270==e||180==e)m=b.height;a.translate(r,m);a.rotate(e*Math.PI/180);a.drawImage(c,
0,0);k(c);return d.canvasToBlob(b,f.type)})},flip:function(f,e){return d.blobToImage(f).then(function(c){var b=h.create(g.getWidth(c),g.getHeight(c)),a=h.get2dContext(b);"v"==e?(a.scale(1,-1),a.drawImage(c,0,-b.height)):(a.scale(-1,1),a.drawImage(c,-b.width,0));k(c);return d.canvasToBlob(b)})},crop:function(f,e,c,b,a){return d.blobToImage(f).then(function(f){var m=h.create(b,a);h.get2dContext(m).drawImage(f,-e,-c);k(f);return d.canvasToBlob(m)})},resize:function(f,e,c){return d.blobToImage(f).then(function(b){var a=
h.create(e,c);h.get2dContext(a).drawImage(b,0,0,e,c);k(b);return d.canvasToBlob(a,f.type)})}}});p("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(d,h,g,k,f){var e=0;return function(c,b,a,r){function m(a){function c(a,b){0>b.h&&(b.h=0);0>b.w&&(b.w=0);d("#"+u+"-"+a,r).css({left:b.x,top:b.y,width:b.w,height:b.h})}k.each(B,function(b){d("#"+u+"-"+b.name,r).css({left:a.w*b.xMul+a.x,top:a.h*b.yMul+
a.y})});c("top",{x:b.x,y:b.y,w:b.w,h:a.y-b.y});c("right",{x:a.x+a.w,y:a.y,w:b.w-a.x-a.w+b.x,h:a.h});c("bottom",{x:b.x,y:a.y+a.h,w:b.w,h:b.h-a.y-a.h+b.y});c("left",{x:b.x,y:a.y,w:a.x-b.x,h:a.h});c("move",a)}function l(a){c=a;m(c)}function ia(b){l({x:b.x+a.x,y:b.y+a.y,w:b.w,h:b.h})}var I,B,V,O,u="mce-crid-"+e++;B=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},
{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];O=["top","right","bottom","left"];(function(){d('<div id="'+u+'" class="mce-croprect-container" data-mce-bogus="all">').appendTo(r);k.each(O,function(a){d("#"+u,r).append('<div id="'+u+"-"+a+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});k.each(B,function(a){d("#"+u,r).append('<div id="'+u+"-"+a.name+'" class="mce-croprect-handle mce-croprect-handle-'+
a.name+'" style="display: none" data-mce-bogus="all">')});V=k.map(B,function(b){var e;return new h(u,{document:r.ownerDocument,handle:u+"-"+b.name,start:function(){e=c},drag:function(d){var f,l,h,m;f=e.x;l=e.y;h=e.w;m=e.h;f+=d.deltaX*b.deltaX;l+=d.deltaY*b.deltaY;h+=d.deltaX*b.deltaW;m+=d.deltaY*b.deltaH;20>h&&(h=20);20>m&&(m=20);d=c=g.clamp({x:f,y:l,w:h,h:m},a,"move"==b.name);d={x:d.x-a.x,y:d.y-a.y,w:d.w,h:d.h};I.fire("updateRect",{rect:d});ia(d)}})});m(c)})(r);return I=k.extend({toggleVisibility:function(a){var b;
b=k.map(B,function(a){return"#"+u+"-"+a.name}).concat(k.map(O,function(a){return"#"+u+"-"+a})).join(",");a?d(b,r).show():d(b,r).hide()},setClampRect:function(b){a=b;m(c)},setRect:l,getInnerRect:function(){return{x:c.x-a.x,y:c.y-a.y,w:c.w,h:c.h}},setInnerRect:ia,setViewPortRect:function(a){b=a;m(c)},destroy:function(){k.each(V,function(a){a.destroy()});V=[]}},f)}});p("tinymce/imagetoolsplugin/ImagePanel","tinymce/ui/Control tinymce/ui/DragHelper tinymce/ui/Rect tinymce/util/Tools tinymce/util/Promise tinymce/imagetoolsplugin/CropRect".split(" "),
function(d,h,g,k,f,e){function c(b){return new f(function(a){function c(){b.removeEventListener("load",c);a(b)}b.complete?a(b):b.addEventListener("load",c)})}return d.extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(b){var a=this,d=new Image;d.src=b;c(d).then(function(){var b,
c=a.state.get("viewRect");b=a.$el.find("img");b[0]?b.replaceWith(d):a.getEl().appendChild(d);b={x:0,y:0,w:d.naturalWidth,h:d.naturalHeight};a.state.set("viewRect",b);a.state.set("rect",g.inflate(b,-20,-20));c&&c.w==b.w&&c.h==b.h||a.zoomFit();a.repaintImage();a.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var b,a,c;b=this.$el.find("img");
a=this.getEl().clientWidth;c=this.getEl().clientHeight;b=Math.min((a-10)/b[0].naturalWidth,(c-10)/b[0].naturalHeight);1<=b&&(b=1);this.zoom(b)},repaintImage:function(){var b,a,c,d,e,f,h,g,k;b=this.getEl();g=this.zoom();k=this.state.get("rect");h=this.$el.find("img");e=b.offsetWidth;f=b.offsetHeight;c=h[0].naturalWidth*g;d=h[0].naturalHeight*g;b=Math.max(0,e/2-c/2);a=Math.max(0,f/2-d/2);h.css({left:b,top:a,width:c,height:d});this.cropRect&&(this.cropRect.setRect({x:k.x*g+b,y:k.y*g+a,w:k.w*g,h:k.h*
g}),this.cropRect.setClampRect({x:b,y:a,w:c,h:d}),this.cropRect.setViewPortRect({x:0,y:0,w:e,h:f}))},bindStates:function(){function b(b){a.cropRect=new e(b,a.state.get("viewRect"),a.state.get("viewRect"),a.getEl());a.cropRect.on("updateRect",function(b){b=b.rect;var c=a.zoom();b={x:Math.round(b.x/c),y:Math.round(b.y/c),w:Math.round(b.w/c),h:Math.round(b.h/c)};a.state.set("rect",b)});a.on("remove",a.cropRect.destroy)}var a=this;a.state.on("change:cropEnabled",function(b){a.cropRect.toggleVisibility(b.value);
a.repaintImage()});a.state.on("change:zoom",function(){a.repaintImage()});a.state.on("change:rect",function(c){c=c.value;a.cropRect||b(c);a.cropRect.setRect(c)})}})});p("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function d(d,e,c){d=parseFloat(d);d>c?d=c:d<e&&(d=e);return d}function h(d,e){var c,b,a,h,g=[],l=Array(10);for(c=0;5>c;c++){for(b=0;5>b;b++)g[b]=e[b+5*c];for(b=0;5>b;b++){for(a=h=0;5>a;a++)h+=d[b+5*a]*g[a];l[b+5*c]=h}}return l}function g(h,e){e=d(e,0,1);return h.map(function(c,b){c=
0===b%6?1-(1-c)*e:c*e;return d(c,0,1)})}var k=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,
0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:g,multiply:h,adjustContrast:function(f,e){var c;e=d(e,-1,1);e*=100;0>e?c=127+127*(e/100):(c=e%1,c=0===c?k[e]:k[Math.floor(e)]*(1-c)+k[Math.floor(e)+1]*c,c=127*c+127);return h(f,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(f,e){e=d(255*e,-255,255);return h(f,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(f,e){var c;e=d(e,-1,1);c=1+(0<
e?3*e:e);return h(f,[0.3086*(1-c)+c,0.6094*(1-c),0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c)+c,0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c),0.082*(1-c)+c,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(f,e){var c,b;e=d(e,-180,180)/180*Math.PI;c=Math.cos(e);b=Math.sin(e);return h(f,[0.213+0.787*c+-0.213*b,0.715+-0.715*c+-0.715*b,0.072+-0.072*c+0.928*b,0,0,0.213+-0.213*c+0.143*b,0.715+c*(1-0.715)+0.14*b,0.072+-0.072*c+-0.283*b,0,0,0.213+-0.213*c+-0.787*b,0.715+-0.715*c+0.715*b,0.072+0.928*c+0.072*b,0,0,0,
0,0,1,0,0,0,0,0,1])},adjustColors:function(f,e,c,b){e=d(e,0,2);c=d(c,0,2);b=d(b,0,2);return h(f,[e,0,0,0,0,0,c,0,0,0,0,0,b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(f,e){e=d(e,0,1);return h(f,g([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],e))},adjustGrayscale:function(f,e){e=d(e,0,1);return h(f,g([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],e))}}});p("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas",
"tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(d,h,g,k){function f(b,a){return g.blobToImage(b).then(function(b){var c=d.create(h.getWidth(b),h.getHeight(b)),e=d.get2dContext(c);e.drawImage(b,0,0);r(b);b=e.getImageData(0,0,c.width,c.height);var f=b.data,k,m,q,z,s,C=a[0],t=a[1],p=a[2],J=a[3],D=a[4],W=a[5],v=a[6],N=a[7],G=a[8],x=a[9],w=a[10],n=a[11],E=a[12],P=a[13],T=a[14],y=a[15],Q=a[16],R=a[17],S=a[18],A=a[19];for(s=0;s<
f.length;s+=4)k=f[s],m=f[s+1],q=f[s+2],z=f[s+3],f[s]=k*C+m*t+q*p+z*J+D,f[s+1]=k*W+m*v+q*N+z*G+x,f[s+2]=k*w+m*n+q*E+z*P+T,f[s+3]=k*y+m*Q+q*R+z*S+A;e.putImageData(b,0,0);return g.canvasToBlob(c)})}function e(a,b){return g.blobToImage(a).then(function(a){var c=d.create(h.getWidth(a),h.getHeight(a)),e=d.get2dContext(c),f;e.drawImage(a,0,0);r(a);a=e.getImageData(0,0,c.width,c.height);f=e.getImageData(0,0,c.width,c.height);f=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var e,f,h,g,k,D,
m,v,l,B,x,w,n,r;h=Math.round(Math.sqrt(c.length));g=Math.floor(h/2);e=a.data;f=b.data;n=a.width;r=a.height;for(k=0;k<r;k++)for(a=0;a<n;a++){for(B=D=m=v=0;B<h;B++)for(l=0;l<h;l++)x=d(a+l-g,0,n-1),w=d(k+B-g,0,r-1),x=4*(w*n+x),w=c[B*h+l],D+=e[x]*w,m+=e[x+1]*w,v+=e[x+2]*w;x=4*(k*n+a);f[x]=d(D,0,255);f[x+1]=d(m,0,255);f[x+2]=d(v,0,255)}return b}(a,f,b);e.putImageData(f,0,0);return g.canvasToBlob(c)})}function c(a){return function(b,c){return g.blobToImage(b).then(function(b){var e=d.create(h.getWidth(b),
h.getHeight(b)),f=d.get2dContext(e),k,l=Array(256);for(k=0;k<l.length;k++)l[k]=a(k,c);f.drawImage(b,0,0);r(b);b=f.getImageData(0,0,e.width,e.height);k=b.data;var q;for(q=0;q<k.length;q+=4)k[q]=l[k[q]],k[q+1]=l[k[q+1]],k[q+2]=l[k[q+2]];f.putImageData(b,0,0);return g.canvasToBlob(e)})}}function b(a){return function(b,c){return f(b,a(k.identity(),c))}}function a(a){return function(b){return e(b,a)}}var r=g.revokeImageUrl;return{invert:function(a){return function(b){return f(b,a)}}([-1,0,0,0,255,0,-1,
0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:b(k.adjustBrightness),hue:b(k.adjustHue),saturate:b(k.adjustSaturation),contrast:b(k.adjustContrast),grayscale:b(k.adjustGrayscale),sepia:b(k.adjustSepia),colorize:function(a,b,c,d){return f(a,k.adjustColors(k.identity(),b,c,d))},sharpen:a([0,-1,0,-1,5,-1,0,-1,0]),emboss:a([-2,-1,0,-1,1,1,0,1,2]),gamma:c(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:c(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:f,convoluteFilter:e}});p("tinymce/imagetoolsplugin/UndoStack",
[],function(){return function(){function d(){return-1!=g&&g<h.length-1}var h=[],g=-1;return{data:h,add:function(d){var f;f=h.splice(++g);h.push(d);return{state:d,removed:f}},undo:function(){if(0<g)return h[--g]},redo:function(){if(d())return h[++g]},canUndo:function(){return 0<g},canRedo:d}}});p("tinymce/imagetoolsplugin/Dialog","tinymce/dom/DOMUtils tinymce/util/Tools tinymce/util/Promise tinymce/ui/Factory tinymce/ui/Form tinymce/ui/Container tinymce/imagetoolsplugin/ImagePanel tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/Filters tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/UndoStack".split(" "),
function(d,h,g,k,f,e,c,b,a,r,m){function l(a){return{blob:a,url:URL.createObjectURL(a)}}function p(a){a&&URL.revokeObjectURL(a.url)}function I(g,r,O){function u(a){var b,c,d,e;b=n.find("#w")[0];c=n.find("#h")[0];d=parseInt(b.value(),10);e=parseInt(c.value(),10);n.find("#constrain")[0].checked()&&K&&L&&d&&e&&("w"==a.control.settings.name?(e=Math.round(d*X),c.value(e)):(d=Math.round(e*Y),b.value(d)));K=d;L=e}function q(a){return Math.round(100*a)+"%"}function z(){n.find("#undo").disabled(!E.canUndo());
n.find("#redo").disabled(!E.canRedo());n.statusbar.find("#save").disabled(!E.canUndo())}function s(){n.find("#undo").disabled(!0);n.find("#redo").disabled(!0)}function C(a){a&&A.imageSrc(a.url)}function t(a){return function(){var b=h.filter(Z,function(b){return b.settings.name!=a});h.each(b,function(a){a.hide()});a.show()}}function I(a){y=l(a);C(y)}function J(a){g=l(a);C(g);a=E.add(g).removed;h.each(a,p);z()}function D(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[(y||g).blob].concat(b)).then(I)}}
function W(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[g.blob].concat(b)).then(J)}}function v(){C(g);p(y);t(P)();z()}function N(){y&&(J(y.blob),v())}function G(a){return new f({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:a})}function x(a,b){return G([{text:"Back",onclick:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:N}]).hide().on("show",
function(){s();b(g.blob).then(function(a){a=l(a);C(a);p(y);y=a})})}function w(a,b,c,d,e){function f(a){b(g.blob,a).then(function(a){a=l(a);C(a);p(y);y=a})}return G([{text:"Back",onclick:v},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){f(a.value)},minValue:d,maxValue:e,value:c,previewFilter:q},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:N}]).hide().on("show",function(){this.find("slider").value(c);s()})}var n,E=new m,P,T,y,Q,R,S,A,U,F,H,$,aa,ba,M,ca,da,ea,fa,
ga,ha,Z,K,L,X,Y;Q=G([{text:"Back",onclick:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:function(){var a=A.selection();b.crop(g.blob,a.x,a.y,a.w,a.h).then(function(a){J(a);v()})}}]).hide().on("show hide",function(a){A.toggleCropRect("show"==a.type)}).on("show",s);R=G([{text:"Back",onclick:v},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:u},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:u},{type:"checkbox",name:"constrain",text:"Constrain proportions",
checked:!0,onchange:function(a){!0===a.control.value()&&(X=L/K,Y=K/L)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(a){var c=parseInt(n.find("#w").value(),10),d=parseInt(n.find("#h").value(),10);a.preventDefault();W(b.resize,c,d)();v()}).on("show",s);S=G([{text:"Back",onclick:v},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:D(b.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:D(b.flip,"v")},{icon:"rotateleft",
tooltip:"Rotate counterclockwise",onclick:D(b.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:D(b.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:N}]).hide().on("show",s);F=x("Invert",a.invert);ea=x("Sharpen",a.sharpen);fa=x("Emboss",a.emboss);H=w("Brightness",a.brightness,0,-1,1);$=w("Hue",a.hue,180,0,360);aa=w("Saturate",a.saturate,0,-1,1);ba=w("Contrast",a.contrast,0,-1,1);M=w("Grayscale",a.grayscale,0,0,1);ca=w("Sepia",a.sepia,0,0,1);da=function(a,
b){function c(){var a,d,e;a=n.find("#r")[0].value();d=n.find("#g")[0].value();e=n.find("#b")[0].value();b(g.blob,a,d,e).then(function(a){a=l(a);C(a);p(y);y=a})}return G([{text:"Back",onclick:v},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:q},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:q},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:q},{type:"spacer",
flex:1},{text:"Apply",subtype:"primary",onclick:N}]).hide().on("show",function(){n.find("#r,#g,#b").value(1);s()})}("Colorize",a.colorize);ga=w("Gamma",a.gamma,0,-1,1);ha=w("Exposure",a.exposure,1,0,2);T=G([{text:"Back",onclick:v},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:t($)},{text:"saturate",icon:"saturate",onclick:t(aa)},{text:"sepia",icon:"sepia",onclick:t(ca)},{text:"emboss",icon:"emboss",onclick:t(fa)},{text:"exposure",icon:"exposure",onclick:t(ha)},{type:"spacer",flex:1}]).hide();
P=G([{tooltip:"Crop",icon:"crop",onclick:t(Q)},{tooltip:"Resize",icon:"resize2",onclick:t(R)},{tooltip:"Orientation",icon:"orientation",onclick:t(S)},{tooltip:"Brightness",icon:"sun",onclick:t(H)},{tooltip:"Sharpen",icon:"sharpen",onclick:t(ea)},{tooltip:"Contrast",icon:"contrast",onclick:t(ba)},{tooltip:"Color levels",icon:"drop",onclick:t(da)},{tooltip:"Gamma",icon:"gamma",onclick:t(ga)},{tooltip:"Invert",icon:"invert",onclick:t(F)}]);A=new c({flex:1,imageSrc:g.url});U=new e({layout:"flex",direction:"column",
border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){g=E.undo();C(g);z()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){g=E.redo();C(g);z()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=A.zoom();2>a&&(a+=0.1);A.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=A.zoom();0.1<a&&(a-=0.1);A.zoom(a)}}]});U=new e({type:"container",layout:"flex",direction:"row",
align:"stretch",flex:1,items:[U,A]});Z=[P,Q,R,S,T,F,H,$,aa,ba,M,ca,da,ea,fa,ga,ha];n=k.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(d.DOM.getViewPort().w,800),minHeight:Math.min(d.DOM.getViewPort().h,650),title:"Edit image",items:Z.concat([U]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){r(g.blob);n.close()}},{text:"Cancel",onclick:"close"}]});n.renderTo(document.body).reflow();n.on("close",function(){O();h.each(E.data,p);y=E=null});
E.add(g);z();A.on("load",function(){K=A.imageSize().w;L=A.imageSize().h;X=L/K;Y=K/L;n.find("#w").value(K);n.find("#h").value(L)})}return{edit:function(a){return new g(function(b,c){I(l(a),b,c)})}}});p("tinymce/imagetoolsplugin/Plugin","tinymce/PluginManager tinymce/Env tinymce/util/Promise tinymce/util/URI tinymce/util/Tools tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/Dialog".split(" "),function(d,h,g,k,f,e,c,b){d.add("imagetools",function(a){function d(b){var c,
e;c=b.style.width;e=b.style.height;if(c||e)return c.indexOf("px")==c.length-2&&e.indexOf("px")==e.length-2?{w:parseInt(c,10),h:parseInt(e,10)}:null;c=a.$(b).attr("width");e=a.$(b).attr("height");return c&&e?{w:parseInt(c,10),h:parseInt(e,10)}:null}function m(b,c){var d,e;c&&(d=b.style.width,e=b.style.height,(d||e)&&a.$(b).css({width:c.w,height:c.h}).removeAttr("data-mce-style"),d=b.width,e=b.height,(d||e)&&a.$(b).attr({width:c.w,height:c.h}))}function l(){return a.selection.getNode()}function p(b){b=
b.src;return 0===b.indexOf("data:")||0===b.indexOf("blob:")||(new k(b)).host===a.documentBaseURI.host}function I(b){return-1!==f.inArray(a.settings.imagetools_cors_hosts,(new k(b.src)).host)}function B(a){return new g(function(b){var c=new XMLHttpRequest;c.onload=function(){b(this.response)};c.open("GET",a,!0);c.responseType="blob";c.send()})}function F(b){var d=b.src;if(I(b))return B(b.src);p(b)||(b=new Image,d=a.settings.imagetools_proxy,b.src+=(-1===d.indexOf("?")?"?":"&")+"url="+encodeURIComponent(b.src));
return c.imageToBlob(b)}function H(){var b;return(b=a.editorUpload.blobCache.getByUri(l().src))?b:F(l()).then(function(b){return c.blobToBase64(b).then(function(c){var d=a.editorUpload.blobCache;c=d.create("imagetools"+J++,b,c);d.add(c);return c})})}function u(b){return c.blobToDataUri(b).then(function(c){var d,e,f,g;g=l();d="imagetools"+J++;e=a.editorUpload.blobCache;c=k.parseDataUri(c).data;f=e.create(d,b,c);e.add(f);a.undoManager.transact(function(){function b(){a.$(g).off("load",b);a.nodeChanged()}
a.$(g).on("load",b);a.$(g).attr({src:f.blobUri()}).removeAttr("data-mce-src")});return f})}function q(b){return function(){return a._scanForImages().then(H).then(b).then(u)}}function z(a){return function(){return q(function(b){var c=d(l());c&&m(l(),{w:c.h,h:c.w});return e.rotate(b.blob(),a)})()}}function s(a){return function(){return q(function(b){return e.flip(b.blob(),a)})()}}function C(){var a=l(),e=a.naturalWidth,f=a.naturalHeight;a&&F(a).then(b.edit).then(function(b){return new g(function(g){c.blobToImage(b).then(function(c){var h=
{w:c.naturalWidth,h:c.naturalHeight};(e!=h.w||f!=h.h)&&d(a)&&m(a,h);URL.revokeObjectURL(c.src);g(b)})})}).then(u,function(){})}function t(b){return a.dom.is(b,"img:not([data-mce-object],[data-mce-placeholder])")&&(p(b)||I(b)||a.settings.imagetools_proxy)}function M(){var b=a.settings.imagetools_toolbar;b||(b="rotateleft rotateright | flipv fliph | crop editimage imageoptions");a.addContextToolbar(t,b)}var J=0;h.fileApi&&(a.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:z(-90)}),a.addButton("rotateright",
{title:"Rotate clockwise",onclick:z(90)}),a.addButton("flipv",{title:"Flip vertically",onclick:s("v")}),a.addButton("fliph",{title:"Flip horizontally",onclick:s("h")}),a.addButton("editimage",{title:"Edit image",onclick:C}),a.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),M())})});(function(d){for(var h=0;h<d.length;h++){for(var g=M,k=d[h],f=k.split(/[.\/]/),e=0;e<f.length-1;++e)g[f[e]]===F&&(g[f[e]]={}),g=g[f[e]];g[f[f.length-1]]=H[k]}})("tinymce/imagetoolsplugin/Canvas tinymce/imagetoolsplugin/Mime tinymce/imagetoolsplugin/ImageSize tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/CropRect tinymce/imagetoolsplugin/ImagePanel tinymce/imagetoolsplugin/ColorMatrix tinymce/imagetoolsplugin/Filters tinymce/imagetoolsplugin/UndoStack tinymce/imagetoolsplugin/Dialog tinymce/imagetoolsplugin/Plugin".split(" "))})(this);
