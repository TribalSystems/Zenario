(function(A,E){function H(h,n){for(var e,m=[],a=0;a<h.length;++a){if(!(e=B[h[a]]))a:{e=A;for(var c=h[a].split(/[.\/]/),r=0;r<c.length;++r){if(!e[c[r]]){e=void 0;break a}e=e[c[r]]}}if(!e)throw"module definition dependecy not found: "+h[a];m.push(e)}n.apply(null,m)}function C(h,n,e){if("string"!==typeof h)throw"invalid module definition, module id must be defined and be a string";if(n===E)throw"invalid module definition, dependencies must be specified";if(e===E)throw"invalid module definition, definition function must be specified";
H(n,function(){B[h]=e.apply(null,arguments)})}var B={};C("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(h,n,e){function m(a,c){h.each(c,function(c){a=c.constructor==RegExp?a.replace(c,""):a.replace(c[0],c[1])});return a}return{filter:m,innerText:function(a){function c(a){var e=a.name,h=a;if("br"===e)b+="\n";else if(s[e]&&(b+=" "),k[e])b+=" ";else{3==a.type&&(b+=a.value);if(!a.shortEnded&&(a=a.firstChild)){do c(a);while(a=a.next)}y[e]&&h.next&&
(b+="\n","p"==e&&(b+="\n"))}}var r=new e,p=new n({},r),b="",s=r.getShortEndedElements(),k=h.makeMap("script noscript style textarea video audio iframe object"," "),y=r.getBlockElements();a=m(a,[/<!\[[^\]]+\]>/g]);c(p.parse(a));return b},trimHtml:function(a){return a=m(a,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/\x3c!--StartFragment--\x3e|\x3c!--EndFragment--\x3e/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,function(a,e,h){return e||h?"\u00a0":" "}],/<br>$/i])}}});C("tinymce/pasteplugin/Clipboard",
["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils"],function(h,n,e,m){return function(a){function c(d){var l,f=a.dom;l=a.fire("BeforePastePreProcess",{content:d});l=a.fire("PastePreProcess",l);d=l.content;l.isDefaultPrevented()||(a.hasEventListeners("PastePostProcess")&&!l.isDefaultPrevented()&&(d=f.add(a.getBody(),"div",{style:"display:none"},d),l=a.fire("PastePostProcess",{node:d}),f.remove(d),d=l.node.innerHTML),l.isDefaultPrevented()||a.insertContent(d,{merge:!1!==
a.settings.paste_merge_formats,data:{paste:!0}}))}function r(d){d=a.dom.encode(d).replace(/\r\n/g,"\n");var l=a.dom.getParent(a.selection.getStart(),a.dom.isBlock),f=a.settings.forced_root_block,g;f&&(g=a.dom.createHTML(f,a.settings.forced_root_block_attrs),g=g.substr(0,g.length-3)+">");l&&/^(PRE|DIV)$/.test(l.nodeName)||!f?d=m.filter(d,[[/\n/g,"<br>"]]):(d=m.filter(d,[[/\n\n/g,"</p>"+g],[/^(.*<\/p>)(<p>)$/,g+"$1"],[/\n/g,"<br />"]]),-1!=d.indexOf("<p>")&&(d=g+d));c(d)}function p(){function d(a){var d,
f;f=a.startContainer;d=a.getClientRects();if(d.length)return d[0];if(a.collapsed&&1==f.nodeType){for(a=f.childNodes[w.startOffset];a&&3==a.nodeType&&!a.data.length;)a=a.nextSibling;if(a&&("BR"==a.tagName&&(f=l.doc.createTextNode("\ufeff"),a.parentNode.insertBefore(f,a),a=l.createRng(),a.setStartBefore(f),a.setEndAfter(f),d=a.getClientRects(),l.remove(f)),d.length))return d[0]}}var l=a.dom,f=a.getBody(),g=a.dom.getViewPort(a.getWin()).y,b=20,q;w=a.selection.getRng();a.inline&&(q=a.selection.getScrollContainer())&&
0<q.scrollTop&&(g=q.scrollTop);if(w.getClientRects)if(b=d(w))b=g+(b.top-l.getPos(f).y);else if(b=g,g=w.startContainer)3==g.nodeType&&g.parentNode!=f&&(g=g.parentNode),1==g.nodeType&&(b=l.getPos(g,q||f).y);t=l.add(a.getBody(),"div",{id:"mcepastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: absolute; top: "+b+"px;width: 10px; height: 10px; overflow: hidden; opacity: 0"},v);(h.ie||h.gecko)&&l.setStyle(t,"left","rtl"==l.getStyle(f,"direction",!0)?65535:-65535);l.bind(t,"beforedeactivate focusin focusout",
function(a){a.stopPropagation()});t.focus();a.selection.select(t,!0)}function b(){if(t){for(var d;d=a.dom.get("mcepastebin");)a.dom.remove(d),a.dom.unbind(d);w&&a.selection.setRng(w)}t=w=null}function s(){var d="",l,f,g;l=a.dom.select("div[id=mcepastebin]");for(f=0;f<l.length;f++)g=l[f],g.firstChild&&"mcepastebin"==g.firstChild.id&&(g=g.firstChild),g=g.innerHTML,d!=v&&(d+=g);return d}function k(a){var l={};if(a){if(a.getData){var f=a.getData("Text");f&&0<f.length&&-1==f.indexOf(I)&&(l["text/plain"]=
f)}if(a.types)for(f=0;f<a.types.length;f++){var g=a.types[f],b=a.getData(g);if("text/html"==g){a:{for(var q=void 0,c=void 0,v=c=void 0,c=[25942,29554,28521,14958],q=0;q<c.length;q++)if(b.charCodeAt(q)!=c[q])break a;c="";for(q=0;q<b.length;q++)v=b.charCodeAt(q),c+=String.fromCharCode(v&255),c+=String.fromCharCode((v&65280)>>8);b=decodeURIComponent(escape(c))}q=c=q=void 0;c="\x3c!--StartFragment--\x3e";q=b.indexOf(c);-1!==q&&(b=b.substr(q+c.length));q="\x3c!--EndFragment--\x3e";q=b.indexOf(q);-1!==
q&&(b=b.substr(0,q))}l[g]=b}}return l}function y(d,b){function f(f){function g(d){b&&(a.selection.setRng(b),b=null);c('<img src="'+d.result+'">')}var v,e,s;s=!1;if(f)for(v=0;v<f.length;v++)e=f[v],/^image\/(jpeg|png|gif|bmp)$/.test(e.type)&&(s=new FileReader,s.onload=g.bind(null,s),s.readAsDataURL(e.getAsFile?e.getAsFile():e),d.preventDefault(),s=!0);return s}var g=d.clipboardData||d.dataTransfer;if(a.settings.paste_data_images&&g)return f(g.items)||f(g.files)}function F(a){a=a.clipboardData;return-1!=
navigator.userAgent.indexOf("Android")&&a&&a.items&&0===a.items.length}function G(){a.on("keydown",function(d){function c(a){(e.metaKeyPressed(a)&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&!a.isDefaultPrevented()&&b()}(e.metaKeyPressed(d)&&86==d.keyCode||d.shiftKey&&45==d.keyCode)&&!d.isDefaultPrevented()&&(D=d.shiftKey&&86==d.keyCode,D&&h.webkit&&-1!=navigator.userAgent.indexOf("Version/")||(d.stopImmediatePropagation(),x=(new Date).getTime(),h.ie&&D?(d.preventDefault(),a.fire("paste",{ieFake:!0})):
(b(),p(),a.once("keyup",c),a.once("paste",function(){a.off("keyup",c)}))))});a.on("paste",function(d){var l=(new Date).getTime(),f=k(d.clipboardData||a.getDoc().dataTransfer),l=(new Date).getTime()-l,g=1E3>(new Date).getTime()-x-l,e="text"==u.pasteFormat||D;D=!1;d.isDefaultPrevented()||F(d)?b():y(d)?b():(g||d.preventDefault(),!h.ie||g&&!d.ieFake||(p(),a.dom.bind(t,"paste",function(a){a.stopPropagation()}),a.getDoc().execCommand("Paste",!1,null),f["text/html"]=s()),setTimeout(function(){var d;"text/html"in
f&&0<f["text/html"].length?d=f["text/html"]:(d=s(),d==v&&(e=!0));d=m.trimHtml(d);t&&t.firstChild&&"mcepastebin"===t.firstChild.id&&(e=!0);b();d.length||(e=!0);e&&(d="text/plain"in f&&0<f["text/plain"].length&&-1==d.indexOf("</p>")?f["text/plain"]:m.innerText(d));d==v?g||a.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents."):e?r(d):c(d)},0))});a.on("dragstart dragend",function(a){z="dragstart"==a.type});a.on("drop",function(d){var b=n.getCaretRangeFromPoint(d.clientX,
d.clientY,a.getDoc());if(!d.isDefaultPrevented()&&!z&&!y(d,b)&&b&&!1!==a.settings.paste_filter_drop){var f=k(d.dataTransfer),g=f["mce-internal"]||f["text/html"]||f["text/plain"];g&&(d.preventDefault(),a.undoManager.transact(function(){f["mce-internal"]&&a.execCommand("Delete");a.selection.setRng(b);g=m.trimHtml(g);f["text/html"]?c(g):r(g)}))}});a.on("dragover dragend",function(d){a.settings.paste_data_images&&d.preventDefault()})}var u=this,t,w,x=0,z=!1,v="%MCEPASTEBIN%",D,I="data:text/mce-internal,";
u.pasteHtml=c;u.pasteText=r;a.on("preInit",function(){G();a.parser.addNodeFilter("img",function(d,b,f){function g(a){a.attr("data-mce-object")||c===h.transparentSrc||a.remove()}if(!a.settings.paste_data_images&&f.data&&!0===f.data.paste)for(b=d.length;b--;){var c=d[b].attributes.map.src;c&&(0===c.indexOf("webkit-fake-url")?g(d[b]):a.settings.allow_html_data_urls||0!==c.indexOf("data:")||g(d[b]))}})})}});C("tinymce/pasteplugin/WordFilter","tinymce/util/Tools tinymce/html/DomParser tinymce/html/Schema tinymce/html/Serializer tinymce/html/Node tinymce/pasteplugin/Utils".split(" "),
function(h,n,e,m,a,c){function r(a){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)||/class="OutlineElement/.test(a)||/id="?docs\-internal\-guid\-/.test(a)}function p(a){var b;a=a.replace(/^[\u00a0 ]+/,"");h.each([/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/],
function(c){if(c.test(a))return b=!0,!1});return b}function b(b){var k=b.settings;b.on("BeforePastePreProcess",function(y){function F(b){function c(a){var d="";if(3===a.type)return a.value;if(a=a.firstChild){do d+=c(a);while(a=a.next)}return d}function e(a,d){if(3===a.type&&d.test(a.value))return a.value=a.value.replace(d,""),!1;if(a=a.firstChild){do if(!e(a,d))return!1;while(a=a.next)}return!0}function d(a){if(a._listIgnore)a.remove();else if(a=a.firstChild){do d(a);while(a=a.next)}}function l(b,
c,l){var k=b._listLevel||h;k!=h&&(k<h?f&&(f=f.parent.parent):(g=f,f=null));f&&f.name==c?f.append(b):(g=g||f,f=new a(c,1),1<l&&f.attr("start",""+l),b.wrap(f));b.name="li";k>h&&g&&g.lastChild.append(f);h=k;d(b);e(b,/^\u00a0+/);e(b,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);e(b,/^\u00a0+/)}for(var f,g,h=1,s=[],k=b.firstChild;"undefined"!==typeof k&&null!==k;)if(s.push(k),k=k.walk(),null!==k)for(;"undefined"!==typeof k&&k.parent!==b;)k=k.walk();for(k=0;k<s.length;k++)if(b=s[k],"p"==b.name&&b.firstChild){var m=
c(b);if(/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(m))l(b,"ul");else if(p(m)){var m=/([0-9]+)\./.exec(m),n=1;m&&(n=parseInt(m[1],10));l(b,"ol",n)}else b._listLevel?l(b,"ul",1):f=null}else g=f,f=null}function G(c,e){var k={},d,l=b.dom.parseStyle(e);h.each(l,function(a,b){switch(b){case "mso-list":if(d=/\w+ \w+([0-9]+)/i.exec(e))c._listLevel=parseInt(d[1],10);/Ignore/i.test(a)&&c.firstChild&&(c._listIgnore=!0,c.firstChild._listIgnore=!0);break;case "horiz-align":b="text-align";break;case "vert-align":b=
"vertical-align";break;case "font-color":case "mso-foreground":b="color";break;case "mso-background":case "mso-highlight":b="background";break;case "font-weight":case "font-style":"normal"!=a&&(k[b]=a);return;case "mso-element":if(/^(comment|comment-list)$/i.test(a)){c.remove();return}}0===b.indexOf("mso-comment")?c.remove():0!==b.indexOf("mso-")&&("all"==t||w&&w[b])&&(k[b]=a)});/(bold)/i.test(k["font-weight"])&&(delete k["font-weight"],c.wrap(new a("b",1)));/(italic)/i.test(k["font-style"])&&(delete k["font-style"],
c.wrap(new a("i",1)));return(k=b.dom.serializeStyle(k,c.name))?k:null}var u=y.content,t,w,u=u.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,""),u=u.replace(/<br class="?Apple-interchange-newline"?>/gi,"");(t=k.paste_retain_style_properties)&&(w=h.makeMap(t.split(/[, ]/)));if(!1!==k.paste_enable_default_filters&&r(y.content)){y.wordContent=!0;var u=c.filter(u,[/\x3c!--[\s\S]+?--\x3e/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,
"<$1strike>"],[/&nbsp;/gi,"\u00a0"],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,b){return 0<b.length?b.replace(/./," ").slice(Math.floor(b.length/2)).split("").join("\u00a0"):""}]]),x=k.paste_word_valid_elements;x||(x="-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody");x=new e({valid_elements:x,valid_children:"-li[p]"});
h.each(x.elements,function(a){a.attributes["class"]||(a.attributes["class"]={},a.attributesOrder.push("class"));a.attributes.style||(a.attributes.style={},a.attributesOrder.push("style"))});var z=new n({},x);z.addAttributeFilter("style",function(a){for(var b=a.length,c;b--;)c=a[b],c.attr("style",G(c,c.attr("style"))),"span"==c.name&&c.parent&&!c.attributes.length&&c.unwrap()});z.addAttributeFilter("class",function(a){for(var b=a.length,c,d;b--;)c=a[b],d=c.attr("class"),/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(d)&&
c.remove(),c.attr("class",null)});z.addNodeFilter("del",function(a){for(var b=a.length;b--;)a[b].remove()});z.addNodeFilter("a",function(a){for(var b=a.length,c,d,e;b--;)c=a[b],d=c.attr("href"),e=c.attr("name"),d&&-1!=d.indexOf("#_msocom_")?c.remove():(d&&0===d.indexOf("file://")&&(d=d.split("#")[1])&&(d="#"+d),d||e?e&&!/^_?(?:toc|edn|ftn)/i.test(e)?c.unwrap():c.attr({href:d,name:e}):c.unwrap())});u=z.parse(u);!1!==k.paste_convert_word_fake_lists&&F(u);y.content=(new m({},x)).serialize(u)}})}b.isWordContent=
r;return b});C("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(h,n,e,m){return function(a){function c(b){a.on("BeforePastePreProcess",function(a){a.content=b(a.content)})}function r(b){if(!e.isWordContent(b))return b;var c=[];n.each(a.schema.getBlockElements(),function(a,b){c.push(b)});var k=RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+c.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g");b=m.filter(b,
[[k,"$1"]]);return b=m.filter(b,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}function p(b){if(e.isWordContent(b))return b;var c=a.settings.paste_webkit_styles;if(!1===a.settings.paste_remove_styles_if_webkit||"all"==c)return b;c&&(c=c.split(/[, ]/));if(c){var k=a.dom,h=a.selection.getNode();b=b.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(a,b,e,m){a=k.parseStyle(e,"span");e={};if("none"===c)return b+m;for(var n=0;n<c.length;n++){var r=a[c[n]],p=k.getStyle(h,c[n],!0);/color/.test(c[n])&&
(r=k.toHex(r),p=k.toHex(p));p!=r&&(e[c[n]]=r)}return(e=k.serializeStyle(e,"span"))?b+' style="'+e+'"'+m:b+m})}else b=b.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3");return b=b.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(a,b,c,e){return b+' style="'+c+'"'+e})}h.webkit&&c(p);h.ie&&c(r)}});C("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(h,n,e,m){var a;h.add("paste",
function(c){function h(){"text"==b.pasteFormat?(this.active(!1),b.pasteFormat="html"):(b.pasteFormat="text",this.active(!0),a||(c.windowManager.alert("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."),a=!0))}var p=this,b,s=c.settings;p.clipboard=b=new n(c);p.quirks=new m(c);p.wordFilter=new e(c);c.settings.paste_as_text&&(p.clipboard.pasteFormat="text");if(s.paste_preprocess)c.on("PastePreProcess",function(a){s.paste_preprocess.call(p,p,
a)});if(s.paste_postprocess)c.on("PastePostProcess",function(a){s.paste_postprocess.call(p,p,a)});c.addCommand("mceInsertClipboardContent",function(a,b){b.content&&p.clipboard.pasteHtml(b.content);b.text&&p.clipboard.pasteText(b.text)});if(c.paste_block_drop)c.on("dragend dragover draggesture dragdrop drop drag",function(a){a.preventDefault();a.stopPropagation()});if(!c.settings.paste_data_images)c.on("drop",function(a){var b=a.dataTransfer;b&&b.files&&0<b.files.length&&a.preventDefault()});c.addButton("pastetext",
{icon:"pastetext",tooltip:"Paste as text",onclick:h,active:"text"==p.clipboard.pasteFormat});c.addMenuItem("pastetext",{text:"Paste as text",selectable:!0,active:b.pasteFormat,onclick:h})})});(function(h){var n,e,m,a;for(n=0;n<h.length;n++){e=A;m=h[n];a=m.split(/[.\/]/);for(var c=0;c<a.length-1;++c)e[a[c]]===E&&(e[a[c]]={}),e=e[a[c]];e[a[a.length-1]]=B[m]}if(A.AMDLC_TESTS){e=A.privateModules||{};for(m in B)e[m]=B[m];for(n=0;n<h.length;n++)delete e[h[n]];A.privateModules=e}})(["tinymce/pasteplugin/Utils"])})(this);
