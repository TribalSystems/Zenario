tinymce.PluginManager.add("autolink",function(e){function m(d,c,f){function e(a,b){0>b&&(b=0);if(3==a.nodeType){var c=a.data.length;b>c&&(b=c)}return b}function g(a,c){1!=a.nodeType||a.hasChildNodes()?b.setStart(a,e(a,c)):b.setStartBefore(a)}function h(a,c){1!=a.nodeType||a.hasChildNodes()?b.setEnd(a,e(a,c)):b.setEndAfter(a)}var b,l,a,k;if("A"!=d.selection.getNode().tagName){b=d.selection.getRng(!0).cloneRange();if(5>b.startOffset){a=b.endContainer.previousSibling;if(!a){if(!b.endContainer.firstChild||
!b.endContainer.firstChild.nextSibling)return;a=b.endContainer.firstChild.nextSibling}c=a.length;g(a,c);h(a,c);if(5>b.endOffset)return;c=b.endOffset}else{a=b.endContainer;if(3!=a.nodeType&&a.firstChild){for(;3!=a.nodeType&&a.firstChild;)a=a.firstChild;3==a.nodeType&&(g(a,0),h(a,a.nodeValue.length))}c=1==b.endOffset?2:b.endOffset-1-c}l=c;do g(a,2<=c?c-2:0),h(a,1<=c?c-1:0),c-=1,k=b.toString();while(" "!=k&&""!==k&&160!=k.charCodeAt(0)&&0<=c-2&&k!=f);b.toString()==f||160==b.toString().charCodeAt(0)?
(g(a,c),h(a,l),c+=1):(0===b.startOffset?g(a,0):g(a,c),h(a,l));f=b.toString();"."==f.charAt(f.length-1)&&h(a,l-1);f=b.toString();if(a=f.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i))"www."==a[1]?a[1]="http://www.":/@$/.test(a[1])&&!/^mailto:/.test(a[1])&&(a[1]="mailto:"+a[1]),f=d.selection.getBookmark(),d.selection.setRng(b),d.execCommand("createlink",!1,a[1]+a[2]),d.selection.moveToBookmark(f),d.nodeChanged()}}var n;e.on("keydown",function(d){13==d.keyCode&&
m(e,-1,"",!1)});if(tinymce.Env.ie)e.on("focus",function(){if(!n){n=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(d){}}});else e.on("keypress",function(d){41==d.keyCode&&m(e,-1,"(",!0)}),e.on("keyup",function(d){32==d.keyCode&&m(e,0,"",!0)})});
