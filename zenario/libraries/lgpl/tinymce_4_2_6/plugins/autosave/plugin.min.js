tinymce._beforeUnloadHandler=function(){var a;tinymce.each(tinymce.editors,function(c){c.plugins.autosave&&c.plugins.autosave.storeDraft();!a&&c.isDirty()&&c.getParam("autosave_ask_before_unload",!0)&&(a=c.translate("You have unsaved changes are you sure you want to navigate away?"))});return a};
tinymce.PluginManager.add("autosave",function(a){function c(a,b){var c={s:1E3,m:6E4};a=/^(\d+)([ms]?)$/.exec(""+(a||b));return(a[2]?c[a[2]]:1)*parseInt(a,10)}function f(){var a=parseInt(e.getItem(b+"time"),10)||0;return(new Date).getTime()-a>d.autosave_retention?(g(!1),!1):!0}function g(c){e.removeItem(b+"draft");e.removeItem(b+"time");!1!==c&&a.fire("RemoveDraft")}function l(){!h()&&a.isDirty()&&(e.setItem(b+"draft",a.getContent({format:"raw",no_events:!0})),e.setItem(b+"time",(new Date).getTime()),
a.fire("StoreDraft"))}function k(){f()&&(a.setContent(e.getItem(b+"draft"),{format:"raw"}),a.fire("RestoreDraft"))}function q(){m||(setInterval(function(){a.removed||l()},d.autosave_interval),m=!0)}function n(){var b=this;b.disabled(!f());a.on("StoreDraft RestoreDraft RemoveDraft",function(){b.disabled(!f())});q()}function p(){a.undoManager.beforeChange();k();g();a.undoManager.add()}function h(b){var c=a.settings.forced_root_block;b=tinymce.trim("undefined"==typeof b?a.getBody().innerHTML:b);return""===
b||RegExp("^<"+c+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+c+">|<br>$","i").test(b)}var d=a.settings,e=tinymce.util.LocalStorage,b,m;b=d.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";b=b.replace(/\{path\}/g,document.location.pathname);b=b.replace(/\{query\}/g,document.location.search);b=b.replace(/\{id\}/g,a.id);d.autosave_interval=c(d.autosave_interval,"30s");d.autosave_retention=c(d.autosave_retention,"20m");a.addButton("restoredraft",{title:"Restore last draft",onclick:p,onPostRender:n});
a.addMenuItem("restoredraft",{text:"Restore last draft",onclick:p,onPostRender:n,context:"file"});!1!==a.settings.autosave_restore_when_empty&&(a.on("init",function(){f()&&h()&&k()}),a.on("saveContent",function(){g()}));window.onbeforeunload=tinymce._beforeUnloadHandler;this.hasDraft=f;this.storeDraft=l;this.restoreDraft=k;this.removeDraft=g;this.isEmpty=h});
