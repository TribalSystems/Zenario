(function(r,A){function I(e,d){for(var b,n=[],g=0;g<e.length;++g){if(!(b=p[e[g]]))a:{b=r;for(var m=e[g].split(/[.\/]/),q=0;q<m.length;++q){if(!b[m[q]]){b=void 0;break a}b=b[m[q]]}}if(!b)throw"module definition dependecy not found: "+e[g];n.push(b)}d.apply(null,n)}function B(e,d,b){if("string"!==typeof e)throw"invalid module definition, module id must be defined and be a string";if(d===A)throw"invalid module definition, dependencies must be specified";if(b===A)throw"invalid module definition, definition function must be specified";
I(d,function(){p[e]=b.apply(null,arguments)})}var p={};B("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(e,d){function b(c,k){if(!c[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:c.index,end:c.index+c[0].length,text:c[0],data:k}}function n(c){var k;if(3===c.nodeType)return c.data;if(x[c.nodeName]&&!u[c.nodeName])return"";k="";if(u[c.nodeName]||v[c.nodeName])k+="\n";if(c=c.firstChild){do k+=n(c);while(c=c.nextSibling)}return k}function g(c,
k,C){var a,b,D,y,d=[],e=0,f=c,l,g=0;k=k.slice(0);k.sort(function(c,k){return c.start-k.start});l=k.shift();a:for(;;){(u[f.nodeName]||v[f.nodeName])&&e++;3===f.nodeType&&(!b&&f.length+e>=l.end?(b=f,y=l.end-e):a&&d.push(f),!a&&f.length+e>l.start&&(a=f,D=l.start-e),e+=f.length);if(a&&b){if(f=C({startNode:a,startNodeIndex:D,endNode:b,endNodeIndex:y,innerNodes:d,match:l.text,matchIndex:g}),e-=b.length-y,b=a=null,d=[],l=k.shift(),g++,!l)break}else if((!x[f.nodeName]||u[f.nodeName])&&f.firstChild){f=f.firstChild;
continue}else if(f.nextSibling){f=f.nextSibling;continue}for(;;)if(f.nextSibling){f=f.nextSibling;break}else if(f.parentNode!==c)f=f.parentNode;else break a}}function m(c){function k(k,a){var b=h[a];b.stencil||(b.stencil=c(b));b=b.stencil.cloneNode(!1);b.setAttribute("data-mce-index",a);k&&b.appendChild(G.doc.createTextNode(k));return b}return function(c){var a,b,e,d=c.startNode,g=c.endNode,h=c.matchIndex;b=G.doc;if(d===g)return e=d.parentNode,0<c.startNodeIndex&&(a=b.createTextNode(d.data.substring(0,
c.startNodeIndex)),e.insertBefore(a,d)),a=k(c.match,h),e.insertBefore(a,d),c.endNodeIndex<d.length&&(b=b.createTextNode(d.data.substring(c.endNodeIndex)),e.insertBefore(b,d)),d.parentNode.removeChild(d),a;a=b.createTextNode(d.data.substring(0,c.startNodeIndex));b=b.createTextNode(g.data.substring(c.endNodeIndex));var f=k(d.data.substring(c.startNodeIndex),h);e=[];for(var l=0,n=c.innerNodes.length;l<n;++l){var m=c.innerNodes[l],q=k(m.data,h);m.parentNode.replaceChild(q,m);e.push(q)}c=k(g.data.substring(0,
c.endNodeIndex),h);e=d.parentNode;e.insertBefore(a,d);e.insertBefore(f,d);e.removeChild(d);e=g.parentNode;e.insertBefore(c,g);e.insertBefore(b,g);e.removeChild(g);return c}}function q(c){var a=e.getElementsByTagName("*"),b=[];c="number"==typeof c?""+c:null;for(var d=0;d<a.length;d++){var g=a[d],h=g.getAttribute("data-mce-index");null!==h&&h.length&&(h!==c&&null!==c||b.push(g))}return b}function H(c){for(var a=h.length;a--;)if(h[a]===c)return a;return-1}function a(c){for(var a=0,b=h.length;a<b&&!1!==
c(h[a],a);a++);return this}function r(c){var a=q(c?H(c):null);for(c=a.length;c--;){var b=a[c];b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b)}return this}function L(c){c=q(H(c));var a=d.dom.createRng();a.setStartBefore(c[0]);a.setEndAfter(c[c.length-1]);return a}var p,h=[],w,G=d.dom,u,x,v;u=d.schema.getBlockElements();x=d.schema.getWhiteSpaceElements();v=d.schema.getShortEndedElements();w=n(e);return{text:w,matches:h,each:a,filter:function(c){var b=[];a(function(a,d){c(a,d)&&
b.push(a)});h=b;return this},reset:function(){h.splice(0,h.length);r();return this},matchFromElement:function(a){return h[a.getAttribute("data-mce-index")]},elementFromMatch:function(a){return q(H(a))[0]},find:function(a,d){if(w&&a.global)for(;p=a.exec(w);)h.push(b(p,d));return this},add:function(a,b,d){h.push({start:a,end:a+b,text:w.substr(a,b),data:d});return this},wrap:function(a){h.length&&g(e,h,m(a));return this},unwrap:r,replace:function(a,b){var e=L(a);e.deleteContents();0<b.length&&e.insertNode(d.dom.doc.createTextNode(b));
return e},rangeFromMatch:L,indexOf:H}}});B("tinymce/spellcheckerplugin/Plugin","tinymce/spellcheckerplugin/DomTextMatcher tinymce/PluginManager tinymce/util/Tools tinymce/ui/Menu tinymce/dom/DOMUtils tinymce/util/XHR tinymce/util/URI tinymce/util/JSON".split(" "),function(e,d,b,n,g,m,q,r){d.add("spellchecker",function(a,d){function p(){E.textMatcher||(E.textMatcher=new e(a.getBody(),a));return E.textMatcher}function A(a){for(var b in a)return!1;return!0}function h(d,e){var f=[];b.each(J[d],function(b){f.push({text:b,
onclick:function(){a.insertContent(a.dom.encode(b));a.dom.remove(e);v()}})});f.push({text:"-"});K&&f.push({text:"Add to Dictionary",onclick:function(){c(d,e)}});f.push.apply(f,[{text:"Ignore",onclick:function(){k(d,e)}},{text:"Ignore all",onclick:function(){k(d,e,!0)}}]);l=new n({items:f,context:"contextmenu",onautohide:function(a){-1!=a.target.className.indexOf("spellchecker")&&a.preventDefault()},onhide:function(){l.remove();l=null}});l.renderTo(document.body);var h=g.DOM.getPos(a.getContentAreaContainer()),
t=a.dom.getPos(e[0]),z=a.dom.getRoot();"BODY"==z.nodeName?(t.x-=z.ownerDocument.documentElement.scrollLeft||z.scrollLeft,t.y-=z.ownerDocument.documentElement.scrollTop||z.scrollTop):(t.x-=z.scrollLeft,t.y-=z.scrollTop);h.x+=t.x;h.y+=t.y;l.moveTo(h.x,h.y+e[0].offsetHeight)}function w(){return a.getParam("spellchecker_wordchar_pattern")||RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009]+',
"g")}function G(a,c,e,f){var h={method:a},g="";"spellcheck"==a&&(h.text=c,h.lang=s.spellchecker_language);"addToDictionary"==a&&(h.word=c);b.each(h,function(a,b){g&&(g+="&");g+=b+"="+encodeURIComponent(a)});m.send({url:(new q(d)).toAbsolute(s.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:g,success:function(a){(a=r.parse(a))?a.error?f(a.error):e(a):f("Sever response wasn't proper JSON.")},error:function(a,b){f("Spellchecker request error: "+b.status)}})}function u(a,
b,c,d){(s.spellchecker_callback||G).call(E,a,b,c,d)}function x(){function b(c){a.windowManager.alert(c);a.setProgressState(!1);C()}C();f||(a.setProgressState(!0),u("spellcheck",p().text,D,b),a.focus())}function v(){a.dom.select("span.mce-spellchecker-word").length||C()}function c(b,c){a.setProgressState(!0);u("addToDictionary",b,function(){a.setProgressState(!1);a.dom.remove(c,!0);v()},function(b){a.windowManager.alert(b);a.setProgressState(!1)})}function k(c,d,e){a.selection.collapse();e?b.each(a.dom.select("span.mce-spellchecker-word"),
function(b){b.getAttribute("data-mce-word")==c&&a.dom.remove(b,!0)}):a.dom.remove(d,!0);v()}function C(){p().reset();E.textMatcher=null;f&&(f=!1,a.fire("SpellcheckEnd"))}function B(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function I(a){var b=s.spellchecker_language;a.control.items().each(function(a){a.active(a.settings.data===b)})}function D(b){var c;b.words?(K=!!b.dictionary,c=b.words):c=b;a.setProgressState(!1);A(c)?(a.windowManager.alert("No misspellings found"),f=
!1):(J=c,p().find(w()).filter(function(a){return!!c[a.text]}).wrap(function(b){return a.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":b.text})}),f=!0,a.fire("SpellcheckStart"))}var y,E=this,J,f,l,s=a.settings,K;y=function(a,c){var d=[];b.each(c,function(a){d.push({selectable:!0,text:a.name,data:a.value})});return d}("Language",b.map((s.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),
function(a){a=a.split("=");return{name:a[0],value:a[1]}}));a.on("click",function(c){var d=c.target;if("mce-spellchecker-word"==d.className){c.preventDefault();var e=B(d),f;c=[];f=b.toArray(a.getBody().getElementsByTagName("span"));if(f.length)for(var g=0;g<f.length;g++){var k=B(f[g]);null!==k&&k.length&&k===e.toString()&&c.push(f[g])}0<c.length&&(e=a.dom.createRng(),e.setStartBefore(c[0]),e.setEndAfter(c[c.length-1]),a.selection.setRng(e),h(d.getAttribute("data-mce-word"),c))}});a.addMenuItem("spellchecker",
{text:"Spellcheck",context:"tools",onclick:x,selectable:!0,onPostRender:function(){var b=this;b.active(f);a.on("SpellcheckStart SpellcheckEnd",function(){b.active(f)})}});var F={tooltip:"Spellcheck",onclick:x,onPostRender:function(){var b=this;a.on("SpellcheckStart SpellcheckEnd",function(){b.active(f)})}};1<y.length&&(F.type="splitbutton",F.menu=y,F.onshow=I,F.onselect=function(a){s.spellchecker_language=a.control.settings.data});a.addButton("spellchecker",F);a.addCommand("mceSpellCheck",x);a.on("remove",
function(){l&&(l.remove(),l=null)});a.on("change",v);this.getTextMatcher=p;this.getWordCharPattern=w;this.markErrors=D;this.getLanguage=function(){return s.spellchecker_language};s.spellchecker_language=s.spellchecker_language||s.language||"en"})});(function(e){var d,b,n,g;for(d=0;d<e.length;d++){b=r;n=e[d];g=n.split(/[.\/]/);for(var m=0;m<g.length-1;++m)b[g[m]]===A&&(b[g[m]]={}),b=b[g[m]];b[g[g.length-1]]=p[n]}if(r.AMDLC_TESTS){b=r.privateModules||{};for(n in p)b[n]=p[n];for(d=0;d<e.length;d++)delete b[e[d]];
r.privateModules=b}})(["tinymce/spellcheckerplugin/DomTextMatcher"])})(this);
