(function(E,I){function U(d,g){for(var f,k=[],h=0;h<d.length;++h){if(!(f=F[d[h]]))a:{f=E;for(var e=d[h].split(/[.\/]/),c=0;c<e.length;++c){if(!f[e[c]]){f=void 0;break a}f=f[e[c]]}}if(!f)throw"module definition dependecy not found: "+d[h];k.push(f)}g.apply(null,k)}function q(d,g,f){if("string"!==typeof d)throw"invalid module definition, module id must be defined and be a string";if(g===I)throw"invalid module definition, dependencies must be specified";if(f===I)throw"invalid module definition, definition function must be specified";
U(g,function(){F[d]=f.apply(null,arguments)})}var F={};q("tinymce/imagetoolsplugin/Canvas",[],function(){function d(d,f,k){d.width=f;d.height=k;return d}return{create:function(g,f){return d(document.createElement("canvas"),g,f)},resize:d,get2dContext:function(d){return d.getContext("2d")}}});q("tinymce/imagetoolsplugin/Mime",[],function(){return{guessMimeType:function(d){var g=document.createElement("a");g.href=d;d=g.pathname.split(".");(d=d[d.length-1])&&(d=d.toLowerCase());return{jpg:"image/jpeg",
jpeg:"image/jpeg",png:"image/png"}[d]}}});q("tinymce/imagetoolsplugin/ImageSize",[],function(){return{getWidth:function(d){return d.naturalWidth||d.width},getHeight:function(d){return d.naturalHeight||d.height}}});q("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(d,g,f,k){function h(a){return new d(function(b){function c(){a.removeEventListener("load",c);b(a)}a.complete?
b(a):a.addEventListener("load",c)})}function e(a){return h(a).then(function(a){var b;b=g.create(k.getWidth(a),k.getHeight(a));g.get2dContext(b).drawImage(a,0,0);return b})}function c(a){return new d(function(b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(){200==this.status&&b(this.response)};c.send()})}function b(a){return new d(function(b){var c,e,d,h,g;a=a.split(",");(c=/data:([^;]+)/.exec(a[0]))&&(h=c[1]);c=atob(a[1]);if(window.WebKitBlobBuilder){g=new WebKitBlobBuilder;
e=new ArrayBuffer(c.length);for(d=0;d<e.length;d++)e[d]=c.charCodeAt(d);g.append(e);b(g.getBlob(h))}else{e=new Uint8Array(c.length);for(d=0;d<e.length;d++)e[d]=c.charCodeAt(d);b(new Blob([e],{type:h}))}})}function a(a){return new d(function(b){var c=new FileReader;c.onloadend=function(){b(c.result)};c.readAsDataURL(a)})}return{blobToImage:function(a){return new d(function(b){function c(){e.removeEventListener("load",c);b(e)}var e=new Image;e.addEventListener("load",c);e.src=URL.createObjectURL(a);
e.complete&&c()})},imageToBlob:function(a){return h(a).then(function(a){var d=a.src;return 0===d.indexOf("blob:")?c(d):0===d.indexOf("data:")?b(d):e(a).then(function(a){return b(a.toDataURL(f.guessMimeType(d)))})})},uriToBlob:function(a){return 0===a.indexOf("blob:")?c(a):0===a.indexOf("data:")?b(a):null},blobToDataUri:a,blobToBase64:function(b){return a(b).then(function(a){return a.split(",")[1]})},imageToCanvas:e,canvasToBlob:function(a,c){return b(a.toDataURL(c))},revokeImageUrl:function(a){URL.revokeObjectURL(a.src)}}});
q("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(d,g,f){var k=d.revokeImageUrl;return{rotate:function(h,e){return d.blobToImage(h).then(function(c){var b=g.create(f.getWidth(c),f.getHeight(c)),a=g.get2dContext(b),p=0,m=0;e=0>e?360+e:e;90!=e&&270!=e||g.resize(b,b.height,b.width);if(90==e||180==e)p=b.width;if(270==e||180==e)m=b.height;a.translate(p,m);a.rotate(e*Math.PI/180);a.drawImage(c,
0,0);k(c);return d.canvasToBlob(b,h.type)})},flip:function(h,e){return d.blobToImage(h).then(function(c){var b=g.create(f.getWidth(c),f.getHeight(c)),a=g.get2dContext(b);"v"==e?(a.scale(1,-1),a.drawImage(c,0,-b.height)):(a.scale(-1,1),a.drawImage(c,-b.width,0));k(c);return d.canvasToBlob(b)})},crop:function(h,e,c,b,a){return d.blobToImage(h).then(function(h){var f=g.create(b,a);g.get2dContext(f).drawImage(h,-e,-c);k(h);return d.canvasToBlob(f)})},resize:function(h,e,c){return d.blobToImage(h).then(function(b){var a=
g.create(e,c);g.get2dContext(a).drawImage(b,0,0,e,c);k(b);return d.canvasToBlob(a,h.type)})}}});q("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(d,g,f,k,h){var e=0;return function(c,b,a,p){function m(a){function c(a,b){0>b.h&&(b.h=0);0>b.w&&(b.w=0);d("#"+v+"-"+a,p).css({left:b.x,top:b.y,width:b.w,height:b.h})}k.each(G,function(b){d("#"+v+"-"+b.name,p).css({left:a.w*b.xMul+a.x,top:a.h*b.yMul+
a.y})});c("top",{x:b.x,y:b.y,w:b.w,h:a.y-b.y});c("right",{x:a.x+a.w,y:a.y,w:b.w-a.x-a.w+b.x,h:a.h});c("bottom",{x:b.x,y:a.y+a.h,w:b.w,h:b.h-a.y-a.h+b.y});c("left",{x:b.x,y:a.y,w:a.x-b.x,h:a.h});c("move",a)}function l(a){c=a;m(c)}function ja(b){l({x:b.x+a.x,y:b.y+a.y,w:b.w,h:b.h})}var O,G,V,N,v="mce-crid-"+e++;G=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},
{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];N=["top","right","bottom","left"];(function(){d('<div id="'+v+'" class="mce-croprect-container" data-mce-bogus="all">').appendTo(p);k.each(N,function(a){d("#"+v,p).append('<div id="'+v+"-"+a+'"class="mce-croprect-block" style="display: none" data-mce-bogus="all">')});k.each(G,function(a){d("#"+v,p).append('<div id="'+v+"-"+a.name+'" class="mce-croprect-handle mce-croprect-handle-'+
a.name+'" style="display: none" data-mce-bogus="all">')});V=k.map(G,function(b){var e;return new g(v,{document:p.ownerDocument,handle:v+"-"+b.name,start:function(){e=c},drag:function(d){var h,l,g,m;h=e.x;l=e.y;g=e.w;m=e.h;h+=d.deltaX*b.deltaX;l+=d.deltaY*b.deltaY;g+=d.deltaX*b.deltaW;m+=d.deltaY*b.deltaH;20>g&&(g=20);20>m&&(m=20);d=c=f.clamp({x:h,y:l,w:g,h:m},a,"move"==b.name);d={x:d.x-a.x,y:d.y-a.y,w:d.w,h:d.h};O.fire("updateRect",{rect:d});ja(d)}})});m(c)})(p);return O=k.extend({toggleVisibility:function(a){var b;
b=k.map(G,function(a){return"#"+v+"-"+a.name}).concat(k.map(N,function(a){return"#"+v+"-"+a})).join(",");a?d(b,p).show():d(b,p).hide()},setClampRect:function(b){a=b;m(c)},setRect:l,getInnerRect:function(){return{x:c.x-a.x,y:c.y-a.y,w:c.w,h:c.h}},setInnerRect:ja,setViewPortRect:function(a){b=a;m(c)},destroy:function(){k.each(V,function(a){a.destroy()});V=[]}},h)}});q("tinymce/imagetoolsplugin/ImagePanel","tinymce/ui/Control tinymce/ui/DragHelper tinymce/ui/Rect tinymce/util/Tools tinymce/util/Promise tinymce/imagetoolsplugin/CropRect".split(" "),
function(d,g,f,k,h,e){function c(b){return new h(function(a){function c(){b.removeEventListener("load",c);a(b)}b.complete?a(b):b.addEventListener("load",c)})}return d.extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(b){var a=this,d=new Image;d.src=b;c(d).then(function(){var b,
c=a.state.get("viewRect");b=a.$el.find("img");b[0]?b.replaceWith(d):a.getEl().appendChild(d);b={x:0,y:0,w:d.naturalWidth,h:d.naturalHeight};a.state.set("viewRect",b);a.state.set("rect",f.inflate(b,-20,-20));c&&c.w==b.w&&c.h==b.h||a.zoomFit();a.repaintImage();a.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super()},zoomFit:function(){var b,a,c;b=this.$el.find("img");
a=this.getEl().clientWidth;c=this.getEl().clientHeight;b=Math.min((a-10)/b[0].naturalWidth,(c-10)/b[0].naturalHeight);1<=b&&(b=1);this.zoom(b)},repaintImage:function(){var b,a,c,d,e,h,g,f,k;b=this.getEl();f=this.zoom();k=this.state.get("rect");g=this.$el.find("img");e=b.offsetWidth;h=b.offsetHeight;c=g[0].naturalWidth*f;d=g[0].naturalHeight*f;b=Math.max(0,e/2-c/2);a=Math.max(0,h/2-d/2);g.css({left:b,top:a,width:c,height:d});this.cropRect&&(this.cropRect.setRect({x:k.x*f+b,y:k.y*f+a,w:k.w*f,h:k.h*
f}),this.cropRect.setClampRect({x:b,y:a,w:c,h:d}),this.cropRect.setViewPortRect({x:0,y:0,w:e,h:h}))},bindStates:function(){function b(b){a.cropRect=new e(b,a.state.get("viewRect"),a.state.get("viewRect"),a.getEl());a.cropRect.on("updateRect",function(b){b=b.rect;var c=a.zoom();b={x:Math.round(b.x/c),y:Math.round(b.y/c),w:Math.round(b.w/c),h:Math.round(b.h/c)};a.state.set("rect",b)});a.on("remove",a.cropRect.destroy)}var a=this;a.state.on("change:cropEnabled",function(b){a.cropRect.toggleVisibility(b.value);
a.repaintImage()});a.state.on("change:zoom",function(){a.repaintImage()});a.state.on("change:rect",function(c){c=c.value;a.cropRect||b(c);a.cropRect.setRect(c)})}})});q("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function d(d,e,c){d=parseFloat(d);d>c?d=c:d<e&&(d=e);return d}function g(d,e){var c,b,a,g,f=[],l=Array(10);for(c=0;5>c;c++){for(b=0;5>b;b++)f[b]=e[b+5*c];for(b=0;5>b;b++){for(a=g=0;5>a;a++)g+=d[b+5*a]*f[a];l[b+5*c]=g}}return l}function f(g,e){e=d(e,0,1);return g.map(function(c,b){c=
0===b%6?1-(1-c)*e:c*e;return d(c,0,1)})}var k=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,
0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:f,multiply:g,adjustContrast:function(f,e){var c;e=d(e,-1,1);e*=100;0>e?c=127+127*(e/100):(c=e%1,c=0===c?k[e]:k[Math.floor(e)]*(1-c)+k[Math.floor(e)+1]*c,c=127*c+127);return g(f,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(f,e){e=d(255*e,-255,255);return g(f,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(f,e){var c;e=d(e,-1,1);c=1+(0<
e?3*e:e);return g(f,[0.3086*(1-c)+c,0.6094*(1-c),0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c)+c,0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c),0.082*(1-c)+c,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(f,e){var c,b;e=d(e,-180,180)/180*Math.PI;c=Math.cos(e);b=Math.sin(e);return g(f,[0.213+0.787*c+-0.213*b,0.715+-0.715*c+-0.715*b,0.072+-0.072*c+0.928*b,0,0,0.213+-0.213*c+0.143*b,0.715+c*(1-0.715)+0.14*b,0.072+-0.072*c+-0.283*b,0,0,0.213+-0.213*c+-0.787*b,0.715+-0.715*c+0.715*b,0.072+0.928*c+0.072*b,0,0,0,
0,0,1,0,0,0,0,0,1])},adjustColors:function(f,e,c,b){e=d(e,0,2);c=d(c,0,2);b=d(b,0,2);return g(f,[e,0,0,0,0,0,c,0,0,0,0,0,b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(h,e){e=d(e,0,1);return g(h,f([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],e))},adjustGrayscale:function(h,e){e=d(e,0,1);return g(h,f([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],e))}}});q("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas",
"tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(d,g,f,k){function h(a,b){return f.blobToImage(a).then(function(a){var c=d.create(g.getWidth(a),g.getHeight(a)),e=d.get2dContext(c);e.drawImage(a,0,0);p(a);a=e.getImageData(0,0,c.width,c.height);var h=a.data,k,m,r,B,s,D=b[0],t=b[1],q=b[2],J=b[3],K=b[4],P=b[5],w=b[6],H=b[7],x=b[8],y=b[9],u=b[10],n=b[11],z=b[12],Q=b[13],S=b[14],A=b[15],E=b[16],F=b[17],R=b[18],C=b[19];for(s=0;s<
h.length;s+=4)k=h[s],m=h[s+1],r=h[s+2],B=h[s+3],h[s]=k*D+m*t+r*q+B*J+K,h[s+1]=k*P+m*w+r*H+B*x+y,h[s+2]=k*u+m*n+r*z+B*Q+S,h[s+3]=k*A+m*E+r*F+B*R+C;e.putImageData(a,0,0);return f.canvasToBlob(c)})}function e(a,b){return f.blobToImage(a).then(function(a){var c=d.create(g.getWidth(a),g.getHeight(a)),e=d.get2dContext(c),h;e.drawImage(a,0,0);p(a);a=e.getImageData(0,0,c.width,c.height);h=e.getImageData(0,0,c.width,c.height);h=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var e,g,f,h,k,m,
l,G,p,x,y,u,n,z;f=Math.round(Math.sqrt(c.length));h=Math.floor(f/2);e=a.data;g=b.data;n=a.width;z=a.height;for(k=0;k<z;k++)for(a=0;a<n;a++){for(x=m=l=G=0;x<f;x++)for(p=0;p<f;p++)y=d(a+p-h,0,n-1),u=d(k+x-h,0,z-1),y=4*(u*n+y),u=c[x*f+p],m+=e[y]*u,l+=e[y+1]*u,G+=e[y+2]*u;y=4*(k*n+a);g[y]=d(m,0,255);g[y+1]=d(l,0,255);g[y+2]=d(G,0,255)}return b}(a,h,b);e.putImageData(h,0,0);return f.canvasToBlob(c)})}function c(a){return function(b,c){return f.blobToImage(b).then(function(b){var e=d.create(g.getWidth(b),
g.getHeight(b)),h=d.get2dContext(e),k,l=Array(256);for(k=0;k<l.length;k++)l[k]=a(k,c);h.drawImage(b,0,0);p(b);b=h.getImageData(0,0,e.width,e.height);k=b.data;var r;for(r=0;r<k.length;r+=4)k[r]=l[k[r]],k[r+1]=l[k[r+1]],k[r+2]=l[k[r+2]];h.putImageData(b,0,0);return f.canvasToBlob(e)})}}function b(a){return function(b,c){return h(b,a(k.identity(),c))}}function a(a){return function(b){return e(b,a)}}var p=f.revokeImageUrl;return{invert:function(a){return function(b){return h(b,a)}}([-1,0,0,0,255,0,-1,
0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:b(k.adjustBrightness),hue:b(k.adjustHue),saturate:b(k.adjustSaturation),contrast:b(k.adjustContrast),grayscale:b(k.adjustGrayscale),sepia:b(k.adjustSepia),colorize:function(a,b,c,d){return h(a,k.adjustColors(k.identity(),b,c,d))},sharpen:a([0,-1,0,-1,5,-1,0,-1,0]),emboss:a([-2,-1,0,-1,1,1,0,1,2]),gamma:c(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:c(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:h,convoluteFilter:e}});q("tinymce/imagetoolsplugin/UndoStack",
[],function(){return function(){function d(){return-1!=f&&f<g.length-1}var g=[],f=-1;return{data:g,add:function(d){var h;h=g.splice(++f);g.push(d);return{state:d,removed:h}},undo:function(){if(0<f)return g[--f]},redo:function(){if(d())return g[++f]},canUndo:function(){return 0<f},canRedo:d}}});q("tinymce/imagetoolsplugin/Dialog","tinymce/dom/DOMUtils tinymce/util/Tools tinymce/util/Promise tinymce/ui/Factory tinymce/ui/Form tinymce/ui/Container tinymce/imagetoolsplugin/ImagePanel tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/Filters tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/UndoStack".split(" "),
function(d,g,f,k,h,e,c,b,a,p,m){function l(a){return{blob:a,url:URL.createObjectURL(a)}}function q(a){a&&URL.revokeObjectURL(a.url)}function E(f,p,N){function v(a){var b,c,d,e;b=n.find("#w")[0];c=n.find("#h")[0];d=parseInt(b.value(),10);e=parseInt(c.value(),10);n.find("#constrain")[0].checked()&&L&&M&&d&&e&&("w"==a.control.settings.name?(e=Math.round(d*W),c.value(e)):(d=Math.round(e*X),b.value(d)));L=d;M=e}function r(a){return Math.round(100*a)+"%"}function B(){n.find("#undo").disabled(!z.canUndo());
n.find("#redo").disabled(!z.canRedo());n.statusbar.find("#save").disabled(!z.canUndo())}function s(){n.find("#undo").disabled(!0);n.find("#redo").disabled(!0)}function D(a){a&&C.imageSrc(a.url)}function t(a){return function(){var b=g.grep(Y,function(b){return b.settings.name!=a});g.each(b,function(a){a.hide()});a.show()}}function F(a){A=l(a);D(A)}function J(a){f=l(a);D(f);a=z.add(f).removed;g.each(a,q);B()}function K(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[(A||f).blob].concat(b)).then(F)}}
function P(a){var b=[].slice.call(arguments,1);return function(){a.apply(this,[f.blob].concat(b)).then(J)}}function w(){D(f);q(A);t(Q)();B()}function H(){A&&(J(A.blob),w())}function x(a){return new h({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:a})}function y(a,b){return x([{text:"Back",onclick:w},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",
function(){s();b(f.blob).then(function(a){a=l(a);D(a);q(A);A=a})})}function u(a,b,c,d,e){function g(a){b(f.blob,a).then(function(a){a=l(a);D(a);q(A);A=a})}return x([{text:"Back",onclick:w},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(a){g(a.value)},minValue:d,maxValue:e,value:c,previewFilter:r},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",function(){this.find("slider").value(c);s()})}var n,z=new m,Q,S,A,O,I,R,C,T,Z,$,aa,ba,ca,ka,da,ea,fa,
ga,ha,ia,Y,L,M,W,X;O=x([{text:"Back",onclick:w},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:function(){var a=C.selection();b.crop(f.blob,a.x,a.y,a.w,a.h).then(function(a){J(a);w()})}}]).hide().on("show hide",function(a){C.toggleCropRect("show"==a.type)}).on("show",s);I=x([{text:"Back",onclick:w},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:v},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:v},{type:"checkbox",name:"constrain",text:"Constrain proportions",
checked:!0,onchange:function(a){!0===a.control.value()&&(W=M/L,X=L/M)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(a){var c=parseInt(n.find("#w").value(),10),d=parseInt(n.find("#h").value(),10);a.preventDefault();P(b.resize,c,d)();w()}).on("show",s);R=x([{text:"Back",onclick:w},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:K(b.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:K(b.flip,"v")},{icon:"rotateleft",
tooltip:"Rotate counterclockwise",onclick:K(b.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:K(b.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",s);Z=y("Invert",a.invert);fa=y("Sharpen",a.sharpen);ga=y("Emboss",a.emboss);$=u("Brightness",a.brightness,0,-1,1);aa=u("Hue",a.hue,180,0,360);ba=u("Saturate",a.saturate,0,-1,1);ca=u("Contrast",a.contrast,0,-1,1);ka=u("Grayscale",a.grayscale,0,0,1);da=u("Sepia",a.sepia,0,0,1);ea=function(a,
b){function c(){var a,d,e;a=n.find("#r")[0].value();d=n.find("#g")[0].value();e=n.find("#b")[0].value();b(f.blob,a,d,e).then(function(a){a=l(a);D(a);q(A);A=a})}return x([{text:"Back",onclick:w},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:r},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:r},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:c,previewFilter:r},{type:"spacer",
flex:1},{text:"Apply",subtype:"primary",onclick:H}]).hide().on("show",function(){n.find("#r,#g,#b").value(1);s()})}("Colorize",a.colorize);ha=u("Gamma",a.gamma,0,-1,1);ia=u("Exposure",a.exposure,1,0,2);S=x([{text:"Back",onclick:w},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:t(aa)},{text:"saturate",icon:"saturate",onclick:t(ba)},{text:"sepia",icon:"sepia",onclick:t(da)},{text:"emboss",icon:"emboss",onclick:t(ga)},{text:"exposure",icon:"exposure",onclick:t(ia)},{type:"spacer",flex:1}]).hide();
Q=x([{tooltip:"Crop",icon:"crop",onclick:t(O)},{tooltip:"Resize",icon:"resize2",onclick:t(I)},{tooltip:"Orientation",icon:"orientation",onclick:t(R)},{tooltip:"Brightness",icon:"sun",onclick:t($)},{tooltip:"Sharpen",icon:"sharpen",onclick:t(fa)},{tooltip:"Contrast",icon:"contrast",onclick:t(ca)},{tooltip:"Color levels",icon:"drop",onclick:t(ea)},{tooltip:"Gamma",icon:"gamma",onclick:t(ha)},{tooltip:"Invert",icon:"invert",onclick:t(Z)}]);C=new c({flex:1,imageSrc:f.url});T=new e({layout:"flex",direction:"column",
border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){f=z.undo();D(f);B()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){f=z.redo();D(f);B()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var a=C.zoom();2>a&&(a+=0.1);C.zoom(a)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var a=C.zoom();0.1<a&&(a-=0.1);C.zoom(a)}}]});T=new e({type:"container",layout:"flex",direction:"row",
align:"stretch",flex:1,items:[T,C]});Y=[Q,O,I,R,S,Z,$,aa,ba,ca,ka,da,ea,fa,ga,ha,ia];n=k.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(d.DOM.getViewPort().w,800),minHeight:Math.min(d.DOM.getViewPort().h,650),title:"Edit image",items:Y.concat([T]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){p(f.blob);n.close()}},{text:"Cancel",onclick:"close"}]});n.renderTo(document.body).reflow();n.on("close",function(){N();g.each(z.data,q);A=z=null});
z.add(f);B();C.on("load",function(){L=C.imageSize().w;M=C.imageSize().h;W=M/L;X=L/M;n.find("#w").value(L);n.find("#h").value(M)})}return{edit:function(a){return new f(function(b,c){E(l(a),b,c)})}}});q("tinymce/imagetoolsplugin/Plugin","tinymce/PluginManager tinymce/Env tinymce/util/Promise tinymce/util/URI tinymce/util/Tools tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/Dialog".split(" "),function(d,g,f,k,h,e,c,b){d.add("imagetools",function(a){function d(b){var c,
e;c=b.style.width;e=b.style.height;if(c||e)return c.indexOf("px")==c.length-2&&e.indexOf("px")==e.length-2?{w:parseInt(c,10),h:parseInt(e,10)}:null;c=a.$(b).attr("width");e=a.$(b).attr("height");return c&&e?{w:parseInt(c,10),h:parseInt(e,10)}:null}function m(b,c){var d,e;c&&(d=b.style.width,e=b.style.height,(d||e)&&a.$(b).css({width:c.w,height:c.h}).removeAttr("data-mce-style"),d=b.width,e=b.height,(d||e)&&a.$(b).attr({width:c.w,height:c.h}))}function l(){return a.selection.getNode()}function q(b){b=
b.src;return 0===b.indexOf("data:")||0===b.indexOf("blob:")||(new k(b)).host===a.documentBaseURI.host}function E(b){return-1!==h.inArray(a.settings.imagetools_cors_hosts,(new k(b.src)).host)}function G(a){return new f(function(b){var c=new XMLHttpRequest;c.onload=function(){b(this.response)};c.open("GET",a,!0);c.responseType="blob";c.send()})}function F(b){var d=b.src;if(E(b))return G(b.src);q(b)||(d=a.settings.imagetools_proxy,d+=(-1===d.indexOf("?")?"?":"&")+"url="+encodeURIComponent(b.src),b=new Image,
b.src=d);return c.imageToBlob(b)}function N(){var b;return(b=a.editorUpload.blobCache.getByUri(l().src))?b:F(l()).then(function(b){return c.blobToBase64(b).then(function(c){var d=a.editorUpload.blobCache;c=d.create("imagetools"+P++,b,c);d.add(c);return c})})}function v(){w=setTimeout(function(){a.editorUpload.uploadImagesAuto()},3E4)}function r(b,d){return c.blobToDataUri(b).then(function(c){var e,f,g,h;h=l();e="imagetools"+P++;f=a.editorUpload.blobCache;c=k.parseDataUri(c).data;g=f.create(e,b,c);
f.add(g);a.undoManager.transact(function(){function b(){a.$(h).off("load",b);a.nodeChanged();d?a.editorUpload.uploadImagesAuto():(clearTimeout(w),v())}a.$(h).on("load",b);a.$(h).attr({src:g.blobUri()}).removeAttr("data-mce-src")});return g})}function B(b){return function(){return a._scanForImages().then(N).then(b).then(r)}}function s(a){return function(){return B(function(b){var c=d(l());c&&m(l(),{w:c.h,h:c.w});return e.rotate(b.blob(),a)})()}}function D(a){return function(){return B(function(b){return e.flip(b.blob(),
a)})()}}function t(){var a=l(),e=a.naturalWidth,g=a.naturalHeight;a&&F(a).then(b.edit).then(function(b){return new f(function(f){c.blobToImage(b).then(function(c){var h={w:c.naturalWidth,h:c.naturalHeight};(e!=h.w||g!=h.h)&&d(a)&&m(a,h);URL.revokeObjectURL(c.src);f(b)})})}).then(function(a){r(a,!0)},function(){})}function U(){a.on("NodeChange",function(b){H&&H.src!=b.element.src&&(clearTimeout(w),a.editorUpload.uploadImagesAuto(),H=I);J(b.element)&&(H=b.element)})}function J(b){return a.dom.is(b,
"img:not([data-mce-object],[data-mce-placeholder])")&&(q(b)||E(b)||a.settings.imagetools_proxy)}function K(){var b=a.settings.imagetools_toolbar;b||(b="rotateleft rotateright | flipv fliph | crop editimage imageoptions");a.addContextToolbar(J,b)}var P=0,w,H;g.fileApi&&(a.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:s(-90)}),a.addButton("rotateright",{title:"Rotate clockwise",onclick:s(90)}),a.addButton("flipv",{title:"Flip vertically",onclick:D("v")}),a.addButton("fliph",{title:"Flip horizontally",
onclick:D("h")}),a.addButton("editimage",{title:"Edit image",onclick:t}),a.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),K(),U(),a.addCommand("mceEditImage",t))})});(function(d){var g,f,k,h;for(g=0;g<d.length;g++){f=E;k=d[g];h=k.split(/[.\/]/);for(var e=0;e<h.length-1;++e)f[h[e]]===I&&(f[h[e]]={}),f=f[h[e]];f[h[h.length-1]]=F[k]}if(E.AMDLC_TESTS){f=E.privateModules||{};for(k in F)f[k]=F[k];for(g=0;g<d.length;g++)delete f[d[g]];E.privateModules=f}})("tinymce/imagetoolsplugin/Canvas tinymce/imagetoolsplugin/Mime tinymce/imagetoolsplugin/ImageSize tinymce/imagetoolsplugin/Conversions tinymce/imagetoolsplugin/ImageTools tinymce/imagetoolsplugin/CropRect tinymce/imagetoolsplugin/ImagePanel tinymce/imagetoolsplugin/ColorMatrix tinymce/imagetoolsplugin/Filters tinymce/imagetoolsplugin/UndoStack tinymce/imagetoolsplugin/Dialog tinymce/imagetoolsplugin/Plugin".split(" "))})(this);
