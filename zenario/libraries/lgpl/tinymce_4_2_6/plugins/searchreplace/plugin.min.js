(function(){function y(h,l,n,u,e){function p(a,b){b=b||0;if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var f=a.index;if(0<b){var c=a[b];if(!c)throw"Invalid capture group";f+=a[0].indexOf(c);a[0]=c}return[f,f+a[0].length,[a[0]]]}function v(a){var b;if(3===a.nodeType)return a.data;if(c[a.nodeName]&&!d[a.nodeName])return"";b="";if(d[a.nodeName]||s[a.nodeName])b+="\n";if(a=a.firstChild){do b+=v(a);while(a=a.nextSibling)}return b}function w(a,b,f){var t,g,m,h,x=[],q=0,k=a,e=b.shift(),
l=0;a:for(;;){(d[k.nodeName]||s[k.nodeName])&&q++;3===k.nodeType&&(!g&&k.length+q>=e[1]?(g=k,h=e[1]-q):t&&x.push(k),!t&&k.length+q>e[0]&&(t=k,m=e[0]-q),q+=k.length);if(t&&g){if(k=f({startNode:t,startNodeIndex:m,endNode:g,endNodeIndex:h,innerNodes:x,match:e[2],matchIndex:l}),q-=g.length-h,g=t=null,x=[],e=b.shift(),l++,!e)break}else if((!c[k.nodeName]||d[k.nodeName])&&k.firstChild){k=k.firstChild;continue}else if(k.nextSibling){k=k.nextSibling;continue}for(;;)if(k.nextSibling){k=k.nextSibling;break}else if(k.parentNode!==
a)k=k.parentNode;else break a}}function m(a){var b;if("function"!=typeof a){var c=a.nodeType?a:f.createElement(a);b=function(a,b){var d=c.cloneNode(!1);d.setAttribute("data-mce-index",b);a&&d.appendChild(f.createTextNode(a));return d}}else b=a;return function(a){var c,d,g,e=a.startNode,h=a.endNode,k=a.matchIndex;if(e===h)return g=e.parentNode,0<a.startNodeIndex&&(c=f.createTextNode(e.data.substring(0,a.startNodeIndex)),g.insertBefore(c,e)),c=b(a.match[0],k),g.insertBefore(c,e),a.endNodeIndex<e.length&&
(d=f.createTextNode(e.data.substring(a.endNodeIndex)),g.insertBefore(d,e)),e.parentNode.removeChild(e),c;c=f.createTextNode(e.data.substring(0,a.startNodeIndex));d=f.createTextNode(h.data.substring(a.endNodeIndex));var m=b(e.data.substring(a.startNodeIndex),k);g=[];for(var s=0,l=a.innerNodes.length;s<l;++s){var r=a.innerNodes[s],n=b(r.data,k);r.parentNode.replaceChild(n,r);g.push(n)}a=b(h.data.substring(0,a.endNodeIndex),k);g=e.parentNode;g.insertBefore(c,e);g.insertBefore(m,e);g.removeChild(e);g=
h.parentNode;g.insertBefore(a,h);g.insertBefore(d,h);g.removeChild(h);return a}}var g=[],a,b=0,f,d,c,s;f=l.ownerDocument;d=e.getBlockElements();c=e.getWhiteSpaceElements();s=e.getShortEndedElements();if(a=v(l)){if(h.global)for(;e=h.exec(a);)g.push(p(e,u));else e=a.match(h),g.push(p(e,u));g.length&&(b=g.length,w(l,g,m(n)));return b}}tinymce.PluginManager.add("searchreplace",function(h){function l(){function a(){c.statusbar.find("#next").disabled(!e(g+1).length);c.statusbar.find("#prev").disabled(!e(g-
1).length)}function b(){tinymce.ui.MessageBox.alert("Could not find the specified string.",function(){c.find("#find")[0].focus()})}var f={},d;d=tinymce.trim(h.selection.getContent({format:"text"}));var c=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){h.focus();m.done()},onSubmit:function(d){var h,l,n;d.preventDefault();h=c.find("#case").checked();n=c.find("#words").checked();l=c.find("#find").value();l.length?f.text==l&&f.caseState==h&&f.wholeWord==
n?0===e(g+1).length?b():(m.next(),a()):((d=m.find(l,h,n))||b(),c.statusbar.items().slice(1).disabled(0===d),a(),f={text:l,caseState:h,wholeWord:n}):(m.done(!1),c.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){c.submit()}},{text:"Replace",disabled:!0,onclick:function(){m.replace(c.find("#replace").value())||(c.statusbar.items().slice(1).disabled(!0),g=-1,f={})}},{text:"Replace all",disabled:!0,onclick:function(){m.replace(c.find("#replace").value(),
!0,!0);c.statusbar.items().slice(1).disabled(!0);f={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){m.prev();a()}},{text:"Next",name:"next",disabled:!0,onclick:function(){m.next();a()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:d},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",
name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow()}function n(a){a=a.getAttribute("data-mce-index");return"number"==typeof a?""+a:a}function u(a){var b=a.parentNode;a.firstChild&&b.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}function e(a){var b,f=[];b=tinymce.toArray(h.getBody().getElementsByTagName("span"));if(b.length)for(var d=0;d<b.length;d++){var c=n(b[d]);null!==c&&c.length&&c===a.toString()&&f.push(b[d])}return f}function p(a){var b=g,f=h.dom;!1!==a?b++:b--;f.removeClass(e(g),
"mce-match-marker-selected");a=e(b);return a.length?(f.addClass(e(b),"mce-match-marker-selected"),h.selection.scrollIntoView(a[0]),b):-1}function v(a){var b=h.dom,f=a.parentNode;b.remove(a);b.isEmpty(f)&&b.remove(f)}function w(a){a=n(a);return null!==a&&0<a.length}var m=this,g=-1;m.init=function(a){a.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:l,separator:"before",context:"edit"});a.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:l});
a.addCommand("SearchReplace",l);a.shortcuts.add("Meta+F","",l)};m.find=function(a,b,f){a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");a=RegExp(f?"\\b"+a+"\\b":a,b?"g":"gi");f=h.dom.create("span",{"data-mce-bogus":1});f.className="mce-match-marker";b=h.getBody();m.done(!1);if(a=y(a,b,f,!1,h.schema))g=-1,g=p(!0);return a};m.next=function(){var a=p(!0);-1!==a&&(g=a)};m.prev=function(){var a=p(!1);-1!==a&&(g=a)};m.replace=function(a,b,f){var d,c,l,r,p=g;b=!1!==b;d=h.getBody();c=tinymce.grep(tinymce.toArray(d.getElementsByTagName("span")),
w);for(d=0;d<c.length;d++)if(l=n(c[d]),l=r=parseInt(l,10),f||l===g){a.length?(c[d].firstChild.nodeValue=a,u(c[d])):v(c[d]);for(;c[++d];)if(l=parseInt(n(c[d]),10),l===r)v(c[d]);else{d--;break}b&&p--}else r>g&&c[d].setAttribute("data-mce-index",r-1);h.undoManager.add();g=p;b?(a=0<e(p+1).length,m.next()):(a=0<e(p-1).length,m.prev());return!f&&a};m.done=function(a){var b,f,d,c;f=tinymce.toArray(h.getBody().getElementsByTagName("span"));for(b=0;b<f.length;b++){var e=n(f[b]);null!==e&&e.length&&(e===g.toString()&&
(d||(d=f[b].firstChild),c=f[b].firstChild),u(f[b]))}if(d&&c)return b=h.dom.createRng(),b.setStart(d,0),b.setEnd(c,c.data.length),!1!==a&&h.selection.setRng(b),b}})})();
