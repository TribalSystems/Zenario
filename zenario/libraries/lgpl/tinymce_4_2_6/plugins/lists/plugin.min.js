tinymce.PluginManager.add("lists",function(d){function k(d){return d&&/^(OL|UL|DL)$/.test(d.nodeName)}function u(l){return l&&!!d.schema.getTextBlockElements()[l.nodeName]}var v=this;d.on("init",function(){function l(a,c){var b=e.isEmpty(a);return c&&0<e.select("span[data-mce-type=bookmark]").length?!1:b}function r(a){function c(c){var h,f,m;f=a[c?"startContainer":"endContainer"];m=a[c?"startOffset":"endOffset"];1==f.nodeType&&(h=e.create("span",{"data-mce-type":"bookmark"}),f.hasChildNodes()?(m=
Math.min(m,f.childNodes.length-1),c?f.insertBefore(h,f.childNodes[m]):e.insertAfter(h,f.childNodes[m])):f.appendChild(h),f=h,m=0);b[c?"startContainer":"endContainer"]=f;b[c?"startOffset":"endOffset"]=m}var b={};c(!0);a.collapsed||c();return b}function n(a){function c(b){var c,f,m;c=m=a[b?"startContainer":"endContainer"];f=a[b?"startOffset":"endOffset"];if(c){if(1==c.nodeType){a:{f=c;for(var d=f.parentNode.firstChild,t=0;d;){if(d==f){f=t;break a}1==d.nodeType&&"bookmark"==d.getAttribute("data-mce-type")||
t++;d=d.nextSibling}f=-1}c=c.parentNode;e.remove(m)}a[b?"startContainer":"endContainer"]=c;a[b?"startOffset":"endOffset"]=f}}c(!0);c();var b=e.createRng();b.setStart(a.startContainer,a.startOffset);a.endContainer&&b.setEnd(a.endContainer,a.endOffset);q.setRng(b)}function p(a,c){var b,g,h=e.createFragment(),f,m=d.schema.getBlockElements();d.settings.forced_root_block&&(c=c||d.settings.forced_root_block);c&&(g=e.create(c),g.tagName===d.settings.forced_root_block&&e.setAttribs(g,d.settings.forced_root_block_attrs),
h.appendChild(g));if(a)for(;b=a.firstChild;){var y=b.nodeName;f||"SPAN"==y&&"bookmark"==b.getAttribute("data-mce-type")||(f=!0);m[y]?(h.appendChild(b),g=null):c?(g||(g=e.create(c),h.appendChild(g)),g.appendChild(b)):h.appendChild(b)}d.settings.forced_root_block?f||tinymce.Env.ie&&!(10<tinymce.Env.ie)||g.appendChild(e.create("br",{"data-mce-bogus":"1"})):h.appendChild(e.create("br"));return h}function s(){return tinymce.grep(q.getSelectedBlocks(),function(a){return/^(LI|DT|DD)$/.test(a.nodeName)})}
function z(a,c,b){function g(a){tinymce.each(f,function(b){a.parentNode.insertBefore(b,c.parentNode)});e.remove(a)}var h,f,d;f=e.select('span[data-mce-type="bookmark"]',a);b=b||p(c);h=e.createRng();h.setStartAfter(c);h.setEndAfter(a);h=h.extractContents();for(d=h.firstChild;d;d=d.firstChild)if("LI"==d.nodeName&&e.isEmpty(d)){e.remove(d);break}e.isEmpty(h)||e.insertAfter(h,a);e.insertAfter(b,a);l(c.parentNode)&&g(c.parentNode);e.remove(c);l(a)&&e.remove(a)}function A(a){var c,b;if((c=a.nextSibling)&&
k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.appendChild(b);e.remove(c)}if((c=a.previousSibling)&&k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.insertBefore(b,a.firstChild);e.remove(c)}}function F(a){tinymce.each(tinymce.grep(e.select("ol,ul",a)),function(a){var b,d=a.parentNode;"LI"==d.nodeName&&d.firstChild==a&&(b=d.previousSibling)&&"LI"==b.nodeName&&(b.appendChild(a),l(d)&&e.remove(d));k(d)&&(b=d.previousSibling)&&"LI"==b.nodeName&&b.appendChild(a)})}function B(a){var c=a.parentNode,
b=c.parentNode;if("DD"==a.nodeName)return e.rename(a,"DT"),!0;if(a.parentNode.firstChild==a&&a.parentNode.lastChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),l(b)&&e.remove(b),e.remove(c)):k(b)?e.remove(c,!0):(b.insertBefore(p(a),c),e.remove(c)),!0;if(a.parentNode.firstChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),a.appendChild(c),l(b)&&e.remove(b)):k(b)?b.insertBefore(a,c):(b.insertBefore(p(a),c),e.remove(a)),!0;if(a.parentNode.lastChild==a)return"LI"==b.nodeName?e.insertAfter(a,b):k(b)?
e.insertAfter(a,c):(e.insertAfter(p(a),c),e.remove(a)),!0;"LI"==b.nodeName?(c=b,b=p(a,"LI")):b=k(b)?p(a,"LI"):p(a);z(c,a,b);F(c.parentNode);return!0}function G(a){function c(b,c){var d;if(k(b)){for(;d=a.lastChild.firstChild;)c.appendChild(d);e.remove(b)}}var b,d;return"DT"==a.nodeName?(e.rename(a,"DD"),!0):(b=a.previousSibling)&&k(b)?(b.appendChild(a),!0):b&&"LI"==b.nodeName&&k(b.lastChild)?(b.lastChild.appendChild(a),c(a.lastChild,b.lastChild),!0):(b=a.nextSibling)&&k(b)?(b.insertBefore(a,b.firstChild),
!0):b&&"LI"==b.nodeName&&k(a.lastChild)?!1:(b=a.previousSibling)&&"LI"==b.nodeName?(d=e.create(a.parentNode.nodeName),b.appendChild(d),d.appendChild(a),c(a.lastChild,d),!0):!1}function C(){var a=s();if(a.length){for(var c=r(q.getRng(!0)),b=0;b<a.length&&(G(a[b])||0!==b);b++);n(c);d.nodeChanged();return!0}}function D(){var a=s();if(a.length){var c=r(q.getRng(!0)),b,e,h=d.getBody();for(b=a.length;b--;)for(var f=a[b].parentNode;f&&f!=h;){for(e=a.length;e--;)if(a[e]===f){a.splice(b,1);break}f=f.parentNode}for(b=
0;b<a.length&&(B(a[b])||0!==b);b++);n(c);d.nodeChanged();return!0}}function H(a){var c=q.getRng(!0),b=r(c),g="LI";a=a.toUpperCase();"DL"==a&&(g="DT");tinymce.each(function(){function a(b){var d;d=c[b?"startContainer":"endContainer"];b=c[b?"startOffset":"endOffset"];for(1==d.nodeType&&(d=d.childNodes[Math.min(b,d.childNodes.length-1)]||d);d.parentNode!=m&&!u(d)&&!/^(TD|TH)$/.test(d.parentNode.nodeName);)d=d.parentNode;return d}for(var b=[],m=d.getBody(),g=a(!0),t=a(),l,k=[];g&&(k.push(g),g!=t);g=g.nextSibling);
tinymce.each(k,function(a){if(u(a))b.push(a),l=null;else if(e.isBlock(a)||"BR"==a.nodeName)"BR"==a.nodeName&&e.remove(a),l=null;else{var c=a.nextSibling;tinymce.dom.BookmarkManager.isBookmarkNode(a)&&(u(c)||!c&&a.parentNode==m)?l=null:(l||(l=e.create("p"),a.parentNode.insertBefore(l,a),b.push(l)),l.appendChild(a))}});return b}(),function(b){var c,d;(d=b.previousSibling)&&k(d)&&d.nodeName==a?(c=d,b=e.rename(b,g),d.appendChild(b)):(c=e.create(a),b.parentNode.insertBefore(c,b),c.appendChild(b),e.rename(b,
g));A(c)});n(b)}function E(){var a=r(q.getRng(!0)),c=d.getBody();tinymce.each(s(),function(a){var d,e;if(l(a))B(a);else{for(d=a;d&&d!=c;d=d.parentNode)k(d)&&(e=d);z(e,a)}});n(a)}function w(a){var c=e.getParent(q.getStart(),"OL,UL,DL");if(c)if(c.nodeName==a)E(a);else{var b=r(q.getRng(!0));A(e.rename(c,a));n(b)}else H(a)}function x(a){return function(){var c=e.getParent(d.selection.getStart(),"UL,OL,DL");return c&&c.nodeName==a}}var e=d.dom,q=d.selection;v.backspaceDelete=function(a){function c(a,b){var c=
a.startContainer,e=a.startOffset,f;if(3==c.nodeType&&(b?e<c.data.length:0<e))return c;e=d.schema.getNonEmptyElements();for(f=new tinymce.dom.TreeWalker(a.startContainer);c=f[b?"next":"prev"]();)if("LI"==c.nodeName&&!c.hasChildNodes()||e[c.nodeName]||3==c.nodeType&&0<c.data.length)return c}function b(a,b){var c,d,f=a.parentNode;k(b.lastChild)&&(d=b.lastChild);(c=b.lastChild)&&"BR"==c.nodeName&&a.hasChildNodes()&&e.remove(c);l(b,!0)&&e.$(b).empty();if(!l(a,!0))for(;c=a.firstChild;)b.appendChild(c);
d&&b.appendChild(d);e.remove(a);l(f)&&e.remove(f)}if(q.isCollapsed()){var g=e.getParent(q.getStart(),"LI");if(g){var h=q.getRng(!0),f=e.getParent(c(h,a),"LI");if(f&&f!=g)return h=r(h),a?b(f,g):b(g,f),n(h),!0;if(!f&&!a&&E(g.parentNode.nodeName))return!0}}};d.on("BeforeExecCommand",function(a){var c=a.command.toLowerCase(),b;"indent"==c?C()&&(b=!0):"outdent"==c&&D()&&(b=!0);if(b)return d.fire("ExecCommand",{command:a.command}),a.preventDefault(),!0});d.addCommand("InsertUnorderedList",function(){w("UL")});
d.addCommand("InsertOrderedList",function(){w("OL")});d.addCommand("InsertDefinitionList",function(){w("DL")});d.addQueryStateHandler("InsertUnorderedList",x("UL"));d.addQueryStateHandler("InsertOrderedList",x("OL"));d.addQueryStateHandler("InsertDefinitionList",x("DL"));d.on("keydown",function(a){9==a.keyCode&&!tinymce.util.VK.metaKeyPressed(a)&&d.dom.getParent(d.selection.getStart(),"LI,DT,DD")&&(a.preventDefault(),a.shiftKey?D():C())})});d.addButton("indent",{icon:"indent",title:"Increase indent",
cmd:"Indent",onPostRender:function(){var l=this;d.on("nodechange",function(){for(var k=d.selection.getSelectedBlocks(),n=!1,p=0,s=k.length;!n&&p<s;p++)n=k[p].nodeName,n="LI"==n&&k[p].parentNode.firstChild==k[p]||"UL"==n||"OL"==n||"DD"==n;l.disabled(n)})}});d.on("keydown",function(d){d.keyCode==tinymce.util.VK.BACKSPACE?v.backspaceDelete()&&d.preventDefault():d.keyCode==tinymce.util.VK.DELETE&&v.backspaceDelete(!0)&&d.preventDefault()})});
