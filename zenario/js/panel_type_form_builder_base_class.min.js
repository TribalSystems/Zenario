zenario.lib(function(p,A,d,w,E,F,B,C,x,G,H,s,I,J,v,y,K,L,M,D,z,n,t){d=z(t.form_builder_base_class=D(t.base));d.returnShowWWTTSearch=function(){return!1};d.getOrderedPages=function(){var a=[],b;for(b in this.tuix.pages)if(n(this.tuix.pages,b)){var c=_._cl(this.tuix.pages[b]);a.push(c)}a.sort(this.sortByOrd);return a};d.getOrderedFields=function(a){var b=[];if(a)for(var c in this.tuix.pages[a].fields){if(n(this.tuix.pages[a].fields,c)){var g=_._cl(this.tuix.items[c]);b.push(g)}}else for(a=this.getOrderedPages(),
c=0;c<a.length;c++)b=b.concat(this.getOrderedFields(a[c].id));b.sort(this.sortByOrd);return b};d.getOrderedFieldValues=function(a){var b=[];if(this.tuix.items[a].lov){for(var c in this.tuix.items[a].lov)if(n(this.tuix.items[a].lov,c)){var g=_._cl(this.tuix.items[a].lov[c]);g.id=c;b.push(g)}b.sort(this.sortByOrd)}return b};d.sortByOrd=function(a,b){return a.ord<b.ord?-1:a.ord>b.ord?1:0};d.getMatchingRepeatEnd=function(a){var b=!1,c=!1,g=this.getOrderedFields(this.currentPageId),f;for(f=0;f<g.length;f++)if("repeat_end"==
g[f].type&&(b=g[f].id),g[f].id==a)c=f;else if(!1!==c&&"repeat_end"==g[f].type){b=g[f].id;break}return b};d.addFieldValue=function(a,b,c){b||(b="Untitled");"undefined"===typeof a.lov&&(a.lov={});newValueId="t"+ ++this.newItemCount;a.lov[newValueId]={label:b,ord:c||_._si(a.lov)+100}};d.saveFieldListOfValues=function(a){var b=this.getItem("field",a);$("#field_values_list div.field_value").each(function(a,g){var f=$(this).data("id");b.lov||(b.lov={});b.lov[f]&&(b.lov[f].label=$(g).find("input").val(),
b.lov[f].ord=a+1)})};d.openPageEdit=function(a,b,c){this.openEdit("page",a,b,c)};d.openFieldEdit=function(a,b,c){this.openEdit("field",a,b,c)};d.getItem=function(a,b){return"page"==a?this.tuix.pages[b]:"field"==a?this.tuix.items[b]:!1};d.loadFieldValuesListPreview=function(a){var b=this.getItem("field",a),c=this.getOrderedFieldValues(a),g=!1;"select"==b.type||"centralised_select"==b.type?(c.unshift({label:"-- Select --"}),g=this.microTemplate("zenario_organizer_admin_box_builder_select_values",c),
$("#organizer_form_field_"+a+" select").html(g)):"radios"==b.type||"centralised_radios"==b.type?(g=this.microTemplate("zenario_organizer_admin_box_builder_radio_values_preview",c),$("#organizer_form_field_values_"+a).html(g)):"checkboxes"==b.type&&(g=this.microTemplate("zenario_organizer_admin_box_builder_checkbox_values_preview",c),$("#organizer_form_field_values_"+a).html(g))};d.formatPageLabel=function(a){a&&""!==a.trim()||(a="Untitled");return a};d.moveFieldToPage=function(a,b,c,g){if(a!=b&&this.tuix.items[c].page_id==
a&&"repeat_end"!=this.tuix.items[c].type){this.tuix.pages[b].fields_reordered=!0;this.tuix.pages[a].fields_reordered=!0;var f=1,l=this.getOrderedFields(b);l.length&&(f=g?l[0].ord-1:l[l.length-1].ord+1);"repeat_start"==this.tuix.items[c].type&&(g=this.getMatchingRepeatEnd(c),this.tuix.items[g].ord=f+0.001,this.tuix.items[g].page_id=b,this.tuix.pages[b].fields[g]=1,delete this.tuix.pages[a].fields[g]);this.tuix.items[c].ord=f;this.tuix.items[c].page_id=b;this.tuix.pages[b].fields[c]=1;delete this.tuix.pages[a].fields[c];
this.changeMadeToPanel()}};d.getTUIXTabs=function(a,b,c){var g=[],f=!1,l;for(l in a.tabs)if(n(a.tabs,l)){var e=_._cl(a.tabs[l]);e.id=l;e.hidden||e.visible_if&&!x._dE(e.visible_if,this,p,c)||(f||l!=b&&a.tabs[b]||(f=!0,e._is_current_tab=!0,this.editingThingTUIXTabId=l),g.push(e))}return g};d.getTUIXTabsHTML=function(a){for(var b="",c=0;c<a.length;c++)b+=this.getTUIXTabHTML(a[c]);return b};d.getTUIXTabHTML=function(a){return this.microTemplate("zenario_organizer_admin_box_builder_tuix_tab",a)};d.getTUIXTags=
function(a,b){var c=JSON.parse(JSON.stringify(this.tuix[a])),g;for(g in c.tabs)if(n(c.tabs,g)){var f=c.tabs[g],l;for(l in f.fields)if(n(f.fields,l)){var e=f.fields[l];null!==b[l]&&b[l]!==p?e.value=b[l]:e.value!==p&&(b[l]=e.value);e.values&&"string"==typeof e.values&&(e.values=this.getTUIXFieldCustomValues(e.values))}}return c};d.getTUIXFieldsHTML=function(a,b,c,g){var f=[],l;for(l in a.tabs)if(n(a.tabs,l)){var e=a.tabs[l],h=!1,d={},r;for(r in e.fields)if(n(e.fields,r)){var k=e.fields[r],m=!1,s=1*
k.indent||0;k.hidden||k.hide_with_previous_field&&h||k.hide_with_previous_outdented_field&&d[s-1]||k.visible_if&&!x._dE(k.visible_if,this,p,c)?(h=m=!0,k.hidden=!0):h=!1;d[s]=m}}for(r in a.tabs[b].fields)if(n(a.tabs[b].fields,r)&&(k=a.tabs[b].fields[r],!k.hidden)){k.id=r;k.itemType=g;k.itemId=c.id;k.tuixTabId=b;if(k.values){var d=[],h=!1,q;for(q in k.values)n(k.values,q)&&(e=k.values[q],e.name=r,e.value=q,e.itemType=g,e.itemId=c.id,e.tuixTabId=b,k.readonly&&(e.readonly=k.readonly),e.selected="checkboxes"==
k.type?k.value&&-1!==k.value.indexOf(q):k.value==q,e.parent&&k.values[e.parent]?(h=!0,m=k.values[e.parent],m.hasChildren||(m.hasChildren=!0,m.options=[]),m.options.push(e)):d.push(e));if(h)for(h=0;h<d.length;h++)d[h].options&&d[h].options.sort(this.sortByOrd);d.sort(this.sortByOrd);k.empty_value&&d.unshift({label:k.empty_value,value:""});k.values=d}if("values_list"==k.type)k.lov=this.getOrderedFieldValues(c.id);else if("crm_values"==k.type){d={values:[]};c.crm_lov===p&&(c.crm_lov={});if("checkbox"==
c.type||"group"==c.type)for(q in m={unchecked:{label:0,ord:1},checked:{label:1,ord:2}},m)n(m,q)&&(e=m[q],e.id=q,e.value=c.crm_lov[q],d.values.push(e));else for(m=this.getOrderedFieldValues(c.id),h=0;h<m.length;h++)m[h].value=c.crm_lov[m[h].id],d.values.push(m[h]);d.values.sort(this.sortByOrd);k.crm_values=d}else if("translations"==k.type){k.translation_fields=[];var d=[],t;for(t in this.tuix.languages)n(this.tuix.languages,t)&&d.push(this.tuix.languages[t]);d.sort(this.sortByOrd);for(l in a.tabs)if(n(a.tabs,
l)){var e=a.tabs[l],u;for(u in e.fields)if(n(e.fields,u)&&(h=e.fields[u],!h.hidden&&v(h.is_phrase))){m={phrases:[]};m.label=h.label;c[u]?m.value=c[u]:(m.value="(No text is defined in the default language)",m.disabled=!0);for(h=0;h<d.length;h++)v(d[h].translate_phrases)&&m.phrases.push({field_column:u,language_id:d[h].id,language_name:d[h].english_name,phrase:c.translations[u][d[h].id],disabled:m.disabled});m.phrases.length&&k.translation_fields.push(m)}}}f.push(k)}a="";for(h=0;h<f.length;h++)a+=this.getTUIXFieldHTML(f[h]);
return a};d.getTUIXFieldHTML=function(a){return this.microTemplate("zenario_organizer_admin_box_builder_tuix_field",a)};d.saveTUIXTab=function(a,b,c){for(var d in a.tabs[b].fields)n(a.tabs[b].fields,d)&&this.saveTUIXField(a.tabs[b].fields[d],d,c)};d.saveTUIXField=function(a,b,c){var d=c[b];"values_list"==a.type?(this.saveFieldListOfValues(c.id),c._changed=!0):"translations"==a.type?($("#organizer_field_translations input.translation").map(function(a,b){var d=$(this).data("language_id"),g=$(this).data("field_column");
c.translations[g][d]=b.value}),c._changed=!0):"crm_values"==a.type?($("#organizer_field_crm_values input.crm_value_input").map(function(a,b){var d=$(this).data("id");c.crm_lov[d]=$(this).val()}),c._changed=!0):(a=this.getTUIXFieldValue(a,b),null!==a&&a!==p&&(c[b]=a));d!=c[b]&&(c._changed=!0)};d.getTUIXFieldValue=function(a,b){var c=null;"select"==a.type||"text"==a.type||"textarea"==a.type?(c=$("#field__"+b).val(),"text"!=a.type&&"textarea"!=a.type||!c||(c=c.trim())):"checkbox"==a.type?c=$("#field__"+
b).is(":checked"):"radios"==a.type?c=$('#organizer_field_details_form input[name="'+b+'"]:checked').val():"checkboxes"==a.type&&(c=[],$('#organizer_field_details_form input[name="'+b+'"]:checked').each(function(){c.push($(this).val())}));return c};d.openItemTUIXTab=function(a,b,c,d,f,l){var e=this.getTUIXModeForItemType(a),h=this.getItem(a,b),e=this.getTUIXTags(e,h,a);this.formatTUIX(a,h,c,e,f);f="";if(d&&0<d.length){for(var n=0;n<d.length;n++)f+='<p class="error">'+d[n]+"</p>";$("#organizer_field_details_form").effect({effect:"bounce",
duration:125,direction:"right",times:2,distance:5,mode:"effect"})}if(l)for(n=0;n<l.length;n++)f+='<p class="success">'+l[n]+"</p>";f+=this.getTUIXFieldsHTML(e,c,h,a);$("#organizer_field_details").html(f);this.addTUIXTabEvents(a,b,c)};d.tuixFieldDetailsChanged=function(a,b,c,d){var f=this.getTUIXModeForItemType(a),l=this.tuix[f].tabs[c].fields[d],e=this.getItem(a,b),h=this.getTUIXFieldValue(l,d);null!==h&&h!=e[d]&&this.changeMadeToPanel();v(l.format_onchange)&&(this.saveTUIXTab(this.tuix[f],c,e),this.openItemTUIXTab(a,
b,c,p,d))};d.showButtons=function(a){var b=this;b.changeMadeOnPanel?(a.html(b.microTemplate("zenario_organizer_apply_cancel_buttons",{confirm_text:"Save changes",confirm_css:"form_editor",cancel_text:"Reset"})),a.find("#organizer_applyButton").click(function(){b.saveCurrentOpenDetails()&&b.displayPageFieldOrderErrors()&&b.saveChanges()}),a.find("#organizer_cancelButton").click(function(){confirm("Are you sure you want to discard all your changes?")&&(w.onbeforeunload=!1,s._eI(),b.editingThing=!1,
b.currentPageId=!1,b.changeMadeOnPanel=!1,s._r())})):a.html("").show()};d.displayPageFieldOrderErrors=function(){return!1};d.sendAJAXRequest=function(a,b){var c=s._gK(),d="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+s.path+"&method_call=handleOrganizerPanelAJAX",f=function(){y("organizer_preloader_circle").style.display="none";C._nDS();w.onbeforeunload=!1};$.extend(c,a);y("organizer_preloader_circle").style.display="block";return B._a(A+d,c,!0,!1,!0,!0,p,p,p,p,p,f).after(function(a){f();
b!==p&&b(a)})};d.displayToastMessage=function(a,b){};d.returnShowLeftColumn=function(){return!1};d.returnPanelTitle=function(){return z(t.grid).returnPanelTitle.call(this)};d.returnMultipleSelectEnabled=function(){return!1};d.returnSearchingEnabled=function(){return!1};d.returnInspectionViewEnabled=function(){return!1}},zenarioO.panelTypes);
