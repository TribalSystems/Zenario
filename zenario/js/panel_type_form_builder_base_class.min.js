zenario.lib(function(p,A,d,w,E,F,B,C,x,G,H,s,I,J,v,y,K,L,M,D,z,n,t){d=z(t.form_builder_base_class=D(t.base));d.getOrderedPages=function(){var a=[],b;for(b in this.tuix.pages)if(n(this.tuix.pages,b)){var c=_._cl(this.tuix.pages[b]);a.push(c)}a.sort(this.sortByOrd);return a};d.getOrderedFields=function(a){var b=[];if(a)for(var c in this.tuix.pages[a].fields){if(n(this.tuix.pages[a].fields,c)){var h=_._cl(this.tuix.items[c]);b.push(h)}}else for(a=this.getOrderedPages(),c=0;c<a.length;c++)b=b.concat(this.getOrderedFields(a[c].id));
b.sort(this.sortByOrd);return b};d.getOrderedFieldValues=function(a){var b=[];if(this.tuix.items[a].lov){for(var c in this.tuix.items[a].lov)if(n(this.tuix.items[a].lov,c)){var h=_._cl(this.tuix.items[a].lov[c]);h.id=c;b.push(h)}b.sort(this.sortByOrd)}return b};d.sortByOrd=function(a,b){return a.ord<b.ord?-1:a.ord>b.ord?1:0};d.getMatchingRepeatEnd=function(a){var b=!1,c=!1,h=this.getOrderedFields(this.currentPageId),e;for(e=0;e<h.length;e++)if("repeat_end"==h[e].type&&(b=h[e].id),h[e].id==a)c=e;else if(!1!==
c&&"repeat_end"==h[e].type){b=h[e].id;break}return b};d.addFieldValue=function(a,b,c){b||(b="Untitled");"undefined"===typeof a.lov&&(a.lov={});newValueId="t"+ ++this.newItemCount;a.lov[newValueId]={label:b,ord:c||_._si(a.lov)+100}};d.saveFieldListOfValues=function(a){var b=this.getItem("field",a);$("#field_values_list div.field_value").each(function(a,h){var e=$(this).data("id");b.lov||(b.lov={});b.lov[e]&&(b.lov[e].label=$(h).find("input").val(),b.lov[e].ord=a+1)})};d.openPageEdit=function(a,b,c){this.openEdit("page",
a,b,c)};d.openFieldEdit=function(a,b,c){this.openEdit("field",a,b,c)};d.getItem=function(a,b){return"page"==a?this.tuix.pages[b]:"field"==a?this.tuix.items[b]:!1};d.loadFieldValuesListPreview=function(a){var b=this.getItem("field",a),c=this.getOrderedFieldValues(a),h=!1;"select"==b.type||"centralised_select"==b.type?(c.unshift({label:"-- Select --"}),h=this.microTemplate("zenario_organizer_admin_box_builder_select_values",c),$("#organizer_form_field_"+a+" select").html(h)):"radios"==b.type||"centralised_radios"==
b.type?(h=this.microTemplate("zenario_organizer_admin_box_builder_radio_values_preview",c),$("#organizer_form_field_values_"+a).html(h)):"checkboxes"==b.type&&(h=this.microTemplate("zenario_organizer_admin_box_builder_checkbox_values_preview",c),$("#organizer_form_field_values_"+a).html(h))};d.formatPageLabel=function(a){a&&""!==a.trim()||(a="Untitled");return a};d.moveFieldToPage=function(a,b,c,h){if(a!=b&&this.tuix.items[c].page_id==a&&"repeat_end"!=this.tuix.items[c].type){this.tuix.pages[b].fields_reordered=
!0;this.tuix.pages[a].fields_reordered=!0;var e=1,l=this.getOrderedFields(b);l.length&&(e=h?l[0].ord-1:l[l.length-1].ord+1);"repeat_start"==this.tuix.items[c].type&&(h=this.getMatchingRepeatEnd(c),this.tuix.items[h].ord=e+0.001,this.tuix.items[h].page_id=b,this.tuix.pages[b].fields[h]=1,delete this.tuix.pages[a].fields[h]);this.tuix.items[c].ord=e;this.tuix.items[c].page_id=b;this.tuix.pages[b].fields[c]=1;delete this.tuix.pages[a].fields[c];this.changeMadeToPanel()}};d.getTUIXTabs=function(a,b,c){var h=
[],e=!1,l;for(l in a.tabs)if(n(a.tabs,l)){var f=_._cl(a.tabs[l]);f.id=l;f.hidden||f.visible_if&&!x._dE(f.visible_if,this,p,c)||(e||l!=b&&a.tabs[b]||(e=!0,f._is_current_tab=!0,this.editingThingTUIXTabId=l),h.push(f))}return h};d.getTUIXTabsHTML=function(a){for(var b="",c=0;c<a.length;c++)b+=this.getTUIXTabHTML(a[c]);return b};d.getTUIXTabHTML=function(a){return this.microTemplate("zenario_organizer_admin_box_builder_tuix_tab",a)};d.getTUIXTags=function(a,b,c){a=JSON.parse(JSON.stringify(this.tuix[a]));
for(var h in a.tabs)if(n(a.tabs,h)){c=a.tabs[h];for(var e in c.fields)if(n(c.fields,e)){var l=c.fields[e];null!==b[e]&&b[e]!==p?l.value=b[e]:l.value!==p&&(b[e]=l.value);l.values&&"string"==typeof l.values&&(l.values=this.getTUIXFieldCustomValues(l.values))}}return a};d.getTUIXFieldsHTML=function(a,b,c,h){var e=[],l;for(l in a.tabs)if(n(a.tabs,l)){var f=a.tabs[l],g=!1,d={},r;for(r in f.fields)if(n(f.fields,r)){var k=f.fields[r],m=!1,s=1*k.indent||0;k.hidden||k.hide_with_previous_field&&g||k.hide_with_previous_outdented_field&&
d[s-1]||k.visible_if&&!x._dE(k.visible_if,this,p,c)?(g=m=!0,k.hidden=!0):g=!1;d[s]=m}}for(r in a.tabs[b].fields)if(n(a.tabs[b].fields,r)&&(k=a.tabs[b].fields[r],!k.hidden)){k.id=r;k.itemType=h;k.itemId=c.id;k.tuixTabId=b;if(k.values){var d=[],g=!1,q;for(q in k.values)n(k.values,q)&&(f=k.values[q],f.name=r,f.value=q,f.itemType=h,f.itemId=c.id,f.tuixTabId=b,k.readonly&&(f.readonly=k.readonly),f.selected="checkboxes"==k.type?k.value&&-1!==k.value.indexOf(q):k.value==q,f.parent&&k.values[f.parent]?(g=
!0,m=k.values[f.parent],m.hasChildren||(m.hasChildren=!0,m.options=[]),m.options.push(f)):d.push(f));if(g)for(g=0;g<d.length;g++)d[g].options&&d[g].options.sort(this.sortByOrd);d.sort(this.sortByOrd);k.empty_value&&d.unshift({label:k.empty_value,value:""});k.values=d}if("values_list"==k.type)k.lov=this.getOrderedFieldValues(c.id);else if("crm_values"==k.type){d={values:[]};c.crm_lov===p&&(c.crm_lov={});if("checkbox"==c.type||"group"==c.type)for(q in m={unchecked:{label:0,ord:1},checked:{label:1,ord:2}},
m)n(m,q)&&(f=m[q],f.id=q,f.value=c.crm_lov[q],d.values.push(f));else for(m=this.getOrderedFieldValues(c.id),g=0;g<m.length;g++)m[g].value=c.crm_lov[m[g].id],d.values.push(m[g]);d.values.sort(this.sortByOrd);k.crm_values=d}else if("translations"==k.type){k.translation_fields=[];var d=[],t;for(t in this.tuix.languages)n(this.tuix.languages,t)&&d.push(this.tuix.languages[t]);d.sort(this.sortByOrd);for(l in a.tabs)if(n(a.tabs,l)){var f=a.tabs[l],u;for(u in f.fields)if(n(f.fields,u)&&(g=f.fields[u],!g.hidden&&
v(g.is_phrase))){m={phrases:[]};m.label=g.label;c[u]?m.value=c[u]:(m.value="(No text is defined in the default language)",m.disabled=!0);for(g=0;g<d.length;g++)v(d[g].translate_phrases)&&m.phrases.push({field_column:u,language_id:d[g].id,language_name:d[g].english_name,phrase:c.translations[u][d[g].id],disabled:m.disabled});m.phrases.length&&k.translation_fields.push(m)}}}e.push(k)}a="";for(g=0;g<e.length;g++)a+=this.getTUIXFieldHTML(e[g]);return a};d.getTUIXFieldHTML=function(a){return this.microTemplate("zenario_organizer_admin_box_builder_tuix_field",
a)};d.saveTUIXTab=function(a,b,c){for(var d in a.tabs[b].fields)n(a.tabs[b].fields,d)&&this.saveTUIXField(a.tabs[b].fields[d],d,c)};d.saveTUIXField=function(a,b,c){var d=c[b];"values_list"==a.type?(this.saveFieldListOfValues(c.id),c._changed=!0):"translations"==a.type?($("#organizer_field_translations input.translation").map(function(a,b){var d=$(this).data("language_id"),h=$(this).data("field_column");c.translations[h][d]=b.value}),c._changed=!0):"crm_values"==a.type?($("#organizer_field_crm_values input.crm_value_input").map(function(a,
b){var d=$(this).data("id");c.crm_lov[d]=$(this).val()}),c._changed=!0):(a=this.getTUIXFieldValue(a,b),null!==a&&a!==p&&(c[b]=a));d!=c[b]&&(c._changed=!0)};d.getTUIXFieldValue=function(a,b){var c=null;"select"==a.type||"text"==a.type||"textarea"==a.type?(c=$("#field__"+b).val(),"text"!=a.type&&"textarea"!=a.type||!c||(c=c.trim())):"checkbox"==a.type?c=$("#field__"+b).is(":checked"):"radios"==a.type?c=$('#organizer_field_details_form input[name="'+b+'"]:checked').val():"checkboxes"==a.type&&(c=[],
$('#organizer_field_details_form input[name="'+b+'"]:checked').each(function(){c.push($(this).val())}));return c};d.openItemTUIXTab=function(a,b,c,d,e,l){var f=this.getTUIXModeForItemType(a),g=this.getItem(a,b),f=this.getTUIXTags(f,g,a);this.formatTUIX(a,g,c,f,e);e="";if(d&&0<d.length){for(var n=0;n<d.length;n++)e+='<p class="error">'+d[n]+"</p>";$("#organizer_field_details_form").effect({effect:"bounce",duration:125,direction:"right",times:2,distance:5,mode:"effect"})}if(l)for(n=0;n<l.length;n++)e+=
'<p class="success">'+l[n]+"</p>";e+=this.getTUIXFieldsHTML(f,c,g,a);$("#organizer_field_details").html(e);this.addTUIXTabEvents(a,b,c)};d.tuixFieldDetailsChanged=function(a,b,c,d){var e=this.getTUIXModeForItemType(a),l=this.tuix[e].tabs[c].fields[d],f=this.getItem(a,b),g=this.getTUIXFieldValue(l,d);null!==g&&g!=f[d]&&this.changeMadeToPanel();v(l.format_onchange)&&(this.saveTUIXTab(this.tuix[e],c,f),this.openItemTUIXTab(a,b,c,p,d))};d.showButtons=function(a){var b=this;b.changeMadeOnPanel?(a.html(b.microTemplate("zenario_organizer_apply_cancel_buttons",
{confirm_text:"Save changes",confirm_css:"form_editor",cancel_text:"Reset"})),a.find("#organizer_applyButton").click(function(){b.saveCurrentOpenDetails()&&b.displayPageFieldOrderErrors()&&b.saveChanges()}),a.find("#organizer_cancelButton").click(function(){confirm("Are you sure you want to discard all your changes?")&&(w.onbeforeunload=!1,s._eI(),b.editingThing=!1,b.currentPageId=!1,b.changeMadeOnPanel=!1,s._r())})):a.html("").show()};d.displayPageFieldOrderErrors=function(){return!1};d.sendAJAXRequest=
function(a){var b=s._gK(),c="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+s.path+"&method_call=handleOrganizerPanelAJAX",d=function(){y("organizer_preloader_circle").style.display="none";C._nDS();w.onbeforeunload=!1};$.extend(b,a);y("organizer_preloader_circle").style.display="block";return B._a(A+c,b,!0,!1,!0,!0,p,p,p,p,p,d).after(d)};d.displayToastMessage=function(a,b){};d.returnShowLeftColumn=function(){return!1};d.returnPanelTitle=function(){return z(t.grid).returnPanelTitle.call(this)};
d.returnMultipleSelectEnabled=function(){return!1};d.returnSearchingEnabled=function(){return!1};d.returnInspectionViewEnabled=function(){return!1}},zenarioO.panelTypes);
