zenario.lib(function(n,s,b,t,z,A,c,d,B,p,q,g,e,l,w,C,u,D,v,r,x,y){b=v(y);b.open=function(a,f,m,b,e,h,k,g){if(d.checkIfBoxIsOpen("AdminOrganizer"))return!1;c.disableScrolling(this.globalName);f||(f={});a=(""+a).split("//",2);a[1]&&!f.id&&(f.id=a[1]);a=a[0];this.isOpen=!0;this.callBack=e;this.passMatchedIds=g;this.createAnotherObject=h;this.getRequestKey=f;this.changed={};this.isSlidUp=this.heightBeforeSlideUp=this.hasPreviewWindow=this.lastPreviewValues=this.previewValues=this.previewSlotWidth=!1;
this.previewSlotWidthInfo="";this.previewHidden=!0;this.baseCSSClass="zenario_fbAdmin zenario_admin_box zenario_fab_"+a;k||(e=this.microTemplate(this.mtPrefix,{}),this.openBox(e));t.onbeforeunload=d.onbeforeunload;this.start(a,f,m,b);return this.cb=new c.callback};b.openBox=function(a){};b.closeBox=function(){};b.initFields=function(){this.hasPreviewWindow=!!this.pluginPreviewDetails();v(x).initFields.call(this)};b.refreshParentAndClose=function(a,f,m){d.nowDoingSomething(!1);var b={};f||(this.isOpen=
!1);if(this.callBack&&!f){var e;(e=this.getValueArrayofArrays())&&this.callBack(this.tuix.key,e)}else if(q.init&&(d.isFullOrganizerWindow||d.checkIfBoxIsOpen("og"))){a=!1;if(this.tuix.key.id!==n)a=this.tuix.key.id;else for(var h in this.tuix.key)if(r(this.tuix.key,h)){a=this.tuix.key[h];break}q.refreshToShowItem(a,m&&u.createdAnother,!f&&u.savedButNotShown)}else c.cID&&this.tuix.key.slotName?(c.refreshPluginSlot(this.tuix.key.slotName,"",d.importantGetRequests),p.init&&p.init()):!c.cID||"zenario_menu"!=
this.path&&"zenario_menu_text"!=this.path?a||f||(this.tuix.key.cID?(this.tuix.key.cID==c.cID&&this.tuix.key.cType==c.cType&&(b=d.importantGetRequests),c.goToURL(c.linkToItem(this.tuix.key.cID,this.tuix.key.cType,b))):p.init&&(b=_.clone(d.importantGetRequests),b.cVersion=c.cVersion,c.goToURL(c.linkToItem(c.cID,c.cType,b)))):(d.reloadMenuPlugins(),p.init&&p.init());a=this.tuix.popout_message;m=m&&this.createAnotherObject;f||m||(this.cb&&this.cb.call(),this.close());a&&d.showMessage(a,!0,!1);if(f){this.changed=
{};if(this.tuix.tabs)for(h in this.tuix.tabs)r(this.tuix.tabs,h)&&this.tuix.tabs[h]&&this.editModeOn(h)&&(this.tuix.tabs[h]._saved_and_continued=!0);this.sortTabs();this.draw()}else m&&($("#zenario_abtab").clearQueue(),delete this.tuix,this.open(this.createAnotherObject.path,this.getRequestKey,this.createAnotherObject.tab,this.createAnotherObject.values,n,this.createAnotherObject,!0,this.passMatchedIds))};b.close=function(a){this.callFunctionOnEditors("remove");d.nowDoingSomething(!1);this.sizing&&
clearTimeout(this.sizing);this.stopPoking();c.clearAllDelays();a||d.closeFloatingBox();this.closeBox();this.isOpen=!1;c.enableScrolling(this.globalName);delete this.cb;delete this.tuix;delete this.previewValues;delete this.lastPreviewValues;delete this.previewSlotWidth;delete this.previewSlotWidthInfo;return!1};b.closeButton=function(a){var f=d.onbeforeunload();(f===n||!a&&confirm(f))&&this.isOpen&&this.close();return!1};b.draw=function(){this.isOpen&&this.loaded&&this.tabHidden&&this.draw2()};b.draw2=
function(){if(this.tuix.tabs){g("zenario_fbAdminFloatingBox").className=this.baseCSSClass+" "+(this.tuix.css_class||"zenario_fab_default_style")+" "+(e(this.tuix.hide_tab_bar)?"zenario_admin_box_with_tabs_hidden":"zenario_admin_box_with_tabs_shown");!this.tuix.tab||this.tuix.tabs[this.tuix.tab]&&!d.hidden(this.tuix.tabs[this.tuix.tab])||(this.tuix.tab=!1);g("zenario_fabTabs").innerHTML=this.drawTabs();var a=!this.editModeOnBox(),f="",f={isReadOnly:a};this.setTitle(a);this.showCloseButton();g("zenario_fbButtons").innerHTML=
this.microTemplate(this.mtPrefix+"_buttons",f);c.addJQueryElements("#zenario_fbButtons ",!0);g("zenario_fbAdminFloatingBox").style.display="block";this.size(!0);d.nowDoingSomething(!1);a=new c.callback;f=this.drawFields(a);this.animateInTab(f,a,$("#zenario_abtab"));this.shownTab=this.tuix.tab;delete this.lastScrollTop;this.startPoking()}};b.setTitle=function(a){};b.showCloseButton=function(){this.tuix.cancel_button_message?$("#zenario_fbAdminFloatingBox .zenario_fabClose").css("display","none"):$("#zenario_fbAdminFloatingBox .zenario_fabClose").css("display",
"block")};b.returnAJAXURL=function(a){return"start"==a&&this.passMatchedIds&&q.lastRequests?s+"zenario/admin/organizer.ajax.php?_get_matched_ids=1&_fab_path="+encodeURIComponent(this.path)+"&path="+encodeURIComponent(q.path)+c.urlRequest(q.lastRequests)+c.urlRequest(this.getRequestKey):s+"zenario/admin/admin_boxes.ajax.php?path="+encodeURIComponent(this.path)+c.urlRequest(this.getRequestKey)};b.pluginPreviewDetails=function(a,f){var b,e,g,h=!0;switch(this.path){case "zenario_skin_editor":h=!1;case "plugin_css_and_framework":e=
"overrideFrameworkAndCSS";g=JSON.stringify(this.getValues1D(!1,!0,!1,!0,!0));break;case "plugin_settings":e="overrideSettings";g=JSON.stringify(this.getValues1D(!0,!1));break;default:return!1}b=_.clone(d.importantGetRequests);b.cVersion=c.cVersion;if(h){if(!c.slots||!(a=a||this.tuix&&this.tuix.key&&this.tuix.key.slotName)||!(f=f||this.tuix&&this.tuix.key&&this.tuix.key.instanceId||c.slots[a].instanceId))return!1;var k=d.getGridSlotDetails(a),l,h=k&&k.cssClass&&k.cssClass.split(" ")||[];b.slotName=
a;b.instanceId=f;b.method_call="showSingleSlot";b.fakeLayout=1;b.grid_columns=k.columns;b.grid_container=k.container;this.previewSlotWidth=k.pxWidth;this.previewSlotWidthInfo=k.widthInfo;b.grid_pxWidth=this.previewWidth?this.previewWidth:this.previewSlotWidth;b.grid_cssClass="";for(l in h)r(h,l)&&(k=h[l],"alpha"==k||"omega"==k||k.match(/^span[\d_]*$/)||(b.grid_cssClass+=k+" "))}else b._show_page_preview=1;return{url:c.linkToItem(c.cID,c.cType,b),postName:e,postValues:g}};b.addExtraAttsForTextFields=
function(a,b){this.hasPreviewWindow&&(b.onkeyup=w(b.onkeyup,"","")+" "+this.globalName+".updatePreview();")};b.fieldChange=function(a,b){this.updatePreview(750);v(x).fieldChange.call(this,a,b)};b.updatePreview=function(a){var b=this;this.hasPreviewWindow&&!this.previewHidden&&c.actAfterDelayIfNotSuperseded("fabUpdatePreview",function(){var a=b.pluginPreviewDetails();a&&b.lastPreviewValues!=a.postValues&&(b.lastPreviewValues=b.previewValues=a.postValues,b.submitPreview(a,"zenario_fabPreviewFrame"))},
a||1E3)};b.submitPreview=function(a,b){$('<form action="'+l(a.url)+'" method="post" target="'+l(b)+'"><input name="'+l(a.postName)+'" value="'+l(a.postValues)+'"/></form>').appendTo("body").hide().submit().remove()};b.showPreviewInPopoutBox=function(){var a,b,e=this,d=this.pluginPreviewDetails();d&&(this.previewValues=d.postValues,a=d.url+"&"+encodeURIComponent(d.postName)+"="+encodeURIComponent(d.postValues),a.length>=(c.browserIsIE()?2E3:4E3)&&(a="",b=function(){e.submitPreview(d,$("#cboxLoadedContent iframe").attr("name"))}),
$.colorbox({width:Math.floor(0.7*$(t).width()),height:Math.floor(0.9*$(t).height()),iframe:!0,preloading:!1,open:!0,title:this.previewSlotWidthInfo||u.preview,className:"zenario_plugin_preview_popout_box",href:a,onComplete:b}),$("#colorbox,#cboxOverlay,#cboxWrapper").css("z-index","333000"))};b.editModeOn=function(a){if(!this.tuix||!this.tuix.tabs)return!1;a||(a=this.tuix.tab);return this.tuix.tabs[a].edit_mode?this.tuix.tabs[a].edit_mode.on=e(this.tuix.tabs[a].edit_mode.enabled)&&(e(this.tuix.tabs[a].edit_mode.on)||
this.editModeAlwaysOn(a)):!1};b.editModeAlwaysOn=function(a){return this.tuix.tabs[a].edit_mode.always_on===n||e(this.tuix.tabs[a].edit_mode.always_on)||this.savedAndContinued(a)};b.editCancelEnabled=function(a){return this.tuix.tabs[a].edit_mode&&e(this.tuix.tabs[a].edit_mode.enabled)&&!this.editModeAlwaysOn(a)};b.revertEnabled=function(a){return this.tuix.tabs[a].edit_mode&&e(this.tuix.tabs[a].edit_mode.enabled)&&this.editModeAlwaysOn(a)&&!this.savedAndContinued(a)&&(this.tuix.tabs[a].edit_mode.enable_revert===
n&&this.tuix.key&&this.tuix.key.id||e(this.tuix.tabs[a].edit_mode.enable_revert))};b.savedAndContinued=function(a){return!1};b.editModeOnBox=function(){if(this.tuix&&this.tuix.tabs&&this.sortedTabs)for(var a in this.sortedTabs)if(r(this.sortedTabs,a)&&this.editModeOn(this.sortedTabs[a]))return!0;return!1};b.setData=function(a){this.setDataDiff(a)};b.sendStateToServer=function(){return this.sendStateToServerDiff()};b.save=function(a,b,d){var g=this,l;this.loaded&&(l=this.getURL("save"))&&!this.saving&&
(this.differentTab=this.saving=!0,this.loaded=!1,this.hideTab(!0),this.checkValues(),a={_save:!0,_confirm:a?1:"",_save_and_continue:b,_box:this.sendStateToServer()},e(this.tuix.download)||this.tuix.confirm&&e(this.tuix.confirm.download)?this.save2(c.nonAsyncAJAX(this.getURL("save"),c.urlRequest(a)),b,d):this.retryAJAX(l,a,function(a){g.save2(a,b,d)},"saving"))};b.save2=function(a,b,c){delete this.saving;"\x3c!--Valid--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),"\x3c!--Confirm--\x3e"==(""+a).substr(0,
14)?(a=a.substr(14),this.load(a),this.sortTabs(),this.draw(),this.showConfirm(b,c)):"\x3c!--Download--\x3e"==(""+a).substr(0,15)?(g("zenario_iframe_form").action=this.getURL("download"),g("zenario_iframe_form").innerHTML='<input type="hidden" name="_download" value="1"/><input type="hidden" name="_box" value="'+l(this.sendStateToServer())+'"/>',g("zenario_iframe_form").submit(),b&&(a=a.substr(15),this.load(a)),this.refreshParentAndClose(!0,b,c)):"\x3c!--Saved--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),
this.load(a),this.refreshParentAndClose(!1,b,c)):(this.close(),d.showMessage(a,!0,"error"))):(this.load(a),this.sortTabs(),this.switchToATabWithErrors(),this.draw())};b.showConfirm=function(a,b){if(this.tuix&&this.tuix.confirm&&e(this.tuix.confirm.show)){var c=this.tuix.confirm.message;e(this.tuix.confirm.html)||(c=l(c,!0));var g='<input type="button" class="submit_selected" value="'+this.tuix.confirm.button_message+'" onclick="'+this.globalName+".save(true, "+e(a)+", "+e(b)+');"/><input type="button" class="submit" value="'+
this.tuix.confirm.cancel_button_message+'" onclick="zenarioA.closeFloatingBox();"/>';d.floatingBox(c,g,w(this.tuix.confirm.message_type,"none"))}};b.stopPoking=function(){this.poking&&clearInterval(this.poking);this.poking=!1};b.startPoking=function(){this.poking||(this.poking=setInterval(this.poke,12E4))};b.poke=function(){c.ajax(s+"zenario/admin/quick_ajax.php?keep_session_alive=1")}},zenarioAF,zenarioABToolkit);
