zenario.lib(function(p,u,h,s,w,x,q,m,y,z,n,A,B,C,D,E,F,v,t,G,r){h=t(r.schematic_builder=v(r.base));"undefined"!==typeof fabric&&(fabric.Rect.prototype.resizeToScale=function(){this.width*=this.scaleX;this.height*=this.scaleY;this.scaleY=this.scaleX=1});h.init=function(){this.canvas=!1;this.nextUniqueId=0;this.lastSelectedObjectId=!1;this.assetBlockOpacity=0.8;this.changingForm=!1;this.layers={background:{ord:1,groups:{images:{ord:1,objects:[]}}},foreground:{ord:2,groups:{asset_block:{ord:1,objects:[]},
hotspot:{ord:2,objects:[]}}}}};h.showPanel=function(b,d,a){b.html("").hide();var c=this;b={controls:this.getLayerControlsMergeFields("start_layer"),width:this.tuix.canvas.width,height:this.tuix.canvas.height};b=m.microTemplate("zenario_organizer_schematic_builder",b);d.html(b).show();this.initLayerControls("start_layer");a.html("").show();this.canvas=new fabric.Canvas("organizer_schematic_builder_canvas",{width:this.tuix.canvas.width,height:this.tuix.canvas.height});this.layer="background";this.tuix.schematic.json&&
this.canvas.loadFromJSON(this.tuix.schematic.json,function(){c.layer="start_layer";for(var a=c.canvas.getObjects(),b=0;b<a.length;b++){c.putObjectIntoLayersStructure(a[b]);if("group"==a[b].get("type")){for(var d=a[b].getObjects(),g=0;g<d.length;g++)if("path"==d[g].type){d[g].setFill("");break}else d[g].custom&&"label"==d[g].custom.type&&(d[g].backgroundColor="rgba(255,255,255,0.8)");"hotspot"==a[b].custom.group&&(a[b].hasControls=!1)}a[b].setControlVisible("mtr",!1)}c.setObjectOrder();c.changeCanvasLayer(c.layer)});
this.canvas.on("object:selected",function(a){a=a.target;c.updateLayerControls(c.layer,a);"foreground"==c.layer&&c.setForegroundItemControls(a)});this.canvas.on("selection:cleared",function(){c.updateLayerControls(c.layer)});this.canvas.on("object:scaling",function(a){a.target.resizeToScale&&a.target.resizeToScale()});this.canvas.on("object:modified",function(a){c.changeMadeToPanel()})};h.changeMadeToPanel=function(){this.changingForm||(this.changingForm=!0,s.onbeforeunload=function(){return"You are currently editing this schematic. If you leave now you will lose any unsaved changes"},
n.disableInteraction("Please either save your changes, or click Reset to discard them, before exiting the form editor."),n.setButtons())};h.putObjectIntoLayersStructure=function(b){b.custom&&b.custom.layer&&b.custom.group&&b.custom.id&&this.layers[b.custom.layer].groups[b.custom.group].objects.push(b.custom.id)};h.removeObjectFromLayersStructure=function(b,d){if(d)for(var a in this.layers[d].groups)this.layers[d].groups[a].objects=[];else b.custom&&b.custom.layer&&b.custom.group&&b.custom.id&&(a=
$.inArray(b.custom.id,this.layers[b.custom.layer].groups[b.custom.group].objects),-1!==a&&this.layers[b.custom.layer].groups[b.custom.group].objects.splice(a,1))};h.moveObjectInLayersStructure=function(b,d){if(b.custom&&b.custom.layer&&b.custom.group&&b.custom.id){var a=this.layers[b.custom.layer].groups[b.custom.group],c=$.inArray(b.custom.id,a.objects);if(-1!==c){var e=!1;"first"==d?e=a.objects.length-1:"last"==d?e=0:"up"==d?e=c==a.objects.length-1?a.objects.length-1:c+1:"down"==d&&(e=0==c?0:c-
1);!1!==e&&a.objects.splice(e,0,a.objects.splice(c,1)[0])}}};h.setObjectOrder=function(){for(var b={},d=this.canvas.getObjects(),a=0;a<d.length;++a)d[a].custom.id&&(b[d[a].custom.id]=d[a]);var d=0,c=_.values(this.layers);c.sort(this.sortByOrd);for(a=0;a<c.length;++a){var e=_.values(c[a].groups);e.sort(this.sortByOrd);for(var f=0;f<e.length;++f)for(var k=e[f].objects,g=0;g<k.length;++g)b[k[g]].moveTo(d++)}};h.sortByOrd=function(b,d){if(b.ord&&d.ord){if(b.ord<d.ord)return-1;if(b.ord>d.ord)return 1}return 0};
h.showButtons=function(b){var d=this;this.changingForm?(b.html(this.microTemplate("zenario_organizer_apply_cancel_buttons",{confirm_text:"Save changes",cancel_text:"Reset"})),b.find("#organizer_applyButton").click(function(){var a=!1;if("background"==d.layer)a=!0,d.changeCanvasLayer("foreground",!0);else{var c=d.canvas.getActiveObject();c&&d.saveObjectFields(c)}var c=JSON.stringify(d.canvas.toJSON(["custom"])),b=n.getKey();b.action="save_schematic";b.json=c;m.nowDoingSomething("saving",!0);q.ajax(d.getAJAXURL(),
b).after(function(c){a&&d.changeCanvasLayer("background",!0);s.onbeforeunload=!1;n.enableInteraction();d.changingForm=!1;n.setButtons();m.nowDoingSomething();m.toast({message_type:"success",message:"Your changes have been saved!"})})}),b.find("#organizer_cancelButton").click(function(){confirm("Are you sure you want to discard all your unsaved changes?")&&(s.onbeforeunload=!1,n.enableInteraction(),d.changingForm=!1,n.reload())})):b.html("").show()};h.addImageToCanvas=function(b,d,a,c,e){var f=this;
b&&d&&fabric.Image.fromURL(b,function(k){var g={};e?g.cache_id=d:g.image_id=d;a&&(g.layer=a,g.group=c?c:"images");k.src=b;f.addToCanvas(k,g)})};h.addToCanvas=function(b,d){if(d){b.custom||(b.custom={});for(var a in d)b.custom[a]=d[a];b.custom.id="t"+ ++this.nextUniqueId;b.custom.tuix||(b.custom.tuix={})}b.setControlVisible("mtr",!1);this.canvas.add(b);this.putObjectIntoLayersStructure(b);this.setObjectOrder()};h.clearCanvasLayer=function(b){if(b){for(var d=this.canvas.getObjects(),a=[],c=0;c<d.length;c++)d[c].custom.layer==
b&&a.push(d[c]);for(c=0;c<a.length;c++)this.canvas.remove(a[c]);this.canvas.renderAll()}};h.changeCanvasLayer=function(b,d){b&&(this.layer=b,this.canvas.getObjects().forEach(function(a,c){"background"==b?"foreground"==a.custom.layer?a.visible=!1:"background"==a.custom.layer&&(a.selectable=!0):"foreground"==b?"foreground"==a.custom.layer?(a.visible=!0,a.selectable=!0):"background"==a.custom.layer&&(a.selectable=!1):(a.visible=!0,a.selectable=!1)}),d||(this.updateLayerControls(b),this.canvas.deactivateAll().renderAll()))};
h.uploadImagesCallback=function(b){b&&(this.changeMadeToPanel(),this.addImageToCanvas(b[0].link,b[0].id,"background",!1,!0))};h.saveObjectFields=function(b){var d=$("#organizer_schematic_builder__foreground_item_custom_fields").serializeArray();if(d){b.custom.tuix||(b.custom.tuix={});for(var a=0;a<d.length;a++)b.custom.tuix[d[a].name]=d[a].value}};h.updateLayerControls=function(b,d){if(this.lastSelectedObjectId){for(var a=!1,c=this.canvas.getObjects(),e=0;e<c.length;e++)if(c[e].custom.id==this.lastSelectedObjectId){a=
c[e];break}a&&this.saveObjectFields(a)}this.lastSelectedObjectId=d&&d.custom?d.custom.id:!1;a=this.getLayerControlsMergeFields(b,d);a=m.microTemplate("zenario_organizer_schematic_builder_controls",a);$("#organizer_schematic_builder .controls").html(a);this.initLayerControls(b,d)};h.getLayerControlsMergeFields=function(b,d){var a={layer:b,itemSelected:!1,customFields:!1,is_system_schematic:this.tuix.schematic.is_system};d&&(d.custom&&d.custom.layer==b?(a.itemSelected=!0,"background"==d.custom.layer&&
(a.opacity=d.opacity!==p?(100*d.opacity).toFixed():100)):d._objects&&2==d._objects.length&&(a.multiItemSelected=!0));return a};h.setForegroundItemControls=function(b){var d=this;if(b&&b.custom&&"foreground"==b.custom.layer){var a={};if("hotspot"==b.custom.group){a.foreground_type="hotspot";a.foreground_item_controls_title="Editing a hotspot";this.tuix.hotspot_properties={};this.tuix.hotspot_properties.field_id={ord:1,label:"Field:",type:"select",values:{},empty_value:" -- Select --"};this.tuix.hotspot_properties.latest_status_position=
{ord:2,label:"Show field status:",type:"select",values:{top:{ord:1,label:"Top"},left:{ord:2,label:"Left"},right:{ord:3,label:"Right"},bottom:{ord:4,label:"Bottom"},"":{ord:5,label:"Only show on click"}},value:"right"};this.tuix.hotspot_properties.size={ord:3,label:"Size:",type:"select",values:{small:{ord:1,label:"Small"},medium:{ord:1,label:"Medium"},large:{ord:1,label:"Large"}},value:this.tuix.schematic.default_icon_size?this.tuix.schematic.default_icon_size:"medium"};this.tuix.schematic.is_system&&
(this.tuix.hotspot_properties.equipment_id={ord:0.1,label:"Equipment:",pick_items:{path:this.tuix.hotspot_asset_panel.path,target_path:this.tuix.hotspot_asset_panel.target_path,select_phrase:"Select equipment..."},format_onchange:!0});for(var c in this.tuix.hotspot_properties)b.custom.tuix[c]!==p&&(this.tuix.hotspot_properties[c].value=b.custom.tuix[c]);c=n.getKey();c.action="format_hotspot_details";c.fields=JSON.stringify(this.tuix.hotspot_properties);q.ajax(this.getAJAXURL(),c).after(function(c){c=
JSON.parse(c);if(c.fields){var f=d.getItemControlsMergeFields(c.fields);a.customFields=f;f=m.microTemplate("zenario_organizer_schematic_builder_item_controls",a);$("#organizer_schematic_builder__foreground_fields_wrapper").html(f);d.initForegroundItemControls(b)}c.field_id_extra_details&&(d.tuix.field_id_extra_details=c.field_id_extra_details)})}else if("asset_block"==b.custom.group){a.foreground_type="asset_block";a.foreground_item_controls_title="Editing an asset block";this.tuix.asset_block_properties=
{};this.tuix.asset_block_properties.equipment_id={ord:1,label:"Equipment:",pick_items:{path:this.tuix.asset_block_asset_panel.path,target_path:this.tuix.asset_block_asset_panel.target_path,select_phrase:"Select equipment..."}};for(c in this.tuix.asset_block_properties)this.tuix.asset_block_properties[c].value=b.custom.tuix[c];if(c=d.getItemControlsMergeFields(this.tuix.asset_block_properties))a.customFields=c;c=m.microTemplate("zenario_organizer_schematic_builder_item_controls",a);$("#organizer_schematic_builder__foreground_fields_wrapper").html(c);
d.initForegroundItemControls(b)}}};h.getItemControlsMergeFields=function(b){var d=[],a;for(a in b){var c=_.clone(b[a]);c.name=a;if("select"==c.type){var e=[],f;for(f in c.values){var k=_.clone(c.values[f]);k.value=f;e.push(k)}e.sort(this.sortByOrd);c.values=e}d.push(c)}d.sort(this.sortByOrd);return d};h.initForegroundItemControls=function(b){var d=this;$("#organizer_schematic_builder__delete_foreground_image").on("click",function(){var a=d.canvas.getActiveObject();if(a&&"foreground"==a.custom.layer){var b=
"foreground image";"hotspot"==a.custom.group?b="hotspot":"asset_block"==a.custom.group&&(b="asset block");m.showMessage("Are you sure you want to remove this "+b+"?","Yes","warning",!0);$("#zenario_fbMessageButtons input.submit_selected").on("click",function(){d.changeMadeToPanel();d.removeObjectFromLayersStructure(a);d.lastSelectedObjectId=!1;d.canvas.remove(a).renderAll()})}});$("#organizer_schematic_builder__duplicate_foreground_image").on("click",function(){var a=d.canvas.getActiveObject();a&&
"foreground"==a.custom.layer&&(d.changeMadeToPanel(),d.duplicateObject(a))});$('#organizer_schematic_builder__foreground_item_custom_fields select[name="latest_status_position"]').on("change",function(){d.changeMadeToPanel();var a=$(this).val(),b=d.canvas.getActiveObject();d.changeHotspotValueTextPosition(b,a)});$("#forground_item_field__size").on("change",function(){d.changeMadeToPanel();d.saveObjectFields(b);var a=d.canvas.getActiveObject(),e=$(this).val();d.resizeHotspot(a,e)});$("#forground_item_field__field_id").on("change",
function(){d.changeMadeToPanel();d.saveObjectFields(b);var a=$(this).val();(a=d.tuix.field_id_extra_details[a])||(a={});if(a){var e=d.canvas.getActiveObject(),f=e.getObjects();if(a.icon&&d.tuix.icons[a.icon]&&d.tuix.icons[a.icon]["default"])for(var k=0;k<f.length;k++)if(f[k].custom&&"hotspot"==f[k].custom.type){f[k].setSrc(d.tuix.icons[a.icon]["default"],function(){d.canvas.renderAll()});break}if(a.label)for(k=0;k<f.length;k++)if(f[k].custom&&"label"==f[k].custom.type){f[k].setText(a.label);break}e.custom.tuix&&
e.custom.tuix.latest_status_position&&d.changeHotspotValueTextPosition(e,e.custom.tuix.latest_status_position)}});for(var a in this.tuix.hotspot_properties)this.initForegroundItemField(a,this.tuix.hotspot_properties[a],b);for(a in this.tuix.asset_block_properties)this.initForegroundItemField(a,this.tuix.asset_block_properties[a],b)};h.initForegroundItemField=function(b,d,a){var c=this;d.pick_items&&(this.setAssetOrganizerName(a.custom.tuix[b],b,d),$("#"+b+"__choose_button").on("click",function(){var a=
d.pick_items.path;m.organizerSelect(function(a,d,e){for(var h in d._items){c.changeMadeToPanel();a=q.decodeItemIdForOrganizer(h);$("#"+b).val(a);a=c.canvas.getActiveObject();c.saveObjectFields(a);c.setForegroundItemControls(a);break}},p,!1,a,a,a,a,!0)}))};h.setAssetOrganizerName=function(b,d,a){a=m.getItemFromOrganizer(a.pick_items.target_path,b);b=m.formatOrganizerItemName(a,b);$("#"+d+"__display_text").val(b)};h.initLayerControls=function(b,d){var a=this;if("background"==b)if(d){var c=a.canvas.getActiveObject();
$("#organizer_schematic_builder__duplicate_background_image").on("click",function(){c&&"background"==c.custom.layer&&(a.changeMadeToPanel(),a.duplicateObject(d))});$("#organizer_schematic_builder__delete_background_image").on("click",function(){m.showMessage("Are you sure you want to remove this background image?","Yes","warning",!0);$("#zenario_fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(c);a.lastSelectedObjectId=!1;a.canvas.remove(c).renderAll()})});
var e=c.opacity!==p?100*c.opacity:100;$("#organizer_schematic_builder__background_opacity_slider").slider({min:0,max:100,step:1,value:e,slide:function(b,c){$("#organizer_schematic_builder__background_opacity").val(c.value+"%");d.opacity=c.value/100;a.canvas.renderAll();a.changeMadeToPanel()}});$("#organizer_schematic_builder__move_background_image_forward").on("click",function(){c&&"background"==c.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(c,"up"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_back").on("click",
function(){c&&"background"==c.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(c,"down"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_first").on("click",function(){c&&"background"==c.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(c,"first"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_last").on("click",function(){c&&"background"==c.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(c,
"last"),a.setObjectOrder())});$("#organizer_schematic_builder__back_to_background").on("click",function(){a.changeCanvasLayer("background")});$("#organizer_schematic_builder__create_line_1").on("click",function(){if("background"==b){var c=a.canvas.getActiveGroup();if(c&&2==c._objects.length&&!c.hasMoved()){a.changeMadeToPanel();var c=c._objects,d=$("#organizer_schematic_builder__arrow_type").val();a.connectWithArrows(c,1,d)}}});$("#organizer_schematic_builder__create_line_2").on("click",function(){if("background"==
b){var c=a.canvas.getActiveGroup();if(c&&2==c._objects.length&&!c.hasMoved()){a.changeMadeToPanel();var c=c._objects,d=$("#organizer_schematic_builder__arrow_type").val();a.connectWithArrows(c,2,d)}}})}else $("#organizer_schematic_builder__clear_background").on("click",function(){m.showMessage("Are you sure you want to remove everything from the background?","Yes","warning",!0);$("#zenario_fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(!1,
b);a.clearCanvasLayer(b)})}),$("#organizer_schematic_builder__add_background_image").on("click",function(){var b=$('<input type="file" name="Filedata" accept="image/*">'),c=n.getKey();c.action="upload_background_image";b.on("change",function(){m.doHTML5Upload(this.files,a.getAJAXURL(),c,function(b){a.uploadImagesCallback(b)})});b.click()}),$("#organizer_schematic_builder__add_library_background_image").on("click",function(){"background"==b&&m.organizerSelect(function(b,c,d){b=n.getKey();b.action=
"get_library_image_link";b.image_id=c.id;q.ajax(a.getAJAXURL(),b).after(function(b){a.changeMadeToPanel();b=JSON.parse(b);a.addImageToCanvas(b.link,c.id,"background")})},p,!1,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)});else if("foreground"==b)if(d)$("#organizer_schematic_builder__back_to_foreground").on("click",function(){a.changeCanvasLayer("foreground")});else $("#organizer_schematic_builder__clear_foreground").on("click",
function(){m.showMessage("Are you sure you want to remove everything from the foreground?","Yes","warning",!0);$("#zenario_fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(!1,b);a.clearCanvasLayer(b)})}),$("#organizer_schematic_builder__add_foreground_hotspot").on("click",function(){a.changeMadeToPanel();a.addHotspot()}),$("#organizer_schematic_builder__add_foreground_asset_block").on("click",function(){a.changeMadeToPanel();a.addAssetBlock()});
else"start_layer"==b&&($("#organizer_schematic_builder__edit_background").on("click",function(){a.changeCanvasLayer("background")}),$("#organizer_schematic_builder__edit_foreground").on("click",function(){a.changeCanvasLayer("foreground")}));$("#organizer_schematic_builder__back_to_start").on("click",function(){a.changeCanvasLayer("start_layer")})};h.duplicateObject=function(b){if("foreground"==this.layer)this.saveObjectFields(b),"hotspot"==b.custom.group?this.addHotspot(b):"asset_block"==b.custom.group&&
this.addAssetBlock(b);else{var d=fabric.util.object.clone(b);d.set("top",b.top+5);d.set("left",b.left+5);this.addToCanvas(d)}};h.changeHotspotValueTextPosition=function(b,d){var a="[Latest value]";if(b.custom.tuix.field_id){var c=this.tuix.field_id_extra_details[b.custom.tuix.field_id];c.label&&(a=c.label)}for(var c=b.getObjects(),e=[],f=0;f<c.length;++f)"label"==c[f].custom.type&&(a=c[f].getText(),e.push(c[f]));for(f=0;f<e.length;++f)b.removeWithUpdate(e[f]);c=parseInt(b.getWidth());e=parseInt(b.getHeight());
d&&(f={hasBorders:!1,fontSize:15,fontFamily:"Tahoma, Geneva, sans-serif",backgroundColor:"rgba(255,255,255,0.8)",top:b.getTop(),left:b.getLeft(),custom:{type:"label"}},"top"==d?(f.top-=25,f.left+=c/2,f.originX="center"):"left"==d?(f.top+=e/2,f.left-=10,f.originX="right",f.originY="center"):"right"==d?(f.top+=e/2,f.left+=c+10,f.originX="left",f.originY="center"):"bottom"==d&&(f.top+=e+5,f.left+=c/2,f.originX="center"),b.addWithUpdate(new fabric.Text(a,f)));this.canvas.renderAll()};h.resizeHotspot=
function(b,d){var a=this.tuix.icon_sizes.small;"small"==d?a=this.tuix.icon_sizes.small:"medium"==d?a=this.tuix.icon_sizes.medium:"large"==d&&(a=this.tuix.icon_sizes.large);for(var c=b.getObjects(),e=0;e<c.length;++e)if(c[e].custom&&"hotspot"==c[e].custom.type){c[e].scaleToHeight(a);a=new fabric.Circle;b.addWithUpdate(a);b.removeWithUpdate(a);break}b.custom.tuix&&b.custom.tuix.latest_status_position&&this.changeHotspotValueTextPosition(b,b.custom.tuix.latest_status_position);this.canvas.renderAll()};
h.addHotspot=function(b){var d=this,a=new fabric.Group([],{hasControls:!1}),c=40,e=40;b&&(c=b.top+5,e=b.left+5);fabric.Image.fromURL(this.tuix.icons.undefined["default"],function(f){f.custom={type:"hotspot"};var k="right",g=d.tuix.schematic.default_icon_size?d.tuix.schematic.default_icon_size:"medium";if(b&&(k=b.custom.tuix.latest_status_position,g=b.custom.tuix.size,a.custom={tuix:$.extend(!0,{},b.custom.tuix)},b.custom.tuix.field_id)){var h=d.tuix.field_id_extra_details[b.custom.tuix.field_id];
h.icon&&d.tuix.icons[h.icon]&&d.tuix.icons[h.icon]["default"]&&f.setSrc(d.tuix.icons[h.icon]["default"],function(){d.canvas.renderAll()})}d.tuix.icon_sizes[g]&&f.scaleToHeight(d.tuix.icon_sizes[g]);a.addWithUpdate(f);d.addToCanvas(a,{layer:"foreground",group:"hotspot"});d.changeHotspotValueTextPosition(a,k);a.set("top",c);a.set("left",e);a.setCoords();d.canvas.renderAll()})};h.addAssetBlock=function(b){var d=160,a=200,c=20,e=20;b&&(d=b.width,a=b.height,c=b.left+5,e=b.top+5);d=new fabric.Rect({width:d,
height:a,left:c,top:e,fill:"transparent",opacity:this.assetBlockOpacity,strokeWidth:3,stroke:"#0080FF",strokeLineJoin:"round"});b&&(d.custom=$.extend(!0,{},b.custom));this.addToCanvas(d,{layer:"foreground",group:"asset_block"})};h.connectWithArrows=function(b,d,a){var c=[],e=new fabric.Group([]);b[0].originalLeft<=b[1].originalLeft?c.push(b[0],b[1]):c.push(b[1],b[0]);b=c[0].width*c[0].scaleX;var f=c[0].height*c[0].scaleY,k=c[0].originalLeft+b/2,g=c[0].originalTop+f/2,h=c[1].width*c[1].scaleX,m=c[1].height*
c[1].scaleY,l=c[1].originalLeft+h/2,c=c[1].originalTop+m/2,n="";if(g>=c-m/2&&g<=c+m/2){k+=b/2;l-=h/2;if("double"==a||"single_left"==a)this.drawTriangle(e,-90,k,g,7,1.5),k+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,90,l,g,-7,1.5),l-=7;n="M "+k+" "+g+" L "+l+"  "+g}else if(c>=g-f/2&&c<=g+f/2){k+=b/2;l-=h/2;if("double"==a||"single_left"==a)this.drawTriangle(e,-90,k,c,7,1.5),k+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,90,l,c,-7,1.5),l-=7;n="M "+k+" "+c+" L "+l+"  "+c}else if(k>=
l-h/2&&k<=l+h/2){if(c<=g){g-=f/2;c+=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,k,c,1.5,7),c+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,k,g,1.5,-7),g-=7}else{g+=f/2;c-=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,k,g,1.5,7),g+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,k,c,1.5,-7),c-=7}n="M "+k+" "+g+" L "+k+"  "+c}else if(l>=k-b/2&&l<=k+b/2){if(c<=g){g-=f/2;c+=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,l,c,1.5,7),c+=
7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,l,g,1.5,-7),g-=7}else{g+=f/2;c-=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,l,g,1.5,7),g+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,l,c,1.5,-7),c-=7}n="M "+l+" "+g+" L "+l+"  "+c}if(!n)if(1==d){k+=b/2;if(g<=c){if(c-=m/2,"double"==a||"single_right"==a)this.drawTriangle(e,180,l,c,1.5,-7),c-=7}else if(c+=m/2,"double"==a||"single_right"==a)this.drawTriangle(e,0,l,c,1.5,7),c+=7;if("double"==a||"single_left"==a)this.drawTriangle(e,
-90,k,g,7,1.5),k+=7;n="M "+k+" "+g+" L "+l+" "+g+" L "+l+" "+c}else if(2==d){l-=h/2;if(g<=c){if(g+=f/2,"double"==a||"single_left"==a)this.drawTriangle(e,0,k,g,1.5,7),g+=7}else if(g-=f/2,"double"==a||"single_left"==a)this.drawTriangle(e,180,k,g,1.5,-7),g-=7;if("double"==a||"single_right"==a)this.drawTriangle(e,90,l,c,-7,1.5),l-=7;n="M "+k+" "+g+" L "+k+" "+c+" L "+l+" "+c}d=new fabric.Path(n,{fill:"",stroke:"black",strokeWidth:3,hasBorders:!1});e.addWithUpdate(d);this.addToCanvas(e,{layer:"background",
group:"images"});this.canvas.deactivateAll().renderAll()};h.drawTriangle=function(b,d,a,c,e,f){d=new fabric.Triangle({left:a+e,top:c+f,originX:"center",originY:"center",fill:"black",stroke:"black",opacity:1,angle:d,height:12,width:10,hasBorders:!1});b.addWithUpdate(d)};h.returnAJAXRequests=function(){return{no_cache:1}};h.returnPageSize=function(){return!1};h.returnDoSortingAndSearchingOnServer=function(){return!1};h.returnSearchingEnabled=function(){return!1};h.returnPanelTitle=function(){return this.tuix.title};
h.returnShowLeftColumn=function(){return!1};h.getAJAXURL=function(){return u+"zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+n.path+"&method_call=handleOrganizerPanelAJAX"};h.selectItem=function(b){t(r.base).selectItem.call(this,b);this.updateEventsDetails()};h.deselectItem=function(b){t(r.base).deselectItem.call(this,b);this.updateEventsDetails()};h.updateItemCheckbox=function(b,d){};h.returnInspectionViewEnabled=function(){return!1};h.openInspectionView=function(b){};h.closeInspectionView=
function(b){}},zenarioO.panelTypes);
