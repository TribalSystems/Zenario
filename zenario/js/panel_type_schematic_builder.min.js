zenario.lib(function(q,x,h,v,B,C,s,m,r,D,E,n,F,G,H,I,J,K,y,w,L,t,M,p,N,O,P,Q,u,R,S,T,U,V,W,z,X,Y,Z,A){h=w(t.schematic_builder=y(t.base));"undefined"!==typeof fabric&&(fabric.Rect.prototype.resizeToScale=function(){this.width*=this.scaleX;this.height*=this.scaleY;this.scaleY=this.scaleX=1});h.init=function(){this.canvas=!1;this.nextUniqueId=0;this.lastSelectedObjectId=!1;this.assetBlockOpacity=0.8;this.changingForm=!1;this.layers={background:{ord:1,groups:{images:{ord:1,objects:[]}}},foreground:{ord:2,
groups:{asset_block:{ord:1,objects:[]},hotspot:{ord:2,objects:[]}}}}};h.showPanel=function(c,d,a){c.html("").hide();var b=this;c={controls:this.getLayerControlsMergeFields("start_layer"),width:this.tuix.canvas.width,height:this.tuix.canvas.height};c=r._mT(p+"organizer_schematic_builder",c);d.html(c).show();this.initLayerControls("start_layer");a.html("").show();this.canvas=new fabric.Canvas("organizer_schematic_builder_canvas",{width:this.tuix.canvas.width,height:this.tuix.canvas.height});this.layer=
"background";this.tuix.schematic.json&&this.canvas.loadFromJSON(this.tuix.schematic.json,function(){b.layer="start_layer";for(var a=b.canvas.getObjects(),c=0;c<a.length;c++){b.putObjectIntoLayersStructure(a[c]);if("group"==a[c].get("type")){for(var d=a[c].getObjects(),g=0;g<d.length;g++)if("path"==d[g].type){d[g].setFill("");break}else d[g].custom&&"label"==d[g].custom.type&&(d[g].backgroundColor="rgba(255,255,255,0.8)");"hotspot"==a[c].custom.group&&(a[c].hasControls=!1)}a[c].setControlVisible("mtr",
!1)}b.setObjectOrder();b.changeCanvasLayer(b.layer)});this.canvas.on("object:selected",function(a){a=a.target;b.updateLayerControls(b.layer,a);"foreground"==b.layer&&b.setForegroundItemControls(a)});this.canvas.on("selection:cleared",function(){b.updateLayerControls(b.layer)});this.canvas.on("object:scaling",function(a){a.target.resizeToScale&&a.target.resizeToScale()});this.canvas.on("object:modified",function(a){b.changeMadeToPanel()})};h.changeMadeToPanel=function(){this.changingForm||(this.changingForm=
!0,v.onbeforeunload=function(){return"You are currently editing this schematic. If you leave now you will lose any unsaved changes"},n._dI("Please either save your changes, or click Reset to discard them, before exiting the form editor."),n._sB())};h.putObjectIntoLayersStructure=function(c){c.custom&&c.custom.layer&&c.custom.group&&c.custom.id&&this.layers[c.custom.layer].groups[c.custom.group].objects.push(c.custom.id)};h.removeObjectFromLayersStructure=function(c,d){if(d)for(var a in this.layers[d].groups)this.layers[d].groups[a].objects=
[];else c.custom&&c.custom.layer&&c.custom.group&&c.custom.id&&(a=$.inArray(c.custom.id,this.layers[c.custom.layer].groups[c.custom.group].objects),-1!==a&&this.layers[c.custom.layer].groups[c.custom.group].objects.splice(a,1))};h.moveObjectInLayersStructure=function(c,d){if(c.custom&&c.custom.layer&&c.custom.group&&c.custom.id){var a=this.layers[c.custom.layer].groups[c.custom.group],b=$.inArray(c.custom.id,a.objects);if(-1!==b){var e=!1;"first"==d?e=a.objects.length-1:"last"==d?e=0:"up"==d?e=b==
a.objects.length-1?a.objects.length-1:b+1:"down"==d&&(e=0==b?0:b-1);!1!==e&&a.objects.splice(e,0,a.objects.splice(b,1)[0])}}};h.setObjectOrder=function(){for(var c={},d=this.canvas.getObjects(),a=0;a<d.length;++a)d[a].custom.id&&(c[d[a].custom.id]=d[a]);var d=0,b=_._v(this.layers);b.sort(this.sortByOrd);for(a=0;a<b.length;++a){var e=_._v(b[a].groups);e.sort(this.sortByOrd);for(var f=0;f<e.length;++f)for(var k=e[f].objects,g=0;g<k.length;++g)c[k[g]].moveTo(d++)}};h.sortByOrd=function(c,d){if(c.ord&&
d.ord){if(c.ord<d.ord)return-1;if(c.ord>d.ord)return 1}return 0};h.showButtons=function(c){var d=this;this.changingForm?(c.html(this.microTemplate(p+"organizer_apply_cancel_buttons",{confirm_text:"Save changes",cancel_text:"Reset"})),c.find("#organizer_applyButton").click(function(){var a=!1;if("background"==d.layer)a=!0,d.changeCanvasLayer("foreground",!0);else{var b=d.canvas.getActiveObject();b&&d.saveObjectFields(b)}var b=JSON.stringify(d.canvas.toJSON(["custom"])),c=n._gK();c.action="save_schematic";
c.json=b;m._nDS("saving",!0);s._a(d.getAJAXURL(),c).after(function(b){a&&d.changeCanvasLayer("background",!0);v.onbeforeunload=!1;n._eI();d.changingForm=!1;n._sB();m._nDS();m._t({message_type:"success",message:"Your changes have been saved!"})})}),c.find("#organizer_cancelButton").click(function(){confirm("Are you sure you want to discard all your unsaved changes?")&&(v.onbeforeunload=!1,n._eI(),d.changingForm=!1,n._r())})):c.html("").show()};h.addImageToCanvas=function(c,d,a,b,e){var f=this;c&&d&&
fabric.Image.fromURL(c,function(k){var g={};e?g.cache_id=d:g.image_id=d;a&&(g.layer=a,g.group=b?b:"images");k.src=c;f.addToCanvas(k,g)})};h.addToCanvas=function(c,d){if(d){c.custom||(c.custom={});for(var a in d)c.custom[a]=d[a];c.custom.id="t"+ ++this.nextUniqueId;c.custom.tuix||(c.custom.tuix={})}c.setControlVisible("mtr",!1);this.canvas.add(c);this.putObjectIntoLayersStructure(c);this.setObjectOrder()};h.clearCanvasLayer=function(c){if(c){for(var d=this.canvas.getObjects(),a=[],b=0;b<d.length;b++)d[b].custom.layer==
c&&a.push(d[b]);for(b=0;b<a.length;b++)this.canvas.remove(a[b]);this.canvas.renderAll()}};h.changeCanvasLayer=function(c,d){c&&(this.layer=c,this.canvas.getObjects().forEach(function(a,b){"background"==c?"foreground"==a.custom.layer?a.visible=!1:"background"==a.custom.layer&&(a.selectable=!0):"foreground"==c?"foreground"==a.custom.layer?(a.visible=!0,a.selectable=!0):"background"==a.custom.layer&&(a.selectable=!1):(a.visible=!0,a.selectable=!1)}),d||(this.updateLayerControls(c),this.canvas.deactivateAll().renderAll()))};
h.uploadImagesCallback=function(c){c&&(this.changeMadeToPanel(),this.addImageToCanvas(c[0].link,c[0].id,"background",!1,!0))};h.saveObjectFields=function(c){var d=$("#organizer_schematic_builder__foreground_item_custom_fields").serializeArray();if(d){c.custom.tuix||(c.custom.tuix={});for(var a=0;a<d.length;a++)c.custom.tuix[d[a].name]=d[a].value}};h.updateLayerControls=function(c,d){if(this.lastSelectedObjectId){for(var a=!1,b=this.canvas.getObjects(),e=0;e<b.length;e++)if(b[e].custom.id==this.lastSelectedObjectId){a=
b[e];break}a&&this.saveObjectFields(a)}this.lastSelectedObjectId=d&&d.custom?d.custom.id:!1;a=this.getLayerControlsMergeFields(c,d);a=r._mT(p+"organizer_schematic_builder_controls",a);$("#organizer_schematic_builder .controls").html(a);this.initLayerControls(c,d)};h.getLayerControlsMergeFields=function(c,d){var a={layer:c,itemSelected:!1,customFields:!1,is_system_schematic:this.tuix.schematic.is_system};d&&(d.custom&&d.custom.layer==c?(a.itemSelected=!0,"background"==d.custom.layer&&(a.opacity=d.opacity!==
q?(100*d.opacity).toFixed():100)):d._objects&&2==d._objects.length&&(a.multiItemSelected=!0));return a};h.setForegroundItemControls=function(c){var d=this;if(c&&c.custom&&"foreground"==c.custom.layer){var a={};if("hotspot"==c.custom.group){a.foreground_type="hotspot";a.foreground_item_controls_title="Editing a hotspot";this.tuix.hotspot_properties={};this.tuix.hotspot_properties.field_id={ord:1,label:"Field:",type:"select",values:{},empty_value:" -- Select --"};this.tuix.hotspot_properties.latest_status_position=
{ord:2,label:"Show field status:",type:"select",values:{top:{ord:1,label:"Top"},left:{ord:2,label:"Left"},right:{ord:3,label:"Right"},bottom:{ord:4,label:"Bottom"},"":{ord:5,label:"Only show on click"}},value:"right"};this.tuix.hotspot_properties.size={ord:3,label:"Size:",type:"select",values:{small:{ord:1,label:"Small"},medium:{ord:1,label:"Medium"},large:{ord:1,label:"Large"}},value:this.tuix.schematic.default_icon_size?this.tuix.schematic.default_icon_size:"medium"};this.tuix.schematic.is_system&&
(this.tuix.hotspot_properties.equipment_id={ord:0.1,label:"Equipment:",pick_items:{path:this.tuix.hotspot_asset_panel.path,target_path:this.tuix.hotspot_asset_panel.target_path,select_phrase:"Select equipment..."},format_onchange:!0});for(var b in this.tuix.hotspot_properties)c.custom.tuix[b]!==q&&(this.tuix.hotspot_properties[b].value=c.custom.tuix[b]);b=n._gK();b.action="format_hotspot_details";b.fields=JSON.stringify(this.tuix.hotspot_properties);s._a(this.getAJAXURL(),b).after(function(b){b=JSON.parse(b);
if(b.fields){var f=d.getItemControlsMergeFields(b.fields);a.customFields=f;f=r._mT(p+"organizer_schematic_builder_item_controls",a);$("#organizer_schematic_builder__foreground_fields_wrapper").html(f);d.initForegroundItemControls(c)}b.field_id_extra_details&&(d.tuix.field_id_extra_details=b.field_id_extra_details)})}else if("asset_block"==c.custom.group){a.foreground_type="asset_block";a.foreground_item_controls_title="Editing an asset block";this.tuix.asset_block_properties={};this.tuix.asset_block_properties.equipment_id=
{ord:1,label:"Equipment:",pick_items:{path:this.tuix.asset_block_asset_panel.path,target_path:this.tuix.asset_block_asset_panel.target_path,select_phrase:"Select equipment..."}};for(b in this.tuix.asset_block_properties)this.tuix.asset_block_properties[b].value=c.custom.tuix[b];if(b=d.getItemControlsMergeFields(this.tuix.asset_block_properties))a.customFields=b;b=r._mT(p+"organizer_schematic_builder_item_controls",a);$("#organizer_schematic_builder__foreground_fields_wrapper").html(b);d.initForegroundItemControls(c)}}};
h.getItemControlsMergeFields=function(c){var d=[],a;for(a in c){var b=_._cl(c[a]);b.name=a;if("select"==b.type){var e=[],f;for(f in b.values){var k=_._cl(b.values[f]);k.value=f;e.push(k)}e.sort(this.sortByOrd);b.values=e}d.push(b)}d.sort(this.sortByOrd);return d};h.initForegroundItemControls=function(c){var d=this;$("#organizer_schematic_builder__delete_foreground_image").on("click",function(){var a=d.canvas.getActiveObject();if(a&&"foreground"==a.custom.layer){var c="foreground image";"hotspot"==
a.custom.group?c="hotspot":"asset_block"==a.custom.group&&(c="asset block");m._sM("Are you sure you want to remove this "+c+"?","Yes","warning",!0);$(u+"fbMessageButtons input.submit_selected").on("click",function(){d.changeMadeToPanel();d.removeObjectFromLayersStructure(a);d.lastSelectedObjectId=!1;d.canvas.remove(a).renderAll()})}});$("#organizer_schematic_builder__duplicate_foreground_image").on("click",function(){var a=d.canvas.getActiveObject();a&&"foreground"==a.custom.layer&&(d.changeMadeToPanel(),
d.duplicateObject(a))});$('#organizer_schematic_builder__foreground_item_custom_fields select[name="latest_status_position"]').on("change",function(){d.changeMadeToPanel();var a=$(this).val(),c=d.canvas.getActiveObject();d.changeHotspotValueTextPosition(c,a)});$("#forground_item_field__size").on("change",function(){d.changeMadeToPanel();d.saveObjectFields(c);var a=d.canvas.getActiveObject(),e=$(this).val();d.resizeHotspot(a,e)});$("#forground_item_field__field_id").on("change",function(){d.changeMadeToPanel();
d.saveObjectFields(c);var a=$(this).val();(a=d.tuix.field_id_extra_details[a])||(a={});if(a){var e=d.canvas.getActiveObject(),f=e.getObjects();if(a.icon&&d.tuix.icons[a.icon]&&d.tuix.icons[a.icon]["default"])for(var k=0;k<f.length;k++)if(f[k].custom&&"hotspot"==f[k].custom.type){f[k].setSrc(d.tuix.icons[a.icon]["default"],function(){d.canvas.renderAll()});break}if(a.label)for(k=0;k<f.length;k++)if(f[k].custom&&"label"==f[k].custom.type){f[k].setText(a.label);break}e.custom.tuix&&e.custom.tuix.latest_status_position&&
d.changeHotspotValueTextPosition(e,e.custom.tuix.latest_status_position)}});for(var a in this.tuix.hotspot_properties)this.initForegroundItemField(a,this.tuix.hotspot_properties[a],c);for(a in this.tuix.asset_block_properties)this.initForegroundItemField(a,this.tuix.asset_block_properties[a],c)};h.initForegroundItemField=function(c,d,a){var b=this;d.pick_items&&(this.setAssetOrganizerName(a.custom.tuix[c],c,d),$("#"+c+"__choose_button").on("click",function(){var a=d.pick_items.path;m._oS(function(a,
d,g){for(var e in d._items){b.changeMadeToPanel();a=s._dIIFO(e);$("#"+c).val(a);a=b.canvas.getActiveObject();b.saveObjectFields(a);b.setForegroundItemControls(a);break}},q,!1,a,a,a,a,!0)}))};h.setAssetOrganizerName=function(c,d,a){a=m._gIFO(a.pick_items.target_path,c);c=m._fOIN(a,c);$("#"+d+"__display_text").val(c)};h.initLayerControls=function(c,d){var a=this;if("background"==c)if(d){var b=a.canvas.getActiveObject();$("#organizer_schematic_builder__duplicate_background_image").on("click",function(){b&&
"background"==b.custom.layer&&(a.changeMadeToPanel(),a.duplicateObject(d))});$("#organizer_schematic_builder__delete_background_image").on("click",function(){m._sM("Are you sure you want to remove this background image?","Yes","warning",!0);$(u+"fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(b);a.lastSelectedObjectId=!1;a.canvas.remove(b).renderAll()})});var e=b.opacity!==q?100*b.opacity:100;$("#organizer_schematic_builder__background_opacity_slider").slider({min:0,
max:100,step:1,value:e,slide:function(c,b){$("#organizer_schematic_builder__background_opacity").val(b.value+"%");d.opacity=b.value/100;a.canvas.renderAll();a.changeMadeToPanel()}});$("#organizer_schematic_builder__move_background_image_forward").on("click",function(){b&&"background"==b.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(b,"up"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_back").on("click",function(){b&&"background"==b.custom.layer&&
(a.changeMadeToPanel(),a.moveObjectInLayersStructure(b,"down"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_first").on("click",function(){b&&"background"==b.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(b,"first"),a.setObjectOrder())});$("#organizer_schematic_builder__move_background_image_last").on("click",function(){b&&"background"==b.custom.layer&&(a.changeMadeToPanel(),a.moveObjectInLayersStructure(b,"last"),a.setObjectOrder())});$("#organizer_schematic_builder__back_to_background").on("click",
function(){a.changeCanvasLayer("background")});$("#organizer_schematic_builder__create_line_1").on("click",function(){if("background"==c){var b=a.canvas.getActiveGroup();if(b&&2==b._objects.length&&!b.hasMoved()){a.changeMadeToPanel();var b=b._objects,d=$("#organizer_schematic_builder__arrow_type").val();a.connectWithArrows(b,1,d)}}});$("#organizer_schematic_builder__create_line_2").on("click",function(){if("background"==c){var b=a.canvas.getActiveGroup();if(b&&2==b._objects.length&&!b.hasMoved()){a.changeMadeToPanel();
var b=b._objects,d=$("#organizer_schematic_builder__arrow_type").val();a.connectWithArrows(b,2,d)}}})}else $("#organizer_schematic_builder__clear_background").on("click",function(){m._sM("Are you sure you want to remove everything from the background?","Yes","warning",!0);$(u+"fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(!1,c);a.clearCanvasLayer(c)})}),$("#organizer_schematic_builder__add_background_image").on("click",function(){var c=
$('<input type="file" name="Filedata" accept="image/*">'),b=n._gK();b.action="upload_background_image";c.on("change",function(){r._dHTML5U(this.files,a.getAJAXURL(),b,function(c){a.uploadImagesCallback(c)})});c.click()}),$("#organizer_schematic_builder__add_library_background_image").on("click",function(){if("background"==c){var b=p+"_content/panels/image_library";m._oS(function(b,c,d){b=n._gK();b.action="get_library_image_link";b.image_id=c.id;s._a(a.getAJAXURL(),b).after(function(b){a.changeMadeToPanel();
b=JSON.parse(b);a.addImageToCanvas(b.link,c.id,"background")})},q,!1,b,b,b,b,!0)}});else if("foreground"==c)if(d)$("#organizer_schematic_builder__back_to_foreground").on("click",function(){a.changeCanvasLayer("foreground")});else $("#organizer_schematic_builder__clear_foreground").on("click",function(){m._sM("Are you sure you want to remove everything from the foreground?","Yes","warning",!0);$(u+"fbMessageButtons input.submit_selected").on("click",function(){a.changeMadeToPanel();a.removeObjectFromLayersStructure(!1,
c);a.clearCanvasLayer(c)})}),$("#organizer_schematic_builder__add_foreground_hotspot").on("click",function(){a.changeMadeToPanel();a.addHotspot()}),$("#organizer_schematic_builder__add_foreground_asset_block").on("click",function(){a.changeMadeToPanel();a.addAssetBlock()});else"start_layer"==c&&($("#organizer_schematic_builder__edit_background").on("click",function(){a.changeCanvasLayer("background")}),$("#organizer_schematic_builder__edit_foreground").on("click",function(){a.changeCanvasLayer("foreground")}));
$("#organizer_schematic_builder__back_to_start").on("click",function(){a.changeCanvasLayer("start_layer")})};h.duplicateObject=function(c){if("foreground"==this.layer)this.saveObjectFields(c),"hotspot"==c.custom.group?this.addHotspot(c):"asset_block"==c.custom.group&&this.addAssetBlock(c);else{var d=fabric.util.object.clone(c);d.set("top",c.top+5);d.set("left",c.left+5);this.addToCanvas(d)}};h.changeHotspotValueTextPosition=function(c,d){var a="[Latest value]";if(c.custom.tuix.field_id){var b=this.tuix.field_id_extra_details[c.custom.tuix.field_id];
b.label&&(a=b.label)}for(var b=c.getObjects(),e=[],f=0;f<b.length;++f)"label"==b[f].custom.type&&(a=b[f].getText(),e.push(b[f]));for(f=0;f<e.length;++f)c.removeWithUpdate(e[f]);b=parseInt(c.getWidth());e=parseInt(c.getHeight());d&&(f={hasBorders:!1,fontSize:15,fontFamily:"Tahoma, Geneva, sans-serif",backgroundColor:"rgba(255,255,255,0.8)",top:c.getTop(),left:c.getLeft(),custom:{type:"label"}},"top"==d?(f.top-=25,f.left+=b/2,f.originX="center"):"left"==d?(f.top+=e/2,f.left-=10,f.originX="right",f.originY=
"center"):"right"==d?(f.top+=e/2,f.left+=b+10,f.originX="left",f.originY="center"):"bottom"==d&&(f.top+=e+5,f.left+=b/2,f.originX="center"),c.addWithUpdate(new fabric.Text(a,f)));this.canvas.renderAll()};h.resizeHotspot=function(c,d){var a=this.tuix.icon_sizes.small;"small"==d?a=this.tuix.icon_sizes.small:"medium"==d?a=this.tuix.icon_sizes.medium:"large"==d&&(a=this.tuix.icon_sizes.large);for(var b=c.getObjects(),e=0;e<b.length;++e)if(b[e].custom&&"hotspot"==b[e].custom.type){b[e].scaleToHeight(a);
a=new fabric.Circle;c.addWithUpdate(a);c.removeWithUpdate(a);break}c.custom.tuix&&c.custom.tuix.latest_status_position&&this.changeHotspotValueTextPosition(c,c.custom.tuix.latest_status_position);this.canvas.renderAll()};h.addHotspot=function(c){var d=this,a=new fabric.Group([],{hasControls:!1}),b=40,e=40;c&&(b=c.top+5,e=c.left+5);fabric.Image.fromURL(this.tuix.icons.undefined["default"],function(f){f.custom={type:"hotspot"};var k="right",g=d.tuix.schematic.default_icon_size?d.tuix.schematic.default_icon_size:
"medium";if(c&&(k=c.custom.tuix.latest_status_position,g=c.custom.tuix.size,a.custom={tuix:$.extend(!0,{},c.custom.tuix)},c.custom.tuix.field_id)){var h=d.tuix.field_id_extra_details[c.custom.tuix.field_id];h.icon&&d.tuix.icons[h.icon]&&d.tuix.icons[h.icon]["default"]&&f.setSrc(d.tuix.icons[h.icon]["default"],function(){d.canvas.renderAll()})}d.tuix.icon_sizes[g]&&f.scaleToHeight(d.tuix.icon_sizes[g]);a.addWithUpdate(f);d.addToCanvas(a,{layer:"foreground",group:"hotspot"});d.changeHotspotValueTextPosition(a,
k);a.set("top",b);a.set("left",e);a.setCoords();d.canvas.renderAll()})};h.addAssetBlock=function(c){var d=160,a=200,b=20,e=20;c&&(d=c.width,a=c.height,b=c.left+5,e=c.top+5);d=new fabric.Rect({width:d,height:a,left:b,top:e,fill:"transparent",opacity:this.assetBlockOpacity,strokeWidth:3,stroke:"#0080FF",strokeLineJoin:"round"});c&&(d.custom=$.extend(!0,{},c.custom));this.addToCanvas(d,{layer:"foreground",group:"asset_block"})};h.connectWithArrows=function(c,d,a){var b=[],e=new fabric.Group([]);c[0].originalLeft<=
c[1].originalLeft?b.push(c[0],c[1]):b.push(c[1],c[0]);c=b[0].width*b[0].scaleX;var f=b[0].height*b[0].scaleY,k=b[0].originalLeft+c/2,g=b[0].originalTop+f/2,h=b[1].width*b[1].scaleX,m=b[1].height*b[1].scaleY,l=b[1].originalLeft+h/2,b=b[1].originalTop+m/2,n="";if(g>=b-m/2&&g<=b+m/2){k+=c/2;l-=h/2;if("double"==a||"single_left"==a)this.drawTriangle(e,-90,k,g,7,1.5),k+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,90,l,g,-7,1.5),l-=7;n="M "+k+" "+g+" L "+l+"  "+g}else if(b>=g-f/2&&b<=g+f/2){k+=
c/2;l-=h/2;if("double"==a||"single_left"==a)this.drawTriangle(e,-90,k,b,7,1.5),k+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,90,l,b,-7,1.5),l-=7;n="M "+k+" "+b+" L "+l+"  "+b}else if(k>=l-h/2&&k<=l+h/2){if(b<=g){g-=f/2;b+=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,k,b,1.5,7),b+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,k,g,1.5,-7),g-=7}else{g+=f/2;b-=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,k,g,1.5,7),g+=7;if("double"==a||"single_right"==
a)this.drawTriangle(e,180,k,b,1.5,-7),b-=7}n="M "+k+" "+g+" L "+k+"  "+b}else if(l>=k-c/2&&l<=k+c/2){if(b<=g){g-=f/2;b+=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,l,b,1.5,7),b+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,l,g,1.5,-7),g-=7}else{g+=f/2;b-=m/2;if("double"==a||"single_left"==a)this.drawTriangle(e,0,l,g,1.5,7),g+=7;if("double"==a||"single_right"==a)this.drawTriangle(e,180,l,b,1.5,-7),b-=7}n="M "+l+" "+g+" L "+l+"  "+b}if(!n)if(1==d){k+=c/2;if(g<=b){if(b-=
m/2,"double"==a||"single_right"==a)this.drawTriangle(e,180,l,b,1.5,-7),b-=7}else if(b+=m/2,"double"==a||"single_right"==a)this.drawTriangle(e,0,l,b,1.5,7),b+=7;if("double"==a||"single_left"==a)this.drawTriangle(e,-90,k,g,7,1.5),k+=7;n="M "+k+" "+g+" L "+l+" "+g+" L "+l+" "+b}else if(2==d){l-=h/2;if(g<=b){if(g+=f/2,"double"==a||"single_left"==a)this.drawTriangle(e,0,k,g,1.5,7),g+=7}else if(g-=f/2,"double"==a||"single_left"==a)this.drawTriangle(e,180,k,g,1.5,-7),g-=7;if("double"==a||"single_right"==
a)this.drawTriangle(e,90,l,b,-7,1.5),l-=7;n="M "+k+" "+g+" L "+k+" "+b+" L "+l+" "+b}d=new fabric.Path(n,{fill:"",stroke:"black",strokeWidth:3,hasBorders:!1});e.addWithUpdate(d);this.addToCanvas(e,{layer:"background",group:"images"});this.canvas.deactivateAll().renderAll()};h.drawTriangle=function(c,d,a,b,e,f){d=new fabric.Triangle({left:a+e,top:b+f,originX:"center",originY:"center",fill:"black",stroke:"black",opacity:1,angle:d,height:12,width:10,hasBorders:!1});c.addWithUpdate(d)};h.returnAJAXRequests=
function(){return{no_cache:1}};h.returnPageSize=function(){return!1};h.returnDoSortingAndSearchingOnServer=function(){return!1};h.returnSearchingEnabled=function(){return!1};h.returnPanelTitle=function(){return this.tuix.title};h.returnShowLeftColumn=function(){return!1};h.getAJAXURL=function(){return x+A+"?__pluginClassName__="+this.tuix.class_name+"&__path__="+n.path+z+"handleOrganizerPanelAJAX"};h.selectItem=function(c){w(t.base).selectItem.call(this,c);this.updateEventsDetails()};h.deselectItem=
function(c){w(t.base).deselectItem.call(this,c);this.updateEventsDetails()};h.updateItemCheckbox=function(c,d){};h.returnInspectionViewEnabled=function(){return!1};h.openInspectionView=function(c){};h.closeInspectionView=function(c){}},zenarioO.panelTypes);
