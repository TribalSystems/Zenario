zenario.lib(function(p,f,v,w,x,y,r,q,z,A,B,k,C,D,E,F,G,H,t,u,l,s){f=u(s.admin_box_builder=t(s.form_builder_base_class));f.init=function(){this.saveChangesWarningMessage="You are currently editing this dataset. If you leave now you will lose any unsaved changes.";this.changingForm=!1;this.formatOnChange="values_source is_protected required validation show_in_organizer create_index admin_box_visibility".split(" ");this.formEditorSelector="#organizer_admin_form_builder";this.formFieldsSelector="#organizer_form_sections .form_field";
this.formFieldInlineButtonsSelector="#organizer_form_sections .form_field_inline_buttons";this.saveButtonText="Save changes";this.cancelButtonText="Reset"};f.getOrderedItems=function(b){var a,d,c,e,g,h,f,n,m,k=[];for(a in b)if(l(b,a)&&(d=b[a],!d.remove)){c=_._cl(d);if(c.fields){h=[];for(e in c.fields)if(l(c.fields,e)&&(g=c.fields[e],!d.remove)){g=_._cl(g);if(g.lov){m=[];for(f in g.lov)l(g.lov,f)&&(n=g.lov[f],n.remove||m.push(n));m.sort(this.sortByOrd);g.lov=m}h.push(g)}h.sort(this.sortByOrd);c.fields=
h}else if(c.lov){m=[];for(f in c.lov)l(c.lov,f)&&(n=c.lov[f],n.remove||m.push(n));m.sort(this.sortByOrd);c.lov=m}k.push(c)}k.sort(this.sortByOrd);return k};f.showPanel=function(b,a,d){b.html("").hide();this.changesSaved&&(this.changesSaved=!1,q._t({message_type:"success",message:"Your changes have been saved!"}));var c=this,e=_._cl(this.tuix.items);b={items:{},field:{},tab:{},details_section:"field_type_list",dataset_label:this.tuix.dataset_label};this.currentFieldTab=this.currentFieldTab?this.currentFieldTab:
"details";this.currentTab=this.currentTab?this.currentTab:!1;this.currentTabOrd=this.currentTabOrd?this.currentTabOrd:0;this.currentTab&&(b.items=this.getOrderedItems(e),this.tuix.items[this.currentTab]||(this.currentTabOrd!==p&&b.items[this.currentTabOrd]?(this.currentTab=b.items[this.currentTabOrd].name,this.current&&"tab"==this.current.type&&(this.current.id=b.items[this.currentTabOrd].name)):this.currentTab=this.current=!1),this.current&&("field"==this.current.type&&!this.tuix.items[this.currentTab].fields[this.current.id]&&
this.currentFieldOrd!==p&&this.currentTabOrd!==p&&b.items[this.currentTabOrd]&&b.items[this.currentTabOrd].fields[this.currentFieldOrd]&&(this.current.id=b.items[this.currentTabOrd].fields[this.currentFieldOrd].id),"field"==this.current.type?(b.details_section="field_details",b.field=this.getCurrentFieldDetailsMergeFields(),e[this.currentTab].fields[this.current.id].selected=!0):"tab"==this.current.type&&(b.details_section="tab_details",b.tab=this.getCurrentTabDetailsMergeFields(),e[this.currentTab].selected=
!0)));b.items=this.getOrderedItems(e);b.use_groups_field=this.tuix.use_groups_field;e=this.microTemplate(k.z+"organizer_admin_box_builder",b);a.html(e).show();this.current?"field"==this.current.type?this.initCurrentFieldDetails():"tab"==this.current.type&&this.initCurrentTabDetails():this.current={id:!1,type:!1};a=!1;this.maxNewCustomFieldValue=this.maxNewCustomField=this.maxNewCustomTab=1;this.deleting=!1;for(var g in b.items)if(l(b.items,g)){var e=b.items[g],h=$("#organizer_form_tab_"+e.name);$section=
$("#organizer_section_"+e.name);this.initTab(h);this.initSection($section);!1!=this.currentTab?e.name!=this.currentTab?$section.hide().sortable("disable"):h.addClass("on"):1!=e.ord?$section.hide().sortable("disable"):(h.addClass("on"),a=e.name)}a&&(this.currentTab=a);$("#organizer_field_type_list div.field_type, #organizer_centralised_field_type_list div.field_type").draggable({connectToSortable:"#organizer_form_sections div.form_section",helper:"clone"});$("#organizer_form_tabs").sortable({axis:"x",
containment:"parent",items:"div.sort",start:function(a,b){c.startIndex=b.item.index()},stop:function(a,b){c.startIndex!=b.item.index()&&("tab"==c.current.type&&(c.currentTabOrd=$("#organizer_form_tab_"+c.current.id).index()),c.changeMadeToPanel())}});$("#organizer_add_new_tab").on("click",function(){var a=function(a){_._isEm(a)&&c.addNewTab()};(cb=c.ajaxRequestOnChange())?cb.after(a):a([])});$("#organizer_form_sections div.form_field").on("click",function(){c.fieldClick($(this))});this.initDeleteButtons();
d.html("").show()};f.initDeleteButtons=function(){var b=this;$("#organizer_form_sections .delete_icon").off().on("click",function(a){b.deleting="field";var d=$(this).data("id"),c="",e="",g=!0;b.tuix.items[b.currentTab].fields[d].is_protected?(c="<p>This field is protected, and might be important to your site!</p>",c+="<p>If you're sure you want to delete this field then first unprotect it.</p>",q._sM(c,g,"warning",!0),b.listenForDelete(d),a.stopPropagation()):b.sendAJAXRequest({mode:"get_field_record_count",
field_id:d}).after(function(h){h=JSON.parse(h);g="Delete";h.record_count&&1<=h.record_count?(e=1==h.record_count?"":"s",c="<p>This field contains data on "+h.record_count+" record"+e+".</p>",c+="<p>When you save changes to this dataset, that data will be deleted.</p>"):c="<p>This field doesn't contain any data for any user/contact records.</p>";c+="<p>Delete this dataset field?</p>";q._sM(c,g,"warning",!0);b.listenForDelete(d);a.stopPropagation()})})};f.listenForDelete=function(b){var a=this;$(k.h+
"fbMessageButtons input.submit_selected").on("click",function(){setTimeout(function(){"tab"==a.deleting?a.deleteTab():(a.deleting="field")&&a.deleteField(b);a.deleting=!1})})};f.deleteTab=function(){var b,a;this.tuix.items[this.current.id]={remove:!0};b=$("#organizer_form_tab_"+this.current.id);a=b.prev();0==a.length&&(a=b.next());b.remove();this.changeMadeToPanel();1==a.length&&this.tabClick(a)};f.deleteField=function(b){var a=this,d,c;b===p&&(b=this.current.id);if(!this.tuix.items[this.currentTab].fields[b]||
0==this.tuix.items[this.currentTab].fields[b].is_system_field)if(this.tuix.items[this.currentTab].fields[b]={remove:!0},d=$("#organizer_form_field_"+b))c=this.selectNextField(d),this.changeMadeToPanel(),d.animate({height:0,opacity:0},500,function(){d.remove();!1===c&&a.showNoFieldsMessage()})};f.selectNextField=function(b){for($next=b.prev();1==$next.length;)if(this.tuix.items[this.currentTab].fields[$next.data("id")]&&this.tuix.items[this.currentTab].fields[$next.data("id")].remove)$next=$next.prev();
else break;if(0==$next.length)for($next=b.next();1==$next.length;)if(this.tuix.items[this.currentTab].fields[$next.data("id")]&&this.tuix.items[this.currentTab].fields[$next.data("id")].remove)$next=$next.next();else break;return 1==$next.length?(this.fieldClick($next),$next):!1};f.showNoFieldsMessage=function(){$("#organizer_section_"+this.currentTab).addClass("empty").html('<span class="no_fields_message">There are no fields on this tab</span>');this.showDetailsSection("organizer_field_type_list")};
f.addNewTab=function(){var b="__custom_tab_t"+this.maxNewCustomTab++,a={name:b,label:"Untitled tab"},d=this.microTemplate(k.z+"organizer_admin_box_builder_tab",a);$("#organizer_add_new_tab").before(d);this.tuix.items[b]={label:"Untitled tab",is_new_tab:!0,is_system_field:0,fields:{}};d=this.microTemplate(k.z+"organizer_admin_box_builder_section",a);$("#organizer_form_sections").append(d);a=$("#organizer_section_"+b);this.initSection(a);b=$("#organizer_form_tab_"+b);this.initTab(b);this.tabClick(b);
this.changeMadeToPanel()};f.initTab=function(b){var a=this;b.on("click",function(){a.tabClick($(this))});b.droppable({accept:"div.form_field:not(.system_field)",greedy:!0,hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(b,c){var e=$(this).data("name"),g=$(c.draggable).data("id"),h=function(b){_._isEm(b)?e!=a.currentTab&&setTimeout(function(){$(c.draggable).detach().appendTo("#organizer_section_"+e);"field"==a.current.type&&a.current.id==g&&a.unselectField();a.tuix.items[e].fields[g]=
a.tuix.items[a.currentTab].fields[g];delete a.tuix.items[a.currentTab].fields[g];"field"==a.current.type&&(a.current={type:"tab",id:a.currentTab},a.tabClick($("#organizer_form_tab_"+a.currentTab)));0==_._si(a.tuix.items[a.currentTab].fields)&&a.showNoFieldsMessage();a.removeNoItemsMessage(e);a.changeMadeToPanel()}):(b=$("#organizer_form_field_"+g),a.fieldClick(b))};a.save();(cb=a.ajaxRequestOnChange())?cb.after(h):h([])}})};f.initSection=function(b){var a=this;b.sortable({items:"div.form_field",placeholder:"preview",
receive:function(b,c){$(this).find("div.field_type").each(function(){a.addNewField($(this))})},start:function(b,c){a.startIndex=c.item.index()},stop:function(b,c){a.startIndex!=c.item.index()&&("field"==a.current.type&&(a.currentFieldOrd=$("#organizer_form_field_"+a.current.id).index()),a.changeMadeToPanel())}})};f.removeNoItemsMessage=function(b){$("#organizer_section_"+b).removeClass("empty").find("span.no_fields_message").remove()};f.addNewField=function(b){var a="t"+this.maxNewCustomField++,d=
b.data("type"),c={id:a,type:d,label:"Untitled"},e="";this.removeNoItemsMessage(this.currentTab);if(-1<$.inArray(d,["checkboxes","radios","select"])){c.lov={};for(var g=1;3>=g;g++){var h="t"+this.maxNewCustomFieldValue++;c.lov[h]={is_new_value:!0,id:h,ord:g,label:"Option "+g}}}if("centralised_radios"==d||"centralised_select"==d){for(method in this.tuix.centralised_lists.values)if(l(this.tuix.centralised_lists.values,method)){e=method;break}c.lov=_._tA(this.tuix.centralised_lists.initial_lov)}mergeFields=
_._cl(c);c.lov&&(mergeFields.lov=this.getOrderedItems(c.lov));d=this.microTemplate(k.z+"organizer_admin_box_builder_field",mergeFields);b.replaceWith(d);$.extend(c,{is_protected:0,include_in_export:0,is_new_field:!0,just_added:!0,db_column:"",is_system_field:0,validation:"none",required:0,show_in_organizer:0,create_index:0,organizer_visibility:"hide",values_source:e,values_source_filter:"",remove:!1});this.tuix.items[this.currentTab].fields[a]=c;b=$("#organizer_form_field_"+a);b.effect({effect:"highlight",
duration:1E3});this.initField(b);this.fieldClick(b)};f.tabClick=function(b){var a=this,d=b.data("name"),c=function(c){_._isEm(c)&&($("#organizer_section_"+a.currentTab).sortable("disable"),a.unselectField(),oldTab=a.currentTab,a.currentTab=d,$("#organizer_section_"+a.currentTab).sortable("enable"),$("#organizer_form_tabs div.tab").removeClass("on"),b.addClass("on"),$("#organizer_form_sections div.form_section").hide(),$("#organizer_section_"+a.currentTab).show(),a.currentTabOrd=b.index(),a.currentTab==
oldTab?(a.current={id:a.currentTab,type:"tab"},a.setCurrentTabDetails(),a.tuix.items[a.currentTab]&&1==a.tuix.items[a.currentTab].is_system_field?$("#organizer_remove_form_tab").hide():$("#organizer_remove_form_tab").show(),a.showDetailsSection("organizer_tab_details")):a.showDetailsSection("organizer_field_type_list"))};this.save();(cb=this.ajaxRequestOnChange(d))?cb.after(c):c([])};f.setCurrentTabDetails=function(){var b=this.getCurrentTabDetailsMergeFields(),b=this.microTemplate(k.z+"organizer_admin_box_builder_tab_details",
b);$("#organizer_tab_details_outer").html(b);this.initCurrentTabDetails()};f.getCurrentTabDetailsMergeFields=function(){var b=this.tuix.items[this.currentTab]||{},a=_._cl(b),d={};for(tabName in this.tuix.items)if(l(this.tuix.items,tabName)){tabDetails=this.tuix.items[tabName];var c={};for(fieldID in tabDetails.fields)l(tabDetails.fields,fieldID)&&(fieldDetails=tabDetails.fields[fieldID],"group"===fieldDetails.type||"checkbox"===fieldDetails.type)&&(c[fieldID]={ord:fieldDetails.ord,label:fieldDetails.label});
d[tabName]={label:tabDetails.label,ord:tabDetails.ord,childOptions:c}}a.parent_field_id_options=this.createSelectList(d,b.parent_field_id," -- No conditional display --",!0);return a};f.initCurrentTabDetails=function(){var b=this;$("#organizer_tab_details :input").off().on("change",function(){b.changeMadeToPanel()});$('#organizer_tab_details input[type="text"], #organizer_tab_details textarea').on("keyup",function(){b.changeMadeToPanel()});$("#tab__label").on("keyup",function(){$("#organizer_form_tab_"+
b.currentTab+" span, #zenario_tab_details_header_content h5").text($(this).val())});$("#organizer_remove_form_tab").on("click",function(){0==b.tuix.items[b.current.id].is_system_field&&(b.deleting="tab",q._sM("Are you sure you want to delete this Tab?<br><br>All fields on this tab will also be deleted.","Delete","warning",!0),b.listenForDelete())});this.initAddNewFieldsButton()};f.getCurrentTabDetails=function(){var b={};$.each($("#organizer_tab_details_form").serializeArray(),function(a,d){b[d.name]=
d.value});return b};f.fieldClick=function(b){var a=this,d=function(c){_._isEm(c)&&(c=b.data("id"),a.current={type:"field",id:c},a.currentFieldOrd=b.index(),$(a.formFieldsSelector).removeClass("selected"),b.addClass("selected"),a.currentFieldTab="details",a.setCurrentFieldDetails(),$(a.formFieldInlineButtonsSelector).hide(),$("#organizer_form_field_inline_buttons_"+a.current.id).show(),a.showDetailsSection("organizer_field_details"))};this.save();(cb=this.ajaxRequestOnChange())?cb.after(d):d([])};
f.setCurrentFieldDetails=function(){var b=this.getCurrentFieldDetailsMergeFields(),b=this.microTemplate(k.z+"organizer_admin_box_builder_field_details",b);$("#organizer_field_details_outer").html(b);this.initCurrentFieldDetails()};f.getCurrentFieldDetailsMergeFields=function(){var b=this.tuix.items[this.currentTab].fields[this.current.id]||{},a=_._cl(b);a.currentFieldTab=this.currentFieldTab;a.dataset_label=this.tuix.dataset_label;a.is_text_field=-1<$.inArray(b.type,["date","editor","text","textarea",
"url"]);a.is_checkbox_field=-1<$.inArray(b.type,["group","checkbox"]);a.is_list_field=-1<$.inArray(b.type,["checkboxes","radios","centralised_radios","select","centralised_select"]);a.cannot_export=-1<$.inArray(b.type,["editor","textarea","file_picker"]);switch(b.type){case "group":a.formattedType="Group";break;case "checkbox":a.formattedType="Checkbox";break;case "checkboxes":a.formattedType="Checkboxes";break;case "date":a.formattedType="Date";break;case "editor":a.formattedType="Editor";break;
case "radios":a.formattedType="Radios";break;case "centralised_radios":a.formattedType="Centralised radios";break;case "select":a.formattedType="Select";break;case "centralised_select":a.formattedType="Centralised select";break;case "text":a.formattedType="Text";break;case "textarea":a.formattedType="Textarea";break;case "url":a.formattedType="URL";break;case "other_system_field":a.formattedType="Other system field";break;case "dataset_select":a.formattedType="Dataset select";break;case "dataset_picker":a.formattedType=
"Dataset picker";break;case "file_picker":a.formattedType="File picker";break;default:a.formattedType="Unknown"}b.is_system_field&&(a.formattedType+=", system field");b.record_count&&(plural=1==b.record_count?"":"s",a.formattedRecordCount="("+b.record_count+" record"+plural+")");var d={},c=1,e,g;for(e in this.tuix.centralised_lists.values)l(this.tuix.centralised_lists.values,e)&&(g=this.tuix.centralised_lists.values[e],d[e]={ord:c++,label:g.label});a.values_source_options=this.createSelectList(d,
b.values_source);this.tuix.centralised_lists.values[a.values_source]&&this.tuix.centralised_lists.values[a.values_source].info.can_filter&&(a.show_source_filter=!0,a.source_filter_label=this.tuix.centralised_lists.values[a.values_source].info.filter_label);a.dataset_foreign_key_id_options=this.createSelectList(this.tuix.datasets,a.dataset_foreign_key_id);d={};for(tabName in this.tuix.items)if(l(this.tuix.items,tabName)){tab=this.tuix.items[tabName];c={};for(fieldID in tab.fields)l(tab.fields,fieldID)&&
(fieldDetails=tab.fields[fieldID],"group"!==fieldDetails.type&&"checkbox"!==fieldDetails.type||fieldID==this.current.id||(c[fieldID]={ord:fieldDetails.ord,label:fieldDetails.label}));d[tabName]={label:tab.label,ord:tab.ord,childOptions:c}}a.parent_id_options=this.createSelectList(d,a.parent_id," -- Select --",!0);a.width_options=this.createSelectList({1:{ord:1,label:"1 character (em)"},5:{ord:2,label:"5 characters (em)"},10:{ord:3,label:"10 characters (em)"},25:{ord:4,label:"25 characters (em)"},
40:{ord:5,label:"40 characters (em)"},56:{ord:6,label:"56 characters (em)"}},a.width," -- Default width -- ");a.height_options=this.createSelectList({3:{ord:1,label:"3 rows"},5:{ord:2,label:"5 rows"},10:{ord:3,label:"10 rows"},20:{ord:4,label:"20 rows"}},a.height," -- Default rows -- ");a.admin_box_visibility_options=this.createSelectList({show:{ord:1,label:"Show"},show_on_condition:{ord:2,label:"Show on condition"},hide:{ord:3,label:"Hide"}},a.admin_box_visibility);a.store_file_options=this.createRadioList({in_docstore:{ord:1,
label:"Docstore"},in_database:{ord:2,label:"Database"}},a.store_file,"store_file");d=a.is_system_field?!0:!1;a.validation_options=this.createRadioList({none:{ord:1,label:"None"},email:{ord:2,label:"Email"},emails:{ord:3,label:"Multiple emails"},no_spaces:{ord:4,label:"No spaces allowed"},numeric:{ord:5,label:"Numeric"},screen_name:{ord:6,label:"Screen name"}},a.validation,"validation",d);c={0:{ord:1,label:"Don't index"},1:{ord:2,label:"Index"}};r.IN(b.type,"checkbox","group","radios","select","dataset_select",
"dataset_picker","file_picker","centralised_radios","centralised_select")?(b.create_index=!0,c[1].disabled=!0,c[0].disabled=!0):r.IN(b.type,"text","date")&&b.just_added&&(b.create_index=!0);a.create_index_options=this.createRadioList(c,b.create_index,"create_index",d);a.show_searchable_field=a.is_text_field?a.show_in_organizer:a.show_in_organizer&&a.create_index;a.organizer_visibility_options=this.createSelectList({hide:{ord:1,label:"Hide by default"},show_by_default:{ord:2,label:"Show by default"},
always_show:{ord:3,label:"Always show"}},a.organizer_visibility);a.showDetailsTab=!0;a.showValidationTab="other_system_field"!=a.type;a.showOrganizerTab="other_system_field"!=a.type;a.showValuesTab="other_system_field"!=a.type&&-1!=$.inArray(a.type,["select","radios","checkboxes","centralised_radios","centralised_select"]);return a};f.initCurrentFieldDetails=function(){for(var b=this,a=this.tuix.items[this.currentTab].fields[this.current.id]||{},d="",c=0;c<this.formatOnChange.length;c++)0!=c&&(d+=
", "),d+="#field_container__"+this.formatOnChange[c]+" :input";$(d).on("change",function(){b.formatFieldDetails()});$("#organizer_field_details :input").on("change",function(){b.changeMadeToPanel()});$('#organizer_field_details input[type="text"], #organizer_field_details textarea').on("keyup",function(){b.changeMadeToPanel()});$("#field__label").on("keyup",function(){$("#organizer_form_field_"+b.current.id+" .label, #zenario_field_details_header_content h5").text($(this).val());if(a.just_added){var c=
$(this).val().toLowerCase().replace(/[\s-]+/g,"_").replace(/[^a-z_0-9]/g,"");$("#field__db_column").val(c)}});$("#field__note_below").on("keyup",function(){var a=$(this).val(),c=$("#organizer_form_field_note_below_"+b.current.id);$("#organizer_form_field_note_below_"+b.current.id+" div.zenario_note_content").html(a);c.toggle(""!==a)});$("#field__side_note").on("keyup",function(){var a=$(this).val(),c=$("#organizer_form_field_side_note_"+b.current.id);$("#organizer_form_field_side_note_"+b.current.id+
" div.zenario_note_content").html(a);c.toggle(""!==a)});d={min:0,max:5,slide:function(a,c){var d=$("#organizer_form_field_"+b.current.id),e=d.prop("class").split(/\s+/),f;for(f=0;f<e.length;f++)if(0<=e[f].lastIndexOf(k.z+"indent_level_",0)){d.removeClass(e[f]);break}0<c.value?d.addClass(k.z+"indent_level zenario_indent_level_"+c.value):d.removeClass(k.z+"indent_level")},change:function(a,c){b.changeMadeToPanel();$("#field__indent").val(c.value)}};a.indent&&(d.value=a.indent);$("#field__indent_slider").slider(d);
$("#field_container__values_source :input").on("change",function(){$("#field_container__values_source_filter :input").val("");var a=$(this).val();b.updateCentralisedRadioValues(b.current.id,a,"")});var e=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();$("#field_container__values_source_filter :input").on("keyup",function(){var a=$("#field_container__values_source :input").val(),c=$(this).val();e(function(){b.updateCentralisedRadioValues(b.current.id,a,c)},1E3)});d=this.getOrderedItems(a.lov);
d=this.microTemplate(k.z+"organizer_admin_box_builder_field_value",d);$("#field_values_list").html(d).sortable({axis:"y",start:function(a,c){b.startIndex=c.item.index()},stop:function(c,d){b.startIndex!=d.item.index()&&(b.save(),b.setCurrentFieldValues(a),b.changeMadeToPanel())}});this.initFieldValues(a);this.initAddNewFieldValuesButton(a);this.initAddNewFieldsButton()};f.updateCentralisedRadioValues=function(b,a,d){this.sendAJAXRequest({mode:"get_centralised_lov",method:a,filter:d}).after(function(a){a=
JSON.parse(a);a=this.microTemplate(k.z+"organizer_admin_box_builder_radio_values_preview",a);$("#organizer_form_field_values_"+b).html(a)})};f.getCurrentFieldDetails=function(){var b={},a=this.tuix.items[this.currentTab].fields[this.current.id];$.each($("#organizer_field_details_form").serializeArray(),function(a,c){b[c.name]=c.value});$("#organizer_field_details_form input[type=checkbox]").map(function(a,c){b[c.name]=c.checked?1:0});-1==["select","radios","checkboxes"].indexOf(a.type)||a.field_id||
(b.lov=this.getCurrentFieldValues(a));b.create_index&&(b.create_index=parseInt(b.create_index));return b};f.save=function(){var b,a,d={};if(this.current.id&&this.current.type)if("tab"==this.current.type){if(d=this.getCurrentTabDetails(),this.tuix.items[this.current.id]||(this.tuix.items[this.current.id]={}),!this.tuix.items[this.current.id].remove)for(b in d)l(d,b)&&(a=d[b],this.tuix.items[this.current.id][b]=a)}else if("field"==this.current.type&&(d=this.getCurrentFieldDetails(),this.tuix.items[this.currentTab].fields[this.current.id]||
(this.tuix.items[this.currentTab].fields[this.current.id]={}),!this.tuix.items[this.currentTab].fields[this.current.id].remove))for(b in d)l(d,b)&&(a=d[b],this.tuix.items[this.currentTab].fields[this.current.id][b]=a)};f.ajaxRequestOnChange=function(b){var a=this,d=new r.callback,c={};this.current.id&&this.current.type&&(c.validate=!0,c.id=this.current.id,c.type=this.current.type,c.items=JSON.stringify(this.tuix.items),"field"==this.current.type&&(c.tab=this.currentTab,c.fieldTab=this.currentFieldTab));
b&&this.tuix.items[b]&&!this.tuix.items[b].field_records_fetched&&(c.loadingTab=b);return c?(c.mode="ajaxRequestOnChange",this.sendAJAXRequest(c).after(function(e){e=JSON.parse(e);errors=[];if(e&&(e.errors&&(errors=e.errors),b&&a.tuix.items[b]&&(a.tuix.items[b].field_records_fetched=!0,e.record_counts)))for(fieldId in e.record_counts)l(e.record_counts,fieldId)&&(recordCount=e.record_counts[fieldId],a.tuix.items[b].fields[fieldId]&&(a.tuix.items[b].fields[fieldId].record_count=recordCount));if("tab"==
c.type)if($("#organizer_tab_field_error").remove(),0<errors.length){e=$('<div id="organizer_tab_field_error"></div>');for(index in errors)l(errors,index)&&(message=errors[index],e.append('<p class="error">'+message+"</p>"));$("#organizer_tab_details").prepend(e);a.shakeBox("#organizer_admin_form_builder .form_fields_palette")}else a.tuix.items[a.currentTab].just_added&&delete a.tuix.items[a.currentTab].just_added;else if("field"==c.type)if($("#organizer_form_field_error").remove(),0<errors.length){e=
$('<div id="organizer_form_field_error"></div>');for(index in errors)l(errors,index)&&(message=errors[index],e.append('<p class="error">'+message+"</p>"));$("#organizer_field_details").prepend(e);a.shakeBox("#organizer_admin_form_builder .form_fields_palette")}else a.tuix.items[a.currentTab].fields[a.current.id].just_added&&delete a.tuix.items[a.currentTab].fields[a.current.id].just_added;d.call(errors)}),d):!1};f.saveItemsOrder=function(){var b=this;$("#organizer_form_tabs div.tab.sort").each(function(a,
d){var c=$(d).data("name");b.tuix.items[c].ord=a+1;$("#organizer_section_"+c+" .form_field").each(function(a,d){var f=$(d).data("id");b.tuix.items[c].fields[f].ord=a+1;b.tuix.items[c].fields[f].tab_name=c})})}},zenarioO.panelTypes);
