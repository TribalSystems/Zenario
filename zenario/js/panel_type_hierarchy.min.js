zenario.lib(function(m,t,f,w,x,y,k,q,z,A,h,u,B,C,D,E,F,v,p,n){f=p(n.hierarchy=v(n.list,function(){this.openItemsInHierarchy={}}));f.returnPageSize=function(){return!1};f.returnInspectionViewEnabled=function(){return!1};f.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};f.showPanel=function(d,b,c){var e,a,l,g=h.getPanelItems(!0),f=this.ordinalColumn(),m=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=!1;
this.setHeader(d);for(e in g.items)k.has(g.items,e)&&(a=g.items[e],a.items=[],this.itemsById[a.id]=a);for(e=g.items.length-1;0<=e;--e)a=g.items[e],l=a.tuix[m],k.engToBoolean(l)?(g.items.splice(e,1),this.itemsById[l]&&(this.itemsById[l].items.splice(0,0,a),this.parentIdOf[a.id]=l)):l=0,f&&(this.ordinals[l]||(this.ordinals[l]={}),this.ordinals[l][a.id]=a.tuix[f],a.canDrag=!0);b.html(q.microTemplate("zenario_organizer_hierarchy",g));b.show();this.setScroll(b);this.setupHierarchy(d,b,c);c.html("").show();
this.setTooltips(d,b,c)};f.setupHierarchy=function(d,b,c){var e=this,a;c=!0;d={};b=b.find(".dd");b.nestable({maxDepth:this.tuix.hierarchy&&this.tuix.hierarchy.depth||99});if(this.searchTerm===m){b.nestable("collapseAll");if(this.openItemsInHierarchy)for(a in this.openItemsInHierarchy)k.has(this.openItemsInHierarchy,a)&&(d[a]=!0);for(a in this.selectedItems)k.has(this.selectedItems,a)&&this.parentIdOf[a]&&(d[this.parentIdOf[a]]=!0);for(;c;)for(a in c=!1,d)k.has(d,a)&&this.parentIdOf[a]&&!d[this.parentIdOf[a]]&&
(c=d[this.parentIdOf[a]]=!0);for(a in d)k.has(d,a)&&(c=$(u("organizer_item_"+a)).parent(),c.length&&b.nestable("expandItem",c))}b.on("collapseItem",function(){e.collapseItem()});b.on("expandItem",function(){e.expandItem()});if(this.ordinalColumn()&&this.searchTerm===m)b.on("change",function(){(e.changingHierarchy=e.scanNewHier(!1))?h.disableInteraction():h.enableInteraction();h.setButtons()});this.$dd=b};f.collapseItem=function(){this.recordOpenItems();var d=!1,b;for(b in this.selectedItems)k.has(this.selectedItems,
b)&&!this.openItemsInHierarchy[b]&&(delete this.selectedItems[b],d=!0);d&&(h.setButtons(!0),h.setHash())};f.expandItem=function(){this.recordOpenItems()};f.showButtons=function(d){var b=this;this.changingHierarchy?(d.html(q.microTemplate("zenario_organizer_apply_cancel_buttons",{})),d.find("#organizer_applyButton").click(function(){b.scanNewHier(!0);h.enableInteraction();h.refresh()}),d.find("#organizer_cancelButton").click(function(){h.enableInteraction();h.refresh()})):p(n.list).showButtons.call(this,
d)};f.scanNewHier=function(d){var b=this.$dd.nestable("serialize_zenario_modified_version"),c,e,a,f=!1,g={},n=this.ordinalColumn();for(e in b)if(k.has(b,e)){var p=!1,s=!1,r=b[e].length;for(a=1;a<=r;++a)c=b[e][a-1],c===m||this.ordinals&&this.ordinals[e]&&this.ordinals[e][c]!==m&&this.ordinals[e][c]==a||(g[c]={parentId:e,ordinal:a},f=p=!0);if(p){for(a=1;a<=r;++a)if(c=b[e][a-1],!g[c]&&a!=this.tuix.items[c][n]){s=!0;break}if(s)for(a=1;a<=r;++a)c=b[e][a-1],g[c]={parentId:e,ordinal:a}}}if(!d)return f;if(f){d=
h.getKey();b="";d.hierarchy=!0;for(c in g)k.has(g,c)&&(b+=(b?",":"")+c,d["parent_id__"+c]=g[c].parentId,d.reorder=!0,d["ordinal__"+c]=g[c].ordinal,d["item__"+c]=g[c].ordinal,this.tuix.items[c][n]=g[c].ordinal);d.id=b;c="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+h.path+"&method_call=handleOrganizerPanelAJAX";delete k.rev;(c=k.nonAsyncAJAX(t+c,d))&&q.showMessage(c)}};f.recordOpenItems=function(){var d=this;this.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(b,
c){var e,a=$(c);a.find("ol.dd-list:visible").size()&&(e=a.data("id"))&&(d.openItemsInHierarchy[e]=!0)})};f.returnDoSortingAndSearchingOnServer=function(){return!1};f.sortAndSearchItems=function(d){var b,c=this.sortItems(),e=this.searchItems(_.clone(c),d),a=_.object(e,e),f=this.parentIdColumn();h.nonSearchMatches={};for(d=0;d<e.length;++d)b=e[d],(b=this.tuix.items[b]&&this.tuix.items[b][f])&&a[b]===m&&(e.push(b),a[b]=b,h.nonSearchMatches[b]=!0);for(d=c.length;0<=d;--d)b=c[d],a[b]===m&&c.splice(d,1);
return c}},zenarioO.panelTypes);
