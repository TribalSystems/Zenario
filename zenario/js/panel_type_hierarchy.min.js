zenario.lib(function(m,u,g,A,B,C,s,v,w,D,E,k,F,n,p,G,H,I,x,q,l,r,J,t,K,L,M,N,O,P,Q,R,S,T,U,y,V,W,X,z){g=q(r.hierarchy=x(r.list,function(){this.openItemsInHierarchy={}}));g.returnPageSize=function(){return!1};g.returnInspectionViewEnabled=function(){return!1};g.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};g.showPanel=function(a,b,d){var e={},c,h,f,g=this.getItems(),k=this.ordinalColumn(),m=this.parentIdColumn();this.itemsById={};this.parentIdOf={};
this.ordinals={};this.changingHierarchy=!1;this.setHeader(a);for(c in g.items)l(g.items,c)&&(h=g.items[c],h.items=[],this.itemsById[h.id]=h);for(c=g.items.length-1;0<=c;--c)h=g.items[c],f=h.tuix[m],s._eTB(f)?(g.items.splice(c,1),this.itemsById[f]&&(this.itemsById[f].items.splice(0,0,h),this.parentIdOf[h.id]=f)):f=0,k&&(e[f]||(e[f]=[],this.ordinals[f]={}),e[f].push(this.ordinals[f][h.id]={id:h.id,ord:h.tuix[k]}),h.canDrag=!0);for(f in e)if(l(e,f))for(h=e[f],h.sort(w.sortArrayByOrd),c=0;c<h.length;++c)h[c].normOrd=
c+1;e=this.getHierarchyMicroTemplateHTML(g);b.html(e);b.show();this.setupHierarchy(a,b,d);this.setScroll(b);d.html("").show();this.setTooltips(a,b,d)};g.getHierarchyMicroTemplateHTML=function(a){return this.microTemplate(t+"organizer_hierarchy",a)};g.getItems=function(){return this.getMergeFieldsForItemsAndColumns()};g.getItemPosition=function(a){a=$(n("organizer_item_"+a));var b=a.position();b&&0==b.top&&0==b.left&&(b=a.parent().position());return b};g.setupHierarchy=function(a,b,d){var e=this;d=
this.tuix.hierarchy||{};var c,h=!0;a={};var f=b.find(".dd");f.nestable({maxDepth:d.max_depth||99});if(this.searchTerm===m&&!p(d.start_with_all_items_open)){f.nestable("collapseAll");if(this.openItemsInHierarchy)for(c in this.openItemsInHierarchy)l(this.openItemsInHierarchy,c)&&(a[c]=!0);for(c in this.selectedItems)l(this.selectedItems,c)&&this.parentIdOf[c]&&(a[this.parentIdOf[c]]=!0);for(;h;)for(c in h=!1,a)l(a,c)&&this.parentIdOf[c]&&!a[this.parentIdOf[c]]&&(h=a[this.parentIdOf[c]]=!0);for(c in a)l(a,
c)&&(b=$(n("organizer_item_"+c)).parent(),b.length&&f.nestable("expandItem",b))}f.on("collapseItem",function(){e.collapseItem();e.hideHandles(f)});f.on("expandItem",function(){e.expandItem();e.hideHandles(f)});if(this.ordinalColumn()&&this.searchTerm===m)f.on("change",function(){(e.changingHierarchy=e.scanNewHier(!1))?k._dI():k._eI();k._sB()});this.$dd=f;this.hideHandles(f)};g.hideHandles=function(a){var b=this.tuix.hierarchy;b&&(p(b.disable_dragging_top_level)?(a.find(".dd-handle").hide(),p(b.disable_dragging_children)||
a.find(".dd-item .dd-item .dd-handle").show()):p(b.disable_dragging_children)&&a.find(".dd-item .dd-item .dd-handle").hide())};g.collapseItem=function(){this.recordOpenItems();var a=!1,b;for(b in this.selectedItems)l(this.selectedItems,b)&&!this.openItemsInHierarchy[b]&&(delete this.selectedItems[b],a=!0);a&&(k._sB(!0),k._sH())};g.expandItem=function(){this.recordOpenItems()};g.showButtons=function(a){var b=this;this.changingHierarchy?(a.html(this.microTemplate(t+"organizer_apply_cancel_buttons",
{})),a.find("#organizer_applyButton").click(function(){b.scanNewHier(!0)}),a.find("#organizer_cancelButton").click(function(){k._eI();k._r()})):q(r.list).showButtons.call(this,a)};g.scanNewHier=function(a){var b=this.$dd.nestable("serialize_zenario_modified_version"),d,e,c,h=!1,f={},g={},r=this.ordinalColumn();for(e in b)if(l(b,e)){var n=!1,q=b[e].length;for(c=1;c<=q;++c)if(d=b[e][c-1],d!==m)if(g[d]={parentId:e,ordinal:c},this.ordinals&&this.ordinals[e]&&this.ordinals[e][d]&&this.ordinals[e][d].normOrd==
c)this.ordinals[e][d].ord!=c&&(n=!0);else if(h=!0,a&&n){for(c=1;c<=q;++c)d=b[e][c-1],d!==m&&(f[d]={parentId:e,ordinal:c});break}else f[d]={parentId:e,ordinal:c}}if(!a)return h;if(h){a=k._gK();b="";a.hierarchy=!0;a.ordinals={};a.parent_ids={};this.tuix.hierarchy&&p(this.tuix.hierarchy.send_full_hierarchy_onchange)&&(f=g);for(d in f)l(f,d)&&(b+=(b?",":"")+d,a.parent_ids[d]=f[d].parentId,a.ordinals[d]=f[d].ordinal,a.reorder=!0,this.tuix.items[d][r]=f[d].ordinal);a.id=b;d=z+"?__pluginClassName__="+this.tuix.class_name+
"&__path__="+k.path+y+"handleOrganizerPanelAJAX";delete s.rev;s._a(u+d,a).after(function(a){a&&v._sM(a);k._eI();k._r()})}};g.recordOpenItems=function(){var a=this;this.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(b,d){var e,c=$(d);c.find("ol.dd-list:visible").size()&&(e=c.data("id"))&&(a.openItemsInHierarchy[e]=!0)})};g.returnDoSortingAndSearchingOnServer=function(){return!1};g.sortAndSearchItems=function(a){var b,d=this.sortItems(),e=this.searchItems(_._cl(d),
a),c=_._o(e,e),g=this.parentIdColumn();k.nonSearchMatches={};for(a=0;a<e.length;++a)b=e[a],(b=this.tuix.items[b]&&this.tuix.items[b][g])&&c[b]===m&&(e.push(b),c[b]=b,k.nonSearchMatches[b]=!0);for(a=d.length;0<=a;--a)b=d[a],c[b]===m&&d.splice(a,1);return d}},zenarioO.panelTypes);
