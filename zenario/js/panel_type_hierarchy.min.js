zenario.lib(function(m,s,f,v,w,x,l,p,y,z,k,t,A,B,C,D,E,u,r,n){f=r(n.hierarchy=u(n.list,function(){this.openItemsInHierarchy={}}));f.returnPageSize=function(){return!1};f.returnInspectionViewEnabled=function(){return!1};f.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};f.showPanel=function(c,b,d){var e={},a,h,g,f=k.getPanelItems(!0),m=this.ordinalColumn(),q=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=
!1;this.setHeader(c);for(a in f.items)l.has(f.items,a)&&(h=f.items[a],h.items=[],this.itemsById[h.id]=h);for(a=f.items.length-1;0<=a;--a)h=f.items[a],g=h.tuix[q],l.engToBoolean(g)?(f.items.splice(a,1),this.itemsById[g]&&(this.itemsById[g].items.splice(0,0,h),this.parentIdOf[h.id]=g)):g=0,m&&(e[g]||(e[g]=[],this.ordinals[g]={}),e[g].push(this.ordinals[g][h.id]={id:h.id,ord:h.tuix[m]}),h.canDrag=!0);for(g in e)if(l.has(e,g))for(h=e[g],h.sort(p.sortArrayByOrd),a=0;a<h.length;++a)h[a].normOrd=a+1;b.html(p.microTemplate("zenario_organizer_hierarchy",
f));b.show();this.setScroll(b);this.setupHierarchy(c,b,d);d.html("").show();this.setTooltips(c,b,d)};f.setupHierarchy=function(c,b,d){var e=this,a;d=!0;c={};b=b.find(".dd");b.nestable({maxDepth:this.tuix.hierarchy&&this.tuix.hierarchy.depth||99});if(this.searchTerm===m){b.nestable("collapseAll");if(this.openItemsInHierarchy)for(a in this.openItemsInHierarchy)l.has(this.openItemsInHierarchy,a)&&(c[a]=!0);for(a in this.selectedItems)l.has(this.selectedItems,a)&&this.parentIdOf[a]&&(c[this.parentIdOf[a]]=
!0);for(;d;)for(a in d=!1,c)l.has(c,a)&&this.parentIdOf[a]&&!c[this.parentIdOf[a]]&&(d=c[this.parentIdOf[a]]=!0);for(a in c)l.has(c,a)&&(d=$(t("organizer_item_"+a)).parent(),d.length&&b.nestable("expandItem",d))}b.on("collapseItem",function(){e.collapseItem()});b.on("expandItem",function(){e.expandItem()});if(this.ordinalColumn()&&this.searchTerm===m)b.on("change",function(){(e.changingHierarchy=e.scanNewHier(!1))?k.disableInteraction():k.enableInteraction();k.setButtons()});this.$dd=b};f.collapseItem=
function(){this.recordOpenItems();var c=!1,b;for(b in this.selectedItems)l.has(this.selectedItems,b)&&!this.openItemsInHierarchy[b]&&(delete this.selectedItems[b],c=!0);c&&(k.setButtons(!0),k.setHash())};f.expandItem=function(){this.recordOpenItems()};f.showButtons=function(c){var b=this;this.changingHierarchy?(c.html(p.microTemplate("zenario_organizer_apply_cancel_buttons",{})),c.find("#organizer_applyButton").click(function(){b.scanNewHier(!0);k.enableInteraction();k.reload()}),c.find("#organizer_cancelButton").click(function(){k.enableInteraction();
k.reload()})):r(n.list).showButtons.call(this,c)};f.scanNewHier=function(c){var b=this.$dd.nestable("serialize_zenario_modified_version"),d,e,a,h=!1,g={},f=this.ordinalColumn();for(e in b)if(l.has(b,e)){var n=!1,q=b[e].length;for(a=1;a<=q;++a)if(d=b[e][a-1],d!==m)if(this.ordinals&&this.ordinals[e]&&this.ordinals[e][d]&&this.ordinals[e][d].normOrd==a)this.ordinals[e][d].ord!=a&&(n=!0);else if(h=!0,c&&n){for(a=1;a<=q;++a)d=b[e][a-1],d!==m&&(g[d]={parentId:e,ordinal:a});break}else g[d]={parentId:e,ordinal:a}}if(!c)return h;
if(h){c=k.getKey();b="";c.hierarchy=!0;for(d in g)l.has(g,d)&&(b+=(b?",":"")+d,c["parent_id__"+d]=g[d].parentId,c.reorder=!0,c["ordinal__"+d]=g[d].ordinal,c["item__"+d]=g[d].ordinal,this.tuix.items[d][f]=g[d].ordinal);c.id=b;d="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+k.path+"&method_call=handleOrganizerPanelAJAX";delete l.rev;(d=l.nonAsyncAJAX(s+d,c))&&p.showMessage(d)}};f.recordOpenItems=function(){var c=this;this.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(b,
d){var e,a=$(d);a.find("ol.dd-list:visible").size()&&(e=a.data("id"))&&(c.openItemsInHierarchy[e]=!0)})};f.returnDoSortingAndSearchingOnServer=function(){return!1};f.sortAndSearchItems=function(c){var b,d=this.sortItems(),e=this.searchItems(_.clone(d),c),a=_.object(e,e),f=this.parentIdColumn();k.nonSearchMatches={};for(c=0;c<e.length;++c)b=e[c],(b=this.tuix.items[b]&&this.tuix.items[b][f])&&a[b]===m&&(e.push(b),a[b]=b,k.nonSearchMatches[b]=!0);for(c=d.length;0<=c;--c)b=d[c],a[b]===m&&d.splice(c,1);
return d}},zenarioO.panelTypes);
