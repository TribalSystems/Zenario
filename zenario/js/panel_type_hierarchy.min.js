zenario.lib(function(g,t,x,y,z,A,s,u,v,B,C,k,D,m,n,p,E,F,G,w,q,l,r){g=q(r.hierarchy=w(r.list,function(){this.openItemsInHierarchy={}}));g.returnPageSize=function(){return!1};g.returnInspectionViewEnabled=function(){return!1};g.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};g.showPanel=function(b,c,e){var a={},d,h,f,g=this.getItems(),k=this.ordinalColumn(),m=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=
!1;this.setHeader(b);for(d in g.items)l(g.items,d)&&(h=g.items[d],h.items=[],this.itemsById[h.id]=h);for(d=g.items.length-1;0<=d;--d)h=g.items[d],f=h.tuix[m],s._eTB(f)?(g.items.splice(d,1),this.itemsById[f]&&(this.itemsById[f].items.splice(0,0,h),this.parentIdOf[h.id]=f)):f=0,k&&(a[f]||(a[f]=[],this.ordinals[f]={}),a[f].push(this.ordinals[f][h.id]={id:h.id,ord:h.tuix[k]}),h.canDrag=!0);for(f in a)if(l(a,f))for(h=a[f],h.sort(v.sortArrayByOrd),d=0;d<h.length;++d)h[d].normOrd=d+1;a=this.getHierarchyMicroTemplateHTML(g);
c.html(a);c.find("ol > li > div.organizer_can_choose").each(function(a,b){$(b).parent().parent().addClass("organizer_can_choose_children")});c.find("ol > li > div.organizer_cant_choose").each(function(a,b){$(b).parent().parent().addClass("organizer_cant_choose_children")});c.show();this.setupHierarchy(b,c,e);this.setScroll(c);e.html("").show();this.setTooltips(b,c,e)};g.getHierarchyMicroTemplateHTML=function(b){return this.microTemplate("zenario_organizer_hierarchy",b)};g.getItems=function(){return this.getMergeFieldsForItemsAndColumns()};
g.getItemPosition=function(b,c){for(var e=$(p("organizer_item_"+c)),a,d;e&&e[0]&&"organizer_items_wrapper"!=e[0].id&&(a=e.position());)a.top&&(d=a),e=e.parent();return d};g.setupHierarchy=function(b,c,e){var a=this;e=a.tuix.hierarchy||{};var d,h=!0;b={};var f=c.find(".dd");f.nestable({maxDepth:e.max_depth||99});if(!m(a.searchTerm)&&!n(e.start_with_all_items_open)){f.nestable("collapseAll");if(a.openItemsInHierarchy)for(d in a.openItemsInHierarchy)l(a.openItemsInHierarchy,d)&&(b[d]=!0);for(d in a.selectedItems)l(a.selectedItems,
d)&&a.parentIdOf[d]&&(b[a.parentIdOf[d]]=!0);for(;h;)for(d in h=!1,b)l(b,d)&&a.parentIdOf[d]&&!b[a.parentIdOf[d]]&&(h=b[a.parentIdOf[d]]=!0);for(d in b)l(b,d)&&(c=$(p("organizer_item_"+d)).parent(),c.length&&f.nestable("expandItem",c))}f.on("collapseItem",function(){a.collapseItem();a.hideHandles(f)});f.on("expandItem",function(){a.expandItem();a.hideHandles(f)});if(a.ordinalColumn()&&!m(a.searchTerm))f.on("change",function(){(a.changingHierarchy=a.scanNewHier(!1))?k._dI():k._eI();k._sB()});a.$dd=
f;a.hideHandles(f)};g.hideHandles=function(b){var c=this.tuix.hierarchy;c&&(n(c.disable_dragging_top_level)?(b.find(".dd-handle").hide(),n(c.disable_dragging_children)||b.find(".dd-item .dd-item .dd-handle").show()):n(c.disable_dragging_children)&&b.find(".dd-item .dd-item .dd-handle").hide())};g.collapseItem=function(){this.recordOpenItems();var b=!1,c;for(c in this.selectedItems)l(this.selectedItems,c)&&!this.openItemsInHierarchy[c]&&(delete this.selectedItems[c],b=!0);b&&(k._sB(!0),k._sH())};g.expandItem=
function(){this.recordOpenItems()};g.showButtons=function(b){var c=this;c.changingHierarchy?(b.html(c.microTemplate("zenario_organizer_apply_cancel_buttons",{})),b.find("#organizer_applyButton").click(function(){c.scanNewHier(!0)}),b.find("#organizer_cancelButton").click(function(){k._eI();k._r()})):q(r.list).showButtons.call(c,b)};g.scanNewHier=function(b){var c=this.$dd.nestable("serialize_zenario_modified_version"),e,a,d,h=!1,f={},g={},r=this.ordinalColumn();for(a in c)if(l(c,a)){var p=!1,q=c[a].length;
for(d=1;d<=q;++d)if(e=c[a][d-1],m(e))if(g[e]={parentId:a,ordinal:d},this.ordinals&&this.ordinals[a]&&this.ordinals[a][e]&&this.ordinals[a][e].normOrd==d)this.ordinals[a][e].ord!=d&&(p=!0);else if(h=!0,b&&p){for(d=1;d<=q;++d)e=c[a][d-1],m(e)&&(f[e]={parentId:a,ordinal:d});break}else f[e]={parentId:a,ordinal:d}}if(!b)return h;if(h){b=k._gK();c="";b.hierarchy=!0;b.ordinals={};b.parent_ids={};this.tuix.hierarchy&&n(this.tuix.hierarchy.send_full_hierarchy_onchange)&&(f=g);for(e in f)l(f,e)&&(c+=(c?",":
"")+e,b.parent_ids[e]=f[e].parentId,b.ordinals[e]=f[e].ordinal,b.reorder=!0,this.tuix.items[e][r]=f[e].ordinal);b.id=c;e="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+k.path+"&method_call=handleOrganizerPanelAJAX";delete s.rev;s._a(t+e,b).after(function(a){a&&u._sM(a);k._eI();k._r()})}};g.recordOpenItems=function(){var b=this;b.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(c,e){var a,d=$(e);d.find("ol.dd-list:visible").size()&&
(a=d.data("id"))&&(b.openItemsInHierarchy[a]=!0)})};g.returnDoSortingAndSearchingOnServer=function(){return!1};g.sortAndSearchItems=function(b){var c,e=this.sortItems(),a=this.searchItems(_._cl(e),b),d=_._o(a,a),g=this.parentIdColumn();k.nonSearchMatches={};for(b=0;b<a.length;++b)c=a[b],(c=this.tuix.items[c]&&this.tuix.items[c][g])&&!m(d[c])&&(a.push(c),d[c]=c,k.nonSearchMatches[c]=!0);for(b=e.length;0<=b;--b)c=e[b],m(d[c])||e.splice(b,1);return e}},zenarioO.panelTypes);
