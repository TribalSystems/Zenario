zenario.lib(function(l,C,D,E,F,G,v,z,A,H,I,n,J,r,u,x,K,L,M,B,y,q,w){l=y(w.hierarchy=B(w.list,function(){this.openItemsInHierarchy={}}));l.returnPageSize=function(){return!1};l.returnInspectionViewEnabled=function(){return!1};l.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};l.showPanel=function(b,c,d){var a={},e,f=this.getItems(),h=this.ordinalColumn(),p=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=
!1;this.setHeader(b);for(e in f.items)if(q(f.items,e)){var k=f.items[e];k.items=[];this.itemsById[k.id]=k}for(e=f.items.length-1;0<=e;--e){k=f.items[e];var m=k.tuix[p];v._unw(m)?(f.items.splice(e,1),this.itemsById[m]&&(this.itemsById[m].items.splice(0,0,k),this.parentIdOf[k.id]=m)):m=0;h&&(a[m]||(a[m]=[],this.ordinals[m]={}),a[m].push(this.ordinals[m][k.id]={id:k.id,ord:k.tuix[h]}),k.canDrag=!0)}for(m in a)if(q(a,m))for(k=a[m],k.sort(A.sortArrayByOrd),e=0;e<k.length;++e)k[e].normOrd=e+1;a=this.getHierarchyMicroTemplateHTML(f);
c.html(a);c.find("ol > li > div.organizer_can_choose").each(function(g,t){$(t).parent().parent().addClass("organizer_can_choose_children")});c.find("ol > li > div.organizer_cant_choose").each(function(g,t){$(t).parent().parent().addClass("organizer_cant_choose_children")});c.show();this.setupHierarchy(b,c,d);this.setScroll(c);d.html("").show();this.setTooltips(b,c,d)};l.getHierarchyMicroTemplateHTML=function(b){return this.microTemplate("zenario_organizer_hierarchy",b)};l.getItems=function(){return this.getMergeFieldsForItemsAndColumns()};
l.getItemPosition=function(b,c){b=$(x("organizer_item_"+c));for(var d,a;b&&b[0]&&"organizer_items_wrapper"!=b[0].id&&(d=b.position());)d.top&&(a=d),b=b.parent();return a};l.setupHierarchy=function(b,c,d){var a=this;d=a.tuix.hierarchy||{};var e,f=!0;b={};var h=c.find(".dd");h.nestable({maxDepth:d.max_depth||99});if(!r(a.searchTerm)&&!u(d.start_with_all_items_open)){h.nestable("collapseAll");if(a.openItemsInHierarchy)for(e in a.openItemsInHierarchy)q(a.openItemsInHierarchy,e)&&(b[e]=!0);for(e in a.selectedItems)q(a.selectedItems,
e)&&a.parentIdOf[e]&&(b[a.parentIdOf[e]]=!0);for(;f;)for(e in f=!1,b)q(b,e)&&a.parentIdOf[e]&&!b[a.parentIdOf[e]]&&(f=b[a.parentIdOf[e]]=!0);for(e in b)q(b,e)&&(c=$(x("organizer_item_"+e)).parent(),c.length&&h.nestable("expandItem",c))}h.on("collapseItem",function(){a.collapseItem();a.hideHandles(h)});h.on("expandItem",function(){a.expandItem();a.hideHandles(h)});if(a.ordinalColumn()&&!r(a.searchTerm))h.on("change",function(){(a.changingHierarchy=a.scanNewHier(!1))?n._x6q():n._rj7();n._96o()});a.$dd=
h;a.hideHandles(h)};l.hideHandles=function(b){var c=this.tuix.hierarchy;c&&(u(c.disable_dragging_top_level)?(b.find(".dd-handle").hide(),u(c.disable_dragging_children)||b.find(".dd-item .dd-item .dd-handle").show()):u(c.disable_dragging_children)&&b.find(".dd-item .dd-item .dd-handle").hide())};l.collapseItem=function(){this.recordOpenItems();var b=!1,c;for(c in this.selectedItems)q(this.selectedItems,c)&&!this.openItemsInHierarchy[c]&&(delete this.selectedItems[c],b=!0);b&&(n._96o(!0),n._1a4())};
l.expandItem=function(){this.recordOpenItems()};l.showButtons=function(b){var c=this;c.changingHierarchy?(b.html(c.microTemplate("zenario_organizer_apply_cancel_buttons",{})),b.find("#organizer_applyButton").click(function(){c.scanNewHier(!0)}),b.find("#organizer_cancelButton").click(function(){n._rj7();n._131()})):y(w.list).showButtons.call(c,b)};l.scanNewHier=function(b){var c=this.$dd.nestable("serialize_zenario_modified_version"),d,a,e=!1,f={},h={},p=this.ordinalColumn();for(d in c)if(q(c,d)){var k=
!1,m=c[d].length;for(a=1;a<=m;++a){var g=c[d][a-1];if(r(g))if(h[g]={parentId:d,ordinal:a},this.ordinals&&this.ordinals[d]&&this.ordinals[d][g]&&this.ordinals[d][g].normOrd==a)this.ordinals[d][g].ord!=a&&(k=!0);else if(e=!0,b&&k){for(a=1;a<=m;++a)g=c[d][a-1],r(g)&&(f[g]={parentId:d,ordinal:a});break}else f[g]={parentId:d,ordinal:a}}}if(!b)return e;if(e){b=n._i1();c="";b.hierarchy=!0;b.ordinals={};b.parent_ids={};this.tuix.hierarchy&&u(this.tuix.hierarchy.send_full_hierarchy_onchange)&&(f=h);for(g in f)q(f,
g)&&(c+=(c?",":"")+g,b.parent_ids[g]=f[g].parentId,b.ordinals[g]=f[g].ordinal,b.reorder=!0,this.tuix.items[g][p]=f[g].ordinal);b.id=c;g="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+n.path+"&method_call=handleOrganizerPanelAJAX";delete v.rev;v.ajax(v._ozg(g),b).after(function(t){t&&z._s34(t);n._rj7();n._131()})}};l.recordOpenItems=function(){var b=this;b.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(c,d){var a;c=$(d);c.find("ol.dd-list:visible").length&&
(a=c.data("id"))&&(b.openItemsInHierarchy[a]=!0)})};l.returnDoSortingAndSearchingOnServer=function(){return!1};l.sortAndSearchItems=function(b){var c,d,a=this.sortItems(),e=this.searchItems(_.clone(a),b),f=_._4z(e,e),h=this.parentIdColumn(),p={};n.nonSearchMatches={};if(e.length!=a.length){for(d=0;d<e.length;++d)b=e[d],(c=this.tuix.items[b]&&this.tuix.items[b][h])&&!r(f[c])&&(e.push(c),f[c]=c,n.nonSearchMatches[c]=!0);for(d=a.length;0<=d;--d)b=a[d],r(f[b])||a.splice(d,1)}for(d=0;d<a.length;++d)b=
a[d],c=this.tuix.items[b]&&this.tuix.items[b][h]||"","0"==c&&(c=""),r(p[c])||(p[c]=[]),p[c].push(b);a=p[""]||[];for(d=0;d<a.length;++d)b=a[d],r(p[b])&&(a=a.concat(p[b]));return a}},zenarioO.panelTypes);
