zenario.lib(function(m,v,g,y,z,A,s,t,B,C,k,r,D,w,n,E,F,G,x,p,l,q){g=p(q.hierarchy=x(q.list,function(){this.openItemsInHierarchy={}}));g.returnPageSize=function(){return!1};g.returnInspectionViewEnabled=function(){return!1};g.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};g.showPanel=function(a,c,d){var e={},b,h,f,g=this.getItems(),k=this.ordinalColumn(),m=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=
!1;this.setHeader(a);for(b in g.items)l(g.items,b)&&(h=g.items[b],h.items=[],this.itemsById[h.id]=h);for(b=g.items.length-1;0<=b;--b)h=g.items[b],f=h.tuix[m],s._eTB(f)?(g.items.splice(b,1),this.itemsById[f]&&(this.itemsById[f].items.splice(0,0,h),this.parentIdOf[h.id]=f)):f=0,k&&(e[f]||(e[f]=[],this.ordinals[f]={}),e[f].push(this.ordinals[f][h.id]={id:h.id,ord:h.tuix[k]}),h.canDrag=!0);for(f in e)if(l(e,f))for(h=e[f],h.sort(t.sortArrayByOrd),b=0;b<h.length;++b)h[b].normOrd=b+1;e=this.getHierarchyMicroTemplateHTML(g);
c.html(e);c.show();this.setScroll(c);this.setupHierarchy(a,c,d);d.html("").show();this.setTooltips(a,c,d)};g.getHierarchyMicroTemplateHTML=function(a){return this.microTemplate(r.z+"organizer_hierarchy",a)};g.getItems=function(){return this.getMergeFieldsForItemsAndColumns()};g.setupHierarchy=function(a,c,d){var e=this;d=this.tuix.hierarchy||{};var b,h=!0;a={};var f=c.find(".dd");f.nestable({maxDepth:d.max_depth||99});if(this.searchTerm===m&&!n(d.start_with_all_items_open)){f.nestable("collapseAll");
if(this.openItemsInHierarchy)for(b in this.openItemsInHierarchy)l(this.openItemsInHierarchy,b)&&(a[b]=!0);for(b in this.selectedItems)l(this.selectedItems,b)&&this.parentIdOf[b]&&(a[this.parentIdOf[b]]=!0);for(;h;)for(b in h=!1,a)l(a,b)&&this.parentIdOf[b]&&!a[this.parentIdOf[b]]&&(h=a[this.parentIdOf[b]]=!0);for(b in a)l(a,b)&&(c=$(w("organizer_item_"+b)).parent(),c.length&&f.nestable("expandItem",c))}f.on("collapseItem",function(){e.collapseItem();e.hideHandles(f)});f.on("expandItem",function(){e.expandItem();
e.hideHandles(f)});if(this.ordinalColumn()&&this.searchTerm===m)f.on("change",function(){(e.changingHierarchy=e.scanNewHier(!1))?k._dI():k._eI();k._sB()});this.$dd=f;this.hideHandles(f)};g.hideHandles=function(a){var c=this.tuix.hierarchy;c&&(n(c.disable_dragging_top_level)?(a.find(".dd-handle").hide(),n(c.disable_dragging_children)||a.find(".dd-item .dd-item .dd-handle").show()):n(c.disable_dragging_children)&&a.find(".dd-item .dd-item .dd-handle").hide())};g.collapseItem=function(){this.recordOpenItems();
var a=!1,c;for(c in this.selectedItems)l(this.selectedItems,c)&&!this.openItemsInHierarchy[c]&&(delete this.selectedItems[c],a=!0);a&&(k._sB(!0),k._sH())};g.expandItem=function(){this.recordOpenItems()};g.showButtons=function(a){var c=this;this.changingHierarchy?(a.html(this.microTemplate(r.z+"organizer_apply_cancel_buttons",{})),a.find("#organizer_applyButton").click(function(){c.scanNewHier(!0)}),a.find("#organizer_cancelButton").click(function(){k._eI();k._r()})):p(q.list).showButtons.call(this,
a)};g.scanNewHier=function(a){var c=this.$dd.nestable("serialize_zenario_modified_version"),d,e,b,h=!1,f={},g={},q=this.ordinalColumn();for(e in c)if(l(c,e)){var p=!1,u=c[e].length;for(b=1;b<=u;++b)if(d=c[e][b-1],d!==m)if(g[d]={parentId:e,ordinal:b},this.ordinals&&this.ordinals[e]&&this.ordinals[e][d]&&this.ordinals[e][d].normOrd==b)this.ordinals[e][d].ord!=b&&(p=!0);else if(h=!0,a&&p){for(b=1;b<=u;++b)d=c[e][b-1],d!==m&&(f[d]={parentId:e,ordinal:b});break}else f[d]={parentId:e,ordinal:b}}if(!a)return h;
if(h){a=k._gK();c="";a.hierarchy=!0;a.ordinals={};a.parent_ids={};this.tuix.hierarchy&&n(this.tuix.hierarchy.send_full_hierarchy_onchange)&&(f=g);for(d in f)l(f,d)&&(c+=(c?",":"")+d,a.parent_ids[d]=f[d].parentId,a.ordinals[d]=f[d].ordinal,a.reorder=!0,this.tuix.items[d][q]=f[d].ordinal);a.id=c;d=r.a+"?__pluginClassName__="+this.tuix.class_name+"&__path__="+k.path+r.c+"handleOrganizerPanelAJAX";delete s.rev;s._a(v+d,a).after(function(a){a&&t._sM(a);k._eI();k._r()})}};g.recordOpenItems=function(){var a=
this;this.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(c,d){var e,b=$(d);b.find("ol.dd-list:visible").size()&&(e=b.data("id"))&&(a.openItemsInHierarchy[e]=!0)})};g.returnDoSortingAndSearchingOnServer=function(){return!1};g.sortAndSearchItems=function(a){var c,d=this.sortItems(),e=this.searchItems(_._cl(d),a),b=_._o(e,e),g=this.parentIdColumn();k.nonSearchMatches={};for(a=0;a<e.length;++a)c=e[a],(c=this.tuix.items[c]&&this.tuix.items[c][g])&&b[c]===
m&&(e.push(c),b[c]=c,k.nonSearchMatches[c]=!0);for(a=d.length;0<=a;--a)c=d[a],b[c]===m&&d.splice(a,1);return d}},zenarioO.panelTypes);
