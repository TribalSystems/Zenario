zenario.lib(function(g,t,x,y,z,A,s,u,v,B,C,k,D,m,n,p,E,F,G,w,q,l,r){g=q(r.hierarchy=w(r.list,function(){this.openItemsInHierarchy={}}));g.returnPageSize=function(){return!1};g.returnInspectionViewEnabled=function(){return!1};g.parentIdColumn=function(){return this.tuix.hierarchy&&this.tuix.hierarchy.column||"parent_id"};g.showPanel=function(b,e,c){var a={},d,h,f,g=this.getItems(),k=this.ordinalColumn(),m=this.parentIdColumn();this.itemsById={};this.parentIdOf={};this.ordinals={};this.changingHierarchy=
!1;this.setHeader(b);for(d in g.items)l(g.items,d)&&(h=g.items[d],h.items=[],this.itemsById[h.id]=h);for(d=g.items.length-1;0<=d;--d)h=g.items[d],f=h.tuix[m],s._eTB(f)?(g.items.splice(d,1),this.itemsById[f]&&(this.itemsById[f].items.splice(0,0,h),this.parentIdOf[h.id]=f)):f=0,k&&(a[f]||(a[f]=[],this.ordinals[f]={}),a[f].push(this.ordinals[f][h.id]={id:h.id,ord:h.tuix[k]}),h.canDrag=!0);for(f in a)if(l(a,f))for(h=a[f],h.sort(v.sortArrayByOrd),d=0;d<h.length;++d)h[d].normOrd=d+1;a=this.getHierarchyMicroTemplateHTML(g);
e.html(a);e.find("ol > li > div.organizer_can_choose").each(function(a,b){$(b).parent().parent().addClass("organizer_can_choose_children")});e.find("ol > li > div.organizer_cant_choose").each(function(a,b){$(b).parent().parent().addClass("organizer_cant_choose_children")});e.show();this.setupHierarchy(b,e,c);this.setScroll(e);c.html("").show();this.setTooltips(b,e,c)};g.getHierarchyMicroTemplateHTML=function(b){return this.microTemplate("zenario_organizer_hierarchy",b)};g.getItems=function(){return this.getMergeFieldsForItemsAndColumns()};
g.getItemPosition=function(b,e){for(var c=$(p("organizer_item_"+e)),a,d;c&&c[0]&&"organizer_items_wrapper"!=c[0].id&&(a=c.position());)a.top&&(d=a),c=c.parent();return d};g.setupHierarchy=function(b,e,c){var a=this;c=a.tuix.hierarchy||{};var d,h=!0;b={};var f=e.find(".dd");f.nestable({maxDepth:c.max_depth||99});if(!m(a.searchTerm)&&!n(c.start_with_all_items_open)){f.nestable("collapseAll");if(a.openItemsInHierarchy)for(d in a.openItemsInHierarchy)l(a.openItemsInHierarchy,d)&&(b[d]=!0);for(d in a.selectedItems)l(a.selectedItems,
d)&&a.parentIdOf[d]&&(b[a.parentIdOf[d]]=!0);for(;h;)for(d in h=!1,b)l(b,d)&&a.parentIdOf[d]&&!b[a.parentIdOf[d]]&&(h=b[a.parentIdOf[d]]=!0);for(d in b)l(b,d)&&(e=$(p("organizer_item_"+d)).parent(),e.length&&f.nestable("expandItem",e))}f.on("collapseItem",function(){a.collapseItem();a.hideHandles(f)});f.on("expandItem",function(){a.expandItem();a.hideHandles(f)});if(a.ordinalColumn()&&!m(a.searchTerm))f.on("change",function(){(a.changingHierarchy=a.scanNewHier(!1))?k._dI():k._eI();k._sB()});a.$dd=
f;a.hideHandles(f)};g.hideHandles=function(b){var e=this.tuix.hierarchy;e&&(n(e.disable_dragging_top_level)?(b.find(".dd-handle").hide(),n(e.disable_dragging_children)||b.find(".dd-item .dd-item .dd-handle").show()):n(e.disable_dragging_children)&&b.find(".dd-item .dd-item .dd-handle").hide())};g.collapseItem=function(){this.recordOpenItems();var b=!1,e;for(e in this.selectedItems)l(this.selectedItems,e)&&!this.openItemsInHierarchy[e]&&(delete this.selectedItems[e],b=!0);b&&(k._sB(!0),k._sH())};g.expandItem=
function(){this.recordOpenItems()};g.showButtons=function(b){var e=this;e.changingHierarchy?(b.html(e.microTemplate("zenario_organizer_apply_cancel_buttons",{})),b.find("#organizer_applyButton").click(function(){e.scanNewHier(!0)}),b.find("#organizer_cancelButton").click(function(){k._eI();k._r()})):q(r.list).showButtons.call(e,b)};g.scanNewHier=function(b){var e=this.$dd.nestable("serialize_zenario_modified_version"),c,a,d,h=!1,f={},g={},r=this.ordinalColumn();for(a in e)if(l(e,a)){var p=!1,q=e[a].length;
for(d=1;d<=q;++d)if(c=e[a][d-1],m(c))if(g[c]={parentId:a,ordinal:d},this.ordinals&&this.ordinals[a]&&this.ordinals[a][c]&&this.ordinals[a][c].normOrd==d)this.ordinals[a][c].ord!=d&&(p=!0);else if(h=!0,b&&p){for(d=1;d<=q;++d)c=e[a][d-1],m(c)&&(f[c]={parentId:a,ordinal:d});break}else f[c]={parentId:a,ordinal:d}}if(!b)return h;if(h){b=k._gK();e="";b.hierarchy=!0;b.ordinals={};b.parent_ids={};this.tuix.hierarchy&&n(this.tuix.hierarchy.send_full_hierarchy_onchange)&&(f=g);for(c in f)l(f,c)&&(e+=(e?",":
"")+c,b.parent_ids[c]=f[c].parentId,b.ordinals[c]=f[c].ordinal,b.reorder=!0,this.tuix.items[c][r]=f[c].ordinal);b.id=e;c="zenario/ajax.php?__pluginClassName__="+this.tuix.class_name+"&__path__="+k.path+"&method_call=handleOrganizerPanelAJAX";delete s.rev;s._a(t+c,b).after(function(a){a&&u._sM(a);k._eI();k._r()})}};g.recordOpenItems=function(){var b=this;b.openItemsInHierarchy={};$("#organizer_hierarchy_view li.dd-item[data-id]:visible").each(function(e,c){var a,d=$(c);d.find("ol.dd-list:visible").length&&
(a=d.data("id"))&&(b.openItemsInHierarchy[a]=!0)})};g.returnDoSortingAndSearchingOnServer=function(){return!1};g.sortAndSearchItems=function(b){var e,c,a=this.sortItems(),d=this.searchItems(_._cl(a),b),g=_._o(d,d),f=this.parentIdColumn(),l={};k.nonSearchMatches={};if(d.length!=a.length){for(c=0;c<d.length;++c)b=d[c],(e=this.tuix.items[b]&&this.tuix.items[b][f])&&!m(g[e])&&(d.push(e),g[e]=e,k.nonSearchMatches[e]=!0);for(c=a.length;0<=c;--c)b=a[c],m(g[b])||a.splice(c,1)}for(c=0;c<a.length;++c)b=a[c],
e=this.tuix.items[b]&&this.tuix.items[b][f]||"","0"==e&&(e=""),m(l[e])||(l[e]=[]),l[e].push(b);a=l[""]||[];for(c=0;c<a.length;++c)b=a[c],m(l[b])&&(a=a.concat(l[b]));return a}},zenarioO.panelTypes);
