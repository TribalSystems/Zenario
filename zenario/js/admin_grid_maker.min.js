zenario.lib(function(z,u,v,s,A,g,h,n,B,C,D,E,w,x,F,l,q,G,r,H,y,t,a){a.initVars();a.gridId="grid";a.mtPrefix="zenario_grid_maker_";a.addToolbarId="grid_add_toolbar";a.init=function(c,b,e,d){a.data="object"==typeof c?c:JSON.parse(c);e&&(a.layoutName=e);b&&(a.layoutId=b);a.checkData(e,d);a.checkDataR(a.data.cells);a.rememberNames(a.data.cells);a.editing=!0;a.data.cells.length||(a.editing=!0);g&&!g.zenarioGM&&g.$&&g.$.colorbox?$("#close_button").click(function(){if(a.savedAtPos==a.pos||confirm(r.gridConfirmClose))h.stopPoking(a),
g.zenario&&g.zenario.cID?g.location.reload(!0):g.$.colorbox.close()}):l("close_button").style.display="none";h.startPoking(a)};a.draw=function(c){c||a.drawOptions();a.editing?a.drawEditor():a.drawPreview()};a.drawOptions=function(){var c=a.microTemplate(a.mtPrefix+"top",{formId:"settings"});$(".ui-tooltip").remove();l("settings").innerHTML=c;n._to("#settings");a.data.fluid||a.recalcColumnAndGutterOptions(a.data);$("#settings input.zenario_grid_setting_break_1").change(a.update).spinner({stop:a.update,
min:10,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_break_2").change(a.update).spinner({stop:a.update,min:300,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_min_width").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:100,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_max_width").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,
min:320,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_gutter_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:0,step:0.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_gutter_left_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:0,step:0.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_gutter_right_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,
min:0,step:0.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_full_width").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:320,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_cols").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:1,step:1});$("#settings input.zenario_grid_setting_gutter_left").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,
min:0,step:1}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_gutter_right").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:0,step:1}).after('<span class="zenario_grid_unit">px</span>');$("#settings select.zenario_grid_setting_col_and_gutter").change(a.recalcOnChange);$("#settings input.zenario_grid_setting_fixed").change(a.updateAndChange);$("#settings input.zenario_grid_setting_flu").change(a.updateAndChange);$("#settings input.zenario_grid_setting_responsive").change(a.updateAndChange);
$("#settings input.zenario_grid_setting_mirror").change(a.updateAndChange);a.canUndo()&&$("#settings .zenario_grid_setting_undo").click(function(){a.undo()});a.canRedo()&&$("#settings .zenario_grid_setting_redo").click(function(){a.redo()});$("#settings .zenario_grid_setting_preview_grid").click(function(){a.editing=!1;a.drawPreview()});$("#settings .zenario_grid_setting_edit_slots").click(function(){a.editing=!0;a.drawEditor()})};a.recalcColumnAndGutterOptions=function(a,b,e){var d=!1,p=(e?e:1*$("#settings--setting_full_width").val())-
a.gutterLeftEdge-a.gutterRightEdge;e=Math.floor(p/a.cols);var f=0,h=!1,k=0;b||(d=l("settings--setting_col_width"));if(!a.cols)return!1;if(d)for(k=d.length-1;0<=k;--k)d.remove(k);if(1==a.cols)d&&d.add(new Option(e+" px / "+f+" px",e+"/"+f),++k),h={colWidth:e,gutter:f};else{f=a.cols-1;b=p/f;for(var p=a.cols/f,g,m=999999,k=-1;0<e;--e)f=b-p*e,f=Math.round(1E4*f)/1E4,f==Math.floor(f)&&(d&&d.add(new Option(e+" px / "+f+" px",e+"/"+f),++k),g=Math.abs(a.gutter/a.colWidth-f/e),m>g&&(d&&(d.selectedIndex=k),
m=g,h={colWidth:e,gutter:f}))}return h};a.editProperties=function(c){var b=$(c),e=["zenario_grid_box","zenario_grid_rename_slot_box"],b={type:b.data("type"),name:b.data("name"),small:b.data("small"),height:b.data("height"),is_full:b.data("is_full"),is_last:b.data("is_last"),css_class:b.data("css_class"),html:b.data("html"),grid_css_class:b.data("grid_css_class")};$.colorbox({transition:"none",html:a.microTemplate(a.mtPrefix+"object_properties",b),onOpen:function(){h._aCTC(e)},onClosed:function(){h._rCTC(e)},
onComplete:function(){$("#zenario_grid_slotname_button").click(function(){var b,e={},f=$("#colorbox .zenario_grid_properties_form").serializeArray();for(b in f)t(f,b)&&(e[f[b].name]=f[b].value);a.saveProperties(c,e)});$(".zenario_grid_properties_form input,textarea")[1].focus()}})};a.ajaxURL=function(){return u+"zenario/admin/grid_maker/ajax.php"};a.ajaxSrc=function(){var c=a.ajaxData(),b=a.ajaxURL()+"?data="+w(c);400<b.length&&(b=a.ajaxURL()+"?cdata="+h._nAA(a.ajaxURL(),{compress:1,data:c}));return b};
a.drawPreview=function(){a.clearAddToolbar();a.checkData();var c=Math.max(a.desktopSmallestSize,100*Math.round(($(s).width()-a.previewPaddingLeftRight)/100)),b=Math.min(c-20,a.data.maxWidth),e=a.microTemplate(a.mtPrefix+"preview",{gridId:a.gridId,topHack:5,leftHack:10,min:100,max:c,startingValue:b});$("#"+a.gridId).css("margin","auto");$(".ui-tooltip").remove();l(a.gridId).innerHTML=e;n._to("#"+a.gridId);$('<form action="'+q(a.ajaxURL())+'" method="post" target="'+a.gridId+'-iframe"><input name="data" value="'+
q(a.ajaxData())+'"/></form>').appendTo("body").hide().submit().remove();$("#"+a.gridId+"-slider").slider({min:100,max:c,step:10,animate:!0,value:b,start:function(b,c){$("#"+a.gridId+"-slider_overlay").css("display","block")},stop:function(b,c){$("#"+a.gridId+"-slider_overlay").css("display","none")},slide:function(b,c){$("#"+a.gridId+"-slider_val").val(c.value);$("#"+a.gridId+"-iframe").clearQueue();$("#"+a.gridId+"-size").clearQueue();!b.originalEvent||"mousedown"!=b.originalEvent.type&&"touchstart"!=
b.originalEvent.type?($("#"+a.gridId+"-iframe").width(c.value),$("#"+a.gridId+"-size").css("marginLeft",c.value+"px")):($("#"+a.gridId+"-iframe").animate({width:c.value}),$("#"+a.gridId+"-size").animate({marginLeft:c.value}));a.resizePreview()}});$("#"+a.gridId+"-slider_val").change(function(){var b=1*this.value;b&&100<=b&&b<=c&&($("#"+a.gridId+"-slider").slider("value",b),$("#"+a.gridId+"-iframe").clearQueue().animate({width:b}),$("#"+a.gridId+"-size").clearQueue().animate({marginLeft:b}))});a.resizePreview();
var d=function(b){$("#"+a.gridId+"-slider_val").val(b);$("#"+a.gridId+"-slider").slider("value",b);$("#"+a.gridId+"-size").clearQueue().animate({marginLeft:b});$("#"+a.gridId+"-iframe").clearQueue().animate({width:b},{complete:a.resizePreview});a.lastToast&&a.lastToast.remove();a.lastToast=toastr.info(r.gridDisplayingAt.r("[[pixels]]",b))};$("#"+a.gridId+"-slider_mobile").click(function(){d(a.mobileWidth)});$("#"+a.gridId+"-slider_tablet").click(function(){d(a.tabletWidth)});$("#"+a.gridId+"-slider_desktop").click(function(){d(c)});
$("#settings--tabs").removeClass("zenario_grid_tabs_slots_selected").addClass("zenario_grid_tabs_grid_selected");a.drawLinks()};a.drawEditor=function(a,b,e,d,h,f,g,k,l,m,n){e||$("#settings--tabs").removeClass("zenario_grid_tabs_grid_selected").addClass("zenario_grid_tabs_slots_selected");return y(zenarioG).drawEditor.call(this,a,b,e,d,h,f,g,k,l,m,n)};a.clearAddToolbar=function(){$("#"+a.addToolbarId).hide().html("")};a.drawAddToolbar=function(){$("#"+a.addToolbarId).show().html(a.microTemplate(a.mtPrefix+
"add_toolbar",{}));$("#"+a.addToolbarId+" a").draggable({connectToSortable:".zenario_grids",helper:"clone",revert:"invalid"});$("#"+a.addToolbarId).draggable({cursor:"move"})};$(v).ready(function(){$("#"+a.addToolbarId).hover(function(){$(this).css("cursor","move")},function(){$(this).css("cursor","pointer")})});a.resizePreview=function(){var c,b=0;(c=l(a.gridId+"-iframe"))&&c.contentWindow&&c.contentWindow.document&&c.contentWindow.document.body&&(b=$(c.contentWindow.document.body).height()||360,
360>b&&(b=360),$("#"+a.gridId+"-iframe").height(b),$("#"+a.gridId+"-slider_overlay").height(b),$("#"+a.gridId+"-slider a").css("position","absolute").css("z-index",20).css("top","-"+(b+5)+"px").height(b+5).html('<span style="margin-top: '+Math.ceil((b+5)/2)+'px;"></span>'));a.lastIframeHeight=b};a.drawLinks=function(){a.checkData();var c={src:a.ajaxSrc()};a.microTemplate(a.mtPrefix+"bottom_links",c);$(".ui-tooltip").remove();n._to("#download_links");c=$("#"+a.gridId);a.editing?c.addClass("zenario_grid_slot_view").removeClass("zenario_grid_grid_view"):
(c.addClass("zenario_grid_grid_view").removeClass("zenario_grid_slot_view"),c.css({height:"auto"}),c=$("#"+a.gridId+" .zenario_grid_preview_frame"));c.height(0);c.height(Math.max(a.gridAreaSmallestHeight,$(s).height()-$("body").height()-a.bodyPadding));var b=["zenario_grid_box","zenario_grid_copy_box","zenario_grid_copy_css_box"];$("#download_links a.zenario_grid_copy_css").colorbox({onOpen:function(){h._aCTC(b)},onClosed:function(){h._rCTC(b)},onComplete:function(){$("#colorbox textarea").focus()}});
var e=["zenario_grid_box","zenario_grid_copy_box","zenario_grid_copy_html_box"];$("#download_links a.zenario_grid_copy_html").colorbox({onOpen:function(){h._aCTC(e)},onClosed:function(){h._rCTC(e)},onComplete:function(){$("#colorbox textarea").focus()}})};a.save=function(c){a.layoutId||(c=!0);var b;if(c){var e=["zenario_grid_box","zenario_grid_new_layout_box"];(b=h._nAA(a.ajaxURL(),{saveas:1,data:a.ajaxData(),layoutId:a.layoutId},!0))&&$.colorbox({transition:"none",html:a.microTemplate(a.mtPrefix+
"save_prompt",{name:a.newLayoutName||b.oldLayoutName||""}),onOpen:function(){h._aCTC(e)},onClosed:function(){h._rCTC(e)},onComplete:function(){$("#zenario_grid_new_layout_save").click(function(){$("#zenario_grid_error").hide();(b=h._nAA(a.ajaxURL(),{saveas:1,confirm:1,data:a.ajaxData(),layoutId:a.layoutId,layoutName:a.newLayoutName=l("zenario_grid_layout_name").value},!0))?b.error?$("#zenario_grid_error").html(q(b.error)).slideDown():($.colorbox.close(),a.layoutName=a.newLayoutName,a.markAsSaved(b)):
$.colorbox.close()});l("zenario_grid_layout_name").focus()}})}else if(b=h._nAA(a.ajaxURL(),{save:1,data:a.ajaxData(),layoutId:a.layoutId},!0))b.success?a.markAsSaved(b,!0):(n._flBo(b.message,r.gridSave,"warning",!0,!0),$("#zenario_fbMessageButtons .submit_selected").click(function(){setTimeout(function(){var b;(b=h._nAA(a.ajaxURL(),{save:1,data:a.ajaxData(),layoutId:a.layoutId,confirm:1},!0))&&a.markAsSaved(b)},50)}))};a.markAsSaved=function(c,b){a.savedAtPos=a.pos;x(c.layoutId)&&(a.layoutId=c.layoutId);
a.rememberNames(a.data.cells);c.success&&(b?n._flBo(c.success,!0,"success"):toastr.success(c.success));if(g&&g.zenarioO.init)switch(g.zenarioO.path){case "zenario__layouts/panels/layouts":c.layoutId&&g.zenarioO._rTSI(c.layoutId)}};a.readSettings=function(a){a.fluid=$("#settings input.zenario_grid_setting_flu").prop("checked");a.responsive=$("#settings input.zenario_grid_setting_responsive").prop("checked");a.mirror=$("#settings input.zenario_grid_setting_mirror").prop("checked");a.cols=1*$("#settings input.zenario_grid_setting_cols").val();
var b;(b=$("#settings input.zenario_grid_setting_full_width")).length?a.maxWidth=1*b.val():(b=$("#settings input.zenario_grid_setting_max_width")).length&&(a.maxWidth=1*b.val());(b=$("#settings input.zenario_grid_setting_min_width")).length&&(a.minWidth=1*b.val());(b=$("#settings input.zenario_grid_setting_break_1")).length&&(a.bp1=1*b.val());(b=$("#settings input.zenario_grid_setting_break_2")).length&&(a.bp2=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_left")).length&&(a.gutterLeftEdge=
1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_right")).length&&(a.gutterRightEdge=1*b.val());(b=$("#settings select.zenario_grid_setting_col_and_gutter")).length&&(b=b.val())&&(b=b.s("/"))&&(a.colWidth=1*b[0],a.gutter=1*b[1]);(b=$("#settings input.zenario_grid_setting_gutter_left_flu")).length&&(a.gutterLeftEdgeFlu=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_flu")).length&&(a.gutterFlu=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_right_flu")).length&&
(a.gutterRightEdgeFlu=1*b.val())};a.updateAndChange=function(){a.update();a.change()};a.update=function(){a.readSettings(a.data);a.checkData()};a.recalcOnKeyUp=function(){a.recalc(this)};a.recalcOnChange=function(){a.recalc(this,!0,!0)};a.recalcOnInc=function(c,b){if(c.originalEvent&&"mouseup"==c.originalEvent.type)return a.recalc(this,!0)};a.recalc=function(c,b,e){var d=$.extend(!1,{},a.data),h=!1,f=!1,g=0,k=c.className,l;d.fluid?(delete d.gutter,delete d.gutterLeftEdge,delete d.gutterRightEdge):
(delete d.gutterFlu,delete d.gutterLeftEdgeFlu,delete d.gutterRightEdgeFlu);e||(h=JSON.stringify(d));a.readSettings(d);f=a.checkDataNonZeroAndNumeric(d,f);if(d.fluid)delete d.gutter,delete d.gutterLeftEdge,delete d.gutterRightEdge;else{switch(k.s(" ")[0]){case "zenario_grid_setting_full_width":g=1;break;case "zenario_grid_setting_cols":g=2;break;case "zenario_grid_setting_gutter_left":g=3;break;case "zenario_grid_setting_gutter_right":g=4;break;case "zenario_grid_setting_col_and_gutter":g=5}if(g){if(e||
$(c).val()!=$(c).attr("data-initial-value"))$(c).attr("data-initial-value",$(c).val());else return;do if(!d.maxWidth||1>d.cols)f=!0;else{if(d.gutterLeftEdge+d.cols+d.gutterRightEdge>d.maxWidth)if(3>g)d.gutterLeftEdge=d.gutterRightEdge=0;else{f=!0;break}5>g&&(l=a.recalcColumnAndGutterOptions(d))&&(d.colWidth=l.colWidth,d.gutter=l.gutter);var f=a.checkDataNonZeroAndNumeric(d,f),k=0,m=[{l:3,c:"zenario_grid_setting_gutter_left",v:d.gutterLeftEdge},{l:4,c:"zenario_grid_setting_gutter_right",v:d.gutterRightEdge},
{l:5,c:"zenario_grid_setting_col_and_gutter",v:d.colWidth+"/"+d.gutter}];for(k in m)if(t(m,k)&&g<m[k].l){var n=$("#settings ."+m[k].c);n.val()!=m[k].v&&n.animate({opacity:0.3},"fast").val(m[k].v).animate({opacity:1},"fast")}}while(0)}delete d.gutterFlu;delete d.gutterLeftEdgeFlu;delete d.gutterRightEdgeFlu}if(e||h!=JSON.stringify(d))$("#settings .zenario_grid_setting_warning").removeClass("zenario_grid_setting_warning"),b?f?a.revert():(a.readSettings(a.data),a.checkDataNonZeroAndNumeric(a.data),a.change(!1,
!0)):f&&$(c).parent().addClass("zenario_grid_setting_warning");return!f}},window.zenarioGM=new zenarioG);
