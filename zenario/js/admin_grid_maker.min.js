'use strict';zenario.lib(function(D,z,A,x,E,m,k,r,F,G,H,I,B,u,J,q,v,K,w,L,C,y,a){a.initVars();a.gridId="grid";a.mtPrefix="zenario_grid_maker_";a.addToolbarId="grid_add_toolbar";a.init=function(c,b,f,d){a.data="object"==typeof c?c:JSON.parse(c);f&&(a.layoutName=f);b&&(a.layoutId=b);a.checkData(f,d);a.checkDataR(a.data.cells);a.rememberNames(a.data.cells);a.editing=!0;a.data.cells.length||(a.editing=!0);m&&!m.zenarioGM&&m.$&&m.$.colorbox?$("#close_button").click(function(){if(a.savedAtPos==a.pos||confirm(w.gridConfirmClose))k.stopPoking(a),
m.zenario&&m.zenario.cID?m.location.reload(!0):m.$.colorbox.close()}):q("close_button").style.display="none";k.startPoking(a)};a.draw=function(c){c||a.drawOptions();a.editing?a.drawEditor():a.drawPreview()};a.drawOptions=function(){var c=a.microTemplate(a.mtPrefix+"top",{formId:"settings"});$(".ui-tooltip").remove();q("settings").innerHTML=c;r._to("#settings  *[title]");a.data.fluid||a.recalcColumnAndGutterOptions(a.data);$("#settings input.zenario_grid_setting_break_1").change(a.update).spinner({stop:a.update,
min:10,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_break_2").change(a.update).spinner({stop:a.update,min:300,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_min_width").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:100,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_max_width").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,
min:320,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_gutter_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:0,step:.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_gutter_left_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,min:0,step:.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_gutter_right_flu").change(a.recalcOnChange).spinner({stop:a.recalcOnInc,
min:0,step:.1}).after('<span class="zenario_grid_unit">%</span>');$("#settings input.zenario_grid_setting_full_width").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:320,step:10}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_cols").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:1,step:1});$("#settings input.zenario_grid_setting_gutter_left").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,
min:0,step:1}).after('<span class="zenario_grid_unit">px</span>');$("#settings input.zenario_grid_setting_gutter_right").change(a.recalcOnChange).keyup(a.recalcOnKeyUp).spinner({stop:a.recalcOnInc,min:0,step:1}).after('<span class="zenario_grid_unit">px</span>');$("#settings select.zenario_grid_setting_col_and_gutter").change(a.recalcOnChange);$("#settings input.zenario_grid_setting_fixed").change(a.updateAndChange);$("#settings input.zenario_grid_setting_flu").change(a.updateAndChange);$("#settings input.zenario_grid_setting_responsive").change(a.updateAndChange);
$("#settings input.zenario_grid_setting_mirror").change(a.updateAndChange);a.canUndo()&&$("#settings .zenario_grid_setting_undo").click(function(){a.undo()});a.canRedo()&&$("#settings .zenario_grid_setting_redo").click(function(){a.redo()});$("#settings .zenario_grid_setting_preview_grid").click(function(){a.editing=!1;a.drawPreview()});$("#settings .zenario_grid_setting_edit_slots").click(function(){a.editing=!0;a.drawEditor()})};a.recalcColumnAndGutterOptions=function(c,b,f){var d=!1,g=(f?f:1*$("#settings--setting_full_width").val())-
c.gutterLeftEdge-c.gutterRightEdge;f=Math.floor(g/c.cols);var e=0,l=!1,h=0;b||(d=q("settings--setting_col_width"));if(!c.cols)return!1;if(d)for(h=d.length-1;0<=h;--h)d.remove(h);if(1==c.cols)d&&d.add(new Option(f+" px / "+e+" px",f+"/"+e),++h),l={colWidth:f,gutter:e};else{e=c.cols-1;b=g/e;g=c.cols/e;var p=999999;for(h=-1;0<f;--f)if(e=b-g*f,e=Math.round(1E4*e)/1E4,e==Math.floor(e)){d&&d.add(new Option(f+" px / "+e+" px",f+"/"+e),++h);var n=Math.abs(c.gutter/c.colWidth-e/f);p>n&&(d&&(d.selectedIndex=
h),p=n,l={colWidth:f,gutter:e})}}return l};a.editProperties=function(c){var b=$(c),f=["zenario_grid_box","zenario_grid_rename_slot_box"];b={type:b.data("type"),name:b.data("name"),small:b.data("small"),height:b.data("height"),is_full:b.data("is_full"),is_last:b.data("is_last"),css_class:b.data("css_class"),html:b.data("html"),grid_css_class:b.data("grid_css_class")};$.colorbox({transition:"none",html:a.microTemplate(a.mtPrefix+"object_properties",b),onOpen:function(){k._aCTC(f)},onClosed:function(){k._rCTC(f)},
onComplete:function(){$("#zenario_grid_slotname_button").click(function(){var d,g={},e=$("#colorbox .zenario_grid_properties_form").serializeArray();for(d in e)y(e,d)&&(g[e[d].name]=e[d].value);a.saveProperties(c,g)});$(".zenario_grid_properties_form input,textarea")[1].focus()}})};a.ajaxURL=function(){return z+"zenario/admin/grid_maker/ajax.php"};a.ajaxSrc=function(){var c=a.ajaxData(),b=a.ajaxURL()+"?data="+B(c);400<b.length&&(b=a.ajaxURL()+"?cdata="+k._nAA(a.ajaxURL(),{compress:1,data:c}));return b};
a.drawPreview=function(){a.clearAddToolbar();a.checkData();var c=Math.max(a.desktopSmallestSize,100*Math.round(($(x).width()-a.previewPaddingLeftRight)/100)),b=Math.min(c-20,a.data.maxWidth),f=a.microTemplate(a.mtPrefix+"preview",{gridId:a.gridId,topHack:5,leftHack:10,min:100,max:c,startingValue:b});$("#"+a.gridId).css("margin","auto");$(".ui-tooltip").remove();q(a.gridId).innerHTML=f;r._to("#"+a.gridId+"  *[title]");$('<form action="'+v(a.ajaxURL())+'" method="post" target="'+a.gridId+'-iframe"><input name="data" value="'+
v(a.ajaxData())+'"/></form>').appendTo("body").hide().submit().remove();$("#"+a.gridId+"-slider").slider({min:100,max:c,step:10,animate:!0,value:b,start:function(g,e){$("#"+a.gridId+"-slider_overlay").css("display","block")},stop:function(g,e){$("#"+a.gridId+"-slider_overlay").css("display","none")},slide:function(g,e){$("#"+a.gridId+"-slider_val").val(e.value);$("#"+a.gridId+"-iframe").clearQueue();$("#"+a.gridId+"-size").clearQueue();!g.originalEvent||"mousedown"!=g.originalEvent.type&&"touchstart"!=
g.originalEvent.type?($("#"+a.gridId+"-iframe").width(e.value),$("#"+a.gridId+"-size").css("marginLeft",e.value+"px")):($("#"+a.gridId+"-iframe").animate({width:e.value}),$("#"+a.gridId+"-size").animate({marginLeft:e.value}));a.resizePreview()}});$("#"+a.gridId+"-slider_val").change(function(){var g=1*this.value;g&&100<=g&&g<=c&&($("#"+a.gridId+"-slider").slider("value",g),$("#"+a.gridId+"-iframe").clearQueue().animate({width:g}),$("#"+a.gridId+"-size").clearQueue().animate({marginLeft:g}))});a.resizePreview();
var d=function(g){$("#"+a.gridId+"-slider_val").val(g);$("#"+a.gridId+"-slider").slider("value",g);$("#"+a.gridId+"-size").clearQueue().animate({marginLeft:g});$("#"+a.gridId+"-iframe").clearQueue().animate({width:g},{complete:a.resizePreview});a.lastToast&&a.lastToast.remove();a.lastToast=toastr.info(w.gridDisplayingAt.r("[[pixels]]",g))};$("#"+a.gridId+"-slider_mobile").click(function(){d(a.mobileWidth)});$("#"+a.gridId+"-slider_tablet").click(function(){d(a.tabletWidth)});$("#"+a.gridId+"-slider_desktop").click(function(){d(c)});
$("#settings--tabs").removeClass("zenario_grid_tabs_slots_selected").addClass("zenario_grid_tabs_grid_selected");a.drawLinks()};a.drawEditor=function(c,b,f,d,g,e,l,h,p,n,t){f||$("#settings--tabs").removeClass("zenario_grid_tabs_grid_selected").addClass("zenario_grid_tabs_slots_selected");return C(zenarioG).drawEditor.call(this,c,b,f,d,g,e,l,h,p,n,t)};a.clearAddToolbar=function(){$("#"+a.addToolbarId).hide().html("")};a.drawAddToolbar=function(){$("#"+a.addToolbarId).show().html(a.microTemplate(a.mtPrefix+
"add_toolbar",{}));$("#"+a.addToolbarId+" a").draggable({connectToSortable:".zenario_grids",helper:"clone",revert:"invalid"});var c=$("#"+a.addToolbarId),b=c.position();b&&u(b.top)&&u(b.left)&&c.css({right:"auto",top:b.top,left:b.left});$("#"+a.addToolbarId).draggable({cursor:"move"})};$(A).ready(function(){$("#"+a.addToolbarId).hover(function(){$(this).css("cursor","move")},function(){$(this).css("cursor","pointer")})});a.resizePreview=function(){var c,b=0;(c=q(a.gridId+"-iframe"))&&c.contentWindow&&
c.contentWindow.document&&c.contentWindow.document.body&&(b=$(c.contentWindow.document.body).height()||360,360>b&&(b=360),$("#"+a.gridId+"-iframe").height(b),$("#"+a.gridId+"-slider_overlay").height(b),$("#"+a.gridId+"-slider a").css("position","absolute").css("z-index",20).css("top","-"+(b+5)+"px").height(b+5).html('<span style="margin-top: '+Math.ceil((b+5)/2)+'px;"></span>'));a.lastIframeHeight=b};a.drawLinks=function(){a.checkData();var c={src:a.ajaxSrc()};a.microTemplate(a.mtPrefix+"bottom_links",
c);$(".ui-tooltip").remove();r._to("#download_links  *[title]");c=$("#"+a.gridId);a.editing?c.addClass("zenario_grid_slot_view").removeClass("zenario_grid_grid_view"):(c.addClass("zenario_grid_grid_view").removeClass("zenario_grid_slot_view"),c.css({height:"auto"}),c=$("#"+a.gridId+" .zenario_grid_preview_frame"));c.height(0);c.height(Math.max(a.gridAreaSmallestHeight,$(x).height()-$("body").height()-a.bodyPadding));var b=["zenario_grid_box","zenario_grid_copy_box","zenario_grid_copy_css_box"];$("#download_links a.zenario_grid_copy_css").colorbox({onOpen:function(){k._aCTC(b)},
onClosed:function(){k._rCTC(b)},onComplete:function(){$("#colorbox textarea").focus()}});var f=["zenario_grid_box","zenario_grid_copy_box","zenario_grid_copy_html_box"];$("#download_links a.zenario_grid_copy_html").colorbox({onOpen:function(){k._aCTC(f)},onClosed:function(){k._rCTC(f)},onComplete:function(){$("#colorbox textarea").focus()}})};a.save=function(c){a.layoutId||(c=!0);var b;if(c){var f=["zenario_grid_box","zenario_grid_new_layout_box"];(b=k._nAA(a.ajaxURL(),{saveas:1,data:a.ajaxData(),
layoutId:a.layoutId},!0))&&$.colorbox({transition:"none",html:a.microTemplate(a.mtPrefix+"save_prompt",{name:a.newLayoutName||b.oldLayoutName||""}),onOpen:function(){k._aCTC(f)},onClosed:function(){k._rCTC(f)},onComplete:function(){$("#zenario_grid_new_layout_save").click(function(){$("#zenario_grid_error").hide();(b=k._nAA(a.ajaxURL(),{saveas:1,confirm:1,data:a.ajaxData(),layoutId:a.layoutId,layoutName:a.newLayoutName=q("zenario_grid_layout_name").value},!0))?b.error?$("#zenario_grid_error").html(v(b.error)).slideDown():
($.colorbox.close(),a.layoutName=a.newLayoutName,a.markAsSaved(b)):$.colorbox.close()});q("zenario_grid_layout_name").focus()}})}else if(b=k._nAA(a.ajaxURL(),{save:1,data:a.ajaxData(),layoutId:a.layoutId},!0))b.success?a.markAsSaved(b,!0):(r._flBo(b.message,w.gridSave,"warning",!0,!0),$("#zenario_fbMessageButtons .submit_selected").click(function(){setTimeout(function(){var d;(d=k._nAA(a.ajaxURL(),{save:1,data:a.ajaxData(),layoutId:a.layoutId,confirm:1},!0))&&a.markAsSaved(d)},50)}))};a.markAsSaved=
function(c,b){a.savedAtPos=a.pos;u(c.layoutId)&&(a.layoutId=c.layoutId);a.rememberNames(a.data.cells);c.success&&(b?r._flBo(c.success,!0,"success"):toastr.success(c.success));if(m&&m.zenarioO.init)switch(m.zenarioO.path){case "zenario__layouts/panels/layouts":c.layoutId&&m.zenarioO._rTSI(c.layoutId)}};a.readSettings=function(c){c.fluid=$("#settings input.zenario_grid_setting_flu").prop("checked");c.responsive=$("#settings input.zenario_grid_setting_responsive").prop("checked");c.mirror=$("#settings input.zenario_grid_setting_mirror").prop("checked");
c.cols=1*$("#settings input.zenario_grid_setting_cols").val();var b;(b=$("#settings input.zenario_grid_setting_full_width")).length?c.maxWidth=1*b.val():(b=$("#settings input.zenario_grid_setting_max_width")).length&&(c.maxWidth=1*b.val());(b=$("#settings input.zenario_grid_setting_min_width")).length&&(c.minWidth=1*b.val());(b=$("#settings input.zenario_grid_setting_break_1")).length&&(c.bp1=1*b.val());(b=$("#settings input.zenario_grid_setting_break_2")).length&&(c.bp2=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_left")).length&&
(c.gutterLeftEdge=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_right")).length&&(c.gutterRightEdge=1*b.val());(b=$("#settings select.zenario_grid_setting_col_and_gutter")).length&&(b=b.val())&&(b=b.s("/"))&&(c.colWidth=1*b[0],c.gutter=1*b[1]);(b=$("#settings input.zenario_grid_setting_gutter_left_flu")).length&&(c.gutterLeftEdgeFlu=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_flu")).length&&(c.gutterFlu=1*b.val());(b=$("#settings input.zenario_grid_setting_gutter_right_flu")).length&&
(c.gutterRightEdgeFlu=1*b.val())};a.updateAndChange=function(){a.update();a.change()};a.update=function(){a.readSettings(a.data);a.checkData()};a.recalcOnKeyUp=function(){a.recalc(this)};a.recalcOnChange=function(){a.recalc(this,!0,!0)};a.recalcOnInc=function(c,b){if(c.originalEvent&&"mouseup"==c.originalEvent.type)return a.recalc(this,!0)};a.recalc=function(c,b,f){var d=$.extend(!1,{},a.data),g=!1,e=!1,l=0,h=c.className,p;d.fluid?(delete d.gutter,delete d.gutterLeftEdge,delete d.gutterRightEdge):
(delete d.gutterFlu,delete d.gutterLeftEdgeFlu,delete d.gutterRightEdgeFlu);f||(g=JSON.stringify(d));a.readSettings(d);e=a.checkDataNonZeroAndNumeric(d,e);if(d.fluid)delete d.gutter,delete d.gutterLeftEdge,delete d.gutterRightEdge;else{switch(h.s(" ")[0]){case "zenario_grid_setting_full_width":l=1;break;case "zenario_grid_setting_cols":l=2;break;case "zenario_grid_setting_gutter_left":l=3;break;case "zenario_grid_setting_gutter_right":l=4;break;case "zenario_grid_setting_col_and_gutter":l=5}if(l){if(f||
$(c).val()!=$(c).attr("data-initial-value"))$(c).attr("data-initial-value",$(c).val());else return;do if(!d.maxWidth||1>d.cols)e=!0;else{if(d.gutterLeftEdge+d.cols+d.gutterRightEdge>d.maxWidth)if(3>l)d.gutterLeftEdge=d.gutterRightEdge=0;else{e=!0;break}5>l&&(p=a.recalcColumnAndGutterOptions(d))&&(d.colWidth=p.colWidth,d.gutter=p.gutter);e=a.checkDataNonZeroAndNumeric(d,e);h=0;var n=[{l:3,c:"zenario_grid_setting_gutter_left",v:d.gutterLeftEdge},{l:4,c:"zenario_grid_setting_gutter_right",v:d.gutterRightEdge},
{l:5,c:"zenario_grid_setting_col_and_gutter",v:d.colWidth+"/"+d.gutter}];for(h in n)if(y(n,h)&&l<n[h].l){var t=$("#settings ."+n[h].c);t.val()!=n[h].v&&t.animate({opacity:.3},"fast").val(n[h].v).animate({opacity:1},"fast")}}while(0)}delete d.gutterFlu;delete d.gutterLeftEdgeFlu;delete d.gutterRightEdgeFlu}if(f||g!=JSON.stringify(d))$("#settings .zenario_grid_setting_warning").removeClass("zenario_grid_setting_warning"),b?e?a.revert():(a.readSettings(a.data),a.checkDataNonZeroAndNumeric(a.data),a.change(!1,
!0)):e&&$(c).parent().addClass("zenario_grid_setting_warning");return!e}},window.zenarioGM=new zenarioG);
