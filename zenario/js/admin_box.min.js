window.zenarioNewAB=function(J){(function(a,A,D,K,g,s,L,I,h,n,t,v,H,w,l){a.init=!0;a.welcome=!1;a.baseCSSClass="";a.onKeyUpNum=0;a.sizing=!1;a.documentScrollTop=!1;a.cachedAJAXSnippets={};a.getKey=function(b){return a.focus.key};a.getKeyId=function(b){return a.focus&&a.focus.key?a.focus.key.id:!1};a.getLastKeyId=function(b){return a.getKeyId(b)};a.open=function(b,c,d,f,e,k){if(s.checkIfBoxIsOpen("AdminOrganizer"))return!1;a.templatePrefix=k||"zenario_admin_box";!1===a.documentScrollTop&&(a.documentScrollTop=
$(g.browserIsSafari()?"body":"html").scrollTop());c||(c={});b=(""+b).split("//",2);b[1]&&!c.id&&(c.id=b[1]);b=b[0];a.isOpen=!0;a.callBack=e;a.getRequestKey=c;a.changed={};a.SKColPicker=!1;e=s.microTemplate(a.templatePrefix,{});a.baseCSSClass="zenario_fbAdmin zenario_admin_box zab_"+b;s.openBox(e,a.baseCSSClass,"AdminFloatingBox"+J,!1,800,50,2,!0,!0,".zenario_jqmHead",!1);h("zenario_fbAdminFloatingBox").style.display="none";D.onbeforeunload=s.onbeforeunload;a.start(b,c,d,f)};a.start=function(b,c,d,
f){a.tabHidden=!0;a.differentTab=!1;a.path=v(b,"");a.focus={};a.key=v(c,{});a.tab=d;a.shownTab=!1;a.url=a.getURL();$.post(a.url,{_fill:!0,_values:f?JSON.stringify(f):""},function(b){a.load(b)?(a.tab&&(a.focus.tab=a.tab),delete a.key,delete a.tab,a.sortTabs(),a.initFields(),a.draw()):a.close(!0)},"text")};a.load=function(b){a.loaded=!0;if(!(b=s.readData(b)))return!1;a.callFunctionOnEditors("isDirty")&&a.markAsChanged();a.callFunctionOnEditors("remove");a.welcome?a.focus=b:a.syncAdminBoxFromServerToClient(b,
a.focus);return!a.focus||!a.focus.tabs&&a.focus._location===l?(s.showMessage(w.couldNotOpenBox,!0,"error"),!1):!0};a.initFields=function(){var b,c,d;if(a.focus.tabs)for(b in a.focus.tabs)if(g.has(a.focus.tabs,b)&&!a.isInfoTag(b)&&a.focus.tabs[b]&&a.focus.tabs[b].fields)for(c in a.focus.tabs[b].fields)g.has(a.focus.tabs[b].fields,c)&&!a.isInfoTag(c)&&(d=a.focus.tabs[b].fields[c])&&(d.pick_items&&d.plugin_setting&&d.plugin_setting.use_value_for_plugin_name?a.pickedItemsArray(c,a.value(c,b,!1)):d.load_values_from_organizer_path&&
!d.values&&a.loadValuesFromOrganizerPath(d))};a.loadValuesFromOrganizerPath=function(b){var c,d;if(b.load_values_from_organizer_path&&!b.values&&(b.values={},(d=s.getSKItem(b.load_values_from_organizer_path))&&d.items))for(c in d.items)g.has(d.items,c)&&(a.isInfoTag(c)||(b.values[g.decodeItemIdForStorekeeper(c)]=s.formatSKItemName(d,c)))};a.changeMode=function(){a.editCancelEnabled(a.focus.tab)&&(a.editModeOn()?a.editCancelOrRevert("cancel",a.focus.tab):a.editCancelOrRevert("edit",a.focus.tab))};
a.revertTab=function(){a.changes(a.focus.tab)&&a.revertEnabled(a.focus.tab)&&a.editCancelOrRevert("revert",a.focus.tab)};a.editCancelOrRevert=function(b,c){if(a.focus.tabs[c].edit_mode){var d,f,e;"edit"==b?(f=n(a.focus.tabs[c].edit_mode.format_on_edit),e=n(a.focus.tabs[c].edit_mode.validate_on_edit)):"cancel"==b?(f=n(a.focus.tabs[c].edit_mode.format_on_cancel_edit),e=n(a.focus.tabs[c].edit_mode.validate_on_cancel_edit)):"revert"==b&&(f=n(a.focus.tabs[c].edit_mode.format_on_revert),e=a.errorOnTab(c)||
n(a.focus.tabs[c].edit_mode.validate_on_revert));if(a.focus.tabs[c].fields&&!e)for(var k in a.focus.tabs[c].fields)if(g.has(a.focus.tabs[c].fields,k)&&!a.isInfoTag(k))if(n(a.focus.tabs[c].fields[k].validate_onchange)&&(d=a.readField(k))!==l&&d!=a.focus.tabs[c].fields[k].value){e=!0;break}else!f&&n(a.focus.tabs[c].fields[k].format_onchange)&&(d=a.readField(k))!==l&&d!=a.focus.tabs[c].fields[k].value&&(f=!0);a.focus.tabs[c].edit_mode.on="cancel"!=b;a.changed[c]=!1;e?a.validate(l,l,!0):f?a.format(!0):
(a.wipeTab(),a.redrawTab(!0));a.focus.tab==c&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};a.clickTab=function(b){a.loaded&&a.validate(b!=a.focus.tab,b)};a.clickButton=function(b,c){"submit"==a.focus.tabs[a.focus.tab].fields[c].type?(a.focus.tabs[a.focus.tab].fields[c].pressed=!0,a.validate(!0)):"toggle"==a.focus.tabs[a.focus.tab].fields[c].type&&((a.focus.tabs[a.focus.tab].fields[c].pressed=!n(a.focus.tabs[a.focus.tab].fields[c].pressed))?$("#"+c).removeClass("not_pressed").addClass("pressed"):
$("#"+c).removeClass("pressed").addClass("not_pressed"),a.validateFormatOrRedrawForField(a.focus.tabs[a.focus.tab].fields[c]))};a.toggleLevelsPressed={};a.togglePressed=function(b,c){var d;d=b?1<b?a.toggleLevelsPressed[b-1]:!0:a.toggleLevelsPressed.last;d===l&&(d=!0);c&&"toggle"==c.type&&(a.toggleLevelsPressed.last=d&&n(c.pressed),b&&(a.toggleLevelsPressed[b]=a.toggleLevelsPressed.last));return d};a.toggleLevel=function(b){return a.toggleLevelsPressed.last};a.format=function(b){!a.SKColPicker&&a.loaded&&
(a.loaded=!1,a.hideTab(),a.checkValues(b),$.post(a.getURL(),{_format:!0,_box:a.syncAdminBoxFromClientToServer()},function(b){a.load(b);a.sortTabs();a.draw()},"text"),s.nowDoingSomething("loading"))};a.validate=function(b,c,d,f){!a.SKColPicker&&a.loaded&&(a.differentTab=b,a.loaded=!1,a.hideTab(b),a.checkValues(d),$.post(a.getURL(),{_validate:!0,_box:a.syncAdminBoxFromClientToServer()},function(b){a.load(b)&&!a.errorOnTab(a.focus.tab)&&c!==l&&(a.focus.tab=c);a.sortTabs();a.switchToATabWithErrors();
a.draw();f&&f()},"text"),s.nowDoingSomething("loading"))};a.switchToATabWithErrors=function(){if(a.focus&&a.focus.tabs&&!a.errorOnTab(a.focus.tab))for(var b in a.sortedTabs)if(g.has(a.sortedTabs,b)){var c=a.sortedTabs[b];if(a.focus.tabs[c]&&!s.hidden(a.focus.tabs[c])&&a.errorOnTab(c))return a.focus.tab=c,!0}return!1};a.save=function(b,c){if(!a.SKColPicker&&a.loaded&&!a.saving){a.saving=!0;a.differentTab=!0;a.loaded=!1;a.hideTab(!0);a.checkValues();var d={_save:!0,_confirm:b?1:"",_save_and_continue:c,
_box:a.syncAdminBoxFromClientToServer()};n(a.focus.download)||a.focus.confirm&&n(a.focus.confirm.download)?a.save2(g.nonAsyncAJAX(a.getURL(),g.urlRequest(d)),c):($.post(a.getURL(),d,function(b){a.save2(b,c)},"text"),s.nowDoingSomething("saving"))}};a.save2=function(b,c){delete a.saving;"\x3c!--Valid--\x3e"==(""+b).substr(0,12)?(b=b.substr(12),"\x3c!--Confirm--\x3e"==(""+b).substr(0,14)?(b=b.substr(14),a.load(b),a.sortTabs(),a.draw(),a.showConfirm(c)):"\x3c!--Download--\x3e"==(""+b).substr(0,15)?(h("zenario_iframe_form").action=
a.getURL(),h("zenario_iframe_form").innerHTML='<input type="hidden" name="_download" value="1"/><input type="hidden" name="_box" value="'+t(a.syncAdminBoxFromClientToServer())+'"/>',h("zenario_iframe_form").submit(),c&&(b=b.substr(15),a.load(b)),a.refreshParentAndClose(!0,c)):"\x3c!--Saved--\x3e"==(""+b).substr(0,12)?(b=b.substr(12),a.load(b),a.refreshParentAndClose(!1,c)):(a.close(),s.showMessage(b,!0,"error"))):(a.load(b),a.sortTabs(),a.switchToATabWithErrors(),a.draw())};a.showConfirm=function(b){if(a.focus&&
a.focus.confirm&&n(a.focus.confirm.show)){var c=a.focus.confirm.message;n(a.focus.confirm.html)||(c=t(c,!0));b='<input type="button" class="submit_selected" value="'+a.focus.confirm.button_message+'" onclick="zenarioAB.save(true, '+n(b)+');"/><input type="button" class="submit" value="'+a.focus.confirm.cancel_button_message+'" onclick="zenarioA.closeFloatingBox();"/>';s.floatingBox(c,b,v(a.focus.confirm.message_type,"none"))}};a.hideTab=function(b){b?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled",
"disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){a.tabHidden=!0;a.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),a.tabHidden=!0,a.draw())};a.draw=function(){if(a.welcome&&a.focus){a.focus._clear_local_storage&&(delete a.focus._clear_local_storage,g.sClear(!0));if(a.focus._location!==l){K.location.href=g.addBasePath(a.focus._location);return}a.focus._task!==
l&&(a.task=a.focus._task,delete a.focus._task)}(a.isOpen||a.SKColPicker||a.welcome)&&a.loaded&&a.tabHidden&&a.draw2()};a.draw2=function(b){a.SKColPicker=b;if(!a.SKColPicker&&!a.welcome){h("zenario_fbAdminFloatingBox").className=a.baseCSSClass+" "+(a.focus.css_class||"")+" "+(n(a.focus.hide_tab_bar)?"zenario_admin_box_with_tabs_hidden":"zenario_admin_box_with_tabs_shown");!a.focus.tab||a.focus.tabs[a.focus.tab]&&!s.hidden(a.focus.tabs[a.focus.tab])||(a.focus.tab=!1);b=[];for(var c in a.sortedTabs)if(g.has(a.sortedTabs,
c)){var d=a.sortedTabs[c];a.focus.tabs[d]&&!s.hidden(a.focus.tabs[d])&&(a.focus.tab||(a.focus.tab=d),b.push({tabId:d,current:a.focus.tab==d,label:a.focus.tabs[d].label}))}h("zenario_jqmTabs").innerHTML=s.microTemplate(a.templatePrefix+"_tab",b);a.setTitle(a.focus.title);a.showCloseButton();f="";a.focus.save_and_continue_button_message&&(f+='<input id="zenarioAFB_save_and_continue"  type="button" value="'+t(a.focus.save_and_continue_button_message)+'"',f=a.editModeOnBox()?f+' class="submit_selected" onclick="zenarioAB.save(undefined, true);"/>':
f+' class="submit_disabled"/>');f+='<input id="zenarioAFB_save"  type="button" value="'+v(t(a.focus.save_button_message),w.save)+'"';f=a.editModeOnBox()?f+' class="submit_selected" onclick="zenarioAB.save();"/>':f+' class="submit_disabled"/>';a.focus.cancel_button_message&&(f+='<input type="button" value="'+t(a.focus.cancel_button_message)+'" onclick="zenarioAB.close();">');h("zenario_fbButtons").innerHTML=f;a.size();h("zenario_fbAdminFloatingBox").style.display="block"}s.nowDoingSomething(!1);a.welcome&&
$("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").clearQueue();var f=a.drawFields();if(a.SKColPicker)return f;if(a.welcome&&!1===a.shownTab)a.insertHTML(f),$("#welcome").show({effect:"drop",direction:"up",duration:300,complete:a.addJQueryElementsToTabAndFocusFirstField}),g.addJQueryElements("#zenario_abtab ",!0);else if(a.shownTab==a.focus.tab){if(a.focus.shake===l?a.differentTab&&a.errorOnTab(a.focus.tab):n(a.focus.shake))$(a.welcome?"#welcome":"#zenario_abtab").effect({effect:"bounce",
duration:125,direction:"right",times:2,distance:5,mode:"effect",complete:function(){a.insertHTML(f);$("#zenario_abtab").clearQueue().show().animate({opacity:1},75,function(){g.browserIsIE()&&this.style.removeAttribute("filter");a.addJQueryElementsToTabAndFocusFirstField()});a.hideShowFields()}});else{a.insertHTML(f);var e=a.lastScrollTop;$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){g.browserIsIE()&&this.style.removeAttribute("filter");e!==l?a.addJQueryElementsToTab():
a.addJQueryElementsToTabAndFocusFirstField()});$("#zenario_fbAdminInner").scrollTop(e);a.hideShowFields()}delete a.focus.shake}else a.insertHTML(f),$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){g.browserIsIE()&&this.style.removeAttribute("filter");a.addJQueryElementsToTabAndFocusFirstField()});a.shownTab=a.focus.tab;delete a.lastScrollTop};a.drawFields=function(){s.clearHTML5UploadFromDragDrop();a.sliders={};a.codeEditors={};a.colourPickers={};var b=a.focus.tab,c="",d=
"";!a.savedAndContinued(b)&&a.editCancelEnabled(b)&&(d='<div class="zenario_editCancelButton"><input class="submit" type="button" onclick="zenarioAB.changeMode(); return false;" value="'+(a.editModeOn()?w.cancel:w.edit)+'"></div>');var f=v(a.focus.tabs[b].template,a.templatePrefix+"_current_tab"),e=!1,d={fields:{},rows:[],tabId:b,path:a.path,revert:d,errors:[],notices:{}};if(a.editModeOn()){if(a.focus.tabs[b].errors)for(var k in a.focus.tabs[b].errors)g.has(a.focus.tabs[b].errors,k)&&(a.isInfoTag(k)||
d.errors.push({message:a.focus.tabs[b].errors[k]}));if(a.focus.tabs[b].fields)for(var p in a.focus.tabs[b].fields)g.has(a.focus.tabs[b].fields,p)&&!a.isInfoTag(p)&&a.focus.tabs[b].fields[p].error&&d.errors.push({message:a.focus.tabs[b].fields[p].error})}if(a.focus.tabs[b].notices)for(var m in a.focus.tabs[b].notices)g.has(a.focus.tabs[b].notices,m)&&!a.isInfoTag(m)&&n(a.focus.tabs[b].notices[m].show)&&{error:1,warning:1,question:1,success:1}[a.focus.tabs[b].notices[m].type]&&(d.notices[m]=a.focus.tabs[b].notices[m]);
for(p in a.sortedFields[b])g.has(a.sortedFields[b],p)&&(k=a.sortedFields[b][p],m=a.focus.tabs[b].fields[k],m._id=k,m._html=a.drawField(b,k,!0),!1!==m._html&&(!m._startNewRow&&d.rows.length||d.rows.push({fields:[]}),e||a.focus.tabs[b].show_errors_after_field!=k||(d.rows[d.rows.length-1].errors=d.errors,d.rows[d.rows.length-1].notices=d.notices,e=!0),d.rows[d.rows.length-1].fields.push(m),d.fields[k]=m));e||d.rows.splice(0,0,{errors:d.errors,notices:d.notices});c+=s.microTemplate(f,d);for(p in a.sortedFields[b])g.has(a.sortedFields[b],
p)&&(k=a.sortedFields[b][p],delete a.focus.tabs[b].fields[k]._startNewRow,delete a.focus.tabs[b].fields[k]._hideOnOpen,delete a.focus.tabs[b].fields[k]._showOnOpen,delete a.focus.tabs[b].fields[k]._html,delete a.focus.tabs[b].fields[k]._id);return c};a.insertHTML=function(b){var c,d=h("zenario_abtab");d.innerHTML=b;a.tabHidden=!1;a.changes(a.focus.tab)?$(d).addClass("zenario_abtab_changed"):$(d).removeClass("zenario_abtab_changed");if(a.sliders)for(c in a.sliders)g.has(a.sliders,c)&&$(h(c)).each(function(b,
d){var f;if(f=h("zenario_slider_for__"+c))a.sliders[c].min!==l&&(a.sliders[c].min*=1),a.sliders[c].max!==l&&(a.sliders[c].max*=1),a.sliders[c].step!==l&&(a.sliders[c].step*=1),a.sliders[c].disabled=!a.editModeOn(),a.sliders[c].value=$(d).val(),a.sliders[c].slide=function(a,b){$(d).val(b.value)},a.sliders[c].change=function(b,c){this&&this.id&&a.fieldChange(this.id.replace("zenario_slider_for__",""))},$(f).slider(a.sliders[c])});if(a.codeEditors)for(c in a.codeEditors)if(g.has(a.codeEditors,c)&&(d=
a.codeEditors[c],b=ace.edit(c),b.session.setUseSoftTabs(!1),b.setShowPrintMargin(!1),d.readonly&&(b.setReadOnly(!0),b.setBehavioursEnabled(!1)),b.session.setOption("useWorker",!1),d=a.codeEditors[c].language))try{d=d.match(/\.twig\.html$/i)?"ace/mode/twig":d.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(d).mode:"ace/mode/"+d,b.session.setMode(d)}catch(f){console.log("Ace editor could not load that language",d)}if(a.colourPickers)for(c in a.colourPickers)g.has(a.colourPickers,c)&&(d=a.colourPickers[c],
$(h(c)).spectrum(d))};a.hideShowFields=function(a){var c=$(".zenario_hide_on_open"),d=$(".zenario_hide_row_on_open"),f=$(".zenario_show_on_open"),e=function(a,b){b.style.display="none"};f.length&&!c.length?f.show("blind",200,a):!f.length&&c.length?c.hide("blind",200,function(){d.each(e)}):f.length&&c.length&&(c.each(e),d.each(e),f.show())};a.addJQueryElementsToTab=function(){g.addJQueryElements("#zenario_abtab ",!0)};a.addJQueryElementsToTabAndFocusFirstField=function(){g.addJQueryElements("#zenario_abtab ",
!0);a.focusFirstField()};a.focusFirstField=function(){if(a.focus&&!n(a.focus.tabs[a.focus.tab].disable_autofocus)){var b=-1,c=[],d=l,f;for(f in a.sortedFields[a.focus.tab])if(g.has(a.sortedFields[a.focus.tab],f)){var e=a.sortedFields[a.focus.tab][f],k=a.focus.tabs[a.focus.tab].fields[e];if(h(e)&&$(h(e)).is(":visible")&&(c[++b]={id:e,type:k.type,empty:""==h(e).value,focusable:k.type&&{password:1,checkbox:1,select:1,text:1,textarea:1}[k.type]&&!n(h(e).disabled)&&!n(h(e).readonly)},1<b))break}if(c[0]&&
!c[0].empty&&c[1]&&c[1].focusable&&c[1].empty&&"password"==c[1].type)d=1;else if(c[0]&&c[0].focusable)d=0;else if(c[1]&&c[1].focusable)d=1;else return;setTimeout(function(){h(c[d].id).focus()},50)}};a.focusField=function(){a.fieldToFocus&&h(a.fieldToFocus)&&$(h(a.fieldToFocus)).is(":visible")&&h(a.fieldToFocus).focus();delete a.fieldToFocus};a.setTitle=function(a,c){a?($("#zenario_fbAdminFloatingBox .zenario_jqmTitle").css("display","block"),c||(a=t(a)),h("zenario_jqmTitle").innerHTML=a,s.setTooltipIfTooLarge("#zenario_jqmTitle",
a,s.tooltipLengthThresholds.adminBoxTitle)):$("#zenario_fbAdminFloatingBox .zenario_jqmTitle").css("display","none")};a.showCloseButton=function(){a.focus.cancel_button_message?$("#zenario_fbAdminFloatingBox .zenario_jqmClose").css("display","none"):$("#zenario_fbAdminFloatingBox .zenario_jqmClose").css("display","block")};a.errorOnBox=function(){if(a.focus&&a.focus.tabs)for(tab in a.focus.tabs)if(g.has(a.focus.tabs,tab)&&a.errorOnTab(tab))return!0;return!1};a.errorOnTab=function(b){if(a.focus.tabs[b]&&
a.editModeOn(b)){if(a.focus.tabs[b].errors)for(var c in a.focus.tabs[b].errors)if(g.has(a.focus.tabs[b].errors,c)&&!a.isInfoTag(c))return!0;if(a.focus.tabs[b].fields)for(var d in a.focus.tabs[b].fields)if(g.has(a.focus.tabs[b].fields,d)&&!a.isInfoTag(d)&&a.focus.tabs[b].fields[d].error)return!0}};a.checkValues=function(b){b?a.wipeTab():a.readTab();for(var c in a.focus.tabs)if(g.has(a.focus.tabs,c)&&!a.isInfoTag(c)&&(b=a.editModeOn(c),a.focus.tabs[c].fields))for(var d in a.focus.tabs[c].fields)if(g.has(a.focus.tabs[c].fields,
d)&&!a.isInfoTag(d)){var f=a.focus.tabs[c].fields[d];f.snippet||"submit"==f.type||"toggle"==f.type||(f.current_value===l&&(f.current_value=a.value(d,c,!0)),b&&(f.value===l&&(f.value=a.value(d,c,!1)),f.multiple_edit&&f.multiple_edit._changed===l&&f.multiple_edit.changed!==l&&(f.multiple_edit._changed=f.multiple_edit.changed)))}};a.allowedAtt={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,onchange:!0,
onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,list:!0,max:!0,min:!0,multiple:!0,pattern:!0,placeholder:!0,required:!0,step:!0};a.drawField=function(b,c,d,f,e,k,p,m,z,h){d="";var y=!1,r={"class":""},x={};e===l&&(e=a.focus.tabs[b].fields[c]);p===l&&(p=!a.editModeOn()||n(e.read_only));e.type&&"datetime"==e.type&&(p=!0);if(z===l&&"object"==typeof e.values){z=[];
for(var q in e.values)g.has(e.values,q)&&("object"==typeof e.values[q]?s.hidden(e.values[q])||(e.values[q].ord!==l?z.push([q,e.values[q].ord]):e.values[q].label!==l?z.push([q,e.values[q].label]):z.push([q,q])):z.push([q,e.values[q]]));z.sort(s.sortArray);for(var C in z)g.has(z,C)&&(z[C]=z[C][0])}if(f===l){e.load_values_from_organizer_path&&!e.values&&a.loadValuesFromOrganizerPath(e);e._startNewRow=!n(e.same_row);if(e._startNewRow&&!1!==a.shownTab&&a.shownTab==a.focus.tab&&"editor"!=e.type&&"code_editor"!=
e.type&&a.focus.tabs[b].fields[c]._h&&!s.hidden(e))e._showOnOpen=!0,delete a.focus.tabs[b].fields[c]._h;else if(e._startNewRow&&!1!==a.shownTab&&a.shownTab==a.focus.tab&&"editor"!=e.type&&"code_editor"!=e.type&&!a.focus.tabs[b].fields[c]._h&&s.hidden(e))e._hideOnOpen=!0,a.focus.tabs[b].fields[c]._h=!0;else{if(s.hidden(e))return a.focus.tabs[b].fields[c]._h=!0,!1;delete a.focus.tabs[b].fields[c]._h}q="";var G=!1;e.multiple_edit&&(G=p||e.multiple_edit._changed===l?e.multiple_edit.changed:n(e.multiple_edit._changed),
n(e.multiple_edit.disable_when_unchanged)&&!G&&(m=!0),n(e.multiple_edit.hide_ui)||!e.multiple_edit.select_list?(q+='<input type="checkbox" class="multiple_edit" id="multiple_edit__'+t(c)+'"'+(G?' checked="checked"':""),q=n(e.multiple_edit.hide_ui)?q+' style="display: none;"':p?q+' disabled="disabled"':q+(" onchange=\"zenarioAB.meChange(this.checked, '"+t(c)+"');\""),q+="/> "):(q+='<select class="multiple_edit" id="multiple_edit__'+t(c)+'"',q=p?q+' disabled="disabled"':q+(" onchange=\"zenarioAB.meChange(this.value == 1, '"+
t(c)+"');\""),q+='><option value=""'+(G?"":' selected="selected"')+">"+v(e.multiple_edit.select_list.not_changed_label,w.notChanged)+'</option><option value="1"'+(G?' selected="selected"':"")+">"+v(e.multiple_edit.select_list.changed_label,w.changed)+"</option></select> "));d+=q;e.pre_field_html!==l&&(d+=e.pre_field_html)}e.snippet||k!==l||(k=a.value(c,b,l,!0));k===l&&(k="");if(p||m)r.disabled="disabled";if(e.snippet)e.snippet.html?d+='<span id="snippet__'+t(c)+'">'+e.snippet.html+"</span>":e.snippet.url?
d=n(e.snippet.cache)?a.cachedAJAXSnippets[e.snippet.url]?d+a.cachedAJAXSnippets[e.snippet.url]:d+(a.cachedAJAXSnippets[e.snippet.url]=g.nonAsyncAJAX(g.addBasePath(e.snippet.url))):d+g.nonAsyncAJAX(g.addBasePath(e.snippet.url)):e.snippet.separator&&(d+='<hr class="input_separator"',e.snippet.separator.style&&(d+=' style="'+t(e.snippet.separator.style)+'"'),d+="/>");else if(("checkboxes"==e.type||"radios"==e.type)&&f===l)e.values&&(h=a.pickedItemsArray(e,k),C=$.extend(!0,{},e),C.name=v(e.name,c),C.type=
"checkboxes"==e.type?"checkbox":"radio",p&&(C.disabled=!0),d+=a.hierarchicalBoxes(b,c,k,e,C,h,m,z));else if(e.upload||e.pick_items)k={id:c,wrappedId:"name_for_"+c,readOnly:p,tempReadOnly:m},p?k.pickedItems=a.drawPickedItems(c,!0):(k.pickedItems=a.drawPickedItems(c,!1,m),e.pick_items&&e.pick_items.path&&e.pick_items.min_path&&e.pick_items.target_path&&!n(e.pick_items.hide_select_button)&&(k.select={onclick:"zenarioAB.pickItems('"+t(c)+"');",phrase:e.pick_items.select_phrase||w.selectDotDotDot}),e.upload&&
(k.upload={onclick:"zenarioAB.upload('"+t(c)+"');",phrase:e.upload.upload_phrase||w.uploadDotDotDot},n(e.upload.drag_and_drop)&&a.upload(c,!0),D.Dropbox&&Dropbox.isBrowserSupported()&&(k.dropbox={onclick:"zenarioAB.chooseFromDropbox('"+t(c)+"');",phrase:e.upload.dropbox_phrase||w.dropboxDotDotDot}))),d+=s.microTemplate(a.templatePrefix+"_picked_items",k);else if(e.type){r.onchange="zenarioAB.fieldChange('"+t(c)+"');";e.disabled&&(r["class"]+="disabled ");e.return_key_presses_button&&!p&&(r.onkeyup=
v(r.onkeyup,"","")+"if (event.keyCode == 13) {$('#"+t(e.return_key_presses_button)+"').click();}");n(e.multiple_edit)&&!p&&(r.onkeyup=v(r.onkeyup,"","")+"if (event && event.keyCode == 9) return true; zenarioAB.meMarkChanged('"+t(c)+"', this.value, '"+t(e.value)+"');");r["class"]+="input_"+e.type;if("select"==e.type)e.slider&&(y=!0,d+=a.drawSlider(c,e,p,!0)),d+="<select";else if("textarea"==e.type)d+="<textarea";else if("code_editor"==e.type)d+="<div",r["class"]=" zenario_embedded_ace_editor",a.codeEditors[c]=
{readonly:p,language:e.language};else if("color_picker"==e.type||"colour_picker"==e.type)d+="<input",r["class"]=" zenario_color_picker",m=e.color_picker_options||e.colour_picker_options||{},m.disabled=p,m.preferredFormat=m.preferredFormat||"hex",a.colourPickers[c]=m;else if("editor"==e.type)d+="<textarea",r.style="visibility: hidden;",r["class"]=p?" tinymce_readonly":e.insert_image_button?e.insert_link_button?" tinymce_with_images_and_links":" tinymce_with_images":e.insert_link_button?" tinymce_with_links":
" tinymce";else if("submit"==e.type||"toggle"==e.type){d+="<input";r.type="button";if(!p||n(e.can_be_pressed_in_view_mode))x.onclick="zenarioAB.clickButton(this, '"+c+"');",delete r.disabled;"submit"==e.type&&(a.focus.tabs[b].fields[c].pressed=!1);"toggle"==e.type&&(r["class"]+=a.focus.tabs[b].fields[c].pressed?" pressed":" not_pressed")}else"date"==e.type||"datetime"==e.type?(d+="<input",r.type="text",r["class"]+=" zenario_datepicker",n(e.change_month_and_year)&&(r["class"]+=" zenario_datepicker_change_month_and_year"),
r.readonly="readonly",p||(r.onkeyup=v(r.onkeyup,"","")+"zenario.dateFieldKeyUp(this, event, '"+t(c)+"');")):"url"==e.type?(d+="<input",r.type="url",r.onfocus=v(r.onfocus,"","")+"if(!this.value) this.value = 'http://';",r.onblur=v(r.onblur,"","")+"if(this.value == 'http://') this.value = '';"):(e.slider&&(y=!0,d+=a.drawSlider(c,e,p,!0)),d+="<input",r.type=e.type);if("checkbox"==e.type||"radio"==e.type)n(k)&&(r.checked="checked"),k=l;y&&(r.onchange=v(r.onchange,"","")+"$('#zenario_slider_for__"+c+"').slider('value', $(this).val());",
r.onkeyup=v(r.onkeyup,"","")+"$('#zenario_slider_for__"+c+"').slider('value', $(this).val());");f===l?e.id=c:(e.id=c+"___"+f,r["class"]+=" control_for__"+c);"radio"==e.type&&e.name||(e.name=c);m=e;h&&(m=$.extend({},e,h));for(var u in m)if(g.has(m,u)&&a.allowedAtt[u])if("disabled"==u||"readonly"==u){if(n(r[u])||n(m[u]))d+=" "+u+'="'+u+'"'}else d+=" "+u+'="',r[u]&&(d+=r[u]+" ",delete r[u]),d+=t(m[u]),x[u]&&(d+=" "+x[u],delete x[u]),d+='"';for(u in r)g.has(r,u)&&(d+=" "+u+'="'+t(r[u]),x[u]&&(d+=" "+
x[u],delete x[u]),d+='"');for(u in x)g.has(x,u)&&(d+=" "+u+'="'+t(x[u])+'"');"select"==e.type?d+=">":"textarea"==e.type||"editor"==e.type?d+=">"+t(k,!1,"asis")+"</textarea>":"code_editor"==e.type?d+=">"+t(k,!1,"asis")+"</div>":"date"==e.type||"datetime"==e.type?(d+=' value="'+t(g.formatDate(k,"datetime"==e.type))+'"/>',d+='<input type="hidden" id="_value_for__'+t(c)+'" value="'+t(k)+'"/>',p||a.SKColPicker||(d+='<input type="button" class="zenario_remove_date" value="x" onclick="zenarioAB.blankField(\''+
t(c)+"'); zenarioAB.fieldChange('"+t(c)+"');\"/>")):d=k!==l?d+(' value="'+t(k,!1,"asis")+'"/>'):d+"/>";if("select"==e.type){e.empty_value&&(d+='<option value="">'+t(e.empty_value)+"</option>");if(e.values)for(C in z)g.has(z,C)&&(q=z[C],d+='<option value="'+t(q)+'"'+(q==k?' selected="selected"':"")+">"+t(e.values[q],!1,!0)+"</option>");d+="</select>"}}f===l&&("url"!=e.type||p||(d+='&nbsp; <input type="button" class="submit" value="Test" onclick="if (get(\''+t(c)+"').value) window.open(zenario.addBasePath(get('"+
t(c)+"').value));\"/>"),e.post_field_label!==l&&(d+='<label for="'+t(c)+'" id="label_for__'+t(c)+'"> '+t(e.post_field_label)+"</label>"),e.post_field_html!==l&&(d+=e.post_field_html),y&&(d+=a.drawSlider(c,e,p,!1)));return d};a.chooseFromDropbox=function(b){var c;if(!a.focus.tabs[a.focus.tab]||!(c=a.focus.tabs[a.focus.tab].fields[b])||!c.upload)return!1;c={cancel:function(){s.hideAJAXLoader()},linkType:"direct",multiselect:!!n(c.upload.multi),extensions:c.upload.extensions?_.toArray(c.upload.extensions):
l,success:function(c){s.showAJAXLoader();g.multipleAJAX("zenario/ajax.php?method_call=handleAdminBoxAJAX&fetchFromDropbox=1",c,!0,function(c){var d,k,p,m,h;if(!a.focus.tabs[a.focus.tab]||!(p=a.focus.tabs[a.focus.tab].fields[b])||!p.upload)return!1;m=p.current_value===l?p.value:p.current_value;h=n(p.upload.multi);for(d in c)g.has(c,d)&&(k=c[d])&&k.id&&(m=h&&m?m+(","+k.id):k.id);s.hideAJAXLoader();a.redrawPickedItems(b,p,m)})}};s.showAJAXLoader();Dropbox.choose(c)};a.upload=function(b,c){var d;if(!a.focus.tabs[a.focus.tab]||
!(d=a.focus.tabs[a.focus.tab].fields[b])||!d.upload)return!1;d={class_name:d.class_name,upload:d.upload};a.uploadCallback=function(c){if(c){var d,k,p,m,h;if(!a.focus.tabs[a.focus.tab]||!(p=a.focus.tabs[a.focus.tab].fields[b])||!p.upload)return!1;m=p.current_value===l?p.value:p.current_value;h=n(p.upload.multi);for(d in c)g.has(c,d)&&(k=c[d])&&k.id&&(m=h&&m?m+(","+k.id):k.id);a.redrawPickedItems(b,p,m)}};c?s.setHTML5UploadFromDragDrop(A+"zenario/ajax.php?method_call=handleAdminBoxAJAX",{fileUpload:1},
a.uploadCallback,h("zenario_fbAdminInner")):s.action(a,d,l,l,l,{fileUpload:1})};a.uploadComplete=function(b){a.uploadCallback!==l&&a.uploadCallback(b);delete a.uploadCallback};a.drawSlider=function(b,c,d,f){html="";if(n(c.slider.before_field)?f:!f)d&&(html+='<div class="ui-disabled">'),html+='<div id="zenario_slider_for__'+t(b)+'" class="'+t(c.slider["class"])+'" style="'+t(c.slider.style)+'"></div>',a.sliders[b]=c.slider,d&&(html+="</div>");return html};a.pickedItemsArray=function(a,c){if(!1===c||
null===c||c===l||!(0!==c&&"0"!==c||a.values&&(a.values[0]||a.values["0"])))return{};var d=(c+"").split(","),f={},e,k,p,m;a._display_value=!1;for(p in d)g.has(d,p)&&(m=d[p])&&(a.upload&&(k=g.decodeItemIdForStorekeeper(m))&&(k=k.split("/"))&&k[1]?(f[m]=k[1],n(k[2])&&n(k[3])&&(f[m]+=" ["+k[2]+" \u00d7 "+k[3]+"px]")):a.values&&a.values[m]&&"string"==typeof a.values[m]?f[m]=a.values[m]:a.values&&a.values[m]&&a.values[m].label?f[m]=a.values[m].label:a.pick_items&&(a.pick_items.target_path&&(e=s.getSKItem(a.pick_items.target_path,
m))||a.pick_items.path&&a.pick_items.path!=a.pick_items.target_path&&(e=s.getSKItem(a.pick_items.path,m)))?(a.values||(a.values={}),a.values[m]=f[m]=s.formatSKItemName(e,m)):a.upload&&m==1*m&&(k=s.lookupFileDetails(m))?(a.values||(a.values={}),f[m]=k.filename,n(k.width)&&n(k.height)&&(f[m]+=" ["+k.width+" \u00d7 "+k.height+"px]"),a.values[m]=f[m]):f[m]=m,!1===a._display_value&&(a._display_value=f[m]));return f};a.pickedItemsValue=function(a){var c,d="";if(a)for(c in a)g.has(a,c)&&(d+=(""===d?"":",")+
c);return d};a.hierarchicalBoxes=function(b,c,d,f,e,k,p,m,h,E,y,r){var x=1;if(!r)r=0,x=1*f.cols||1;else if(10<r)return"";if(h===l){h={};for(var q in f.values)g.has(f.values,q)&&"object"==typeof f.values[q]&&f.values[q].parent&&(h[f.values[q].parent]=!0)}y||(y={});E&&(y[E]=!0);var v=0,w="",u,A;r&&(w+='<div class="zenario_hierarchical_box_children" id="'+t("children_for___"+c+"___"+E)+'">');for(var D in m)if(g.has(m,D)){u={};q=m[D];q==1*q&&(q*=1);var F=l;A="object"==typeof f.values[q]?f.values[q]:{label:f.values[q]};
F=A.parent;"0"===F&&(F=!1);if(!E&&!F||E==F){if(u.newRow=++v>x)v=1;F=d?!0===d||1===d||"1"===d?!0===q||1===q||"1"===q:k?k[q]!==l?!0:!1:q==d:!q;if("checkboxes"==f.type&&n(f.checking_child_checks_parents)){var B="";E&&(B+="if (this.checked) { for (var cb in "+JSON.stringify(y)+") { get('"+t(c)+"___' + cb).checked = true; } } ");h[q]&&(B+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");B?e.onchange=f.onchange?B+" "+f.onchange:B:f.onchange?e.onchange=f.onchange:
delete e.onchange}else"checkboxes"==f.type&&n(f.checking_parent_checks_children)&&(B="",h[q]&&(B+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),B?e.onchange=f.onchange?B+" "+f.onchange:B:f.onchange?e.onchange=f.onchange:delete e.onchange);u.lovId=c+"___"+q;u.lovField=A;u.lovHTML=a.drawField(b,c,!0,q,e,F,!1,p,m,A);u.childrenHTML="";h[q]&&(u.childrenHTML=a.hierarchicalBoxes(b,c,d,f,e,k,p,m,h,q,$.extend(!0,{},y),r+1),v=0);w+=s.microTemplate("zenario_admin_box_radio_or_checkbox",
u)}}r&&(w+="</div>");return w};a.drawPickedItems=function(b,c,d,f){f===l&&(f=a.focus.tab);var e=a.focus.tabs[f].fields[b],k=!1,p,m=a.value(b,f,c),h=a.pickedItemsArray(e,m);f=e.upload&&n(e.upload.reorder_items);for(p in h)if(g.has(h,p)){k=!0;break}if(k){var k=[],t=[];if(f)for(p in m=m.split(","),m)g.has(m,p)&&t.push([m[p],h[m[p]]]);else{for(p in h)g.has(h,p)&&t.push([p,h[p]]);t.sort(s.sortArray)}for(p=0;p<t.length;++p){var h=t[p][0],y=t[p][1],r=h==1*h,x,q,m={id:b,item:h,label:y,first:0==p,last:p==
t.length-1,readOnly:c,tempReadOnly:d};!e.pick_items||e.upload&&!r||!(q=e.pick_items.path)||q!=e.pick_items.target_path&&e.pick_items.min_path!=e.pick_items.target_path||(q="//"==g.rightHandedSubStr(q,2)?q+h:"/"==g.rightHandedSubStr(q,1)?q+("/"+h):q+("//"+h),m.organizerPath=q);e.upload&&(m.isUpload=!0,x=(x=(""+y).match(/(.*?)\.(\w+)$/)||(""+y).match(/(.*?)\.(\w+) \[.*\]$/))&&x[2]?x[2].toLowerCase():"unknown",m.extension=x,r=r?A+"zenario/file.php?id="+h:A+"zenario/file.php?getUploadedFileInCacheDir="+
encodeURIComponent(h),x.match(/gif|jpg|jpeg|png/)?(m.thumbnail={onclick:"zenarioAB.showPickedItemInPopout('"+r+"&popout=1&dummy_filename="+encodeURIComponent("image."+x)+"');",src:r+"&sk=1"},(y=(""+y).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&y[1]&&y[2]&&s.resizeImage(y[1],y[2],180,120,m.thumbnail)):m.adminDownload=r+"&adminDownload=1",f&&(m.first||(m.nudgeUp={onclick:"zenarioAB.nudge('"+H(b)+"', "+(p-1)+", "+p+");"}),m.last||(m.nudgeDown={onclick:"zenarioAB.nudge('"+H(b)+"', "+p+
", "+(p+1)+");"})));c||e.pick_items&&n(e.pick_items.hide_remove_button)||(m.removeButton={onclick:"zenarioAB.removePickedItem('"+H(b)+"', '"+H(h)+"');"});k.push(m)}}else k={readOnly:c,tempReadOnly:d,noItemSelected:!0,nothing_selected_phrase:v(e.pick_items&&e.pick_items.nothing_selected_phrase,w.nothing_selected)};return s.microTemplate(a.templatePrefix+"_picked_item",k)};a.showPickedItemInPopout=function(b){s.action(a,{popout:{href:b,css_class:"zenario_show_colobox_above_fab"}})};a.pickItems=function(b){if(!a.focus.tabs[a.focus.tab]||
!a.focus.tabs[a.focus.tab].fields[b])return!1;var c=a.focus.tabs[a.focus.tab].fields[b],d,f;if(!(c.pick_items&&c.pick_items.path&&c.pick_items.min_path&&c.pick_items.target_path))return!1;f=c.pick_items.path;n(c.pick_items.multiple_select)||f!=c.pick_items.target_path&&c.pick_items.min_path!=c.pick_items.target_path||!(d=a.readField(b))||-1!=d.indexOf(",")||(f="//"==g.rightHandedSubStr(f,2)?f+d:"/"==g.rightHandedSubStr(f,1)?f+("/"+d):f+("//"+d));a.SKTarget=b;s.SK("zenarioAB","setPickedItems",c.pick_items.multiple_select,
f,c.pick_items.target_path,c.pick_items.min_path,c.pick_items.max_path,c.pick_items.disallow_refiners_looping_on_min_path,l,c.pick_items.one_to_one_choose_phrase,c.pick_items.one_to_many_choose_phrase,l,!0,l,l,l,l,l,l,l,l,c.pick_items)};a.setPickedItems=function(b,c,d,f){b=a.SKTarget;d=a.focus.tabs[a.focus.tab].fields[b];var e=d.current_value===l?d.value:d.current_value,k,h,e=n(d.pick_items.multiple_select)&&e?a.pickedItemsArray(d,e):{};for(k in c._items)if(g.has(c._items,k)&&(h=g.decodeItemIdForStorekeeper(k),
d.values||(d.values={}),d.values[h]||(d.values[h]=s.formatSKItemName(f,k)),e[h]=!0,!n(d.pick_items.multiple_select)))break;a.redrawPickedItems(b,d,e)};a.removePickedItem=function(b,c){var d=a.focus.tabs[a.focus.tab].fields[b],f=d.current_value===l?d.value:d.current_value,f=f.split(","),e;for(e in f)if(g.has(f,e)&&f[e]==c){f.splice(e,1);break}f=f.join(",");a.redrawPickedItems(b,d,f)};a.nudge=function(b,c,d){c*=1;d*=1;var f=a.focus.tabs[a.focus.tab].fields[b],e=f.current_value===l?f.value:f.current_value,
e=e.split(",");if(e[c]!==l&&e[d]!==l){var k=e[c];e[c]=e[d];e[d]=k}e=e.join(",");a.redrawPickedItems(b,f,e)};a.redrawPickedItems=function(b,c,d){"object"==typeof d&&(d=a.pickedItemsValue(d));c.current_value=d;h("name_for_"+b).innerHTML=a.drawPickedItems(b);a.fieldChange(b)};a.changed={};a.changes=function(b){if(a.focus&&a.focus.tab){if(b==l){for(b in a.focus.tabs)if(g.has(a.focus.tabs,b)&&a.changed[b])return!0;return!1}return a.changed[b]}return!1};a.markAsChanged=function(b,c){a.focus&&(b===l&&(b=
a.focus.tab),b&&(a.changed[b]||(a.changed[b]=!0),a.focus.tab==b&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};a.fieldChange=function(b){if(a.focus&&a.focus.tab&&a.focus.tabs[a.focus.tab]&&a.focus.tabs[a.focus.tab].fields[b]){var c=a.focus.tab,d=a.focus.tabs[c].fields[b];a.markAsChanged(c);n(d.multiple_edit)&&a.meMarkChanged(b);a.validateFormatOrRedrawForField(d);a.SKColPicker&&d._change_filter_on_change&&zenarioO.changeFilters()}};a.validateFormatOrRedrawForField=function(b){"object"!=
typeof b&&(b=a.focus.tabs[a.focus.tab].fields[b]);var c=n(b.validate_onchange),d=n(b.format_onchange);b=n(b.redraw_onchange);if(c=c||a.errorOnTab(a.focus.tab)&&(d||b))return a.validate(),!0;if(d)return a.format(),!0;b&&(a.readTab(),a.redrawTab());return b};a.meMarkChanged=function(b,c,d){if(c===l||c!=d)a.focus.tabs[a.focus.tab].fields[b].multiple_edit._changed=!0,a.meSetCheckbox(b,!0)};a.meSetCheckbox=function(a,c){"checkbox"==h("multiple_edit__"+a).type?h("multiple_edit__"+a).checked=c:h("multiple_edit__"+
a).value=c?1:""};a.meChange=function(b,c,d){if(b)a.focus.tabs[a.focus.tab].fields[c].multiple_edit._changed=!0;else{if(!d&&n(a.focus.tabs[a.focus.tab].fields[c].multiple_edit.warn_when_abandoning_changes)&&a.focus.tabs[a.focus.tab].fields[c].multiple_edit.original_value!==l&&a.readField(c)!=a.focus.tabs[a.focus.tab].fields[c].multiple_edit.original_value){d='<input type="button" class="submit_selected" value="'+w.abandonChanges+'" onclick="zenarioAB.meChange(false, \''+t(c)+'\', true);"/><input type="button" class="submit" value="'+
w.cancel+'"/>';s.floatingBox(w.abandonChangesConfirm,d,"warning");a.meSetCheckbox(c,!0);return}a.focus.tabs[a.focus.tab].fields[c].multiple_edit._changed=!1;delete a.focus.tabs[a.focus.tab].fields[c].current_value;d=a.focus.tabs[a.focus.tab].fields[c];var f=d.value;d.multiple_edit.original_value!==l&&(f=a.focus.tabs[a.focus.tab].fields[c].current_value=d.multiple_edit.original_value);h(c)&&!d.pick_items?"checkbox"==h(c).type?h(c).checked=f?!0:!1:$(h(c)).val(v(f,"","")):a.insertHTML(a.drawFields())}n(a.focus.tabs[a.focus.tab].fields[c].multiple_edit.disable_when_unchanged)&&
(h(c)&&(h(c).disabled=!b),$(".control_for__"+c).each(function(a,c){c.disabled=!b;"button"==c.type&&(b?$(c).removeClass("submit_disabled"):$(c).addClass("submit_disabled"))}));a.meSetCheckbox(c,b);a.validateFormatOrRedrawForField(c)};a.value=function(b,c,d,f){c||(c=a.focus.tab);b=a.focus.tabs[c].fields[b];d===l&&(d=!a.editModeOn(c));return b?f||"submit"!=b.type&&"toggle"!=b.type?d||b.current_value===l?b.value!==l?b.value:b.multiple_edit&&b.multiple_edit.original_value!==l?b.multiple_edit.original_value:
l:b.current_value:b.pressed:l};a.readField=function(b){var c=l,d=a.focus.tab,f=a.focus.tabs[d].fields[b],e;if(!f||f.snippet||"submit"==f.type||"toggle"==f.type)return l;var k=!a.editModeOn()||n(f.read_only),p=a.focus.tabs[d].fields[b]._h;f.multiple_edit&&k&&delete a.focus.tabs[d].fields[b].multiple_edit._changed;if("checkboxes"==f.type||"radios"==f.type){if(!k&&!p&&f.values){var m,p="",t=!0;for(m in f.values)g.has(f.values,m)&&h(b+"___"+m)&&h(b+"___"+m).checked&&(p+=(t?"":",")+m,t=!1);f.current_value=
p}p=!0}else if(f.pick_items||f.upload)p=!0;if(p)return k||f.current_value===l?f.value:f.current_value;if(h("_value_for__"+b))a.focus.tabs[d].fields[b].current_value=c=h("_value_for__"+b).value;else if("editor"!=f.type&&"code_editor"!=f.type||k)if(!k&&(e=h(b))){if("checkbox"==f.type||"radio"==f.type)c=e.checked?!0:!1;else if("color_picker"==f.type||"colour_picker"==f.type)try{c=$(e).spectrum("get").toHexString()}catch(E){c=$(e).val()}else c=$(e).val();a.focus.tabs[d].fields[b].current_value=c}else delete a.focus.tabs[d].fields[b].current_value,
c=f.value;else if(c=l,"editor"==f.type?D.tinyMCE&&tinyMCE.get(b)&&(c=s.tinyMCEGetContent(tinyMCE.get(b))):"code_editor"==f.type&&(e=ace.edit(b))&&(c=e.getValue()),c!==l&&!1!==c)c=a.focus.tabs[d].fields[b].current_value=c;else return f.current_value===l?f.value:f.current_value;return c};a.blankField=function(b){var c=a.focus.tab;h(b)&&$(h(b)).val("");h("_value_for__"+b)&&(h("_value_for__"+b).value="");a.focus.tabs[c].fields[b].current_value=""};a.readTab=function(){var b=a.focus.tab,c,d={};a.lastScrollTop=
$("#zenario_fbAdminInner").scrollTop();for(var f in a.focus.tabs[b].fields)g.has(a.focus.tabs[b].fields,f)&&(a.isInfoTag(f)||(c=a.readField(f))!==l&&(d[f]=c));return d};a.wipeTab=function(){var b=a.focus.tab,c;for(c in a.focus.tabs[b].fields)g.has(a.focus.tabs[b].fields,c)&&!a.isInfoTag(c)&&(delete a.focus.tabs[b].fields[c].current_value,a.focus.tabs[b].fields[c].multiple_edit&&delete a.focus.tabs[b].fields[c].multiple_edit._changed)};a.redrawTab=function(){a.focus.shake=!1;a.draw2()};a.size=function(){a.sizing&&
clearTimeout(a.sizing);h("zenario_fbMain")&&(a.focus&&n(a.focus.hide_tab_bar)?(h("zenario_fbMain").style.top="0px",h("zenario_fbButtons").style.paddingBottom="7px",h("zenario_jqmTabs").style.display="none"):(h("zenario_fbMain").style.top="24px",h("zenario_fbButtons").style.paddingBottom="31px",h("zenario_jqmTabs").style.display=g.browserIsIE()?"":"inherit"));if(h("zenario_fbAdminInner")){var b=Math.floor(0.96*$(D).height()-(g.browserIsIE()?210:g.browserIsSafari()?202:205));a.focus.max_height&&b>a.focus.max_height&&
(b=a.focus.max_height);a.focus&&n(a.focus.hide_tab_bar)&&(b=1*b+24);0<(b*=1)&&(h("zenario_fbAdminInner").style.height=b+"px")}a.isOpen&&!1!==a.documentScrollTop&&$(g.browserIsSafari()?"body":"html").scrollTop(0);a.sizing=setTimeout(a.size,250)};a.getURL=function(){++a.onKeyUpNum;return a.welcome?A+"zenario/admin/welcome_ajax.php?_json=1&_ab=1&task="+encodeURIComponent(a.task)+"&get="+encodeURIComponent(JSON.stringify(a.getRequest))+g.urlRequest(v(a.key,a.focus.key)):A+"zenario/admin/ajax.php?_json=1&_ab=1&path="+
encodeURIComponent(a.path)+g.urlRequest(a.getRequestKey)};a.editModeOn=function(b){if(!a.focus||!a.focus.tabs)return!1;b||(b=a.focus.tab);return a.focus.tabs[b].edit_mode?a.focus.tabs[b].edit_mode.on=n(a.focus.tabs[b].edit_mode.enabled)&&(n(a.focus.tabs[b].edit_mode.on)||a.editModeAlwaysOn(b)):!1};a.editModeAlwaysOn=function(b){return a.focus.tabs[b].edit_mode.always_on===l||n(a.focus.tabs[b].edit_mode.always_on)||a.savedAndContinued(b)};a.editCancelEnabled=function(b){return a.focus.tabs[b].edit_mode&&
n(a.focus.tabs[b].edit_mode.enabled)&&!a.editModeAlwaysOn(b)};a.revertEnabled=function(b){return a.focus.tabs[b].edit_mode&&n(a.focus.tabs[b].edit_mode.enabled)&&a.editModeAlwaysOn(b)&&!a.savedAndContinued(b)&&(a.focus.tabs[b].edit_mode.enable_revert===l&&a.focus.key&&a.focus.key.id||n(a.focus.tabs[b].edit_mode.enable_revert))};a.savedAndContinued=function(b){return a.focus.tabs[b]._saved_and_continued};a.editModeOnBox=function(){if(a.focus&&a.focus.tabs&&a.sortedTabs)for(var b in a.sortedTabs)if(g.has(a.sortedTabs,
b)&&a.editModeOn(a.sortedTabs[b]))return!0;return!1};a.isInfoTag=function(a){return"class_name"==a||"count"==a||"ord"==a};a.sortTabs=function(){a.sortedTabs=[];if(a.focus.tabs)for(var b in a.focus.tabs)g.has(a.focus.tabs,b)&&!a.isInfoTag(b)&&a.focus.tabs[b]&&a.sortedTabs.push([b,a.focus.tabs[b].ord]);a.sortedTabs.sort(s.sortArray);a.sortedFields={};for(b in a.sortedTabs)if(g.has(a.sortedTabs,b)){var c=a.sortedTabs[b]=a.sortedTabs[b][0];a.sortFields(c)}};a.sortFields=function(b){a.sortedFields[b]=
[];if(a.focus.tabs[b].fields)for(var c in a.focus.tabs[b].fields)g.has(a.focus.tabs[b].fields,c)&&!a.isInfoTag(c)&&a.focus.tabs[b].fields[c]&&a.sortedFields[b].push([c,a.focus.tabs[b].fields[c].ord]);a.sortedFields[b].sort(s.sortArray);for(c in a.sortedFields[b])g.has(a.sortedFields[b],c)&&(a.sortedFields[b][c]=a.sortedFields[b][c][0])};a.syncAdminBoxFromClientToServer=function(){if(a.welcome)return JSON.stringify(a.focus);var b={};a.syncAdminBoxFromClientToServerR(b,a.focus);return JSON.stringify(b)};
a.syncAdminBoxFromClientToServerR=function(b,c,d,f,e,k,h,m){if("object"==typeof c){var g,n;for(n in c)if((g="array")&&d===l&&"_sync"==n||(g="value")&&f===l&&"_sync"==d&&"session"==n||(g="value")&&f===l&&"_sync"==d&&"cache_dir"==n||(g="array")&&d===l&&"key"==n||(g="value")&&f===l&&"key"==d||(g="value")&&d===l&&"shake"==n||(g="value")&&d===l&&"download"==n||(g="array")&&d===l&&"tabs"==n||(g="array")&&f===l&&"tabs"==d||(g="array")&&e===l&&"tabs"==f&&"edit_mode"==n||(g="value")&&k===l&&"tabs"==e&&"edit_mode"==
d&&"on"==n||(g="array")&&e===l&&"tabs"==f&&"fields"==n||(g="array")&&k===l&&"tabs"==e&&"fields"==d||(g="value")&&h===l&&"tabs"==k&&"fields"==f&&"_h"==n||(g="value")&&h===l&&"tabs"==k&&"fields"==f&&"_h_js"==n||(g="value")&&h===l&&"tabs"==k&&"fields"==f&&"current_value"==n||(g="value")&&h===l&&"tabs"==k&&"fields"==f&&"_display_value"==n||(g="value")&&h===l&&"tabs"==k&&"fields"==f&&"pressed"==n||(g="array")&&h===l&&"tabs"==k&&"fields"==f&&"multiple_edit"==n||(g="value")&&m===l&&"tabs"==h&&"fields"==
e&&"multiple_edit"==d&&"_changed"==n)"value"==g?"function"!=typeof c[n]&&"object"!=typeof c[n]&&(b[n]=c[n]):"array"==g&&"object"==typeof c[n]&&(b[n]={},a.syncAdminBoxFromClientToServerR(b[n],c[n],n,d,f,e,k,h))}};a.syncAdminBoxFromServerToClient=function(b,c){for(var d in b)b[d]["[[__unset__]]"]?delete c[d]:c[d]===l||null===c[d]?c[d]=b[d]:b[d]["[[__replace__]]"]?(delete b[d]["[[__replace__]]"],c[d]=b[d]):"object"!=typeof c[d]?c[d]=b[d]:"object"==typeof c[d]&&"object"!=typeof b[d]?c[d]=b[d]:a.syncAdminBoxFromServerToClient(b[d],
c[d])};a.getValueArrayofArrays=function(b){return g.nonAsyncAJAX(a.getURL(),g.urlRequest({_read_values:!0,_box:a.syncAdminBoxFromClientToServer()}),!b)};a.refreshParentAndClose=function(b,c){s.nowDoingSomething(!1);c||(a.isOpen=!1);if(a.callBack&&!c){var d;(d=a.getValueArrayofArrays())&&a.callBack(a.focus.key,d)}else if(zenarioO.init&&(s.storekeeperWindow||s.checkIfBoxIsOpen("sk"))){d=!1;if(a.focus.key.id!==l)d=a.focus.key.id;else for(var f in a.focus.key)if(g.has(a.focus.key,f)){d=a.focus.key[f];
break}zenarioO.refreshToShowItem(d)}else a.focus.key.slotName?(g.refreshPluginSlot(a.focus.key.slotName,""),I.init&&I.init()):b||c||(a.focus.key.cID?g.goToURL(g.linkToItem(a.focus.key.cID,a.focus.key.cType)):I.init&&g.goToURL(g.linkToItem(g.cID,g.cType,"cVersion="+g.cVersion)));d=a.focus.popout_message;c||a.close();d&&s.showMessage(d,!0,!1);if(c){a.changed={};if(a.focus.tabs)for(f in a.focus.tabs)g.has(a.focus.tabs,f)&&!a.isInfoTag(f)&&a.focus.tabs[f]&&a.editModeOn(f)&&(a.focus.tabs[f]._saved_and_continued=
!0);a.sortTabs();a.draw()}};a.close=function(b){a.callFunctionOnEditors("remove");s.nowDoingSomething(!1);a.sizing&&clearTimeout(a.sizing);b||s.closeFloatingBox();s.closeBox("AdminFloatingBox"+J);a.isOpen=!1;!1!==a.documentScrollTop&&($(g.browserIsSafari()?"body":"html").scrollTop(a.documentScrollTop),a.documentScrollTop=!1);delete a.focus;return!1};a.closeButton=function(b){var c=s.onbeforeunload();(c===l||!b&&confirm(c))&&a.isOpen&&a.close();return!1};a.callFunctionOnEditors=function(b){if(a.focus&&
a.focus.tab&&a.focus.tabs[a.focus.tab]&&a.focus.tabs[a.focus.tab].fields&&D.tinyMCE)for(var c in a.focus.tabs[a.focus.tab].fields)if(g.has(a.focus.tabs[a.focus.tab].fields,c)&&"editor"==a.focus.tabs[a.focus.tab].fields[c].type&&tinyMCE.get(c))if("remove"==b)tinyMCE.get(c).remove();else if("isDirty"==b&&tinyMCE.get(c).isDirty())return!0;return!1};a.validateAlias=function(){g.actAfterDelayIfNotSuperseded("validateAlias",a.validateAliasGo)};a.validateAliasGo=function(){var b={_validate_alias:1,alias:h("alias").value};
a.focus.key.cID&&(b.cID=a.focus.key.cID);a.focus.key.cType&&(b.cType=a.focus.key.cType);a.focus.key.equivId&&(b.equivId=a.focus.key.equivId);h("language_id")&&(b.langId=h("language_id").value);h("update_translations")&&(b.lang_code_in_url="show","update_this"==h("update_translations").value&&h("lang_code_in_url")&&(b.lang_code_in_url=h("lang_code_in_url").value));$.post(A+"zenario/admin/quick_ajax.php",b,function(a){if(!(a=s.readData(a)))return!1;var b="";if(a)for(var f in a)g.has(a,f)&&(b+=(b?"<br />":
"")+a[f]);h("alias_warning_display").innerHTML=b},"text")};a.generateAlias=function(a){return a.toLowerCase().replace(/[\u00e1\u00c1\u00e0\u00c0\u00e2\u00c2\u00e5\u00c5\u00e4\u00c4\u00e3\u00c3\u00c6\u00e6\u00e7\u00c7\u00f0\u00d0\u00e9\u00c9\u00e8\u00c8\u00ea\u00ca\u00eb\u00cb\u00ed\u00cd\u00ec\u00cc\u00ee\u00ce\u00ef\u00cf\u00f1\u00d1\u00f3\u00d3\u00f2\u00d2\u00f4\u00d4\u00f6\u00d6\u00f5\u00d5\u00f8\u00d8\u0161\u0160\u00fa\u00da\u00f9\u00d9\u00fb\u00db\u00fc\u00dc\u00fd\u00dd\u017e\u017d]/g,function(a){return{"\u00e1":"a",
"\u00c1":"a","\u00e0":"a","\u00c0":"a","\u00e2":"a","\u00c2":"a","\u00e5":"a","\u00c5":"a","\u00e4":"a","\u00c4":"a","\u00e3":"a","\u00c3":"a","\u00c6":"ae","\u00e6":"ae","\u00e7":"c","\u00c7":"c","\u00f0":"d","\u00d0":"d","\u00e9":"e","\u00c9":"e","\u00e8":"e","\u00c8":"e","\u00ea":"e","\u00ca":"e","\u00eb":"e","\u00cb":"e","\u00ed":"i","\u00cd":"i","\u00ec":"i","\u00cc":"i","\u00ee":"i","\u00ce":"i","\u00ef":"i","\u00cf":"i","\u00f1":"n","\u00d1":"n","\u00f3":"o","\u00d3":"o","\u00f2":"o","\u00d2":"o",
"\u00f4":"o","\u00d4":"o","\u00f6":"o","\u00d6":"o","\u00f5":"o","\u00d5":"o","\u00f8":"o","\u00d8":"o","\u0161":"s","\u0160":"s","\u00fa":"u","\u00da":"u","\u00f9":"u","\u00d9":"u","\u00fb":"u","\u00db":"u","\u00fc":"u","\u00dc":"u","\u00fd":"y","\u00dd":"y","\u017e":"z","\u017d":"z"}[a]}).replace(/&/g,"and").replace(/[^a-z0-9\s_-]/g,"").replace(/\s+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/-+/g,"-").substr(0,50)};a.contentTitleChange=function(){h("menu_title")&&!a.focus.___menu_title_changed&&
(h("menu_title").value=h("title").value.replace(/\s+/g," "),h("menu_title").onkeyup());h("alias")&&!a.focus.___alias_changed&&(h("alias").value=a.generateAlias(h("title").value),a.validateAlias())};a.viewFrameworkSource=function(){var b=A+"zenario/admin/organizer.php#zenario__modules/show_frameworks//"+a.focus.key.moduleId+"//"+g.encodeItemIdForStorekeeper(a.readField("framework"));D.open(b);return!1};a.adminPermChange=function(b,c,d,f,e){var g=!0;f===l&&(e=0,f=$("input[name="+c+"]").each(function(a,
b){b.checked&&++e}).size());0==e?(g=!1,c="zenario_permgroup_empty"):c=e<f?"zenario_permgroup_half_full":"zenario_permgroup_full";h(b).checked=a.focus.tabs[a.focus.tab].fields[b].current_value=g;$(h("row__"+b)).removeClass("zenario_permgroup_empty").removeClass("zenario_permgroup_half_full").removeClass("zenario_permgroup_full").addClass(c);h(d).value=a.focus.tabs[a.focus.tab].fields[d].value=a.focus.tabs[a.focus.tab].fields[d].current_value=e+"/"+f};a.adminParentPermChange=function(b,c,d){var f=0,
e=0,k="",l=h(b).checked,m=$("input[name="+c+"]"),n;for(n in a.focus.tabs[a.focus.tab].fields[c].values)g.has(a.focus.tabs[a.focus.tab].fields[c].values,n)&&!a.isInfoTag(n)&&(++f,l&&(k+=(k?",":"")+n,++e));m.size()&&m.each(function(a,b){b.checked=l});a.focus.tabs[a.focus.tab].fields[c].current_value=k;a.adminPermChange(b,c,d,f,e)};a.previewDateFormat=function(b,c){g.actAfterDelayIfNotSuperseded(b,function(){a.previewDateFormatGo(b,c)})};a.previewDateFormatGo=function(a,c){(a=h(a))&&(c=h(c))&&(c.value=
g.pluginClassAJAX("zenario_common_features",{previewDateFormat:a.value}))};a.quickValidateWelcomePage=function(b){g.actAfterDelayIfNotSuperseded("quickValidateWelcomePage",a.quickValidateWelcomePageGo,b)};a.quickValidateWelcomePageGo=function(){var b={},c;for(c in a.focus.tabs[a.focus.tab].fields)g.has(a.focus.tabs[a.focus.tab].fields,c)&&(a.isInfoTag(c)||(b[c]=v(a.focus.tabs[a.focus.tab].fields[c].row_class,"","")));$.post(A+"zenario/admin/welcome_ajax.php?quickValidate=1",{tab:a.focus.tab,path:a.welcome?
"":a.path,values:JSON.stringify(a.readTab()),row_classes:JSON.stringify(b)},function(b){if(!(b=s.readData(b)))return!1;if(b&&b.row_classes)for(var c in b.row_classes)g.has(b.row_classes,c)&&a.focus.tabs[a.focus.tab].fields[c]&&h("row__"+c)&&(a.focus.tabs[a.focus.tab].fields[c].row_class=b.row_classes[c],h("row__"+c).className="zenario_ab_row zenario_ab_row__"+c+" "+b.row_classes[c]);if(b&&b.snippets)for(c in b.snippets)g.has(b.snippets,c)&&a.focus.tabs[a.focus.tab].fields[c]&&a.focus.tabs[a.focus.tab].fields[c].snippet&&
a.focus.tabs[a.focus.tab].fields[c].snippet.html&&h("snippet__"+c)&&(a.focus.tabs[a.focus.tab].fields[c].snippet.html=b.snippets[c],h("snippet__"+c).innerHTML=b.snippets[c])},"text");return!0}})(this,URLBasePath,window,document,zenario,zenarioA,zenarioTab,zenarioAT,zenario.get,zenario.engToBoolean,zenario.htmlspecialchars,zenario.ifNull,zenario.jsEscape,zenarioA.phrase)};window.zenarioAB=new zenarioNewAB("");
