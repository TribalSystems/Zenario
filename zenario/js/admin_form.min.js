zenario.lib(function(h,H,f,L,R,S,n,q,O,T,M,l,p,s,x,K,C,U,P,Q,V){f=P(Q);f.init=function(a,b){this.encapName=this.globalName=a;this.mtPrefix=b||"zenario_admin_box";this.baseCSSClass="";this.onKeyUpNum=0;this.documentScrollTop=O.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={}};f.getKey=function(a){return this.tuix.key};f.getKeyId=function(a){return this.tuix&&this.tuix.key?this.tuix.key.id:!1};f.getLastKeyId=function(a){return this.getKeyId(a)};f.openSiteSettings=function(a,
b){this.open("site_settings",{id:a},b,h,function(){M.reloadPage()})};f.enableOrDisableSite=function(){this.open("zenario_enable_site",h,h,h,function(){M.reloadPage()})};f.start=function(a,b,d,c){var g=this;this.tabHidden=!0;this.differentTab=!1;this.path=x(a,"");this.focus=this.tuix={};this.key=x(b,{});this.tab=d;this.shownTab=!1;this.url=this.getURL();this.retryAJAX(this.url,{_fill:!0,_values:c?JSON.stringify(c):""},function(a){g.load(a)?(g.tab&&(g.tuix.tab=g.tab),delete g.key,delete g.tab,g.sortTabs(),
g.initFields(),g.draw()):g.close(!0)},"loading")};f.load=function(a){this.loaded=!0;if(!(a=q.readData(a)))return!1;a.toast&&q.toast(a.toast);this.callFunctionOnEditors("isDirty")&&this.markAsChanged();this.callFunctionOnEditors("remove");this.setData(a);return!this.tuix||!this.tuix.tabs&&this.tuix.go_to_url===h?(q.showMessage(C.couldNotOpenBox,!0,"error"),!1):!0};f.setData=function(a){this.tuix=a};f.initFields=function(){var a,b,d;if(this.tuix.tabs)for(a in this.tuix.tabs)if(n.has(this.tuix.tabs,
a)&&this.tuix.tabs[a]&&this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)n.has(this.tuix.tabs[a].fields,b)&&(d=this.tuix.tabs[a].fields[b])&&(d.pick_items&&d.plugin_setting&&d.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(b,this.value(b,a,!1)):d.values&&_.isString(d.values)&&this.tuix.lovs[d.values]?d.values=this.tuix.lovs[d.values]:d.load_values_from_organizer_path&&!d.values&&this.loadValuesFromOrganizerPath(d))};f.loadValuesFromOrganizerPath=function(a){var b,d;if(a.load_values_from_organizer_path&&
!a.values&&(a.values={},(d=q.getSKItem(a.load_values_from_organizer_path))&&d.items))for(b in d.items)n.has(d.items,b)&&(a.values[n.decodeItemIdForStorekeeper(b)]=q.formatSKItemName(d,b))};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};
f.editCancelOrRevert=function(a,b){if(this.tuix.tabs[b].edit_mode){var d,c,g;"edit"==a?(c=p(this.tuix.tabs[b].edit_mode.format_on_edit),g=p(this.tuix.tabs[b].edit_mode.validate_on_edit)):"cancel"==a?(c=p(this.tuix.tabs[b].edit_mode.format_on_cancel_edit),g=p(this.tuix.tabs[b].edit_mode.validate_on_cancel_edit)):"revert"==a&&(c=p(this.tuix.tabs[b].edit_mode.format_on_revert),g=this.errorOnTab(b)||p(this.tuix.tabs[b].edit_mode.validate_on_revert));if(this.tuix.tabs[b].fields&&!g)for(var e in this.tuix.tabs[b].fields)if(n.has(this.tuix.tabs[b].fields,
e))if(p(this.tuix.tabs[b].fields[e].validate_onchange)&&(d=this.readField(e))!==h&&d!=this.tuix.tabs[b].fields[e].value){g=!0;break}else!c&&p(this.tuix.tabs[b].fields[e].format_onchange)&&(d=this.readField(e))!==h&&d!=this.tuix.tabs[b].fields[e].value&&(c=!0);this.tuix.tabs[b].edit_mode.on="cancel"!=a;this.changed[b]=!1;g?this.validate(h,h,!0):c?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==b&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&
this.validate(a!=this.tuix.tab,a)};f.clickButton=function(a,b){"submit"==this.tuix.tabs[this.tuix.tab].fields[b].type?(this.tuix.tabs[this.tuix.tab].fields[b].pressed=!0,this.validate(!0)):"toggle"==this.tuix.tabs[this.tuix.tab].fields[b].type&&((this.tuix.tabs[this.tuix.tab].fields[b].pressed=!p(this.tuix.tabs[this.tuix.tab].fields[b].pressed))?$("#"+b).removeClass("not_pressed").addClass("pressed"):$("#"+b).removeClass("pressed").addClass("not_pressed"),this.validateFormatOrRedrawForField(this.tuix.tabs[this.tuix.tab].fields[b]))};
f.togglePressed=function(a,b){var d;d=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;d===h&&(d=!0);b&&"toggle"==b.type&&(this.toggleLevelsPressed.last=d&&p(b.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));return d};f.toggleLevel=function(a){return this.toggleLevelsPressed.last};f.format=function(a){var b;if(this.loaded&&(b=this.getURL())){var d=this;this.loaded=!1;this.hideTab();this.checkValues(a);this.retryAJAX(b,{_format:!0,_box:this.sendStateToServer()},
function(a){d.load(a);d.sortTabs();d.draw()},"loading")}};f.validate=function(a,b,d,c){var g;if(this.loaded&&(g=this.getURL())){this.differentTab=a;this.loaded=!1;this.hideTab(a);this.checkValues(d);var e=this;this.retryAJAX(g,{_validate:!0,_box:this.sendStateToServer()},function(a){e.load(a)&&!e.errorOnTab(e.tuix.tab)&&b!==h&&(e.tuix.tab=b);e.sortTabs();e.switchToATabWithErrors();e.draw();c&&c()},"loading")}};f.retryAJAX=function(a,b,d,c){var g=function(){$.ajax({type:"POST",url:a,data:b,dataType:"text"}).done(d).zenario_retry=
g;c&&q.nowDoingSomething(c)};g()};f.switchToATabWithErrors=function(){if(this.tuix&&this.tuix.tabs&&!this.errorOnTab(this.tuix.tab))for(var a in this.sortedTabs)if(n.has(this.sortedTabs,a)){var b=this.sortedTabs[a];if(this.tuix.tabs[b]&&!q.hidden(this.tuix.tabs[b])&&this.errorOnTab(b))return this.tuix.tab=b,!0}return!1};f.save=function(a,b){var d;if(this.loaded&&(d=this.getURL())){var c=this;if(!this.saving){this.differentTab=this.saving=!0;this.loaded=!1;this.hideTab(!0);this.checkValues();var g=
{_save:!0,_confirm:a?1:"",_save_and_continue:b,_box:this.sendStateToServer()};p(this.tuix.download)||this.tuix.confirm&&p(this.tuix.confirm.download)?this.save2(n.nonAsyncAJAX(this.getURL(),n.urlRequest(g)),b):this.retryAJAX(d,g,function(a){c.save2(a,b)},"saving")}}};f.save2=function(a,b){delete this.saving;"\x3c!--Valid--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),"\x3c!--Confirm--\x3e"==(""+a).substr(0,14)?(a=a.substr(14),this.load(a),this.sortTabs(),this.draw(),this.showConfirm(b)):"\x3c!--Download--\x3e"==
(""+a).substr(0,15)?(l("zenario_iframe_form").action=this.getURL(),l("zenario_iframe_form").innerHTML='<input type="hidden" name="_download" value="1"/><input type="hidden" name="_box" value="'+s(this.sendStateToServer())+'"/>',l("zenario_iframe_form").submit(),b&&(a=a.substr(15),this.load(a)),this.refreshParentAndClose(!0,b)):"\x3c!--Saved--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),this.load(a),this.refreshParentAndClose(!1,b)):(this.close(),q.showMessage(a,!0,"error"))):(this.load(a),this.sortTabs(),
this.switchToATabWithErrors(),this.draw())};f.showConfirm=function(a){if(this.tuix&&this.tuix.confirm&&p(this.tuix.confirm.show)){var b=this.tuix.confirm.message;p(this.tuix.confirm.html)||(b=s(b,!0));a='<input type="button" class="submit_selected" value="'+this.tuix.confirm.button_message+'" onclick="'+this.globalName+".save(true, "+p(a)+');"/><input type="button" class="submit" value="'+this.tuix.confirm.cancel_button_message+'" onclick="zenarioA.closeFloatingBox();"/>';q.floatingBox(b,a,x(this.tuix.confirm.message_type,
"none"))}};f.hideTab=function(a){var b=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){b.tabHidden=!0;b.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),this.tabHidden=!0,this.draw())};f.draw=function(){this.loaded&&this.tabHidden&&this.draw2()};f.draw2=
function(){return this.drawFields(cb)};f.animateInTab=function(a,b,d){var c=this,g=this.tuix.shake===h?this.differentTab&&this.errorOnTab(this.tuix.tab):p(this.tuix.shake);if(this.shownTab==this.tuix.tab){if(g&&!d.find("iframe").length)d.effect({effect:"bounce",duration:125,direction:"right",times:2,distance:5,mode:"effect",complete:function(){c.insertHTML(a,b);$("#zenario_abtab").clearQueue().show().animate({opacity:1},75,function(){n.browserIsIE()&&c.style.removeAttribute("filter");c.addJQueryElementsToTabAndFocusFirstField()});
c.hideShowFields()}});else{this.insertHTML(a,b);var e=this.lastScrollTop;$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){n.browserIsIE()&&c.style.removeAttribute("filter");g||e===h?c.addJQueryElementsToTabAndFocusFirstField():c.addJQueryElementsToTab()});$("#zenario_fbAdminInner").scrollTop(e);this.hideShowFields()}delete this.tuix.shake}else this.insertHTML(a,b),$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){n.browserIsIE()&&c.style.removeAttribute("filter");
c.addJQueryElementsToTabAndFocusFirstField()})};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var b=[],d;for(d in this.sortedTabs)if(n.has(this.sortedTabs,d)){var c=this.sortedTabs[d];this.tuix.tabs[c]&&!q.hidden(this.tuix.tabs[c])&&(this.tuix.tab||(this.tuix.tab=c),b.push({tabId:c,current:this.tuix.tab==c,label:this.tuix.tabs[c].label}))}return q.microTemplate(a,b)};f.drawFields=function(a){q.clearHTML5UploadFromDragDrop();var b=this.tuix.tab,d="",c="";!this.savedAndContinued(b)&&this.editCancelEnabled(b)&&
(c='<div class="zenario_editCancelButton"><input class="submit" type="button" onclick="'+this.globalName+'.changeMode(); return false;" value="'+(this.editModeOn()?C.cancel:C.edit)+'"></div>');var g=x(this.tuix.tabs[b].template,this.mtPrefix+"_current_tab"),e=!1,k,m,c={fields:{},rows:[],tabId:b,path:this.path,revert:c,errors:[],notices:{}};if(this.editModeOn()){if(this.tuix.tabs[b].errors)for(k in this.tuix.tabs[b].errors)n.has(this.tuix.tabs[b].errors,k)&&(m=this.tuix.tabs[b].errors[k],c.errors.push({message:m}));
if(this.tuix.tabs[b].fields)for(k in this.tuix.tabs[b].fields)n.has(this.tuix.tabs[b].fields,k)&&(m=this.tuix.tabs[b].fields[k],m.error&&c.errors.push({message:m.error}))}if(this.tuix.tabs[b].notices)for(k in this.tuix.tabs[b].notices)n.has(this.tuix.tabs[b].notices,k)&&(m=this.tuix.tabs[b].notices[k],p(m.show)&&{error:1,warning:1,question:1,success:1}[m.type]&&(c.notices[k]=m));for(var h in this.sortedFields[b])n.has(this.sortedFields[b],h)&&(k=this.sortedFields[b][h],m=this.tuix.tabs[b].fields[k],
m._id=k,m._html=this.drawField(a,b,k,!0),!1!==m._html&&(!m._startNewRow&&c.rows.length||c.rows.push({fields:[]}),e||this.tuix.tabs[b].show_errors_after_field!=k||(c.rows[c.rows.length-1].errors=c.errors,c.rows[c.rows.length-1].notices=c.notices,e=!0),c.rows[c.rows.length-1].fields.push(m),c.fields[k]=m));e||c.rows.splice(0,0,{errors:c.errors,notices:c.notices});d+=q.microTemplate(g,c);for(h in this.sortedFields[b])n.has(this.sortedFields[b],h)&&(k=this.sortedFields[b][h],delete this.tuix.tabs[b].fields[k]._startNewRow,
delete this.tuix.tabs[b].fields[k]._hideOnOpen,delete this.tuix.tabs[b].fields[k]._showOnOpen,delete this.tuix.tabs[b].fields[k]._html,delete this.tuix.tabs[b].fields[k]._id);return d};f.insertHTML=function(a,b){var d=l("zenario_abtab");d.innerHTML=a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(d).addClass("zenario_abtab_changed"):$(d).removeClass("zenario_abtab_changed");b.call()};f.hideShowFields=function(a){var b=$(".zenario_hide_on_open"),d=$(".zenario_hide_row_on_open"),c=$(".zenario_show_on_open"),
g=function(a,b){b.style.display="none"};c.length&&!b.length?c.show("blind",200,a):!c.length&&b.length?b.hide("blind",200,function(){d.each(g)}):c.length&&b.length&&(b.each(g),d.each(g),c.show())};f.addJQueryElementsToTab=function(){n.addJQueryElements("#zenario_abtab ",!0)};f.addJQueryElementsToTabAndFocusFirstField=function(){n.addJQueryElements("#zenario_abtab ",!0);this.focusFirstField()};f.focusFirstField=function(){if(this.tuix&&!p(this.tuix.tabs[this.tuix.tab].disable_autofocus)){var a=-1,b=
[],d=h,c;for(c in this.sortedFields[this.tuix.tab])if(n.has(this.sortedFields[this.tuix.tab],c)){var g=this.sortedFields[this.tuix.tab][c],e=this.tuix.tabs[this.tuix.tab].fields[g];if(l(g)&&$(l(g)).is(":visible")&&(b[++a]={id:g,type:e.type,empty:""==l(g).value,focusable:e.type&&{password:1,checkbox:1,select:1,text:1,textarea:1}[e.type]&&!p(l(g).disabled)&&!p(l(g).readonly)},1<a))break}if(b[0]&&!b[0].empty&&b[1]&&b[1].focusable&&b[1].empty&&"password"==b[1].type)d=1;else if(b[0]&&b[0].focusable)d=
0;else if(b[1]&&b[1].focusable)d=1;else return;setTimeout(function(){l(b[d].id).focus()},50)}};f.focusField=function(){this.fieldToFocus&&l(this.fieldToFocus)&&$(l(this.fieldToFocus)).is(":visible")&&l(this.fieldToFocus).focus();delete this.fieldToFocus};f.setTitle=function(a,b){a?($("#zenario_fbAdminFloatingBox .zenario_jqmTitle").css("display","block"),$("#zenario_fbAdminFloatingBox .zenario_jqmTitle").addClass(" zenario_no_drag"),b||(a=s(a)),l("zenario_jqmTitle").innerHTML=a,q.setTooltipIfTooLarge("#zenario_jqmTitle",
a,q.tooltipLengthThresholds.adminBoxTitle)):$("#zenario_fbAdminFloatingBox .zenario_jqmTitle").css("display","none")};f.showCloseButton=function(){this.tuix.cancel_button_message?$("#zenario_fbAdminFloatingBox .zenario_jqmClose").css("display","none"):$("#zenario_fbAdminFloatingBox .zenario_jqmClose").css("display","block")};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(n.has(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var b;
if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(b in this.tuix.tabs[a].errors)if(n.has(this.tuix.tabs[a].errors,b))return!0;if(this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)if(n.has(this.tuix.tabs[a].fields,b)&&this.tuix.tabs[a].fields[b].error)return!0}};f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var b in this.tuix.tabs)if(n.has(this.tuix.tabs,b)){a=this.tuix.tabs[b];var d=this.editModeOn(b);if(a.fields)for(var c in a.fields)if(n.has(a.fields,
c)){var g=a.fields[c];g.snippet||"submit"==g.type||"toggle"==g.type||(g.current_value===h&&(g.current_value=this.value(c,b,!0)),d&&(g.value===h&&(g.value=this.value(c,b,!1)),g.multiple_edit&&g.multiple_edit._changed===h&&g.multiple_edit.changed!==h&&(g.multiple_edit._changed=g.multiple_edit.changed)))}}};f.drawField=function(a,b,d,c,g,e,k,m,f,A,G,z){var B=this,I={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,
onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0};c="";var y,t,u,v=!1,r={"class":""},E={},F=!0,D=!1;e===h&&(e=this.tuix.tabs[b].fields[d]);m===h&&(m=!this.editModeOn()||p(e.read_only));e.type&&"datetime"==e.type&&(m=!0);g===h&&(e.values&&_.isString(e.values)&&this.tuix.lovs[e.values]?
e.values=this.tuix.lovs[e.values]:e.load_values_from_organizer_path&&!e.values&&this.loadValuesFromOrganizerPath(e));if(!(A&&G||"object"!=typeof e.values)){A=[];G={};for(t in e.values)n.has(e.values,t)&&(u=e.values[t],"object"==typeof u?(u.parent!==h&&(D=!0,G[u.parent]=!0),q.hidden(u)||(u.ord!==h?A.push([t,u.ord]):u.label!==h?A.push([t,u.label]):A.push([t,t]))):A.push([t,u]));A.sort(q.sortArray);for(y in A)n.has(A,y)&&(A[y]=A[y][0])}if(g===h){e._startNewRow=!p(e.same_row);if(e._startNewRow&&!1!==
this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=e.type&&"code_editor"!=e.type&&this.tuix.tabs[b].fields[d]._was_hidden_before&&!q.hidden(e))e._showOnOpen=!0,delete this.tuix.tabs[b].fields[d]._was_hidden_before;else if(e._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=e.type&&"code_editor"!=e.type&&!this.tuix.tabs[b].fields[d]._was_hidden_before&&q.hidden(e))e._hideOnOpen=!0,this.tuix.tabs[b].fields[d]._was_hidden_before=!0;else{if(q.hidden(e))return this.tuix.tabs[b].fields[d]._was_hidden_before=
!0,!1;delete this.tuix.tabs[b].fields[d]._was_hidden_before}t="";u=!1;e.multiple_edit&&(u=m||e.multiple_edit._changed===h?e.multiple_edit.changed:p(e.multiple_edit._changed),p(e.multiple_edit.disable_when_unchanged)&&!u&&(f=!0),p(e.multiple_edit.hide_ui)||!e.multiple_edit.select_list?(t+='<input type="checkbox" class="multiple_edit" id="multiple_edit__'+s(d)+'"'+(u?' checked="checked"':""),t=p(e.multiple_edit.hide_ui)?t+' style="display: none;"':m?t+' disabled="disabled"':t+(' onchange="'+this.globalName+
".meChange(this.checked, '"+s(d)+"');\""),t+="/> "):(t+='<select class="multiple_edit" id="multiple_edit__'+s(d)+'"',t=m?t+' disabled="disabled"':t+(' onchange="'+this.globalName+".meChange(this.value == 1, '"+s(d)+"');\""),t+='><option value=""'+(u?"":' selected="selected"')+">"+x(e.multiple_edit.select_list.not_changed_label,C.notChanged)+'</option><option value="1"'+(u?' selected="selected"':"")+">"+x(e.multiple_edit.select_list.changed_label,C.changed)+"</option></select> "));c+=t;t=h;e.pre_field_html!==
h&&(c+=e.pre_field_html)}e.snippet||k!==h||(k=this.value(d,b,h,!0));k===h&&(k="");if(m||f)r.disabled="disabled";if(e.snippet)e.snippet.html?c+='<span id="snippet__'+s(d)+'">'+e.snippet.html+"</span>":e.snippet.url?c=p(e.snippet.cache)?this.cachedAJAXSnippets[e.snippet.url]?c+this.cachedAJAXSnippets[e.snippet.url]:c+(this.cachedAJAXSnippets[e.snippet.url]=n.nonAsyncAJAX(n.addBasePath(e.snippet.url))):c+n.nonAsyncAJAX(n.addBasePath(e.snippet.url)):e.snippet.separator&&(c+='<hr class="input_separator"',
e.snippet.separator.style&&(c+=' style="'+s(e.snippet.separator.style)+'"'),c+="/>");else if(("checkboxes"==e.type||"radios"==e.type)&&g===h)e.values&&(z=this.pickedItemsArray(e,k),y=_.extend({},e),y.name=x(e.name,d),y.type="checkboxes"==e.type?"checkbox":"radio",m&&(y.disabled=!0),c+=this.hierarchicalBoxes(a,b,d,k,e,y,z,f,A,G));else if(e.upload||e.pick_items)k={id:d,wrappedId:"name_for_"+d,readOnly:m,tempReadOnly:f},m?k.pickedItems=this.drawPickedItems(d,!0):(k.pickedItems=this.drawPickedItems(d,
!1,f),e.pick_items&&e.pick_items.path&&e.pick_items.min_path&&e.pick_items.target_path&&!p(e.pick_items.hide_select_button)&&(k.select={onclick:this.globalName+".pickItems('"+s(d)+"');",phrase:e.pick_items.select_phrase||C.selectDotDotDot}),e.upload&&(k.upload={onclick:this.globalName+".upload('"+s(d)+"');",phrase:e.upload.upload_phrase||C.uploadDotDotDot},p(e.upload.drag_and_drop)&&this.upload(d,!0),L.Dropbox&&Dropbox.isBrowserSupported()&&(k.dropbox={onclick:this.globalName+".chooseFromDropbox('"+
s(d)+"');",phrase:e.upload.dropbox_phrase||C.dropboxDotDotDot}))),c+=q.microTemplate(this.mtPrefix+"_picked_items",k);else if(e.type){r.onchange=g?this.globalName+".fieldChange('"+s(d)+"', '"+s(g)+"');":this.globalName+".fieldChange('"+s(d)+"');";e.disabled&&(r["class"]+="disabled ");e.return_key_presses_button&&!m&&(r.onkeyup=x(r.onkeyup,"","")+"if (event.keyCode == 13) {$('#"+s(e.return_key_presses_button)+"').click();}");p(e.multiple_edit)&&!m&&(r.onkeyup=x(r.onkeyup,"","")+"if (event && event.keyCode == 9) return true; "+
this.globalName+".meMarkChanged('"+s(d)+"', this.value, '"+s(e.value)+"');");r["class"]+="input_"+e.type;if("select"==e.type)e.slider&&(v=!0,c+=this.drawSlider(a,d,e,m,!0)),c+="<select";else if("textarea"==e.type)c+="<textarea";else if("code_editor"==e.type)c+="<div",r["class"]=" zenario_embedded_ace_editor",a.after(function(){var a=ace.edit(d);a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);m&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));a.session.setOption("useWorker",!1);if(language=e.language)try{language=
language.match(/\.twig\.html$/i)?"ace/mode/twig":language.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(language).mode:"ace/mode/"+language,a.session.setMode(language)}catch(b){console.log("Ace editor could not load that language",language)}});else if("color_picker"==e.type||"colour_picker"==e.type)c+="<input",r["class"]=" zenario_color_picker",a.after(function(){var a=e.color_picker_options||e.colour_picker_options||{};a.disabled=m;a.preferredFormat=a.preferredFormat||"hex";$(l(d)).spectrum(a)});
else if("editor"==e.type){c+="<textarea";q.getSkinDesc();var J;f={script_url:H+q.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:h,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,autoresize_max_height:Math.max(Math.floor(0.5*$(L).height()),300),onchange_callback:function(a){B.fieldChange(a.id)},init_instance_callback:function(a){q.enableDragDropUploadInTinyMCE(!1,h,l("row__"+x(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=
$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&q.enableDragDropUploadInTinyMCE(!1,h,b)}};b=_.extend({},f,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],image_advtab:!0,visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:q.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,content_css:h,toolbar:"undo redo | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",
style_formats:q.skinDesc.style_formats,oninit:h});t=_.extend({},b,{toolbar:"undo redo | image link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",file_browser_callback:q.fileBrowser,init_instance_callback:function(a){q.enableDragDropUploadInTinyMCE(!0,H,l("row__"+x(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&q.enableDragDropUploadInTinyMCE(!0,H,b)}});u=_.extend({},
t,{toolbar:"undo redo | image | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});var K=_.extend({},u,{toolbar:"undo redo | link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});m?(J=f,r["class"]=" tinymce_readonly"):e.insert_image_button?e.insert_link_button?(J=t,r["class"]=" tinymce_with_images_and_links"):(J=u,r["class"]=" tinymce_with_images"):e.insert_link_button?(J=K,r["class"]=
" tinymce_with_links"):(J=b,r["class"]=" tinymce");r.style="visibility: hidden;";_.isObject(e.editor_options)&&(J=_.extend(J,e.editor_options));a.after(function(){var a=$(l(d)),b=l("zenario_abtab"),c=b.style.display;b.style.display="block";a.tinymce(J);b.style.display=c})}else if("submit"==e.type||"toggle"==e.type){c+="<input";r.type="button";if(!m||p(e.can_be_pressed_in_view_mode))E.onclick=this.globalName+".clickButton(this, '"+d+"');",delete r.disabled;"submit"==e.type&&(this.tuix.tabs[b].fields[d].pressed=
!1);"toggle"==e.type&&(r["class"]+=this.tuix.tabs[b].fields[d].pressed?" pressed":" not_pressed")}else"date"==e.type||"datetime"==e.type?(c+="<input",r.type="text",r["class"]+=" zenario_datepicker",p(e.change_month_and_year)&&(r["class"]+=" zenario_datepicker_change_month_and_year"),r.readonly="readonly",m||(r.onkeyup=x(r.onkeyup,"","")+"zenario.dateFieldKeyUp(this, event, '"+s(d)+"');")):"url"==e.type?(c+="<input",r.type="url",r.onfocus=x(r.onfocus,"","")+"if(!this.value) this.value = 'http://';",
r.onblur=x(r.onblur,"","")+"if(this.value == 'http://') this.value = '';"):(e.slider&&(v=!0,c+=this.drawSlider(a,d,e,m,!0)),c+="<input",r.type=e.type,F=!0);if("checkbox"==e.type||"radio"==e.type)p(k)&&(r.checked="checked"),k=h,p(e.indeterminate)&&a.after(function(){var a;if(a=l(d))a.indeterminate=!0});v&&(r.onchange=x(r.onchange,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());",r.onkeyup=x(r.onkeyup,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());");f=
e;g===h?f.id=d:(f=$.extend({},f,z),f.id=d+"___"+g,r["class"]+=" control_for__"+d);"radio"==f.type&&f.name||(f.name=d);for(var w in f)if(n.has(f,w)&&I[w])if("disabled"==w||"readonly"==w){if(p(r[w])||p(f[w]))c+=" "+w+'="'+w+'"'}else c+=" "+w+'="',r[w]&&(c+=r[w]+" ",delete r[w]),c+=s(f[w]),E[w]&&(c+=" "+E[w],delete E[w]),c+='"';for(w in r)n.has(r,w)&&(c+=" "+w+'="'+s(r[w]),E[w]&&(c+=" "+E[w],delete E[w]),c+='"');for(w in E)n.has(E,w)&&(c+=" "+w+'="'+s(E[w])+'"');"select"==e.type?c+=">":"textarea"==e.type||
"editor"==e.type?c+=">"+s(k,!1,"asis")+"</textarea>":"code_editor"==e.type?c+=">"+s(k,!1,"asis")+"</div>":"date"==e.type||"datetime"==e.type?(c+=' value="'+s(n.formatDate(k,"datetime"==e.type))+'"/>',c+='<input type="hidden" id="_value_for__'+s(d)+'" value="'+s(k)+'"/>',m||(c+='<input type="button" class="zenario_remove_date" value="x" onclick="'+this.globalName+".blankField('"+s(d)+"'); $(zenario.get('"+s(d)+"')).change();\"/>")):c=k!==h?c+(' value="'+s(k,!1,"asis")+'"/>'):c+"/>";if("select"==e.type)e.empty_value&&
(c+='<option value="">'+s(e.empty_value)+"</option>"),e.values&&(c+=this.hierarchicalSelect(k,e,A,D,G)),c+="</select>";else if(F&&e.values&&!m){var M=[];for(y in A)n.has(A,y)&&(t=A[y],M.push({label:e.values[t],value:t}));a.after(function(){var a=$(l(d)),b={source:M,minLength:0,appendTo:a.parent()};e.return_key_presses_button&&(b.select=function(){setTimeout(function(){$("#"+e.return_key_presses_button).click()},0)});a.autocomplete(b);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search",
"")})})}}g===h&&("url"!=e.type||m||(c+='&nbsp; <input type="button" class="submit" value="Test" onclick="if (get(\''+s(d)+"').value) window.open(zenario.addBasePath(get('"+s(d)+"').value));\"/>"),e.post_field_label!==h&&(c+='<label for="'+s(d)+'" id="label_for__'+s(d)+'"> '+s(e.post_field_label)+"</label>"),e.post_field_html!==h&&(c+=e.post_field_html),v&&(c+=this.drawSlider(a,d,e,m,!1)));return c};f.hierarchicalSelect=function(a,b,d,c,g,e){var k="",m,f,l,q,z;for(q in d)n.has(d,q)&&(z=d[q],l=b.values[z],
f=m="",_.isString(l)?l={label:l}:p(l.disabled)&&(m=' disabled="disabled"'),z==a&&(f=' selected="selected"'),e===h&&c&&g[z]?k+='<optgroup label="'+s(l,!1,!0)+'"'+m+">"+this.hierarchicalSelect(a,b,d,c,g,z)+"</optgroup>":e===l.parent&&(k+='<option value="'+s(z)+'"'+f+m+">"+s(l,!1,!0)+"</option>"));return k};f.chooseFromDropbox=function(a){var b=this,d;if(!this.tuix.tabs[this.tuix.tab]||!(d=this.tuix.tabs[this.tuix.tab].fields[a])||!d.upload)return!1;d={cancel:function(){q.hideAJAXLoader()},linkType:"direct",
multiselect:!!p(d.upload.multi),extensions:d.upload.extensions?_.toArray(d.upload.extensions):h,success:function(c){q.showAJAXLoader();var d,e,k=new n.callback;for(d in c)n.has(c,d)&&(e=c[d],k.add(n.ajax("zenario/ajax.php?method_call=handleAdminBoxAJAX&fetchFromDropbox=1",e,!0)));k.after(function(){var c,d,e,g,k;if(!b.tuix.tabs[b.tuix.tab]||!(e=b.tuix.tabs[b.tuix.tab].fields[a])||!e.upload)return!1;g=e.current_value===h?e.value:e.current_value;k=p(e.upload.multi);for(c in arguments)n.has(arguments,
c)&&(d=arguments[c])&&d.id&&(g=k&&g?g+(","+d.id):d.id);q.hideAJAXLoader();b.redrawPickedItems(a,e,g)})}};q.showAJAXLoader();Dropbox.choose(d)};f.upload=function(a,b){var d=this,c;if(!this.tuix.tabs[this.tuix.tab]||!(c=this.tuix.tabs[this.tuix.tab].fields[a])||!c.upload)return!1;c={class_name:c.class_name,upload:c.upload};this.uploadCallback=function(b){if(b){var c,k,m,f,l;if(!d.tuix.tabs[d.tuix.tab]||!(m=d.tuix.tabs[d.tuix.tab].fields[a])||!m.upload)return!1;f=m.current_value===h?m.value:m.current_value;
l=p(m.upload.multi);for(c in b)n.has(b,c)&&(k=b[c])&&k.id&&(f=l&&f?f+(","+k.id):k.id);d.redrawPickedItems(a,m,f)}};b?q.setHTML5UploadFromDragDrop(H+"zenario/ajax.php?method_call=handleAdminBoxAJAX",{fileUpload:1},!1,this.uploadCallback,l("zenario_fbAdminInner")):q.action(this,c,h,h,h,{fileUpload:1})};f.uploadComplete=function(a){this.uploadCallback!==h&&this.uploadCallback(a);delete this.uploadCallback};f.drawSlider=function(a,b,d,c,g){var e=this,k=_.clone(d.slider);d="";if(p(k.before_field)?g:!g)c&&
(d+='<div class="ui-disabled">'),d+='<div id="zenario_slider_for__'+s(b)+'" class="'+s(k["class"])+'" style="'+s(k.style)+'"></div>',c&&(d+="</div>"),a.after(function(){var a;if(a=l("zenario_slider_for__"+b))k.min!==h&&(k.min*=1),k.max!==h&&(k.max*=1),k.step!==h&&(k.step*=1),k.disabled=!e.editModeOn(),k.value=$(l(b)).val(),k.slide=function(a,c){$(l(b)).val(c.value)},k.change=function(a,b){e&&e.id&&e.fieldChange(e.id.replace("zenario_slider_for__",""))},$(a).slider(k)});return d};f.pickedItemsArray=
function(a,b){if(!1===b||null===b||b===h||!(0!==b&&"0"!==b||a.values&&(a.values[0]||a.values["0"])))return{};var d=(b+"").split(","),c={},g,e,k,f;a._display_value=!1;for(k in d)n.has(d,k)&&(f=d[k])&&(a.upload&&(e=n.decodeItemIdForStorekeeper(f))&&(e=e.split("/"))&&e[1]?(c[f]=e[1],p(e[2])&&p(e[3])&&(c[f]+=" ["+e[2]+" \u00d7 "+e[3]+"px]")):a.values&&a.values[f]&&"string"==typeof a.values[f]?c[f]=a.values[f]:a.values&&a.values[f]&&a.values[f].label?c[f]=a.values[f].label:a.pick_items&&(a.pick_items.target_path&&
(g=q.getSKItem(a.pick_items.target_path,f))||a.pick_items.path&&a.pick_items.path!=a.pick_items.target_path&&-1==a.pick_items.path.indexOf("//")&&(g=q.getSKItem(a.pick_items.path,f)))?(a.values||(a.values={}),a.values[f]=c[f]=q.formatSKItemName(g,f)):a.upload&&f==1*f&&(e=q.lookupFileDetails(f))?(a.values||(a.values={}),c[f]=e.filename,p(e.width)&&p(e.height)&&(c[f]+=" ["+e.width+" \u00d7 "+e.height+"px]"),a.values[f]=c[f]):c[f]=f,!1===a._display_value&&(a._display_value=c[f]));return c};f.pickedItemsValue=
function(a){var b,d="";if(a)for(b in a)n.has(a,b)&&(d+=(""===d?"":",")+b);return d};f.hierarchicalBoxes=function(a,b,d,c,g,e,f,m,N,A,x,z,B){var C=1;if(!B)B=0,C=1*g.cols||1;else if(10<B)return"";z||(z={});x&&(z[x]=!0);var y=0,t="",u,v,r;B&&(t+='<div class="zenario_hierarchical_box_children" id="'+s("children_for___"+d+"___"+x)+'">');for(var E in N)if(n.has(N,E)){u={};v=N[E];v==1*v&&(v*=1);var F=h;r="object"==typeof g.values[v]?g.values[v]:{label:g.values[v]};g.tag_colors&&(u.tag_color=g.tag_colors[v]||
"blue");F=r.parent;"0"===F&&(F=!1);if(!x&&!F||x==F){if(u.newRow=++y>C)y=1;u.col=y;u.cols=C;F=c?!0===c||1===c||"1"===c?!0===v||1===v||"1"===v:f?f[v]!==h?!0:!1:v==c:!v;if("checkboxes"==g.type&&p(g.checking_child_checks_parents)){var D="";x&&(D+="if (this.checked) { for (var cb in "+JSON.stringify(z)+") { get('"+s(d)+"___' + cb).checked = true; } } ");A[v]&&(D+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");D?e.onchange=g.onchange?D+" "+g.onchange:D:g.onchange?
e.onchange=g.onchange:delete e.onchange}else"checkboxes"==g.type&&p(g.checking_parent_checks_children)&&(D="",A[v]&&(D+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),D?e.onchange=g.onchange?D+" "+g.onchange:D:g.onchange?e.onchange=g.onchange:delete e.onchange);u.lovId=d+"___"+v;u.lovField=r;g.indeterminates&&p(g.indeterminates[v])&&function(b){a.after(function(){var a;if(a=l(b))a.indeterminate=!0})}(u.lovId);u.lovHTML=this.drawField(a,
b,d,!0,v,e,F,!1,m,N,A,r);u.childrenHTML="";A[v]&&(u.childrenHTML=this.hierarchicalBoxes(a,b,d,c,g,e,f,m,N,A,v,_.extend({},z),B+1),y=0);t+=q.microTemplate("zenario_admin_box_radio_or_checkbox",u)}}B&&(t+="</div>");return t};f.drawPickedItems=function(a,b,d,c){c===h&&(c=this.tuix.tab);var g=this.tuix.tabs[c].fields[a],e=!1,f,m=this.value(a,c,b),l=this.pickedItemsArray(g,m);c=g.upload&&p(g.upload.reorder_items);var s=1*g.cols||1,G=0;for(f in l)if(n.has(l,f)){e=!0;break}if(e){var e=[],z=[];if(c)for(f in m=
m.split(","),m)n.has(m,f)&&z.push([m[f],l[m[f]]]);else{for(f in l)n.has(l,f)&&z.push([f,l[f]]);z.sort(q.sortArray)}for(f=0;f<z.length;++f){var l=z[f][0],B=z[f][1],I=l==1*l,y,t,m={id:a,item:l,label:B,first:0==f,last:f==z.length-1,readOnly:b,tempReadOnly:d};if(m.newRow=++G>s)G=1;m.col=G;m.cols=s;g.tag_colors&&(m.tag_color=g.tag_colors[l]||"blue");!g.pick_items||g.upload&&!I||!(t=g.pick_items.path)||t!=g.pick_items.target_path&&g.pick_items.min_path!=g.pick_items.target_path||(t="//"==n.rightHandedSubStr(t,
2)?t+l:"/"==n.rightHandedSubStr(t,1)?t+("/"+l):t+("//"+l),m.organizerPath=t);g.upload&&(m.isUpload=!0,y=(y=(""+B).match(/(.*?)\.(\w+)$/)||(""+B).match(/(.*?)\.(\w+) \[.*\]$/))&&y[2]?y[2].toLowerCase():"unknown",m.extension=y,I=I?H+"zenario/file.php?id="+l:H+"zenario/file.php?getUploadedFileInCacheDir="+encodeURIComponent(l),y.match(/gif|jpg|jpeg|png/)?(m.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+I+"&popout=1&dummy_filename="+encodeURIComponent("image."+y)+"', '"+B+"');",src:I+
"&og=1"},(B=(""+B).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&B[1]&&B[2]&&q.resizeImage(B[1],B[2],180,120,m.thumbnail)):m.adminDownload=I+"&adminDownload=1",c&&(m.first||(m.nudgeUp={onclick:this.globalName+".nudge('"+K(a)+"', "+(f-1)+", "+f+");"}),m.last||(m.nudgeDown={onclick:this.globalName+".nudge('"+K(a)+"', "+f+", "+(f+1)+");"})));b||g.pick_items&&p(g.pick_items.hide_remove_button)||(m.removeButton={onclick:this.globalName+".removePickedItem('"+K(a)+"', '"+K(l)+"');"});e.push(m)}}else e=
{readOnly:b,tempReadOnly:d,noItemSelected:!0,nothing_selected_phrase:x(g.pick_items&&g.pick_items.nothing_selected_phrase,C.nothing_selected)};return q.microTemplate(this.mtPrefix+"_picked_item",e)};f.showPickedItemInPopout=function(a,b){q.action(this,{popout:{href:a,title:b,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){if(!this.tuix.tabs[this.tuix.tab]||!this.tuix.tabs[this.tuix.tab].fields[a])return!1;var b=this.tuix.tabs[this.tuix.tab].fields[a],d,c;if(!(b.pick_items&&
b.pick_items.path&&b.pick_items.min_path&&b.pick_items.target_path))return!1;c=b.pick_items.path;p(b.pick_items.multiple_select)||c!=b.pick_items.target_path&&b.pick_items.min_path!=b.pick_items.target_path||!(d=this.readField(a))||-1!=d.indexOf(",")||(c="//"==n.rightHandedSubStr(c,2)?c+d:"/"==n.rightHandedSubStr(c,1)?c+("/"+d):c+("//"+d));this.SKTarget=a;q.organizerSelect(this.globalName,"setPickedItems",b.pick_items.multiple_select,c,b.pick_items.target_path,b.pick_items.min_path,b.pick_items.max_path,
b.pick_items.disallow_refiners_looping_on_min_path,h,b.pick_items.one_to_one_choose_phrase,b.pick_items.one_to_many_choose_phrase,h,!0,h,h,h,h,h,h,h,h,b.pick_items)};f.setPickedItems=function(a,b,d,c){a=this.SKTarget;var f;values={};for(f in b._items)n.has(b._items,f)&&(d=n.decodeItemIdForStorekeeper(f),values[d]=q.formatSKItemName(c,f));this.addToPickedItems(values,a)};f.addToPickedItems=function(a,b,d){d||(d=this.tuix.tab);d=this.tuix.tabs[d].fields[b];var c=d.current_value===h?d.value:d.current_value,
f,e,k;if(_.isString(a))for(f in k=a.split(","),a={},k)n.has(k,f)&&(e=k[f],a[e]=e);c=p(d.pick_items.multiple_select)&&c?this.pickedItemsArray(d,c):{};for(e in a)if(n.has(a,e)&&(f=a[e],d.values||(d.values={}),d.values[e]||(d.values[e]=f),c[e]=!0,!p(d.pick_items.multiple_select)))break;this.redrawPickedItems(b,d,c)};f.removePickedItem=function(a,b){var d=this.tuix.tabs[this.tuix.tab].fields[a],c=d.current_value===h?d.value:d.current_value,c=c.split(","),f;for(f in c)if(n.has(c,f)&&c[f]==b){c.splice(f,
1);break}c=c.join(",");this.redrawPickedItems(a,d,c)};f.nudge=function(a,b,d){b*=1;d*=1;var c=this.tuix.tabs[this.tuix.tab].fields[a],f=c.current_value===h?c.value:c.current_value,f=f.split(",");if(f[b]!==h&&f[d]!==h){var e=f[b];f[b]=f[d];f[d]=e}f=f.join(",");this.redrawPickedItems(a,c,f)};f.redrawPickedItems=function(a,b,d){"object"==typeof d&&(d=this.pickedItemsValue(d));b.current_value=d;l("name_for_"+a).innerHTML=this.drawPickedItems(a);this.fieldChange(a)};f.changes=function(a){if(this.tuix&&
this.tuix.tab){if(a==h){for(a in this.tuix.tabs)if(n.has(this.tuix.tabs,a)&&this.changed[a])return!0;return!1}return this.changed[a]}return!1};f.markAsChanged=function(a,b){this.tuix&&(a===h&&(a=this.tuix.tab),a&&(this.changed[a]||(this.changed[a]=!0),this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,b){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields[a]){var d=this.tuix.tab,c=this.tuix.tabs[d].fields[a];
c.indeterminate&&(c.indeterminate=!1);b!==h&&c.indeterminates&&c.indeterminates[b]&&(c.indeterminates[b]=!1);this.markAsChanged(d);p(c.multiple_edit)&&this.meMarkChanged(a);this.validateFormatOrRedrawForField(c)}};f.validateFormatOrRedrawForField=function(a){"object"!=typeof a&&(a=this.tuix.tabs[this.tuix.tab].fields[a]);var b=p(a.validate_onchange),d=p(a.format_onchange);a=p(a.redraw_onchange);if(b=b||this.errorOnTab(this.tuix.tab)&&(d||a))return this.validate(),!0;if(d)return this.format(),!0;a&&
(this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,b,d){if(b===h||b!=d)this.tuix.tabs[this.tuix.tab].fields[a].multiple_edit._changed=!0,this.meSetCheckbox(a,!0)};f.meSetCheckbox=function(a,b){"checkbox"==l("multiple_edit__"+a).type?l("multiple_edit__"+a).checked=b:l("multiple_edit__"+a).value=b?1:""};f.meChange=function(a,b,d){if(a)this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=!0;else{if(!d&&p(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.warn_when_abandoning_changes)&&
this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value!==h&&this.readField(b)!=this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value){d='<input type="button" class="submit_selected" value="'+C.abandonChanges+'" onclick="'+this.globalName+".meChange(false, '"+s(b)+'\', true);"/><input type="button" class="submit" value="'+C.cancel+'"/>';q.floatingBox(C.abandonChangesConfirm,d,"warning");this.meSetCheckbox(b,!0);return}this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=
!1;delete this.tuix.tabs[this.tuix.tab].fields[b].current_value;d=this.tuix.tabs[this.tuix.tab].fields[b];var c=d.value;d.multiple_edit.original_value!==h&&(c=this.tuix.tabs[this.tuix.tab].fields[b].current_value=d.multiple_edit.original_value);l(b)&&!d.pick_items?"checkbox"==l(b).type?l(b).checked=c?!0:!1:$(l(b)).val(x(c,"","")):(d=new n.callback,c=this.drawFields(d),this.insertHTML(c,d))}p(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.disable_when_unchanged)&&(l(b)&&(l(b).disabled=!a),$(".control_for__"+
b).each(function(b,c){c.disabled=!a;"button"==c.type&&(a?$(c).removeClass("submit_disabled"):$(c).addClass("submit_disabled"))}));this.meSetCheckbox(b,a);this.validateFormatOrRedrawForField(b)};f.value=function(a,b,d,c){b||(b=this.tuix.tab);a=this.tuix.tabs[b].fields[a];d===h&&(d=!this.editModeOn(b));return a?c||"submit"!=a.type&&"toggle"!=a.type?d||a.current_value===h?a.value!==h?a.value:a.multiple_edit&&a.multiple_edit.original_value!==h?a.multiple_edit.original_value:h:a.current_value:a.pressed:
h};f.readField=function(a){var b=h,d=this.tuix.tab,c=this.tuix.tabs[d].fields[a],f;if(!c||c.snippet||"submit"==c.type||"toggle"==c.type)return h;var e=!this.editModeOn()||p(c.read_only),k=this.tuix.tabs[d].fields[a]._was_hidden_before;c.multiple_edit&&e&&delete this.tuix.tabs[d].fields[a].multiple_edit._changed;if("checkboxes"==c.type||"radios"==c.type){if(!e&&!k&&c.values){var m,k="",s=!0;for(m in c.values)n.has(c.values,m)&&l(a+"___"+m)&&l(a+"___"+m).checked&&(k+=(s?"":",")+m,s=!1);c.current_value=
k}k=!0}else if(c.pick_items||c.upload)k=!0;if(k)return e||c.current_value===h?c.value:c.current_value;if(l("_value_for__"+a))this.tuix.tabs[d].fields[a].current_value=b=l("_value_for__"+a).value;else if("editor"!=c.type&&"code_editor"!=c.type||e)if(!e&&(f=l(a))){if("checkbox"==c.type||"radio"==c.type)b=f.checked?!0:!1;else if("color_picker"==c.type||"colour_picker"==c.type)try{b=$(f).spectrum("get").toHexString()}catch(x){b=$(f).val()}else b=$(f).val();this.tuix.tabs[d].fields[a].current_value=b}else delete this.tuix.tabs[d].fields[a].current_value,
b=c.value;else if(b=h,"editor"==c.type?L.tinyMCE&&tinyMCE.get(a)&&(b=q.tinyMCEGetContent(tinyMCE.get(a))):"code_editor"==c.type&&(f=ace.edit(a))&&(b=f.getValue()),b!==h&&!1!==b)b=this.tuix.tabs[d].fields[a].current_value=b;else return c.current_value===h?c.value:c.current_value;return b};f.blankField=function(a){var b=this.tuix.tab;l(a)&&$(l(a)).val("");l("_value_for__"+a)&&(l("_value_for__"+a).value="");this.tuix.tabs[b].fields[a].current_value=""};f.readTab=function(){var a=this.tuix.tab,b,d={};
this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(var c in this.tuix.tabs[a].fields)n.has(this.tuix.tabs[a].fields,c)&&(b=this.readField(c))!==h&&(d[c]=b);return d};f.wipeTab=function(){var a=this.tuix.tab,b;for(b in this.tuix.tabs[a].fields)n.has(this.tuix.tabs[a].fields,b)&&(delete this.tuix.tabs[a].fields[b].current_value,this.tuix.tabs[a].fields[b].multiple_edit&&delete this.tuix.tabs[a].fields[b].multiple_edit._changed)};f.redrawTab=function(){this.tuix.shake=!1;this.draw2()};f.getURL=
function(){++this.onKeyUpNum;return this.returnAJAXURL()};f.returnAJAXURL=function(){return"..."};f.editModeOn=function(a){if(!this.tuix||!this.tuix.tabs)return!1;a||(a=this.tuix.tab);return this.tuix.tabs[a].edit_mode?this.tuix.tabs[a].edit_mode.on=p(this.tuix.tabs[a].edit_mode.enabled)&&(p(this.tuix.tabs[a].edit_mode.on)||this.editModeAlwaysOn(a)):!1};f.editModeAlwaysOn=function(a){return this.tuix.tabs[a].edit_mode.always_on===h||p(this.tuix.tabs[a].edit_mode.always_on)||this.savedAndContinued(a)};
f.editCancelEnabled=function(a){return this.tuix.tabs[a].edit_mode&&p(this.tuix.tabs[a].edit_mode.enabled)&&!this.editModeAlwaysOn(a)};f.revertEnabled=function(a){return this.tuix.tabs[a].edit_mode&&p(this.tuix.tabs[a].edit_mode.enabled)&&this.editModeAlwaysOn(a)&&!this.savedAndContinued(a)&&(this.tuix.tabs[a].edit_mode.enable_revert===h&&this.tuix.key&&this.tuix.key.id||p(this.tuix.tabs[a].edit_mode.enable_revert))};f.savedAndContinued=function(a){return this.tuix.tabs[a]._saved_and_continued};f.editModeOnBox=
function(){if(this.tuix&&this.tuix.tabs&&this.sortedTabs)for(var a in this.sortedTabs)if(n.has(this.sortedTabs,a)&&this.editModeOn(this.sortedTabs[a]))return!0;return!1};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(n.has(this.tuix.tabs,a)){var b=this.tuix.tabs[a];b&&this.sortedTabs.push([a,b.ord])}this.sortedTabs.sort(q.sortArray);this.sortedFields={};for(a in this.sortedTabs)n.has(this.sortedTabs,a)&&(b=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(b))};
f.sortFields=function(a){this.sortedFields[a]=[];if(this.tuix.tabs[a].fields)for(var b in this.tuix.tabs[a].fields)if(n.has(this.tuix.tabs[a].fields,b)){var d=this.tuix.tabs[a].fields[b];d&&this.sortedFields[a].push([b,d.ord])}this.sortedFields[a].sort(q.sortArray);for(b in this.sortedFields[a])n.has(this.sortedFields[a],b)&&(this.sortedFields[a][b]=this.sortedFields[a][b][0])};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};f.getValueArrayofArrays=function(a){return n.nonAsyncAJAX(this.getURL(),
n.urlRequest({_read_values:!0,_box:this.sendStateToServer()}),!a)};f.callFunctionOnEditors=function(a){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields&&L.tinyMCE)for(var b in this.tuix.tabs[this.tuix.tab].fields)if(n.has(this.tuix.tabs[this.tuix.tab].fields,b)&&"editor"==this.tuix.tabs[this.tuix.tab].fields[b].type&&tinyMCE.get(b))if("remove"==a)tinyMCE.get(b).remove();else if("isDirty"==a&&tinyMCE.get(b).isDirty())return!0;return!1};f.validateAlias=
function(){var a=this;n.actAfterDelayIfNotSuperseded("validateAlias",function(){a.validateAliasGo()})};f.validateAliasGo=function(){var a={_validate_alias:1,alias:l("alias").value};this.tuix.key.cID&&(a.cID=this.tuix.key.cID);this.tuix.key.cType&&(a.cType=this.tuix.key.cType);this.tuix.key.equivId&&(a.equivId=this.tuix.key.equivId);l("language_id")&&(a.langId=l("language_id").value);l("update_translations")&&(a.lang_code_in_url="show","update_this"==l("update_translations").value&&l("lang_code_in_url")&&
(a.lang_code_in_url=l("lang_code_in_url").value));$.post(H+"zenario/admin/quick_ajax.php",a,function(a){if(!(a=q.readData(a)))return!1;var d="";if(a)for(var c in a)n.has(a,c)&&(d+=(d?"<br />":"")+a[c]);l("alias_warning_display").innerHTML=d},"text")};f.generateAlias=function(a){return a.toLowerCase().replace(/[\u00e1\u00c1\u00e0\u00c0\u00e2\u00c2\u00e5\u00c5\u00e4\u00c4\u00e3\u00c3\u00c6\u00e6\u00e7\u00c7\u00f0\u00d0\u00e9\u00c9\u00e8\u00c8\u00ea\u00ca\u00eb\u00cb\u00ed\u00cd\u00ec\u00cc\u00ee\u00ce\u00ef\u00cf\u00f1\u00d1\u00f3\u00d3\u00f2\u00d2\u00f4\u00d4\u00f6\u00d6\u00f5\u00d5\u00f8\u00d8\u0161\u0160\u00fa\u00da\u00f9\u00d9\u00fb\u00db\u00fc\u00dc\u00fd\u00dd\u017e\u017d]/g,
function(a){return{"\u00e1":"a","\u00c1":"a","\u00e0":"a","\u00c0":"a","\u00e2":"a","\u00c2":"a","\u00e5":"a","\u00c5":"a","\u00e4":"a","\u00c4":"a","\u00e3":"a","\u00c3":"a","\u00c6":"ae","\u00e6":"ae","\u00e7":"c","\u00c7":"c","\u00f0":"d","\u00d0":"d","\u00e9":"e","\u00c9":"e","\u00e8":"e","\u00c8":"e","\u00ea":"e","\u00ca":"e","\u00eb":"e","\u00cb":"e","\u00ed":"i","\u00cd":"i","\u00ec":"i","\u00cc":"i","\u00ee":"i","\u00ce":"i","\u00ef":"i","\u00cf":"i","\u00f1":"n","\u00d1":"n","\u00f3":"o",
"\u00d3":"o","\u00f2":"o","\u00d2":"o","\u00f4":"o","\u00d4":"o","\u00f6":"o","\u00d6":"o","\u00f5":"o","\u00d5":"o","\u00f8":"o","\u00d8":"o","\u0161":"s","\u0160":"s","\u00fa":"u","\u00da":"u","\u00f9":"u","\u00d9":"u","\u00fb":"u","\u00db":"u","\u00fc":"u","\u00dc":"u","\u00fd":"y","\u00dd":"y","\u017e":"z","\u017d":"z"}[a]}).replace(/&/g,"and").replace(/[^a-z0-9\s_-]/g,"").replace(/\s+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/-+/g,"-").substr(0,50)};f.contentTitleChange=function(){l("menu_title")&&
!this.tuix.___menu_title_changed&&(l("menu_title").value=l("title").value.replace(/\s+/g," "),l("menu_title").onkeyup());l("alias")&&!this.tuix.___alias_changed&&(l("alias").value=this.generateAlias(l("title").value),this.validateAlias())};f.viewFrameworkSource=function(){var a=H+"zenario/admin/organizer.php#zenario__modules/show_frameworks//"+this.tuix.key.moduleId+"//"+n.encodeItemIdForStorekeeper(this.readField("framework"));L.open(a);return!1};f.adminPermChange=function(a,b,d,c,f){var e=!0;c===
h&&(f=0,c=$("input[name="+b+"]").each(function(a,b){b.checked&&++f}).size());0==f?(e=!1,b="zenario_permgroup_empty"):b=f<c?"zenario_permgroup_half_full":"zenario_permgroup_full";l(a).checked=this.tuix.tabs[this.tuix.tab].fields[a].current_value=e;$(l("row__"+a)).removeClass("zenario_permgroup_empty").removeClass("zenario_permgroup_half_full").removeClass("zenario_permgroup_full").addClass(b);l(d).value=this.tuix.tabs[this.tuix.tab].fields[d].value=this.tuix.tabs[this.tuix.tab].fields[d].current_value=
f+"/"+c};f.adminParentPermChange=function(a,b,d){var c=0,f=0,e="",h=l(a).checked,m=$("input[name="+b+"]"),p;for(p in this.tuix.tabs[this.tuix.tab].fields[b].values)n.has(this.tuix.tabs[this.tuix.tab].fields[b].values,p)&&(++c,h&&(e+=(e?",":"")+p,++f));m.size()&&m.each(function(a,b){b.checked=h});this.tuix.tabs[this.tuix.tab].fields[b].current_value=e;this.adminPermChange(a,b,d,c,f)};f.previewDateFormat=function(a,b){var d=this;n.actAfterDelayIfNotSuperseded(a,function(){d.previewDateFormatGo(a,b)})};
f.previewDateFormatGo=function(a,b){(a=l(a))&&(b=l(b))&&(b.value=n.moduleNonAsyncAJAX("zenario_common_features",{previewDateFormat:a.value}))}},zenarioAF,"");
