zenario.lib(function(k,I,f,L,R,S,m,q,O,T,M,l,n,t,x,K,C,U,P,Q,V){f=P(Q);f.init=function(a,b){this.encapName=this.globalName=a;this.mtPrefix=b||"zenario_admin_box";this.baseCSSClass="";this.onKeyUpNum=0;this.documentScrollTop=O.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={}};f.getKey=function(a){return this.tuix.key};f.getKeyId=function(a){return this.tuix&&this.tuix.key?this.tuix.key.id:!1};f.getLastKeyId=function(a){return this.getKeyId(a)};f.openSiteSettings=function(a,
b){this.open("site_settings",{id:a},b,k,function(){M.reloadPage()})};f.enableOrDisableSite=function(){this.open("zenario_enable_site",k,k,k,function(){M.reloadPage()})};f.start=function(a,b,d,c){var h=this;this.tabHidden=!0;this.differentTab=!1;this.path=x(a,"");this.focus=this.tuix={};this.key=x(b,{});this.tab=d;this.shownTab=!1;this.url=this.getURL();this.retryAJAX(this.url,{_fill:!0,_values:c?JSON.stringify(c):""},function(a){h.load(a)?(h.tab&&(h.tuix.tab=h.tab),delete h.key,delete h.tab,h.sortTabs(),
h.initFields(),h.draw()):h.close(!0)},"loading")};f.load=function(a){this.loaded=!0;if(!(a=q.readData(a)))return!1;a.toast&&q.toast(a.toast);this.callFunctionOnEditors("isDirty")&&this.markAsChanged();this.callFunctionOnEditors("remove");this.setData(a);return!this.tuix||!this.tuix.tabs&&this.tuix.go_to_url===k?(q.showMessage(C.couldNotOpenBox,!0,"error"),!1):!0};f.setData=function(a){this.tuix=a};f.initFields=function(){var a,b,d;if(this.tuix.tabs)for(a in this.tuix.tabs)if(m.has(this.tuix.tabs,
a)&&this.tuix.tabs[a]&&this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)m.has(this.tuix.tabs[a].fields,b)&&(d=this.tuix.tabs[a].fields[b])&&(d.pick_items&&d.plugin_setting&&d.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(b,this.value(b,a,!1)):d.values&&_.isString(d.values)&&this.tuix.lovs[d.values]?d.values=this.tuix.lovs[d.values]:d.load_values_from_organizer_path&&!d.values&&this.loadValuesFromOrganizerPath(d))};f.loadValuesFromOrganizerPath=function(a){var b,d;if(a.load_values_from_organizer_path&&
!a.values&&(a.values={},(d=q.getSKItem(a.load_values_from_organizer_path))&&d.items))for(b in d.items)m.has(d.items,b)&&(a.values[m.decodeItemIdForOrganizer(b)]=q.formatSKItemName(d,b))};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};
f.editCancelOrRevert=function(a,b){if(this.tuix.tabs[b].edit_mode){var d,c,h;"edit"==a?(c=n(this.tuix.tabs[b].edit_mode.format_on_edit),h=n(this.tuix.tabs[b].edit_mode.validate_on_edit)):"cancel"==a?(c=n(this.tuix.tabs[b].edit_mode.format_on_cancel_edit),h=n(this.tuix.tabs[b].edit_mode.validate_on_cancel_edit)):"revert"==a&&(c=n(this.tuix.tabs[b].edit_mode.format_on_revert),h=this.errorOnTab(b)||n(this.tuix.tabs[b].edit_mode.validate_on_revert));if(this.tuix.tabs[b].fields&&!h)for(var e in this.tuix.tabs[b].fields)if(m.has(this.tuix.tabs[b].fields,
e))if(n(this.tuix.tabs[b].fields[e].validate_onchange)&&(d=this.readField(e))!==k&&d!=this.tuix.tabs[b].fields[e].value){h=!0;break}else!c&&n(this.tuix.tabs[b].fields[e].format_onchange)&&(d=this.readField(e))!==k&&d!=this.tuix.tabs[b].fields[e].value&&(c=!0);this.tuix.tabs[b].edit_mode.on="cancel"!=a;this.changed[b]=!1;h?this.validate(k,k,!0):c?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==b&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&
this.validate(a!=this.tuix.tab,a)};f.clickButton=function(a,b){"submit"==this.tuix.tabs[this.tuix.tab].fields[b].type?(this.tuix.tabs[this.tuix.tab].fields[b].pressed=!0,this.validate(!0)):"toggle"==this.tuix.tabs[this.tuix.tab].fields[b].type&&((this.tuix.tabs[this.tuix.tab].fields[b].pressed=!n(this.tuix.tabs[this.tuix.tab].fields[b].pressed))?$("#"+b).removeClass("not_pressed").addClass("pressed"):$("#"+b).removeClass("pressed").addClass("not_pressed"),this.validateFormatOrRedrawForField(this.tuix.tabs[this.tuix.tab].fields[b]))};
f.togglePressed=function(a,b){var d;d=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;d===k&&(d=!0);b&&"toggle"==b.type&&(this.toggleLevelsPressed.last=d&&n(b.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));return d};f.toggleLevel=function(a){return this.toggleLevelsPressed.last};f.format=function(a){var b;if(this.loaded&&(b=this.getURL())){var d=this;this.loaded=!1;this.hideTab();this.checkValues(a);this.retryAJAX(b,{_format:!0,_box:this.sendStateToServer()},
function(a){d.load(a);d.sortTabs();d.draw()},"loading")}};f.validate=function(a,b,d,c){var h;if(this.loaded&&(h=this.getURL())){this.differentTab=a;this.loaded=!1;this.hideTab(a);this.checkValues(d);var e=this;this.retryAJAX(h,{_validate:!0,_box:this.sendStateToServer()},function(a){e.load(a)&&!e.errorOnTab(e.tuix.tab)&&b!==k&&(e.tuix.tab=b);e.sortTabs();e.switchToATabWithErrors();e.draw();c&&c()},"loading")}};f.retryAJAX=function(a,b,d,c){var h=function(){m.ajax(a,b,k,k,h).after(d);c&&q.nowDoingSomething(c)};
h()};f.switchToATabWithErrors=function(){if(this.tuix&&this.tuix.tabs&&!this.errorOnTab(this.tuix.tab))for(var a in this.sortedTabs)if(m.has(this.sortedTabs,a)){var b=this.sortedTabs[a];if(this.tuix.tabs[b]&&!q.hidden(this.tuix.tabs[b])&&this.errorOnTab(b))return this.tuix.tab=b,!0}return!1};f.save=function(a,b,d){var c;if(this.loaded&&(c=this.getURL())){var h=this;this.saving||(this.differentTab=this.saving=!0,this.loaded=!1,this.hideTab(!0),this.checkValues(),a={_save:!0,_confirm:a?1:"",_save_and_continue:b,
_box:this.sendStateToServer()},n(this.tuix.download)||this.tuix.confirm&&n(this.tuix.confirm.download)?this.save2(m.nonAsyncAJAX(this.getURL(),m.urlRequest(a)),b,d):this.retryAJAX(c,a,function(a){h.save2(a,b,d)},"saving"))}};f.save2=function(a,b,d){delete this.saving;"\x3c!--Valid--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),"\x3c!--Confirm--\x3e"==(""+a).substr(0,14)?(a=a.substr(14),this.load(a),this.sortTabs(),this.draw(),this.showConfirm(b,d)):"\x3c!--Download--\x3e"==(""+a).substr(0,15)?(l("zenario_iframe_form").action=
this.getURL(),l("zenario_iframe_form").innerHTML='<input type="hidden" name="_download" value="1"/><input type="hidden" name="_box" value="'+t(this.sendStateToServer())+'"/>',l("zenario_iframe_form").submit(),b&&(a=a.substr(15),this.load(a)),this.refreshParentAndClose(!0,b,d)):"\x3c!--Saved--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),this.load(a),this.refreshParentAndClose(!1,b,d)):(this.close(),q.showMessage(a,!0,"error"))):(this.load(a),this.sortTabs(),this.switchToATabWithErrors(),this.draw())};
f.showConfirm=function(a,b){if(this.tuix&&this.tuix.confirm&&n(this.tuix.confirm.show)){var d=this.tuix.confirm.message;n(this.tuix.confirm.html)||(d=t(d,!0));var c='<input type="button" class="submit_selected" value="'+this.tuix.confirm.button_message+'" onclick="'+this.globalName+".save(true, "+n(a)+", "+n(b)+');"/><input type="button" class="submit" value="'+this.tuix.confirm.cancel_button_message+'" onclick="zenarioA.closeFloatingBox();"/>';q.floatingBox(d,c,x(this.tuix.confirm.message_type,"none"))}};
f.applyMergeFields=function(a,b,d,c){return a};f.applyMergeFieldsToLabel=function(a,b,d,c){return a};f.hideTab=function(a){var b=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){b.tabHidden=!0;b.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),this.tabHidden=
!0,this.draw())};f.draw=function(){this.loaded&&this.tabHidden&&this.draw2()};f.draw2=function(){return this.drawFields(cb)};f.animateInTab=function(a,b,d){var c=this,h=this.tuix.shake===k?this.differentTab&&this.errorOnTab(this.tuix.tab):n(this.tuix.shake);if(this.shownTab==this.tuix.tab){if(h&&!d.find("iframe").length)d.effect({effect:"bounce",duration:125,direction:"right",times:2,distance:5,mode:"effect",complete:function(){c.insertHTML(a,b);$("#zenario_abtab").clearQueue().show().animate({opacity:1},
75,function(){m.browserIsIE()&&this.style.removeAttribute("filter");c.addJQueryElementsToTabAndFocusFirstField()});c.hideShowFields()}});else{this.insertHTML(a,b);var e=this.lastScrollTop;$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){m.browserIsIE()&&this.style.removeAttribute("filter");h||e===k?c.addJQueryElementsToTabAndFocusFirstField():c.addJQueryElementsToTab()});$("#zenario_fbAdminInner").scrollTop(e);this.hideShowFields()}delete this.tuix.shake}else this.insertHTML(a,
b),$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){m.browserIsIE()&&this.style.removeAttribute("filter");c.addJQueryElementsToTabAndFocusFirstField()})};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var b=[],d;for(d in this.sortedTabs)if(m.has(this.sortedTabs,d)){var c=this.sortedTabs[d];this.tuix.tabs[c]&&!q.hidden(this.tuix.tabs[c])&&(this.tuix.tab||(this.tuix.tab=c),b.push({tabId:c,current:this.tuix.tab==c,label:this.tuix.tabs[c].label}))}return q.microTemplate(a,
b)};f.drawFields=function(a){q.clearHTML5UploadFromDragDrop();var b=this.tuix.tab,d="",c="";!this.savedAndContinued(b)&&this.editCancelEnabled(b)&&(c='<div class="zenario_editCancelButton"><input class="submit" type="button" onclick="'+this.globalName+'.changeMode(); return false;" value="'+(this.editModeOn()?C.cancel:C.edit)+'"></div>');var h=x(this.tuix.tabs[b].template,this.mtPrefix+"_current_tab"),e=!1,p,g,k,c={fields:{},rows:[],tabId:b,path:this.path,revert:c,errors:[],notices:{}};if(this.editModeOn()){if(this.tuix.tabs[b].errors)for(p in this.tuix.tabs[b].errors)m.has(this.tuix.tabs[b].errors,
p)&&(g=this.tuix.tabs[b].errors[p],c.errors.push({message:g}));if(this.tuix.tabs[b].fields)for(p in this.tuix.tabs[b].fields)m.has(this.tuix.tabs[b].fields,p)&&(g=this.tuix.tabs[b].fields[p],g.error&&c.errors.push({message:g.error}))}if(this.tuix.tabs[b].notices)for(p in this.tuix.tabs[b].notices)m.has(this.tuix.tabs[b].notices,p)&&(g=this.tuix.tabs[b].notices[p],n(g.show)&&{error:1,warning:1,question:1,success:1}[g.type]&&(c.notices[p]=g));for(var f in this.sortedFields[b])m.has(this.sortedFields[b],
f)&&(p=this.sortedFields[b][f],g=this.tuix.tabs[b].fields[p],g._id=p,g._html=this.drawField(a,b,p,!0),!1!==g._html&&(g._lastGrouping=k,k!==g.grouping&&(k=g.grouping,g._startNewRow=!0),!g._startNewRow&&c.rows.length||c.rows.push({fields:[]}),e||this.tuix.tabs[b].show_errors_after_field!=p||(c.rows[c.rows.length-1].errors=c.errors,c.rows[c.rows.length-1].notices=c.notices,e=!0),c.rows[c.rows.length-1].fields.push(g),c.fields[p]=g));c.rows.length&&(c.rows[c.rows.length-1].fields[0]._isLastRow=!0);e||
c.rows.splice(0,0,{errors:c.errors,notices:c.notices});d+=q.microTemplate(h,c);for(f in this.sortedFields[b])m.has(this.sortedFields[b],f)&&(p=this.sortedFields[b][f],delete this.tuix.tabs[b].fields[p]._lastGrouping,delete this.tuix.tabs[b].fields[p]._startNewRow,delete this.tuix.tabs[b].fields[p]._hideOnOpen,delete this.tuix.tabs[b].fields[p]._showOnOpen,delete this.tuix.tabs[b].fields[p]._isLastRow,delete this.tuix.tabs[b].fields[p]._html,delete this.tuix.tabs[b].fields[p]._id);return d};f.insertHTML=
function(a,b){var d=l("zenario_abtab");d.innerHTML=a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(d).addClass("zenario_abtab_changed"):$(d).removeClass("zenario_abtab_changed");b.call()};f.hideShowFields=function(a){var b=$(".zenario_hide_on_open"),d=$(".zenario_hide_row_on_open"),c=$(".zenario_show_on_open"),h=function(a,b){b.style.display="none"};c.length&&!b.length?c.show("blind",200,a):!c.length&&b.length?b.hide("blind",200,function(){d.each(h)}):c.length&&b.length&&(b.each(h),d.each(h),c.show())};
f.addJQueryElementsToTab=function(){m.addJQueryElements("#zenario_abtab ",!0)};f.addJQueryElementsToTabAndFocusFirstField=function(){m.addJQueryElements("#zenario_abtab ",!0);this.focusFirstField()};f.focusFirstField=function(){if(this.tuix&&!n(this.tuix.tabs[this.tuix.tab].disable_autofocus)){var a=-1,b=[],d=k,c;for(c in this.sortedFields[this.tuix.tab])if(m.has(this.sortedFields[this.tuix.tab],c)){var h=this.sortedFields[this.tuix.tab][c],e=this.tuix.tabs[this.tuix.tab].fields[h];if(l(h)&&$(l(h)).is(":visible")&&
(b[++a]={id:h,type:e.type,empty:""==l(h).value,focusable:e.type&&{password:1,checkbox:1,select:1,text:1,textarea:1}[e.type]&&!n(l(h).disabled)&&!n(l(h).readonly)},1<a))break}if(b[0]&&!b[0].empty&&b[1]&&b[1].focusable&&b[1].empty&&"password"==b[1].type)d=1;else if(b[0]&&b[0].focusable)d=0;else if(b[1]&&b[1].focusable)d=1;else return;setTimeout(function(){l(b[d].id).focus()},50)}};f.focusField=function(){this.fieldToFocus&&l(this.fieldToFocus)&&$(l(this.fieldToFocus)).is(":visible")&&l(this.fieldToFocus).focus();
delete this.fieldToFocus};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(m.has(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var b;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(b in this.tuix.tabs[a].errors)if(m.has(this.tuix.tabs[a].errors,b))return!0;if(this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)if(m.has(this.tuix.tabs[a].fields,b)&&this.tuix.tabs[a].fields[b].error)return!0}};
f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var b in this.tuix.tabs)if(m.has(this.tuix.tabs,b)){a=this.tuix.tabs[b];var d=this.editModeOn(b);if(a.fields)for(var c in a.fields)if(m.has(a.fields,c)){var h=a.fields[c];this.isFormField(h)&&(h.current_value===k&&(h.current_value=this.value(c,b,!0)),d&&(h.value===k&&(h.value=this.value(c,b,!1)),h.multiple_edit&&h.multiple_edit._changed===k&&h.multiple_edit.changed!==k&&(h.multiple_edit._changed=h.multiple_edit.changed)))}}};f.drawField=
function(a,b,d,c,h,e,p,g,f,A,G,z){e===k&&(e=this.tuix.tabs[b].fields[d]);g===k&&(g=!this.editModeOn()||n(e.read_only));e.type&&"datetime"==e.type&&(g=!0);if(e.type&&"grouping"==e.type)return"";var B=this,J={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,
onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0};c="";var y,s,u,v=!1,r={"class":""},E={},F=!0,D=!1;h===k&&(e.values&&_.isString(e.values)&&this.tuix.lovs[e.values]?e.values=this.tuix.lovs[e.values]:e.load_values_from_organizer_path&&!e.values&&this.loadValuesFromOrganizerPath(e));if(!(A&&G||"object"!=typeof e.values)){A=[];G={};for(s in e.values)m.has(e.values,s)&&(u=e.values[s],"object"==typeof u?(u.parent!==k&&(D=!0,G[u.parent]=!0),q.hidden(u,
!1,k,s)||(u.ord!==k?A.push([s,u.ord]):u.label!==k?A.push([s,u.label]):A.push([s,s]))):A.push([s,u]));A.sort(q.sortArray);for(y in A)m.has(A,y)&&(A[y]=A[y][0])}if(h===k){e._startNewRow=!n(e.same_row);if(e._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=e.type&&"code_editor"!=e.type&&this.tuix.tabs[b].fields[d]._was_hidden_before&&!q.hidden(e))e._showOnOpen=!0,delete this.tuix.tabs[b].fields[d]._was_hidden_before;else if(e._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&
"editor"!=e.type&&"code_editor"!=e.type&&!this.tuix.tabs[b].fields[d]._was_hidden_before&&q.hidden(e))e._hideOnOpen=!0,this.tuix.tabs[b].fields[d]._was_hidden_before=!0;else{if(q.hidden(e))return this.tuix.tabs[b].fields[d]._was_hidden_before=!0,!1;delete this.tuix.tabs[b].fields[d]._was_hidden_before}s="";u=!1;e.multiple_edit&&(u=g||e.multiple_edit._changed===k?e.multiple_edit.changed:n(e.multiple_edit._changed),n(e.multiple_edit.disable_when_unchanged)&&!u&&(f=!0),n(e.multiple_edit.hide_ui)||!e.multiple_edit.select_list?
(s+='<input type="checkbox" class="multiple_edit" id="multiple_edit__'+t(d)+'"'+(u?' checked="checked"':""),s=n(e.multiple_edit.hide_ui)?s+' style="display: none;"':g?s+' disabled="disabled"':s+(' onchange="'+this.globalName+".meChange(this.checked, '"+t(d)+"');\""),s+="/> "):(s+='<select class="multiple_edit" id="multiple_edit__'+t(d)+'"',s=g?s+' disabled="disabled"':s+(' onchange="'+this.globalName+".meChange(this.value == 1, '"+t(d)+"');\""),s+='><option value=""'+(u?"":' selected="selected"')+
">"+x(e.multiple_edit.select_list.not_changed_label,C.notChanged)+'</option><option value="1"'+(u?' selected="selected"':"")+">"+x(e.multiple_edit.select_list.changed_label,C.changed)+"</option></select> "));c+=s;s=k;e.pre_field_html!==k&&(c+=e.pre_field_html)}e.snippet||p!==k||(p=this.value(d,b,k,!0));p===k&&(p="");if(g||f)r.disabled="disabled";if(e.snippet)e.snippet.html?c+='<span id="snippet__'+t(d)+'">'+e.snippet.html+"</span>":e.snippet.url?c=n(e.snippet.cache)?this.cachedAJAXSnippets[e.snippet.url]?
c+this.cachedAJAXSnippets[e.snippet.url]:c+(this.cachedAJAXSnippets[e.snippet.url]=m.nonAsyncAJAX(m.addBasePath(e.snippet.url))):c+m.nonAsyncAJAX(m.addBasePath(e.snippet.url)):e.snippet.separator&&(c+='<hr class="input_separator"',e.snippet.separator.style&&(c+=' style="'+t(e.snippet.separator.style)+'"'),c+="/>");else if(("checkboxes"==e.type||"radios"==e.type)&&h===k)e.values&&(z=this.pickedItemsArray(e,p),y=_.extend({},e),y.name=x(e.name,d),y.type="checkboxes"==e.type?"checkbox":"radio",g&&(y.disabled=
!0),c+=this.hierarchicalBoxes(a,b,d,p,e,y,z,f,A,G));else if(e.upload||e.pick_items)p={id:d,wrappedId:"name_for_"+d,readOnly:g,tempReadOnly:f},g?p.pickedItems=this.drawPickedItems(d,!0):(p.pickedItems=this.drawPickedItems(d,!1,f),e.pick_items&&e.pick_items.path&&e.pick_items.min_path&&e.pick_items.target_path&&!n(e.pick_items.hide_select_button)&&(p.select={onclick:this.globalName+".pickItems('"+t(d)+"');",phrase:e.pick_items.select_phrase||C.selectDotDotDot}),e.upload&&(p.upload={onclick:this.globalName+
".upload('"+t(d)+"');",phrase:e.upload.upload_phrase||C.uploadDotDotDot},n(e.upload.drag_and_drop)&&this.upload(d,!0),L.Dropbox&&Dropbox.isBrowserSupported()&&(p.dropbox={onclick:this.globalName+".chooseFromDropbox('"+t(d)+"');",phrase:e.upload.dropbox_phrase||C.dropboxDotDotDot}))),c+=q.microTemplate(this.mtPrefix+"_picked_items",p);else if(e.type){r.onchange=h?this.globalName+".fieldChange('"+t(d)+"', '"+t(h)+"');":this.globalName+".fieldChange('"+t(d)+"');";e.disabled&&(r["class"]+="disabled ");
e.return_key_presses_button&&!g&&(r.onkeyup=x(r.onkeyup,"","")+"if (event.keyCode == 13) {$('#"+t(e.return_key_presses_button)+"').click();}");n(e.multiple_edit)&&!g&&(r.onkeyup=x(r.onkeyup,"","")+"if (event && event.keyCode == 9) return true; "+this.globalName+".meMarkChanged('"+t(d)+"', this.value, '"+t(e.value)+"');");r["class"]+="input_"+e.type;if("select"==e.type)e.slider&&(v=!0,c+=this.drawSlider(a,d,e,g,!0)),c+="<select";else if("code_editor"==e.type)c+="<div",r["class"]=" zenario_embedded_ace_editor",
a.after(function(){var a=ace.edit(d);a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);g&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));n(e.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.session.on("change",function(a){m.actAfterDelayIfNotSuperseded("code_editor_"+d,function(){B.fieldChange(d)},2E3)});if(language=e.language)try{language=language.match(/\.twig\.html$/i)?"ace/mode/twig":language.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(language).mode:
"ace/mode/"+language,a.session.setMode(language)}catch(b){console.log("Ace editor could not load that language",language)}});else if("color_picker"==e.type||"colour_picker"==e.type)c+="<input",r["class"]=" zenario_color_picker",a.after(function(){var a=e.color_picker_options||e.colour_picker_options||{};a.disabled=g;a.preferredFormat=a.preferredFormat||"hex";$(l(d)).spectrum(a)});else if("editor"==e.type){c+="<textarea";q.getSkinDesc();var H;f={script_url:I+q.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,
plugins:"autoresize",document_base_url:k,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,autoresize_max_height:Math.max(Math.floor(0.5*$(L).height()),300),autoresize_bottom_margin:10,onchange_callback:function(a){B.fieldChange(a.id)},init_instance_callback:function(a){q.enableDragDropUploadInTinyMCE(!1,k,l("row__"+x(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&q.enableDragDropUploadInTinyMCE(!1,
k,b)}};b=_.extend({},f,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],image_advtab:!0,visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:q.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,content_css:k,toolbar:"undo redo | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",style_formats:q.skinDesc.style_formats,
oninit:k});s=_.extend({},b,{toolbar:"undo redo | image link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",file_browser_callback:q.fileBrowser,init_instance_callback:function(a){q.enableDragDropUploadInTinyMCE(!0,I,l("row__"+x(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&q.enableDragDropUploadInTinyMCE(!0,I,b)}});u=_.extend({},s,{toolbar:"undo redo | image | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});
var K=_.extend({},u,{toolbar:"undo redo | link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});g?(H=f,r["class"]=" tinymce_readonly"):e.insert_image_button?e.insert_link_button?(H=s,r["class"]=" tinymce_with_images_and_links"):(H=u,r["class"]=" tinymce_with_images"):e.insert_link_button?(H=K,r["class"]=" tinymce_with_links"):(H=b,r["class"]=" tinymce");r.style="visibility: hidden;";_.isObject(e.editor_options)&&(H=_.extend(H,e.editor_options));
H.setup=function(a){a.on("change",function(a){B.fieldChange(a.id)})};a.after(function(){var a=$(l(d)),b=l("zenario_abtab"),c=b.style.display;b.style.display="block";a.tinymce(H);b.style.display=c})}else if("submit"==e.type||"toggle"==e.type){c+="<input";r.type="button";if(!g||n(e.can_be_pressed_in_view_mode))E.onclick=this.globalName+".clickButton(this, '"+d+"');",delete r.disabled;"submit"==e.type&&(this.tuix.tabs[b].fields[d].pressed=!1);"toggle"==e.type&&(r["class"]+=this.tuix.tabs[b].fields[d].pressed?
" pressed":" not_pressed")}else"textarea"==e.type?c+="<textarea":"date"==e.type||"datetime"==e.type?(c+="<input",r.type="text",r["class"]+=" zenario_datepicker",n(e.change_month_and_year)&&(r["class"]+=" zenario_datepicker_change_month_and_year"),r.readonly="readonly",g||(r.onkeyup=x(r.onkeyup,"","")+"zenario.dateFieldKeyUp(this, event, '"+t(d)+"');")):"url"==e.type?(c+="<input",r.type="url",r.onfocus=x(r.onfocus,"","")+"if(!this.value) this.value = 'http://';",r.onblur=x(r.onblur,"","")+"if(this.value == 'http://') this.value = '';"):
(e.slider&&(v=!0,c+=this.drawSlider(a,d,e,g,!0)),c+="<input",r.type=e.type,F=!0),this.addExtraAttsForTextFields(e,r);if("checkbox"==e.type||"radio"==e.type)n(p)&&(r.checked="checked"),p=k,n(e.indeterminate)&&a.after(function(){var a;if(a=l(d))a.indeterminate=!0});v&&(r.onchange=x(r.onchange,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());",r.onkeyup=x(r.onkeyup,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());");f=e;h===k?f.id=d:(f=$.extend({},f,z),f.id=
d+"___"+h,r["class"]+=" control_for__"+d);"radio"==f.type&&f.name||(f.name=d);for(var w in f)if(m.has(f,w)&&J[w])if("disabled"==w||"readonly"==w){if(n(r[w])||n(f[w]))c+=" "+w+'="'+w+'"'}else c+=" "+w+'="',r[w]&&(c+=r[w]+" ",delete r[w]),c+=t(f[w]),E[w]&&(c+=" "+E[w],delete E[w]),c+='"';for(w in r)m.has(r,w)&&(c+=" "+w+'="'+t(r[w]),E[w]&&(c+=" "+E[w],delete E[w]),c+='"');for(w in E)m.has(E,w)&&(c+=" "+w+'="'+t(E[w])+'"');"select"==e.type?c+=">":"textarea"==e.type||"editor"==e.type?c+=">"+t(p,!1,"asis")+
"</textarea>":"code_editor"==e.type?c+=">"+t(p,!1,"asis")+"</div>":"date"==e.type||"datetime"==e.type?(c+=' value="'+t(m.formatDate(p,"datetime"==e.type))+'"/>',c+='<input type="hidden" id="_value_for__'+t(d)+'" value="'+t(p)+'"/>',g||(c+='<input type="button" class="zenario_remove_date" value="x" onclick="'+this.globalName+".blankField('"+t(d)+"'); $(zenario.get('"+t(d)+"')).change();\"/>")):c=p!==k?c+(' value="'+t(p,!1,"asis")+'"/>'):c+"/>";if("select"==e.type)e.empty_value&&(c+='<option value="">'+
t(e.empty_value)+"</option>"),e.values&&(c+=this.hierarchicalSelect(p,e,A,D,G)),c+="</select>";else if(F&&e.values&&!g){var M=[];for(y in A)m.has(A,y)&&(s=A[y],M.push({label:e.values[s],value:s}));a.after(function(){var a=$(l(d)),b={source:M,minLength:0,appendTo:a.parent()};e.return_key_presses_button&&(b.select=function(){setTimeout(function(){$("#"+e.return_key_presses_button).click()},0)});a.autocomplete(b);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})})}}h===
k&&("url"!=e.type||g||(c+='&nbsp; <input type="button" class="submit" value="Test" onclick="if (get(\''+t(d)+"').value) window.open(zenario.addBasePath(get('"+t(d)+"').value));\"/>"),e.post_field_label!==k&&(c+='<label for="'+t(d)+'" id="label_for__'+t(d)+'"> '+t(e.post_field_label)+"</label>"),e.post_field_html!==k&&(c+=e.post_field_html),v&&(c+=this.drawSlider(a,d,e,g,!1)));return c};f.addExtraAttsForTextFields=function(a,b){};f.hierarchicalSelect=function(a,b,d,c,h,e){var p="",g,f,l,q,z;for(q in d)m.has(d,
q)&&(z=d[q],l=b.values[z],f=g="",_.isString(l)?l={label:l}:n(l.disabled)&&(g=' disabled="disabled"'),z==a&&(f=' selected="selected"'),e===k&&c&&h[z]?p+='<optgroup label="'+t(l,!1,!0)+'"'+g+">"+this.hierarchicalSelect(a,b,d,c,h,z)+"</optgroup>":e===l.parent&&(p+='<option value="'+t(z)+'"'+f+g+">"+t(l,!1,!0)+"</option>"));return p};f.chooseFromDropbox=function(a){var b=this,d;if(!this.tuix.tabs[this.tuix.tab]||!(d=this.tuix.tabs[this.tuix.tab].fields[a])||!d.upload)return!1;d={cancel:function(){q.hideAJAXLoader()},
linkType:"direct",multiselect:!!n(d.upload.multi),extensions:d.upload.extensions?_.toArray(d.upload.extensions):k,success:function(c){q.showAJAXLoader();var d,e,f=new m.callback;for(d in c)m.has(c,d)&&(e=c[d],f.add(m.ajax("zenario/ajax.php?method_call=handleAdminBoxAJAX&fetchFromDropbox=1&path="+encodeURIComponent(b.path),e,!0)));f.after(function(){var c,d,e,h,f;if(!b.tuix.tabs[b.tuix.tab]||!(e=b.tuix.tabs[b.tuix.tab].fields[a])||!e.upload)return!1;h=e.current_value===k?e.value:e.current_value;f=
n(e.upload.multi);for(c in arguments)m.has(arguments,c)&&(d=arguments[c])&&d.id&&(h=f&&h?h+(","+d.id):d.id);q.hideAJAXLoader();b.redrawPickedItems(a,e,h)})}};q.showAJAXLoader();Dropbox.choose(d)};f.upload=function(a,b){var d=this,c;if(!this.tuix.tabs[this.tuix.tab]||!(c=this.tuix.tabs[this.tuix.tab].fields[a])||!c.upload)return!1;c={class_name:c.class_name,upload:c.upload};this.uploadCallback=function(b){if(b){var c,f,g,l,q;if(!d.tuix.tabs[d.tuix.tab]||!(g=d.tuix.tabs[d.tuix.tab].fields[a])||!g.upload)return!1;
l=g.current_value===k?g.value:g.current_value;q=n(g.upload.multi);for(c in b)m.has(b,c)&&(f=b[c])&&f.id&&(l=q&&l?l+(","+f.id):f.id);d.redrawPickedItems(a,g,l)}};b?q.setHTML5UploadFromDragDrop(I+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+encodeURIComponent(d.path),{fileUpload:1},!1,this.uploadCallback,l("zenario_fbAdminInner")):q.action(this,c,k,k,k,{fileUpload:1})};f.uploadComplete=function(a){this.uploadCallback!==k&&this.uploadCallback(a);delete this.uploadCallback};f.drawSlider=function(a,
b,d,c,h){var e=this,f=_.clone(d.slider);d="";if(n(f.before_field)?h:!h)c&&(d+='<div class="ui-disabled">'),d+='<div id="zenario_slider_for__'+t(b)+'" class="'+t(f["class"])+'" style="'+t(f.style)+'"></div>',c&&(d+="</div>"),a.after(function(){var a;if(a=l("zenario_slider_for__"+b))f.min!==k&&(f.min*=1),f.max!==k&&(f.max*=1),f.step!==k&&(f.step*=1),f.disabled=!e.editModeOn(),f.value=$(l(b)).val(),f.slide=function(a,c){$(l(b)).val(c.value)},f.change=function(a,c){e.fieldChange(b)},$(a).slider(f)});
return d};f.pickedItemsArray=function(a,b){if(!1===b||null===b||b===k||!(0!==b&&"0"!==b||a.values&&(a.values[0]||a.values["0"])))return{};var d=(b+"").split(","),c={},h,e,f,g;a._display_value=!1;for(f in d)m.has(d,f)&&(g=d[f])&&(a.upload&&(e=m.decodeItemIdForOrganizer(g))&&(e=e.split("/"))&&e[1]?(c[g]=e[1],n(e[2])&&n(e[3])&&(c[g]+=" ["+e[2]+" \u00d7 "+e[3]+"px]")):a.values&&a.values[g]&&"string"==typeof a.values[g]?c[g]=a.values[g]:a.values&&a.values[g]&&a.values[g].label?c[g]=a.values[g].label:a.pick_items&&
(a.pick_items.target_path&&(h=q.getSKItem(a.pick_items.target_path,g))||a.pick_items.path&&a.pick_items.path!=a.pick_items.target_path&&-1==a.pick_items.path.indexOf("//")&&(h=q.getSKItem(a.pick_items.path,g)))?(a.values||(a.values={}),a.values[g]=c[g]=q.formatSKItemName(h,g)):a.upload&&g==1*g&&(e=q.lookupFileDetails(g))?(a.values||(a.values={}),c[g]=e.filename,n(e.width)&&n(e.height)&&(c[g]+=" ["+e.width+" \u00d7 "+e.height+"px]"),a.values[g]=c[g]):c[g]=g,!1===a._display_value&&(a._display_value=
c[g]));return c};f.pickedItemsValue=function(a){var b,d="";if(a)for(b in a)m.has(a,b)&&(d+=(""===d?"":",")+b);return d};f.hierarchicalBoxes=function(a,b,d,c,h,e,f,g,N,A,x,z,B){var C=1;if(!B)B=0,C=1*h.cols||1;else if(10<B)return"";z||(z={});x&&(z[x]=!0);var y=0,s="",u,v,r;B&&(s+='<div class="zenario_hierarchical_box_children" id="'+t("children_for___"+d+"___"+x)+'">');for(var E in N)if(m.has(N,E)){u={};v=N[E];v==1*v&&(v*=1);var F=k;r="object"==typeof h.values[v]?h.values[v]:{label:h.values[v]};h.tag_colors&&
(u.tag_color=h.tag_colors[v]||"blue");F=r.parent;"0"===F&&(F=!1);if(!x&&!F||x==F){if(u.newRow=++y>C)y=1;u.col=y;u.cols=C;F=c?!0===c||1===c||"1"===c?!0===v||1===v||"1"===v:f?f[v]!==k?!0:!1:v==c:!v;if("checkboxes"==h.type&&n(h.checking_child_checks_parents)){var D="";x&&(D+="if (this.checked) { for (var cb in "+JSON.stringify(z)+") { get('"+t(d)+"___' + cb).checked = true; } } ");A[v]&&(D+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");D?e.onchange=h.onchange?
D+" "+h.onchange:D:h.onchange?e.onchange=h.onchange:delete e.onchange}else"checkboxes"==h.type&&n(h.checking_parent_checks_children)&&(D="",A[v]&&(D+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),D?e.onchange=h.onchange?D+" "+h.onchange:D:h.onchange?e.onchange=h.onchange:delete e.onchange);u.lovId=d+"___"+v;u.lovField=r;h.indeterminates&&n(h.indeterminates[v])&&function(b){a.after(function(){var a;if(a=l(b))a.indeterminate=!0})}(u.lovId);
u.lovHTML=this.drawField(a,b,d,!0,v,e,F,!1,g,N,A,r);u.childrenHTML="";A[v]&&(u.childrenHTML=this.hierarchicalBoxes(a,b,d,c,h,e,f,g,N,A,v,_.extend({},z),B+1),y=0);s+=q.microTemplate("zenario_admin_box_radio_or_checkbox",u)}}B&&(s+="</div>");return s};f.drawPickedItems=function(a,b,d,c){c===k&&(c=this.tuix.tab);var h=this.tuix.tabs[c].fields[a],e=!1,f,g=this.value(a,c,b),l=this.pickedItemsArray(h,g);c=h.upload&&n(h.upload.reorder_items);var t=1*h.cols||1,G=0;for(f in l)if(m.has(l,f)){e=!0;break}if(e){var e=
[],z=[];if(c)for(f in g=g.split(","),g)m.has(g,f)&&z.push([g[f],l[g[f]]]);else{for(f in l)m.has(l,f)&&z.push([f,l[f]]);z.sort(q.sortArray)}for(f=0;f<z.length;++f){var l=z[f][0],B=z[f][1],J=l==1*l,y,s,g={id:a,item:l,label:B,first:0==f,last:f==z.length-1,readOnly:b,tempReadOnly:d};if(g.newRow=++G>t)G=1;g.col=G;g.cols=t;h.tag_colors&&(g.tag_color=h.tag_colors[l]||"blue");!h.pick_items||h.upload&&!J||!(s=h.pick_items.path)||s!=h.pick_items.target_path&&h.pick_items.min_path!=h.pick_items.target_path||
(s="//"==m.rightHandedSubStr(s,2)?s+l:"/"==m.rightHandedSubStr(s,1)?s+("/"+l):s+("//"+l),g.organizerPath=s);h.upload&&(g.isUpload=!0,y=(y=(""+B).match(/(.*?)\.(\w+)$/)||(""+B).match(/(.*?)\.(\w+) \[.*\]$/))&&y[2]?y[2].toLowerCase():"unknown",g.extension=y,J=J?I+"zenario/file.php?id="+l:I+"zenario/file.php?getUploadedFileInCacheDir="+encodeURIComponent(l),y.match(/gif|jpg|jpeg|png|svg/)?(g.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+J+"&popout=1&dummy_filename="+encodeURIComponent("image."+
y)+"', '"+B+"');",src:J+"&og=1"},(B=(""+B).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&B[1]&&B[2]&&q.resizeImage(B[1],B[2],180,120,g.thumbnail)):g.adminDownload=J+"&adminDownload=1",c&&(g.first||(g.nudgeUp={onclick:this.globalName+".nudge('"+K(a)+"', "+(f-1)+", "+f+");"}),g.last||(g.nudgeDown={onclick:this.globalName+".nudge('"+K(a)+"', "+f+", "+(f+1)+");"})));b||h.pick_items&&n(h.pick_items.hide_remove_button)||(g.removeButton={onclick:this.globalName+".removePickedItem('"+K(a)+"', '"+
K(l)+"');"});e.push(g)}}else e={readOnly:b,tempReadOnly:d,noItemSelected:!0,nothing_selected_phrase:x(h.pick_items&&h.pick_items.nothing_selected_phrase,C.nothing_selected)};return q.microTemplate(this.mtPrefix+"_picked_item",e)};f.showPickedItemInPopout=function(a,b){q.action(this,{popout:{href:a,title:b,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){if(!this.tuix.tabs[this.tuix.tab]||!this.tuix.tabs[this.tuix.tab].fields[a])return!1;var b=this.tuix.tabs[this.tuix.tab].fields[a],
d,c;if(!(b.pick_items&&b.pick_items.path&&b.pick_items.min_path&&b.pick_items.target_path))return!1;c=b.pick_items.path;n(b.pick_items.multiple_select)||c!=b.pick_items.target_path&&b.pick_items.min_path!=b.pick_items.target_path||!(d=this.readField(a))||-1!=d.indexOf(",")||(c="//"==m.rightHandedSubStr(c,2)?c+d:"/"==m.rightHandedSubStr(c,1)?c+("/"+d):c+("//"+d));this.SKTarget=a;q.organizerSelect(this.globalName,"setPickedItems",b.pick_items.multiple_select,c,b.pick_items.target_path,b.pick_items.min_path,
b.pick_items.max_path,b.pick_items.disallow_refiners_looping_on_min_path,k,b.pick_items.one_to_one_choose_phrase,b.pick_items.one_to_many_choose_phrase,k,!0,k,k,k,k,k,k,k,k,b.pick_items)};f.setPickedItems=function(a,b,d,c){a=this.SKTarget;var f;values={};for(f in b._items)m.has(b._items,f)&&(d=m.decodeItemIdForOrganizer(f),values[d]=q.formatSKItemName(c,f));this.addToPickedItems(values,a)};f.addToPickedItems=function(a,b,d){d||(d=this.tuix.tab);d=this.tuix.tabs[d].fields[b];var c=d.current_value===
k?d.value:d.current_value,f,e,l;if(_.isString(a))for(f in l=a.split(","),a={},l)m.has(l,f)&&(e=l[f],a[e]=e);c=n(d.pick_items.multiple_select)&&c?this.pickedItemsArray(d,c):{};for(e in a)if(m.has(a,e)&&(f=a[e],d.values||(d.values={}),d.values[e]||(d.values[e]=f),c[e]=!0,!n(d.pick_items.multiple_select)))break;this.redrawPickedItems(b,d,c)};f.removePickedItem=function(a,b){var d=this.tuix.tabs[this.tuix.tab].fields[a],c=d.current_value===k?d.value:d.current_value,c=c.split(","),f;for(f in c)if(m.has(c,
f)&&c[f]==b){c.splice(f,1);break}c=c.join(",");this.redrawPickedItems(a,d,c)};f.nudge=function(a,b,d){b*=1;d*=1;var c=this.tuix.tabs[this.tuix.tab].fields[a],f=c.current_value===k?c.value:c.current_value,f=f.split(",");if(f[b]!==k&&f[d]!==k){var e=f[b];f[b]=f[d];f[d]=e}f=f.join(",");this.redrawPickedItems(a,c,f)};f.redrawPickedItems=function(a,b,d){"object"==typeof d&&(d=this.pickedItemsValue(d));b.current_value=d;l("name_for_"+a).innerHTML=this.drawPickedItems(a);this.fieldChange(a)};f.changes=function(a){if(this.tuix&&
this.tuix.tab){if(a==k){for(a in this.tuix.tabs)if(m.has(this.tuix.tabs,a)&&this.changed[a])return!0;return!1}return this.changed[a]}return!1};f.markAsChanged=function(a){this.tuix&&(a===k&&(a=this.tuix.tab),a&&(this.changed[a]||(this.changed[a]=!0),this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,b){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields[a]){var d=this.tuix.tab,c=this.tuix.tabs[d].fields[a];
c.indeterminate&&(c.indeterminate=!1);b!==k&&c.indeterminates&&c.indeterminates[b]&&(c.indeterminates[b]=!1);this.markAsChanged(d);n(c.multiple_edit)&&this.meMarkChanged(a);this.validateFormatOrRedrawForField(c)}};f.validateFormatOrRedrawForField=function(a){"object"!=typeof a&&(a=this.tuix.tabs[this.tuix.tab].fields[a]);var b=n(a.validate_onchange),d=n(a.format_onchange);a=n(a.redraw_onchange);if(b=b||this.errorOnTab(this.tuix.tab)&&(d||a))return this.validate(),!0;if(d)return this.format(),!0;a&&
(this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,b,d){if(b===k||b!=d)this.tuix.tabs[this.tuix.tab].fields[a].multiple_edit._changed=!0,this.meSetCheckbox(a,!0)};f.meSetCheckbox=function(a,b){"checkbox"==l("multiple_edit__"+a).type?l("multiple_edit__"+a).checked=b:l("multiple_edit__"+a).value=b?1:""};f.meChange=function(a,b,d){if(a)this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=!0;else{if(!d&&n(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.warn_when_abandoning_changes)&&
this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value!==k&&this.readField(b)!=this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value){d='<input type="button" class="submit_selected" value="'+C.abandonChanges+'" onclick="'+this.globalName+".meChange(false, '"+t(b)+'\', true);"/><input type="button" class="submit" value="'+C.cancel+'"/>';q.floatingBox(C.abandonChangesConfirm,d,"warning");this.meSetCheckbox(b,!0);return}this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=
!1;delete this.tuix.tabs[this.tuix.tab].fields[b].current_value;d=this.tuix.tabs[this.tuix.tab].fields[b];var c=d.value;d.multiple_edit.original_value!==k&&(c=this.tuix.tabs[this.tuix.tab].fields[b].current_value=d.multiple_edit.original_value);l(b)&&!d.pick_items?"checkbox"==l(b).type?l(b).checked=c?!0:!1:$(l(b)).val(x(c,"","")):(d=new m.callback,c=this.drawFields(d),this.insertHTML(c,d))}n(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.disable_when_unchanged)&&(l(b)&&(l(b).disabled=!a),$(".control_for__"+
b).each(function(b,c){c.disabled=!a;"button"==c.type&&(a?$(c).removeClass("submit_disabled"):$(c).addClass("submit_disabled"))}));this.meSetCheckbox(b,a);this.validateFormatOrRedrawForField(b)};f.currentValue=function(a,b){return b==this.tuix.tab?this.readField(a):this.value(a,b)};f.value=function(a,b,d,c){b||(b=this.tuix.tab);a=this.tuix.tabs[b].fields[a];d===k&&(d=!this.editModeOn(b));return!a||a.snippet||"grouping"==a.type?k:c||"submit"!=a.type&&"toggle"!=a.type?d||a.current_value===k?a.value!==
k?a.value:a.multiple_edit&&a.multiple_edit.original_value!==k?a.multiple_edit.original_value:k:a.current_value:a.pressed};f.isFormField=function(a){return!(!a||a.snippet||"grouping"==a.type||"submit"==a.type||"toggle"==a.type)};f.readField=function(a){var b=k,d=this.tuix.tab,c=this.tuix.tabs[d].fields[a],f;if(!this.isFormField(c))return k;var e=!this.editModeOn()||n(c.read_only),p=this.tuix.tabs[d].fields[a]._was_hidden_before;c.multiple_edit&&e&&delete this.tuix.tabs[d].fields[a].multiple_edit._changed;
if("checkboxes"==c.type||"radios"==c.type){if(!e&&!p&&c.values){var g,p="",t=!0;for(g in c.values)m.has(c.values,g)&&l(a+"___"+g)&&l(a+"___"+g).checked&&(p+=(t?"":",")+g,t=!1);c.current_value=p}p=!0}else if(c.pick_items||c.upload)p=!0;if(p)return e||c.current_value===k?c.value:c.current_value;if(l("_value_for__"+a))this.tuix.tabs[d].fields[a].current_value=b=l("_value_for__"+a).value;else if("editor"!=c.type&&"code_editor"!=c.type||e)if(!e&&(f=l(a))){if("checkbox"==c.type||"radio"==c.type)b=f.checked?
!0:!1;else if("color_picker"==c.type||"colour_picker"==c.type)try{b=$(f).spectrum("get").toHexString()}catch(x){b=$(f).val()}else b=$(f).val();this.tuix.tabs[d].fields[a].current_value=b}else delete this.tuix.tabs[d].fields[a].current_value,b=c.value;else if(b=k,"editor"==c.type?L.tinyMCE&&tinyMCE.get(a)&&(b=q.tinyMCEGetContent(tinyMCE.get(a))):"code_editor"==c.type&&(f=ace.edit(a))&&(b=f.getValue()),b!==k&&!1!==b)b=this.tuix.tabs[d].fields[a].current_value=b;else return c.current_value===k?c.value:
c.current_value;return b};f.blankField=function(a){var b=this.tuix.tab;l(a)&&$(l(a)).val("");l("_value_for__"+a)&&(l("_value_for__"+a).value="");this.tuix.tabs[b].fields[a].current_value=""};f.readTab=function(){var a=this.tuix.tab,b,d={};this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(var c in this.tuix.tabs[a].fields)m.has(this.tuix.tabs[a].fields,c)&&(b=this.readField(c))!==k&&(d[c]=b);return d};f.wipeTab=function(){var a=this.tuix.tab,b;for(b in this.tuix.tabs[a].fields)m.has(this.tuix.tabs[a].fields,
b)&&(delete this.tuix.tabs[a].fields[b].current_value,this.tuix.tabs[a].fields[b].multiple_edit&&delete this.tuix.tabs[a].fields[b].multiple_edit._changed)};f.redrawTab=function(){this.tuix.shake=!1;this.draw2()};f.getURL=function(){++this.onKeyUpNum;return this.returnAJAXURL()};f.returnAJAXURL=function(){return"..."};f.editModeOn=function(a){if(!this.tuix||!this.tuix.tabs)return!1;a||(a=this.tuix.tab);return this.tuix.tabs[a].edit_mode?this.tuix.tabs[a].edit_mode.on=n(this.tuix.tabs[a].edit_mode.enabled)&&
(n(this.tuix.tabs[a].edit_mode.on)||this.editModeAlwaysOn(a)):!1};f.editModeAlwaysOn=function(a){return this.tuix.tabs[a].edit_mode.always_on===k||n(this.tuix.tabs[a].edit_mode.always_on)||this.savedAndContinued(a)};f.editCancelEnabled=function(a){return this.tuix.tabs[a].edit_mode&&n(this.tuix.tabs[a].edit_mode.enabled)&&!this.editModeAlwaysOn(a)};f.revertEnabled=function(a){return this.tuix.tabs[a].edit_mode&&n(this.tuix.tabs[a].edit_mode.enabled)&&this.editModeAlwaysOn(a)&&!this.savedAndContinued(a)&&
(this.tuix.tabs[a].edit_mode.enable_revert===k&&this.tuix.key&&this.tuix.key.id||n(this.tuix.tabs[a].edit_mode.enable_revert))};f.savedAndContinued=function(a){return this.tuix.tabs[a]._saved_and_continued};f.editModeOnBox=function(){if(this.tuix&&this.tuix.tabs&&this.sortedTabs)for(var a in this.sortedTabs)if(m.has(this.sortedTabs,a)&&this.editModeOn(this.sortedTabs[a]))return!0;return!1};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(m.has(this.tuix.tabs,
a)){var b=this.tuix.tabs[a];b&&this.sortedTabs.push([a,b.ord])}this.sortedTabs.sort(q.sortArray);this.sortedFields={};for(a in this.sortedTabs)m.has(this.sortedTabs,a)&&(b=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(b))};f.sortFields=function(a){var b,d,c,f,e={};this.sortedFields[a]=[];if(c=this.tuix.tabs[a].fields){for(b in c)m.has(c,b)&&(d=c[b],d.type&&"grouping"==d.type&&(e[d.name||b]=1*d.ord));for(b in c)m.has(c,b)&&(!(d=c[b])||d.type&&"grouping"==d.type||(f=d.grouping?e[d.grouping]:
k,this.sortedFields[a].push([b,d.ord,f])));this.sortedFields[a].sort(q.sortArrayWithGrouping);for(b in this.sortedFields[a])m.has(this.sortedFields[a],b)&&(this.sortedFields[a][b]=this.sortedFields[a][b][0])}};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};f.getValueArrayofArrays=function(a){return m.nonAsyncAJAX(this.getURL(),m.urlRequest({_read_values:!0,_box:this.sendStateToServer()}),!a)};f.getValues1D=function(a){var b,d,c,f,e={};if(this.tuix&&this.tuix.tabs)for(b in this.tuix.tabs)if(m.has(this.tuix.tabs,
b)&&(d=this.tuix.tabs[b],d.fields))for(c in d.fields)if(m.has(d.fields,c))if(f=d.fields[c],a){if(f=f.plugin_setting&&f.plugin_setting.name)e[f]=this.currentValue(c,b)}else e[c]=this.currentValue(c,b);return e};f.callFunctionOnEditors=function(a){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields&&L.tinyMCE)for(var b in this.tuix.tabs[this.tuix.tab].fields)if(m.has(this.tuix.tabs[this.tuix.tab].fields,b)&&"editor"==this.tuix.tabs[this.tuix.tab].fields[b].type&&
tinyMCE.get(b))if("remove"==a)tinyMCE.get(b).remove();else if("isDirty"==a&&tinyMCE.get(b).isDirty())return!0;return!1};f.validateAlias=function(){var a=this;m.actAfterDelayIfNotSuperseded("validateAlias",function(){a.validateAliasGo()})};f.validateAliasGo=function(){var a={_validate_alias:1,alias:l("alias").value};this.tuix.key.cID&&(a.cID=this.tuix.key.cID);this.tuix.key.cType&&(a.cType=this.tuix.key.cType);this.tuix.key.equivId&&(a.equivId=this.tuix.key.equivId);l("language_id")&&(a.langId=l("language_id").value);
l("update_translations")&&(a.lang_code_in_url="show","update_this"==l("update_translations").value&&l("lang_code_in_url")&&(a.lang_code_in_url=l("lang_code_in_url").value));$.post(I+"zenario/admin/quick_ajax.php",a,function(a){if(!(a=q.readData(a)))return!1;var d="";if(a)for(var c in a)m.has(a,c)&&(d+=(d?"<br />":"")+a[c]);l("alias_warning_display").innerHTML=d},"text")};f.generateAlias=function(a){return a.toLowerCase().replace(/[\u00e1\u00c1\u00e0\u00c0\u00e2\u00c2\u00e5\u00c5\u00e4\u00c4\u00e3\u00c3\u00c6\u00e6\u00e7\u00c7\u00f0\u00d0\u00e9\u00c9\u00e8\u00c8\u00ea\u00ca\u00eb\u00cb\u00ed\u00cd\u00ec\u00cc\u00ee\u00ce\u00ef\u00cf\u00f1\u00d1\u00f3\u00d3\u00f2\u00d2\u00f4\u00d4\u00f6\u00d6\u00f5\u00d5\u00f8\u00d8\u0161\u0160\u00fa\u00da\u00f9\u00d9\u00fb\u00db\u00fc\u00dc\u00fd\u00dd\u017e\u017d]/g,
function(a){return{"\u00e1":"a","\u00c1":"a","\u00e0":"a","\u00c0":"a","\u00e2":"a","\u00c2":"a","\u00e5":"a","\u00c5":"a","\u00e4":"a","\u00c4":"a","\u00e3":"a","\u00c3":"a","\u00c6":"ae","\u00e6":"ae","\u00e7":"c","\u00c7":"c","\u00f0":"d","\u00d0":"d","\u00e9":"e","\u00c9":"e","\u00e8":"e","\u00c8":"e","\u00ea":"e","\u00ca":"e","\u00eb":"e","\u00cb":"e","\u00ed":"i","\u00cd":"i","\u00ec":"i","\u00cc":"i","\u00ee":"i","\u00ce":"i","\u00ef":"i","\u00cf":"i","\u00f1":"n","\u00d1":"n","\u00f3":"o",
"\u00d3":"o","\u00f2":"o","\u00d2":"o","\u00f4":"o","\u00d4":"o","\u00f6":"o","\u00d6":"o","\u00f5":"o","\u00d5":"o","\u00f8":"o","\u00d8":"o","\u0161":"s","\u0160":"s","\u00fa":"u","\u00da":"u","\u00f9":"u","\u00d9":"u","\u00fb":"u","\u00db":"u","\u00fc":"u","\u00dc":"u","\u00fd":"y","\u00dd":"y","\u017e":"z","\u017d":"z"}[a]}).replace(/&/g,"and").replace(/[^a-z0-9\s_-]/g,"").replace(/\s+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/-+/g,"-").substr(0,50)};f.contentTitleChange=function(){var a=
l("menu_title"),b=l("alias");a&&!this.tuix.___menu_title_changed&&(a.value=l("title").value.replace(/\s+/g," "),a.onkeyup());!b||b.disabled||this.tuix.___alias_changed||(b.value=this.generateAlias(l("title").value),this.validateAlias())};f.viewFrameworkSource=function(){var a=I+"zenario/admin/organizer.php#zenario__modules/show_frameworks//"+this.tuix.key.moduleId+"//"+m.encodeItemIdForOrganizer(this.readField("framework"));L.open(a);return!1};f.adminPermChange=function(a,b,d,c,f){var e=!0;c===k&&
(f=0,c=$("input[name="+b+"]").each(function(a,b){b.checked&&++f}).size());0==f?(e=!1,b="zenario_permgroup_empty"):b=f<c?"zenario_permgroup_half_full":"zenario_permgroup_full";l(a).checked=this.tuix.tabs[this.tuix.tab].fields[a].current_value=e;$(l("row__"+a)).removeClass("zenario_permgroup_empty").removeClass("zenario_permgroup_half_full").removeClass("zenario_permgroup_full").addClass(b);l(d).value=this.tuix.tabs[this.tuix.tab].fields[d].value=this.tuix.tabs[this.tuix.tab].fields[d].current_value=
f+"/"+c};f.adminParentPermChange=function(a,b,d){var c=0,f=0,e="",k=l(a).checked,g=$("input[name="+b+"]"),n;for(n in this.tuix.tabs[this.tuix.tab].fields[b].values)m.has(this.tuix.tabs[this.tuix.tab].fields[b].values,n)&&(++c,k&&(e+=(e?",":"")+n,++f));g.size()&&g.each(function(a,b){b.checked=k});this.tuix.tabs[this.tuix.tab].fields[b].current_value=e;this.adminPermChange(a,b,d,c,f)};f.previewDateFormat=function(a,b){var d=this;m.actAfterDelayIfNotSuperseded(a,function(){d.previewDateFormatGo(a,b)})};
f.previewDateFormatGo=function(a,b){(a=l(a))&&(b=l(b))&&(b.value=m.moduleNonAsyncAJAX("zenario_common_features",{previewDateFormat:a.value}))}},zenarioAF,"");
