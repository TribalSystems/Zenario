zenario.lib(function(h,I,J,L,f,S,v,s,P,T,N,k,n,u,A,K,B,U,Q,t,R,V){f=Q(R);f.init=function(a,b){this.encapName=this.globalName=a;this.mtPrefix=b||"zenario_admin_box";this.baseCSSClass="";this.onKeyUpNum=0;this.documentScrollTop=P.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={};this.lastFieldInFocus=!1};f.getKey=function(a){return this.tuix.key};f.getKeyId=function(a){return this.tuix&&this.tuix.key?this.tuix.key.id:!1};f.getLastKeyId=function(a){return this.getKeyId(a)};
f.openSiteSettings=function(a,b){this.open("site_settings",{id:a},b,h,function(){N.reloadPage()})};f.enableOrDisableSite=function(){this.open("zenario_enable_site",h,h,h,function(){N.reloadPage()})};f.start=function(a,b,d,c){var g=this;this.tabHidden=!0;this.differentTab=!1;this.path=A(a,"");this.focus=this.tuix={};this.key=A(b,{});this.tab=d;this.shownTab=!1;this.url=this.getURL("start");this.retryAJAX(this.url,{_fill:!0,_values:c?JSON.stringify(c):""},function(a){g.load(a)?(g.tab&&(g.tuix.tab=g.tab),
delete g.key,delete g.tab,g.sortTabs(),g.initFields(),g.draw()):g.close(!0)},"loading")};f.load=function(a){this.loaded=!0;if(!(a=s.readData(a)))return!1;a.toast&&s.toast(a.toast);this.callFunctionOnEditors("isDirty")&&this.markAsChanged();this.callFunctionOnEditors("remove");this.setData(a);return!this.tuix||!this.tuix.tabs&&this.tuix.go_to_url===h?(s.showMessage(B.couldNotOpenBox,!0,"error"),!1):!0};f.setData=function(a){this.tuix=a};f.initFields=function(){var a,b,d;if(this.tuix.tabs)for(a in this.tuix.tabs)if(t(this.tuix.tabs,
a)&&this.tuix.tabs[a]&&this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)t(this.tuix.tabs[a].fields,b)&&(d=this.tuix.tabs[a].fields[b])&&(d.pick_items&&d.plugin_setting&&d.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(b,this.value(b,a,!1)):d.values&&_.isString(d.values)&&this.tuix.lovs[d.values]?d.values=this.tuix.lovs[d.values]:d.load_values_from_organizer_path&&!d.values&&this.loadValuesFromOrganizerPath(d))};f.loadValuesFromOrganizerPath=function(a){var b,d,c;if(a.load_values_from_organizer_path&&
!a.values&&(a.values={},(d=s.getItemFromOrganizer(a.load_values_from_organizer_path))&&d.items))for(b in d.items)t(d.items,b)&&(c=d.items[b],a.values[v.decodeItemIdForOrganizer(b)]={list_image:c.list_image,css_class:c.css_class||d.item&&d.item.css_class,label:s.formatOrganizerItemName(d,b)})};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&
this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};f.editCancelOrRevert=function(a,b){if(this.tuix.tabs[b].edit_mode){var d,c,g;"edit"==a?(c=n(this.tuix.tabs[b].edit_mode.format_on_edit),g=n(this.tuix.tabs[b].edit_mode.validate_on_edit)):"cancel"==a?(c=n(this.tuix.tabs[b].edit_mode.format_on_cancel_edit),g=n(this.tuix.tabs[b].edit_mode.validate_on_cancel_edit)):"revert"==a&&(c=n(this.tuix.tabs[b].edit_mode.format_on_revert),g=this.errorOnTab(b)||n(this.tuix.tabs[b].edit_mode.validate_on_revert));
if(this.tuix.tabs[b].fields&&!g)for(var e in this.tuix.tabs[b].fields)if(t(this.tuix.tabs[b].fields,e))if(n(this.tuix.tabs[b].fields[e].validate_onchange)&&(d=this.readField(e))!==h&&d!=this.tuix.tabs[b].fields[e].value){g=!0;break}else!c&&n(this.tuix.tabs[b].fields[e].format_onchange)&&(d=this.readField(e))!==h&&d!=this.tuix.tabs[b].fields[e].value&&(c=!0);this.tuix.tabs[b].edit_mode.on="cancel"!=a;this.changed[b]=!1;g?this.validate(h,h,!0):c?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==
b&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&this.validate(a!=this.tuix.tab,a)};f.clickButton=function(a,b){"submit"==this.tuix.tabs[this.tuix.tab].fields[b].type?(this.tuix.tabs[this.tuix.tab].fields[b].pressed=!0,this.validate(!0)):"toggle"==this.tuix.tabs[this.tuix.tab].fields[b].type&&((this.tuix.tabs[this.tuix.tab].fields[b].pressed=!n(this.tuix.tabs[this.tuix.tab].fields[b].pressed))?$("#"+b).removeClass("not_pressed").addClass("pressed"):
$("#"+b).removeClass("pressed").addClass("not_pressed"),this.validateFormatOrRedrawForField(this.tuix.tabs[this.tuix.tab].fields[b]))};f.togglePressed=function(a,b){var d;d=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;d===h&&(d=!0);b&&"toggle"==b.type&&(this.toggleLevelsPressed.last=d&&n(b.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));return d};f.toggleLevel=function(a){return this.toggleLevelsPressed.last};f.format=function(a){var b;if(this.loaded&&
(b=this.getURL("format"))){var d=this;this.loaded=!1;this.hideTab();this.checkValues(a);this.retryAJAX(b,{_format:!0,_box:this.sendStateToServer()},function(a){d.load(a);d.sortTabs();d.draw()},"loading")}};f.validate=function(a,b,d,c){var g;if(this.loaded&&(g=this.getURL("validate"))){this.differentTab=a;this.loaded=!1;this.hideTab(a);this.checkValues(d);var e=this;this.retryAJAX(g,{_validate:!0,_box:this.sendStateToServer()},function(a){e.load(a)&&!e.errorOnTab(e.tuix.tab)&&b!==h&&(e.tuix.tab=b);
e.sortTabs();e.switchToATabWithErrors();e.draw();c&&c()},"loading")}};f.retryAJAX=function(a,b,d,c){var g=function(){v.ajax(a,b,h,h,g).after(d);c&&s.nowDoingSomething(c)};g()};f.switchToATabWithErrors=function(){if(this.tuix&&this.tuix.tabs&&!this.errorOnTab(this.tuix.tab))for(var a in this.sortedTabs)if(t(this.sortedTabs,a)){var b=this.sortedTabs[a];if(this.tuix.tabs[b]&&!s.hidden(this.tuix.tabs[b])&&this.errorOnTab(b))return this.tuix.tab=b,!0}return!1};f.save=function(a,b,d){var c;if(this.loaded&&
(c=this.getURL("save"))){var g=this;this.saving||(this.differentTab=this.saving=!0,this.loaded=!1,this.hideTab(!0),this.checkValues(),a={_save:!0,_confirm:a?1:"",_save_and_continue:b,_box:this.sendStateToServer()},n(this.tuix.download)||this.tuix.confirm&&n(this.tuix.confirm.download)?this.save2(v.nonAsyncAJAX(this.getURL("save"),v.urlRequest(a)),b,d):this.retryAJAX(c,a,function(a){g.save2(a,b,d)},"saving"))}};f.save2=function(a,b,d){delete this.saving;"\x3c!--Valid--\x3e"==(""+a).substr(0,12)?(a=
a.substr(12),"\x3c!--Confirm--\x3e"==(""+a).substr(0,14)?(a=a.substr(14),this.load(a),this.sortTabs(),this.draw(),this.showConfirm(b,d)):"\x3c!--Download--\x3e"==(""+a).substr(0,15)?(k("zenario_iframe_form").action=this.getURL("download"),k("zenario_iframe_form").innerHTML='<input type="hidden" name="_download" value="1"/><input type="hidden" name="_box" value="'+u(this.sendStateToServer())+'"/>',k("zenario_iframe_form").submit(),b&&(a=a.substr(15),this.load(a)),this.refreshParentAndClose(!0,b,d)):
"\x3c!--Saved--\x3e"==(""+a).substr(0,12)?(a=a.substr(12),this.load(a),this.refreshParentAndClose(!1,b,d)):(this.close(),s.showMessage(a,!0,"error"))):(this.load(a),this.sortTabs(),this.switchToATabWithErrors(),this.draw())};f.showConfirm=function(a,b){if(this.tuix&&this.tuix.confirm&&n(this.tuix.confirm.show)){var d=this.tuix.confirm.message;n(this.tuix.confirm.html)||(d=u(d,!0));var c='<input type="button" class="submit_selected" value="'+this.tuix.confirm.button_message+'" onclick="'+this.globalName+
".save(true, "+n(a)+", "+n(b)+');"/><input type="button" class="submit" value="'+this.tuix.confirm.cancel_button_message+'" onclick="zenarioA.closeFloatingBox();"/>';s.floatingBox(d,c,A(this.tuix.confirm.message_type,"none"))}};f.applyMergeFields=function(a,b,d,c){return a};f.applyMergeFieldsToLabel=function(a,b,d,c){return a};f.hideTab=function(a){var b=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},
200,function(){b.tabHidden=!0;b.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),this.tabHidden=!0,this.draw())};f.draw=function(){this.loaded&&this.tabHidden&&this.draw2()};f.draw2=function(){return this.drawFields(cb)};f.animateInTab=function(a,b,d){var c=this,g=this.tuix.shake===h?this.differentTab&&this.errorOnTab(this.tuix.tab):n(this.tuix.shake);if(this.shownTab==this.tuix.tab){if(g&&!d.find("iframe").length)d.effect({effect:"bounce",
duration:125,direction:"right",times:2,distance:5,mode:"effect",complete:function(){c.insertHTML(a,b);$("#zenario_abtab").clearQueue().show().animate({opacity:1},75,function(){v.browserIsIE()&&this.style.removeAttribute("filter");c.addJQueryElementsToTabAndFocusFirstField()});c.hideShowFields()}});else{this.insertHTML(a,b);var e=this.lastScrollTop;$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){v.browserIsIE()&&this.style.removeAttribute("filter");g||e===h?c.addJQueryElementsToTabAndFocusFirstField():
c.addJQueryElementsToTab()});$("#zenario_fbAdminInner").scrollTop(e);this.hideShowFields()}delete this.tuix.shake}else this.insertHTML(a,b,!0),$("#zenario_abtab").clearQueue().show().animate({opacity:1},150,function(){v.browserIsIE()&&this.style.removeAttribute("filter");c.addJQueryElementsToTabAndFocusFirstField()})};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var b=[],d;for(d in this.sortedTabs)if(t(this.sortedTabs,d)){var c=this.sortedTabs[d];this.tuix.tabs[c]&&!s.hidden(this.tuix.tabs[c])&&
(this.tuix.tab||(this.tuix.tab=c),b.push({tabId:c,current:this.tuix.tab==c,label:this.tuix.tabs[c].label}))}return s.microTemplate(a,b)};f.drawFields=function(a){s.clearHTML5UploadFromDragDrop();var b=this.tuix.tab,d="",c="";!this.savedAndContinued(b)&&this.editCancelEnabled(b)&&(c='<div class="zenario_editCancelButton"><input class="submit" type="button" onclick="'+this.globalName+'.changeMode(); return false;" value="'+(this.editModeOn()?B.cancel:B.edit)+'"></div>');var g=A(this.tuix.tabs[b].template,
this.mtPrefix+"_current_tab"),e=!1,l,m,h,c={fields:{},rows:[],tabId:b,path:this.path,revert:c,errors:[],notices:{}};if(this.editModeOn()){if(this.tuix.tabs[b].errors)for(l in this.tuix.tabs[b].errors)t(this.tuix.tabs[b].errors,l)&&(m=this.tuix.tabs[b].errors[l],c.errors.push({message:m}));if(this.tuix.tabs[b].fields)for(l in this.tuix.tabs[b].fields)t(this.tuix.tabs[b].fields,l)&&(m=this.tuix.tabs[b].fields[l],m.error&&c.errors.push({message:m.error}))}if(this.tuix.tabs[b].notices)for(l in this.tuix.tabs[b].notices)t(this.tuix.tabs[b].notices,
l)&&(m=this.tuix.tabs[b].notices[l],n(m.show)&&{error:1,warning:1,question:1,success:1}[m.type]&&(c.notices[l]=m));for(var f in this.sortedFields[b])t(this.sortedFields[b],f)&&(l=this.sortedFields[b][f],m=this.tuix.tabs[b].fields[l],m._id=l,m._html=this.drawField(a,b,l,!0),!1!==m._html&&(m._lastGrouping=h,h!==m.grouping&&(h=m.grouping,m._startNewRow=!0),!m._startNewRow&&c.rows.length||c.rows.push({fields:[]}),e||this.tuix.tabs[b].show_errors_after_field!=l||(c.rows[c.rows.length-1].errors=c.errors,
c.rows[c.rows.length-1].notices=c.notices,e=!0),c.rows[c.rows.length-1].fields.push(m),c.fields[l]=m));c.rows.length&&(c.rows[c.rows.length-1].fields[0]._isLastRow=!0);e||c.rows.splice(0,0,{errors:c.errors,notices:c.notices});d+=s.microTemplate(g,c);for(f in this.sortedFields[b])t(this.sortedFields[b],f)&&(l=this.sortedFields[b][f],delete this.tuix.tabs[b].fields[l]._lastGrouping,delete this.tuix.tabs[b].fields[l]._startNewRow,delete this.tuix.tabs[b].fields[l]._hideOnOpen,delete this.tuix.tabs[b].fields[l]._showOnOpen,
delete this.tuix.tabs[b].fields[l]._isLastRow,delete this.tuix.tabs[b].fields[l]._html,delete this.tuix.tabs[b].fields[l]._id);return d};f.insertHTML=function(a,b,d){var c=k("zenario_abtab"),g;c.innerHTML=a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(c).addClass("zenario_abtab_changed"):$(c).removeClass("zenario_abtab_changed");b.call();!d&&this.lastFieldInFocus&&(g=k(this.lastFieldInFocus))&&g.focus()};f.hideShowFields=function(a){var b=$(".zenario_hide_on_open"),d=$(".zenario_hide_row_on_open"),
c=$(".zenario_show_on_open"),g=function(a,b){b.style.display="none"};c.length&&!b.length?c.show("blind",200,a):!c.length&&b.length?b.hide("blind",200,function(){d.each(g)}):c.length&&b.length&&(b.each(g),d.each(g),c.show())};f.addJQueryElementsToTab=function(){v.addJQueryElements("#zenario_abtab ",!0)};f.addJQueryElementsToTabAndFocusFirstField=function(){v.addJQueryElements("#zenario_abtab ",!0);this.focusFirstField()};f.focusFirstField=function(){if(this.tuix&&!n(this.tuix.tabs[this.tuix.tab].disable_autofocus)){var a=
-1,b=[],d=h,c;for(c in this.sortedFields[this.tuix.tab])if(t(this.sortedFields[this.tuix.tab],c)){var g=this.sortedFields[this.tuix.tab][c],e=this.tuix.tabs[this.tuix.tab].fields[g];if(k(g)&&$(k(g)).is(":visible")&&(b[++a]={id:g,type:e.type,empty:""==k(g).value,focusable:e.type&&{password:1,checkbox:1,select:1,text:1,textarea:1}[e.type]&&!n(k(g).disabled)&&!n(k(g).readonly)},1<a))break}if(b[0]&&!b[0].empty&&b[1]&&b[1].focusable&&b[1].empty&&"password"==b[1].type)d=1;else if(b[0]&&b[0].focusable)d=
0;else if(b[1]&&b[1].focusable)d=1;else return;setTimeout(function(){k(b[d].id).focus()},50)}};f.focusField=function(){this.fieldToFocus&&k(this.fieldToFocus)&&$(k(this.fieldToFocus)).is(":visible")&&k(this.fieldToFocus).focus();delete this.fieldToFocus};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(t(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var b;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(b in this.tuix.tabs[a].errors)if(t(this.tuix.tabs[a].errors,
b))return!0;if(this.tuix.tabs[a].fields)for(b in this.tuix.tabs[a].fields)if(t(this.tuix.tabs[a].fields,b)&&this.tuix.tabs[a].fields[b].error)return!0}};f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var b in this.tuix.tabs)if(t(this.tuix.tabs,b)){a=this.tuix.tabs[b];var d=this.editModeOn(b);if(a.fields)for(var c in a.fields)if(t(a.fields,c)){var g=a.fields[c];this.isFormField(g)&&(g.current_value===h&&(g.current_value=this.value(c,b,!0)),d&&(g.value===h&&(g.value=this.value(c,b,!1)),
g.multiple_edit&&g.multiple_edit._changed===h&&g.multiple_edit.changed!==h&&(g.multiple_edit._changed=g.multiple_edit.changed)))}}J&&J.activeElement&&(this.lastFieldInFocus=J.activeElement.id)};f.drawField=function(a,b,d,c,g,e,l,m,f,p,M,C){e===h&&(e=this.tuix.tabs[b].fields[d]);m===h&&(m=!this.editModeOn()||n(e.read_only));e.type&&"datetime"==e.type&&(m=!0);if(e.type&&"grouping"==e.type)return"";var D=this,F={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,
style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0};c="";var x,q,w,y=!1,r={"class":""},G={},O=!0,E=!1;g===h&&(e.values&&_.isString(e.values)&&this.tuix.lovs[e.values]?e.values=this.tuix.lovs[e.values]:e.load_values_from_organizer_path&&!e.values&&
this.loadValuesFromOrganizerPath(e));if(!(p&&M||"object"!=typeof e.values)){p=[];M={};for(q in e.values)t(e.values,q)&&(w=e.values[q],"object"==typeof w?(w.parent!==h&&(E=!0,M[w.parent]=!0),s.hidden(w,!1,h,q)||(w.ord!==h?p.push([q,w.ord]):w.label!==h?p.push([q,w.label]):p.push([q,q]))):p.push([q,w]));p.sort(s.sortArray);for(x in p)t(p,x)&&(p[x]=p[x][0])}if(g===h){e._startNewRow=!n(e.same_row);if(e._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=e.type&&"code_editor"!=e.type&&
this.tuix.tabs[b].fields[d]._was_hidden_before&&!s.hidden(e))e._showOnOpen=!0,delete this.tuix.tabs[b].fields[d]._was_hidden_before;else if(e._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=e.type&&"code_editor"!=e.type&&!this.tuix.tabs[b].fields[d]._was_hidden_before&&s.hidden(e))e._hideOnOpen=!0,this.tuix.tabs[b].fields[d]._was_hidden_before=!0;else{if(s.hidden(e))return this.tuix.tabs[b].fields[d]._was_hidden_before=!0,!1;delete this.tuix.tabs[b].fields[d]._was_hidden_before}q=
"";w=!1;e.multiple_edit&&(w=m||e.multiple_edit._changed===h?e.multiple_edit.changed:n(e.multiple_edit._changed),n(e.multiple_edit.disable_when_unchanged)&&!w&&(f=!0),n(e.multiple_edit.hide_ui)||!e.multiple_edit.select_list?(q+='<input type="checkbox" class="multiple_edit" id="multiple_edit__'+u(d)+'"'+(w?' checked="checked"':""),q=n(e.multiple_edit.hide_ui)?q+' style="display: none;"':m?q+' disabled="disabled"':q+(' onchange="'+this.globalName+".meChange(this.checked, '"+u(d)+"');\""),q+="/> "):(q+=
'<select class="multiple_edit" id="multiple_edit__'+u(d)+'"',q=m?q+' disabled="disabled"':q+(' onchange="'+this.globalName+".meChange(this.value == 1, '"+u(d)+"');\""),q+='><option value=""'+(w?"":' selected="selected"')+">"+A(e.multiple_edit.select_list.not_changed_label,B.notChanged)+'</option><option value="1"'+(w?' selected="selected"':"")+">"+A(e.multiple_edit.select_list.changed_label,B.changed)+"</option></select> "));c+=q;q=h;e.pre_field_html!==h&&(c+=e.pre_field_html)}e.snippet||l!==h||(l=
this.value(d,b,h,!0));l===h&&(l="");if(m||f)r.disabled="disabled";if(e.snippet)e.snippet.html?c+='<span id="snippet__'+u(d)+'">'+e.snippet.html+"</span>":e.snippet.url?c=n(e.snippet.cache)?this.cachedAJAXSnippets[e.snippet.url]?c+this.cachedAJAXSnippets[e.snippet.url]:c+(this.cachedAJAXSnippets[e.snippet.url]=v.nonAsyncAJAX(v.addBasePath(e.snippet.url))):c+v.nonAsyncAJAX(v.addBasePath(e.snippet.url)):e.snippet.separator&&(c+='<hr class="input_separator"',e.snippet.separator.style&&(c+=' style="'+
u(e.snippet.separator.style)+'"'),c+="/>");else if(("checkboxes"==e.type||"radios"==e.type)&&g===h)e.values&&(C=this.pickedItemsArray(e,l),x=_.extend({},e),x.name=A(e.name,d),x.type="checkboxes"==e.type?"checkbox":"radio",m&&(x.disabled=!0),c+=this.hierarchicalBoxes(a,b,d,l,e,x,C,f,p,M));else if(e.upload||e.pick_items)l={id:d,wrappedId:"name_for_"+d,readOnly:m,tempReadOnly:f},m?l.pickedItems=this.drawPickedItems(d,!0):(l.pickedItems=this.drawPickedItems(d,!1,f),e.pick_items&&e.pick_items.path&&e.pick_items.min_path&&
e.pick_items.target_path&&!n(e.pick_items.hide_select_button)&&(l.select={onclick:this.globalName+".pickItems('"+u(d)+"');",phrase:e.pick_items.select_phrase||B.selectDotDotDot}),e.upload&&(l.upload={onclick:this.globalName+".upload('"+u(d)+"');",phrase:e.upload.upload_phrase||B.uploadDotDotDot},n(e.upload.drag_and_drop)&&this.upload(d,!0),L.Dropbox&&Dropbox.isBrowserSupported()&&(l.dropbox={onclick:this.globalName+".chooseFromDropbox('"+u(d)+"');",phrase:e.upload.dropbox_phrase||B.dropboxDotDotDot}))),
c+=s.microTemplate(this.mtPrefix+"_picked_items",l);else if(e.type){r.onchange=g?this.globalName+".fieldChange('"+u(d)+"', '"+u(g)+"');":this.globalName+".fieldChange('"+u(d)+"');";e.disabled&&(r["class"]+="disabled ");e.return_key_presses_button&&!m&&(r.onkeyup=A(r.onkeyup,"","")+"if (event.keyCode == 13) {$('#"+u(e.return_key_presses_button)+"').click();}");n(e.multiple_edit)&&!m&&(r.onkeyup=A(r.onkeyup,"","")+"if (event && event.keyCode == 9) return true; "+this.globalName+".meMarkChanged('"+u(d)+
"', this.value, '"+u(e.value)+"');");r["class"]+="input_"+e.type;if("select"==e.type)e.slider&&(y=!0,c+=this.drawSlider(a,d,e,m,!0)),c+="<select";else if("code_editor"==e.type)c+="<div",r["class"]=" zenario_embedded_ace_editor",a.after(function(){var a=ace.edit(d);a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);m&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));n(e.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.session.on("change",function(a){v.actAfterDelayIfNotSuperseded("code_editor_"+
d,function(){D.fieldChange(d)},2E3)});if(language=e.language)try{language=language.match(/\.twig\.html$/i)?"ace/mode/twig":language.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(language).mode:"ace/mode/"+language,a.session.setMode(language)}catch(b){console.log("Ace editor could not load that language",language)}});else if("color_picker"==e.type||"colour_picker"==e.type)c+="<input",r["class"]=" zenario_color_picker",a.after(function(){var a=e.color_picker_options||e.colour_picker_options||
{};a.disabled=m;a.preferredFormat=a.preferredFormat||"hex";$(k(d)).spectrum(a)});else if("editor"==e.type){c+="<textarea";s.getSkinDesc();var H;f={script_url:I+v.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:h,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,autoresize_max_height:Math.max(Math.floor(0.5*$(L).height()),300),autoresize_bottom_margin:10,onchange_callback:function(a){D.fieldChange(a.id)},init_instance_callback:function(a){s.enableDragDropUploadInTinyMCE(!1,
h,k("row__"+A(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&s.enableDragDropUploadInTinyMCE(!1,h,b)}};b=_.extend({},f,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],image_advtab:!0,visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:s.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,
content_css:h,toolbar:"undo redo | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",style_formats:s.skinDesc.style_formats,oninit:h});q=_.extend({},b,{toolbar:"undo redo | image link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",file_browser_callback:s.fileBrowser,init_instance_callback:function(a){s.enableDragDropUploadInTinyMCE(!0,I,k("row__"+A(a.editorId,a.id)));var b;(b=a.editorContainer)&&
(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&s.enableDragDropUploadInTinyMCE(!0,I,b)}});w=_.extend({},q,{toolbar:"undo redo | image | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});var J=_.extend({},w,{toolbar:"undo redo | link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});m?(H=f,r["class"]=" tinymce_readonly"):e.insert_image_button?e.insert_link_button?
(H=q,r["class"]=" tinymce_with_images_and_links"):(H=w,r["class"]=" tinymce_with_images"):e.insert_link_button?(H=J,r["class"]=" tinymce_with_links"):(H=b,r["class"]=" tinymce");r.style="visibility: hidden;";_.isObject(e.editor_options)&&(H=_.extend(H,e.editor_options));H.setup=function(a){a.on("change",function(a){D.fieldChange(a.id)})};a.after(function(){var a=$(k(d)),b=k("zenario_abtab"),c=b.style.display;b.style.display="block";a.tinymce(H);b.style.display=c})}else if("submit"==e.type||"toggle"==
e.type){c+="<input";r.type="button";if(!m||n(e.can_be_pressed_in_view_mode))G.onclick=this.globalName+".clickButton(this, '"+d+"');",delete r.disabled;"submit"==e.type&&(this.tuix.tabs[b].fields[d].pressed=!1);"toggle"==e.type&&(r["class"]+=this.tuix.tabs[b].fields[d].pressed?" pressed":" not_pressed")}else"textarea"==e.type?c+="<textarea":"date"==e.type||"datetime"==e.type?(c+="<input",r.type="text",r["class"]+=" zenario_datepicker",n(e.change_month_and_year)&&(r["class"]+=" zenario_datepicker_change_month_and_year"),
r.readonly="readonly",m||(r.onkeyup=A(r.onkeyup,"","")+"zenario.dateFieldKeyUp(this, event, '"+u(d)+"');")):"url"==e.type?(c+="<input",r.type="url",r.onfocus=A(r.onfocus,"","")+"if(!this.value) this.value = 'http://';",r.onblur=A(r.onblur,"","")+"if(this.value == 'http://') this.value = '';"):(e.slider&&(y=!0,c+=this.drawSlider(a,d,e,m,!0)),c+="<input",r.type=e.type,O=!0),this.addExtraAttsForTextFields(e,r);if("checkbox"==e.type||"radio"==e.type)n(l)&&(r.checked="checked"),l=h,n(e.indeterminate)&&
a.after(function(){var a;if(a=k(d))a.indeterminate=!0});y&&(r.onchange=A(r.onchange,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());",r.onkeyup=A(r.onkeyup,"","")+"$('#zenario_slider_for__"+d+"').slider('value', $(this).val());");f=e;g===h?f.id=d:(f=$.extend({},f,C),f.id=d+"___"+g,r["class"]+=" control_for__"+d);"radio"==f.type&&f.name||(f.name=d);for(var z in f)if(t(f,z)&&F[z])if("disabled"==z||"readonly"==z){if(n(r[z])||n(f[z]))c+=" "+z+'="'+z+'"'}else c+=" "+z+'="',r[z]&&
(c+=r[z]+" ",delete r[z]),c+=u(f[z]),G[z]&&(c+=" "+G[z],delete G[z]),c+='"';for(z in r)t(r,z)&&(c+=" "+z+'="'+u(r[z]),G[z]&&(c+=" "+G[z],delete G[z]),c+='"');for(z in G)t(G,z)&&(c+=" "+z+'="'+u(G[z])+'"');"select"==e.type?c+=">":"textarea"==e.type||"editor"==e.type?c+=">"+u(l,!1,"asis")+"</textarea>":"code_editor"==e.type?c+=">"+u(l,!1,"asis")+"</div>":"date"==e.type||"datetime"==e.type?(c+=' value="'+u(v.formatDate(l,"datetime"==e.type))+'"/>',c+='<input type="hidden" id="_value_for__'+u(d)+'" value="'+
u(l)+'"/>',m||(c+='<input type="button" class="zenario_remove_date" value="x" onclick="'+this.globalName+".blankField('"+u(d)+"'); $(zenario.get('"+u(d)+"')).change();\"/>")):c=l!==h?c+(' value="'+u(l,!1,"asis")+'"/>'):c+"/>";if("select"==e.type)e.empty_value&&(c+='<option value="">'+u(e.empty_value)+"</option>"),e.values&&(c+=this.hierarchicalSelect(l,e,p,E,M)),c+="</select>";else if(O&&e.values&&!m){var K=[];for(x in p)t(p,x)&&(q=p[x],K.push({label:e.values[q],value:q}));a.after(function(){var a=
$(k(d)),b={source:K,minLength:0,appendTo:a.parent()};e.return_key_presses_button&&(b.select=function(){setTimeout(function(){$("#"+e.return_key_presses_button).click()},0)});a.autocomplete(b);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})})}}g===h&&("url"!=e.type||m||(c+='&nbsp; <input type="button" class="submit" value="Test" onclick="if (get(\''+u(d)+"').value) window.open(zenario.addBasePath(get('"+u(d)+"').value));\"/>"),e.post_field_label!==h&&(c+='<label for="'+
u(d)+'" id="label_for__'+u(d)+'"> '+u(e.post_field_label)+"</label>"),e.post_field_html!==h&&(c+=e.post_field_html),y&&(c+=this.drawSlider(a,d,e,m,!1)));return c};f.addExtraAttsForTextFields=function(a,b){};f.hierarchicalSelect=function(a,b,d,c,g,e){var l="",f,k,p,s,v;for(s in d)t(d,s)&&(v=d[s],p=b.values[v],k=f="",_.isString(p)?p={label:p}:n(p.disabled)&&(f=' disabled="disabled"'),v==a&&(k=' selected="selected"'),e===h&&c&&g[v]?l+='<optgroup label="'+u(p,!1,!0)+'"'+f+">"+this.hierarchicalSelect(a,
b,d,c,g,v)+"</optgroup>":e===p.parent&&(l+='<option value="'+u(v)+'"'+k+f+">"+u(p,!1,!0)+"</option>"));return l};f.chooseFromDropbox=function(a){var b=this,d,c,g,e,l;if(!this.tuix.tabs[this.tuix.tab]||!(d=this.tuix.tabs[this.tuix.tab].fields[a])||!d.upload)return!1;if(e=d.upload.extensions||d.upload.accept)e=_.isString(e)?e.split(","):_.toArray(e);for(c in e)t(e,c)&&(g=e[c],l=g.split("/"),l[1]!==h?e[c]="images"==l[0]?"image":l[0]:"text"!=g&&"documents"!=g&&"images"!=g&&"video"!=g&&"audio"!=g&&"."!=
g.substr(0,1)&&(e[c]="."+g));d={cancel:function(){s.hideAJAXLoader()},linkType:"direct",multiselect:!!n(d.upload.multi),extensions:e,success:function(c){s.showAJAXLoader();var d,e,g=new v.callback;for(d in c)t(c,d)&&(e=c[d],g.add(v.ajax("zenario/ajax.php?method_call=handleAdminBoxAJAX&fetchFromDropbox=1&path="+encodeURIComponent(b.path),e,!0)));g.after(function(){var c,d,e,g,l;if(!b.tuix.tabs[b.tuix.tab]||!(e=b.tuix.tabs[b.tuix.tab].fields[a])||!e.upload)return!1;g=e.current_value===h?e.value:e.current_value;
l=n(e.upload.multi);for(c in arguments)t(arguments,c)&&(d=arguments[c])&&d.id&&(g=l&&g?g+(","+d.id):d.id);s.hideAJAXLoader();b.redrawPickedItems(a,e,g)})}};s.showAJAXLoader();Dropbox.choose(d)};f.upload=function(a,b){var d=this,c;if(!this.tuix.tabs[this.tuix.tab]||!(c=this.tuix.tabs[this.tuix.tab].fields[a])||!c.upload)return!1;c={class_name:c.class_name,upload:c.upload};this.uploadCallback=function(b){if(b){var c,l,f,k,p;if(!d.tuix.tabs[d.tuix.tab]||!(f=d.tuix.tabs[d.tuix.tab].fields[a])||!f.upload)return!1;
k=f.current_value===h?f.value:f.current_value;p=n(f.upload.multi);for(c in b)t(b,c)&&(l=b[c])&&l.id&&(k=p&&k?k+(","+l.id):l.id);d.redrawPickedItems(a,f,k)}};b?s.setHTML5UploadFromDragDrop(I+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+encodeURIComponent(d.path),{fileUpload:1},!1,this.uploadCallback,k("zenario_fbAdminInner")):s.action(this,c,h,h,h,{fileUpload:1})};f.uploadComplete=function(a){this.uploadCallback!==h&&this.uploadCallback(a);delete this.uploadCallback};f.drawSlider=function(a,
b,d,c,g){var e=this,l=_.clone(d.slider);d="";if(n(l.before_field)?g:!g)c&&(d+='<div class="ui-disabled">'),d+='<div id="zenario_slider_for__'+u(b)+'" class="'+u(l["class"])+'" style="'+u(l.style)+'"></div>',c&&(d+="</div>"),a.after(function(){var a;if(a=k("zenario_slider_for__"+b))l.min!==h&&(l.min*=1),l.max!==h&&(l.max*=1),l.step!==h&&(l.step*=1),l.disabled=!e.editModeOn(),l.value=$(k(b)).val(),l.slide=function(a,c){$(k(b)).val(c.value)},l.change=function(a,c){e.fieldChange(b)},$(a).slider(l)});
return d};f.pickedItemsArray=function(a,b){if(!1===b||null===b||b===h||!(0!==b&&"0"!==b||a.values&&(a.values[0]||a.values["0"])))return{};var d=(b+"").split(","),c={},g,e,l,f,k,p;a._display_value=!1;for(k in d)t(d,k)&&(p=d[k])&&(a.upload&&(f=v.decodeItemIdForOrganizer(p))&&(f=f.split("/"))&&f[1]?(c[p]=f[1],n(f[2])&&n(f[3])&&(c[p]+=" ["+f[2]+" \u00d7 "+f[3]+"px]")):a.values&&a.values[p]&&"string"==typeof a.values[p]?c[p]=a.values[p]:a.values&&a.values[p]&&a.values[p].label?c[p]=a.values[p].label:a.pick_items&&
(a.pick_items.target_path&&(g=s.getItemFromOrganizer(a.pick_items.target_path,p))||a.pick_items.path&&a.pick_items.path!=a.pick_items.target_path&&-1==a.pick_items.path.indexOf("//")&&(g=s.getItemFromOrganizer(a.pick_items.path,p)))?(a.values||(a.values={}),e=s.formatOrganizerItemName(g,p),l=g.items&&g.items[p]||{},c[p]=e,a.values[p]={list_image:l.list_image,css_class:l.css_class||g.item&&g.item.css_class,label:e}):a.upload&&p==1*p&&(f=s.lookupFileDetails(p))?(a.values||(a.values={}),c[p]=f.filename,
n(f.width)&&n(f.height)&&(c[p]+=" ["+f.width+" \u00d7 "+f.height+"px]"),a.values[p]=c[p]):c[p]=p,!1===a._display_value&&(a._display_value=c[p]));return c};f.pickedItemsValue=function(a){var b,d="";if(a)for(b in a)t(a,b)&&(d+=(""===d?"":",")+b);return d};f.hierarchicalBoxes=function(a,b,d,c,g,e,f,m,v,p,A,C,D){var F=1;if(!D)D=0,F=1*g.cols||1;else if(10<D)return"";C||(C={});A&&(C[A]=!0);var x=0,q="",w,y,r;D&&(q+='<div class="zenario_hierarchical_box_children" id="'+u("children_for___"+d+"___"+A)+'">');
for(var G in v)if(t(v,G)){w={};y=v[G];y==1*y&&(y*=1);var B=h;r="object"==typeof g.values[y]?g.values[y]:{label:g.values[y]};g.tag_colors&&(w.tag_color=g.tag_colors[y]||"blue");B=r.parent;"0"===B&&(B=!1);if(!A&&!B||A==B){if(w.newRow=++x>F)x=1;w.col=x;w.cols=F;B=c?!0===c||1===c||"1"===c?!0===y||1===y||"1"===y:f?f[y]!==h?!0:!1:y==c:!y;if("checkboxes"==g.type&&n(g.checking_child_checks_parents)){var E="";A&&(E+="if (this.checked) { for (var cb in "+JSON.stringify(C)+") { get('"+u(d)+"___' + cb).checked = true; } } ");
p[y]&&(E+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");E?e.onchange=g.onchange?E+" "+g.onchange:E:g.onchange?e.onchange=g.onchange:delete e.onchange}else"checkboxes"==g.type&&n(g.checking_parent_checks_children)&&(E="",p[y]&&(E+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),E?e.onchange=g.onchange?E+" "+g.onchange:E:g.onchange?e.onchange=g.onchange:delete e.onchange);w.lovId=d+"___"+
y;w.lovField=r;g.indeterminates&&n(g.indeterminates[y])&&function(b){a.after(function(){var a;if(a=k(b))a.indeterminate=!0})}(w.lovId);w.lovHTML=this.drawField(a,b,d,!0,y,e,B,!1,m,v,p,r);w.childrenHTML="";p[y]&&(w.childrenHTML=this.hierarchicalBoxes(a,b,d,c,g,e,f,m,v,p,y,_.extend({},C),D+1),x=0);q+=s.microTemplate("zenario_admin_box_radio_or_checkbox",w)}}D&&(q+="</div>");return q};f.drawPickedItems=function(a,b,d,c){c===h&&(c=this.tuix.tab);var g=this.tuix.tabs[c].fields[a],e=!1,f,m=this.value(a,
c,b),k=this.pickedItemsArray(g,m);c=g.upload&&n(g.upload.reorder_items);var p=1*g.cols||1,u=0;for(f in k)if(t(k,f)){e=!0;break}if(e){var e=[],C=[];if(c)for(f in m=m.split(","),m)t(m,f)&&C.push([m[f],k[m[f]]]);else{for(f in k)t(k,f)&&C.push([f,k[f]]);C.sort(s.sortArray)}for(f=0;f<C.length;++f){var k=C[f][0],m=C[f][1],D=k==1*k,F,x,q=g.values&&_.isObject(g.values[k])&&g.values[k]||{},q={id:a,item:k,label:m,first:0==f,last:f==C.length-1,readOnly:b,tempReadOnly:d,css_class:q.css_class,list_image:q.list_image};
if(q.newRow=++u>p)u=1;q.col=u;q.cols=p;g.tag_colors&&(q.tag_color=g.tag_colors[k]||"blue");!g.pick_items||g.upload&&!D||!(x=g.pick_items.path)||x!=g.pick_items.target_path&&g.pick_items.min_path!=g.pick_items.target_path||(x="//"==v.rightHandedSubStr(x,2)?x+k:"/"==v.rightHandedSubStr(x,1)?x+("/"+k):x+("//"+k),q.organizerPath=x);g.upload&&(q.isUpload=!0,F=(F=(""+m).match(/(.*?)\.(\w+)$/)||(""+m).match(/(.*?)\.(\w+) \[.*\]$/))&&F[2]?F[2].toLowerCase():"unknown",q.extension=F,D=D?I+"zenario/file.php?id="+
k:I+"zenario/file.php?getUploadedFileInCacheDir="+encodeURIComponent(k),F.match(/gif|jpg|jpeg|png|svg/)?(q.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+D+"&popout=1&dummy_filename="+encodeURIComponent("image."+F)+"', '"+m+"');",src:D+"&og=1"},(m=(""+m).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&m[1]&&m[2]&&s.resizeImage(m[1],m[2],180,120,q.thumbnail)):q.adminDownload=D+"&adminDownload=1",c&&(q.first||(q.nudgeUp={onclick:this.globalName+".nudge('"+K(a)+"', "+(f-1)+
", "+f+");"}),q.last||(q.nudgeDown={onclick:this.globalName+".nudge('"+K(a)+"', "+f+", "+(f+1)+");"})));b||g.pick_items&&n(g.pick_items.hide_remove_button)||(q.removeButton={onclick:this.globalName+".removePickedItem('"+K(a)+"', '"+K(k)+"');"});e.push(q)}}else e={readOnly:b,tempReadOnly:d,noItemSelected:!0,nothing_selected_phrase:A(g.pick_items&&g.pick_items.nothing_selected_phrase,B.nothing_selected)};return s.microTemplate(this.mtPrefix+"_picked_item",e)};f.showPickedItemInPopout=function(a,b){s.action(this,
{popout:{href:a,title:b,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){if(!this.tuix.tabs[this.tuix.tab]||!this.tuix.tabs[this.tuix.tab].fields[a])return!1;var b=this.tuix.tabs[this.tuix.tab].fields[a],d,c;if(!(b.pick_items&&b.pick_items.path&&b.pick_items.min_path&&b.pick_items.target_path))return!1;c=b.pick_items.path;n(b.pick_items.multiple_select)||c!=b.pick_items.target_path&&b.pick_items.min_path!=b.pick_items.target_path||!(d=this.readField(a))||-1!=d.indexOf(",")||
(c="//"==v.rightHandedSubStr(c,2)?c+d:"/"==v.rightHandedSubStr(c,1)?c+("/"+d):c+("//"+d));this.SKTarget=a;s.organizerSelect(this.globalName,"setPickedItems",b.pick_items.multiple_select,c,b.pick_items.target_path,b.pick_items.min_path,b.pick_items.max_path,b.pick_items.disallow_refiners_looping_on_min_path,h,b.pick_items.one_to_one_choose_phrase,b.pick_items.one_to_many_choose_phrase,h,!0,h,h,h,h,h,h,h,h,b.pick_items)};f.setPickedItems=function(a,b,d,c){a=this.SKTarget;var g,e,f={};for(g in b._items)t(b._items,
g)&&(d=v.decodeItemIdForOrganizer(g),e=c.items&&c.items[d]||{},f[d]={list_image:e.list_image,css_class:e.css_class||c.item&&c.item.css_class,label:s.formatOrganizerItemName(c,d)});this.addToPickedItems(f,a)};f.addToPickedItems=function(a,b,d){d||(d=this.tuix.tab);d=this.tuix.tabs[d].fields[b];var c=d.current_value===h?d.value:d.current_value,g,e,f;if(_.isString(a))for(g in f=a.split(","),a={},f)t(f,g)&&(e=f[g],a[e]=e);c=n(d.pick_items.multiple_select)&&c?this.pickedItemsArray(d,c):{};for(e in a)if(t(a,
e)&&(g=a[e],d.values||(d.values={}),d.values[e]||(d.values[e]=g),c[e]=!0,!n(d.pick_items.multiple_select)))break;this.redrawPickedItems(b,d,c)};f.removePickedItem=function(a,b){var d=this.tuix.tabs[this.tuix.tab].fields[a],c=d.current_value===h?d.value:d.current_value,c=c.split(","),g;for(g in c)if(t(c,g)&&c[g]==b){c.splice(g,1);break}c=c.join(",");this.redrawPickedItems(a,d,c)};f.nudge=function(a,b,d){b*=1;d*=1;var c=this.tuix.tabs[this.tuix.tab].fields[a],g=c.current_value===h?c.value:c.current_value,
g=g.split(",");if(g[b]!==h&&g[d]!==h){var e=g[b];g[b]=g[d];g[d]=e}g=g.join(",");this.redrawPickedItems(a,c,g)};f.redrawPickedItems=function(a,b,d){"object"==typeof d&&(d=this.pickedItemsValue(d));b.current_value=d;k("name_for_"+a).innerHTML=this.drawPickedItems(a);this.fieldChange(a)};f.changes=function(a){if(this.tuix&&this.tuix.tab){if(a==h){for(a in this.tuix.tabs)if(t(this.tuix.tabs,a)&&this.changed[a])return!0;return!1}return this.changed[a]}return!1};f.markAsChanged=function(a){this.tuix&&(a===
h&&(a=this.tuix.tab),a&&(this.changed[a]||(this.changed[a]=!0),this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,b){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields[a]){var d=this,c=this.tuix.tab,g=this.tuix.tabs[c].fields[a];g.indeterminate&&(g.indeterminate=!1);b!==h&&g.indeterminates&&g.indeterminates[b]&&(g.indeterminates[b]=!1);this.markAsChanged(c);n(g.multiple_edit)&&this.meMarkChanged(a);setTimeout(function(){d.validateFormatOrRedrawForField(g)},
1)}};f.validateFormatOrRedrawForField=function(a){"object"!=typeof a&&(a=this.tuix.tabs[this.tuix.tab].fields[a]);var b=n(a.validate_onchange),d=n(a.format_onchange);a=n(a.redraw_onchange);if(b=b||this.errorOnTab(this.tuix.tab)&&(d||a))return this.validate(),!0;if(d)return this.format(),!0;a&&(this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,b,d){if(b===h||b!=d)this.tuix.tabs[this.tuix.tab].fields[a].multiple_edit._changed=!0,this.meSetCheckbox(a,!0)};f.meSetCheckbox=function(a,
b){"checkbox"==k("multiple_edit__"+a).type?k("multiple_edit__"+a).checked=b:k("multiple_edit__"+a).value=b?1:""};f.meChange=function(a,b,d){if(a)this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=!0;else{if(!d&&n(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.warn_when_abandoning_changes)&&this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value!==h&&this.readField(b)!=this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.original_value){d='<input type="button" class="submit_selected" value="'+
B.abandonChanges+'" onclick="'+this.globalName+".meChange(false, '"+u(b)+'\', true);"/><input type="button" class="submit" value="'+B.cancel+'"/>';s.floatingBox(B.abandonChangesConfirm,d,"warning");this.meSetCheckbox(b,!0);return}this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit._changed=!1;delete this.tuix.tabs[this.tuix.tab].fields[b].current_value;d=this.tuix.tabs[this.tuix.tab].fields[b];var c=d.value;d.multiple_edit.original_value!==h&&(c=this.tuix.tabs[this.tuix.tab].fields[b].current_value=
d.multiple_edit.original_value);k(b)&&!d.pick_items?"checkbox"==k(b).type?k(b).checked=c?!0:!1:$(k(b)).val(A(c,"","")):(d=new v.callback,c=this.drawFields(d),this.insertHTML(c,d))}n(this.tuix.tabs[this.tuix.tab].fields[b].multiple_edit.disable_when_unchanged)&&(k(b)&&(k(b).disabled=!a),$(".control_for__"+b).each(function(b,c){c.disabled=!a;"button"==c.type&&(a?$(c).removeClass("submit_disabled"):$(c).addClass("submit_disabled"))}));this.meSetCheckbox(b,a);this.validateFormatOrRedrawForField(b)};f.currentValue=
function(a,b,d){return d||b!=this.tuix.tab?this.value(a,b,d):this.readField(a)};f.value=function(a,b,d,c){b||(b=this.tuix.tab);a=this.tuix.tabs[b].fields[a];d===h&&(d=!this.editModeOn(b));return!a||a.snippet||"grouping"==a.type?h:c||"submit"!=a.type&&"toggle"!=a.type?d||a.current_value===h?a.value!==h?a.value:a.multiple_edit&&a.multiple_edit.original_value!==h?a.multiple_edit.original_value:h:a.current_value:a.pressed};f.isFormField=function(a){return!(!a||a.snippet||"grouping"==a.type||"submit"==
a.type||"toggle"==a.type)};f.readField=function(a){var b=h,d=this.tuix.tab,c=this.tuix.tabs[d].fields[a],g;if(!this.isFormField(c))return h;var e=!this.editModeOn()||n(c.read_only),f=this.tuix.tabs[d].fields[a]._was_hidden_before;c.multiple_edit&&e&&delete this.tuix.tabs[d].fields[a].multiple_edit._changed;if("checkboxes"==c.type||"radios"==c.type){if(!e&&!f&&c.values){var m,f="",s=!0;for(m in c.values)t(c.values,m)&&k(a+"___"+m)&&k(a+"___"+m).checked&&(f+=(s?"":",")+m,s=!1);c.current_value=f}f=!0}else if(c.pick_items||
c.upload)f=!0;if(f)return e||c.current_value===h?c.value:c.current_value;if(k("_value_for__"+a))this.tuix.tabs[d].fields[a].current_value=b=k("_value_for__"+a).value;else if("editor"!=c.type&&"code_editor"!=c.type||e)if(!e&&(g=k(a))){if("checkbox"==c.type||"radio"==c.type)b=g.checked?!0:!1;else if("color_picker"==c.type||"colour_picker"==c.type)try{b=$(g).spectrum("get").toHexString()}catch(p){b=$(g).val()}else b=$(g).val();this.tuix.tabs[d].fields[a].current_value=b}else delete this.tuix.tabs[d].fields[a].current_value,
b=c.value;else if(b=h,"editor"==c.type?L.tinyMCE&&tinyMCE.get(a)&&(b=v.tinyMCEGetContent(tinyMCE.get(a))):"code_editor"==c.type&&(g=ace.edit(a))&&(b=g.getValue()),b!==h&&!1!==b)b=this.tuix.tabs[d].fields[a].current_value=b;else return c.current_value===h?c.value:c.current_value;return b};f.blankField=function(a){var b=this.tuix.tab;k(a)&&$(k(a)).val("");k("_value_for__"+a)&&(k("_value_for__"+a).value="");this.tuix.tabs[b].fields[a].current_value=""};f.readTab=function(){var a=this.tuix.tab,b,d={};
this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(var c in this.tuix.tabs[a].fields)t(this.tuix.tabs[a].fields,c)&&(b=this.readField(c))!==h&&(d[c]=b);J&&J.activeElement&&(this.lastFieldInFocus=J.activeElement.id);return d};f.wipeTab=function(){var a=this.tuix.tab,b;for(b in this.tuix.tabs[a].fields)t(this.tuix.tabs[a].fields,b)&&(delete this.tuix.tabs[a].fields[b].current_value,this.tuix.tabs[a].fields[b].multiple_edit&&delete this.tuix.tabs[a].fields[b].multiple_edit._changed)};f.redrawTab=
function(){this.tuix.shake=!1;this.draw2()};f.getURL=function(a){++this.onKeyUpNum;return this.returnAJAXURL(a)};f.returnAJAXURL=function(a){return"..."};f.editModeOn=function(a){if(!this.tuix||!this.tuix.tabs)return!1;a||(a=this.tuix.tab);return this.tuix.tabs[a].edit_mode?this.tuix.tabs[a].edit_mode.on=n(this.tuix.tabs[a].edit_mode.enabled)&&(n(this.tuix.tabs[a].edit_mode.on)||this.editModeAlwaysOn(a)):!1};f.editModeAlwaysOn=function(a){return this.tuix.tabs[a].edit_mode.always_on===h||n(this.tuix.tabs[a].edit_mode.always_on)||
this.savedAndContinued(a)};f.editCancelEnabled=function(a){return this.tuix.tabs[a].edit_mode&&n(this.tuix.tabs[a].edit_mode.enabled)&&!this.editModeAlwaysOn(a)};f.revertEnabled=function(a){return this.tuix.tabs[a].edit_mode&&n(this.tuix.tabs[a].edit_mode.enabled)&&this.editModeAlwaysOn(a)&&!this.savedAndContinued(a)&&(this.tuix.tabs[a].edit_mode.enable_revert===h&&this.tuix.key&&this.tuix.key.id||n(this.tuix.tabs[a].edit_mode.enable_revert))};f.savedAndContinued=function(a){return this.tuix.tabs[a]._saved_and_continued};
f.editModeOnBox=function(){if(this.tuix&&this.tuix.tabs&&this.sortedTabs)for(var a in this.sortedTabs)if(t(this.sortedTabs,a)&&this.editModeOn(this.sortedTabs[a]))return!0;return!1};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(t(this.tuix.tabs,a)){var b=this.tuix.tabs[a];b&&this.sortedTabs.push([a,b.ord])}this.sortedTabs.sort(s.sortArray);this.sortedFields={};for(a in this.sortedTabs)t(this.sortedTabs,a)&&(b=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(b))};
f.sortFields=function(a){var b,d,c,g,e={};this.sortedFields[a]=[];if(c=this.tuix.tabs[a].fields){for(b in c)t(c,b)&&(d=c[b],d.type&&"grouping"==d.type&&(e[d.name||b]=1*d.ord));for(b in c)t(c,b)&&(!(d=c[b])||d.type&&"grouping"==d.type||(g=d.grouping?e[d.grouping]:h,this.sortedFields[a].push([b,d.ord,g])));this.sortedFields[a].sort(s.sortArrayWithGrouping);for(b in this.sortedFields[a])t(this.sortedFields[a],b)&&(this.sortedFields[a][b]=this.sortedFields[a][b][0])}};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};
f.getValueArrayofArrays=function(a){return v.nonAsyncAJAX(this.getURL(),v.urlRequest({_read_values:!0,_box:this.sendStateToServer()}),!a)};f.getValues1D=function(a,b,d){var c,g,e,f,h={};if(this.tuix&&this.tuix.tabs)for(c in this.tuix.tabs)if(t(this.tuix.tabs,c)&&(g=this.tuix.tabs[c],g.fields))for(e in g.fields)if(t(g.fields,e)){f=g.fields[e];if(a){if(f=f.plugin_setting&&f.plugin_setting.name)h[f]=this.currentValue(e,c,d)}else h[e]=this.currentValue(e,c,d);b&&(h[c+"/"+e]=h[e])}return h};f.callFunctionOnEditors=
function(a){if(this.tuix&&this.tuix.tab&&this.tuix.tabs[this.tuix.tab]&&this.tuix.tabs[this.tuix.tab].fields&&L.tinyMCE)for(var b in this.tuix.tabs[this.tuix.tab].fields)if(t(this.tuix.tabs[this.tuix.tab].fields,b)&&"editor"==this.tuix.tabs[this.tuix.tab].fields[b].type&&tinyMCE.get(b))if("remove"==a)tinyMCE.get(b).remove();else if("isDirty"==a&&tinyMCE.get(b).isDirty())return!0;return!1};f.validateAlias=function(){var a=this;v.actAfterDelayIfNotSuperseded("validateAlias",function(){a.validateAliasGo()})};
f.validateAliasGo=function(){var a={_validate_alias:1,alias:k("alias").value};this.tuix.key.cID&&(a.cID=this.tuix.key.cID);this.tuix.key.cType&&(a.cType=this.tuix.key.cType);this.tuix.key.equivId&&(a.equivId=this.tuix.key.equivId);k("language_id")&&(a.langId=k("language_id").value);k("update_translations")&&(a.lang_code_in_url="show","update_this"==k("update_translations").value&&k("lang_code_in_url")&&(a.lang_code_in_url=k("lang_code_in_url").value));$.post(I+"zenario/admin/quick_ajax.php",a,function(a){if(!(a=
s.readData(a)))return!1;var d="";if(a)for(var c in a)t(a,c)&&(d+=(d?"<br />":"")+a[c]);k("alias_warning_display").innerHTML=d},"text")};f.generateAlias=function(a){return a.toLowerCase().replace(/[\u00e1\u00c1\u00e0\u00c0\u00e2\u00c2\u00e5\u00c5\u00e4\u00c4\u00e3\u00c3\u00c6\u00e6\u00e7\u00c7\u00f0\u00d0\u00e9\u00c9\u00e8\u00c8\u00ea\u00ca\u00eb\u00cb\u00ed\u00cd\u00ec\u00cc\u00ee\u00ce\u00ef\u00cf\u00f1\u00d1\u00f3\u00d3\u00f2\u00d2\u00f4\u00d4\u00f6\u00d6\u00f5\u00d5\u00f8\u00d8\u0161\u0160\u00fa\u00da\u00f9\u00d9\u00fb\u00db\u00fc\u00dc\u00fd\u00dd\u017e\u017d]/g,
function(a){return{"\u00e1":"a","\u00c1":"a","\u00e0":"a","\u00c0":"a","\u00e2":"a","\u00c2":"a","\u00e5":"a","\u00c5":"a","\u00e4":"a","\u00c4":"a","\u00e3":"a","\u00c3":"a","\u00c6":"ae","\u00e6":"ae","\u00e7":"c","\u00c7":"c","\u00f0":"d","\u00d0":"d","\u00e9":"e","\u00c9":"e","\u00e8":"e","\u00c8":"e","\u00ea":"e","\u00ca":"e","\u00eb":"e","\u00cb":"e","\u00ed":"i","\u00cd":"i","\u00ec":"i","\u00cc":"i","\u00ee":"i","\u00ce":"i","\u00ef":"i","\u00cf":"i","\u00f1":"n","\u00d1":"n","\u00f3":"o",
"\u00d3":"o","\u00f2":"o","\u00d2":"o","\u00f4":"o","\u00d4":"o","\u00f6":"o","\u00d6":"o","\u00f5":"o","\u00d5":"o","\u00f8":"o","\u00d8":"o","\u0161":"s","\u0160":"s","\u00fa":"u","\u00da":"u","\u00f9":"u","\u00d9":"u","\u00fb":"u","\u00db":"u","\u00fc":"u","\u00dc":"u","\u00fd":"y","\u00dd":"y","\u017e":"z","\u017d":"z"}[a]}).replace(/&/g,"and").replace(/[^a-z0-9\s_-]/g,"").replace(/\s+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/-+/g,"-").substr(0,50)};f.contentTitleChange=function(){var a=
k("menu_title"),b=k("alias");a&&!this.tuix.___menu_title_changed&&(a.value=k("title").value.replace(/\s+/g," "),a.onkeyup());!b||b.disabled||this.tuix.___alias_changed||(b.value=this.generateAlias(k("title").value),this.validateAlias())};f.viewFrameworkSource=function(){var a=I+"zenario/admin/organizer.php#zenario__modules/show_frameworks//"+this.tuix.key.moduleId+"//"+v.encodeItemIdForOrganizer(this.readField("framework"));L.open(a);return!1};f.adminPermChange=function(a,b,d,c,f){var e=!0;c===h&&
(f=0,c=$("input[name="+b+"]").each(function(a,b){b.checked&&++f}).size());0==f?(e=!1,b="zenario_permgroup_empty"):b=f<c?"zenario_permgroup_half_full":"zenario_permgroup_full";k(a).checked=this.tuix.tabs[this.tuix.tab].fields[a].current_value=e;$(k("row__"+a)).removeClass("zenario_permgroup_empty").removeClass("zenario_permgroup_half_full").removeClass("zenario_permgroup_full").addClass(b);k(d).value=this.tuix.tabs[this.tuix.tab].fields[d].value=this.tuix.tabs[this.tuix.tab].fields[d].current_value=
f+"/"+c};f.adminParentPermChange=function(a,b,d){var c=0,f=0,e="",h=k(a).checked,m=$("input[name="+b+"]"),n;for(n in this.tuix.tabs[this.tuix.tab].fields[b].values)t(this.tuix.tabs[this.tuix.tab].fields[b].values,n)&&(++c,h&&(e+=(e?",":"")+n,++f));m.size()&&m.each(function(a,b){b.checked=h});this.tuix.tabs[this.tuix.tab].fields[b].current_value=e;this.adminPermChange(a,b,d,c,f)};f.previewDateFormat=function(a,b){var d=this;v.actAfterDelayIfNotSuperseded(a,function(){d.previewDateFormatGo(a,b)})};
f.previewDateFormatGo=function(a,b){(a=k(a))&&(b=k(b))&&(b.value=v.moduleNonAsyncAJAX("zenario_common_features",{previewDateFormat:a.value}))}},zenarioAF,"");
