zenario.lib(function(g,da,U,aa,Ga,Ha,r,D,I,ba,Ia,ea,ca,m,p,Ca,G,V,Q,Ja,Da,x,Ea){I.lib(function(na,fa,W,va,oa,pa,qa){var f=Da(Ea);f.init=function(a,d,e){this.globalName=a;this.mtPrefix=d;this.containerId=e;this.baseCSSClass="";this.onKeyUpNum=0;ba.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={};this.fieldThatTriggeredRedraw=this.lastFocus=!1;this.editingPositions={}};f.enableInlineErrors=function(){return!0};f.get=function(a){var d;return this.containerId&&(d=$("#"+
this.containerId+" #"+r._cE(a)))&&d[0]||Ca(a)};f.microTemplate=function(a,d,e){var b=r._aLP(d,this);a=r._mT(a,d,e);b&&r._tLP(d);return a};f.pMicroTemplate=function(a,d,e){return this.microTemplate(this.mtPrefix+"_"+a,d,e)};f.fun=function(a){return this.globalName+"."+a};f.onThisRow=function(a,d){return a+d.r(/(.*_|\D)/g,"")};f.valueOnThisRow=function(a,d){return this.value(this.onThisRow(a,d))};f.fieldOnThisRow=function(a,d){return this.field(this.onThisRow(a,d))};f.getKey=function(a){return this.tuix&&
this.tuix.key};f.getKeyId=function(a){return this.tuix&&this.tuix.key&&this.tuix.key.id};f.getLastKeyId=function(a){return this.getKeyId(a)};f.getTitle=function(){var a,d;if(this.tuix.key&&this.tuix.key.id&&(a=this.tuix.title_for_existing_records)){d=this.getValues1D(!1,g,!0);for(c in d)if(x(d,c)&&(v=d[c],-1!=a.indexOf("[["+c+"]]")))for(;a!=(string2=a.r("[["+c+"]]",v));)a=string2;return a}return this.tuix.title};f.field=function(a,d){return _._isOb(a)?a:(tabs=this.tuix&&this.tuix.tabs)&&(d=d||this.tuix.tab)&&
tabs[d]&&tabs[d].fields&&tabs[d].fields[a]};f.fields=function(a){var d;return(d=this.tuix&&this.tuix.tabs)&&(a=a||this.tuix.tab)&&d[a]&&d[a].fields};f.initFields=function(){var a=this.tuix.tab,d,e,b,k,h,R=this.tuix.lovs||{};if(this.tuix.tabs)for(d in this.tuix.tabs)if(x(this.tuix.tabs,d)&&(b=this.fields(d))){h=!1;for(e in b)x(b,e)&&(k=b[e])&&(k.pick_items&&k.plugin_setting&&k.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(e,this.value(e,d,!1)):k.values&&_._iS(k.values)&&R[k.values]?
k.values=R[k.values]:k.load_values_from_organizer_path&&!k.values&&this.loadValuesFromOrganizerPath(k),k.validation&&m(k.validation.required_if_not_hidden)&&(h=!0));h&&d!=a&&(this.tuix.tab=d,this.drawFields(g,g,!0),this.tuix.tab=a)}};f.loadValuesFromOrganizerPath=function(a){var d,e,b;if(a.load_values_from_organizer_path&&!a.values&&(a.values={},(e=D._gIFO(a.load_values_from_organizer_path))&&e.items))for(d in e.items)x(e.items,d)&&(b=e.items[d],a.values[r._dIIFO(d)]={image:b.image,css_class:b.css_class||
e.item&&e.item.css_class,label:D._fOIN(e,d)})};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};f.editCancelOrRevert=function(a,d){if(this.tuix.tabs[d].edit_mode){var e,b,k,h,R,f;"edit"==a?(R=p(this.tuix.tabs[d].edit_mode.format_on_edit),
f=p(this.tuix.tabs[d].edit_mode.validate_on_edit)):"cancel"==a?(R=p(this.tuix.tabs[d].edit_mode.format_on_cancel_edit),f=p(this.tuix.tabs[d].edit_mode.validate_on_cancel_edit)):"revert"==a&&(R=p(this.tuix.tabs[d].edit_mode.format_on_revert),f=this.errorOnTab(d)||p(this.tuix.tabs[d].edit_mode.validate_on_revert));if(!f&&(b=this.fields(d)))for(k in b)if(x(b,k))if(h=b[k],p(h.validate_onchange)&&m(e=this.readField(k))&&e!=h.value){f=!0;break}else!R&&p(h.format_onchange)&&m(e=this.readField(k))&&e!=h.value&&
(R=!0);this.tuix.tabs[d].edit_mode.on="cancel"!=a;this.changed[d]=!1;f?this.validate(g,g,!0):R?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==d&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&this.validate(a!=this.tuix.tab,a)};f.turnToggleOn=function(a){this.clickButton(a,!0)};f.turnToggleOff=function(a){this.clickButton(a,!1)};f.clickButton=function(a,d){var e;if(e=this.field(a))if("submit"==e.type)e.pressed=!0,this.validate(!0);
else if("toggle"==e.type){var b=$(this.get(a)),k=$(this.get("row__"+a)),h=!!p(e.pressed);if(d===g||d!=h)(e.pressed=!p(e.pressed))?(b.removeClass("not_pressed").addClass("pressed"),k.addClass("zfea_row_pressed")):(b.removeClass("pressed").addClass("not_pressed"),k.removeClass("zfea_row_pressed")),this.markAsChanged(),this.validateFormatOrRedrawForField(e,!0)}else"button"==e.type&&(e.pressed=!0,this.validateFormatOrRedrawForField(e))};f.togglePressed=function(a,d){var e;e=d?1<d?this.toggleLevelsPressed[d-
1]:!0:this.toggleLevelsPressed.last;m(e)||(e=!0);a&&"toggle"==a.type&&(this.toggleLevelsPressed.last=e&&p(a.pressed),d&&(this.toggleLevelsPressed[d]=this.toggleLevelsPressed.last));return e};f.retryAJAX=function(a,d,e,b,k,h){var f=function(){r._a(a,d,e,g,f,!0,g,g,g,g,h).after(b);k&&D.nowDoingSomething&&D._nDS(k)};f()};f.switchToATabWithErrors=function(){var a,d,e=this.tuix;if(e&&e.tabs&&!this.errorOnTab(e.tab))for(a in this.sortedTabs)if(x(this.sortedTabs,a)&&(d=this.sortedTabs[a],e.tabs[d]&&!this.checkTabHidden(d)&&
this.errorOnTab(d)))return e.tab=d,!0;return!1};f.checkTabHidden=function(a){return I._h(g,this,g,a,g,g,g,g,this.tuix.tabs[a])};f.applyMergeFields=function(a,d,e,b){return a};f.applyMergeFieldsToLabel=function(a,d,e,b){return a};f.hideTab=function(a){var d=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){d.tabHidden=!0;d.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled",
"disabled").animate({opacity:0.9},100),d.tabHidden=!0,d.draw())};f.draw=function(){this.loaded&&this.tabHidden&&this.draw2()};f.draw2=function(){};f.size=function(){};f.makeFieldAsTallAsPossible=function(){};f.getNextTab=function(){m(this.prevTab)||m(this.nextTab)||this.drawTabs(" ");return this.nextTab};f.getPrevTab=function(){m(this.prevTab)||m(this.nextTab)||this.drawTabs(" ");return this.prevTab};f.goToNextTab=function(){var a=this.getNextTab();if(m(a))return ba._cT(a),!0};f.goToPrevTab=function(){var a=
this.getPrevTab();if(m(a))return ba._cT(a),!0};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var d,e,b=[],k,h,f,m,w=function(a,b,d){for(b in a)if(x(a,b)){d=a[b];if(d.onclick){h&&(m=d.id);if(h=d.current)f=k;k=d.id}d.children&&w(d.children)}};for(i in this.sortedTabs)if(x(this.sortedTabs,i)&&(tab=this.sortedTabs[i],(d=this.tuix.tabs[tab])&&!(d._was_hidden_before=I._h(g,this,g,tab,g,g,g,g,d)))){e="";if(d.fields&&!_._isEm(d.fields)||d.fields&&!_._isEm(d.errors)||d.fields&&!_._isEm(d.notices))e=this.globalName+
".clickTab('"+V(tab)+"');";!this.tuix.tab&&e&&(this.tuix.tab=tab);b.push({id:tab,tabId:tab,tuix:d,onclick:e,current:this.tuix.tab==tab,label:d.label})}I._sBK(b,"zenario_fab_tab_with_children");w(b);this.prevTab=f;this.nextTab=m;return this.microTemplate(a,b)};f.drawFields=function(a,d,e){var b,k,h,f=this.tuix.tab,E=this.tuix.tabs[f],w=this.groupings[f],t=this.sortedFields[f],l,s="",F=!1,A,r=this.fields(f),q={},y={},H={},B=!1,G,D,J=!1,O={},z={fields:{},rows:[],tabId:f,path:this.path,tuix:this.tuix,
revert:"",errors:[],notices:{}};this.drawingFields=!0;if(!e){this.ffoving=0;this.splitValues={};this.tallAsPossibleField=g;this.errorOnForm=!1;this.disableDragDropUpload();!this.savedAndContinued(f)&&this.editCancelEnabled(f)&&(z.revert=fa("class","zenario_editCancelButton",I._i("class","submit","type","button","onclick",this.globalName+".changeMode(); return false;","value",this.editModeOn()?Q.cancel:Q.edit)));if(this.editModeOn()){if(E.errors)for(A in E.errors)x(E.errors,A)&&(h=E.errors[A],this.errorOnForm=
!0,z.errors.push({message:h}));if(r)for(A in r)if(x(r,A)&&(h=r[A],h.error))if(this.errorOnForm=!0,this.enableInlineErrors()&&(l=this.tuix.error_on_form_message||Q.errorOnForm)){z.errors.push({message:l});break}else z.errors.push({message:h.error})}if(E.notices)for(A in E.notices)x(E.notices,A)&&(h=E.notices[A],p(h.show)&&!I._h(h,this,g,A)&&{error:1,warning:1,question:1,information:1,success:1}[h.type]&&(z.notices[A]=h));this.setPhiVariables()}for(b in t)x(t,b)&&(k=t[b],h=r[k],A=!1,l=h.grouping,G!==
l&&(G=l,J=m(w[l])&&r[w[l]],F=l&&(!J||I._h(g,this,g,w[l],g,g,J))),D!==l&&(A=!0),h._id=k,h._html=this.drawField(a,f,k,h,q,y,H,e,F),e||F||!1===h._html||((A||h._startNewRow||!z.rows.length)&&z.rows.push({fields:[],grouping:J}),A&&J&&(J.legend||J.snippet)&&(J=_._ex({grouping:l},J),J._id=l,J._html=this.drawField(a,f,l,J),J._hideOnOpen=!0,J._showOnOpen=!0,J._lastVisibleGrouping=D,D=l,z.rows[z.rows.length-1].fields.push(J),z.fields[l]=J,O[l]=J,z.rows.push({fields:[]})),B||E.show_errors_after_field!=k||(z.rows[z.rows.length-
1].errors=z.errors,z.rows[z.rows.length-1].notices=z.notices,B=!0),h._lastVisibleGrouping=D,D=l,z.rows[z.rows.length-1].fields.push(h),z.fields[k]=h));for(k in z.fields)x(z.fields,k)&&(h=z.fields[k],l=h.grouping)&&(J=O[l])&&(J._hideOnOpen&=h._hideOnOpen,J._showOnOpen&=h._showOnOpen);e||(z.rows.length&&(z.rows[z.rows.length-1].fields[0]._isLastRow=!0),B||z.rows.splice(0,0,{errors:z.errors,notices:z.notices}),d=d||E.template||this.mtPrefix+"_current_tab",s+=this.microTemplate(d,z));this.drawingFields=
!1;for(b in t)x(t,b)&&(k=t[b],delete r[k]._lastVisibleGrouping,delete r[k]._startNewRow,delete r[k]._hideOnOpen,delete r[k]._showOnOpen,delete r[k]._isLastRow,delete r[k]._html,delete r[k]._id);return s};f.drawTUIX=function(a,d,e){this.tuix={tab:"details",tabs:{details:{template:d,edit_mode:{on:!0,enabled:!0,always_on:!0},fields:a}}};this.sortTabs();return this.drawFields(e)};f.insertHTML=function(a,d,e){var b=this.get("zenario_abtab"),k=this.lastFocus||this.fieldThatTriggeredRedraw,h;b.innerHTML=
a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(b).addClass("zenario_abtab_changed"):$(b).removeClass("zenario_abtab_changed");d.done();(h=!e&&k&&this.field(k.id))&&this.focusField(h,k.ss,k.se);this.fieldThatTriggeredRedraw=!1};f.hideShowFields=function(a){var d=$(".zenario_hide_on_open"),e=$(".zenario_hide_row_on_open"),b=$(".zenario_show_on_open"),k=function(a,b){b.style.display="none"};b.length&&!d.length?b.show("blind",200,a):!b.length&&d.length?d.hide("blind",200,function(){e.each(k)}):b.length&&
d.length&&(d.each(k),e.each(k),b.show())};f.isAdminFacing=function(){return!0};f.addJQueryElements=function(a){var d=this;r._aJQE(a+" ",d.isAdminFacing());$(a+" select.iconselectmenu").css("visibility","hidden").each(function(a,b){var k=$(b);k.attr("id");k.iconselectmenu({width:"auto",open:function(){$("body > .ui-selectmenu-menu").addClass("iconselectmenu__"+k.attr("id")).addClass("iconselectmenu__in__"+d.path)},change:function(){$(this).change()}})})};f.fieldIsReadonly=function(a,d,e){return d.show_as_a_label||
d.show_as_a_span||p(d.read_only)||p(d.readonly)||m(e)&&!this.editModeOn(e)||m(d.readonly_if)&&I._e(d.readonly_if,this,d,g,a,g,g,d)};f.focusFirstField=function(){var a=this;if(a.tuix&&!p(a.tuix.tabs[a.tuix.tab].disable_autofocus)){var d=-1,e=[],b=g,k,h,f,m,w;for(k in a.sortedFields[a.tuix.tab])if(x(a.sortedFields[a.tuix.tab],k)&&(m=a.sortedFields[a.tuix.tab][k],(h=a.get(m))&&(f=a.field(m))&&((w=f.pick_items||f.upload)||$(h).is(":visible"))&&(e[++d]={id:m,type:f.type,empty:""==h.value,focusable:(w||
r.IN(f.type,"password","checkbox","select","text","textarea"))&&!p(h.disabled)&&!p(h.readonly)&&!a.fieldIsReadonly(m,f)},1<d)))break;if(e[0]&&!e[0].empty&&e[1]&&e[1].focusable&&e[1].empty&&"password"==e[1].type)b=1;else if(e[0]&&e[0].focusable)b=0;else if(e[1]&&e[1].focusable)b=1;else return;setTimeout(function(){a.focusField(e[b])},50)}};f.focusField=function(a,d,e){if(a.type){if("date"==a.type||"datetime"==a.type)return;a=this.get(a.id)}else a=this.$getPickItemsInput(a.id);if(a&&(a.focus(),m(d)))try{a.selectionStart=
d,a.selectionEnd=e}catch(b){}};f.$getPickItemsInput=function(a){return $(this.get("name_for_"+a)).find(".TokenSearch input")};f.setPhiVariables=function(){r.phiVariables=g};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(x(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var d;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(d in this.tuix.tabs[a].errors)if(x(this.tuix.tabs[a].errors,d))return!0;if(a=this.fields(a))for(d in a)if(x(a,
d)&&a[d].error)return!0}};f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var d in this.tuix.tabs)if(x(this.tuix.tabs,d)){a=this.tuix.tabs[d];var e=this.editModeOn(d);if(a.fields)for(var b in a.fields)if(x(a.fields,b)){var k=a.fields[b];this.isFormField(k)&&("code_editor"==k.type&&r._cAD("code_editor_"+b),m(k.current_value)||(k.current_value=this.value(b,d,!0)),e&&(m(k.value)||(k.value=this.value(b,d,!1)),k.multiple_edit&&!m(k.multiple_edit._changed)&&m(k.multiple_edit.changed)&&(k.multiple_edit._changed=
k.multiple_edit.changed)))}}U&&U.activeElement&&(this.lastFocus=this.setLastFocus(U.activeElement))};f.setLastFocus=function(a){var d;"object"===typeof a?(d=a,a=d.id):d=this.get(a);a={id:a};if(d)try{a.ss=d.selectionStart,a.se=d.selectionEnd}catch(e){a.ss=a.se=g}return a};f.enableMicroTemplates=function(a,d){var e=this,b;for(b in d)if(x(d,b))switch(typeof d[b]){case "object":"lib"!==b&&"thus"!==b&&"tuix"!==b&&e.enableMicroTemplates(a,d[b]);break;case "string":"type"===b||"value"===b&&e.isFormField(d)||
"current_value"===b||!d[b].m(/(\{\{|\{\%|\<\%)/)||function(a,b,d){d=r._gMT("<% "+e.defineLibVarBeforeCode()+" %>"+a[b],g);a[b]=function(){return d(a)}}(d,b)}};f.displayAsTag=function(a,d){return a.show_as_a_label||d&&a.show_as_a_label_when_readonly?"label":a.show_as_a_span||d&&a.show_as_a_span_when_readonly?"span":!1};f.drawField=function(a,d,e,b,k,h,f,E,w,t,l,s,F,A,X){var q=this;m(b)||(b=q.field(e,d));m(b.id)||(b.id=e);p(b.enable_microtemplates_in_properties)&&q.enableMicroTemplates(b,b);var y=b.type,
H=b.upload,B=b.pick_items,ra=b.disabled,N=b.validation||{},J="date"==y||"datetime"==y,O,z,K,P,C,S,n="",L,U,M={},ga="multiselect"==y,ka=!1,u={"class":""},Y={},ha={},ba=!1,Z=!1,ca,ia=!1,ea=!1,wa=!1,xa=!1,ya=!1,za=!1,sa=!1,ta=!1,la,ma,ja=q.tuix.tabs[d];m(s)||(s=q.fieldIsReadonly(e,b,d));B&&ra&&(s=!0);y&&"datetime"==y&&(s=!0);X?m(X.disabled_if)&&I._e(X.disabled_if,q,X,g,t,g,g,b)&&(s=!0):m(b.disabled_if)&&I._e(b.disabled_if,q,g,g,e,g,g,b)&&(s=!0);!b["class"]&&b.css_class&&(b["class"]=b.css_class);b.snippet||
m(l)||(l=q.value(e,d));m(l)||(l="");if(!m(t)){delete b.selected_option;if(l&&b.values)if(K=_._isOb(b.values)?b.values[l]:q.tuix.lovs&&q.tuix.lovs[b.values]&&q.tuix.lovs[b.values][l],_._isOb(K)&&I._h(K,q,g,l,g,g,b,g,ja)&&(K=!1),K)b.selected_option=K;else if("radio"==y||"select"==y)b.current_value=l="";(H||B||ga)&&""!=l&&(M=q.pickedItemsArray(b,l));b.values&&_._iS(b.values)&&q.tuix.lovs&&q.tuix.lovs[b.values]?b.values=q.tuix.lovs[b.values]:b.load_values_from_organizer_path&&!b.values&&q.loadValuesFromOrganizerPath(b);
for(P in b)x(b,P)&&"<"==P[0]&&(ca=P.m(/^<(\/?)(\w+)/))&&(b[P]&&_._iS(b[P])&&(P+=b[P]),L={table:1,tr:2,td:3,th:4,br:5,div:6,p:7,span:8}[ca[2]]||9,5>L&&(za=!0),ca[1]?(ta||(ta=!0,ma="        ".split(" ")),ma[9-L]+=P):(sa||(sa=!0,la="        ".split(" ")),la[L-1]+=P,1==L&&(ya=!0),5==L&&(xa=!0)))}E||"button"!=y&&"submit"!=y||(b.pressed=!1);if(E||!m(t)){P=m(b.same_row)?!p(b.same_row):!xa&&(ya||!za);b._startNewRow=P;K=1*b.indent||0;O=w||I._h(g,q,g,e,g,g,b)||s&&b.hide_when_readonly||p(h&&h.last?b.hide_with_previous_field:
b.hide_if_previous_field_is_not_hidden)||p(h&&h.beforeLast?b.hide_with_previous_previous_field:b.hide_if_previous_previous_field_is_not_hidden)||p(b.hide_with_previous_indented_field)&&h&&h[K]||p(b.hide_with_previous_outdented_field)&&0<K&&h&&h[K-1]||p(b.hide_with_previous_indented_fields)&&!k[K]||m(b.hide_if_previous_value_isnt)&&!r._iL(b.hide_if_previous_value_isnt,f&&f.last)||m(b.hide_if_previous_outdented_value_isnt)&&0<K&&!r._iL(b.hide_if_previous_outdented_value_isnt,f&&f[K-1]);f&&(f.last=l,
P&&(f[K]=l));h&&(h.beforeLast=h.last,h.last=O,P&&(h[K]=O),m(k.last)&&k.last===K||(k.last<K&&(k[K]=!1),k.last=K),O||(k[K]=!0));b._startNewRow&&!1!==q.shownTab&&q.shownTab==q.tuix.tab&&"editor"!=y&&"code_editor"!=y&&b._was_hidden_before&&!O?b._showOnOpen=!0:b._startNewRow&&!1!==q.shownTab&&q.shownTab==q.tuix.tab&&"editor"!=y&&"code_editor"!=y&&!b._was_hidden_before&&O&&(b._hideOnOpen=z=!0,b._was_hidden_before=!0);if(O){if(b._was_hidden_before=!0,!z)return!1}else delete b._was_hidden_before;if(E)return;
O||!b.tall_as_possible||m(q.tallAsPossibleField)||(q.tallAsPossibleField=e,q.tallAsPossibleFieldType=b.type);b.multiple_edit&&(k="",h=!s&&m(b.multiple_edit._changed)?p(b.multiple_edit._changed):b.multiple_edit.changed,p(b.multiple_edit.hide_ui)||!b.multiple_edit.select_list?(f=p(b.multiple_edit.hide_ui),k+=W("type","checkbox","class","multiple_edit","id","multiple_edit__"+e,"checked",h,"style",f?"display: none;":"","disabled",s,"onchange",s||f?"":q.globalName+".meChange(this.checked, '"+G(e)+"');",
">")):k+=va("class","multiple_edit","id","multiple_edit__"+e,"disabled",s,"onchange",q.globalName+'.meChange(this.value == 1, "'+V(e)+'");',oa("value","","selected",!h,b.multiple_edit.select_list.not_changed_label||Q.notChanged)+oa("value",1,"selected",h,b.multiple_edit.select_list.changed_label||Q.changed)),n+=k,k=g)}if(!(F&&A||"object"!=typeof b.values))if(F=[],A={},H&&p(H.reorder_items)||B&&p(B.reorder_items))for(L in k=l.s(","),k)x(k,L)&&(C=k[L],F.push(C));else{for(C in b.values)x(b.values,C)&&
(k=b.values[C],"object"==typeof k?(m(k.parent)&&(Z=!0,A[k.parent]=!0),I._h(k,q,g,C,g,g,b,g,ja)||b.values_visible_if&&!I._e(b.values_visible_if,q,k,g,C,g,g,b,g,ja)||(m(k.ord)?F.push([C,k.ord]):m(k.label)?F.push([C,k.label]):F.push([C,C]))):F.push([C,k]));F.sort(I.sortArray);for(L in F)x(F,L)&&(F[L]=F[L][0])}if(s)u.readonly=!0,q.isButton(b)&&(u.disabled=!0,u["class"]+="disabled ");else if(b.error&&(u["class"]+="zenario_field_with_error "),N.required||N.required_if_not_hidden)u["class"]+="zenario_required_field ";
if("checkboxes"!=y&&(S=q.displayAsTag(b,s))){F=G(l);if("select"==y||"radios"==y)b.values&&b.values[l]?F=G(b.values[l]):b.empty_value&&(F=G(b.empty_value));n+=na(S,"id",S+"__"+e,"class",b.css_class,F)}else if(C=b.snippet){for(U in Aa)S=Aa[U],C[S]&&(n+=na(S,"id",S+"__"+e,"class",C[S+"_class"],"style",C[S+"_style"],G(C[S])));!O&&C.show_split_values_from&&q.splitValues&&q.splitValues[C.show_split_values_from]&&(n+=q.splitValues[C.show_split_values_from],delete q.splitValues[C.show_split_values_from]);
C.html&&(n+=pa("id","snippet__"+e,r._un(C.html)));C.microtemplate&&(n+=fa("id","microtemplate__"+e,q.microTemplate(C.microtemplate,b)));C.url&&(n=p(C.cache)?q.cachedAJAXSnippets[C.url]?n+q.cachedAJAXSnippets[C.url]:n+(q.cachedAJAXSnippets[C.url]=r._nAA(r._aBP(C.url))):n+r._nAA(r._aBP(C.url)))}else if(("checkboxes"==y||"radios"==y)&&!m(t))s&&b.display_as_text_when_readonly?n+=G(q.displaySelectedItems(e,b,l,d)):b.values&&(Z=_._ex({},b),M=q.pickedItemsArray(b,l),Z.name=b.name||e,Z.type="checkboxes"==
y?"checkbox":"radio",s&&(Z.disabled=!0),n=_._isEm(F)?n+qa("class","zenario_no_values_message",G(b.no_values_message)):n+q.hierarchicalBoxes(a,d,e,l,b,Z,s,M,F,A));else if(H||B||ga){var Ba=ga||B&&p(B.multiple_select)||H&&p(H.multi);l={id:e,pickerHTML:"",wrappedId:"name_for_"+e,readOnly:s};s||(B&&(B.target_path||B.path)&&!p(B.hide_select_button)&&(l.select={onclick:q.globalName+".pickItems('"+G(e)+"');",phrase:B.select_phrase||Q.selectDotDotDot}),H&&(l.upload={onclick:q.globalName+".upload('"+G(e)+"');",
phrase:H.upload_phrase||Q.uploadDotDotDot},p(H.drag_and_drop)&&q.upload(e,!0),aa.Dropbox&&Dropbox.isBrowserSupported()&&(l.dropbox={onclick:q.globalName+".chooseFromDropbox('"+G(e)+"');",phrase:H.dropbox_phrase||Q.dropboxDotDotDot})));l.pickerHTML+=va("id",e,"multiple",Ba,"class",b.css_class,"style",b.style,">");!b.values||_._isEm(M)&&!ga||(l.pickerHTML+=q.hierarchicalSelect(M,b,ja,F,Z,A));l.pickerHTML+="</select>";n+=q.microTemplate(q.mtPrefix+"_picked_items",l);a.after(function(){ga?q.setupMultipleSelect(b,
e,d,s||ra):q.setupPickedItems(b,e,d,s,Ba)})}else if(b.captcha)n+=W("type","hidden","style","display: none","id",e,"value",l),l||(n+=pa("style","display: inline-block","id","captcha__"+e),a.after(function(){grecaptcha.render("captcha__"+e,_._ex({sitekey:google_recaptcha.sitekey,callback:function(a){q.get(e).value=a}},b.captcha))}));else if(y){Y.onchange=t?"lib.fieldChange('"+G(e)+"', '"+G(t)+"');":"lib.fieldChange('"+G(e)+"');";ra&&(u["class"]+="disabled ");N.numeric&&(u.onkeyup=(u.onkeyup||"")+"lib.keepNumeric(this)");
b.return_key_presses_button&&!s&&(u.onkeyup=(u.onkeyup||"")+"if (event.keyCode == 13) {zenario._st(event);$('#"+G(b.return_key_presses_button)+"').click();return false;}");p(b.multiple_edit)&&!s&&(u.onkeyup=(u.onkeyup||"")+"if (event && event.keyCode == 9) return true; lib.meMarkChanged('"+G(e)+"', this.value, '"+G(b.value)+"');");u["class"]+="input_"+y;switch(y){case "select":b.slider&&(ka=!0,n+=q.drawSlider(a,e,b,s,!0));s&&(u.disabled=!0);n+="<select";break;case "code_editor":n+="<div";u["class"]=
" zenario_embedded_ace_editor";a.after(function(){var a=ace.edit(e),k=!1;a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);s&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));p(b.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.on("blur",function(a){k&&r._aADINS("code_editor_"+e,function(){q.fieldChange(e)},0);k=!1});a.on("change",function(a){q.markAsChanged();k=!0;r._aADINS("code_editor_"+e,function(){q.fieldChange(e)},5E3)});var h,f,l;if(h=b.language)try{l="html"==
h,h=h.m(/\.twig\.html$/i)?"ace/mode/twig":h.m(/\./)?ace.require("ace/ext/modelist").getModeForPath(h).mode:"ace/mode/"+h,f=ace.require("ace/ext/language_tools"),a.session.setMode(h),l?(f.setCompleters([]),a.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1})):(f.setCompleters([f.keyWordCompleter]),a.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}))}catch(n){console.log("Ace editor could not load this language",h)}a.$blockScrolling=Infinity;q.setCodeEditorPosition(a,
q.editingPositions[d+"/"+e])});break;case "color_picker":case "colour_picker":n+="<input";u["class"]=" zenario_color_picker";a.after(function(){var a=b.color_picker_options||b.colour_picker_options||{};a.disabled=s;a.preferredFormat=a.preferredFormat||"hex";a.showInput=!0;$(q.get(e)).spectrum(a)});break;case "editor":var n=n+"<textarea",M="<textarea "+q.outputAtts(b)+"></textarea>",M=$(M).height(),H=Math.max(Math.floor(0.5*$(aa).height()),300),B=function(a){q.fieldChange(a.id)},T;q.useSimpleEditor()?
T={script_url:da+r.tinyMCEPath,plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],browser_spellcheck:!0,height:250,menubar:!1,toolbar:"undo redo | formatselect | link unlink | bold italic | removeformat | alignleft aligncenter alignright alignjustify | outdent indent"}:(D._gSD(),M=_._ex({},{script_url:da+r.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:g,
convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,min_height:M,max_height:H,autoresize_min_height:M,autoresize_max_height:H,autoresize_bottom_margin:10,onchange_callback:B,init_instance_callback:function(a){D._eDDUITM(!1,g,q.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&D._eDDUITM(!1,g,b)}},{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen",
"nonbreaking table contextmenu directionality","paste autoresize","colorpicker textcolor fullscreen"],image_advtab:!0,visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:D.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,content_css:g,toolbar:"undo redo | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen",style_formats:D.skinDesc.style_formats,oninit:g}),
H=_._ex({},M,{toolbar:"undo redo | image link unlink | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen",file_browser_callback:D.fileBrowser,init_instance_callback:function(a){D._eDDUITM(!0,da,q.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&D._eDDUITM(!0,da,b)}}),B=_._ex({},H,{toolbar:"undo redo | image | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen"}),
S=_._ex({},B,{toolbar:"undo redo | link unlink | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen"}),s?(T=M,T.readonly=!0,u["class"]=" tinymce_readonly"):b.insert_image_button?b.insert_link_button?(T=H,u["class"]=" tinymce_with_images_and_links"):(T=B,u["class"]=" tinymce_with_images"):b.insert_link_button?(T=S,u["class"]=" tinymce_with_links"):(T=M,u["class"]=" tinymce"),u.style=
"visibility: hidden;");_._isOb(b.editor_options)&&(T=_._ex(T,b.editor_options));T.setup=function(a){a.on("change",function(a){q.fieldChange(a.id)})};a.after(function(){var a=$(q.get(e)),b=q.get("zenario_abtab"),d;try{a.tinymce().remove()}catch(k){}b&&(d=b.style.display,b.style.display="block");a.tinymce(T);b&&(b.style.display=d)});break;case "button":case "submit":case "toggle":ea=!0;p(b.use_button_tag)?(n+="<button",wa=!0):(n+="<input",u.type="button");if(!s||p(b.can_be_pressed_in_view_mode))Y.onclick=
"lib.clickButton('"+e+"');",delete u.disabled;"toggle"==y&&(u["class"]+=b.pressed?" pressed":" not_pressed");break;default:"textarea"==y?n+="<textarea":J?(ia=!0,n+="<input",u.type="text",u["class"]+=" zenario_datepicker",u.readonly="readonly",s||(u.onkeyup=(u.onkeyup||"")+"zenario._dFKU(this, event, '"+G(e)+"');"),a.after(function(){var a=$(q.get(e)),d=!!p(b.change_month_and_year);a.datepicker({changeMonth:d,changeYear:d,dateFormat:D.siteSettings&&D.siteSettings.organizer_date_format||r.dpf,altField:q.get("_value_for__"+
e),altFormat:"yy-mm-dd",showOn:"focus",disabled:s,onSelect:function(b,d){a.change()}})})):"url"==y?(n+="<input",u.type="url",u.placeholder="http://example.com",u.onblur=(u.onblur||"")+"if(this.value && !this.value.m('://') && $.trim(this.value)[0] != '#') this.value = 'http://' + this.value;"):(b.slider&&(ka=!0,n+=q.drawSlider(a,e,b,s,!0)),"text"==y&&b.values&&!s&&(n+='<span class="zenario_textbox_with_autocomplete">',ba=!0),n+="<input",u.type=y),b.redraw_immediately_onchange&&(u.onkeyup=(u.onkeyup||
"")+"if (lib.redrawImmediatelyWhenChanged(this, event, '"+G(e)+"', '"+G(b.value)+"', "+(b.value==l?"false":"true")+")) return false;"),q.addExtraAttsForTextFields(b,u)}if("checkbox"==y||"radio"==y)p(l)&&(u.checked="checked"),l=g,s&&(u.disabled=!0),p(b.indeterminate)&&a.after(function(){var a;if(a=q.get(e))a.indeterminate=!0});ka&&(u.onchange='$("#zenario_slider_for__'+V(e)+'").slider("value", $(this).val());',u.onkeyup=(u.onkeyup||"")+'$("#zenario_slider_for__'+V(e)+'").slider("value", $(this).val());');
m(t)?(X=$.extend({},b,X),ha.id=e+"___"+t,u["class"]+=" control_for__"+e):(X=b,ha.id=e);"radio"==y&&b.name||(ha.name=e);s&&(ha.placeholder="");n+=q.outputAtts(X,u,Y,ha);Y=G(ea?b.value:l,!1,"asis");u="";"select"==y?n+=">":wa?(n+=">",b.icon_left&&(n+='<i class="'+G(b.icon_left)+'" aria-hidden="true"></i>'),n+=Y,b.icon_right&&(n+='<i class="'+G(b.icon_right)+'" aria-hidden="true"></i>'),n+="</button>"):"textarea"==y||"editor"==y?n+=">"+Y+"</textarea>":"code_editor"==y?n+=">"+Y+"</div>":J?(n+=' value="'+
G(r._fD(l,"datetime"==y))+'"/>',n+=W("type","hidden","id","_value_for__"+e,"value",l),s||(n+=W("type","button","class","zenario_remove_date","value","x","onclick",q.globalName+'.blankField("'+V(e)+'"); $('+q.globalName+'.get("'+V(e)+'")).change();'))):n=m(l)?n+(' value="'+Y+'"/>'):n+"/>";"select"==y&&(b.empty_value&&(u=oa("value","","data-hide_in_iconselectmenu",1,"selected",!l,G(b.empty_value)),b.show_empty_value_at_end||(n+=u,u="")),b.values&&(M={},M[l]=!0,n+=q.hierarchicalSelect(M,b,ja,F,Z,A)),
n+=u+"</select>");if(ba){var ua=[];for(L in F)x(F,L)&&(C=F[L],k=b.values[C],_._iS(k)?ua.push({label:k,value:C}):ua.push({label:k.label,value:C}));a.after(function(){var a=$(q.get(e)),d={source:ua,minLength:b.autocomplete_min_length||0,appendTo:a.parent()};b.return_key_presses_button&&(d.select=function(){setTimeout(function(){$("#"+b.return_key_presses_button).click()},0)});a.autocomplete(d);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})});n+=W("type","button",
"class","zenario_open_autocomplete","value","\u25be","onclick","$("+q.globalName+'.get("'+V(e)+'")).autocomplete("search", "");')}ba&&(n+="</span>")}m(t)||("url"!=y||s||(n+="&nbsp; "+W("type","button","class","submit","value",Q.test,"onclick",q.globalName+'.testURL("'+V(e)+'");'),ia=!0),!b.label||"checkbox"!=y&&"radio"!=y||(n+=" "+qa("class",b.label_class,"for",e,"id","label_for__"+e,G(b.label)),ia=!0),m(b.post_field_label)&&(n+=" "+qa("for",e,"id","label_for__"+e,G(b.post_field_label)),ia=!0),sa&&
(n=la.join("")+n),m(b.pre_field_html)&&(n=r._un(b.pre_field_html)+n),ia&&(n=pa("class","zenario_field_widget_wrap",n)),m(b.post_field_html)&&(n+=r._un(b.post_field_html)),b.tooltip&&(n+=fa("class","zenario_field_tooltip","title",b.tooltip,"?")),ta&&(n+=ma.join("")),ka&&(n+=q.drawSlider(a,e,b,s,!1)));return n};f.addExtraAttsForTextFields=function(a,d){};var Fa={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,
onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,oninput:!0,onpaste:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0},Aa="hr h1 h2 h3 h4 label div p span".split(" ");f.outputAtts=function(a,d,e,b,k){var h,f="";for(h in a)if(x(a,h)&&!(b&&m(b[h])||!k&&!Fa[h]&&"data-"!=h.substr(0,5)))if("disabled"==h||"readonly"==h||"selected"==h){if(p(a[h])||
d&&p(d[h])&&delete d[h])f+=" "+h+'="'+h+'"'}else f+=" "+h+'="'+this.defineLibVarBeforeCode(h),d&&d[h]&&(f+=d[h]+" ",delete d[h]),f+=G(a[h]),e&&e[h]&&(f+=" "+e[h],delete e[h]),f+='"';b&&(f+=this.outputAtts(b,!1,!1,!1,!0));d&&(f+=this.outputAtts(d,!1,!1,!1,!0));e&&(f+=this.outputAtts(e,!1,!1,!1,!0));return f};f.defineLibVarBeforeCode=function(a){if(m(a)&&"on"!=a.substr(0,2))return"";if(!this.globalName){for(a=1;aa[this.globalName="zenarioLib"+a];++a);aa[globalName]=this}return"var lib = "+G(this.globalName)+
"; "};f.testURL=function(a){var d=this.get(a).value;a=this.get(this.onThisRow("target_blank_",a))||this.get(this.onThisRow("target_blank",a));d&&(a&&2==a.value?$.colorbox({href:d,iframe:!0,width:"95%",height:"95%",className:"zenario_url_test_colorbox"}):aa.open(r._aBP(d)))};f.keepNumeric=function(a){var d=a.value.r(/[^\d\.]/g,"").r(/\.(.*)\./g,".$1");a.value!=d&&(a.value=d)};f.hierarchicalSelect=function(a,d,e,b,k,f,R){var E="",w,t,l,s,r,A;for(r in b)if(x(b,r)){A=b[r];s=d.values[A];t=w=!1;if(_._iS(s))s=
{label:s};else if(p(s.disabled)||s.disabled_if&&I._e(s.disabled_if,this,s,g,A,g,g,d,g,e)||d.values_disabled_if&&I._e(d.values_disabled_if,this,s,g,A,g,g,d,g,e))w=!0;a[A]&&(t=!0);l=!p(s.hide_when_children_are_not_visible);if(!m(R)&&k&&f[A]){if((childrenHTML=this.hierarchicalSelect(a,d,e,b,k,f,A))||l)E+=na("optgroup","label",s,"disabled",!childrenHTML,childrenHTML)}else l&&R===s.parent&&(E+="<option "+this.outputAtts(s,!1,!1,{disabled:w,selected:t,value:A})+">"+G(s,!1,!0)+"</option>")}return E};f.setupMultipleSelect=
function(a,d,e,b){var k=this,f=!1;e=$(k.get(d));e.multiselect({columns:a.cols,texts:{placeholder:a.empty_value||Q.selectListSelect,overridePlaceholder:a.placeholder},onOptionClick:function(){f=!0},onControlClose:function(){f&&k.fieldChange(d)}});b&&e.multiselect("disable")};f.typeaheadSearchEnabled=function(a,d,e){};f.typeaheadSearchAJAXURL=function(a,d,e){};f.parseTypeaheadSearch=function(a,d,e,b,k){};f.setupPickedItems=function(a,d,e,b,k){var f=this,g,m,w=a.pick_items||{},t=a.upload||{},l=p(w.allow_typing_anything),
s=p(t.reorder_items||w.reorder_items);f.typeaheadSearchEnabled(a,d,e)&&(g=f.typeaheadSearchAJAXURL(a,d,e))&&(m="_search");a=$(f.get(d)).tokenize({datas:g,searchParam:m,debounce:200,nbDropdownElements:30,sortable:s,placeholder:w.nothing_selected_phrase||t.nothing_selected_phrase||Q.nothing_selected,onAddToken:function(a,b,l){f._tokenizeNoRecurse||(k||f.addToPickedItems(a,d,e),f.$getPickItemsInput(d).focus())},maxElements:k?0:1,parseData:function(a){return f.parseTypeaheadSearch(f.tuix.tabs[e].fields[d],
d,e,b,a)},formatTokenHTML:function(a,k){var g=f.tuix.tabs[e].fields[d];return g.values&&g.values[a]?f.drawPickedItem(a,d,g,b):l?(g.values=g.values||{},g.values[a]=k,f.drawPickedItem(a,d,g,b)):!1},onRemoveToken:function(a,b){f._tokenizeNoRecurse||f.removeFromPickedItems(a,d,e)}});b?a.disable():(s&&a.container.addClass("zenario_reorder_items"),g||l?(a.container.addClass("zenario_picker_with_typeahead"),l&&f.$getPickItemsInput(d).blur(function(){var a,b;if(a=f.$getPickItemsInput(d).val())b={},b[a]=a,
f.addToPickedItems(b,d,e)})):a.disableTypeAhead())};f.chooseFromDropbox=function(a){var d=this,e,b,k,f,g;if(!(e=d.field(a))||!e.upload)return!1;if(f=e.upload.extensions||e.upload.accept)f=_._iS(f)?f.s(","):_._tA(f);for(b in f)x(f,b)&&(k=f[b],g=k.s("/"),m(g[1])?f[b]="images"==g[0]?"image":g[0]:"text"!=k&&"documents"!=k&&"images"!=k&&"video"!=k&&"audio"!=k&&"."!=k.substr(0,1)&&(f[b]="."+k));e={cancel:function(){D._hAL()},linkType:"direct",multiselect:!!p(e.upload.multi),extensions:f,success:function(b){D._sAL();
var e,k,f=new r.callback;for(e in b)x(b,e)&&(k=b[e],f.add(r._a(d.ajaxURL()+"&fetchFromDropbox=1",k,!0)));f.after(function(){var b,e,k,f="";if(!(k=d.field(a))||!k.upload)return!1;for(b in arguments)x(arguments,b)&&((e=arguments[b])&&e.id&&(f+=","+e.id),d.setFileDetails(k,e));""!==f&&d.addToPickedItems(f,a);D._hAL()})}};D._sAL();Dropbox.choose(e)};f.setFileDetails=function(a,d){a.values||(a.values={});d.label=this.formatLabelFromFile(d);a.values[d.id]=d};f.formatLabelFromFile=function(a){var d;m(a.filename)?
(d=a.filename,a.ssc&&(d+=" [checksum "+a.short_checksum+"]"),p(a.width)&&p(a.height)&&(d+=" ["+a.width+" \u00d7 "+a.height+"px]")):(fileDetails=r._dIIFO(a.id))&&(fileDetails=fileDetails.s("/"))&&fileDetails[1]?(d=fileDetails[1],p(fileDetails[2])&&p(fileDetails[3])&&(d+=" ["+fileDetails[2]+" \u00d7 "+fileDetails[3]+"px]")):d=a.id;return d};f.upload=function(a,d){var e=this,b;if(!(b=e.field(a))||!b.upload)return!1;b={class_name:b.class_name,upload:b.upload};e.uploadCallback=function(b){if(b){var d,
f,g,m="";if(!(g=e.field(a))||!g.upload)return!1;for(d in b)x(b,d)&&(f=b[d])&&f.id&&(m+=","+f.id,e.setFileDetails(g,f));""!==m&&e.addToPickedItems(m,a)}};d?e.enableDragDropUpload():I._a(e,b,g,g,g,{fileUpload:1},g,e.ajaxURL())};f.ajaxURL=function(){return da+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+ca(this.path)};f.enableDragDropUpload=function(){};f.disableDragDropUpload=function(){};f.uploadComplete=function(a){m(this.uploadCallback)&&this.uploadCallback(a);delete this.uploadCallback};
f.drawSlider=function(a,d,e,b,f){var h=this,g=_._cl(e.slider);e="";if(p(g.before_field)?f:!f)b&&(e+='<div class="ui-disabled">'),e+=fa("id","zenario_slider_for__"+d,"class",g["class"],"style",g.style),b&&(e+="</div>"),a.after(function(){var a;if(a=h.get("zenario_slider_for__"+d))m(g.min)&&(g.min=r.num(g.min)),m(g.max)&&(g.max=r.num(g.max)),m(g.step)&&(g.step=r.num(g.step)),g.disabled=!h.editModeOn(),g.value=$(h.get(d)).val(),g.slide=function(a,b){$(h.get(d)).val(b.value)},g.change=function(a,b){h.fieldChange(d)},
$(a).slider(g)});return e};f.lookupFileDetails=function(a){return D._lFD(a)};f.pickedItemsArray=function(a,d){if(!1===d||!m(d))return{};a.values&&_._iS(a.values)&&this.tuix.lovs&&this.tuix.lovs[a.values]&&(a.values=this.tuix.lovs[a.values]);if(!(0!==d&&"0"!==d||a.values&&(a.values[0]||a.values["0"])))return{};var e=(d+"").s(","),b={},f,h,g,E,w,t,l;a._display_value=!1;for(t in e)x(e,t)&&(l=e[t])&&(a.upload&&(w=r._dIIFO(l))&&(w=w.s("/"))&&w[1]?(b[l]=w[1],p(w[2])&&p(w[3])&&(b[l]+=" ["+w[2]+" \u00d7 "+
w[3]+"px]")):a.values&&a.values[l]&&"string"==typeof a.values[l]?b[l]=a.values[l]:a.values&&a.values[l]&&a.values[l].label?b[l]=a.values[l].label:((g=a.pick_items&&a.pick_items.target_path)||(g=a.pick_items&&a.pick_items.path))&&(f=D._gIFO(g,l))?(a.values||(a.values={}),h=D._fOIN(f,l),E=f.items&&f.items[l]||{missing:!0},b[l]=h,a.values[l]={missing:E.missing,image:E.image,css_class:E.css_class||f.item&&f.item.css_class,label:h}):a.upload&&l==1*l&&(w=this.lookupFileDetails(l))?(this.setFileDetails(a,
w),b[l]=a.values[l]):b[l]=l,!1===a._display_value&&(a._display_value=b[l]));return b};f.pickedItemsValue=function(a){var d,e="";if(a)for(d in a)x(a,d)&&(e+=(""===e?"":",")+d);return e};f.displaySelectedItems=function(a,d,e,b){m(d)||(d=this.field(a,b));m(e)||(e=this.value(a,b));a=this.pickedItemsArray(d,e);return _._isEm(a)?p(e)?e:m(d.empty_value)?d.empty_value:"":_._tA(a).join(", ")};f.hierarchicalBoxes=function(a,d,e,b,f,h,r,E,w,t,l,s,F){var A=this,D=1*f.cols||1,q=0,y="",H,B,I,N,J=!1;if(!F)F=0,D=
1*f.cols_at_top_level||D;else if(10<F)return"";s||(s={});l&&(s[l]=!0);F&&(y+=fa("class","zenario_hierarchical_box_children","id","children_for___"+e+"___"+l,">"));for(var O in w)if(x(w,O)&&(H={},B=w[O],B==1*B&&(B*=1),N=g,I="object"==typeof f.values[B]?f.values[B]:{label:f.values[B]},f.tag_colors&&(H.tag_color=f.tag_colors[B]||"blue"),N=I.parent,"0"===N&&(N=!1),!l&&!N||l==N)){N=b?!0===b||1===b||"1"===b?!0===B||1===B||"1"===B:E?m(E[B])?!0:!1:B==b:!B;if(!r||N||!f.hide_unselected_values_when_readonly||
t[B]){H.checked=N;if(H.newRow=++q>D)q=1;H.col=q;H.cols=D;if("checkboxes"==f.type&&p(f.checking_child_checks_parents)){var z="";l&&(z+="if (this.checked) { for (var cb in "+JSON.stringify(s)+") { "+A.globalName+".get('"+G(e)+"___' + cb).checked = true; } } ");t[B]&&(z+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");z?h.onchange=f.onchange?z+" "+f.onchange:z:f.onchange?h.onchange=f.onchange:delete h.onchange}else"checkboxes"==f.type&&p(f.checking_parent_checks_children)&&
(z="",t[B]&&(z+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),z?h.onchange=f.onchange?z+" "+f.onchange:z:f.onchange?h.onchange=f.onchange:delete h.onchange);H.lovId=e+"___"+B;H.lovField=I;f.indeterminates&&p(f.indeterminates[B])&&function(b){a.after(function(){var a;if(a=A.get(b))a.indeterminate=!0})}(H.lovId);H.lovHTML=A.drawField(a,d,e,h,g,g,g,g,g,B,N,!1,w,t,I);H.childrenHTML="";t[B]&&(H.childrenHTML=A.hierarchicalBoxes(a,d,e,b,
f,h,r,E,w,t,B,_._ex({},s),F+1),q=0);J?(A.splitValues||(A.splitValues={}),A.splitValues[e]||(A.splitValues[e]=""),A.splitValues[e]+=A.microTemplate(A.mtPrefix+"_radio_or_checkbox",H)):y+=A.microTemplate(A.mtPrefix+"_radio_or_checkbox",H)}N&&I.split_values_if_selected&&!F&&"radios"===f.type&&(J=!0)}F&&(y+="</div>");return y};f.drawPickedItem=function(a,d,e,b,f){m(e)||(e=this.field(d));label=e.values&&e.values[a];pick_items=e.pick_items||{};thumbnail={};mi={};_._isOb(label)?_._ex(mi,label):label?mi.label=
label:(mi.label=a,mi.missing=!0);mi.id=d;mi.item=a;mi.readOnly=b;mi.width&&mi.height&&((a=mi.checksum||mi.short_checksum)?(thumbnail.src=da+"zenario/file.php?c="+ca(a)+"&og=1",mi.usage&&(thumbnail.src+="&usage="+ca(mi.usage))):mi.link&&(thumbnail.src=r._aBP(mi.link)),thumbnail.src&&(I._rI(mi.width,mi.height,180,120,thumbnail),mi.thumbnail=thumbnail));return f?this.microTemplate(pick_items.dropdown_item_microtemplate||this.mtPrefix+"_dropdown_item",mi):this.microTemplate(pick_items.picked_item_microtemplate||
this.mtPrefix+"_picked_item",mi)};f.showPickedItemInPopout=function(a,d){I._a(this,{popout:{href:a,title:d,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){var d,e,b,f;(d=this.field(a))&&(e=d.pick_items)&&(e.path||e.target_path)&&(d=f=e.path,ea.map&&(f=ea._cNPTTP(e.path).path),p(e.multiple_select)||e.target_path&&e.target_path!=f||!(b=this.readField(a))||-1!=b.indexOf(",")||(d="//"==r._rHSS(d,2)?d+b:"/"==r._rHSS(d,1)?d+("/"+b):d+("//"+b)),this.SKTarget=a,D._oS(this.globalName,
"setPickedItems",e.multiple_select,d,e.target_path,e.min_path,e.max_path,e.disallow_refiners_looping_on_min_path,g,e.one_to_one_choose_phrase,e.one_to_many_choose_phrase,g,!0,g,g,g,g,g,g,g,g,e))};f.setPickedItems=function(a,d,e,b){a=this.SKTarget;var f,h,g={};for(f in d._items)x(d._items,f)&&(e=r._dIIFO(f),h=b.items&&b.items[e]||{missing:!0},g[e]={missing:h.missing,image:h.image,css_class:h.css_class||b.item&&b.item.css_class,label:D._fOIN(b,e)});this.addToPickedItems(g,a)};f.removeFromPickedItems=
function(a,d,e){this.addToPickedItems(a,d,e,!0)};f.addToPickedItems=function(a,d,e,b){this._tokenizeNoRecurse=!0;e=this.field(d,e);var f=this.readField(d),h=e.pick_items&&p(e.pick_items.multiple_select)||e.upload&&p(e.upload.multi),g,m,r={};a=I._cTO(a);m=f?this.pickedItemsArray(e,f):{};for(g in a)if(x(a,g))if(f=a[g],e.values||(e.values={}),b)delete e.values[g];else if(e.values[g]||(e.values[g]=f),m[g]&&(r[g]=!0),h)m[g]=!0;else{m={};m[g]=!0;break}this.redrawPickedItems(d,e,m,r);this._tokenizeNoRecurse=
!1};f.redrawPickedItems=function(a,d,e,b){var f,h,m=this.pickedItemsValue(e),r={},p=$(this.get(a)).tokenize(),t=p.toArray();e=I._cTO(e);for(f in t)x(t,f)&&(h=t[f],e[h]&&!b[h]?r[h]=!0:p.tokenRemove(h));for(h in e)x(e,h)&&!r[h]&&(b=d.values&&d.values[h],_._isOb(b)?b=b.label:b||(b=h),p.tokenAdd(h,b));d.current_value=m;d.onchange&&I._e(d.onchange,this,d,g,a,g,g,d);this.fieldChange(a)};f.changes=function(a){if(this.tuix&&this.tuix.tab){if(m(a))return this.changed[a];for(a in this.tuix.tabs)if(x(this.tuix.tabs,
a)&&this.changed[a])return!0}return!1};f.markAsChanged=function(a){this.tuix&&(m(a)||(a=this.tuix.tab),a&&!this.changed[a]&&(this.changed[a]=!0,this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,d){var e=this,b=e.field(a);b&&(b.indeterminate&&(b.indeterminate=!1),m(d)&&b.indeterminates&&b.indeterminates[d]&&(b.indeterminates[d]=!1),e.markAsChanged(),p(b.multiple_edit)&&e.meMarkChanged(a),setTimeout(function(){e.validateFormatOrRedrawForField(b)},1))};
f.validateFormatOrRedrawForField=function(a,d){"string"==typeof a?(this.fieldThatTriggeredRedraw=this.setLastFocus(a),a=this.field(a)):a.id&&(this.fieldThatTriggeredRedraw=this.setLastFocus(a.id));var e=p(a.validate_onchange),b=p(a.format_onchange)||d&&(a.pressed?a.format_on_toggle_on:a.format_on_toggle_off),f=p(a.redraw_onchange);if(e)return 3>this.ffoving&&(this.ffoving=3,this.validate()),!0;if(b)return 2>this.ffoving&&(this.ffoving=2,this.format()),!0;f&&1>this.ffoving&&(this.ffoving=1,this.readTab(),
this.redrawTab());return f};f.redrawImmediatelyWhenChanged=function(a,d,e,b,f){if(a=f?a.value===b:a.value!==b)r._st(d),this.fieldThatTriggeredRedraw=this.setLastFocus(e),1>this.ffoving&&(this.ffoving=1,this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,d,e){m(d)&&d==e||(this.field(a).multiple_edit._changed=!0,this.meSetCheckbox(a,!0))};f.meSetCheckbox=function(a,d){"checkbox"==this.get("multiple_edit__"+a).type?this.get("multiple_edit__"+a).checked=d:this.get("multiple_edit__"+
a).value=d?1:""};f.meChange=function(a,d,e){var b=this.field(d);if(a)b.multiple_edit._changed=!0;else{if(!e&&p(b.multiple_edit.warn_when_abandoning_changes)&&m(b.multiple_edit.original_value)&&this.readField(d)!=b.multiple_edit.original_value){a=W("type","button","class","submit_selected","value",Q.abandonChanges,"onclick",this.globalName+'.meChange(false, "'+V(d)+'", true);')+W("type","button","class","submit","value",Q.cancel);D._flBo(Q.abandonChangesConfirm,a,"warning");this.meSetCheckbox(d,!0);
return}b.multiple_edit._changed=!1;delete b.current_value;e=b.value;m(b.multiple_edit.original_value)&&(e=b.current_value=b.multiple_edit.original_value);this.get(d)&&!b.pick_items?"checkbox"==this.get(d).type?this.get(d).checked=e?!0:!1:$(this.get(d)).val(e||""):(b=new r.callback,e=this.drawFields(b),this.insertHTML(e,b))}this.meSetCheckbox(d,a);this.validateFormatOrRedrawForField(d)};f.currentValue=function(a,d,e){return e||this.drawingFields||m(d)&&d!=this.tuix.tab?this.value(a,d,e):this.readField(a)};
f.originalValue=function(a,d){return this.value(a,d,!0)};f.value=function(a,d,e){d||(d=this.tuix.tab);var b="",f=this.field(a,d);if(!f)return"";m(e)||(e=this.fieldIsReadonly(a,f,d));f&&!f.snippet&&"grouping"!=f.type&&(this.isButton(f)?b=!!f.pressed:!e&&m(f.current_value)?b=f.current_value:m(f.value)?b=f.value:f.multiple_edit&&m(f.multiple_edit.original_value)&&(b=f.multiple_edit.original_value));return"0"===b?0:m(b)?b:""};f.mode=function(a){return this.value("mode","global_area")||this.value("mode")};
f.keyIn=function(a){return _.contains(arguments,this.tuix.key[a],1)};f.keyIs=function(a,d){return this.tuix.key[a]==d};f.key=function(a){return this.tuix.key[a]};f.modeIn=function(){return _.contains(arguments,this.mode())};f.modeIs=function(a){return this.mode()==a};f.valueIn=function(a){return _.contains(arguments,this.value(a),1)};f.valueInArray=function(a,d){return _.contains(d,this.value(a))};f.valueIs=function(a,d){return this.value(a)==d};f.valueIsNot=function(a,d){return this.value(a)!=d};
f.isButton=function(a){return a&&("submit"==a.type||"toggle"==a.type||"button"==a.type)};f.isFormField=function(a){return!(!a||a.snippet||"grouping"==a.type||"submit"==a.type||"toggle"==a.type||"button"==a.type)};f.getCodeEditorPosition=function(a){return{top:a.session.getScrollTop(),left:a.session.getScrollLeft(),range:a.getSelectionRange()}};f.setCodeEditorPosition=function(a,d){d&&(a.session.setScrollTop(d.top),a.session.setScrollLeft(d.left),a.selection.setSelectionRange(d.range))};f.appendCodeEditorValue=
function(a,d){var e=ace.edit(a),b=this.getCodeEditorPosition(e);e.setValue(e.getValue()+d);this.setCodeEditorPosition(e,b)};f.readField=function(a){var d=g,e=this.tuix.tab,b=this.field(a,e),f;if(!this.isFormField(b))return g;var h=this.fieldIsReadonly(a,b,e),p=b._was_hidden_before;b.multiple_edit&&h&&delete b.multiple_edit._changed;if("checkboxes"==b.type||"radios"==b.type){if(!h&&!p&&b.values){var E,p="",w=!0;for(E in b.values)x(b.values,E)&&this.get(a+"___"+E)&&this.get(a+"___"+E).checked&&(p+=
(w?"":",")+E,w=!1);b.current_value=p}p=!0}if(p)return h||!m(b.current_value)?b.value:b.current_value;if(this.get("_value_for__"+a))b.current_value=d=this.get("_value_for__"+a).value;else if("editor"!=b.type&&"code_editor"!=b.type||h)if(!h&&(f=this.get(a))){if("checkbox"==b.type||"radio"==b.type)d=f.checked?!0:!1;else if("color_picker"==b.type||"colour_picker"==b.type)try{d=$(f).spectrum("get").toHexString()}catch(t){d=$(f).val()}else d=$(f).val();m(d)||(d="");_._isAr(d)&&(d=d.join(","));b.current_value=
d}else delete b.current_value,d=b.value;else{var l,s;if("editor"==b.type){if(a=aa.tinyMCE&&tinyMCE.get(a))l=r._tMGC(a)}else"code_editor"==b.type&&(s=ace.edit(a))&&(l=s.getValue(),this.editingPositions[e+"/"+a]=this.getCodeEditorPosition(s));if(m(l)&&!1!==l)d=b.current_value=l;else return m(b.current_value)?b.current_value:b.value}return d};f.blankField=function(a){this.setFieldValue(a,"")};f.setFieldValue=function(a,d){field=this.field(a,this.tuix.tab);this.get(a)&&$(this.get(a)).val(d);this.get("_value_for__"+
a)&&(this.get("_value_for__"+a).value=d);field.current_value=d};f.readTab=function(){var a,d={},e=this.fields(),b;this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(b in e)x(e,b)&&m(a=this.readField(b))&&(d[b]=a);U&&U.activeElement&&(this.lastFocus=this.setLastFocus(U.activeElement));return d};f.wipeTab=function(){var a=this.fields(),d,e;for(d in a)x(a,d)&&(e=a[d],delete e.current_value,e.multiple_edit&&delete e.multiple_edit._changed)};f.redrawTab=function(){this.tuix.shake=!1;this.draw2()};
f.useSimpleEditor=function(){return!0};f.getURL=function(a){++this.onKeyUpNum;return this.returnAJAXURL(a)};f.returnAJAXURL=function(a){return"..."};f.editModeOn=function(a){return!0};f.editModeAlwaysOn=function(a){return!0};f.editCancelEnabled=function(a){return!1};f.revertEnabled=function(a){return!1};f.savedAndContinued=function(a){return!1};f.editModeOnBox=function(){return!0};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(x(this.tuix.tabs,a)){var d=
this.tuix.tabs[a];d&&this.sortedTabs.push([a,d.ord])}this.sortedTabs.sort(I.sortArray);this.groupings={};this.sortedFields={};for(a in this.sortedTabs)x(this.sortedTabs,a)&&(d=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(d))};f.sortFields=function(a){var d,e,b,f,h={};this.groupings[a]={};this.sortedFields[a]=[];if(b=this.fields(a)){for(d in b)x(b,d)&&(e=b[d],e.type&&"grouping"==e.type&&(h[e.name||d]=1*e.ord,this.groupings[a][e.name||d]=d));for(d in b)x(b,d)&&(!(e=b[d])||e.type&&"grouping"==
e.type||(f=e.grouping?h[e.grouping]:g,this.sortedFields[a].push([d,e.ord,f])));this.sortedFields[a].sort(I.sortArrayWithGrouping);for(d in this.sortedFields[a])x(this.sortedFields[a],d)&&(this.sortedFields[a][d]=this.sortedFields[a][d][0])}};f.setData=function(a){this.tuix=a};f.setDataDiff=function(a){this.syncAdminBoxFromServerToClient(a,this.tuix)};f.syncAdminBoxFromServerToClient=function(a,d){var e,b;for(e in a)x(a,e)&&(b=a[e],!m(b)||b["[[__unset__]]"]?delete d[e]:m(d[e])?b["[[__replace__]]"]?
(delete b["[[__replace__]]"],d[e]=b):"object"!=typeof d[e]?d[e]=b:"object"==typeof d[e]&&"object"!=typeof b?d[e]=b:this.syncAdminBoxFromServerToClient(b,d[e]):d[e]=b)};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};f.sendStateToServerDiff=function(){var a={};this.syncAdminBoxFromClientToServerR(a,this.tuix);return JSON.stringify(a)};f.syncAdminBoxFromClientToServerR=function(a,d,e,b,f,h,g,p){if("object"==typeof d){var w,t,l;for(t in d)if(!m(e)&&r.IN(t,"download","path","shake","tab",
"switchToTab")&&(w="value")||!m(e)&&r.IN(t,"_sync","tabs")&&(w="array")||!m(b)&&"_sync"==e&&r.IN(t,"cache_dir","password","session","iv")&&(w="value")||!m(b)&&"tabs"==e&&(w="array")||!m(f)&&"tabs"==b&&"_was_hidden_before"==t&&(w="value")||!m(f)&&"tabs"==b&&r.IN(t,"edit_mode","fields")&&(w="array")||!m(h)&&"tabs"==f&&"edit_mode"==e&&"on"==t&&(w="value")||!m(h)&&"tabs"==f&&"fields"==e&&(w="array")||!m(g)&&"tabs"==h&&"fields"==b&&r.IN(t,"_display_value","_was_hidden_before","current_value","pressed")&&
(w="value")||!m(g)&&"tabs"==h&&"fields"==b&&"multiple_edit"==t&&(w="array")||!m(p)&&"tabs"==g&&"fields"==f&&"multiple_edit"==e&&"_changed"==t&&(w="value"))if("value"==w)switch(l=d[t],typeof l){case "function":case "object":break;case "string":l=r._eIIFO(l);default:a[t]=l}else"array"==w&&"object"==typeof d[t]&&(a[t]={},this.syncAdminBoxFromClientToServerR(a[t],d[t],t,e,b,f,h,g))}};f.getValueArrayofArrays=function(a){return r._nAA(this.getURL(),r._uR({_read_values:!0,_box:this.sendStateToServer()}),
!a)};f.getValues1D=function(a,d,e,b,f,h){var g,p,r,t,l,s={};if(this.tuix&&this.tuix.tabs)for(g in this.tuix.tabs)if(x(this.tuix.tabs,g)&&(p=this.tuix.tabs[g],p.fields&&(!m(h)||-1!=I._tTA(h).indexOf(g))))for(r in p.fields)!x(p.fields,r)||(t=p.fields[r],l=r,!this.isFormField(t)||b&&this.fieldIsReadonly(r,t,g)||f&&(p._was_hidden_before||t._was_hidden_before)||a&&!(l=t.plugin_setting&&t.plugin_setting.name)||(t=this.currentValue(r,g,e),d||(s[l]=t),!d&&m(d)))||(s[g+"/"+r]=t);return s};f.insertText=function(a,
d){_._iS(a)&&(a=this.get(a));if(a){var e=$(a),b=a.selectionStart,f=a.selectionEnd,g=e.val();e.val(g.substring(0,b)+d+g.substring(f));a.selectionStart=a.selectionEnd=b+d.length;a.focus()}};f.callFunctionOnEditors=function(a){var d,e,b;if(aa.tinyMCE&&(d=this.fields()))for(e in d)if(x(d,e)&&(b=d[e],"editor"==b.type&&tinyMCE.get(e)))if("remove"==a)tinyMCE.get(e).remove();else if("isDirty"==a&&tinyMCE.get(e).isDirty())return!0;return!1};f.format=function(a){var d=this,e;if(d.loaded&&(e=d.getURL("format"))){var b=
d.tuix&&d.tuix.tab;d.loaded=!1;d.hideTab();d.checkValues(a);d.retryAJAX(e,{_format:!0,_box:d.sendStateToServer()},!0,function(a){d.load(a);d.switchTabIfRequested(b);d.sortTabs();d.draw()},"loading")}};f.validate=function(a,d,e,b){var f=this,g;if(f.loaded&&(g=f.getURL("validate"))){f.differentTab=a;f.loaded=!1;f.hideTab(a);f.checkValues(e);var m=f.tuix&&f.tuix.tab;a&&(f.tuix.switchToTab=d);f.retryAJAX(g,{_validate:!0,_box:f.sendStateToServer()},!0,function(a){f.load(a)&&f.switchTabIfRequested(m);f.sortTabs();
f.switchToATabWithErrors();f.draw();b&&b()},"loading")}};f.switchTabIfRequested=function(a){this.tuix.switchToTab&&(a=a||this.tuix&&this.tuix.tab,this.errorOnTab(a)?this.tuix.tab=a:this.tuix.tab=this.tuix.switchToTab,delete this.tuix.switchToTab)}})},zenarioF);
