zenario.lib(function(k,K,H,N,h,W,y,u,R,X,L,w,q,r,E,S,F,Y,T,t,U){h=T(U);h.init=function(a,e){this.encapName=this.globalName=a;this.mtPrefix=e||"zenario_admin_box";this.baseCSSClass="";this.onKeyUpNum=0;R.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={};this.lastFieldInFocus=!1;this.editingPositions={}};h.microTemplate=function(a,e,b){return u.microTemplate(a,e,b)};h.getKey=function(a){return this.tuix&&this.tuix.key};h.getKeyId=function(a){return this.tuix&&this.tuix.key&&
this.tuix.key.id};h.getLastKeyId=function(a){return this.getKeyId(a)};h.getTitle=function(){var a,e;if(this.tuix.key&&this.tuix.key.id&&(a=this.tuix.title_for_existing_records)){e=this.getValues1D(!1,k,!0);for(c in e)if(t(e,c)&&(v=e[c],-1!=a.indexOf("[["+c+"]]")))for(;a!=(string2=a.replace("[["+c+"]]",v));)a=string2;return a}return this.tuix.title};h.field=function(a,e){return _.isObject(a)?a:(tabs=this.tuix&&this.tuix.tabs)&&(e=e||this.tuix.tab)&&tabs[e]&&tabs[e].fields&&tabs[e].fields[a]};h.fields=
function(a){var e;return(e=this.tuix&&this.tuix.tabs)&&(a=a||this.tuix.tab)&&e[a]&&e[a].fields};h.initFields=function(){var a,e,b,d;if(this.tuix.tabs)for(a in this.tuix.tabs)if(t(this.tuix.tabs,a)&&(b=this.fields(a)))for(e in b)t(b,e)&&(d=b[e])&&(d.pick_items&&d.plugin_setting&&d.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(e,this.value(e,a,!1)):d.values&&_.isString(d.values)&&this.tuix.lovs[d.values]?d.values=this.tuix.lovs[d.values]:d.load_values_from_organizer_path&&!d.values&&
this.loadValuesFromOrganizerPath(d))};h.loadValuesFromOrganizerPath=function(a){var e,b,d;if(a.load_values_from_organizer_path&&!a.values&&(a.values={},(b=u.getItemFromOrganizer(a.load_values_from_organizer_path))&&b.items))for(e in b.items)t(b.items,e)&&(d=b.items[e],a.values[y.decodeItemIdForOrganizer(e)]={list_image:d.list_image,css_class:d.css_class||b.item&&b.item.css_class,label:u.formatOrganizerItemName(b,e)})};h.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?
this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};h.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};h.editCancelOrRevert=function(a,e){if(this.tuix.tabs[e].edit_mode){var b,d,f,g,n,x;"edit"==a?(n=q(this.tuix.tabs[e].edit_mode.format_on_edit),x=q(this.tuix.tabs[e].edit_mode.validate_on_edit)):"cancel"==a?(n=q(this.tuix.tabs[e].edit_mode.format_on_cancel_edit),x=q(this.tuix.tabs[e].edit_mode.validate_on_cancel_edit)):
"revert"==a&&(n=q(this.tuix.tabs[e].edit_mode.format_on_revert),x=this.errorOnTab(e)||q(this.tuix.tabs[e].edit_mode.validate_on_revert));if(!x&&(d=this.fields(e)))for(f in d)if(t(d,f))if(g=d[f],q(g.validate_onchange)&&(b=this.readField(f))!==k&&b!=g.value){x=!0;break}else!n&&q(g.format_onchange)&&(b=this.readField(f))!==k&&b!=g.value&&(n=!0);this.tuix.tabs[e].edit_mode.on="cancel"!=a;this.changed[e]=!1;x?this.validate(k,k,!0):n?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==e&&
$("#zenario_abtab").removeClass("zenario_abtab_changed")}};h.clickTab=function(a){this.loaded&&this.validate(a!=this.tuix.tab,a)};h.clickButton=function(a,e){var b=this.field(e);"submit"==b.type?(b.pressed=!0,this.validate(!0)):"toggle"==b.type?((b.pressed=!q(b.pressed))?$("#"+e).removeClass("not_pressed").addClass("pressed"):$("#"+e).removeClass("pressed").addClass("not_pressed"),this.validateFormatOrRedrawForField(b)):"button"==b.type&&(b.pressed=!0,this.validateFormatOrRedrawForField(b))};h.togglePressed=
function(a,e){var b;b=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;b===k&&(b=!0);e&&"toggle"==e.type&&(this.toggleLevelsPressed.last=b&&q(e.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));return b};h.toggleLevel=function(a){return this.toggleLevelsPressed.last};h.retryAJAX=function(a,e,b,d){var f=function(){y.ajax(a,e,k,k,f).after(b);d&&u.nowDoingSomething&&u.nowDoingSomething(d)};f()};h.switchToATabWithErrors=function(){if(this.tuix&&this.tuix.tabs&&
!this.errorOnTab(this.tuix.tab))for(var a in this.sortedTabs)if(t(this.sortedTabs,a)){var e=this.sortedTabs[a];if(this.tuix.tabs[e]&&!u.hidden(this.tuix.tabs[e])&&this.errorOnTab(e))return this.tuix.tab=e,!0}return!1};h.applyMergeFields=function(a,e,b,d){return a};h.applyMergeFieldsToLabel=function(a,e,b,d){return a};h.hideTab=function(a){var e=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},
200,function(){e.tabHidden=!0;e.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),this.tabHidden=!0,this.draw())};h.draw=function(){this.loaded&&this.tabHidden&&this.draw2()};h.draw2=function(){};h.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var e,b,d=[],f;for(f in this.sortedTabs)if(t(this.sortedTabs,f)){var g=this.sortedTabs[f];if((e=this.tuix.tabs[g])&&!u.hidden(e)){b="";if(e.fields&&!_.isEmpty(e.fields)||
e.fields&&!_.isEmpty(e.errors)||e.fields&&!_.isEmpty(e.notices))b=this.globalName+".clickTab('"+S(g)+"');";!this.tuix.tab&&b&&(this.tuix.tab=g);d.push({id:g,tabId:g,tuix:e,onclick:b,current:this.tuix.tab==g,label:e.label})}}u.setButtonKin(d,"zenario_fab_tab_with_children");return this.microTemplate(a,d)};h.drawFields=function(a,e){u.clearHTML5UploadFromDragDrop();var b=this.tuix.tab,d=this.tuix.tabs[b],f="",g="",n=this.fields(b),k=!1;!this.savedAndContinued(b)&&this.editCancelEnabled(b)&&(g='<div class="zenario_editCancelButton"><input class="submit" type="button" onclick="'+
this.globalName+'.changeMode(); return false;" value="'+(this.editModeOn()?F.cancel:F.edit)+'"></div>');var l=!1,m,p,h,g={fields:{},rows:[],tabId:b,path:this.path,tuix:this.tuix,revert:g,errors:[],notices:{}};if(this.editModeOn()){if(d.errors)for(m in d.errors)t(d.errors,m)&&(p=d.errors[m],g.errors.push({message:p}));if(n)for(m in n)t(n,m)&&(p=n[m],p.error&&g.errors.push({message:p.error}))}if(d.notices)for(m in d.notices)t(d.notices,m)&&(p=d.notices[m],q(p.show)&&{error:1,warning:1,question:1,success:1}[p.type]&&
(g.notices[m]=p));for(var r in this.sortedFields[b])t(this.sortedFields[b],r)&&(m=this.sortedFields[b][r],p=n[m],p._id=m,p._html=this.drawField(a,b,m,!0,p,k),k=p._was_hidden_before,!1!==p._html&&(p._lastGrouping=h,h!==p.grouping&&(h=p.grouping,p._startNewRow=!0),!p._startNewRow&&g.rows.length||g.rows.push({fields:[]}),l||d.show_errors_after_field!=m||(g.rows[g.rows.length-1].errors=g.errors,g.rows[g.rows.length-1].notices=g.notices,l=!0),g.rows[g.rows.length-1].fields.push(p),g.fields[m]=p));g.rows.length&&
(g.rows[g.rows.length-1].fields[0]._isLastRow=!0);l||g.rows.splice(0,0,{errors:g.errors,notices:g.notices});e=e||d.template||this.mtPrefix+"_current_tab";f+=this.microTemplate(e,g);for(r in this.sortedFields[b])t(this.sortedFields[b],r)&&(m=this.sortedFields[b][r],delete n[m]._lastGrouping,delete n[m]._startNewRow,delete n[m]._hideOnOpen,delete n[m]._showOnOpen,delete n[m]._isLastRow,delete n[m]._html,delete n[m]._id);return f};h.insertHTML=function(a,e,b){var d=w("zenario_abtab"),f;d.innerHTML=a;
this.tabHidden=!1;this.changes(this.tuix.tab)?$(d).addClass("zenario_abtab_changed"):$(d).removeClass("zenario_abtab_changed");e.call();!b&&this.lastFieldInFocus&&(f=w(this.lastFieldInFocus))&&f.focus()};h.hideShowFields=function(a){var e=$(".zenario_hide_on_open"),b=$(".zenario_hide_row_on_open"),d=$(".zenario_show_on_open"),f=function(a,b){b.style.display="none"};d.length&&!e.length?d.show("blind",200,a):!d.length&&e.length?e.hide("blind",200,function(){b.each(f)}):d.length&&e.length&&(e.each(f),
b.each(f),d.show())};h.addJQueryElementsToTab=function(){y.addJQueryElements("#zenario_abtab ",!0)};h.addJQueryElementsToTabAndFocusFirstField=function(){y.addJQueryElements("#zenario_abtab ",!0);this.focusFirstField()};h.focusFirstField=function(){if(this.tuix&&!q(this.tuix.tabs[this.tuix.tab].disable_autofocus)){var a=-1,e=[],b=k,d,f,g,n,x;for(d in this.sortedFields[this.tuix.tab])if(t(this.sortedFields[this.tuix.tab],d)&&(n=this.sortedFields[this.tuix.tab][d],(f=w(n))&&(g=this.field(n))&&((x=g.pick_items||
g.upload)||$(f).is(":visible"))&&(e[++a]={id:n,type:g.type,empty:""==f.value,focusable:(x||y.IN(g.type,"password","checkbox","select","text","textarea"))&&!q(f.disabled)&&!q(f.readonly)&&!q(g.read_only)},1<a)))break;if(e[0]&&!e[0].empty&&e[1]&&e[1].focusable&&e[1].empty&&"password"==e[1].type)b=1;else if(e[0]&&e[0].focusable)b=0;else if(e[1]&&e[1].focusable)b=1;else return;setTimeout(function(){g=e[b];g.type?w(g.id).focus():$(w("name_for_"+g.id)).find(".TokenSearch input").focus()},50)}};h.focusField=
function(){this.fieldToFocus&&w(this.fieldToFocus)&&$(w(this.fieldToFocus)).is(":visible")&&w(this.fieldToFocus).focus();delete this.fieldToFocus};h.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(t(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};h.errorOnTab=function(a){var e;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(e in this.tuix.tabs[a].errors)if(t(this.tuix.tabs[a].errors,e))return!0;if(a=this.fields(a))for(e in a)if(t(a,
e)&&a[e].error)return!0}};h.checkValues=function(a){a?this.wipeTab():this.readTab();for(var e in this.tuix.tabs)if(t(this.tuix.tabs,e)){a=this.tuix.tabs[e];var b=this.editModeOn(e);if(a.fields)for(var d in a.fields)if(t(a.fields,d)){var f=a.fields[d];this.isFormField(f)&&("code_editor"==f.type&&y.clearAllDelays("code_editor_"+d),f.current_value===k&&(f.current_value=this.value(d,e,!0)),b&&(f.value===k&&(f.value=this.value(d,e,!1)),f.multiple_edit&&f.multiple_edit._changed===k&&f.multiple_edit.changed!==
k&&(f.multiple_edit._changed=f.multiple_edit.changed)))}}H&&H.activeElement&&(this.lastFieldInFocus=H.activeElement.id)};h.enableMicroTemplates=function(a,e){for(var b in e)if(t(e,b))switch(typeof e[b]){case "object":"that"!==b&&"tuix"!==b&&this.enableMicroTemplates(a,e[b]);break;case "string":"type"===b||"value"===b&&this.isFormField(e)||"current_value"===b||!e[b].match(/(\{\{|\{\%|\<\%)/)||function(a,b,e){e=y.generateMicroTemplate(a[b]);a[b]=function(){return e(a)}}(e,b)}};h.drawField=function(a,
e,b,d,f,g,n,x,l,m,p,h,I){f===k&&(f=this.field(b,e));f.id===k&&(f.id=b);q(f.enable_microtemplates_in_properties)&&this.enableMicroTemplates(f,f);l===k&&(l=!this.editModeOn()||q(f.read_only));f.type&&"datetime"==f.type&&(l=!0);I?I.disabled_if!==k&&u.eval(I.disabled_if,I,k,n)&&(l=!0):f.disabled_if!==k&&u.eval(f.disabled_if,f,k,b)&&(l=!0);if(f.type&&"grouping"==f.type)return"";var M=this,V={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,
title:!0,disabled:!0,onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0},A;d="";var C,z,G={},O=!1,s={"class":""},D={},H=!0,P=!1;f.snippet||x!==k||(x=this.value(b,e,k,!0));x===k&&(x="");n===k&&((f.upload||f.pick_items)&&""!=x&&(G=this.pickedItemsArray(f,x)),f.values&&_.isString(f.values)&&
this.tuix.lovs[f.values]?f.values=this.tuix.lovs[f.values]:f.load_values_from_organizer_path&&!f.values&&this.loadValuesFromOrganizerPath(f));if(!(p&&h||"object"!=typeof f.values))if(p=[],h={},f.upload&&q(f.upload.reorder_items))for(C in z=x.split(","),z)t(z,C)&&(A=z[C],p.push(A));else{for(A in f.values)t(f.values,A)&&(z=f.values[A],"object"==typeof z?(z.parent!==k&&(P=!0,h[z.parent]=!0),u.hidden(z,!1,k,A)||(z.ord!==k?p.push([A,z.ord]):z.label!==k?p.push([A,z.label]):p.push([A,A]))):p.push([A,z]));
p.sort(u.sortArray);for(C in p)t(p,C)&&(p[C]=p[C][0])}if(n===k){f._startNewRow=!q(f.same_row);A=u.hidden(f,!1,k,b);g&&q(f.hide_with_field_above)&&(A=!0);if(f._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=f.type&&"code_editor"!=f.type&&f._was_hidden_before&&!A)f._showOnOpen=!0,delete f._was_hidden_before;else if(f._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=f.type&&"code_editor"!=f.type&&!f._was_hidden_before&&A)f._hideOnOpen=!0,f._was_hidden_before=
!0;else{if(A)return f._was_hidden_before=!0,!1;delete f._was_hidden_before}g="";A=!1;f.multiple_edit&&(A=l||f.multiple_edit._changed===k?f.multiple_edit.changed:q(f.multiple_edit._changed),q(f.multiple_edit.disable_when_unchanged)&&!A&&(m=!0),q(f.multiple_edit.hide_ui)||!f.multiple_edit.select_list?(g+='<input type="checkbox" class="multiple_edit" id="multiple_edit__'+r(b)+'"'+(A?' checked="checked"':""),g=q(f.multiple_edit.hide_ui)?g+' style="display: none;"':l?g+' disabled="disabled"':g+(' onchange="'+
this.globalName+".meChange(this.checked, '"+r(b)+"');\""),g+="/> "):(g+='<select class="multiple_edit" id="multiple_edit__'+r(b)+'"',g=l?g+' disabled="disabled"':g+(' onchange="'+this.globalName+".meChange(this.value == 1, '"+r(b)+"');\""),g+='><option value=""'+(A?"":' selected="selected"')+">"+E(f.multiple_edit.select_list.not_changed_label,F.notChanged)+'</option><option value="1"'+(A?' selected="selected"':"")+">"+E(f.multiple_edit.select_list.changed_label,F.changed)+"</option></select> "));
d+=g;g=k;f.pre_field_html!==k&&(d+=y.unfun(f.pre_field_html))}if(l||m)s.disabled="disabled";if(f.snippet)f.snippet.html?d+='<span id="snippet__'+r(b)+'">'+f.snippet.html+"</span>":f.snippet.label?d+='<label id="label__'+r(b)+'">'+r(f.snippet.label)+"</label>":f.snippet.url?d=q(f.snippet.cache)?this.cachedAJAXSnippets[f.snippet.url]?d+this.cachedAJAXSnippets[f.snippet.url]:d+(this.cachedAJAXSnippets[f.snippet.url]=y.nonAsyncAJAX(y.addBasePath(f.snippet.url))):d+y.nonAsyncAJAX(y.addBasePath(f.snippet.url)):
f.snippet.separator&&(d+='<hr class="input_separator"',f.snippet.separator.style&&(d+=' style="'+r(f.snippet.separator.style)+'"'),d+="/>");else if(("checkboxes"==f.type||"radios"==f.type)&&n===k)f.values&&(G=this.pickedItemsArray(f,x),I=_.extend({},f),I.name=E(f.name,b),I.type="checkboxes"==f.type?"checkbox":"radio",l&&(I.disabled=!0),d+=this.hierarchicalBoxes(a,e,b,x,f,I,G,m,p,h));else if(f.upload||f.pick_items){var L=f.pick_items&&q(f.pick_items.multiple_select)||f.upload&&q(f.upload.multi);x=
{id:b,pickerHTML:"",wrappedId:"name_for_"+b,readOnly:l,tempReadOnly:m};l||(f.pick_items&&(f.pick_items.target_path||f.pick_items.path)&&!q(f.pick_items.hide_select_button)&&(x.select={onclick:this.globalName+".pickItems('"+r(b)+"');",phrase:f.pick_items.select_phrase||F.selectDotDotDot}),f.upload&&(x.upload={onclick:this.globalName+".upload('"+r(b)+"');",phrase:f.upload.upload_phrase||F.uploadDotDotDot},q(f.upload.drag_and_drop)&&this.upload(b,!0),N.Dropbox&&Dropbox.isBrowserSupported()&&(x.dropbox=
{onclick:this.globalName+".chooseFromDropbox('"+r(b)+"');",phrase:f.upload.dropbox_phrase||F.dropboxDotDotDot})));x.pickerHTML+='<select id="'+r(b)+(L?'" multiple="multiple':"")+'">';f.values&&!_.isEmpty(G)&&(x.pickerHTML+=this.hierarchicalSelect(G,f,p,P,h));x.pickerHTML+="</select>";d+=this.microTemplate(this.mtPrefix+"_picked_items",x);a.after(function(){M.setupPickedItems(b,e,f,l,L)})}else if(f.type){s.onchange=n?this.globalName+".fieldChange('"+r(b)+"', '"+r(n)+"');":this.globalName+".fieldChange('"+
r(b)+"');";f.disabled&&(s["class"]+="disabled ");f.return_key_presses_button&&!l&&(s.onkeyup=E(s.onkeyup,"","")+"if (event.keyCode == 13) {$('#"+r(f.return_key_presses_button)+"').click();}");q(f.multiple_edit)&&!l&&(s.onkeyup=E(s.onkeyup,"","")+"if (event && event.keyCode == 9) return true; "+this.globalName+".meMarkChanged('"+r(b)+"', this.value, '"+r(f.value)+"');");s["class"]+="input_"+f.type;switch(f.type){case "select":f.slider&&(O=!0,d+=this.drawSlider(a,b,f,l,!0));d+="<select";break;case "code_editor":d+=
"<div";s["class"]=" zenario_embedded_ace_editor";a.after(function(){var a=ace.edit(b),d=!1,g;a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);l&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));q(f.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.on("blur",function(a){d&&y.actAfterDelayIfNotSuperseded("code_editor_"+b,function(){M.fieldChange(b)},0);d=!1});a.on("change",function(a){M.markAsChanged();d=!0;y.actAfterDelayIfNotSuperseded("code_editor_"+b,function(){M.fieldChange(b)},
5E3)});if(language=f.language)try{language=language.match(/\.twig\.html$/i)?"ace/mode/twig":language.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(language).mode:"ace/mode/"+language,a.session.setMode(language)}catch(n){console.log("Ace editor could not load that language",language)}if(g=M.editingPositions[e+"/"+b])a.session.setScrollTop(g.top),a.session.setScrollLeft(g.left),a.selection.setSelectionRange(g.range)});break;case "color_picker":case "colour_picker":d+="<input";s["class"]=
" zenario_color_picker";a.after(function(){var a=f.color_picker_options||f.colour_picker_options||{};a.disabled=l;a.preferredFormat=a.preferredFormat||"hex";$(w(b)).spectrum(a)});break;case "editor":d+="<textarea";u.getSkinDesc();var J;m={script_url:K+y.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:k,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,autoresize_max_height:Math.max(Math.floor(0.5*$(N).height()),300),autoresize_bottom_margin:10,
onchange_callback:function(a){M.fieldChange(a.id)},init_instance_callback:function(a){u.enableDragDropUploadInTinyMCE(!1,k,w("row__"+E(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&u.enableDragDropUploadInTinyMCE(!1,k,b)}};G=_.extend({},m,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],image_advtab:!0,visual_table_class:" ",
browser_spellcheck:!0,paste_preprocess:u.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,content_css:k,toolbar:"undo redo | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",style_formats:u.skinDesc.style_formats,oninit:k});g=_.extend({},G,{toolbar:"undo redo | image link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code",file_browser_callback:u.fileBrowser,init_instance_callback:function(a){u.enableDragDropUploadInTinyMCE(!0,
K,w("row__"+E(a.editorId,a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&u.enableDragDropUploadInTinyMCE(!0,K,b)}});A=_.extend({},g,{toolbar:"undo redo | image | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});z=_.extend({},A,{toolbar:"undo redo | link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | outdent indent | code"});l?(J=m,s["class"]=
" tinymce_readonly"):f.insert_image_button?f.insert_link_button?(J=g,s["class"]=" tinymce_with_images_and_links"):(J=A,s["class"]=" tinymce_with_images"):f.insert_link_button?(J=z,s["class"]=" tinymce_with_links"):(J=G,s["class"]=" tinymce");s.style="visibility: hidden;";_.isObject(f.editor_options)&&(J=_.extend(J,f.editor_options));J.setup=function(a){a.on("change",function(a){M.fieldChange(a.id)})};a.after(function(){var a=$(w(b)),e=w("zenario_abtab"),d=e.style.display;e.style.display="block";a.tinymce(J);
e.style.display=d});break;case "button":case "submit":f.pressed=!1;case "toggle":d+="<input";s.type="button";if(!l||q(f.can_be_pressed_in_view_mode))D.onclick=this.globalName+".clickButton(this, '"+b+"');",delete s.disabled;"toggle"==f.type&&(s["class"]+=f.pressed?" pressed":" not_pressed");break;default:"textarea"==f.type?d+="<textarea":"date"==f.type||"datetime"==f.type?(d+="<input",s.type="text",s["class"]+=" zenario_datepicker",q(f.change_month_and_year)&&(s["class"]+=" zenario_datepicker_change_month_and_year"),
s.readonly="readonly",l||(s.onkeyup=E(s.onkeyup,"","")+"zenario.dateFieldKeyUp(this, event, '"+r(b)+"');")):"url"==f.type?(d+="<input",s.type="url",s.onfocus=E(s.onfocus,"","")+"if(!this.value) this.value = 'http://';",s.onblur=E(s.onblur,"","")+"if(this.value == 'http://') this.value = '';"):(f.slider&&(O=!0,d+=this.drawSlider(a,b,f,l,!0)),d+="<input",s.type=f.type,H=!0),this.addExtraAttsForTextFields(f,s)}if("checkbox"==f.type||"radio"==f.type)q(x)&&(s.checked="checked"),x=k,q(f.indeterminate)&&
a.after(function(){var a;if(a=w(b))a.indeterminate=!0});O&&(s.onchange=E(s.onchange,"","")+"$('#zenario_slider_for__"+b+"').slider('value', $(this).val());",s.onkeyup=E(s.onkeyup,"","")+"$('#zenario_slider_for__"+b+"').slider('value', $(this).val());");m=f;n===k?m.id=b:(m=$.extend({},m,I),m.id=b+"___"+n,s["class"]+=" control_for__"+b);"radio"==m.type&&m.name||(m.name=b);for(var B in m)if(t(m,B)&&V[B])if("disabled"==B||"readonly"==B){if(q(s[B])||q(m[B]))d+=" "+B+'="'+B+'"'}else d+=" "+B+'="',s[B]&&
(d+=s[B]+" ",delete s[B]),d+=r(m[B]),D[B]&&(d+=" "+D[B],delete D[B]),d+='"';for(B in s)t(s,B)&&(d+=" "+B+'="'+r(s[B]),D[B]&&(d+=" "+D[B],delete D[B]),d+='"');for(B in D)t(D,B)&&(d+=" "+B+'="'+r(D[B])+'"');"select"==f.type?d+=">":"textarea"==f.type||"editor"==f.type?d+=">"+r(x,!1,"asis")+"</textarea>":"code_editor"==f.type?d+=">"+r(x,!1,"asis")+"</div>":"date"==f.type||"datetime"==f.type?(d+=' value="'+r(y.formatDate(x,"datetime"==f.type))+'"/>',d+='<input type="hidden" id="_value_for__'+r(b)+'" value="'+
r(x)+'"/>',l||(d+='<input type="button" class="zenario_remove_date" value="x" onclick="'+this.globalName+".blankField('"+r(b)+"'); $(zenario.get('"+r(b)+"')).change();\"/>")):d=x!==k?d+(' value="'+r(x,!1,"asis")+'"/>'):d+"/>";if("select"==f.type)f.empty_value&&(d+='<option value="">'+r(f.empty_value)+"</option>"),f.values&&(G={},G[x]=!0,d+=this.hierarchicalSelect(G,f,p,P,h)),d+="</select>";else if(H&&f.values&&!l){var Q=[];for(C in p)t(p,C)&&(A=p[C],Q.push({label:f.values[A],value:A}));a.after(function(){var a=
$(w(b)),e={source:Q,minLength:f.autocomplete_min_length||0,appendTo:a.parent()};f.return_key_presses_button&&(e.select=function(){setTimeout(function(){$("#"+f.return_key_presses_button).click()},0)});a.autocomplete(e);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})})}}n===k&&("url"!=f.type||l||(d+='&nbsp; <input type="button" class="submit" value="Test" onclick="if (get(\''+r(b)+"').value) window.open(zenario.addBasePath(get('"+r(b)+"').value));\"/>"),f.post_field_label!==
k&&(d+='<label for="'+r(b)+'" id="label_for__'+r(b)+'"> '+r(f.post_field_label)+"</label>"),f.post_field_html!==k&&(d+=y.unfun(f.post_field_html)),O&&(d+=this.drawSlider(a,b,f,l,!1)));return d};h.addExtraAttsForTextFields=function(a,e){};h.hierarchicalSelect=function(a,e,b,d,f,g){var n="",h,l,m,p,w;for(p in b)if(t(b,p)){w=b[p];m=e.values[w];l=h="";if(_.isString(m))m={label:m};else if(q(m.disabled)||m.disabled_if!==k&&u.eval(m.disabled_if,m,k,w))h=' disabled="disabled"';a[w]&&(l=' selected="selected"');
g===k&&d&&f[w]?n+='<optgroup label="'+r(m,!1,!0)+'"'+h+">"+this.hierarchicalSelect(a,e,b,d,f,w)+"</optgroup>":g===m.parent&&(n+='<option value="'+r(w)+'"'+l+h+">"+r(m,!1,!0)+"</option>")}return n};h.setupPickedItems=function(a,e,b,d,f){var g=this,n=!1,k,l,m,h=b.pick_items||{},r=b.upload||{};b.pick_items&&!q(h.hide_select_button)&&!q(h.disable_type_ahead_search)&&(b=h.path&&L.convertNavPathToTagPathAndRefiners(h.path),m=h.target_path&&L.convertNavPathToTagPathAndRefiners(h.target_path),b=b&&m&&b.path==
m.path?b:m||b)&&(k=K+"zenario/admin/organizer.ajax.php?_typeahead_search=1&path="+encodeURIComponent(b.path)+y.urlRequest(b.request),l="_search");l=$(w(a)).tokenize({datas:k,searchParam:l,debounce:200,sortable:q(r.reorder_items),placeholder:h.nothing_selected_phrase||F.nothing_selected,onAddToken:function(b,d,k){n||f||(n=!0,g.addToPickedItems(b,a,e),n=!1)},maxElements:f?0:1,parseData:function(b){var f,n,k,h=[],l=g.tuix.tabs[e].fields[a];if(b.items)for(f in b.items)t(b.items,f)&&(n=b.items[f],k=u.formatOrganizerItemName(b,
f),l.values=l.values||{},l.values[f]={list_image:n.list_image,css_class:n.css_class||b.item&&b.item.css_class,label:k},h.push({value:f,text:k,html:g.drawPickedItem(f,a,l,d)}));return h},formatTokenHTML:function(b,f){var n=g.tuix.tabs[e].fields[a];return n.values&&n.values[b]?g.drawPickedItem(b,a,n,d):!1}});d?l.disable():k?l.container.addClass("zenario_picker_with_typeahead"):l.disableTypeAhead()};h.chooseFromDropbox=function(a){var e=this,b,d,f,g,n;if(!(b=this.field(a))||!b.upload)return!1;if(g=b.upload.extensions||
b.upload.accept)g=_.isString(g)?g.split(","):_.toArray(g);for(d in g)t(g,d)&&(f=g[d],n=f.split("/"),n[1]!==k?g[d]="images"==n[0]?"image":n[0]:"text"!=f&&"documents"!=f&&"images"!=f&&"video"!=f&&"audio"!=f&&"."!=f.substr(0,1)&&(g[d]="."+f));b={cancel:function(){u.hideAJAXLoader()},linkType:"direct",multiselect:!!q(b.upload.multi),extensions:g,success:function(b){u.showAJAXLoader();var d,f,g=new y.callback;for(d in b)t(b,d)&&(f=b[d],g.add(y.ajax("zenario/ajax.php?method_call=handleAdminBoxAJAX&fetchFromDropbox=1&path="+
encodeURIComponent(e.path),f,!0)));g.after(function(){var b,d,f,g="";if(!e.tuix.tabs[e.tuix.tab]||!(f=e.tuix.tabs[e.tuix.tab].fields[a])||!f.upload)return!1;for(b in arguments)t(arguments,b)&&((d=arguments[b])&&d.id&&(g+=","+d.id),f.values||(f.values={}),f.values[d.id]||(f.values[d.id]=e.formatLabelFromFile(d)));""!==g&&e.addToPickedItems(g,a);u.hideAJAXLoader()})}};u.showAJAXLoader();Dropbox.choose(b)};h.formatLabelFromFile=function(a){var e;a.filename!==k?(e=a.filename,q(a.width)&&q(a.height)&&
(e+=" ["+a.width+" \u00d7 "+a.height+"px]")):(fileDetails=y.decodeItemIdForOrganizer(a.id))&&(fileDetails=fileDetails.split("/"))&&fileDetails[1]?(e=fileDetails[1],q(fileDetails[2])&&q(fileDetails[3])&&(e+=" ["+fileDetails[2]+" \u00d7 "+fileDetails[3]+"px]")):e=a.id;return e};h.upload=function(a,e){var b=this,d;if(!(d=this.field(a))||!d.upload)return!1;d={class_name:d.class_name,upload:d.upload};this.uploadCallback=function(d){if(d){var e,n,k,h="";if(!b.tuix.tabs[b.tuix.tab]||!(k=b.tuix.tabs[b.tuix.tab].fields[a])||
!k.upload)return!1;for(e in d)t(d,e)&&(n=d[e])&&n.id&&(h+=","+n.id,k.values||(k.values={}),k.values[n.id]||(k.values[n.id]=b.formatLabelFromFile(n)));""!==h&&b.addToPickedItems(h,a)}};e?u.setHTML5UploadFromDragDrop(K+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+encodeURIComponent(b.path),{fileUpload:1},!1,this.uploadCallback,w("zenario_fbAdminInner")):u.action(this,d,k,k,k,{fileUpload:1})};h.uploadComplete=function(a){this.uploadCallback!==k&&this.uploadCallback(a);delete this.uploadCallback};
h.drawSlider=function(a,e,b,d,f){var g=this,n=_.clone(b.slider);b="";if(q(n.before_field)?f:!f)d&&(b+='<div class="ui-disabled">'),b+='<div id="zenario_slider_for__'+r(e)+'" class="'+r(n["class"])+'" style="'+r(n.style)+'"></div>',d&&(b+="</div>"),a.after(function(){var a;if(a=w("zenario_slider_for__"+e))n.min!==k&&(n.min=y.num(n.min)),n.max!==k&&(n.max=y.num(n.max)),n.step!==k&&(n.step=y.num(n.step)),n.disabled=!g.editModeOn(),n.value=$(w(e)).val(),n.slide=function(a,b){$(w(e)).val(b.value)},n.change=
function(a,b){g.fieldChange(e)},$(a).slider(n)});return b};h.pickedItemsArray=function(a,e){if(!1===e||null===e||e===k||!(0!==e&&"0"!==e||a.values&&(a.values[0]||a.values["0"])))return{};var b=(e+"").split(","),d={},f,g,n,h,l,m,p;a._display_value=!1;for(m in b)t(b,m)&&(p=b[m])&&(a.upload&&(l=y.decodeItemIdForOrganizer(p))&&(l=l.split("/"))&&l[1]?(d[p]=l[1],q(l[2])&&q(l[3])&&(d[p]+=" ["+l[2]+" \u00d7 "+l[3]+"px]")):a.values&&a.values[p]&&"string"==typeof a.values[p]?d[p]=a.values[p]:a.values&&a.values[p]&&
a.values[p].label?d[p]=a.values[p].label:((n=a.pick_items&&a.pick_items.target_path)||(n=a.pick_items&&a.pick_items.path))&&(-1==n.indexOf("//")||L.map&&(n=L.convertNavPathToTagPath(n)))&&(f=u.getItemFromOrganizer(n,p))?(a.values||(a.values={}),g=u.formatOrganizerItemName(f,p),h=f.items&&f.items[p]||{},d[p]=g,a.values[p]={list_image:h.list_image,css_class:h.css_class||f.item&&f.item.css_class,label:g}):a.upload&&p==1*p&&(l=u.lookupFileDetails(p))?(a.values||(a.values={}),d[p]=l.filename,q(l.width)&&
q(l.height)&&(d[p]+=" ["+l.width+" \u00d7 "+l.height+"px]"),a.values[p]=d[p]):d[p]=p,!1===a._display_value&&(a._display_value=d[p]));return d};h.pickedItemsValue=function(a){var e,b="";if(a)for(e in a)t(a,e)&&(b+=(""===b?"":",")+e);return b};h.hierarchicalBoxes=function(a,e,b,d,f,g,n,h,l,m,p,u,y){var E=1;if(!y)y=0,E=1*f.cols||1;else if(10<y)return"";u||(u={});p&&(u[p]=!0);var F=0,A="",C,z,G;y&&(A+='<div class="zenario_hierarchical_box_children" id="'+r("children_for___"+b+"___"+p)+'">');for(var H in l)if(t(l,
H)){C={};z=l[H];z==1*z&&(z*=1);var s=k;G="object"==typeof f.values[z]?f.values[z]:{label:f.values[z]};f.tag_colors&&(C.tag_color=f.tag_colors[z]||"blue");s=G.parent;"0"===s&&(s=!1);if(!p&&!s||p==s){if(C.newRow=++F>E)F=1;C.col=F;C.cols=E;s=d?!0===d||1===d||"1"===d?!0===z||1===z||"1"===z:n?n[z]!==k?!0:!1:z==d:!z;C.checked=s;if("checkboxes"==f.type&&q(f.checking_child_checks_parents)){var D="";p&&(D+="if (this.checked) { for (var cb in "+JSON.stringify(u)+") { get('"+r(b)+"___' + cb).checked = true; } } ");
m[z]&&(D+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");D?g.onchange=f.onchange?D+" "+f.onchange:D:f.onchange?g.onchange=f.onchange:delete g.onchange}else"checkboxes"==f.type&&q(f.checking_parent_checks_children)&&(D="",m[z]&&(D+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),D?g.onchange=f.onchange?D+" "+f.onchange:D:f.onchange?g.onchange=f.onchange:delete g.onchange);C.lovId=b+"___"+
z;C.lovField=G;f.indeterminates&&q(f.indeterminates[z])&&function(b){a.after(function(){var a;if(a=w(b))a.indeterminate=!0})}(C.lovId);C.lovHTML=this.drawField(a,e,b,!0,g,k,z,s,!1,h,l,m,G);C.childrenHTML="";m[z]&&(C.childrenHTML=this.hierarchicalBoxes(a,e,b,d,f,g,n,h,l,m,z,_.extend({},u),y+1),F=0);A+=this.microTemplate(this.mtPrefix+"_radio_or_checkbox",C)}}y&&(A+="</div>");return A};h.drawPickedItem=function(a,e,b,d){b===k&&(b=this.field(e));var f={},g=b.values&&b.values[a];_.isObject(g)?(f=g,g=
g.label):(g||(g=a),f.label=g);var n=a==1*a,h;e={id:e,item:a,label:g,readOnly:d,css_class:f.css_class,list_image:f.list_image};b.tag_colors&&(e.tag_color=b.tag_colors[a]||"blue");!b.pick_items||q(b.pick_items.hide_info_button)||b.upload&&!n||!(h=b.pick_items.path)||h!=b.pick_items.target_path&&b.pick_items.min_path!=b.pick_items.target_path||(h="//"==y.rightHandedSubStr(h,2)?h+a:"/"==y.rightHandedSubStr(h,1)?h+("/"+a):h+("//"+a),e.organizerPath=h);b.upload&&(e.isUpload=!0,b=(b=(""+g).match(/(.*?)\.(\w+)$/)||
(""+g).match(/(.*?)\.(\w+) \[.*\]$/))&&b[2]?b[2].toLowerCase():"unknown",e.extension=b,a=n?K+"zenario/file.php?id="+a:K+"zenario/file.php?getUploadedFileInCacheDir="+encodeURIComponent(a),b.match(/gif|jpg|jpeg|png|svg/)?(e.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+a+"&popout=1&dummy_filename="+encodeURIComponent("image."+b)+"', '"+g+"');",src:a+"&og=1"},(g=(""+g).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&g[1]&&g[2]&&u.resizeImage(g[1],g[2],180,120,e.thumbnail)):
e.adminDownload=a+"&adminDownload=1");return this.microTemplate(this.mtPrefix+"_picked_item",e)};h.showPickedItemInPopout=function(a,e){u.action(this,{popout:{href:a,title:e,css_class:"zenario_show_colobox_above_fab"}})};h.pickItems=function(a){var e,b,d;(e=this.field(a))&&(b=e.pick_items)&&(b.path||b.target_path)&&(e=b.path,q(b.multiple_select)||e!=b.target_path&&b.min_path!=b.target_path||!(d=this.readField(a))||-1!=d.indexOf(",")||(e="//"==y.rightHandedSubStr(e,2)?e+d:"/"==y.rightHandedSubStr(e,
1)?e+("/"+d):e+("//"+d)),this.SKTarget=a,u.organizerSelect(this.globalName,"setPickedItems",b.multiple_select,e,b.target_path,b.min_path,b.max_path,b.disallow_refiners_looping_on_min_path,k,b.one_to_one_choose_phrase,b.one_to_many_choose_phrase,k,!0,k,k,k,k,k,k,k,k,b))};h.setPickedItems=function(a,e,b,d){a=this.SKTarget;var f,g,h={};for(f in e._items)t(e._items,f)&&(b=y.decodeItemIdForOrganizer(f),g=d.items&&d.items[b]||{},h[b]={list_image:g.list_image,css_class:g.css_class||d.item&&d.item.css_class,
label:u.formatOrganizerItemName(d,b)});this.addToPickedItems(h,a)};h.removeFromPickedItems=function(a,e,b){this.addToPickedItems(a,e,b,!0)};h.addToPickedItems=function(a,e,b,d){b=this.field(e,b);var f=this.readField(e),g=b.pick_items&&q(b.pick_items.multiple_select)||b.upload&&q(b.upload.multi),h,k;a=u.csvToObject(a);k=g&&f?this.pickedItemsArray(b,f):{};for(h in a)if(t(a,h))if(f=a[h],b.values||(b.values={}),d)delete b.values[h];else if(b.values[h]||(b.values[h]=f),k[h]=!0,!g)break;this.redrawPickedItems(e,
b,k)};h.redrawPickedItems=function(a,e,b){var d,f,g=this.pickedItemsValue(b),h={},k=$(w(a)).tokenize(),l=k.toArray();b=u.csvToObject(b);for(d in l)t(l,d)&&(f=l[d],b[f]?h[f]=!0:k.tokenRemove(f));for(f in b)t(b,f)&&!h[f]&&(d=e.values&&e.values[f],_.isObject(d)?d=d.label:d||(d=f),k.tokenAdd(f,d));e.current_value=g;this.fieldChange(a)};h.changes=function(a){if(this.tuix&&this.tuix.tab){if(a==k){for(a in this.tuix.tabs)if(t(this.tuix.tabs,a)&&this.changed[a])return!0;return!1}return this.changed[a]}return!1};
h.markAsChanged=function(a){this.tuix&&(a===k&&(a=this.tuix.tab),a&&!this.changed[a]&&(this.changed[a]=!0,this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};h.fieldChange=function(a,e){var b=this,d=this.field(a);d&&(d.indeterminate&&(d.indeterminate=!1),e!==k&&d.indeterminates&&d.indeterminates[e]&&(d.indeterminates[e]=!1),this.markAsChanged(),q(d.multiple_edit)&&this.meMarkChanged(a),setTimeout(function(){b.validateFormatOrRedrawForField(d)},1))};h.validateFormatOrRedrawForField=
function(a){a=this.field(a);var e=q(a.validate_onchange),b=q(a.format_onchange);a=q(a.redraw_onchange);if(e=e||this.errorOnTab(this.tuix.tab)&&b)return this.validate(),!0;if(b)return this.format(),!0;a&&(this.readTab(),this.redrawTab());return a};h.meMarkChanged=function(a,e,b){if(e===k||e!=b)this.field(a).multiple_edit._changed=!0,this.meSetCheckbox(a,!0)};h.meSetCheckbox=function(a,e){"checkbox"==w("multiple_edit__"+a).type?w("multiple_edit__"+a).checked=e:w("multiple_edit__"+a).value=e?1:""};h.meChange=
function(a,e,b){var d=this.field(e);if(a)d.multiple_edit._changed=!0;else{if(!b&&q(d.multiple_edit.warn_when_abandoning_changes)&&d.multiple_edit.original_value!==k&&this.readField(e)!=d.multiple_edit.original_value){d='<input type="button" class="submit_selected" value="'+F.abandonChanges+'" onclick="'+this.globalName+".meChange(false, '"+r(e)+'\', true);"/><input type="button" class="submit" value="'+F.cancel+'"/>';u.floatingBox(F.abandonChangesConfirm,d,"warning");this.meSetCheckbox(e,!0);return}d.multiple_edit._changed=
!1;delete d.current_value;b=d.value;d.multiple_edit.original_value!==k&&(b=d.current_value=d.multiple_edit.original_value);if(w(e)&&!d.pick_items)"checkbox"==w(e).type?w(e).checked=b?!0:!1:$(w(e)).val(E(b,"",""));else{b=new y.callback;var f=this.drawFields(b);this.insertHTML(f,b)}}q(d.multiple_edit.disable_when_unchanged)&&(w(e)&&(w(e).disabled=!a),$(".control_for__"+e).each(function(b,d){d.disabled=!a;"button"==d.type&&(a?$(d).removeClass("submit_disabled"):$(d).addClass("submit_disabled"))}));this.meSetCheckbox(e,
a);this.validateFormatOrRedrawForField(e)};h.currentValue=function(a,e,b){return b||e!=this.tuix.tab?this.value(a,e,b):this.readField(a)};h.value=function(a,e,b,d){e||(e=this.tuix.tab);a=this.field(a,e);b===k&&(b=!this.editModeOn(e));return!a||a.snippet||"grouping"==a.type?"":d||"submit"!=a.type&&"toggle"!=a.type&&"button"!=a.type?b||a.current_value===k?a.value!==k?a.value:a.multiple_edit&&a.multiple_edit.original_value!==k?a.multiple_edit.original_value:"":a.current_value:!!a.pressed};h.isFormField=
function(a){return!(!a||a.snippet||"grouping"==a.type||"submit"==a.type||"toggle"==a.type||"button"==a.type)};h.readField=function(a){var e=k,b=this.tuix.tab,d=this.field(a,b),f;if(!this.isFormField(d))return k;var g=!this.editModeOn()||q(d.read_only),h=d._was_hidden_before;d.multiple_edit&&g&&delete d.multiple_edit._changed;if("checkboxes"==d.type||"radios"==d.type){if(!g&&!h&&d.values){var x,h="",l=!0;for(x in d.values)t(d.values,x)&&w(a+"___"+x)&&w(a+"___"+x).checked&&(h+=(l?"":",")+x,l=!1);d.current_value=
h}h=!0}if(h)return g||d.current_value===k?d.value:d.current_value;if(w("_value_for__"+a))d.current_value=e=w("_value_for__"+a).value;else if("editor"!=d.type&&"code_editor"!=d.type||g)if(!g&&(f=w(a))){if("checkbox"==d.type||"radio"==d.type)e=f.checked?!0:!1;else if("color_picker"==d.type||"colour_picker"==d.type)try{e=$(f).spectrum("get").toHexString()}catch(m){e=$(f).val()}else e=$(f).val();_.isArray(e)&&(e=e.join(","));d.current_value=e}else delete d.current_value,e=d.value;else if(e=k,"editor"==
d.type?N.tinyMCE&&tinyMCE.get(a)&&(e=y.tinyMCEGetContent(tinyMCE.get(a))):"code_editor"==d.type&&(f=ace.edit(a))&&(e=f.getValue(),this.editingPositions[b+"/"+a]={top:f.session.getScrollTop(),left:f.session.getScrollLeft(),range:f.getSelectionRange()}),e!==k&&!1!==e)e=d.current_value=e;else return d.current_value===k?d.value:d.current_value;return e};h.blankField=function(a){w(a)&&$(w(a)).val("");w("_value_for__"+a)&&(w("_value_for__"+a).value="");field.current_value=""};h.readTab=function(){var a,
e={},b=this.fields(),d;this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(d in b)t(b,d)&&(a=this.readField(d))!==k&&(e[d]=a);H&&H.activeElement&&(this.lastFieldInFocus=H.activeElement.id);return e};h.wipeTab=function(){var a=this.fields(),e,b;for(e in a)t(a,e)&&(b=a[e],delete b.current_value,b.multiple_edit&&delete b.multiple_edit._changed)};h.redrawTab=function(){this.tuix.shake=!1;this.draw2()};h.getURL=function(a){++this.onKeyUpNum;return this.returnAJAXURL(a)};h.returnAJAXURL=function(a){return"..."};
h.editModeOn=function(a){return!0};h.editModeAlwaysOn=function(a){return!0};h.editCancelEnabled=function(a){return!1};h.revertEnabled=function(a){return!1};h.savedAndContinued=function(a){return!1};h.editModeOnBox=function(){return!0};h.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(t(this.tuix.tabs,a)){var e=this.tuix.tabs[a];e&&this.sortedTabs.push([a,e.ord])}this.sortedTabs.sort(u.sortArray);this.sortedFields={};for(a in this.sortedTabs)t(this.sortedTabs,
a)&&(e=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(e))};h.sortFields=function(a){var e,b,d,f,g={};this.sortedFields[a]=[];if(d=this.fields(a)){for(e in d)t(d,e)&&(b=d[e],b.type&&"grouping"==b.type&&(g[b.name||e]=1*b.ord));for(e in d)t(d,e)&&(!(b=d[e])||b.type&&"grouping"==b.type||(f=b.grouping?g[b.grouping]:k,this.sortedFields[a].push([e,b.ord,f])));this.sortedFields[a].sort(u.sortArrayWithGrouping);for(e in this.sortedFields[a])t(this.sortedFields[a],e)&&(this.sortedFields[a][e]=this.sortedFields[a][e][0])}};
h.setData=function(a){this.tuix=a};h.setDataDiff=function(a){this.syncAdminBoxFromServerToClient(a,this.tuix)};h.syncAdminBoxFromServerToClient=function(a,e){for(var b in a)a[b]["[[__unset__]]"]?delete e[b]:e[b]===k||null===e[b]?e[b]=a[b]:a[b]["[[__replace__]]"]?(delete a[b]["[[__replace__]]"],e[b]=a[b]):"object"!=typeof e[b]?e[b]=a[b]:"object"==typeof e[b]&&"object"!=typeof a[b]?e[b]=a[b]:this.syncAdminBoxFromServerToClient(a[b],e[b])};h.sendStateToServer=function(){return JSON.stringify(this.tuix)};
h.sendStateToServerDiff=function(){var a={};this.syncAdminBoxFromClientToServerR(a,this.tuix);return JSON.stringify(a)};h.syncAdminBoxFromClientToServerR=function(a,e,b,d,f,g,h,q){if("object"==typeof e){var l,m;for(m in e)if((l="array")&&b===k&&"_sync"==m||(l="value")&&d===k&&"_sync"==b&&"session"==m||(l="value")&&d===k&&"_sync"==b&&"cache_dir"==m||(l="value")&&d===k&&"_sync"==b&&"password"==m||(l="value")&&d===k&&"_sync"==b&&"iv"==m||(l="value")&&b===k&&"shake"==m||(l="value")&&b===k&&"download"==
m||(l="array")&&b===k&&"tabs"==m||(l="array")&&d===k&&"tabs"==b||(l="array")&&f===k&&"tabs"==d&&"edit_mode"==m||(l="value")&&g===k&&"tabs"==f&&"edit_mode"==b&&"on"==m||(l="array")&&f===k&&"tabs"==d&&"fields"==m||(l="array")&&g===k&&"tabs"==f&&"fields"==b||(l="value")&&h===k&&"tabs"==g&&"fields"==d&&"current_value"==m||(l="value")&&h===k&&"tabs"==g&&"fields"==d&&"_display_value"==m||(l="value")&&h===k&&"tabs"==g&&"fields"==d&&"_was_hidden_before"==m||(l="value")&&h===k&&"tabs"==g&&"fields"==d&&"pressed"==
m||(l="array")&&h===k&&"tabs"==g&&"fields"==d&&"multiple_edit"==m||(l="value")&&q===k&&"tabs"==h&&"fields"==f&&"multiple_edit"==b&&"_changed"==m)"value"==l?"function"!=typeof e[m]&&"object"!=typeof e[m]&&(a[m]=e[m]):"array"==l&&"object"==typeof e[m]&&(a[m]={},this.syncAdminBoxFromClientToServerR(a[m],e[m],m,b,d,f,g,h))}};h.getValueArrayofArrays=function(a){return y.nonAsyncAJAX(this.getURL(),y.urlRequest({_read_values:!0,_box:this.sendStateToServer()}),!a)};h.getValues1D=function(a,e,b,d,f){var g,
h,r,l,m,p={};if(this.tuix&&this.tuix.tabs)for(g in this.tuix.tabs)if(t(this.tuix.tabs,g)&&(h=this.tuix.tabs[g],h.fields))for(r in h.fields)t(h.fields,r)&&(l=h.fields[r],m=r,this.isFormField(l)&&!(d&&(!this.editModeOn(g)||q(l.read_only))||f&&(l._was_hidden_before||q(l.read_only))||a&&!(m=l.plugin_setting&&l.plugin_setting.name))&&(l=this.currentValue(r,g,b),e||(p[m]=l),e||e===k))&&(p[g+"/"+r]=l);return p};h.callFunctionOnEditors=function(a){var e,b,d;if(N.tinyMCE&&(e=this.fields()))for(b in e)if(t(e,
b)&&(d=e[b],"editor"==d.type&&tinyMCE.get(b)))if("remove"==a)tinyMCE.get(b).remove();else if("isDirty"==a&&tinyMCE.get(b).isDirty())return!0;return!1};h.format=function(a){var e;if(this.loaded&&(e=this.getURL("format"))){var b=this;this.loaded=!1;this.hideTab();this.checkValues(a);this.retryAJAX(e,{_format:!0,_box:this.sendStateToServer()},function(a){b.load(a);b.sortTabs();b.draw()},"loading")}};h.validate=function(a,e,b,d){var f;if(this.loaded&&(f=this.getURL("validate"))){this.differentTab=a;this.loaded=
!1;this.hideTab(a);this.checkValues(b);var g=this;this.retryAJAX(f,{_validate:!0,_box:this.sendStateToServer()},function(a){g.load(a)&&!g.errorOnTab(g.tuix.tab)&&e!==k&&(g.tuix.tab=e);g.sortTabs();g.switchToATabWithErrors();g.draw();d&&d()},"loading")}}},zenarioF);
