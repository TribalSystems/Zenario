zenario.lib(function(h,X,S,ba,Fa,Ga,q,G,J,za,Ha,T,U,p,s,Aa,E,V,O,Ia,Ba,t,Ca){J.lib(function(ja,ga,ca,qa,ka,Da,la){var f=Ba(Ca);f.init=function(a,d,e){this.globalName=a;this.mtPrefix=d;this.containerId=e;this.baseCSSClass="";this.onKeyUpNum=0;za.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={};this.fieldThatTriggeredRedraw=this.lastFocus=!1;this.editingPositions={}};f.enableInlineErrors=function(){return!0};f.get=function(a){return this.containerId&&$("#"+this.containerId+
" #"+q._cE(a))[0]||Aa(a)};f.microTemplate=function(a,d,e){var b=q._aLP(d,this);a=q._mT(a,d,e);b&&q._tLP(d);return a};f.pMicroTemplate=function(a,d,e){return this.microTemplate(this.mtPrefix+"_"+a,d,e)};f.fun=function(a){return this.globalName+"."+a};f.onThisRow=function(a,d){return a+d.r(/(.*_|\D)/g,"")};f.valueOnThisRow=function(a,d){return this.value(this.onThisRow(a,d))};f.fieldOnThisRow=function(a,d){return this.field(this.onThisRow(a,d))};f.getKey=function(a){return this.tuix&&this.tuix.key};
f.getKeyId=function(a){return this.tuix&&this.tuix.key&&this.tuix.key.id};f.getLastKeyId=function(a){return this.getKeyId(a)};f.getTitle=function(){var a,d;if(this.tuix.key&&this.tuix.key.id&&(a=this.tuix.title_for_existing_records)){d=this.getValues1D(!1,h,!0);for(c in d)if(t(d,c)&&(v=d[c],-1!=a.indexOf("[["+c+"]]")))for(;a!=(string2=a.r("[["+c+"]]",v));)a=string2;return a}return this.tuix.title};f.field=function(a,d){return _._isOb(a)?a:(tabs=this.tuix&&this.tuix.tabs)&&(d=d||this.tuix.tab)&&tabs[d]&&
tabs[d].fields&&tabs[d].fields[a]};f.fields=function(a){var d;return(d=this.tuix&&this.tuix.tabs)&&(a=a||this.tuix.tab)&&d[a]&&d[a].fields};f.initFields=function(){var a=this.tuix.tab,d,e,b,k,g,D=this.tuix.lovs||{};if(this.tuix.tabs)for(d in this.tuix.tabs)if(t(this.tuix.tabs,d)&&(b=this.fields(d))){g=!1;for(e in b)t(b,e)&&(k=b[e])&&(k.pick_items&&k.plugin_setting&&k.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(e,this.value(e,d,!1)):k.values&&_._iS(k.values)&&D[k.values]?k.values=
D[k.values]:k.load_values_from_organizer_path&&!k.values&&this.loadValuesFromOrganizerPath(k),k.validation&&p(k.validation.required_if_not_hidden)&&(g=!0));g&&d!=a&&(this.tuix.tab=d,this.drawFields(h,h,!0),this.tuix.tab=a)}};f.loadValuesFromOrganizerPath=function(a){var d,e,b;if(a.load_values_from_organizer_path&&!a.values&&(a.values={},(e=G._gIFO(a.load_values_from_organizer_path))&&e.items))for(d in e.items)t(e.items,d)&&(b=e.items[d],a.values[q._dIIFO(d)]={list_image:b.list_image,css_class:b.css_class||
e.item&&e.item.css_class,label:G._fOIN(e,d)})};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};f.editCancelOrRevert=function(a,d){if(this.tuix.tabs[d].edit_mode){var e,b,k,g,D,f;"edit"==a?(D=s(this.tuix.tabs[d].edit_mode.format_on_edit),
f=s(this.tuix.tabs[d].edit_mode.validate_on_edit)):"cancel"==a?(D=s(this.tuix.tabs[d].edit_mode.format_on_cancel_edit),f=s(this.tuix.tabs[d].edit_mode.validate_on_cancel_edit)):"revert"==a&&(D=s(this.tuix.tabs[d].edit_mode.format_on_revert),f=this.errorOnTab(d)||s(this.tuix.tabs[d].edit_mode.validate_on_revert));if(!f&&(b=this.fields(d)))for(k in b)if(t(b,k))if(g=b[k],s(g.validate_onchange)&&p(e=this.readField(k))&&e!=g.value){f=!0;break}else!D&&s(g.format_onchange)&&p(e=this.readField(k))&&e!=g.value&&
(D=!0);this.tuix.tabs[d].edit_mode.on="cancel"!=a;this.changed[d]=!1;f?this.validate(h,h,!0):D?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==d&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&this.validate(a!=this.tuix.tab,a)};f.clickButton=function(a,d){var e;if(e=this.field(d))if("submit"==e.type)e.pressed=!0,this.validate(!0);else if("toggle"==e.type){var b=$(this.get(d)),k=$(this.get("row__"+d));(e.pressed=!s(e.pressed))?(b.removeClass("not_pressed").addClass("pressed"),
k.addClass("zfea_row_pressed")):(b.removeClass("pressed").addClass("not_pressed"),k.removeClass("zfea_row_pressed"));this.markAsChanged();this.validateFormatOrRedrawForField(e,!0)}else"button"==e.type&&(e.pressed=!0,this.validateFormatOrRedrawForField(e))};f.togglePressed=function(a,d){var e;e=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;p(e)||(e=!0);d&&"toggle"==d.type&&(this.toggleLevelsPressed.last=e&&s(d.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));
return e};f.toggleLevel=function(a){return this.toggleLevelsPressed.last};f.retryAJAX=function(a,d,e,b,k,g){var D=function(){q._a(a,d,e,h,D,!0,h,h,h,h,g).after(b);k&&G.nowDoingSomething&&G._nDS(k)};D()};f.switchToATabWithErrors=function(){var a,d,e=this.tuix;if(e&&e.tabs&&!this.errorOnTab(e.tab))for(a in this.sortedTabs)if(t(this.sortedTabs,a)&&(d=this.sortedTabs[a],e.tabs[d]&&!J._h(h,this,h,d,h,h,h,h,e.tabs[d])&&this.errorOnTab(d)))return e.tab=d,!0;return!1};f.applyMergeFields=function(a,d,e,b){return a};
f.applyMergeFieldsToLabel=function(a,d,e,b){return a};f.hideTab=function(a){var d=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){d.tabHidden=!0;d.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),d.tabHidden=!0,d.draw())};f.draw=function(){this.loaded&&
this.tabHidden&&this.draw2()};f.draw2=function(){};f.size=function(){};f.makeFieldAsTallAsPossible=function(){};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var d,e,b=[],k,g,D,f,n=function(a,b,d){for(b in a)if(t(a,b)){d=a[b];if(d.onclick){g&&(f=d.id);if(g=d.current)D=k;k=d.id}d.children&&n(d.children)}};for(i in this.sortedTabs)if(t(this.sortedTabs,i)&&(tab=this.sortedTabs[i],(d=this.tuix.tabs[tab])&&!(d._was_hidden_before=J._h(h,this,h,tab,h,h,h,h,d)))){e="";if(d.fields&&!_._isEm(d.fields)||
d.fields&&!_._isEm(d.errors)||d.fields&&!_._isEm(d.notices))e=this.globalName+".clickTab('"+V(tab)+"');";!this.tuix.tab&&e&&(this.tuix.tab=tab);b.push({id:tab,tabId:tab,tuix:d,onclick:e,current:this.tuix.tab==tab,label:d.label})}J._sBK(b,"zenario_fab_tab_with_children");n(b);this.prevTab=D;this.nextTab=f;return this.microTemplate(a,b)};f.drawFields=function(a,d,e){var b,k,g,D=this.tuix.tab,f=this.tuix.tabs[D],n=this.groupings[D],K=this.sortedFields[D],l,u="",B=!1,z,q=this.fields(D),r={},y={},H={},
C=!1,E,L,I=!1,G={},w={fields:{},rows:[],tabId:D,path:this.path,tuix:this.tuix,revert:"",errors:[],notices:{}};this.drawingFields=!0;if(!e){this.ffoving=0;this.splitValues={};this.tallAsPossibleField=h;this.errorOnForm=!1;this.disableDragDropUpload();!this.savedAndContinued(D)&&this.editCancelEnabled(D)&&(w.revert=ga("class","zenario_editCancelButton",J._i("class","submit","type","button","onclick",this.globalName+".changeMode(); return false;","value",this.editModeOn()?O.cancel:O.edit)));if(this.editModeOn()){if(f.errors)for(z in f.errors)t(f.errors,
z)&&(g=f.errors[z],this.errorOnForm=!0,w.errors.push({message:g}));if(q)for(z in q)if(t(q,z)&&(g=q[z],g.error))if(this.errorOnForm=!0,this.enableInlineErrors()&&(l=this.tuix.error_on_form_message||O.errorOnForm)){w.errors.push({message:l});break}else w.errors.push({message:g.error})}if(f.notices)for(z in f.notices)t(f.notices,z)&&(g=f.notices[z],s(g.show)&&{error:1,warning:1,question:1,information:1,success:1}[g.type]&&(w.notices[z]=g));this.setPhiVariables()}for(b in K)t(K,b)&&(k=K[b],g=q[k],z=!1,
l=g.grouping,E!==l&&(E=l,I=p(n[l])&&q[n[l]],B=l&&(!I||J._h(h,this,h,n[l],h,h,I))),L!==l&&(z=!0),g._id=k,g._html=this.drawField(a,D,k,g,r,y,H,e,B),e||B||!1===g._html||((z||g._startNewRow||!w.rows.length)&&w.rows.push({fields:[],grouping:I}),z&&I&&(I.legend||I.snippet)&&(I=_._ex({grouping:l},I),I._id=l,I._html=this.drawField(a,D,l,I),I._hideOnOpen=!0,I._showOnOpen=!0,I._lastVisibleGrouping=L,L=l,w.rows[w.rows.length-1].fields.push(I),w.fields[l]=I,G[l]=I,w.rows.push({fields:[]})),C||f.show_errors_after_field!=
k||(w.rows[w.rows.length-1].errors=w.errors,w.rows[w.rows.length-1].notices=w.notices,C=!0),g._lastVisibleGrouping=L,L=l,w.rows[w.rows.length-1].fields.push(g),w.fields[k]=g));for(k in w.fields)t(w.fields,k)&&(g=w.fields[k],l=g.grouping)&&(I=G[l])&&(I._hideOnOpen&=g._hideOnOpen,I._showOnOpen&=g._showOnOpen);e||(w.rows.length&&(w.rows[w.rows.length-1].fields[0]._isLastRow=!0),C||w.rows.splice(0,0,{errors:w.errors,notices:w.notices}),d=d||f.template||this.mtPrefix+"_current_tab",u+=this.microTemplate(d,
w));this.drawingFields=!1;for(b in K)t(K,b)&&(k=K[b],delete q[k]._lastVisibleGrouping,delete q[k]._startNewRow,delete q[k]._hideOnOpen,delete q[k]._showOnOpen,delete q[k]._isLastRow,delete q[k]._html,delete q[k]._id);return u};f.drawTUIX=function(a,d,e){this.tuix={tab:"details",tabs:{details:{template:d,edit_mode:{on:!0,enabled:!0,always_on:!0},fields:a}}};this.sortTabs();return this.drawFields(e)};f.insertHTML=function(a,d,e){var b=this.get("zenario_abtab"),k=this.lastFocus||this.fieldThatTriggeredRedraw,
g;b.innerHTML=a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(b).addClass("zenario_abtab_changed"):$(b).removeClass("zenario_abtab_changed");d.call();(g=!e&&k&&this.field(k.id))&&this.focusField(g,k.ss,k.se);this.fieldThatTriggeredRedraw=!1};f.hideShowFields=function(a){var d=$(".zenario_hide_on_open"),e=$(".zenario_hide_row_on_open"),b=$(".zenario_show_on_open"),k=function(a,b){b.style.display="none"};b.length&&!d.length?b.show("blind",200,a):!b.length&&d.length?d.hide("blind",200,function(){e.each(k)}):
b.length&&d.length&&(d.each(k),e.each(k),b.show())};f.addJQueryElements=function(a){q._aJQE(a+" ",!0);$(a+" select.iconselectmenu").iconselectmenu({width:"auto",change:function(){$(this).change()}})};f.addJQueryElementsToTab=function(){this.addJQueryElements("#zenario_abtab")};f.addJQueryElementsToTabAndFocusFirstField=function(){this.addJQueryElementsToTab();this.focusFirstField()};f.fieldIsReadonly=function(a,d,e){return d.show_as_a_label||d.show_as_a_span||s(d.read_only)||s(d.readonly)||p(e)&&
!this.editModeOn(e)||p(d.readonly_if)&&J._e(d.readonly_if,this,d,h,a,h,h,d)};f.focusFirstField=function(){var a=this;if(a.tuix&&!s(a.tuix.tabs[a.tuix.tab].disable_autofocus)){var d=-1,e=[],b=h,k,g,f,A,n;for(k in a.sortedFields[a.tuix.tab])if(t(a.sortedFields[a.tuix.tab],k)&&(A=a.sortedFields[a.tuix.tab][k],(g=a.get(A))&&(f=a.field(A))&&((n=f.pick_items||f.upload)||$(g).is(":visible"))&&(e[++d]={id:A,type:f.type,empty:""==g.value,focusable:(n||q.IN(f.type,"password","checkbox","select","text","textarea"))&&
!s(g.disabled)&&!s(g.readonly)&&!a.fieldIsReadonly(A,f)},1<d)))break;if(e[0]&&!e[0].empty&&e[1]&&e[1].focusable&&e[1].empty&&"password"==e[1].type)b=1;else if(e[0]&&e[0].focusable)b=0;else if(e[1]&&e[1].focusable)b=1;else return;setTimeout(function(){a.focusField(e[b])},50)}};f.focusField=function(a,d,e){if(a.type){if("date"==a.type||"datetime"==a.type)return;a=this.get(a.id)}else a=this.$getPickItemsInput(a.id);if(a&&(a.focus(),p(d)))try{a.selectionStart=d,a.selectionEnd=e}catch(b){}};f.$getPickItemsInput=
function(a){return $(this.get("name_for_"+a)).find(".TokenSearch input")};f.setPhiVariables=function(){q.phiVariables=h};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(t(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var d;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(d in this.tuix.tabs[a].errors)if(t(this.tuix.tabs[a].errors,d))return!0;if(a=this.fields(a))for(d in a)if(t(a,d)&&a[d].error)return!0}};
f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var d in this.tuix.tabs)if(t(this.tuix.tabs,d)){a=this.tuix.tabs[d];var e=this.editModeOn(d);if(a.fields)for(var b in a.fields)if(t(a.fields,b)){var k=a.fields[b];this.isFormField(k)&&("code_editor"==k.type&&q._cAD("code_editor_"+b),p(k.current_value)||(k.current_value=this.value(b,d,!0)),e&&(p(k.value)||(k.value=this.value(b,d,!1)),k.multiple_edit&&!p(k.multiple_edit._changed)&&p(k.multiple_edit.changed)&&(k.multiple_edit._changed=k.multiple_edit.changed)))}}S&&
S.activeElement&&(this.lastFocus=this.setLastFocus(S.activeElement))};f.setLastFocus=function(a){var d;"object"===typeof a?(d=a,a=d.id):d=this.get(a);a={id:a};if(d)try{a.ss=d.selectionStart,a.se=d.selectionEnd}catch(e){a.ss=a.se=h}return a};f.enableMicroTemplates=function(a,d){var e=this,b;for(b in d)if(t(d,b))switch(typeof d[b]){case "object":"lib"!==b&&"thus"!==b&&"tuix"!==b&&e.enableMicroTemplates(a,d[b]);break;case "string":"type"===b||"value"===b&&e.isFormField(d)||"current_value"===b||!d[b].m(/(\{\{|\{\%|\<\%)/)||
function(a,b,d){d=q._gMT("<% "+e.defineLibVarBeforeCode()+" %>"+a[b],h);a[b]=function(){return d(a)}}(d,b)}};f.displayAsTag=function(a,d){return a.show_as_a_label||d&&a.show_as_a_label_when_readonly?"label":a.show_as_a_span||d&&a.show_as_a_span_when_readonly?"span":!1};f.drawField=function(a,d,e,b,k,g,f,A,n,K,l,u,B,z,Y){var r=this;p(b)||(b=r.field(e,d));p(b.id)||(b.id=e);s(b.enable_microtemplates_in_properties)&&r.enableMicroTemplates(b,b);var y=b.type,H=b.upload,C=b.pick_items,ma=b.disabled,L=b.validation||
{},I="date"==y||"datetime"==y,S,w,Q,F,R,m="",N,U,M,P={},da="multiselect"==y,T=!1,x={"class":""},Z={},ea={},na=!1,aa=!1,oa,ra=!1,sa=!1,ta=!1,ua=!1,va=!1,pa=M=!1,ha,ia,fa=r.tuix.tabs[d];p(u)||(u=r.fieldIsReadonly(e,b,d));C&&ma&&(u=!0);y&&"datetime"==y&&(u=!0);Y?p(Y.disabled_if)&&J._e(Y.disabled_if,r,Y,h,K,h,h,b)&&(u=!0):p(b.disabled_if)&&J._e(b.disabled_if,r,h,h,e,h,h,b)&&(u=!0);!b["class"]&&b.css_class&&(b["class"]=b.css_class);b.snippet||p(l)||(l=r.value(e,d));p(l)||(l="");if(!p(K)){delete b.selected_option;
if(l&&b.values)if(w=_._isOb(b.values)?b.values[l]:r.tuix.lovs&&r.tuix.lovs[b.values]&&r.tuix.lovs[b.values][l],_._isOb(w)&&J._h(w,r,h,l,h,h,b,h,fa)&&(w=!1),w)b.selected_option=w;else if("radio"==y||"select"==y)b.current_value=l="";(H||C||da)&&""!=l&&(P=r.pickedItemsArray(b,l));b.values&&_._iS(b.values)&&r.tuix.lovs&&r.tuix.lovs[b.values]?b.values=r.tuix.lovs[b.values]:b.load_values_from_organizer_path&&!b.values&&r.loadValuesFromOrganizerPath(b);for(Q in b)t(b,Q)&&"<"==Q[0]&&(oa=Q.m(/^<(\/?)(\w+)/))&&
(b[Q]&&_._iS(b[Q])&&(Q+=b[Q]),N={table:1,tr:2,td:3,th:4,br:5,div:6,p:7,span:8}[oa[2]]||9,5>N&&(va=!0),oa[1]?(pa||(pa=!0,ia="        ".split(" ")),ia[9-N]+=Q):(M||(M=!0,ha="        ".split(" ")),ha[N-1]+=Q,1==N&&(ua=!0),5==N&&(ta=!0)))}A||"button"!=y&&"submit"!=y||(b.pressed=!1);if(A||!p(K)){Q=p(b.same_row)?!s(b.same_row):!ta&&(ua||!va);b._startNewRow=Q;w=1*b.indent||0;n=n||J._h(h,r,h,e,h,h,b)||u&&b.hide_when_readonly||s(g&&g.last?b.hide_with_previous_field:b.hide_if_previous_field_is_not_hidden)||
s(g&&g.beforeLast?b.hide_with_previous_previous_field:b.hide_if_previous_previous_field_is_not_hidden)||s(b.hide_with_previous_indented_field)&&g&&g[w]||s(b.hide_with_previous_outdented_field)&&0<w&&g&&g[w-1]||s(b.hide_with_previous_indented_fields)&&!k[w]||p(b.hide_if_previous_value_isnt)&&!q._iL(b.hide_if_previous_value_isnt,f&&f.last)||p(b.hide_if_previous_outdented_value_isnt)&&0<w&&!q._iL(b.hide_if_previous_outdented_value_isnt,f&&f[w-1]);f&&(f.last=l,Q&&(f[w]=l));g&&(g.beforeLast=g.last,g.last=
n,Q&&(g[w]=n),p(k.last)&&k.last===w||(k.last<w&&(k[w]=!1),k.last=w),n||(k[w]=!0));b._startNewRow&&!1!==r.shownTab&&r.shownTab==r.tuix.tab&&"editor"!=y&&"code_editor"!=y&&b._was_hidden_before&&!n?b._showOnOpen=!0:b._startNewRow&&!1!==r.shownTab&&r.shownTab==r.tuix.tab&&"editor"!=y&&"code_editor"!=y&&!b._was_hidden_before&&n&&(b._hideOnOpen=S=!0,b._was_hidden_before=!0);if(n){if(b._was_hidden_before=!0,!S)return!1}else delete b._was_hidden_before;if(A)return;n||!b.tall_as_possible||p(r.tallAsPossibleField)||
(r.tallAsPossibleField=e,r.tallAsPossibleFieldType=b.type);b.multiple_edit&&(k="",g=!u&&p(b.multiple_edit._changed)?s(b.multiple_edit._changed):b.multiple_edit.changed,s(b.multiple_edit.hide_ui)||!b.multiple_edit.select_list?(f=s(b.multiple_edit.hide_ui),k+=ca("type","checkbox","class","multiple_edit","id","multiple_edit__"+e,"checked",g,"style",f?"display: none;":"","disabled",u,"onchange",u||f?"":r.globalName+".meChange(this.checked, '"+E(e)+"');",">")):k+=qa("class","multiple_edit","id","multiple_edit__"+
e,"disabled",u,"onchange",r.globalName+'.meChange(this.value == 1, "'+V(e)+'");',ka("value","","selected",!g,b.multiple_edit.select_list.not_changed_label||O.notChanged)+ka("value",1,"selected",g,b.multiple_edit.select_list.changed_label||O.changed)),m+=k,k=h);M&&(m+=ha.join(""));p(b.pre_field_html)&&(m+=q._un(b.pre_field_html))}if(!(B&&z||"object"!=typeof b.values))if(B=[],z={},H&&s(H.reorder_items)||C&&s(C.reorder_items))for(N in M=l.s(","),M)t(M,N)&&(F=M[N],B.push(F));else{for(F in b.values)t(b.values,
F)&&(M=b.values[F],"object"==typeof M?(p(M.parent)&&(aa=!0,z[M.parent]=!0),J._h(M,r,h,F,h,h,b,h,fa)||b.values_visible_if&&!J._e(b.values_visible_if,r,M,h,F,h,h,b,h,fa)||(p(M.ord)?B.push([F,M.ord]):p(M.label)?B.push([F,M.label]):B.push([F,F]))):B.push([F,M]));B.sort(J.sortArray);for(N in B)t(B,N)&&(B[N]=B[N][0])}if(u)x.readonly=!0,r.isButton(b)&&(x.disabled=!0,x["class"]+="disabled ");else if(b.error&&(x["class"]+="zenario_field_with_error "),L.required||L.required_if_not_hidden)x["class"]+="zenario_required_field ";
if("checkboxes"!=y&&(R=r.displayAsTag(b,u))){B=E(l);if("select"==y||"radios"==y)b.values&&b.values[l]?B=E(b.values[l]):b.empty_value&&(B=E(b.empty_value));m+=ja(R,"id",R+"__"+e,"class",b.css_class,B)}else if(F=b.snippet){for(U in wa)R=wa[U],F[R]&&(m+=ja(R,"id",R+"__"+e,"class",F[R+"_class"],"style",F[R+"_style"],E(F[R])));F.show_split_values_from&&r.splitValues&&r.splitValues[F.show_split_values_from]&&(m+=r.splitValues[F.show_split_values_from],delete r.splitValues[F.show_split_values_from]);F.html&&
(m+=Da("id","snippet__"+e,q._un(F.html)));F.microtemplate&&(m+=ga("id","microtemplate__"+e,r.microTemplate(F.microtemplate,b)));F.url&&(m=s(F.cache)?r.cachedAJAXSnippets[F.url]?m+r.cachedAJAXSnippets[F.url]:m+(r.cachedAJAXSnippets[F.url]=q._nAA(q._aBP(F.url))):m+q._nAA(q._aBP(F.url)))}else if(("checkboxes"==y||"radios"==y)&&!p(K))u&&b.display_as_text_when_readonly?m+=E(r.displaySelectedItems(e,b,l,d)):b.values&&(aa=_._ex({},b),P=r.pickedItemsArray(b,l),aa.name=b.name||e,aa.type="checkboxes"==y?"checkbox":
"radio",u&&(aa.disabled=!0),m=_._isEm(B)?m+la("class","zenario_no_values_message",E(b.no_values_message)):m+r.hierarchicalBoxes(a,d,e,l,b,aa,u,P,B,z));else if(H||C||da){var xa=da||C&&s(C.multiple_select)||H&&s(H.multi);l={id:e,pickerHTML:"",wrappedId:"name_for_"+e,readOnly:u};u||(C&&(C.target_path||C.path)&&!s(C.hide_select_button)&&(l.select={onclick:r.globalName+".pickItems('"+E(e)+"');",phrase:C.select_phrase||O.selectDotDotDot}),H&&(l.upload={onclick:r.globalName+".upload('"+E(e)+"');",phrase:H.upload_phrase||
O.uploadDotDotDot},s(H.drag_and_drop)&&r.upload(e,!0),ba.Dropbox&&Dropbox.isBrowserSupported()&&(l.dropbox={onclick:r.globalName+".chooseFromDropbox('"+E(e)+"');",phrase:H.dropbox_phrase||O.dropboxDotDotDot})));l.pickerHTML+=qa("id",e,"multiple",xa,"class",b.css_class,"style",b.style,">");!b.values||_._isEm(P)&&!da||(l.pickerHTML+=r.hierarchicalSelect(P,b,fa,B,aa,z));l.pickerHTML+="</select>";m+=r.microTemplate(r.mtPrefix+"_picked_items",l);a.after(function(){da?r.setupMultipleSelect(e,d,b,u||ma):
r.setupPickedItems(e,d,b,u,xa)})}else if(y){Z.onchange=K?"lib.fieldChange('"+E(e)+"', '"+E(K)+"');":"lib.fieldChange('"+E(e)+"');";ma&&(x["class"]+="disabled ");L.numeric&&(x.onkeyup=(x.onkeyup||"")+"lib.keepNumeric(this)");b.return_key_presses_button&&!u&&(x.onkeyup=(x.onkeyup||"")+"if (event.keyCode == 13) {zenario._st(event);$('#"+E(b.return_key_presses_button)+"').click();return false;}");s(b.multiple_edit)&&!u&&(x.onkeyup=(x.onkeyup||"")+"if (event && event.keyCode == 9) return true; lib.meMarkChanged('"+
E(e)+"', this.value, '"+E(b.value)+"');");x["class"]+="input_"+y;switch(y){case "select":b.slider&&(T=!0,m+=r.drawSlider(a,e,b,u,!0));u&&(x.disabled=!0);m+="<select";break;case "code_editor":m+="<div";x["class"]=" zenario_embedded_ace_editor";a.after(function(){var a=ace.edit(e),k=!1;a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);u&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));s(b.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.on("blur",function(a){k&&q._aADINS("code_editor_"+
e,function(){r.fieldChange(e)},0);k=!1});a.on("change",function(a){r.markAsChanged();k=!0;q._aADINS("code_editor_"+e,function(){r.fieldChange(e)},5E3)});var g,f,D;if(g=b.language)try{D="html"==g,g=g.m(/\.twig\.html$/i)?"ace/mode/twig":g.m(/\./)?ace.require("ace/ext/modelist").getModeForPath(g).mode:"ace/mode/"+g,f=ace.require("ace/ext/language_tools"),a.session.setMode(g),D?(f.setCompleters([]),a.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1})):(f.setCompleters([f.keyWordCompleter]),
a.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}))}catch(l){console.log("Ace editor could not load this language",g)}a.$blockScrolling=Infinity;r.setCodeEditorPosition(a,r.editingPositions[d+"/"+e])});break;case "color_picker":case "colour_picker":m+="<input";x["class"]=" zenario_color_picker";a.after(function(){var a=b.color_picker_options||b.colour_picker_options||{};a.disabled=u;a.preferredFormat=a.preferredFormat||"hex";$(r.get(e)).spectrum(a)});break;case "editor":m+="<textarea";
G._gSD();var P="<textarea "+r.outputAtts(b)+"></textarea>",P=$(P).height(),H=Math.max(Math.floor(0.5*$(ba).height()),300),W,P={script_url:X+q.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:h,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,min_height:P,max_height:H,autoresize_min_height:P,autoresize_max_height:H,autoresize_bottom_margin:10,onchange_callback:function(a){r.fieldChange(a.id)},init_instance_callback:function(a){G._eDDUITM(!1,
h,r.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&G._eDDUITM(!1,h,b)}},H=_._ex({},P,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize","colorpicker textcolor fullscreen"],image_advtab:!0,visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:G.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,
relative_urls:!1,content_css:h,toolbar:"undo redo | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen",style_formats:G.skinDesc.style_formats,oninit:h}),C=_._ex({},H,{toolbar:"undo redo | image link unlink | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen",file_browser_callback:G.fileBrowser,
init_instance_callback:function(a){G._eDDUITM(!0,X,r.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&G._eDDUITM(!0,X,b)}});R=_._ex({},C,{toolbar:"undo redo | image | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen"});L=_._ex({},R,{toolbar:"undo redo | link unlink | bold italic underline strikethrough forecolor backcolor | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code fullscreen"});
u?(W=P,x["class"]=" tinymce_readonly"):b.insert_image_button?b.insert_link_button?(W=C,x["class"]=" tinymce_with_images_and_links"):(W=R,x["class"]=" tinymce_with_images"):b.insert_link_button?(W=L,x["class"]=" tinymce_with_links"):(W=H,x["class"]=" tinymce");x.style="visibility: hidden;";_._isOb(b.editor_options)&&(W=_._ex(W,b.editor_options));W.setup=function(a){a.on("change",function(a){r.fieldChange(a.id)})};a.after(function(){var a=$(r.get(e)),b=r.get("zenario_abtab"),d=b.style.display;try{a.tinymce().remove()}catch(k){}b.style.display=
"block";a.tinymce(W);b.style.display=d});break;case "button":case "submit":case "toggle":ra=!0;s(b.use_button_tag)?(m+="<button",sa=!0):(m+="<input",x.type="button");if(!u||s(b.can_be_pressed_in_view_mode))Z.onclick="lib.clickButton(this, '"+e+"');",delete x.disabled;"toggle"==y&&(x["class"]+=b.pressed?" pressed":" not_pressed");break;default:"textarea"==y?m+="<textarea":I?(m+='<span class="zenario_datepicker_wrap"><input',x.type="text",x["class"]+=" zenario_datepicker",x.readonly="readonly",u||(x.onkeyup=
(x.onkeyup||"")+"zenario._dFKU(this, event, '"+E(e)+"');"),a.after(function(){var a=$(r.get(e)),d=!!s(b.change_month_and_year);a.datepicker({changeMonth:d,changeYear:d,dateFormat:G.siteSettings&&G.siteSettings.organizer_date_format||q.dpf,altField:"#_value_for__"+e,altFormat:"yy-mm-dd",showOn:"focus",disabled:u,onSelect:function(b,d){a.change()}})})):"url"==y?(m+="<input",x.type="url",x.onfocus=(x.onfocus||"")+"if(!this.value) this.value = 'http://';",x.onblur=(x.onblur||"")+"if(this.value == 'http://') this.value = '';"):
(b.slider&&(T=!0,m+=r.drawSlider(a,e,b,u,!0)),"text"==y&&b.values&&!u&&(m+='<span class="zenario_textbox_with_autocomplete">',na=!0),m+="<input",x.type=y),b.redraw_immediately_onchange&&(x.onkeyup=(x.onkeyup||"")+"if (lib.redrawImmediatelyWhenChanged(this, event, '"+E(e)+"', '"+E(b.value)+"', "+(b.value==l?"false":"true")+")) return false;"),r.addExtraAttsForTextFields(b,x)}if("checkbox"==y||"radio"==y)s(l)&&(x.checked="checked"),l=h,u&&(x.disabled=!0),s(b.indeterminate)&&a.after(function(){var a;
if(a=r.get(e))a.indeterminate=!0});T&&(x.onchange='$("#zenario_slider_for__'+V(e)+'").slider("value", $(this).val());',x.onkeyup=(x.onkeyup||"")+'$("#zenario_slider_for__'+V(e)+'").slider("value", $(this).val());');p(K)?(Y=$.extend({},b,Y),ea.id=e+"___"+K,x["class"]+=" control_for__"+e):(Y=b,ea.id=e);"radio"==y&&b.name||(ea.name=e);u&&(ea.placeholder="");m+=r.outputAtts(Y,x,Z,ea);Z=E(ra?b.value:l,!1,"asis");x="";"select"==y?m+=">":sa?(m+=">",b.icon_left&&(m+='<i class="'+E(b.icon_left)+'" aria-hidden="true"></i>'),
m+=Z,b.icon_right&&(m+='<i class="'+E(b.icon_right)+'" aria-hidden="true"></i>'),m+="</button>"):"textarea"==y||"editor"==y?m+=">"+Z+"</textarea>":"code_editor"==y?m+=">"+Z+"</div>":I?(m+=' value="'+E(q._fD(l,"datetime"==y))+'"/>',m+=ca("type","hidden","id","_value_for__"+e,"value",l),u||(m+=ca("type","button","class","zenario_remove_date","value","x","onclick",r.globalName+'.blankField("'+V(e)+'"); $('+r.globalName+'.get("'+V(e)+'")).change();'))):m=p(l)?m+(' value="'+Z+'"/>'):m+"/>";"select"==y&&
(b.empty_value&&(x=ka("value","","data-hide_in_iconselectmenu",1,"selected",!l,E(b.empty_value)),b.show_empty_value_at_end||(m+=x,x="")),b.values&&(P={},P[l]=!0,m+=r.hierarchicalSelect(P,b,fa,B,aa,z)),m+=x+"</select>");if(na){var ya=[];for(N in B)t(B,N)&&(F=B[N],ya.push({label:b.values[F],value:F}));a.after(function(){var a=$(r.get(e)),d={source:ya,minLength:b.autocomplete_min_length||0,appendTo:a.parent()};b.return_key_presses_button&&(d.select=function(){setTimeout(function(){$("#"+b.return_key_presses_button).click()},
0)});a.autocomplete(d);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})});m+=ca("type","button","class","zenario_open_autocomplete","value","\u25be","onclick","$("+r.globalName+'.get("'+V(e)+'")).autocomplete("search", "");')}if(I||na)m+="</span>"}p(K)||("url"!=y||u||(m+="&nbsp; "+ca("type","button","class","submit","value",O.test,"onclick",r.globalName+'.testURL("'+V(e)+'");')),!b.label||"checkbox"!=y&&"radio"!=y||(m+=" "+la("class",b.label_class,"for",e,
"id","label_for__"+e,E(b.label))),p(b.post_field_label)&&(m+=" "+la("for",e,"id","label_for__"+e,E(b.post_field_label))),p(b.post_field_html)&&(m+=q._un(b.post_field_html)),pa&&(m+=ia.join("")),T&&(m+=r.drawSlider(a,e,b,u,!1)));return m};f.addExtraAttsForTextFields=function(a,d){};var Ea={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,onmousemove:!0,
onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0},wa="hr h1 h2 h3 h4 label div p span".split(" ");f.outputAtts=function(a,d,e,b,k){var g,f="";for(g in a)if(t(a,g)&&!(b&&p(b[g])||!k&&!Ea[g]&&"data-"!=g.substr(0,5)))if("disabled"==g||"readonly"==g||"selected"==g){if(s(a[g])||d&&s(d[g])&&delete d[g])f+=" "+g+'="'+g+'"'}else f+=" "+g+'="'+this.defineLibVarBeforeCode(g),d&&
d[g]&&(f+=d[g]+" ",delete d[g]),f+=E(a[g]),e&&e[g]&&(f+=" "+e[g],delete e[g]),f+='"';b&&(f+=this.outputAtts(b,!1,!1,!1,!0));d&&(f+=this.outputAtts(d,!1,!1,!1,!0));e&&(f+=this.outputAtts(e,!1,!1,!1,!0));return f};f.defineLibVarBeforeCode=function(a){if(p(a)&&"on"!=a.substr(0,2))return"";if(!this.globalName){for(a=1;ba[this.globalName="zenarioLib"+a];++a);ba[globalName]=this}return"var lib = "+E(this.globalName)+"; "};f.testURL=function(a){var d=this.get(a).value;a=this.get(this.onThisRow("target_blank_",
a))||this.get(this.onThisRow("target_blank",a));d&&(a&&2==a.value?$.colorbox({href:d,iframe:!0,width:"95%",height:"95%",className:"zenario_url_test_colorbox"}):ba.open(q._aBP(d)))};f.keepNumeric=function(a){var d=a.value.r(/[^\d\.]/g,"").r(/\.(.*)\./g,".$1");a.value!=d&&(a.value=d)};f.hierarchicalSelect=function(a,d,e,b,k,g,f){var A="",n,K,l,u,q,z;for(q in b)if(t(b,q)){z=b[q];u=d.values[z];K=n=!1;if(_._iS(u))u={label:u};else if(s(u.disabled)||u.disabled_if&&J._e(u.disabled_if,this,u,h,z,h,h,d,h,e)||
d.values_disabled_if&&J._e(d.values_disabled_if,this,u,h,z,h,h,d,h,e))n=!0;a[z]&&(K=!0);l=!s(u.hide_when_children_are_not_visible);if(!p(f)&&k&&g[z]){if((childrenHTML=this.hierarchicalSelect(a,d,e,b,k,g,z))||l)A+=ja("optgroup","label",u,"disabled",!childrenHTML,childrenHTML)}else l&&f===u.parent&&(A+="<option "+this.outputAtts(u,!1,!1,{disabled:n,selected:K,value:z})+">"+E(u,!1,!0)+"</option>")}return A};f.setupMultipleSelect=function(a,d,e,b){var k=this,g=!1;d=$(k.get(a));d.multiselect({columns:e.cols,
texts:{placeholder:e.empty_value||O.selectListSelect,overridePlaceholder:e.placeholder},onOptionClick:function(){g=!0},onControlClose:function(){g&&k.fieldChange(a)}});b&&d.multiselect("disable")};f.setupPickedItems=function(a,d,e,b,k){var g=this,f=!1,h=!1,n,p,l,u,B=e.pick_items||{},z=e.upload||{},E=s(z.reorder_items||B.reorder_items);if(e.pick_items&&!s(B.disable_type_ahead_search)){n=B.path&&T._cNPTTPAR(B.path);u=B.target_path&&T._cNPTTPAR(B.target_path);if(n=n&&u&&n.path==u.path?n:u||n)p=X+"zenario/admin/organizer.ajax.php?_typeahead_search=1&path="+
U(n.path)+q._uR(n.request),l="_search";h=s(e.pick_items.allow_typing_anything)}e=$(g.get(a)).tokenize({datas:p,searchParam:l,debounce:200,sortable:E,placeholder:B.nothing_selected_phrase||z.nothing_selected_phrase||O.nothing_selected,onAddToken:function(b,e,l){f||(k||(f=!0,g.addToPickedItems(b,a,d),f=!1),g.$getPickItemsInput(a).focus())},maxElements:k?0:1,parseData:function(e){var k,f,l,D=[],n=g.tuix.tabs[d].fields[a];if(e.items)for(k in e.items)t(e.items,k)&&(f=e.items[k],l=G._fOIN(e,k),n.values=
n.values||{},n.values[k]={list_image:f.list_image,css_class:f.css_class||e.item&&e.item.css_class,label:l},D.push({value:k,text:l,html:g.drawPickedItem(k,a,n,b)}));return D},formatTokenHTML:function(e,k){var f=g.tuix.tabs[d].fields[a];return f.values&&f.values[e]?g.drawPickedItem(e,a,f,b):h?(f.values=f.values||{},f.values[e]=k,g.drawPickedItem(e,a,f,b)):!1},onRemoveToken:function(b,d){g.fieldChange(a)}});b?e.disable():(E&&e.container.addClass("zenario_reorder_items"),p||h?(e.container.addClass("zenario_picker_with_typeahead"),
h&&g.$getPickItemsInput(a).blur(function(){var b,e;if(b=g.$getPickItemsInput(a).val())e={},e[b]=b,g.addToPickedItems(e,a,d)})):e.disableTypeAhead())};f.chooseFromDropbox=function(a){var d=this,e,b,k,f,D;if(!(e=d.field(a))||!e.upload)return!1;if(f=e.upload.extensions||e.upload.accept)f=_._iS(f)?f.s(","):_._tA(f);for(b in f)t(f,b)&&(k=f[b],D=k.s("/"),p(D[1])?f[b]="images"==D[0]?"image":D[0]:"text"!=k&&"documents"!=k&&"images"!=k&&"video"!=k&&"audio"!=k&&"."!=k.substr(0,1)&&(f[b]="."+k));e={cancel:function(){G._hAL()},
linkType:"direct",multiselect:!!s(e.upload.multi),extensions:f,success:function(b){G._sAL();var e,k,f=new q.callback;for(e in b)t(b,e)&&(k=b[e],f.add(q._a(d.ajaxURL()+"&fetchFromDropbox=1",k,!0)));f.after(function(){var b,e,k,f="";if(!(k=d.field(a))||!k.upload)return!1;for(b in arguments)t(arguments,b)&&((e=arguments[b])&&e.id&&(f+=","+e.id),d.setFileDetails(k,e));""!==f&&d.addToPickedItems(f,a);G._hAL()})}};G._sAL();Dropbox.choose(e)};f.setFileDetails=function(a,d){a.values||(a.values={});d.label=
this.formatLabelFromFile(d);a.values[d.id]=d};f.formatLabelFromFile=function(a){var d;p(a.filename)?(d=a.filename,a.ssc&&(d+=" [checksum "+a.short_checksum+"]"),s(a.width)&&s(a.height)&&(d+=" ["+a.width+" \u00d7 "+a.height+"px]")):(fileDetails=q._dIIFO(a.id))&&(fileDetails=fileDetails.s("/"))&&fileDetails[1]?(d=fileDetails[1],s(fileDetails[2])&&s(fileDetails[3])&&(d+=" ["+fileDetails[2]+" \u00d7 "+fileDetails[3]+"px]")):d=a.id;return d};f.upload=function(a,d){var e=this,b;if(!(b=e.field(a))||!b.upload)return!1;
b={class_name:b.class_name,upload:b.upload};e.uploadCallback=function(b){if(b){var d,f,h,n="";if(!(h=e.field(a))||!h.upload)return!1;for(d in b)t(b,d)&&(f=b[d])&&f.id&&(n+=","+f.id,e.setFileDetails(h,f));""!==n&&e.addToPickedItems(n,a)}};d?e.enableDragDropUpload():J._a(e,b,h,h,h,{fileUpload:1},h,e.ajaxURL())};f.ajaxURL=function(){return X+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+U(this.path)};f.enableDragDropUpload=function(){};f.disableDragDropUpload=function(){};f.uploadComplete=
function(a){p(this.uploadCallback)&&this.uploadCallback(a);delete this.uploadCallback};f.drawSlider=function(a,d,e,b,k){var f=this,h=_._cl(e.slider);e="";if(s(h.before_field)?k:!k)b&&(e+='<div class="ui-disabled">'),e+=ga("id","zenario_slider_for__"+d,"class",h["class"],"style",h.style),b&&(e+="</div>"),a.after(function(){var a;if(a=f.get("zenario_slider_for__"+d))p(h.min)&&(h.min=q.num(h.min)),p(h.max)&&(h.max=q.num(h.max)),p(h.step)&&(h.step=q.num(h.step)),h.disabled=!f.editModeOn(),h.value=$(f.get(d)).val(),
h.slide=function(a,b){$(f.get(d)).val(b.value)},h.change=function(a,b){f.fieldChange(d)},$(a).slider(h)});return e};f.lookupFileDetails=function(a){return G._lFD(a)};f.pickedItemsArray=function(a,d){if(!1===d||!p(d))return{};a.values&&_._iS(a.values)&&this.tuix.lovs&&this.tuix.lovs[a.values]&&(a.values=this.tuix.lovs[a.values]);if(!(0!==d&&"0"!==d||a.values&&(a.values[0]||a.values["0"])))return{};var e=(d+"").s(","),b={},f,g,h,A,n,K,l;a._display_value=!1;for(K in e)t(e,K)&&(l=e[K])&&(a.upload&&(n=
q._dIIFO(l))&&(n=n.s("/"))&&n[1]?(b[l]=n[1],s(n[2])&&s(n[3])&&(b[l]+=" ["+n[2]+" \u00d7 "+n[3]+"px]")):a.values&&a.values[l]&&"string"==typeof a.values[l]?b[l]=a.values[l]:a.values&&a.values[l]&&a.values[l].label?b[l]=a.values[l].label:((h=a.pick_items&&a.pick_items.target_path)||(h=a.pick_items&&a.pick_items.path))&&(f=G._gIFO(h,l))?(a.values||(a.values={}),g=G._fOIN(f,l),A=f.items&&f.items[l]||{},b[l]=g,a.values[l]={list_image:A.list_image,css_class:A.css_class||f.item&&f.item.css_class,label:g}):
a.upload&&l==1*l&&(n=this.lookupFileDetails(l))?(this.setFileDetails(a,n),b[l]=a.values[l]):b[l]=l,!1===a._display_value&&(a._display_value=b[l]));return b};f.pickedItemsValue=function(a){var d,e="";if(a)for(d in a)t(a,d)&&(e+=(""===e?"":",")+d);return e};f.displaySelectedItems=function(a,d,e,b){p(d)||(d=this.field(a,b));p(e)||(e=this.value(a,b));a=this.pickedItemsArray(d,e);return _._isEm(a)?s(e)?e:p(d.empty_value)?d.empty_value:"":_._tA(a).join(", ")};f.hierarchicalBoxes=function(a,d,e,b,f,g,D,
A,n,q,l,u,B){var z=this,G=1*f.cols||1,r=0,y="",H,C,J,L,I=!1;if(!B)B=0,G=1*f.cols_at_top_level||G;else if(10<B)return"";u||(u={});l&&(u[l]=!0);B&&(y+=ga("class","zenario_hierarchical_box_children","id","children_for___"+e+"___"+l,">"));for(var O in n)if(t(n,O)&&(H={},C=n[O],C==1*C&&(C*=1),L=h,J="object"==typeof f.values[C]?f.values[C]:{label:f.values[C]},f.tag_colors&&(H.tag_color=f.tag_colors[C]||"blue"),L=J.parent,"0"===L&&(L=!1),!l&&!L||l==L)){L=b?!0===b||1===b||"1"===b?!0===C||1===C||"1"===C:A?
p(A[C])?!0:!1:C==b:!C;if(!D||L||!f.hide_unselected_values_when_readonly||q[C]){H.checked=L;if(H.newRow=++r>G)r=1;H.col=r;H.cols=G;if("checkboxes"==f.type&&s(f.checking_child_checks_parents)){var w="";l&&(w+="if (this.checked) { for (var cb in "+JSON.stringify(u)+") { "+z.globalName+".get('"+E(e)+"___' + cb).checked = true; } } ");q[C]&&(w+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");w?g.onchange=f.onchange?w+" "+f.onchange:w:f.onchange?g.onchange=
f.onchange:delete g.onchange}else"checkboxes"==f.type&&s(f.checking_parent_checks_children)&&(w="",q[C]&&(w+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),w?g.onchange=f.onchange?w+" "+f.onchange:w:f.onchange?g.onchange=f.onchange:delete g.onchange);H.lovId=e+"___"+C;H.lovField=J;f.indeterminates&&s(f.indeterminates[C])&&function(b){a.after(function(){var a;if(a=z.get(b))a.indeterminate=!0})}(H.lovId);H.lovHTML=z.drawField(a,d,e,g,
h,h,h,h,h,C,L,!1,n,q,J);H.childrenHTML="";q[C]&&(H.childrenHTML=z.hierarchicalBoxes(a,d,e,b,f,g,D,A,n,q,C,_._ex({},u),B+1),r=0);I?(z.splitValues||(z.splitValues={}),z.splitValues[e]||(z.splitValues[e]=""),z.splitValues[e]+=z.microTemplate(z.mtPrefix+"_radio_or_checkbox",H)):y+=z.microTemplate(z.mtPrefix+"_radio_or_checkbox",H)}L&&J.split_values_if_selected&&!B&&"radios"===f.type&&(I=!0)}B&&(y+="</div>");return y};f.drawPickedItem=function(a,d,e,b){p(e)||(e=this.field(d));var f={},g=e.values&&e.values[a];
_._isOb(g)?(f=g,g=g.label):(g||(g=a),f.label=g);var h=a==1*a,A,n;d={id:d,item:a,label:g,readOnly:b,css_class:f.css_class,list_image:f.list_image};e.tag_colors&&(d.tag_color=e.tag_colors[a]||"blue");!e.pick_items||s(e.pick_items.hide_info_button)||e.upload&&!h||!(A=e.pick_items.path)||A!=e.pick_items.target_path&&e.pick_items.min_path!=e.pick_items.target_path||(A="//"==q._rHSS(A,2)?A+a:"/"==q._rHSS(A,1)?A+("/"+a):A+("//"+a),d.organizerPath=A);e.upload&&(d.isUpload=!0,A=(A=(""+g).m(/(.*?)\.(\w+)$/)||
(""+g).m(/(.*?)\.(\w+) \[.*\]$/))&&A[2]?A[2].toLowerCase():"unknown",d.extension=A,h?(n=e.values&&e.values[a])&&n.checksum?(a=X+"zenario/file.php?c="+U(n.checksum),n.usage&&(a+="&usage="+U(n.usage))):a=X+"zenario/file.php?id="+a:a=X+"zenario/file.php?getUploadedFileInCacheDir="+U(a),A.m(/gif|jpg|jpeg|png|svg/)?(d.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+a+"&popout=1&dummy_filename="+U("image."+A)+"', '"+g+"');",src:a+"&og=1"},(g=(""+g).m(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&
g[1]&&g[2]&&J._rI(g[1],g[2],180,120,d.thumbnail)):d.adminDownload=a+"&adminDownload=1");return this.microTemplate(this.mtPrefix+"_picked_item",d)};f.showPickedItemInPopout=function(a,d){J._a(this,{popout:{href:a,title:d,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){var d,e,b,f;(d=this.field(a))&&(e=d.pick_items)&&(e.path||e.target_path)&&(d=f=e.path,T.map&&(f=T._cNPTTP(e.path).path),s(e.multiple_select)||e.target_path&&e.target_path!=f||!(b=this.readField(a))||-1!=b.indexOf(",")||
(d="//"==q._rHSS(d,2)?d+b:"/"==q._rHSS(d,1)?d+("/"+b):d+("//"+b)),this.SKTarget=a,G._oS(this.globalName,"setPickedItems",e.multiple_select,d,e.target_path,e.min_path,e.max_path,e.disallow_refiners_looping_on_min_path,h,e.one_to_one_choose_phrase,e.one_to_many_choose_phrase,h,!0,h,h,h,h,h,h,h,h,e))};f.setPickedItems=function(a,d,e,b){a=this.SKTarget;var f,g,h={};for(f in d._items)t(d._items,f)&&(e=q._dIIFO(f),g=b.items&&b.items[e]||{},h[e]={list_image:g.list_image,css_class:g.css_class||b.item&&b.item.css_class,
label:G._fOIN(b,e)});this.addToPickedItems(h,a)};f.removeFromPickedItems=function(a,d,e){this.addToPickedItems(a,d,e,!0)};f.addToPickedItems=function(a,d,e,b){e=this.field(d,e);var f=this.readField(d),g=e.pick_items&&s(e.pick_items.multiple_select)||e.upload&&s(e.upload.multi),h,p,n={};a=J._cTO(a);p=f?this.pickedItemsArray(e,f):{};for(h in a)if(t(a,h))if(f=a[h],e.values||(e.values={}),b)delete e.values[h];else if(e.values[h]||(e.values[h]=f),p[h]&&(n[h]=!0),g)p[h]=!0;else{p={};p[h]=!0;break}this.redrawPickedItems(d,
e,p,n)};f.redrawPickedItems=function(a,d,e,b){var f,g,h=this.pickedItemsValue(e),p={},n=$(this.get(a)).tokenize(),q=n.toArray();e=J._cTO(e);for(f in q)t(q,f)&&(g=q[f],e[g]&&!b[g]?p[g]=!0:n.tokenRemove(g));for(g in e)t(e,g)&&!p[g]&&(b=d.values&&d.values[g],_._isOb(b)?b=b.label:b||(b=g),n.tokenAdd(g,b));d.current_value=h;this.fieldChange(a)};f.changes=function(a){if(this.tuix&&this.tuix.tab){if(p(a))return this.changed[a];for(a in this.tuix.tabs)if(t(this.tuix.tabs,a)&&this.changed[a])return!0}return!1};
f.markAsChanged=function(a){this.tuix&&(p(a)||(a=this.tuix.tab),a&&!this.changed[a]&&(this.changed[a]=!0,this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,d){var e=this,b=e.field(a);b&&(b.indeterminate&&(b.indeterminate=!1),p(d)&&b.indeterminates&&b.indeterminates[d]&&(b.indeterminates[d]=!1),e.markAsChanged(),s(b.multiple_edit)&&e.meMarkChanged(a),setTimeout(function(){e.validateFormatOrRedrawForField(b)},1))};f.validateFormatOrRedrawForField=function(a,
d){"string"==typeof a?(this.fieldThatTriggeredRedraw=this.setLastFocus(a),a=this.field(a)):a.id&&(this.fieldThatTriggeredRedraw=this.setLastFocus(a.id));var e=s(a.validate_onchange),b=s(a.format_onchange)||d&&(a.pressed?a.format_on_toggle_on:a.format_on_toggle_off),f=s(a.redraw_onchange);if(e)return 3>this.ffoving&&(this.ffoving=3,this.validate()),!0;if(b)return 2>this.ffoving&&(this.ffoving=2,this.format()),!0;f&&1>this.ffoving&&(this.ffoving=1,this.readTab(),this.redrawTab());return f};f.redrawImmediatelyWhenChanged=
function(a,d,e,b,f){if(a=f?a.value===b:a.value!==b)q._st(d),this.fieldThatTriggeredRedraw=this.setLastFocus(e),1>this.ffoving&&(this.ffoving=1,this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,d,e){p(d)&&d==e||(this.field(a).multiple_edit._changed=!0,this.meSetCheckbox(a,!0))};f.meSetCheckbox=function(a,d){"checkbox"==this.get("multiple_edit__"+a).type?this.get("multiple_edit__"+a).checked=d:this.get("multiple_edit__"+a).value=d?1:""};f.meChange=function(a,d,e){var b=this.field(d);
if(a)b.multiple_edit._changed=!0;else{if(!e&&s(b.multiple_edit.warn_when_abandoning_changes)&&p(b.multiple_edit.original_value)&&this.readField(d)!=b.multiple_edit.original_value){a=ca("type","button","class","submit_selected","value",O.abandonChanges,"onclick",this.globalName+'.meChange(false, "'+V(d)+'", true);')+ca("type","button","class","submit","value",O.cancel);G._flBo(O.abandonChangesConfirm,a,"warning");this.meSetCheckbox(d,!0);return}b.multiple_edit._changed=!1;delete b.current_value;e=
b.value;p(b.multiple_edit.original_value)&&(e=b.current_value=b.multiple_edit.original_value);this.get(d)&&!b.pick_items?"checkbox"==this.get(d).type?this.get(d).checked=e?!0:!1:$(this.get(d)).val(e||""):(b=new q.callback,e=this.drawFields(b),this.insertHTML(e,b))}this.meSetCheckbox(d,a);this.validateFormatOrRedrawForField(d)};f.currentValue=function(a,d,e){return e||this.drawingFields||p(d)&&d!=this.tuix.tab?this.value(a,d,e):this.readField(a)};f.value=function(a,d,e){d||(d=this.tuix.tab);var b=
"",f=this.field(a,d);if(!f)return"";p(e)||(e=this.fieldIsReadonly(a,f,d));f&&!f.snippet&&"grouping"!=f.type&&(this.isButton(f)?b=!!f.pressed:!e&&p(f.current_value)?b=f.current_value:p(f.value)?b=f.value:f.multiple_edit&&p(f.multiple_edit.original_value)&&(b=f.multiple_edit.original_value));return"0"===b?0:p(b)?b:""};f.mode=function(a){return this.value("mode")};f.keyIn=function(a){return _.contains(arguments,this.tuix.key[a],1)};f.keyIs=function(a,d){return this.tuix.key[a]==d};f.key=function(a){return this.tuix.key[a]};
f.modeIn=function(){return _.contains(arguments,this.mode())};f.modeIs=function(a){return this.mode()==a};f.valueIn=function(a){return _.contains(arguments,this.value(a),1)};f.valueIs=function(a,d){return this.value(a)==d};f.valueIsNot=function(a,d){return this.value(a)!=d};f.isButton=function(a){return a&&("submit"==a.type||"toggle"==a.type||"button"==a.type)};f.isFormField=function(a){return!(!a||a.snippet||"grouping"==a.type||"submit"==a.type||"toggle"==a.type||"button"==a.type)};f.getCodeEditorPosition=
function(a){return{top:a.session.getScrollTop(),left:a.session.getScrollLeft(),range:a.getSelectionRange()}};f.setCodeEditorPosition=function(a,d){d&&(a.session.setScrollTop(d.top),a.session.setScrollLeft(d.left),a.selection.setSelectionRange(d.range))};f.appendCodeEditorValue=function(a,d){var e=ace.edit(a),b=this.getCodeEditorPosition(e);e.setValue(e.getValue()+d);this.setCodeEditorPosition(e,b)};f.readField=function(a){var d=h,e=this.tuix.tab,b=this.field(a,e),f;if(!this.isFormField(b))return h;
var g=this.fieldIsReadonly(a,b,e),s=b._was_hidden_before;b.multiple_edit&&g&&delete b.multiple_edit._changed;if("checkboxes"==b.type||"radios"==b.type){if(!g&&!s&&b.values){var A,s="",n=!0;for(A in b.values)t(b.values,A)&&this.get(a+"___"+A)&&this.get(a+"___"+A).checked&&(s+=(n?"":",")+A,n=!1);b.current_value=s}s=!0}if(s)return g||!p(b.current_value)?b.value:b.current_value;if(this.get("_value_for__"+a))b.current_value=d=this.get("_value_for__"+a).value;else if("editor"!=b.type&&"code_editor"!=b.type||
g)if(!g&&(f=this.get(a))){if("checkbox"==b.type||"radio"==b.type)d=f.checked?!0:!1;else if("color_picker"==b.type||"colour_picker"==b.type)try{d=$(f).spectrum("get").toHexString()}catch(K){d=$(f).val()}else d=$(f).val();p(d)||(d="");_._isAr(d)&&(d=d.join(","));b.current_value=d}else delete b.current_value,d=b.value;else{var l,u;if("editor"==b.type){if(a=ba.tinyMCE&&tinyMCE.get(a))l=q._tMGC(a)}else"code_editor"==b.type&&(u=ace.edit(a))&&(l=u.getValue(),this.editingPositions[e+"/"+a]=this.getCodeEditorPosition(u));
if(p(l)&&!1!==l)d=b.current_value=l;else return p(b.current_value)?b.current_value:b.value}return d};f.blankField=function(a){this.setFieldValue(a,"")};f.setFieldValue=function(a,d){field=this.field(a,this.tuix.tab);this.get(a)&&$(this.get(a)).val(d);this.get("_value_for__"+a)&&(this.get("_value_for__"+a).value=d);field.current_value=d};f.readTab=function(){var a,d={},e=this.fields(),b;this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();for(b in e)t(e,b)&&p(a=this.readField(b))&&(d[b]=a);S&&
S.activeElement&&(this.lastFocus=this.setLastFocus(S.activeElement));return d};f.wipeTab=function(){var a=this.fields(),d,e;for(d in a)t(a,d)&&(e=a[d],delete e.current_value,e.multiple_edit&&delete e.multiple_edit._changed)};f.redrawTab=function(){this.tuix.shake=!1;this.draw2()};f.getURL=function(a){++this.onKeyUpNum;return this.returnAJAXURL(a)};f.returnAJAXURL=function(a){return"..."};f.editModeOn=function(a){return!0};f.editModeAlwaysOn=function(a){return!0};f.editCancelEnabled=function(a){return!1};
f.revertEnabled=function(a){return!1};f.savedAndContinued=function(a){return!1};f.editModeOnBox=function(){return!0};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(t(this.tuix.tabs,a)){var d=this.tuix.tabs[a];d&&this.sortedTabs.push([a,d.ord])}this.sortedTabs.sort(J.sortArray);this.groupings={};this.sortedFields={};for(a in this.sortedTabs)t(this.sortedTabs,a)&&(d=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(d))};f.sortFields=function(a){var d,
e,b,f,g={};this.groupings[a]={};this.sortedFields[a]=[];if(b=this.fields(a)){for(d in b)t(b,d)&&(e=b[d],e.type&&"grouping"==e.type&&(g[e.name||d]=1*e.ord,this.groupings[a][e.name||d]=d));for(d in b)t(b,d)&&(!(e=b[d])||e.type&&"grouping"==e.type||(f=e.grouping?g[e.grouping]:h,this.sortedFields[a].push([d,e.ord,f])));this.sortedFields[a].sort(J.sortArrayWithGrouping);for(d in this.sortedFields[a])t(this.sortedFields[a],d)&&(this.sortedFields[a][d]=this.sortedFields[a][d][0])}};f.setData=function(a){this.tuix=
a};f.setDataDiff=function(a){this.syncAdminBoxFromServerToClient(a,this.tuix)};f.syncAdminBoxFromServerToClient=function(a,d){var e,b;for(e in a)t(a,e)&&(b=a[e],!p(b)||b["[[__unset__]]"]?delete d[e]:p(d[e])?b["[[__replace__]]"]?(delete b["[[__replace__]]"],d[e]=b):"object"!=typeof d[e]?d[e]=b:"object"==typeof d[e]&&"object"!=typeof b?d[e]=b:this.syncAdminBoxFromServerToClient(b,d[e]):d[e]=b)};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};f.sendStateToServerDiff=function(){var a=
{};this.syncAdminBoxFromClientToServerR(a,this.tuix);return JSON.stringify(a)};f.syncAdminBoxFromClientToServerR=function(a,d,e,b,f,g,h,s){if("object"==typeof d){var n,t,l;for(t in d)if(!p(e)&&q.IN(t,"download","path","shake","tab","switchToTab")&&(n="value")||!p(e)&&q.IN(t,"_sync","tabs")&&(n="array")||!p(b)&&"_sync"==e&&q.IN(t,"cache_dir","password","session","iv")&&(n="value")||!p(b)&&"tabs"==e&&(n="array")||!p(f)&&"tabs"==b&&"_was_hidden_before"==t&&(n="value")||!p(f)&&"tabs"==b&&q.IN(t,"edit_mode",
"fields")&&(n="array")||!p(g)&&"tabs"==f&&"edit_mode"==e&&"on"==t&&(n="value")||!p(g)&&"tabs"==f&&"fields"==e&&(n="array")||!p(h)&&"tabs"==g&&"fields"==b&&q.IN(t,"_display_value","_was_hidden_before","current_value","pressed")&&(n="value")||!p(h)&&"tabs"==g&&"fields"==b&&"multiple_edit"==t&&(n="array")||!p(s)&&"tabs"==h&&"fields"==f&&"multiple_edit"==e&&"_changed"==t&&(n="value"))if("value"==n)switch(l=d[t],typeof l){case "function":case "object":break;case "string":"`"===l[0]?l="`1"+l.substr(1):
"/"===l[0]&&(l="`2"+l.substr(1));default:a[t]=l}else"array"==n&&"object"==typeof d[t]&&(a[t]={},this.syncAdminBoxFromClientToServerR(a[t],d[t],t,e,b,f,g,h))}};f.getValueArrayofArrays=function(a){return q._nAA(this.getURL(),q._uR({_read_values:!0,_box:this.sendStateToServer()}),!a)};f.getValues1D=function(a,d,e,b,f){var g,h,q,n,s,l={};if(this.tuix&&this.tuix.tabs)for(g in this.tuix.tabs)if(t(this.tuix.tabs,g)&&(h=this.tuix.tabs[g],h.fields))for(q in h.fields)!t(h.fields,q)||(n=h.fields[q],s=q,!this.isFormField(n)||
b&&this.fieldIsReadonly(q,n,g)||f&&(h._was_hidden_before||n._was_hidden_before)||a&&!(s=n.plugin_setting&&n.plugin_setting.name)||(n=this.currentValue(q,g,e),d||(l[s]=n),!d&&p(d)))||(l[g+"/"+q]=n);return l};f.insertText=function(a,d){_._iS(a)&&(a=this.get(a));if(a){var e=$(a),b=a.selectionStart,f=a.selectionEnd,g=e.val();e.val(g.substring(0,b)+d+g.substring(f));a.selectionStart=a.selectionEnd=b+d.length;a.focus()}};f.callFunctionOnEditors=function(a){var d,e,b;if(ba.tinyMCE&&(d=this.fields()))for(e in d)if(t(d,
e)&&(b=d[e],"editor"==b.type&&tinyMCE.get(e)))if("remove"==a)tinyMCE.get(e).remove();else if("isDirty"==a&&tinyMCE.get(e).isDirty())return!0;return!1};f.format=function(a){var d=this,e;if(d.loaded&&(e=d.getURL("format"))){var b=d.tuix&&d.tuix.tab;d.loaded=!1;d.hideTab();d.checkValues(a);d.retryAJAX(e,{_format:!0,_box:d.sendStateToServer()},!0,function(a){d.load(a);d.switchTabIfRequested(b);d.sortTabs();d.draw()},"loading")}};f.validate=function(a,d,e,b){var f=this,g;if(f.loaded&&(g=f.getURL("validate"))){f.differentTab=
a;f.loaded=!1;f.hideTab(a);f.checkValues(e);var h=f.tuix&&f.tuix.tab;a&&(f.tuix.switchToTab=d);f.retryAJAX(g,{_validate:!0,_box:f.sendStateToServer()},!0,function(a){f.load(a)&&f.switchTabIfRequested(h);f.sortTabs();f.switchToATabWithErrors();f.draw();b&&b()},"loading")}};f.switchTabIfRequested=function(a){this.tuix.switchToTab&&(a=a||this.tuix&&this.tuix.tab,this.errorOnTab(a)?this.tuix.tab=a:this.tuix.tab=this.tuix.switchToTab,delete this.tuix.switchToTab)}})},zenarioF);
