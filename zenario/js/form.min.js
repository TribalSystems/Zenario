zenario.lib(function(h,X,R,aa,Da,Ea,q,F,I,xa,Fa,T,Q,m,r,ya,C,U,M,Ga,za,x,Aa){I.lib(function(ia,fa,ba,oa,ja,Ba,ka){var f=za(Aa);f.init=function(a,d,e){this.globalName=a;this.mtPrefix=d;this.containerId=e;this.baseCSSClass="";this.onKeyUpNum=0;xa.sizing=!1;this.cachedAJAXSnippets={};this.changed={};this.toggleLevelsPressed={};this.fieldThatTriggeredRedraw=this.lastFocus=!1;this.editingPositions={}};f.enableInlineErrors=function(){return!0};f.get=function(a){return this.containerId&&$("#"+this.containerId+
" #"+q._cE(a))[0]||ya(a)};f.microTemplate=function(a,d,e){return I._mT(a,d,e)};f.pMicroTemplate=function(a,d,e){return this.microTemplate(this.mtPrefix+"_"+a,d,e)};f.fun=function(a){return this.globalName+"."+a};f.onThisRow=function(a,d){return a+d.replace(/(.*_|\D)/g,"")};f.valueOnThisRow=function(a,d){return this.value(this.onThisRow(a,d))};f.fieldOnThisRow=function(a,d){return this.field(this.onThisRow(a,d))};f.getKey=function(a){return this.tuix&&this.tuix.key};f.getKeyId=function(a){return this.tuix&&
this.tuix.key&&this.tuix.key.id};f.getLastKeyId=function(a){return this.getKeyId(a)};f.getTitle=function(){var a,d;if(this.tuix.key&&this.tuix.key.id&&(a=this.tuix.title_for_existing_records)){d=this.getValues1D(!1,h,!0);for(c in d)if(x(d,c)&&(v=d[c],-1!=a.indexOf("[["+c+"]]")))for(;a!=(string2=a.replace("[["+c+"]]",v));)a=string2;return a}return this.tuix.title};f.field=function(a,d){return _._isOb(a)?a:(tabs=this.tuix&&this.tuix.tabs)&&(d=d||this.tuix.tab)&&tabs[d]&&tabs[d].fields&&tabs[d].fields[a]};
f.fields=function(a){var d;return(d=this.tuix&&this.tuix.tabs)&&(a=a||this.tuix.tab)&&d[a]&&d[a].fields};f.initFields=function(){var a=this.tuix.tab,d,e,b,l,g,s=this.tuix.lovs||{};if(this.tuix.tabs)for(d in this.tuix.tabs)if(x(this.tuix.tabs,d)&&(b=this.fields(d))){g=!1;for(e in b)x(b,e)&&(l=b[e])&&(l.pick_items&&l.plugin_setting&&l.plugin_setting.use_value_for_plugin_name?this.pickedItemsArray(e,this.value(e,d,!1)):l.values&&_._iS(l.values)&&s[l.values]?l.values=s[l.values]:l.load_values_from_organizer_path&&
!l.values&&this.loadValuesFromOrganizerPath(l),l.validation&&m(l.validation.required_if_not_hidden)&&(g=!0));g&&d!=a&&(this.tuix.tab=d,this.drawFields(h,h,!0),this.tuix.tab=a)}};f.loadValuesFromOrganizerPath=function(a){var d,e,b;if(a.load_values_from_organizer_path&&!a.values&&(a.values={},(e=F._gIFO(a.load_values_from_organizer_path))&&e.items))for(d in e.items)x(e.items,d)&&(b=e.items[d],a.values[q._dIIFO(d)]={list_image:b.list_image,css_class:b.css_class||e.item&&e.item.css_class,label:F._fOIN(e,
d)})};f.changeMode=function(){this.editCancelEnabled(this.tuix.tab)&&(this.editModeOn()?this.editCancelOrRevert("cancel",this.tuix.tab):this.editCancelOrRevert("edit",this.tuix.tab))};f.revertTab=function(){this.changes(this.tuix.tab)&&this.revertEnabled(this.tuix.tab)&&this.editCancelOrRevert("revert",this.tuix.tab)};f.editCancelOrRevert=function(a,d){if(this.tuix.tabs[d].edit_mode){var e,b,l,g,s,f;"edit"==a?(s=r(this.tuix.tabs[d].edit_mode.format_on_edit),f=r(this.tuix.tabs[d].edit_mode.validate_on_edit)):
"cancel"==a?(s=r(this.tuix.tabs[d].edit_mode.format_on_cancel_edit),f=r(this.tuix.tabs[d].edit_mode.validate_on_cancel_edit)):"revert"==a&&(s=r(this.tuix.tabs[d].edit_mode.format_on_revert),f=this.errorOnTab(d)||r(this.tuix.tabs[d].edit_mode.validate_on_revert));if(!f&&(b=this.fields(d)))for(l in b)if(x(b,l))if(g=b[l],r(g.validate_onchange)&&m(e=this.readField(l))&&e!=g.value){f=!0;break}else!s&&r(g.format_onchange)&&m(e=this.readField(l))&&e!=g.value&&(s=!0);this.tuix.tabs[d].edit_mode.on="cancel"!=
a;this.changed[d]=!1;f?this.validate(h,h,!0):s?this.format(!0):(this.wipeTab(),this.redrawTab(!0));this.tuix.tab==d&&$("#zenario_abtab").removeClass("zenario_abtab_changed")}};f.clickTab=function(a){this.loaded&&this.validate(a!=this.tuix.tab,a)};f.clickButton=function(a,d){var e;if(e=this.field(d))if("submit"==e.type)e.pressed=!0,this.validate(!0);else if("toggle"==e.type){var b=$(this.get(d)),l=$(this.get("row__"+d));(e.pressed=!r(e.pressed))?(b.removeClass("not_pressed").addClass("pressed"),l.addClass("zfea_row_pressed")):
(b.removeClass("pressed").addClass("not_pressed"),l.removeClass("zfea_row_pressed"));this.markAsChanged();this.validateFormatOrRedrawForField(e,!0)}else"button"==e.type&&(e.pressed=!0,this.validateFormatOrRedrawForField(e))};f.togglePressed=function(a,d){var e;e=a?1<a?this.toggleLevelsPressed[a-1]:!0:this.toggleLevelsPressed.last;m(e)||(e=!0);d&&"toggle"==d.type&&(this.toggleLevelsPressed.last=e&&r(d.pressed),a&&(this.toggleLevelsPressed[a]=this.toggleLevelsPressed.last));return e};f.toggleLevel=
function(a){return this.toggleLevelsPressed.last};f.retryAJAX=function(a,d,e,b,l,g){var s=function(){q._a(a,d,e,h,s,!0,h,h,h,h,g).after(b);l&&F.nowDoingSomething&&F._nDS(l)};s()};f.switchToATabWithErrors=function(){var a,d,e=this.tuix;if(e&&e.tabs&&!this.errorOnTab(e.tab))for(a in this.sortedTabs)if(x(this.sortedTabs,a)&&(d=this.sortedTabs[a],e.tabs[d]&&!I._h(h,this,h,d,h,h,h,h,e.tabs[d])&&this.errorOnTab(d)))return e.tab=d,!0;return!1};f.applyMergeFields=function(a,d,e,b){return a};f.applyMergeFieldsToLabel=
function(a,d,e,b){return a};f.hideTab=function(a){var d=this;a?($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled"),$("#zenario_abtab").clearQueue().show().animate({opacity:0.8},200,function(){d.tabHidden=!0;d.draw()})):($("#zenario_abtab input").add("#zenario_abtab select").add("#zenario_abtab textarea").attr("disabled","disabled").animate({opacity:0.9},100),this.tabHidden=!0,this.draw())};f.draw=function(){this.loaded&&this.tabHidden&&
this.draw2()};f.draw2=function(){};f.size=function(){};f.makeFieldAsTallAsPossible=function(){};f.drawTabs=function(a){a||(a=this.mtPrefix+"_tab");var d,e,b=[],l,g,s,f,p=function(a,b,d){for(b in a)if(x(a,b)){d=a[b];if(d.onclick){g&&(f=d.id);if(g=d.current)s=l;l=d.id}d.children&&p(d.children)}};for(i in this.sortedTabs)if(x(this.sortedTabs,i)&&(tab=this.sortedTabs[i],(d=this.tuix.tabs[tab])&&!(d._was_hidden_before=I._h(h,this,h,tab,h,h,h,h,d)))){e="";if(d.fields&&!_._isEm(d.fields)||d.fields&&!_._isEm(d.errors)||
d.fields&&!_._isEm(d.notices))e=this.globalName+".clickTab('"+U(tab)+"');";!this.tuix.tab&&e&&(this.tuix.tab=tab);b.push({id:tab,tabId:tab,tuix:d,onclick:e,current:this.tuix.tab==tab,label:d.label})}I._sBK(b,"zenario_fab_tab_with_children");p(b);this.prevTab=s;this.nextTab=f;return this.microTemplate(a,b)};f.drawFields=function(a,d,e){var b,l,g,s=this.tuix.tab,f=this.tuix.tabs[s],p=this.groupings[s],y=this.sortedFields[s],k,t="",A=!1,q,G=this.fields(s),J={},w={},B={},C=!1,F,V,H=!1,D={},z={fields:{},
rows:[],tabId:s,path:this.path,tuix:this.tuix,revert:"",errors:[],notices:{}};this.drawingFields=!0;if(!e){this.ffoving=0;this.splitValues={};this.tallAsPossibleField=h;this.disableDragDropUpload();!this.savedAndContinued(s)&&this.editCancelEnabled(s)&&(z.revert=fa("class","zenario_editCancelButton",I._i("class","submit","type","button","onclick",this.globalName+".changeMode(); return false;","value",this.editModeOn()?M.cancel:M.edit)));if(this.editModeOn()){if(f.errors)for(q in f.errors)x(f.errors,
q)&&(g=f.errors[q],z.errors.push({message:g}));if(G)for(q in G)if(x(G,q)&&(g=G[q],g.error))if(this.enableInlineErrors()&&(k=this.tuix.error_on_form_message||M.errorOnForm)){z.errors.push({message:k});break}else z.errors.push({message:g.error})}if(f.notices)for(q in f.notices)x(f.notices,q)&&(g=f.notices[q],r(g.show)&&{error:1,warning:1,question:1,success:1}[g.type]&&(z.notices[q]=g));this.setPhiVariables()}for(b in y)x(y,b)&&(l=y[b],g=G[l],q=!1,k=g.grouping,F!==k&&(F=k,H=m(p[k])&&G[p[k]],A=k&&(!H||
I._h(h,this,h,p[k],h,h,H))),V!==k&&(q=!0),g._id=l,g._html=this.drawField(a,s,l,g,J,w,B,e,A),e||A||!1===g._html||((q||g._startNewRow||!z.rows.length)&&z.rows.push({fields:[],grouping:H}),q&&H&&(H.legend||H.snippet)&&(H=_._ex({grouping:k},H),H._id=k,H._html=this.drawField(a,s,k,H),H._hideOnOpen=!0,H._showOnOpen=!0,H._lastVisibleGrouping=V,V=k,z.rows[z.rows.length-1].fields.push(H),z.fields[k]=H,D[k]=H,z.rows.push({fields:[]})),C||f.show_errors_after_field!=l||(z.rows[z.rows.length-1].errors=z.errors,
z.rows[z.rows.length-1].notices=z.notices,C=!0),g._lastVisibleGrouping=V,V=k,z.rows[z.rows.length-1].fields.push(g),z.fields[l]=g));for(l in z.fields)x(z.fields,l)&&(g=z.fields[l],k=g.grouping)&&(H=D[k])&&(H._hideOnOpen&=g._hideOnOpen,H._showOnOpen&=g._showOnOpen);e||(z.rows.length&&(z.rows[z.rows.length-1].fields[0]._isLastRow=!0),C||z.rows.splice(0,0,{errors:z.errors,notices:z.notices}),d=d||f.template||this.mtPrefix+"_current_tab",t+=this.microTemplate(d,z));this.drawingFields=!1;for(b in y)x(y,
b)&&(l=y[b],delete G[l]._lastVisibleGrouping,delete G[l]._startNewRow,delete G[l]._hideOnOpen,delete G[l]._showOnOpen,delete G[l]._isLastRow,delete G[l]._html,delete G[l]._id);return t};f.insertHTML=function(a,d,e){var b=this.get("zenario_abtab"),l=this.lastFocus||this.fieldThatTriggeredRedraw,g;b.innerHTML=a;this.tabHidden=!1;this.changes(this.tuix.tab)?$(b).addClass("zenario_abtab_changed"):$(b).removeClass("zenario_abtab_changed");d.call();(g=!e&&l&&this.field(l.id))&&this.focusField(g,l.ss,l.se);
this.fieldThatTriggeredRedraw=!1};f.hideShowFields=function(a){var d=$(".zenario_hide_on_open"),e=$(".zenario_hide_row_on_open"),b=$(".zenario_show_on_open"),l=function(a,b){b.style.display="none"};b.length&&!d.length?b.show("blind",200,a):!b.length&&d.length?d.hide("blind",200,function(){e.each(l)}):b.length&&d.length&&(d.each(l),e.each(l),b.show())};f.addJQueryElements=function(a){q._aJQE(a+" ",!0);$(a+" select.iconselectmenu").iconselectmenu({width:"auto",change:function(){$(this).change()}})};
f.addJQueryElementsToTab=function(){this.addJQueryElements("#zenario_abtab")};f.addJQueryElementsToTabAndFocusFirstField=function(){this.addJQueryElementsToTab();this.focusFirstField()};f.fieldIsReadonly=function(a,d,e){return d.show_as_a_label||d.show_as_a_span||r(d.read_only)||r(d.readonly)||m(e)&&!this.editModeOn(e)||m(d.readonly_if)&&I._e(d.readonly_if,this,d,h,a,h,h,d)};f.focusFirstField=function(){if(this.tuix&&!r(this.tuix.tabs[this.tuix.tab].disable_autofocus)){var a=this,d=-1,e=[],b=h,l,
g,f,m,p;for(l in this.sortedFields[this.tuix.tab])if(x(this.sortedFields[this.tuix.tab],l)&&(m=this.sortedFields[this.tuix.tab][l],(g=this.get(m))&&(f=this.field(m))&&((p=f.pick_items||f.upload)||$(g).is(":visible"))&&(e[++d]={id:m,type:f.type,empty:""==g.value,focusable:(p||q.IN(f.type,"password","checkbox","select","text","textarea"))&&!r(g.disabled)&&!r(g.readonly)&&!this.fieldIsReadonly(m,f)},1<d)))break;if(e[0]&&!e[0].empty&&e[1]&&e[1].focusable&&e[1].empty&&"password"==e[1].type)b=1;else if(e[0]&&
e[0].focusable)b=0;else if(e[1]&&e[1].focusable)b=1;else return;setTimeout(function(){a.focusField(e[b])},50)}};f.focusField=function(a,d,e){if(a.type){if("date"==a.type||"datetime"==a.type)return;a=this.get(a.id)}else a=this.$getPickItemsInput(a.id);if(a&&(a.focus(),m(d)))try{a.selectionStart=d,a.selectionEnd=e}catch(b){console.log("Ace editor could not load that language",language)}};f.$getPickItemsInput=function(a){return $(this.get("name_for_"+a)).find(".TokenSearch input")};f.setPhiVariables=
function(){q.phiVariables=h};f.errorOnBox=function(){if(this.tuix&&this.tuix.tabs)for(tab in this.tuix.tabs)if(x(this.tuix.tabs,tab)&&this.errorOnTab(tab))return!0;return!1};f.errorOnTab=function(a){var d;if(this.tuix.tabs[a]&&this.editModeOn(a)){if(this.tuix.tabs[a].errors)for(d in this.tuix.tabs[a].errors)if(x(this.tuix.tabs[a].errors,d))return!0;if(a=this.fields(a))for(d in a)if(x(a,d)&&a[d].error)return!0}};f.checkValues=function(a){a?this.wipeTab():this.readTab();for(var d in this.tuix.tabs)if(x(this.tuix.tabs,
d)){a=this.tuix.tabs[d];var e=this.editModeOn(d);if(a.fields)for(var b in a.fields)if(x(a.fields,b)){var l=a.fields[b];this.isFormField(l)&&("code_editor"==l.type&&q._cAD("code_editor_"+b),m(l.current_value)||(l.current_value=this.value(b,d,!0)),e&&(m(l.value)||(l.value=this.value(b,d,!1)),l.multiple_edit&&!m(l.multiple_edit._changed)&&m(l.multiple_edit.changed)&&(l.multiple_edit._changed=l.multiple_edit.changed)))}}R&&R.activeElement&&(this.lastFocus=this.setLastFocus(R.activeElement))};f.setLastFocus=
function(a){var d;"object"===typeof a?(d=a,a=d.id):d=this.get(a);a={id:a};d&&(a.ss=d.selectionStart,a.se=d.selectionEnd);return a};f.enableMicroTemplates=function(a,d){var e=this,b;for(b in d)if(x(d,b))switch(typeof d[b]){case "object":"lib"!==b&&"that"!==b&&"tuix"!==b&&this.enableMicroTemplates(a,d[b]);break;case "string":"type"===b||"value"===b&&this.isFormField(d)||"current_value"===b||!d[b].match(/(\{\{|\{\%|\<\%)/)||function(a,b,d){d=q._gMT("<% "+e.defineLibVarBeforeCode()+" %>"+a[b],h);a[b]=
function(){return d(a)}}(d,b)}};f.displayAsTag=function(a,d){return a.show_as_a_label||d&&a.show_as_a_label_when_readonly?"label":a.show_as_a_span||d&&a.show_as_a_span_when_readonly?"span":!1};f.drawField=function(a,d,e,b,l,g,f,ca,p,y,k,t,A,da,G){m(b)||(b=this.field(e,d));m(b.id)||(b.id=e);r(b.enable_microtemplates_in_properties)&&this.enableMicroTemplates(b,b);var J=this,w=b.type,B=b.upload,N=b.pick_items,O=b.disabled,V="date"==w||"datetime"==w,H,D,z,E,P,n="",K,R,L,S={},Q="multiselect"==w,T=!1,u=
{"class":""},Y={},ea={},la=!1,Z=!1,ma,pa=!1,qa=!1,ra=!1,sa=!1,ta=!1,na=L=!1,ga,ha;m(t)||(t=this.fieldIsReadonly(e,b,d));N&&O&&(t=!0);w&&"datetime"==w&&(t=!0);G?m(G.disabled_if)&&I._e(G.disabled_if,this,G,h,y,h,h,b)&&(t=!0):m(b.disabled_if)&&I._e(b.disabled_if,this,h,h,e,h,h,b)&&(t=!0);!b["class"]&&b.css_class&&(b["class"]=b.css_class);b.snippet||m(k)||(k=this.value(e,d));m(k)||(k="");if(!m(y)){delete b.selected_option;if(k&&b.values)if(D=_._isOb(b.values)?b.values[k]:this.tuix.lovs&&this.tuix.lovs[b.values]&&
this.tuix.lovs[b.values][k],_._isOb(D)&&I._h(D,this,h,k,h,h,b,h,this.tuix.tabs[d])&&(D=!1),D)b.selected_option=D;else if("radio"==w||"select"==w)b.current_value=k="";(B||N||Q)&&""!=k&&(S=this.pickedItemsArray(b,k));b.values&&_._iS(b.values)&&this.tuix.lovs&&this.tuix.lovs[b.values]?b.values=this.tuix.lovs[b.values]:b.load_values_from_organizer_path&&!b.values&&this.loadValuesFromOrganizerPath(b);for(z in b)x(b,z)&&"<"==z[0]&&(ma=z.match(/^<(\/?)(\w+)/))&&(b[z]&&_._iS(b[z])&&(z+=b[z]),K={table:1,tr:2,
td:3,th:4,br:5,div:6,p:7,span:8}[ma[2]]||9,5>K&&(ta=!0),ma[1]?(na||(na=!0,ha="        ".split(" ")),ha[9-K]+=z):(L||(L=!0,ga="        ".split(" ")),ga[K-1]+=z,1==K&&(sa=!0),5==K&&(ra=!0)))}ca||"button"!=w&&"submit"!=w||(b.pressed=!1);if(ca||!m(y)){z=m(b.same_row)?!r(b.same_row):!ra&&(sa||!ta);b._startNewRow=z;D=1*b.indent||0;p=p||I._h(h,this,h,e,h,h,b)||t&&b.hide_when_readonly||r(g&&g.last?b.hide_with_previous_field:b.hide_if_previous_field_is_not_hidden)||r(g&&g.beforeLast?b.hide_with_previous_previous_field:
b.hide_if_previous_previous_field_is_not_hidden)||r(b.hide_with_previous_indented_field)&&g&&g[D]||r(b.hide_with_previous_outdented_field)&&0<D&&g&&g[D-1]||r(b.hide_with_previous_indented_fields)&&!l[D]||m(b.hide_if_previous_value_isnt)&&!q._iL(b.hide_if_previous_value_isnt,f&&f.last)||m(b.hide_if_previous_outdented_value_isnt)&&0<D&&!q._iL(b.hide_if_previous_outdented_value_isnt,f&&f[D-1]);f&&(f.last=k,z&&(f[D]=k));g&&(g.beforeLast=g.last,g.last=p,z&&(g[D]=p),m(l.last)&&l.last===D||(l.last<D&&(l[D]=
!1),l.last=D),p||(l[D]=!0));b._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=w&&"code_editor"!=w&&b._was_hidden_before&&!p?b._showOnOpen=!0:b._startNewRow&&!1!==this.shownTab&&this.shownTab==this.tuix.tab&&"editor"!=w&&"code_editor"!=w&&!b._was_hidden_before&&p&&(b._hideOnOpen=H=!0,b._was_hidden_before=!0);if(p){if(b._was_hidden_before=!0,!H)return!1}else delete b._was_hidden_before;if(ca)return;p||!b.tall_as_possible||m(this.tallAsPossibleField)||(this.tallAsPossibleField=
e,this.tallAsPossibleFieldType=b.type);b.multiple_edit&&(l="",g=!t&&m(b.multiple_edit._changed)?r(b.multiple_edit._changed):b.multiple_edit.changed,r(b.multiple_edit.hide_ui)||!b.multiple_edit.select_list?(f=r(b.multiple_edit.hide_ui),l+=ba("type","checkbox","class","multiple_edit","id","multiple_edit__"+e,"checked",g,"style",f?"display: none;":"","disabled",t,"onchange",t||f?"":this.globalName+".meChange(this.checked, '"+C(e)+"');",">")):l+=oa("class","multiple_edit","id","multiple_edit__"+e,"disabled",
t,"onchange",this.globalName+'.meChange(this.value == 1, "'+U(e)+'");',ja("value","","selected",!g,b.multiple_edit.select_list.not_changed_label||M.notChanged)+ja("value",1,"selected",g,b.multiple_edit.select_list.changed_label||M.changed)),n+=l,l=h);L&&(n+=ga.join(""));m(b.pre_field_html)&&(n+=q._un(b.pre_field_html))}if(!(A&&da||"object"!=typeof b.values))if(A=[],da={},B&&r(B.reorder_items)||N&&r(N.reorder_items))for(K in L=k.split(","),L)x(L,K)&&(E=L[K],A.push(E));else{for(E in b.values)x(b.values,
E)&&(L=b.values[E],"object"==typeof L?(m(L.parent)&&(Z=!0,da[L.parent]=!0),I._h(L,this,h,E,h,h,b,h,this.tuix.tabs[d])||(m(L.ord)?A.push([E,L.ord]):m(L.label)?A.push([E,L.label]):A.push([E,E]))):A.push([E,L]));A.sort(I.sortArray);for(K in A)x(A,K)&&(A[K]=A[K][0])}t?(u.readonly=!0,this.isButton(b)&&(u.disabled=!0,u["class"]+="disabled ")):b.error&&(u["class"]+="zenario_field_with_error ");if("checkboxes"!=w&&(P=this.displayAsTag(b,t))){A=C(k);if("select"==w||"radios"==w)b.values&&b.values[k]?A=C(b.values[k]):
b.empty_value&&(A=C(b.empty_value));n+=ia(P,"id",P+"__"+e,"class",b.css_class,A)}else if(E=b.snippet){for(R in ua)P=ua[R],E[P]&&(n+=ia(P,"id",P+"__"+e,"class",E[P+"_class"],"style",E[P+"_style"],C(E[P])));E.show_split_values_from&&this.splitValues&&this.splitValues[E.show_split_values_from]&&(n+=this.splitValues[E.show_split_values_from],delete this.splitValues[E.show_split_values_from]);E.html&&(n+=Ba("id","snippet__"+e,q._un(E.html)));E.microtemplate&&(n+=fa("id","microtemplate__"+e,this.microTemplate(E.microtemplate,
b)));E.url&&(n=r(E.cache)?this.cachedAJAXSnippets[E.url]?n+this.cachedAJAXSnippets[E.url]:n+(this.cachedAJAXSnippets[E.url]=q._nAA(q._aBP(E.url))):n+q._nAA(q._aBP(E.url)))}else if(("checkboxes"==w||"radios"==w)&&!m(y))t&&b.display_as_text_when_readonly?n+=C(this.displaySelectedItems(e,b,k,d)):b.values&&(Z=_._ex({},b),S=this.pickedItemsArray(b,k),Z.name=b.name||e,Z.type="checkboxes"==w?"checkbox":"radio",t&&(Z.disabled=!0),n=_._isEm(A)?n+ka("class","zenario_no_values_message",C(b.no_values_message)):
n+this.hierarchicalBoxes(a,d,e,k,b,Z,t,S,A,da));else if(B||N||Q){var va=Q||N&&r(N.multiple_select)||B&&r(B.multi);k={id:e,pickerHTML:"",wrappedId:"name_for_"+e,readOnly:t};t||(N&&(N.target_path||N.path)&&!r(N.hide_select_button)&&(k.select={onclick:this.globalName+".pickItems('"+C(e)+"');",phrase:N.select_phrase||M.selectDotDotDot}),B&&(k.upload={onclick:this.globalName+".upload('"+C(e)+"');",phrase:B.upload_phrase||M.uploadDotDotDot},r(B.drag_and_drop)&&this.upload(e,!0),aa.Dropbox&&Dropbox.isBrowserSupported()&&
(k.dropbox={onclick:this.globalName+".chooseFromDropbox('"+C(e)+"');",phrase:B.dropbox_phrase||M.dropboxDotDotDot})));k.pickerHTML+=oa("id",e,"multiple",va,"class",b.css_class,"style",b.style,">");!b.values||_._isEm(S)&&!Q||(k.pickerHTML+=this.hierarchicalSelect(S,b,A,Z,da));k.pickerHTML+="</select>";n+=this.microTemplate(this.mtPrefix+"_picked_items",k);a.after(function(){Q?J.setupMultipleSelect(e,d,b,t||O):J.setupPickedItems(e,d,b,t,va)})}else if(w){Y.onchange=y?"lib.fieldChange('"+C(e)+"', '"+
C(y)+"');":"lib.fieldChange('"+C(e)+"');";O&&(u["class"]+="disabled ");b.validation&&b.validation.numeric&&(u.onkeyup=(u.onkeyup||"")+"lib.keepNumeric(this)");b.return_key_presses_button&&!t&&(u.onkeyup=(u.onkeyup||"")+"if (event.keyCode == 13) {$('#"+C(b.return_key_presses_button)+"').click();}");r(b.multiple_edit)&&!t&&(u.onkeyup=(u.onkeyup||"")+"if (event && event.keyCode == 9) return true; lib.meMarkChanged('"+C(e)+"', this.value, '"+C(b.value)+"');");u["class"]+="input_"+w;switch(w){case "select":b.slider&&
(T=!0,n+=this.drawSlider(a,e,b,t,!0));t&&(u.disabled=!0);n+="<select";break;case "code_editor":n+="<div";u["class"]=" zenario_embedded_ace_editor";a.after(function(){var a=ace.edit(e),l=!1;a.session.setUseSoftTabs(!1);a.setShowPrintMargin(!1);t&&(a.setReadOnly(!0),a.setBehavioursEnabled(!1));r(b.wrap_text)&&a.session.setUseWrapMode(!0);a.session.setOption("useWorker",!1);a.on("blur",function(a){l&&q._aADINS("code_editor_"+e,function(){J.fieldChange(e)},0);l=!1});a.on("change",function(a){J.markAsChanged();
l=!0;q._aADINS("code_editor_"+e,function(){J.fieldChange(e)},5E3)});if(language=b.language)try{language=language.match(/\.twig\.html$/i)?"ace/mode/twig":language.match(/\./)?ace.require("ace/ext/modelist").getModeForPath(language).mode:"ace/mode/"+language,a.session.setMode(language),a.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0})}catch(g){console.log("Ace editor could not load that language",language)}a.$blockScrolling=Infinity;J.setCodeEditorPosition(a,J.editingPositions[d+
"/"+e])});break;case "color_picker":case "colour_picker":n+="<input";u["class"]=" zenario_color_picker";a.after(function(){var a=b.color_picker_options||b.colour_picker_options||{};a.disabled=t;a.preferredFormat=a.preferredFormat||"hex";$(J.get(e)).spectrum(a)});break;case "editor":n+="<textarea";F._gSD();var W,S={script_url:X+q.tinyMCEPath,inline:!1,menubar:!1,statusbar:!1,plugins:"autoresize",document_base_url:h,convert_urls:!1,readonly:!0,inline_styles:!1,allow_events:!0,allow_script_urls:!0,autoresize_max_height:Math.max(Math.floor(0.5*
$(aa).height()),300),autoresize_bottom_margin:10,onchange_callback:function(a){J.fieldChange(a.id)},init_instance_callback:function(a){F._eDDUITM(!1,h,J.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&F._eDDUITM(!1,h,b)}},B=_._ex({},S,{plugins:["advlist autolink lists link image charmap hr anchor","searchreplace code fullscreen","nonbreaking table contextmenu directionality","paste autoresize"],image_advtab:!0,
visual_table_class:" ",browser_spellcheck:!0,paste_preprocess:F.tinyMCEPasteRreprocess,readonly:!1,convert_urls:!0,relative_urls:!1,content_css:h,toolbar:"undo redo | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code",style_formats:F.skinDesc.style_formats,oninit:h}),N=_._ex({},B,{toolbar:"undo redo | image link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code",file_browser_callback:F.fileBrowser,
init_instance_callback:function(a){F._eDDUITM(!0,X,J.get("row__"+(a.editorId||a.id)));var b;(b=a.editorContainer)&&(b=$("#"+a.editorContainer.id+" iframe"))&&(b=b[0])&&(b=b.contentWindow)&&F._eDDUITM(!0,X,b)}});P=_._ex({},N,{toolbar:"undo redo | image | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code"});R=_._ex({},P,{toolbar:"undo redo | link unlink | bold italic | removeformat | fontsizeselect | formatselect | numlist bullist | blockquote outdent indent | code"});
t?(W=S,u["class"]=" tinymce_readonly"):b.insert_image_button?b.insert_link_button?(W=N,u["class"]=" tinymce_with_images_and_links"):(W=P,u["class"]=" tinymce_with_images"):b.insert_link_button?(W=R,u["class"]=" tinymce_with_links"):(W=B,u["class"]=" tinymce");u.style="visibility: hidden;";_._isOb(b.editor_options)&&(W=_._ex(W,b.editor_options));W.setup=function(a){a.on("change",function(a){J.fieldChange(a.id)})};a.after(function(){var a=$(J.get(e)),b=J.get("zenario_abtab"),d=b.style.display;try{a.tinymce().remove()}catch(l){}b.style.display=
"block";a.tinymce(W);b.style.display=d});break;case "button":case "submit":case "toggle":pa=!0;r(b.use_button_tag)?(n+="<button",qa=!0):(n+="<input",u.type="button");if(!t||r(b.can_be_pressed_in_view_mode))Y.onclick="lib.clickButton(this, '"+e+"');",delete u.disabled;"toggle"==w&&(u["class"]+=b.pressed?" pressed":" not_pressed");break;default:"textarea"==w?n+="<textarea":V?(n+='<span class="zenario_datepicker_wrap"><input',u.type="text",u["class"]+=" zenario_datepicker",u.readonly="readonly",t||(u.onkeyup=
(u.onkeyup||"")+"zenario._dFKU(this, event, '"+C(e)+"');"),a.after(function(){var a=$(J.get(e)),d=!!r(b.change_month_and_year);a.datepicker({changeMonth:d,changeYear:d,dateFormat:F.siteSettings&&F.siteSettings.organizer_date_format||q.dpf,altField:"#_value_for__"+e,altFormat:"yy-mm-dd",showOn:"focus",disabled:t,onSelect:function(b,d){a.change()}})})):"url"==w?(n+="<input",u.type="url",u.onfocus=(u.onfocus||"")+"if(!this.value) this.value = 'http://';",u.onblur=(u.onblur||"")+"if(this.value == 'http://') this.value = '';"):
(b.slider&&(T=!0,n+=this.drawSlider(a,e,b,t,!0)),"text"==w&&b.values&&!t&&(n+='<span class="zenario_textbox_with_autocomplete">',la=!0),n+="<input",u.type=w),b.redraw_immediately_onchange&&(u.onkeyup=(u.onkeyup||"")+"if (lib.redrawImmediatelyWhenChanged(this, event, '"+C(e)+"', '"+C(b.value)+"', "+(b.value==k?"false":"true")+")) return false;"),this.addExtraAttsForTextFields(b,u)}if("checkbox"==w||"radio"==w)r(k)&&(u.checked="checked"),k=h,t&&(u.disabled=!0),r(b.indeterminate)&&a.after(function(){var a;
if(a=this.get(e))a.indeterminate=!0});T&&(u.onchange='$("#zenario_slider_for__'+U(e)+'").slider("value", $(this).val());',u.onkeyup=(u.onkeyup||"")+'$("#zenario_slider_for__'+U(e)+'").slider("value", $(this).val());');m(y)?(G=$.extend({},b,G),ea.id=e+"___"+y,u["class"]+=" control_for__"+e):(G=b,ea.id=e);"radio"==w&&b.name||(ea.name=e);t&&(ea.placeholder="");n+=this.outputAtts(G,u,Y,ea);Y=C(pa?b.value:k,!1,"asis");u="";"select"==w?n+=">":qa?(n+=">",b.icon_left&&(n+='<i class="'+C(b.icon_left)+'" aria-hidden="true"></i>'),
n+=Y,b.icon_right&&(n+='<i class="'+C(b.icon_right)+'" aria-hidden="true"></i>'),n+="</button>"):"textarea"==w||"editor"==w?n+=">"+Y+"</textarea>":"code_editor"==w?n+=">"+Y+"</div>":V?(n+=' value="'+C(q._fD(k,"datetime"==w))+'"/>',n+=ba("type","hidden","id","_value_for__"+e,"value",k),t||(n+=ba("type","button","class","zenario_remove_date","value","x","onclick",this.globalName+'.blankField("'+U(e)+'"); $('+this.globalName+'.get("'+U(e)+'")).change();'))):n=m(k)?n+(' value="'+Y+'"/>'):n+"/>";"select"==
w&&(b.empty_value&&(u=ja("value","","data-hide_in_iconselectmenu",1,"selected",!k,C(b.empty_value)),b.show_empty_value_at_end||(n+=u,u="")),b.values&&(S={},S[k]=!0,n+=this.hierarchicalSelect(S,b,A,Z,da)),n+=u+"</select>");if(la){var wa=[];for(K in A)x(A,K)&&(E=A[K],wa.push({label:b.values[E],value:E}));a.after(function(){var a=$(J.get(e)),d={source:wa,minLength:b.autocomplete_min_length||0,appendTo:a.parent()};b.return_key_presses_button&&(d.select=function(){setTimeout(function(){$("#"+b.return_key_presses_button).click()},
0)});a.autocomplete(d);a.focus(function(){a.autocomplete("widget").is(":visible")||a.autocomplete("search","")})});n+=ba("type","button","class","zenario_open_autocomplete","value","\u25be","onclick","$("+this.globalName+'.get("'+U(e)+'")).autocomplete("search", "");')}if(V||la)n+="</span>"}m(y)||("url"!=w||t||(n+="&nbsp; "+ba("type","button","class","submit","value",M.test,"onclick",this.globalName+'.testURL("'+U(e)+'");')),!b.label||"checkbox"!=w&&"radio"!=w||(n+=" "+ka("class",b.label_class,"for",
e,"id","label_for__"+e,C(b.label))),m(b.post_field_label)&&(n+=" "+ka("for",e,"id","label_for__"+e,C(b.post_field_label))),m(b.post_field_html)&&(n+=q._un(b.post_field_html)),na&&(n+=ha.join("")),T&&(n+=this.drawSlider(a,e,b,t,!1)));return n};f.addExtraAttsForTextFields=function(a,d){};var Ca={id:!0,name:!0,size:!0,maxlength:!0,accesskey:!0,"class":!0,cols:!0,dir:!0,readonly:!0,rows:!0,style:!0,tabindex:!0,title:!0,disabled:!0,onblur:!0,onchange:!0,onclick:!0,ondblclick:!0,onfocus:!0,onmousedown:!0,
onmousemove:!0,onmouseout:!0,onmouseover:!0,onmouseup:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onselect:!0,autocomplete:!0,autofocus:!0,max:!0,min:!0,pattern:!0,placeholder:!0,required:!0,step:!0},ua="hr h1 h2 h3 h4 label div p span".split(" ");f.outputAtts=function(a,d,e,b,l){var g,f="";for(g in a)if(x(a,g)&&!(b&&m(b[g])||!l&&!Ca[g]&&"data-"!=g.substr(0,5)))if("disabled"==g||"readonly"==g||"selected"==g){if(r(a[g])||d&&r(d[g])&&delete d[g])f+=" "+g+'="'+g+'"'}else f+=" "+g+'="'+this.defineLibVarBeforeCode(g),
d&&d[g]&&(f+=d[g]+" ",delete d[g]),f+=C(a[g]),e&&e[g]&&(f+=" "+e[g],delete e[g]),f+='"';b&&(f+=this.outputAtts(b,!1,!1,!1,!0));d&&(f+=this.outputAtts(d,!1,!1,!1,!0));e&&(f+=this.outputAtts(e,!1,!1,!1,!0));return f};f.defineLibVarBeforeCode=function(a){if(m(a)&&"on"!=a.substr(0,2))return"";if(!this.globalName){for(a=1;aa[this.globalName="zenarioLib"+a];++a);aa[globalName]=this}return"var lib = "+C(this.globalName)+"; "};f.testURL=function(a){var d=this.get(a).value;a=this.get(this.onThisRow("target_blank_",
a))||this.get(this.onThisRow("target_blank",a));d&&(a&&2==a.value?$.colorbox({href:d,iframe:!0,width:"95%",height:"95%",className:"zenario_url_test_colorbox"}):aa.open(q._aBP(d)))};f.keepNumeric=function(a){var d=a.value.replace(/[^\d\.]/g,"").replace(/\.(.*)\./g,".$1");a.value!=d&&(a.value=d)};f.hierarchicalSelect=function(a,d,e,b,l,g){var f="",ca,p,y,k,t,q;for(t in e)if(x(e,t)){q=e[t];k=d.values[q];p=ca=!1;if(_._iS(k))k={label:k};else if(r(k.disabled)||m(k.disabled_if)&&I._e(k.disabled_if,this,
k,h,q,h,h,d))ca=!0;a[q]&&(p=!0);y=!r(k.hide_when_children_are_not_visible);if(!m(g)&&b&&l[q]){if((childrenHTML=this.hierarchicalSelect(a,d,e,b,l,q))||y)f+=ia("optgroup","label",k,"disabled",!childrenHTML,childrenHTML)}else y&&g===k.parent&&(f+="<option "+this.outputAtts(k,!1,!1,{disabled:ca,selected:p,value:q})+">"+C(k,!1,!0)+"</option>")}return f};f.setupMultipleSelect=function(a,d,e,b){var l=this,g=!1;d=$(this.get(a));d.multiselect({columns:e.cols,texts:{placeholder:e.empty_value||M.selectListSelect,
overridePlaceholder:e.placeholder},onOptionClick:function(){g=!0},onControlClose:function(){g&&l.fieldChange(a)}});b&&d.multiselect("disable")};f.setupPickedItems=function(a,d,e,b,l){var g=this,f=!1,m=!1,p,h,k,t,A=e.pick_items||{},C=e.upload||{},G=r(C.reorder_items||A.reorder_items);if(e.pick_items&&!r(A.disable_type_ahead_search)){p=A.path&&T._cNPTTPAR(A.path);t=A.target_path&&T._cNPTTPAR(A.target_path);if(p=p&&t&&p.path==t.path?p:t||p)h=X+"zenario/admin/organizer.ajax.php?_typeahead_search=1&path="+
Q(p.path)+q._uR(p.request),k="_search";m=r(e.pick_items.allow_typing_anything)}e=$(this.get(a)).tokenize({datas:h,searchParam:k,debounce:200,sortable:G,placeholder:A.nothing_selected_phrase||C.nothing_selected_phrase||M.nothing_selected,onAddToken:function(b,e,k){f||(l||(f=!0,g.addToPickedItems(b,a,d),f=!1),g.$getPickItemsInput(a).focus())},maxElements:l?0:1,parseData:function(e){var l,f,k,s=[],p=g.tuix.tabs[d].fields[a];if(e.items)for(l in e.items)x(e.items,l)&&(f=e.items[l],k=F._fOIN(e,l),p.values=
p.values||{},p.values[l]={list_image:f.list_image,css_class:f.css_class||e.item&&e.item.css_class,label:k},s.push({value:l,text:k,html:g.drawPickedItem(l,a,p,b)}));return s},formatTokenHTML:function(e,l){var f=g.tuix.tabs[d].fields[a];return f.values&&f.values[e]?g.drawPickedItem(e,a,f,b):m?(f.values=f.values||{},f.values[e]=l,g.drawPickedItem(e,a,f,b)):!1},onRemoveToken:function(b,d){g.fieldChange(a)}});b?e.disable():(G&&e.container.addClass("zenario_reorder_items"),h||m?(e.container.addClass("zenario_picker_with_typeahead"),
m&&this.$getPickItemsInput(a).blur(function(){var b,e;if(b=g.$getPickItemsInput(a).val())e={},e[b]=b,g.addToPickedItems(e,a,d)})):e.disableTypeAhead())};f.chooseFromDropbox=function(a){var d=this,e,b,l,f,s;if(!(e=this.field(a))||!e.upload)return!1;if(f=e.upload.extensions||e.upload.accept)f=_._iS(f)?f.split(","):_._tA(f);for(b in f)x(f,b)&&(l=f[b],s=l.split("/"),m(s[1])?f[b]="images"==s[0]?"image":s[0]:"text"!=l&&"documents"!=l&&"images"!=l&&"video"!=l&&"audio"!=l&&"."!=l.substr(0,1)&&(f[b]="."+l));
e={cancel:function(){F._hAL()},linkType:"direct",multiselect:!!r(e.upload.multi),extensions:f,success:function(b){F._sAL();var e,l,f=new q.callback;for(e in b)x(b,e)&&(l=b[e],f.add(q._a(this.ajaxURL()+"&fetchFromDropbox=1",l,!0)));f.after(function(){var b,e,l,f="";if(!(l=d.field(a))||!l.upload)return!1;for(b in arguments)x(arguments,b)&&((e=arguments[b])&&e.id&&(f+=","+e.id),d.setFileDetails(l,e));""!==f&&d.addToPickedItems(f,a);F._hAL()})}};F._sAL();Dropbox.choose(e)};f.setFileDetails=function(a,
d){a.values||(a.values={});d.label=this.formatLabelFromFile(d);a.values[d.id]=d};f.formatLabelFromFile=function(a){var d;m(a.filename)?(d=a.filename,a.ssc&&(d+=" [checksum "+a.short_checksum+"]"),r(a.width)&&r(a.height)&&(d+=" ["+a.width+" \u00d7 "+a.height+"px]")):(fileDetails=q._dIIFO(a.id))&&(fileDetails=fileDetails.split("/"))&&fileDetails[1]?(d=fileDetails[1],r(fileDetails[2])&&r(fileDetails[3])&&(d+=" ["+fileDetails[2]+" \u00d7 "+fileDetails[3]+"px]")):d=a.id;return d};f.upload=function(a,d){var e=
this,b;if(!(b=this.field(a))||!b.upload)return!1;b={class_name:b.class_name,upload:b.upload};this.uploadCallback=function(b){if(b){var d,f,m,p="";if(!(m=e.field(a))||!m.upload)return!1;for(d in b)x(b,d)&&(f=b[d])&&f.id&&(p+=","+f.id,e.setFileDetails(m,f));""!==p&&e.addToPickedItems(p,a)}};d?this.enableDragDropUpload():I._a(this,b,h,h,h,{fileUpload:1},h,this.ajaxURL())};f.ajaxURL=function(){return X+"zenario/ajax.php?method_call=handleAdminBoxAJAX&path="+Q(this.path)};f.enableDragDropUpload=function(){};
f.disableDragDropUpload=function(){};f.uploadComplete=function(a){m(this.uploadCallback)&&this.uploadCallback(a);delete this.uploadCallback};f.drawSlider=function(a,d,e,b,f){var g=this,s=_._cl(e.slider);e="";if(r(s.before_field)?f:!f)b&&(e+='<div class="ui-disabled">'),e+=fa("id","zenario_slider_for__"+d,"class",s["class"],"style",s.style),b&&(e+="</div>"),a.after(function(){var a;if(a=g.get("zenario_slider_for__"+d))m(s.min)&&(s.min=q.num(s.min)),m(s.max)&&(s.max=q.num(s.max)),m(s.step)&&(s.step=
q.num(s.step)),s.disabled=!g.editModeOn(),s.value=$(g.get(d)).val(),s.slide=function(a,b){$(g.get(d)).val(b.value)},s.change=function(a,b){g.fieldChange(d)},$(a).slider(s)});return e};f.lookupFileDetails=function(a){return F._lFD(a)};f.pickedItemsArray=function(a,d){if(!1===d||!m(d))return{};a.values&&_._iS(a.values)&&this.tuix.lovs&&this.tuix.lovs[a.values]&&(a.values=this.tuix.lovs[a.values]);if(!(0!==d&&"0"!==d||a.values&&(a.values[0]||a.values["0"])))return{};var e=(d+"").split(","),b={},f,g,
s,h,p,y,k;a._display_value=!1;for(y in e)x(e,y)&&(k=e[y])&&(a.upload&&(p=q._dIIFO(k))&&(p=p.split("/"))&&p[1]?(b[k]=p[1],r(p[2])&&r(p[3])&&(b[k]+=" ["+p[2]+" \u00d7 "+p[3]+"px]")):a.values&&a.values[k]&&"string"==typeof a.values[k]?b[k]=a.values[k]:a.values&&a.values[k]&&a.values[k].label?b[k]=a.values[k].label:((s=a.pick_items&&a.pick_items.target_path)||(s=a.pick_items&&a.pick_items.path))&&(f=F._gIFO(s,k))?(a.values||(a.values={}),g=F._fOIN(f,k),h=f.items&&f.items[k]||{},b[k]=g,a.values[k]={list_image:h.list_image,
css_class:h.css_class||f.item&&f.item.css_class,label:g}):a.upload&&k==1*k&&(p=this.lookupFileDetails(k))?(this.setFileDetails(a,p),b[k]=a.values[k]):b[k]=k,!1===a._display_value&&(a._display_value=b[k]));return b};f.pickedItemsValue=function(a){var d,e="";if(a)for(d in a)x(a,d)&&(e+=(""===e?"":",")+d);return e};f.displaySelectedItems=function(a,d,e,b){m(d)||(d=this.field(a,b));m(e)||(e=this.value(a,b));a=this.pickedItemsArray(d,e);return _._isEm(a)?r(e)?e:m(d.empty_value)?d.empty_value:"":_._tA(a).join(", ")};
f.hierarchicalBoxes=function(a,d,e,b,f,g,s,q,p,y,k,t,A){var F=1*f.cols||1,G=0,J="",w,B,I,O,M=!1;if(!A)A=0,F=1*f.cols_at_top_level||F;else if(10<A)return"";t||(t={});k&&(t[k]=!0);A&&(J+=fa("class","zenario_hierarchical_box_children","id","children_for___"+e+"___"+k,">"));for(var H in p)if(x(p,H)&&(w={},B=p[H],B==1*B&&(B*=1),O=h,I="object"==typeof f.values[B]?f.values[B]:{label:f.values[B]},f.tag_colors&&(w.tag_color=f.tag_colors[B]||"blue"),O=I.parent,"0"===O&&(O=!1),!k&&!O||k==O)){O=b?!0===b||1===
b||"1"===b?!0===B||1===B||"1"===B:q?m(q[B])?!0:!1:B==b:!B;if(!s||O||!f.hide_unselected_values_when_readonly||y[B]){w.checked=O;if(w.newRow=++G>F)G=1;w.col=G;w.cols=F;if("checkboxes"==f.type&&r(f.checking_child_checks_parents)){var D="";k&&(D+="if (this.checked) { for (var cb in "+JSON.stringify(t)+") { "+this.globalName+".get('"+C(e)+"___' + cb).checked = true; } } ");y[B]&&(D+="if (!this.checked) { $('#children_for___' + this.id + ' input').attr('checked', false); } ");D?g.onchange=f.onchange?D+
" "+f.onchange:D:f.onchange?g.onchange=f.onchange:delete g.onchange}else"checkboxes"==f.type&&r(f.checking_parent_checks_children)&&(D="",y[B]&&(D+="if (this.checked) { $('#children_for___' + this.id + ' input').each(function(i, el) {el.checked = true;}) }; "),D?g.onchange=f.onchange?D+" "+f.onchange:D:f.onchange?g.onchange=f.onchange:delete g.onchange);w.lovId=e+"___"+B;w.lovField=I;f.indeterminates&&r(f.indeterminates[B])&&function(b){a.after(function(){var a;if(a=this.get(b))a.indeterminate=!0})}(w.lovId);
w.lovHTML=this.drawField(a,d,e,g,h,h,h,h,h,B,O,!1,p,y,I);w.childrenHTML="";y[B]&&(w.childrenHTML=this.hierarchicalBoxes(a,d,e,b,f,g,s,q,p,y,B,_._ex({},t),A+1),G=0);M?(this.splitValues||(this.splitValues={}),this.splitValues[e]||(this.splitValues[e]=""),this.splitValues[e]+=this.microTemplate(this.mtPrefix+"_radio_or_checkbox",w)):J+=this.microTemplate(this.mtPrefix+"_radio_or_checkbox",w)}O&&I.split_values_if_selected&&!A&&"radios"===f.type&&(M=!0)}A&&(J+="</div>");return J};f.drawPickedItem=function(a,
d,e,b){m(e)||(e=this.field(d));var f={},g=e.values&&e.values[a];_._isOb(g)?(f=g,g=g.label):(g||(g=a),f.label=g);var s=a==1*a,h,p;d={id:d,item:a,label:g,readOnly:b,css_class:f.css_class,list_image:f.list_image};e.tag_colors&&(d.tag_color=e.tag_colors[a]||"blue");!e.pick_items||r(e.pick_items.hide_info_button)||e.upload&&!s||!(h=e.pick_items.path)||h!=e.pick_items.target_path&&e.pick_items.min_path!=e.pick_items.target_path||(h="//"==q._rHSS(h,2)?h+a:"/"==q._rHSS(h,1)?h+("/"+a):h+("//"+a),d.organizerPath=
h);e.upload&&(d.isUpload=!0,h=(h=(""+g).match(/(.*?)\.(\w+)$/)||(""+g).match(/(.*?)\.(\w+) \[.*\]$/))&&h[2]?h[2].toLowerCase():"unknown",d.extension=h,s?(p=e.values&&e.values[a])&&p.checksum?(a=X+"zenario/file.php?c="+Q(p.checksum),p.usage&&(a+="&usage="+Q(p.usage))):a=X+"zenario/file.php?id="+a:a=X+"zenario/file.php?getUploadedFileInCacheDir="+Q(a),h.match(/gif|jpg|jpeg|png|svg/)?(d.thumbnail={onclick:this.globalName+".showPickedItemInPopout('"+a+"&popout=1&dummy_filename="+Q("image."+h)+"', '"+
g+"');",src:a+"&og=1"},(g=(""+g).match(/.*\[\s*(\d+)p?x?\s*[\u00d7x]\s*(\d+)p?x?\s*\]$/))&&g[1]&&g[2]&&I._rI(g[1],g[2],180,120,d.thumbnail)):d.adminDownload=a+"&adminDownload=1");return this.microTemplate(this.mtPrefix+"_picked_item",d)};f.showPickedItemInPopout=function(a,d){I._a(this,{popout:{href:a,title:d,css_class:"zenario_show_colobox_above_fab"}})};f.pickItems=function(a){var d,e,b,f;(d=this.field(a))&&(e=d.pick_items)&&(e.path||e.target_path)&&(d=f=e.path,T.map&&(f=T._cNPTTP(e.path).path),
r(e.multiple_select)||e.target_path&&e.target_path!=f||!(b=this.readField(a))||-1!=b.indexOf(",")||(d="//"==q._rHSS(d,2)?d+b:"/"==q._rHSS(d,1)?d+("/"+b):d+("//"+b)),this.SKTarget=a,F._oS(this.globalName,"setPickedItems",e.multiple_select,d,e.target_path,e.min_path,e.max_path,e.disallow_refiners_looping_on_min_path,h,e.one_to_one_choose_phrase,e.one_to_many_choose_phrase,h,!0,h,h,h,h,h,h,h,h,e))};f.setPickedItems=function(a,d,e,b){a=this.SKTarget;var f,g,h={};for(f in d._items)x(d._items,f)&&(e=q._dIIFO(f),
g=b.items&&b.items[e]||{},h[e]={list_image:g.list_image,css_class:g.css_class||b.item&&b.item.css_class,label:F._fOIN(b,e)});this.addToPickedItems(h,a)};f.removeFromPickedItems=function(a,d,e){this.addToPickedItems(a,d,e,!0)};f.addToPickedItems=function(a,d,e,b){e=this.field(d,e);var f=this.readField(d),g=e.pick_items&&r(e.pick_items.multiple_select)||e.upload&&r(e.upload.multi),h,m,p={};a=I._cTO(a);m=f?this.pickedItemsArray(e,f):{};for(h in a)if(x(a,h))if(f=a[h],e.values||(e.values={}),b)delete e.values[h];
else if(e.values[h]||(e.values[h]=f),m[h]&&(p[h]=!0),g)m[h]=!0;else{m={};m[h]=!0;break}this.redrawPickedItems(d,e,m,p)};f.redrawPickedItems=function(a,d,e,b){var f,g,h=this.pickedItemsValue(e),m={},p=$(this.get(a)).tokenize(),q=p.toArray();e=I._cTO(e);for(f in q)x(q,f)&&(g=q[f],e[g]&&!b[g]?m[g]=!0:p.tokenRemove(g));for(g in e)x(e,g)&&!m[g]&&(b=d.values&&d.values[g],_._isOb(b)?b=b.label:b||(b=g),p.tokenAdd(g,b));d.current_value=h;this.fieldChange(a)};f.changes=function(a){if(this.tuix&&this.tuix.tab){if(m(a))return this.changed[a];
for(a in this.tuix.tabs)if(x(this.tuix.tabs,a)&&this.changed[a])return!0}return!1};f.markAsChanged=function(a){this.tuix&&(m(a)||(a=this.tuix.tab),a&&!this.changed[a]&&(this.changed[a]=!0,this.tuix.tab==a&&$("#zenario_abtab").addClass("zenario_abtab_changed")))};f.fieldChange=function(a,d){var e=this,b=this.field(a);b&&(b.indeterminate&&(b.indeterminate=!1),m(d)&&b.indeterminates&&b.indeterminates[d]&&(b.indeterminates[d]=!1),this.markAsChanged(),r(b.multiple_edit)&&this.meMarkChanged(a),setTimeout(function(){e.validateFormatOrRedrawForField(b)},
1))};f.validateFormatOrRedrawForField=function(a,d){"string"==typeof a?(this.fieldThatTriggeredRedraw=this.setLastFocus(a),a=this.field(a)):a.id&&(this.fieldThatTriggeredRedraw=this.setLastFocus(a.id));var e=r(a.validate_onchange),b=r(a.format_onchange)||d&&(a.pressed?a.format_on_toggle_on:a.format_on_toggle_off),f=r(a.redraw_onchange);if(e)return 3>this.ffoving&&(this.ffoving=3,this.validate()),!0;if(b)return 2>this.ffoving&&(this.ffoving=2,this.format()),!0;f&&1>this.ffoving&&(this.ffoving=1,this.readTab(),
this.redrawTab());return f};f.redrawImmediatelyWhenChanged=function(a,d,e,b,f){if(a=f?a.value===b:a.value!==b)q._st(d),this.fieldThatTriggeredRedraw=this.setLastFocus(e),1>this.ffoving&&(this.ffoving=1,this.readTab(),this.redrawTab());return a};f.meMarkChanged=function(a,d,e){m(d)&&d==e||(this.field(a).multiple_edit._changed=!0,this.meSetCheckbox(a,!0))};f.meSetCheckbox=function(a,d){"checkbox"==this.get("multiple_edit__"+a).type?this.get("multiple_edit__"+a).checked=d:this.get("multiple_edit__"+
a).value=d?1:""};f.meChange=function(a,d,e){var b=this.field(d);if(a)b.multiple_edit._changed=!0;else{if(!e&&r(b.multiple_edit.warn_when_abandoning_changes)&&m(b.multiple_edit.original_value)&&this.readField(d)!=b.multiple_edit.original_value){a=ba("type","button","class","submit_selected","value",M.abandonChanges,"onclick",this.globalName+'.meChange(false, "'+U(d)+'", true);')+ba("type","button","class","submit","value",M.cancel);F._flBo(M.abandonChangesConfirm,a,"warning");this.meSetCheckbox(d,
!0);return}b.multiple_edit._changed=!1;delete b.current_value;e=b.value;m(b.multiple_edit.original_value)&&(e=b.current_value=b.multiple_edit.original_value);this.get(d)&&!b.pick_items?"checkbox"==this.get(d).type?this.get(d).checked=e?!0:!1:$(this.get(d)).val(e||""):(b=new q.callback,e=this.drawFields(b),this.insertHTML(e,b))}this.meSetCheckbox(d,a);this.validateFormatOrRedrawForField(d)};f.currentValue=function(a,d,e){return e||this.drawingFields||m(d)&&d!=this.tuix.tab?this.value(a,d,e):this.readField(a)};
f.value=function(a,d,e){d||(d=this.tuix.tab);var b="",f=this.field(a,d);if(!f)return"";m(e)||(e=this.fieldIsReadonly(a,f,d));f&&!f.snippet&&"grouping"!=f.type&&(this.isButton(f)?b=!!f.pressed:!e&&m(f.current_value)?b=f.current_value:m(f.value)?b=f.value:f.multiple_edit&&m(f.multiple_edit.original_value)&&(b=f.multiple_edit.original_value));return"0"===b?0:m(b)?b:""};f.mode=function(a){return this.value("mode")};f.keyIn=function(a){return _.contains(arguments,this.tuix.key[a],1)};f.keyIs=function(a,
d){return this.tuix.key[a]==d};f.key=function(a){return this.tuix.key[a]};f.modeIn=function(){return _.contains(arguments,this.mode())};f.modeIs=function(a){return this.mode()==a};f.valueIn=function(a){return _.contains(arguments,this.value(a),1)};f.valueIs=function(a,d){return this.value(a)==d};f.valueIsNot=function(a,d){return this.value(a)!=d};f.isButton=function(a){return a&&("submit"==a.type||"toggle"==a.type||"button"==a.type)};f.isFormField=function(a){return!(!a||a.snippet||"grouping"==a.type||
"submit"==a.type||"toggle"==a.type||"button"==a.type)};f.getCodeEditorPosition=function(a){return{top:a.session.getScrollTop(),left:a.session.getScrollLeft(),range:a.getSelectionRange()}};f.setCodeEditorPosition=function(a,d){d&&(a.session.setScrollTop(d.top),a.session.setScrollLeft(d.left),a.selection.setSelectionRange(d.range))};f.appendCodeEditorValue=function(a,d){var e=ace.edit(a),b=this.getCodeEditorPosition(e);e.setValue(e.getValue()+d);this.setCodeEditorPosition(e,b)};f.readField=function(a){var d=
h,e=this.tuix.tab,b=this.field(a,e),f;if(!this.isFormField(b))return h;var g=this.fieldIsReadonly(a,b,e),s=b._was_hidden_before;b.multiple_edit&&g&&delete b.multiple_edit._changed;if("checkboxes"==b.type||"radios"==b.type){if(!g&&!s&&b.values){var r,s="",p=!0;for(r in b.values)x(b.values,r)&&this.get(a+"___"+r)&&this.get(a+"___"+r).checked&&(s+=(p?"":",")+r,p=!1);b.current_value=s}s=!0}if(s)return g||!m(b.current_value)?b.value:b.current_value;if(this.get("_value_for__"+a))b.current_value=d=this.get("_value_for__"+
a).value;else if("editor"!=b.type&&"code_editor"!=b.type||g)if(!g&&(f=this.get(a))){if("checkbox"==b.type||"radio"==b.type)d=f.checked?!0:!1;else if("color_picker"==b.type||"colour_picker"==b.type)try{d=$(f).spectrum("get").toHexString()}catch(y){d=$(f).val()}else d=$(f).val();m(d)||(d="");_._isAr(d)&&(d=d.join(","));b.current_value=d}else delete b.current_value,d=b.value;else{var k,t;if("editor"==b.type){if(a=aa.tinyMCE&&tinyMCE.get(a))k=q._tMGC(a)}else"code_editor"==b.type&&(t=ace.edit(a))&&(k=
t.getValue(),this.editingPositions[e+"/"+a]=this.getCodeEditorPosition(t));if(m(k)&&!1!==k)d=b.current_value=k;else return m(b.current_value)?b.current_value:b.value}return d};f.blankField=function(a){this.setFieldValue(a,"")};f.setFieldValue=function(a,d){field=this.field(a,this.tuix.tab);this.get(a)&&$(this.get(a)).val(d);this.get("_value_for__"+a)&&(this.get("_value_for__"+a).value=d);field.current_value=d};f.readTab=function(){var a,d={},e=this.fields(),b;this.lastScrollTop=$("#zenario_fbAdminInner").scrollTop();
for(b in e)x(e,b)&&m(a=this.readField(b))&&(d[b]=a);R&&R.activeElement&&(this.lastFocus=this.setLastFocus(R.activeElement));return d};f.wipeTab=function(){var a=this.fields(),d,e;for(d in a)x(a,d)&&(e=a[d],delete e.current_value,e.multiple_edit&&delete e.multiple_edit._changed)};f.redrawTab=function(){this.tuix.shake=!1;this.draw2()};f.getURL=function(a){++this.onKeyUpNum;return this.returnAJAXURL(a)};f.returnAJAXURL=function(a){return"..."};f.editModeOn=function(a){return!0};f.editModeAlwaysOn=function(a){return!0};
f.editCancelEnabled=function(a){return!1};f.revertEnabled=function(a){return!1};f.savedAndContinued=function(a){return!1};f.editModeOnBox=function(){return!0};f.sortTabs=function(){this.sortedTabs=[];if(this.tuix.tabs)for(var a in this.tuix.tabs)if(x(this.tuix.tabs,a)){var d=this.tuix.tabs[a];d&&this.sortedTabs.push([a,d.ord])}this.sortedTabs.sort(I.sortArray);this.groupings={};this.sortedFields={};for(a in this.sortedTabs)x(this.sortedTabs,a)&&(d=this.sortedTabs[a]=this.sortedTabs[a][0],this.sortFields(d))};
f.sortFields=function(a){var d,e,b,f,g={};this.groupings[a]={};this.sortedFields[a]=[];if(b=this.fields(a)){for(d in b)x(b,d)&&(e=b[d],e.type&&"grouping"==e.type&&(g[e.name||d]=1*e.ord,this.groupings[a][e.name||d]=d));for(d in b)x(b,d)&&(!(e=b[d])||e.type&&"grouping"==e.type||(f=e.grouping?g[e.grouping]:h,this.sortedFields[a].push([d,e.ord,f])));this.sortedFields[a].sort(I.sortArrayWithGrouping);for(d in this.sortedFields[a])x(this.sortedFields[a],d)&&(this.sortedFields[a][d]=this.sortedFields[a][d][0])}};
f.setData=function(a){this.tuix=a};f.setDataDiff=function(a){this.syncAdminBoxFromServerToClient(a,this.tuix)};f.syncAdminBoxFromServerToClient=function(a,d){var e,b;for(e in a)x(a,e)&&(b=a[e],!m(b)||b["[[__unset__]]"]?delete d[e]:m(d[e])?b["[[__replace__]]"]?(delete b["[[__replace__]]"],d[e]=b):"object"!=typeof d[e]?d[e]=b:"object"==typeof d[e]&&"object"!=typeof b?d[e]=b:this.syncAdminBoxFromServerToClient(b,d[e]):d[e]=b)};f.sendStateToServer=function(){return JSON.stringify(this.tuix)};f.sendStateToServerDiff=
function(){var a={};this.syncAdminBoxFromClientToServerR(a,this.tuix);return JSON.stringify(a)};f.syncAdminBoxFromClientToServerR=function(a,d,e,b,f,g,h,r){if("object"==typeof d){var p,y,k;for(y in d)if(!m(e)&&q.IN(y,"download","path","shake","tab","switchToTab")&&(p="value")||!m(e)&&q.IN(y,"_sync","tabs")&&(p="array")||!m(b)&&"_sync"==e&&q.IN(y,"cache_dir","password","session","iv")&&(p="value")||!m(b)&&"tabs"==e&&(p="array")||!m(f)&&"tabs"==b&&"_was_hidden_before"==y&&(p="value")||!m(f)&&"tabs"==
b&&q.IN(y,"edit_mode","fields")&&(p="array")||!m(g)&&"tabs"==f&&"edit_mode"==e&&"on"==y&&(p="value")||!m(g)&&"tabs"==f&&"fields"==e&&(p="array")||!m(h)&&"tabs"==g&&"fields"==b&&q.IN(y,"_display_value","_was_hidden_before","current_value","pressed")&&(p="value")||!m(h)&&"tabs"==g&&"fields"==b&&"multiple_edit"==y&&(p="array")||!m(r)&&"tabs"==h&&"fields"==f&&"multiple_edit"==e&&"_changed"==y&&(p="value"))if("value"==p)switch(k=d[y],typeof k){case "function":case "object":break;case "string":"`"===k[0]?
k="`1"+k.substr(1):"/"===k[0]&&(k="`2"+k.substr(1));default:a[y]=k}else"array"==p&&"object"==typeof d[y]&&(a[y]={},this.syncAdminBoxFromClientToServerR(a[y],d[y],y,e,b,f,g,h))}};f.getValueArrayofArrays=function(a){return q._nAA(this.getURL(),q._uR({_read_values:!0,_box:this.sendStateToServer()}),!a)};f.getValues1D=function(a,d,e,b,f){var g,h,q,p,r,k={};if(this.tuix&&this.tuix.tabs)for(g in this.tuix.tabs)if(x(this.tuix.tabs,g)&&(h=this.tuix.tabs[g],h.fields))for(q in h.fields)!x(h.fields,q)||(p=h.fields[q],
r=q,!this.isFormField(p)||b&&this.fieldIsReadonly(q,p,g)||f&&(h._was_hidden_before||p._was_hidden_before)||a&&!(r=p.plugin_setting&&p.plugin_setting.name)||(p=this.currentValue(q,g,e),d||(k[r]=p),!d&&m(d)))||(k[g+"/"+q]=p);return k};f.insertText=function(a,d){_._iS(a)&&(a=this.get(a));if(a){var e=$(a),b=a.selectionStart,f=a.selectionEnd,g=e.val();e.val(g.substring(0,b)+d+g.substring(f));a.selectionStart=a.selectionEnd=b+d.length;a.focus()}};f.callFunctionOnEditors=function(a){var d,e,b;if(aa.tinyMCE&&
(d=this.fields()))for(e in d)if(x(d,e)&&(b=d[e],"editor"==b.type&&tinyMCE.get(e)))if("remove"==a)tinyMCE.get(e).remove();else if("isDirty"==a&&tinyMCE.get(e).isDirty())return!0;return!1};f.format=function(a){var d;if(this.loaded&&(d=this.getURL("format"))){var e=this,b=this.tuix&&this.tuix.tab;this.loaded=!1;this.hideTab();this.checkValues(a);this.retryAJAX(d,{_format:!0,_box:this.sendStateToServer()},!0,function(a){e.load(a);e.switchTabIfRequested(b);e.sortTabs();e.draw()},"loading")}};f.validate=
function(a,d,e,b){var f;if(this.loaded&&(f=this.getURL("validate"))){this.differentTab=a;this.loaded=!1;this.hideTab(a);this.checkValues(e);var g=this,h=this.tuix&&this.tuix.tab;a&&(g.tuix.switchToTab=d);this.retryAJAX(f,{_validate:!0,_box:this.sendStateToServer()},!0,function(a){g.load(a)&&g.switchTabIfRequested(h);g.sortTabs();g.switchToATabWithErrors();g.draw();b&&b()},"loading")}};f.switchTabIfRequested=function(a){this.tuix.switchToTab&&(a=a||this.tuix&&this.tuix.tab,this.errorOnTab(a)?this.tuix.tab=
a:this.tuix.tab=this.tuix.switchToTab,delete this.tuix.switchToTab)}})},zenarioF);
