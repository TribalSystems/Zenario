var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(l,k){return Object.prototype.hasOwnProperty.call(l,k)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,k,p){if(l==Array.prototype||l==Object.prototype)return l;l[k]=p.value;return l};$jscomp.getGlobal=function(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<l.length;++k){var p=l[k];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(l,k){var p=$jscomp.propertyToPolyfillSymbol[k];if(null==p)return l[k];p=l[p];return void 0!==p?p:l[k]};
$jscomp.polyfill=function(l,k,p,q){k&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(l,k,p,q):$jscomp.polyfillUnisolated(l,k,p,q))};$jscomp.polyfillUnisolated=function(l,k,p,q){p=$jscomp.global;l=l.split(".");for(q=0;q<l.length-1;q++){var u=l[q];if(!(u in p))return;p=p[u]}l=l[l.length-1];q=p[l];k=k(q);k!=q&&null!=k&&$jscomp.defineProperty(p,l,{configurable:!0,writable:!0,value:k})};
$jscomp.polyfillIsolated=function(l,k,p,q){var u=l.split(".");l=1===u.length;q=u[0];q=!l&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var x=0;x<u.length-1;x++){var C=u[x];if(!(C in q))return;q=q[C]}u=u[u.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[u]:null;k=k(p);null!=k&&(l?$jscomp.defineProperty($jscomp.polyfills,u,{configurable:!0,writable:!0,value:k}):k!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[u]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[u]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(u):$jscomp.POLYFILL_PREFIX+p+"$"+u),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[u],{configurable:!0,writable:!0,value:k})))};$jscomp.polyfill("Object.values",function(l){return l?l:function(k){var p=[],q;for(q in k)$jscomp.owns(k,q)&&p.push(k[q]);return p}},"es8","es3");$jscomp.arrayIteratorImpl=function(l){var k=0;return function(){return k<l.length?{done:!1,value:l[k++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};
$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(l){l={next:l};l[Symbol.iterator]=function(){return this};return l};$jscomp.iteratorFromArray=function(l,k){l instanceof String&&(l+="");var p=0,q=!1,u={next:function(){if(!q&&p<l.length){var x=p++;return{value:k(x,l[x]),done:!1}}q=!0;return{done:!0,value:void 0}}};u[Symbol.iterator]=function(){return u};return u};
$jscomp.polyfill("Array.prototype.values",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(k,p){return p})}},"es8","es3");
zenario.lib(function(l,k,p,q,u,x,C,y,z,D,I,A,J,B,K,L,M,N,O,F,G,v,E){k=G(E.form_builder=F(E.form_builder_base_class));k.showPanel=function(d,a,c){d.html("").hide();c.html("").show();d=this.getMainPanelHTML();a.html(d).show();this.currentPageId=this.currentPageId?this.currentPageId:!1;this.editingThing=this.editingThing?this.editingThing:!1;this.editingThingId=this.editingThingId?this.editingThingId:!1;this.editingThingTUIXTabId=this.editingThingTUIXTabId?this.editingThingTUIXTabId:!1;this.editingNameFieldComplete=
this.editingNameField=!1;this.deletedPages=[];this.deletedFields=[];this.deletedValues=[];this.pagesReordered=this.changeMadeOnPanel=!1;this.newItemCount=0;0==this.getOrderedPages().length&&this.createPage();this.fixTUIXData();this.loadPagesList();this.loadFieldsList(this.currentPageId);"field"==this.editingThing?this.openFieldEdit(this.editingThingId,this.editingThingTUIXTabId,!0):"page"==this.editingThing?this.openPageEdit(this.editingThingId,this.editingThingTUIXTabId,!0):this.loadNewFieldsPanel(!0);
this.changesSaved&&(this.changesSaved=!1,y.toast({message_type:"success",message:"Your changes have been saved!"}))};k.fixTUIXData=function(){for(var d=this.getOrderedPages(),a=0;a<d.length;a++){var c=this.getItem("page",d[a].id);c.visible_condition_checkboxes_field_value&&(c.visible_condition_checkboxes_field_value=z._mgu(c.visible_condition_checkboxes_field_value));c=this.getOrderedFields(c.id);for(var b=0;b<c.length;b++){var e=this.getItem("field",c[b].id);"calculated"==e.type&&e.calculation_code&&
(e.calculation_code=z._mgu(e.calculation_code));e.invalid_responses&&(e.invalid_responses=z._mgu(e.invalid_responses));e.visible_condition_checkboxes_field_value&&(e.visible_condition_checkboxes_field_value=z._mgu(e.visible_condition_checkboxes_field_value));e.mandatory_condition_checkboxes_field_value&&(e.mandatory_condition_checkboxes_field_value=z._mgu(e.mandatory_condition_checkboxes_field_value))}}};k.getMainPanelHTML=function(){return this.microTemplate("zenario_organizer_form_builder",{form_title:this.tuix.form_title})};
k.loadPagesList=function(){var d=this,a=d.getOrderedPages();!d.currentPageId&&0<a.length&&(d.currentPageId=a[0].id);for(var c=0;c<a.length;c++)d.currentPageId==a[c].id&&(a[c]._is_current_page=!0),a[c].name=d.formatPageLabel(a[c].name);1>=a.length&&(a=!1);a=d.microTemplate("zenario_organizer_form_builder_tabs",{pages:a});$("#organizer_form_tabs").html(a);$("#organizer_form_tabs .tab").on("click",function(){var b=$(this).data("id");d.tuix.pages[b]&&d.clickPage(b)});$("#organizer_add_new_tab").on("click",
function(){if(d.saveCurrentOpenDetails()){var b=d.createPage();d.clickPage(b,!0);d.changeMadeToPanel()}});$("#organizer_form_tabs").sortable({containment:"parent",tolerance:"pointer",items:"div.sort",start:function(b,e){d.startIndex=e.item.index()},stop:function(b,e){d.startIndex!=e.item.index()&&($("#organizer_form_tabs .tab.sort").each(function(f){var g=$(this).data("id");d.tuix.pages[g].ord=f+1}),d.pagesReordered=!0,d.changeMadeToPanel(),"page"==d.editingThing&&(d.saveCurrentOpenDetails(),d.openPageEdit(d.editingThingId,
d.editingThingTUIXTabId,!0)))}});$("#organizer_form_tabs .tab").droppable({accept:"div.is_sortable:not(.repeat_end)",greedy:!0,hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(b,e){d.saveCurrentOpenDetails()&&(b=$(this).data("id"),e=$(e.draggable).data("id"),b&&e&&(d.moveFieldToPage(d.currentPageId,b,e),"field"==d.editingThing&&d.editingThingId==e&&d.loadNewFieldsPanel(),d.loadFieldsList(d.currentPageId)))}})};k.getOrderedMergeFieldsForFields=function(d){var a=[],c=[],b={},e;for(e in this.tuix.pages[d].fields)if(v(this.tuix.pages[d].fields,
e)){var f=_.clone(this.tuix.items[e]);f.lov=this.getOrderedFieldValues(e);f.is_consent&&(f.type="consent");"field"==this.editingThing&&this.editingThingId==f.id&&(f._is_current_field=!0);f.dataset_field_id&&(f._hide_duplicate_button=!0);f.dataset_repeat_grouping?(b[f.dataset_repeat_grouping]||(b[f.dataset_repeat_grouping]={},b[f.dataset_repeat_grouping].fields=[]),"repeat_start"!=f.type&&(f._hide_drag_button=!0,f._hide_delete_button=!0,f._hide_duplicate_button=!0),c.push(f)):(f._is_sortable=!0,a.push(f))}if(0<
c.length)for(d=0;d<c.length;d++)b[c[d].dataset_repeat_grouping].fields.push(c[d]);for(var g in b)v(b,g)&&(c=b[g],c.fields.sort(this.sortByOrd),c.fields.length&&(c.ord=c.fields[0].ord,c._is_sortable=!0,a.push(c)));a.sort(this.sortByOrd);b=!1;for(d=0;d<a.length;d++)"repeat_start"==a[d].type?b=!0:"repeat_end"==a[d].type?b=!1:b&&(a[d]._is_repeat_field=!0);return a};k.getOrderedMergeFieldsForDatasetFields=function(){for(var d=[],a={},c=this.getOrderedFields(),b=0;b<c.length;b++)c[b].dataset_field_id&&
(a[c[b].dataset_field_id]=!0);for(var e in this.tuix.dataset.tabs)if(v(this.tuix.dataset.tabs,e)){c=this.tuix.dataset.tabs[e];b=_.clone(c);b.fields=[];for(var f in c.fields)if(v(c.fields,f)){var g=_.clone(this.tuix.dataset.fields[f]);a[f]||0!=g.repeat_start_id||(g.tab_label=b.label?b.label:b.default_label,b.fields.push(g))}b.fields.sort(this.sortByOrd);d.push(b)}d.sort(this.sortByOrd);return d};k.getFormFieldMergeName=function(d){var a=this.getItem("field",d);return a.db_column?a.db_column:"unlinked_"+
a.type+"_"+d};k.createPage=function(){var d="t"+ ++this.newItemCount,a=1,c=this.getOrderedPages();c.length&&(a=c[c.length-1].ord+1);var b={};b.id=d;b.ord=a;b._just_added=!0;b.fields={};b.name="Step "+(c.length+1);for(var e in this.tuix.form_page_details.tabs)if(v(this.tuix.form_page_details.tabs,e)&&(a=this.tuix.form_page_details.tabs[e],a.fields))for(var f in a.fields)v(a.fields,f)&&(c=a.fields[f],B(c.value)&&!B(b[f])&&(b[f]=c.value));this.tuix.pages[d]=b;return d};k.createField=function(d,a,c,b){var e=
"t"+ ++this.newItemCount,f={};if(c){if(d=this.tuix.dataset.fields[c],f.type=d.type,"consent"==f.type&&(f.type="checkbox",f.is_consent=!0),f.name=d.label.r(/:$/,""),f.label=d.label,f.dataset_field_id=c,f.values_source=d.values_source,f.values_source_filter=d.values_source_filter,f.db_column=d.db_column,"terms_and_conditions_accepted"==d.db_column&&(f.label="By submitting your details you are agreeing that we can store your data for legitimate business purposes and contact you to inform you about our products and services.",
f.note_to_user='Full details can be found in our <a href="privacy" target="_blank">privacy policy</a>.'),d.repeat_start_id&&(f.dataset_repeat_grouping=d.repeat_start_id),d.lov&&(f.lov=d.lov),"repeat_start"==d.type){f.dataset_repeat_grouping=d.id;var g=[];for(m in this.tuix.dataset.tabs[d.tab_name].fields)v(this.tuix.dataset.tabs[d.tab_name].fields,m)&&(b=this.tuix.dataset.fields[m],b.repeat_start_id==c&&(b=_.clone(b),g.push(b)));g.sort(this.sortByOrd);for(c=0;c<g.length;c++)this.createField(l,a+.001*
(c+1),g[c].id)}}else if(b){if(f=JSON.parse(JSON.stringify(this.getItem("field",b))),"checkboxes"==f.type||"sortable_selection"==d||"select"==f.type||"radios"==f.type)for(g in c=f.lov,delete f.lov,f.lov={},c)this.addFieldValue(f,c[g].label,c[g].ord)}else if(f.type=d,f.label="Untitled",f.name="Untitled "+this.getFieldReadableType(d).toLowerCase(),"checkboxes"==d||"sortable_selection"==d||"radios"==d||"select"==d)for(f.lov={},c=1;3>=c;c++)this.addFieldValue(f,"Option "+c);else"repeat_start"==d&&this.createField("repeat_end",
a+.001);for(var h in this.tuix.form_field_details.tabs)if(v(this.tuix.form_field_details.tabs,h)&&(c=this.tuix.form_field_details.tabs[h],c.fields))for(var n in c.fields)if(v(c.fields,n)){var m=c.fields[n];B(m.value)&&!B(f[n])&&(f[n]=m.value)}f.id=e;f.page_id=this.currentPageId;f.ord=a;f._just_added=!0;this.tuix.pages[this.currentPageId].fields[e]=1;this.tuix.items[e]=f;this.loadFieldsList(this.currentPageId);return e};k.clickPage=function(d,a){if(("page"!=this.editingThing||this.editingThingId!=
d)&&this.saveCurrentOpenDetails()&&this.displayPageFieldOrderErrors())if(this.currentPageId!=d){var c=!this.editingThing;this.currentPageId=d;this.editingThing=!1;this.loadPagesList();this.loadFieldsList(d);this.loadNewFieldsPanel(c);a&&this.clickPage(d)}else{this.editingThing="page";this.editingThingId=d;this.editingThingTUIXTabId=!1;this.tuix.form_page_details.tabs.details.label="Step details";var b=0;Object.keys(this.tuix.pages).forEach(function(f){b++});var e=0;0<b&&Object.values(this.tuix.pages).forEach(function(f){f.ord==
b&&(e=f.id)});this.currentPageId==e?this.tuix.form_page_details.tabs.details.fields.visibility.note_below="Please ensure the form settings are set to 'Enable summary step', in case this step is not visible.":delete this.tuix.form_page_details.tabs.details.fields.visibility.note_below;this.openPageEdit(d)}};k.clickField=function(d,a){if(("field"!=this.editingThing||this.editingThingId!=d)&&"repeat_end"!=this.tuix.items[d].type&&this.saveCurrentOpenDetails()){var c=this.getItem("field",d);!a&&c._just_added&&
delete c._just_added;this.editingThing="field";this.editingThingId=d;this.editingThingTUIXTabId=!1;this.tuix.form_field_details.tabs.details.label="repeat_start"==this.tuix.items[d].type?"Section details":"Field details";this.loadFieldsList(this.currentPageId);this.openFieldEdit(d)}};k.openEdit=function(d,a,c,b){var e=this;e.editingNameField=!1;e.editingNameFieldComplete=!1;var f=e.getItem(d,a),g=e.getTUIXModeForItemType(d);g=e.tuix[g];var h={name:f.name,hide_tab_bar:g.hide_tab_bar};"page"==d?(h.type=
"page_break",h.mode="edit_page",f.type=h.type):"field"==d&&(h.type=f.type,h.mode="edit_field");h.type_phrase=e.getFieldReadableType(f);f.dataset_field_id&&(h.type_phrase+=", linked field \u2192 "+f.db_column);var n=e.microTemplate("zenario_organizer_form_builder_left_panel",h);h=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(n);f=e.getTUIXTabs(g,c,f);c=e.editingThingTUIXTabId;n=e.getTUIXTabsHTML(f);$("#organizer_field_details_tabs").html(n);e.openItemTUIXTab(d,a,
c);b||h.hide().show("drop",{direction:"left"},200);$("#organizer_field_details_tabs .tab").on("click",function(){var m=$(this).data("id");m&&m!=c&&e.saveCurrentOpenDetails()&&e.openEdit(d,a,m,!0)});$("#organizer_field_details_inner span.add_new_field").on("click",function(){e.saveCurrentOpenDetails()&&(e.loadNewFieldsPanel(),e.loadFieldsList(e.currentPageId))});$("input.form_settings").on("click",function(){e.openFormSettings()});$("#zenario_field_details_header_content .edit_field_name_button").on("click",
function(){$("#zenario_field_details_header_content .view_mode").hide();$("#zenario_field_details_header_content .edit_mode").show();e.editingNameField=!0});$("#zenario_field_details_header_content .done_field_name_button").on("click",function(){$("#zenario_field_details_header_content .edit_mode").hide();$("#zenario_field_details_header_content .view_mode").show();e.editingNameField=!1;e.editingNameFieldComplete=!0;var m=$("#field__name").val();$("#zenario_field_details_header_content .view_mode h5").text(m)});
$("#field__name").on("keyup",function(){e.changeMadeToPanel();if("page"==d){var m=e.formatPageLabel($(this).val());$("#organizer_form_tab_"+e.currentPageId+" span").text(m)}})};k.deletePage=function(d){var a=this.getOrderedPages();if(!(2>a.length))for(var c=this.getOrderedFields(d),b=0;b<a.length;b++)if(a[b].id==d){if(a[b-1])for(a=a[b-1].id,b=0;b<c.length;b++)this.moveFieldToPage(d,a,c[b].id);else for(a=a[b+1].id,b=c.length-1;0<=b;b--)this.moveFieldToPage(d,a,c[b].id,!0);this.deletedPages.push(d);
delete this.tuix.pages[d];this.clickPage(a);this.changeMadeToPanel();break}};k.deleteField=function(d){var a=this.tuix.items[d],c=this.getOrderedFields(a.page_id);if("repeat_start"==a.type){var b=this.getMatchingRepeatEnd(d);if(b){var e=this.tuix.items[b];this.deletedFields.push(b);delete this.tuix.pages[e.page_id].fields[b];delete this.tuix.items[b]}}if(a.dataset_repeat_grouping&&"repeat_start"==a.type)for(b=0;b<c.length;b++)c[b].dataset_repeat_grouping&&c[b].dataset_repeat_grouping==a.dataset_repeat_grouping&&
"repeat_start"!=c[b].type&&(this.deletedFields.push(c[b].id),delete this.tuix.pages[a.page_id].fields[c[b].id],delete this.tuix.items[c[b].id]);var f=e=!1;c=this.getOrderedFields(a.page_id);for(b=0;b<c.length;b++)if(c[b].id==d&&(e=b),!1!==e)if(0<e){f=c[e-1].id;break}else if(d!=c[b].id){f=c[b].id;break}f&&"repeat_end"==this.tuix.items[f].type&&(f=!1);this.deletedFields.push(d);delete this.tuix.pages[a.page_id].fields[d];delete this.tuix.items[d];this.changeMadeToPanel();this.loadFieldsList(a.page_id);
f?this.clickField(f):this.loadNewFieldsPanel()};k.addTUIXTabEvents=function(d,a,c){var b=this,e=b.getItem(d,a),f=b.tuix[b.getTUIXModeForItemType(d)];if("page"==d)$("#organizer_remove_form_page").on("click",function(g){g="<p>Are you sure you want to delete this step?</p>";e.fields.length&&(g+="<p>All fields on this page will be moved onto the previous page.</p>");y._g82(g,"Delete","warning",!0,!1,l,l,function(){b.deletePage(a)})});else if("field"==d)if("details"==c)$("#field__label").on("keyup",function(){$("#organizer_form_field_"+
a+" .label").text($(this).val());if(e._just_added&&!b.editingNameField&&!b.editingNameFieldComplete){var g=$(this).val().r(/:/g,"");$("#field__name").val(g);$("#field_display__name").text(g)}}),$("#field__note_to_user").on("keyup",function(){var g=$(this).val().trim();$("#organizer_form_field_note_below_"+a+" div.zenario_note_content").text(g);$("#organizer_form_field_note_below_"+a).toggle(""!==g)}),$("#field__placeholder").on("keyup",function(){$("#organizer_form_field_"+a+" :input").prop("placeholder",
$(this).val())}),$("#field__description").on("keyup",function(){$("#organizer_form_field_"+a+" .description").text($(this).val())}),$("#edit_field_calculation").on("click",function(){for(var g={},h=b.getOrderedFields(),n=0;n<h.length;n++){var m=h[n];if("text"==m.type&&-1!=["number","integer","floating_point"].indexOf(m.field_validation)||"calculated"==m.type&&m.id!=a)g[m.id]={label:m.name,ord:n}}h={id:a,title:'Editing the calculation for the field "'+e.name+'"',calculation_code:JSON.stringify(e.calculation_code)};
g={details:{dummy_field:JSON.stringify(g)}};D.open("zenario_field_calculation",h,l,g,function(t,r){e.calculation_code=r.details.calculation_code?JSON.parse(r.details.calculation_code):"";b.tuixFieldDetailsChanged(d,a,c,"calculation_code")})});else if("advanced"==c)$("#field__css_classes").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .css").toggle(!!$(this).val()).prop("title",$(this).val())}),$("#field__div_wrap_class").on("keyup",function(){$("#organizer_form_field_"+
a+" .form_field_classes .div").toggle(!!$(this).val()).prop("title",$(this).val())}),$("#field__rows").on("keyup",function(){$("#organizer_form_field_"+a+" :input").attr("rows",$(this).val())});else if("values"==c)$("#field_values_list").sortable({containment:"parent",tolerance:"pointer",axis:"y",start:function(g,h){b.startIndex=h.item.index()},stop:function(g,h){b.startIndex!=h.item.index()&&(b.saveFieldListOfValues(a),b.loadFieldValuesListPreview(a),b.changeMadeToPanel())}}),$("#field_values_list input").on("keyup",
function(){var g=$(this).data("id");$("#organizer_field_value_"+g+" label").text($(this).val());b.changeMadeToPanel()}),$("#organizer_add_a_field_value").on("click",function(){b.addFieldValue(e);b.saveTUIXTab(f,c,e);b.openItemTUIXTab(d,a,c);b.loadFieldValuesListPreview(a);b.changeMadeToPanel()}),$("#field_values_list .delete_icon").on("click",function(){var g=$(this).data("id");e.lov[g]&&(b.deletedValues.push(g),delete e.lov[g],delete e.crm_lov[g]);b.saveTUIXTab(f,c,e);b.openItemTUIXTab(d,a,c);b.loadFieldValuesListPreview(a);
b.changeMadeToPanel()});else if("translations"==c)$("#organizer_field_translations input").on("keyup",function(){b.changeMadeToPanel()});else"crm"==c&&($("#field__crm_validate_test").on("click",function(){b.saveTUIXTab(f,c,e);var g={mode:"validate_salesforce_field",item:JSON.stringify(e)};b.sendAJAXRequest(g,function(h){if(!0===h)b.openItemTUIXTab(d,a,b.editingThingTUIXTabId,l,l,["Field is valid."]);else if(!1===h){var n=["Something went wrong. Validation could not be completed."];b.openItemTUIXTab(d,
a,b.editingThingTUIXTabId,n)}else if(h.error){n=[];if("missing_values"==h.error)for(var m=0;m<h.values.length;m++)n.push('Field value not found: "'+h.values[m]+'"');else"not_found"==h.error?n.push("Field not found."):"too_many_values"==h.error?n.push("Too many values to load from Salesforce."):n.push("Unknown error.");b.openItemTUIXTab(d,a,b.editingThingTUIXTabId,n)}})}),$("#organizer_crm_button__set_labels").on("click",function(){b.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(g,
h){g=$(this).data("id");h="";e.lov&&e.lov[g]&&(h=e.lov[g].label);$(this).val(h)})}),$("#organizer_crm_button__set_values").on("click",function(){b.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(g,h){$(this).val($(this).data("id"))})}),$("#organizer_field_crm_values input.crm_value_input").on("keyup",function(){b.changeMadeToPanel()}))};k.loadFieldsList=function(d){var a=this,c={fields:a.getOrderedMergeFieldsForFields(d)};c=a.microTemplate("zenario_organizer_form_builder_section",
c);$("#organizer_form_fields").html(c);$("#organizer_form_fields div.form_field").on("click",function(){var e=$(this).data("id");a.tuix.items[e]&&a.clickField(e)});var b;$("#organizer_form_fields div.form_field").hover(function(){var e=this;b||(b=setTimeout(function(){b=null;var f=$(e).data("id");$("#organizer_form_field_"+f+" .form_field_classes").show()},200))},function(){if(b)clearTimeout(b),b=null;else{var e=$(this).data("id");"field"==a.editingThing&&e!=a.editingThingId&&$("#organizer_form_field_"+
e+" .form_field_classes").hide()}});$("#organizer_form_builder").tooltip();$("#organizer_form_fields .form_section").sortable({items:"div.is_sortable",tolerance:"pointer",placeholder:"preview",receive:function(e,f){$(this).find("div.field_type, div.dataset_field").each(function(){var g=$(this).data("type"),h=$(this).data("id"),n=.1,m=$(this).prev().data("id");m&&a.tuix.items[m]?n=a.tuix.items[m].ord+.1:(m=$(this).next().data("id"))&&a.tuix.items[m]&&(n=a.tuix.items[m].ord-.1);g=a.createField(g,n,
h);a.clickField(g,!0);a.updateFieldOrds()})},start:function(e,f){a.startIndex=f.item.index()},stop:function(e,f){a.startIndex!=f.item.index()&&(a.tuix.pages[d].fields_reordered=!0,a.updateFieldOrds(),a.loadFieldsList(d))}});$("#organizer_form_fields .delete_icon").on("click",function(e){e.stopPropagation();var f=$(this).data("id");if(a.saveCurrentOpenDetails(!0)){var g=a.tuix.items[f];e={};for(var h=a.getOrderedFields(),n=0;n<h.length;n++)(g.type==h[n].type||"group"==g.type&&"checkbox"==h[n].type)&&
f!=h[n].id&&(e[h[n].id]=h[n].name);g={id:f,field_name:g.name,field_type:g.type,field_english_type:a.getFieldReadableType(g)};e={details:{dummy_field:JSON.stringify(e)}};D.open("zenario_delete_form_field",g,l,e,function(m,t){"delete_field_but_migrate_data"==t.details.delete_field_options&&t.details.migration_field&&a.tuix.items[t.details.migration_field]&&(a.tuix.items[t.details.migration_field]._migrate_responses_from=f);a.deleteField(f)})}});$("#organizer_form_fields .duplicate_icon").on("click",
function(e){e.stopPropagation();var f=$(this).data("id");if(a.saveCurrentOpenDetails()){var g=a.getItem("field",f);y._g82('<p>Are you sure you want to duplicate the field "'+g.name+'"?</p>',"Duplicate","warning",!0,!1,l,l,function(){var h=a.createField(l,g.ord+.1,l,f);a.clickField(h,!0);a.updateFieldOrds()})}});$("#organizer_form_fields .update_repeat_field_icon").on("click",function(e){e.stopPropagation();e=$(this).data("id");var f=a.getItem("field",e);a.saveCurrentOpenDetails()&&y._g82("<p>Are you sure you want to update this dataset repeat field?</p>",
"Update","warning",!0,!1,l,l,function(){for(var g=f.dataset_field_id,h=a.tuix.dataset.fields[g],n=[],m=[],t=a.getOrderedFields(a.currentPageId),r=0;r<t.length;r++)t[r].dataset_repeat_grouping==g&&"repeat_end"!=t[r].type&&"repeat_start"!=t[r].type&&n.push(t[r].id);for(var w in a.tuix.dataset.tabs[h.tab_name].fields)v(a.tuix.dataset.tabs[h.tab_name].fields,w)&&(r=a.tuix.dataset.fields[w],r.repeat_start_id==g&&"repeat_end"!=r.type&&m.push(r));m.sort(a.sortByOrd);g=f.ord;for(r=0;r<m.length;r++){w=!1;
for(t=0;t<n.length;t++){var H=a.getItem("field",n[t]);if(m[r].id==H.dataset_field_id){a.tuix.items[n[t]].ord=g+m[r].ord/1E3;w=!0;break}}w||(m[r].dataset_repeat_grouping=h.id,a.createField(l,g+m[r].ord/1E3,m[r].id))}for(r=0;r<n.length;r++){w=!1;for(t=0;t<m.length;t++)a.tuix.items[n[r]].dataset_field_id==m[t].id&&(w=!0);w||a.deleteField(n[r])}a.tuix.pages[a.currentPageId].fields_reordered=!0;a.loadFieldsList(a.currentPageId);a.updateFieldOrds();a.changeMadeToPanel()})})};k.updateFieldOrds=function(){var d=
this;$("#organizer_form_fields div.form_field").each(function(a){var c=$(this).data("id");c&&(d.tuix.items[c].ord=a+1)});d.changeMadeToPanel()};k.loadNewFieldsPanel=function(d){var a=this;a.editingThing=!1;var c={mode:"new_fields",link_to_dataset:a.tuix.link_to_dataset,datasetTabs:a.getOrderedMergeFieldsForDatasetFields()};c=a.microTemplate("zenario_organizer_form_builder_left_panel",c);c=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(c);d||c.hide().show("drop",
{direction:"right"},200);$("#organizer_field_type_list div.field_type, #organizer_centralised_field_type_list div.field_type, #organizer_linked_field_type_list div.dataset_field").draggable({connectToSortable:"#organizer_form_fields .form_section",appendTo:"#organizer_form_builder",helper:"clone"});$("input.form_settings").on("click",function(){a.openFormSettings()})};k.formatTUIX=function(d,a,c,b,e){var f=this;if("details"==c&&a.visibility&&"visible_on_condition"==a.visibility&&a.visible_condition_field_id){var g=
f.getItem("field",a.visible_condition_field_id);g&&("checkboxes"!=g.type&&"checkbox"!=g.type&&"group"!=g.type&&(b.tabs[c].fields.visible_condition_field_type.values.visible_if_one_of={label:"Visible if one of..."},b.tabs[c].fields.visible_condition_field_value.empty_value="-- Any value --",b.tabs[c].fields.visible_condition_field_value.values=JSON.parse(JSON.stringify(g.lov)),"visible_if_one_of"==a.visible_condition_field_type&&(b.tabs[c].fields.visible_condition_field_value.hidden=!0,b.tabs[c].fields.visible_condition_checkboxes_field_value.hidden=
!1)),"checkboxes"==g.type&&(b.tabs[c].fields.visible_condition_field_value.hidden=!0,b.tabs[c].fields.visible_condition_checkboxes_operator.hidden=!1,b.tabs[c].fields.visible_condition_checkboxes_field_value.hidden=!1),"checkbox"!=g.type&&"group"!=g.type&&(b.tabs[c].fields.visible_condition_checkboxes_field_value.values=JSON.parse(JSON.stringify(g.lov))))}if("page"==d)switch(c){case "details":e=f.getOrderedPages();for(var h=0;h<e.length;h++)if(e[h].id==a.id){0==h?b.tabs[c].fields.previous_button_text.hidden=
!0:h!=e.length-1||f.tuix.form_enable_summary_page||(b.tabs[c].fields.next_button_text.hidden=!0);break}f.loadPagesList()}else if("field"==d)switch(c){case "details":a.values_source&&f.tuix.centralised_lists.values[a.values_source]&&(h=f.tuix.centralised_lists.values[a.values_source],h.info.can_filter?b.tabs[c].fields.values_source_filter.label=h.info.filter_label:b.tabs[c].fields.values_source_filter.hidden=!0);a.readonly_or_mandatory&&"conditional_mandatory"==a.readonly_or_mandatory&&a.mandatory_condition_field_id&&
(g=f.getItem("field",a.mandatory_condition_field_id))&&("checkboxes"==g.type?(b.tabs[c].fields.mandatory_condition_checkboxes_field_value.values=JSON.parse(JSON.stringify(g.lov)),b.tabs[c].fields.mandatory_condition_field_value.hidden=!0,b.tabs[c].fields.mandatory_condition_checkboxes_operator.hidden=!1):(b.tabs[c].fields.mandatory_condition_checkboxes_field_value.hidden=!0,"checkbox"!=g.type&&"group"!=g.type&&(b.tabs[c].fields.mandatory_condition_field_type.values.mandatory_if_one_of={label:"Mandatory if one of..."},
b.tabs[c].fields.mandatory_condition_field_value.values=JSON.parse(JSON.stringify(g.lov)),b.tabs[c].fields.mandatory_condition_field_value.empty_value="-- Any value --","mandatory_if_one_of"==a.mandatory_condition_field_type&&(b.tabs[c].fields.mandatory_condition_field_value.hidden=!0,b.tabs[c].fields.mandatory_condition_checkboxes_field_value.values=JSON.parse(JSON.stringify(g.lov)),b.tabs[c].fields.mandatory_condition_checkboxes_field_value.hidden=!1))));"field_validation"==e?("email"==a.field_validation?
b.tabs[c].fields.field_validation_error_message.value="The email address you have entered is not valid, please enter a valid email address.":"URL"==a.field_validation?b.tabs[c].fields.field_validation_error_message.value="Please enter a valid URL.":"number"==a.field_validation?b.tabs[c].fields.field_validation_error_message.value="Please enter a valid number.":"phone_number"==a.field_validation?b.tabs[c].fields.field_validation_error_message.value="Please enter a valid phone number, which may contain 0-9 + - ( ) and spaces.":
"integer"==a.field_validation?b.tabs[c].fields.field_validation_error_message.value="Please enter a valid integer.":"floating_point"==a.field_validation&&(b.tabs[c].fields.field_validation_error_message.value="Please enter a valid floating point number."),$("#organizer_form_field_"+a.id+" .form_field_classes .validation").toggle(a.field_validation&&"none"!=a.field_validation)):"visibility"==e?(e="","hidden"==a.visibility?e="Hidden":"visible_on_condition"==a.visibility&&(e="Visible on condition"),
$("#organizer_form_field_"+a.id+" .form_field_classes .not_visible").toggle("visible"!=a.visibility).prop("title",e)):"values_source"==e&&(a.values_source?(e={mode:"get_centralised_lov",method:a.values_source},f.tuix.centralised_lists.values[a.values_source].info.can_filter&&(e.filter=a.values_source_filter),f.sendAJAXRequest(e,function(n){a.lov=n;f.loadFieldValuesListPreview(a.id)})):(a.lov={},f.loadFieldValuesListPreview(a.id)));"calculated"==a.type&&a.calculation_code&&(b.tabs[c].fields.calculation_code.value=
f.getCalculationCodeDisplay(a.calculation_code));a.dataset_field_id&&(b.tabs[c].fields.values_source.readonly=!0,b.tabs[c].fields.values_source_filter.readonly=!0,b.tabs[c].fields.min_rows.readonly=!0,b.tabs[c].fields.max_rows.readonly=!0);"repeat_start"==a.type&&(b.tabs[c].fields.label.label="Section heading:",b.tabs[c].fields.label.note_below="This will be the heading at the start of the repeating section.");break;case "advanced":"select"==a.type&&(b.tabs[c].fields.default_value_options.label="Pre-select field:");
-1!=["radios","centralised_radios","select","centralised_select"].indexOf(a.type)&&(b.tabs[c].fields.default_value_lov.values=JSON.parse(JSON.stringify(a.lov)));b.tabs[c].fields.merge_name.snippet.html=a.custom_code_name?"<div><b>Merge names:</b> "+a.custom_code_name+", "+f.getFormFieldMergeName(a.id)+"</div>":"<div><b>Merge name:</b> "+f.getFormFieldMergeName(a.id)+"</div>";break;case "values":if(a.dataset_field_id&&"text"!=a.type&&(b.tabs[c].fields.values.readonly=!0),"salutation"==a.db_column){for(h in b.tabs[c].fields.suggested_values_source.values)"zenario_common_features::getSalutations"!=
h&&delete b.tabs[c].fields.suggested_values_source.values[h];b.tabs[c].fields.suggested_values_source.note_below='<a href="'+f.tuix.link+'organizer.php?#zenario__languages/panels/salutations" target="_blank">Manage list of salutations</a>'}}};k.validateTUIX=function(d,a,c,b){a.name||(b.tabs[c].fields.name.error="Please enter a name.");if("details"==c&&a.visibility&&"visible_on_condition"==a.visibility)if(!a.visible_condition_field_id)b.tabs[c].fields.visible_condition_field_id.error="Please select a field on which its visibility is conditional.";
else if(!a.visible_condition_field_value){var e=this.getItem("field",a.visible_condition_field_id);!e||"checkbox"!=e.type&&"group"!=e.type||(b.tabs[c].fields.visible_condition_field_value.error="Please select a field value on which its visiblity is conditional.")}if("field"==d)switch(c){case "details":if("checkbox"==a.type||"group"==a.type)a.label||(b.tabs[c].fields.label.error="Please enter a label for this checkbox.");else if("repeat_start"==a.type)if(a.min_rows?+a.min_rows!=a.min_rows?b.tabs[c].fields.min_rows.error=
"Please a valid number for mininum rows.":1>a.min_rows||10<a.min_rows?b.tabs[c].fields.min_rows.error="Mininum rows must be between 1 and 10.":+a.min_rows>+a.max_rows&&(b.tabs[c].fields.min_rows.error="Minimum rows cannot be greater than maximum rows."):b.tabs[c].fields.min_rows.error="Please enter the minimum rows.",!a.max_rows)b.tabs[c].fields.max_rows.error="Please enter the maximum rows.";else if(+a.max_rows!=a.max_rows)b.tabs[c].fields.max_rows.error="Please a valid number for maximum rows.";
else{if(1>a.max_rows||20<a.max_rows)b.tabs[c].fields.max_rows.error="Maximum rows must be between 1 and 20."}else"restatement"==a.type?a.restatement_field||(b.tabs[c].fields.restatement_field.error="Please select the field to mirror."):"centralised_radios"!=a.type&&"centralised_select"!=a.type||a.values_source||(b.tabs[c].fields.values_source.error="Please select a values source.");if(a.readonly_or_mandatory)if("mandatory"!=a.readonly_or_mandatory&&"conditional_mandatory"!=a.readonly_or_mandatory&&
"mandatory_if_visible"!=a.readonly_or_mandatory||a.required_error_message||(b.tabs[c].fields.required_error_message.error="Please enter an error message when this field is incomplete."),"mandatory"==a.readonly_or_mandatory)"hidden"==a.visibility?b.tabs[c].fields.readonly_or_mandatory.error="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&(b.tabs[c].fields.readonly_or_mandatory.error="This field is marked as mandatory, but is only visible based on a condition. Either: change this field to be visible (without condition); or mandatory on condition, with the same condition as that on which visibility depends.");
else if("conditional_mandatory"==a.readonly_or_mandatory)if(a.mandatory_condition_field_id?a.mandatory_condition_field_value||(e=this.getItem("field",a.mandatory_condition_field_id))&&-1!=["checkbox","group"].indexOf(e.type)&&(b.tabs[c].fields.mandatory_condition_field_value.error="Please select a mandatory on condition form field value."):b.tabs[c].fields.mandatory_condition_field_id.error="Please select a mandatory on condition form field.","hidden"==a.visibility)b.tabs[c].fields.visibility.error=
"A field cannot be mandatory while hidden.";else if("visible_if_one_of"==a.visible_condition_field_type&&""!=a.visible_condition_field_id&&_._ruc(a.visible_condition_checkboxes_field_value))b.tabs[c].fields.visibility.error="Please select a checkbox for visibility condition.";else if("visible_if_one_of"==a.visible_condition_field_type&&"mandatory_if_one_of"!=a.mandatory_condition_field_type){error=0;switch(a.mandatory_condition_field_type){case "mandatory_if_not":if(""==a.mandatory_condition_field_value&&
!_._ruc(a.visible_condition_checkboxes_field_value)||""==a.mandatory_condition_field_value&&_._ruc(a.visible_condition_checkboxes_field_value)||!_._a1g(a.visible_condition_checkboxes_field_value,a.mandatory_condition_field_value))error=1;break;case "mandatory_if":""==a.mandatory_condition_field_value?error=1:a.visible_condition_checkboxes_field_value&&(error=_._a1g(a.visible_condition_checkboxes_field_value,a.mandatory_condition_field_value)?0:1)}1==error&&(b.tabs[c].fields.visibility.error="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")}else if("mandatory_if_one_of"==
a.mandatory_condition_field_type)if(error=0,_._ruc(a.mandatory_condition_checkboxes_field_value)&&""!=a.mandatory_condition_field_id)b.tabs[c].fields.mandatory_condition_field_value.error="Please select a checkbox for mandatory condition.";else{if("visible"==a.visibility)error=0;else if(a.visible_condition_field_id!=a.mandatory_condition_field_id)error=1;else switch(a.visible_condition_field_type){case "visible_if_one_of":if(""!=a.visible_condition_checkboxes_field_value&&a.mandatory_condition_checkboxes_field_value)for(e=
0;e<a.mandatory_condition_checkboxes_field_value.length;e++)if(!_._a1g(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value[e])){error=1;break}break;case "visible_if_not":if(""==a.visible_condition_field_value&&!_._ruc(a.mandatory_condition_checkboxes_field_value)||""==a.visible_condition_field_value&&_._ruc(a.mandatory_condition_checkboxes_field_value)||_._a1g(a.mandatory_condition_checkboxes_field_value,a.visible_condition_field_value))error=1;break;case "visible_if":if(""!=
a.visible_condition_field_value)if(a.mandatory_condition_checkboxes_field_value&&1!=a.mandatory_condition_checkboxes_field_value.length)error=1;else if(a.mandatory_condition_checkboxes_field_value)for(e=0;e<a.mandatory_condition_checkboxes_field_value.length;e++)if(a.mandatory_condition_checkboxes_field_value[e]!=a.visible_condition_field_value){error=1;break}}0!=error&&(b.tabs[c].fields.mandatory_condition_field_value.error="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")}else"visible_on_condition"==
a.visibility&&"conditional_mandatory"==a.readonly_or_mandatory&&a.visible_condition_field_id&&a.mandatory_condition_field_id&&(a.visible_condition_field_id!=a.mandatory_condition_field_id||"visible_if"==a.visible_condition_field_type&&"mandatory_if_not"==a.mandatory_condition_field_type||"visible_if_not"==a.visible_condition_field_type&&"mandatory_if"==a.mandatory_condition_field_type||(e=this.getItem("field",a.mandatory_condition_field_id))&&"checkboxes"!=e.type&&a.visible_condition_field_value!=
a.mandatory_condition_field_value||"checkboxes"==e.type&&(a.visible_condition_checkboxes_operator!=a.mandatory_condition_checkboxes_operator||!_._3d(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value)))&&(b.tabs[c].fields.visibility.error="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.");a.field_validation&&"none"!=a.field_validation&&!a.field_validation_error_message&&
(b.tabs[c].fields.field_validation_error_message.error="Please enter a validation error message for this field.");if("text"==a.type&&a.field_validation&&-1==["number","integer","floating_point"].indexOf(a.field_validation))for(d=this.getOrderedFields(),e=0;e<d.length;e++){var f=d[e];if("calculated"==f.type&&f.calculation_code)for(j=0;j<f.calculation_code.length;j++)if("field"==f.calculation_code[j].type&&f.calculation_code[j].value==a.id){b.tabs[c].fields.field_validation.error='The field "'+f.name+
'" requires this field to be numeric. You must first remove this from this field.';break}}break;case "values":a.enable_suggested_values&&("pre_defined"!=a.suggested_values_type||a.suggested_values_source?"custom"!=a.suggested_values_type||a.lov&&0!=Object.keys(a.lov).length||(b.tabs[c].fields.values.error="Please add at least one value."):b.tabs[c].fields.suggested_values_source.error="Please select a values source.");break;case "advanced":a.default_value_options&&("value"==a.default_value_options?
a.default_value_lov||a.default_value_text||(f.default_value.error="Please enter a default value."):"method"==a.default_value_options&&(a.default_value_class_name||(f.default_value_class_name.error="Please enter a class name."),a.default_value_method_name||(f.default_value_method_name.error="Please enter the name of a static method.")));if(a.custom_code_name)for(d=this.getOrderedFields(),e=0;e<d.length;e++)f=d[e],f.id!=a.id&&a.custom_code_name==f.custom_code_name&&(b.tabs[c].fields.custom_code_name.error=
"Another field already has this code name on this form.");a.invalid_responses&&a.invalid_responses.length&&!a.invalid_field_value_error_message&&(b.tabs[c].fields.invalid_field_value_error_message.error="Please enter an error message when an invalid response is chosen.");if("textarea"==a.type&&(a.word_count_max&&(+a.word_count_max!=a.word_count_max?b.tabs[c].fields.word_count_max.error="Please enter a valid number for the max word count.":1>a.word_count_max&&(b.tabs[c].fields.word_count_max.error=
"Word count must be greater than 0.")),a.word_count_min&&(+a.word_count_min!=a.word_count_min?b.tabs[c].fields.word_count_min.error="Please enter a valid number for the min word count.":1>a.word_count_min&&(b.tabs[c].fields.word_count_min.error="Word count must be greater than 0.")),a.rows))if(+a.rows!=a.rows)b.tabs[c].fields.rows.error="Please enter a valid number for the rows.";else if(1>a.rows||100<a.rows)b.tabs[c].fields.rows.error="Rows must be greater than 0 and less than 100.";break;case "crm":a.send_to_crm&&
!a.field_crm_name&&(b.tabs[c].fields.field_crm_name.error="Please enter a CRM field name.")}};k.getTUIXFieldCustomValues=function(d){var a={};if("centralised_lists"==d)a=JSON.parse(JSON.stringify(this.tuix.centralised_lists.values));else if("centralised_list_filter_fields"==d||"conditional_fields"==d||"mirror_fields"==d)for(var c=this.getOrderedPages(),b=1<c.length,e=0,f=0;f<c.length;f++)for(var g=c[f],h=this.getOrderedFields(c[f].id),n=0;n<h.length;n++){var m=h[n];if(this.canAddFieldToList(d,m.id)&&
(a[m.id]={label:m.name,ord:++e},b)){var t="page_"+g.id;a[m.id].parent=t;a[t]||(a[t]={label:g.name,ord:++e})}}else"field_lov"==d&&"field"==this.editingThing&&this.editingThingId&&(m=this.getItem(this.editingThing,this.editingThingId))&&m.lov&&(a=JSON.parse(JSON.stringify(m.lov)));return a};k.canAddFieldToList=function(d,a){a=this.tuix.items[a];return"centralised_list_filter_fields"==d?("field"!=this.editingThing||a.id!=this.editingThingId)&&("centralised_select"==a.type||"text"==a.type&&a.enable_suggested_values&&
"pre_defined"==a.suggested_values&&a.suggested_values_source):"conditional_fields"==d?("field"!=this.editingThing||a.id!=this.editingThingId)&&-1!="checkbox group radios select centralised_radios centralised_select checkboxes".split(" ").indexOf(a.type):"mirror_fields"==d?("field"!=this.editingThing||a.id!=this.editingThingId)&&-1!=["text","calculated","select","centralised_select"].indexOf(a.type):!1};k.saveCurrentOpenDetails=function(d){var a=[],c=this.editingThing,b=this.editingThingId;if(c&&b&&
this.editingThingTUIXTabId){var e=this.getTUIXModeForItemType(c),f=this.tuix[e],g=this.getItem(c,b);if(g){this.saveTUIXTab(f,this.editingThingTUIXTabId,g);if(d)a=this.getDeleteErrors(c,b);else{g.name=$("#field__name").val().trim();d=this.getTUIXTags(e,g,c);this.validateTUIX(c,g,this.editingThingTUIXTabId,d);for(var h in d.tabs)if(v(d.tabs,h)){g=d.tabs[h];for(var n in g.fields)v(g.fields,n)&&(e=g.fields[n],e.error&&a.push(e.error))}}a.length&&this.openItemTUIXTab(c,b,this.editingThingTUIXTabId,a)}}return 0==
a.length};k.getDeleteErrors=function(d,a){var c=[];if("field"==d){this.getItem(d,a);d=this.getOrderedFields();for(var b=0;b<d.length;b++){var e=d[b],f=!1;if("calculated"==e.type&&e.calculation_code)for(var g=0;g<e.calculation_code.length;g++){var h=e.calculation_code[g];if("field"==h.type&&h.value==a){f=!0;break}}if(e.visibility&&"visible_on_condition"==e.visibility&&e.visible_condition_field_id==a||e.readonly_or_mandatory&&"conditional_mandatory"==e.readonly_or_mandatory&&e.mandatory_condition_field_id==
a)f=!0;f&&c.push('Unable to delete field because the field "'+e.name+'" depends on it.')}}return c};k.displayPageFieldOrderErrors=function(){if(!this.getItem("page",this.currentPageId))return!0;for(var d=[],a=this.getOrderedFields(this.currentPageId),c="checkbox checkboxes date radios centralised_radios select centralised_select text textarea url attachment section_description calculated group".split(" "),b=!1,e=0;e<a.length;e++){var f=a[e];"repeat_start"!=f.type||b?"repeat_end"==f.type?b?b=!1:d.push("Repeat ends must be placed after repeat starts."):
b&&-1==c.indexOf(f.type)&&d.push('Field type "'+this.getFieldReadableType(f).toLowerCase()+'" is not allowed in a repeat block.'):b=!0}a=0<d.length;c=$("#organizer_fields_error");c.html("");for(e=0;e<d.length;e++)c.append('<p class="error">'+d[e]+"</p>");c.toggle(a);return!a};k.getTUIXModeForItemType=function(d){return"page"==d?"form_page_details":"field"==d?"form_field_details":!1};k.getFieldReadableType=function(d){if("string"==typeof d)var a=d;else a=d.type,d.is_consent&&(a="consent");switch(a){case "checkbox":return"Checkbox";
case "checkboxes":return"Checkboxes";case "date":return"Date";case "editor":return"Editor";case "radios":return"Radios";case "centralised_radios":return"Centralised radios";case "select":return"Select";case "centralised_select":return"Centralised select";case "text":return"Text";case "textarea":return"Textarea";case "url":return"URL";case "attachment":return"Attachment";case "page_break":return"Step";case "section_description":return"Subheading";case "section_spacer":return"Spacer";case "calculated":return"Calculated";
case "restatement":return"Mirror";case "repeat_start":return"Start of repeating section";case "repeat_end":return"End of repeating section";case "document_upload":return"Multi-upload";case "sortable_selection":return"Sortable selection";default:return"Unknown";case "group":return"Group";case "consent":return"Consent";case "file_picker":return"File picker"}};k.getCalculationCodeDisplay=function(d){var a="";if(d)for(var c=!1,b=0;b<d.length;b++){c||"parentheses_close"==d[b].type?c&&(c=!1):a+=" ";switch(d[b].type){case "operation_addition":a+=
"+";break;case "operation_subtraction":a+="-";break;case "operation_multiplication":a+="\u00d7";break;case "operation_division":a+="\u00f7";break;case "parentheses_open":a+="(";c=!0;break;case "parentheses_close":a+=")";break;case "static_value":a+=d[b].value;break;case "field":var e=this.getItem("field",d[b].value);a+='"'+(e?e.name:"UNKNOWN FIELD")+'"'}a=a.trim()}return a};k.calculationAdminBoxAddSomthing=function(d,a){var c=!1;switch(d){case "operation_addition":case "operation_subtraction":case "operation_multiplication":case "operation_division":case "parentheses_open":case "parentheses_close":c=
{type:d};break;case "static_value":""===a||isNaN(+a)||(c={type:d,value:+a},$("#static_value").val(""));break;case "field":c={type:d,value:a},$("#numeric_field").val("")}c&&(d=[],$("#calculation_code").val()&&(d=JSON.parse($("#calculation_code").val())),d.push(c),$("#calculation_code").val(JSON.stringify(d)),this.calculationAdminBoxUpdateDisplay(d))};k.calculationAdminBoxDelete=function(){var d=[];$("#calculation_code").val()&&(d=JSON.parse($("#calculation_code").val()))&&(d.pop(),$("#calculation_code").val(JSON.stringify(d)));
this.calculationAdminBoxUpdateDisplay(d)};k.calculationAdminBoxUpdateDisplay=function(d){d=this.getCalculationCodeDisplay(d);$("#zenario_calculation_display").text(d)};k.openFormSettings=function(){var d=this;D.open("zenario_user_form",{id:A.pi.refiner.id},l,l,function(a,c){a="";c.details.show_title&&(a=c.details.title);d.tuix.title=a;$("#organizer_form_builder .form_outer .form_header h5").text(a)})};k.changeMadeToPanel=function(){this.changeMadeOnPanel||(this.changeMadeOnPanel=!0,q.onbeforeunload=
function(){return"You are currently editing this form. If you leave now you will lose any unsaved changes."},A._x6q("Please either save your changes, or click Reset to discard them, before exiting the form editor."),A._96o())};k.saveChanges=function(){var d=this;if(d.tuix.not_used_or_on_public_page){for(var a=!1,c=!1,b=d.getOrderedFields(),e=0;e<b.length;e++)b[e].dataset_field_id&&("email"==b[e].db_column?c=!0:a=!0);if(a&&!c&&!confirm("Warning: this form contains fields that are linked to the Users Dataset, but doesn't contain the Email field from the Users Dataset.\n\nIf this form is used on a public web page by anonymous visitors, form responses will not be stored in the Users & Contacts database table.\n\nTo overcome this, please add the Email field linked to the Users Dataset.\n\nSave anyway?"))return}a=
{mode:"save",pages:JSON.stringify(d.tuix.pages),fields:JSON.stringify(d.tuix.items),fieldsTUIX:JSON.stringify(d.tuix.form_field_details),pagesReordered:d.pagesReordered,deletedPages:JSON.stringify(d.deletedPages),deletedFields:JSON.stringify(d.deletedFields),deletedValues:JSON.stringify(d.deletedValues),currentPageId:d.currentPageId,editingThing:d.editingThing,editingThingId:d.editingThingId};y._8nu("saving",!0);d.sendAJAXRequest(a,function(f){y._8nu();if(f){if(f.errors){for(var g="",h=0;h<f.errors.length;h++)g+=
f.errors[h]+"<br>";g&&y._g82(g)}d.currentPageId=f.currentPageId;d.editingThing=f.editingThing;d.editingThingId=f.editingThingId}q.onbeforeunload=!1;A._rj7();d.changeMadeOnPanel=!1;d.changesSaved=!0;A._131()})}},zenarioO.panelTypes);
