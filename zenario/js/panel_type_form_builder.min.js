zenario.lib(function(q,h,C,y,D,E,F,s,u,x,G,v,H,w,I,J,K,L,M,A,B,r,z){h=B(z.form_builder=A(z.form_builder_base_class));h.showPanel=function(d,a,b){d.html("").hide();b.html("").show();d=this.getMainPanelHTML();a.html(d).show();this.currentPageId=this.currentPageId?this.currentPageId:!1;this.editingThing=this.editingThing?this.editingThing:!1;this.editingThingId=this.editingThingId?this.editingThingId:!1;this.editingThingTUIXTabId=this.editingThingTUIXTabId?this.editingThingTUIXTabId:!1;this.editingNameFieldComplete=
this.editingNameField=!1;this.deletedPages=[];this.deletedFields=[];this.deletedValues=[];this.pagesReordered=this.changeMadeOnPanel=!1;this.newItemCount=0;0==this.getOrderedPages().length&&this.createPage();this.fixTUIXData();this.loadPagesList();this.loadFieldsList(this.currentPageId);"field"==this.editingThing?this.openFieldEdit(this.editingThingId,this.editingThingTUIXTabId,!0):"page"==this.editingThing?this.openPageEdit(this.editingThingId,this.editingThingTUIXTabId,!0):this.loadNewFieldsPanel(!0);
this.changesSaved&&(this.changesSaved=!1,s._t({message_type:"success",message:"Your changes have been saved!"}))};h.fixTUIXData=function(){for(var d=this.getOrderedPages(),a=0;a<d.length;a++){var b=this.getItem("page",d[a].id);b.visible_condition_checkboxes_field_value&&(b.visible_condition_checkboxes_field_value=u._tTA(b.visible_condition_checkboxes_field_value));for(var b=this.getOrderedFields(b.id),c=0;c<b.length;c++){var f=this.getItem("field",b[c].id);"calculated"==f.type&&f.calculation_code&&
(f.calculation_code=u._tTA(f.calculation_code));f.invalid_responses&&(f.invalid_responses=u._tTA(f.invalid_responses));f.visible_condition_checkboxes_field_value&&(f.visible_condition_checkboxes_field_value=u._tTA(f.visible_condition_checkboxes_field_value));f.mandatory_condition_checkboxes_field_value&&(f.mandatory_condition_checkboxes_field_value=u._tTA(f.mandatory_condition_checkboxes_field_value))}}};h.getMainPanelHTML=function(){return this.microTemplate("zenario_organizer_form_builder",{form_title:this.tuix.form_title})};
h.loadPagesList=function(){var d=this,a=d.getOrderedPages();!d.currentPageId&&0<a.length&&(d.currentPageId=a[0].id);for(var b=0;b<a.length;b++)d.currentPageId==a[b].id&&(a[b]._is_current_page=!0),a[b].name=d.formatPageLabel(a[b].name);1>=a.length&&(a=!1);a=d.microTemplate("zenario_organizer_form_builder_tabs",{pages:a});$("#organizer_form_tabs").html(a);$("#organizer_form_tabs .tab").on("click",function(){var a=$(this).data("id");d.tuix.pages[a]&&d.clickPage(a)});$("#organizer_add_new_tab").on("click",
function(){if(d.saveCurrentOpenDetails()){var a=d.createPage();d.clickPage(a,!0);d.changeMadeToPanel()}});$("#organizer_form_tabs").sortable({containment:"parent",tolerance:"pointer",items:"div.sort",start:function(a,b){d.startIndex=b.item.index()},stop:function(a,b){d.startIndex!=b.item.index()&&($("#organizer_form_tabs .tab.sort").each(function(a){var b=$(this).data("id");d.tuix.pages[b].ord=a+1}),d.pagesReordered=!0,d.changeMadeToPanel(),"page"==d.editingThing&&(d.saveCurrentOpenDetails(),d.openPageEdit(d.editingThingId,
d.editingThingTUIXTabId,!0)))}});$("#organizer_form_tabs .tab").droppable({accept:"div.is_sortable:not(.repeat_end)",greedy:!0,hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(a,b){if(d.saveCurrentOpenDetails()){var e=$(this).data("id"),g=$(b.draggable).data("id");e&&g&&(d.moveFieldToPage(d.currentPageId,e,g),"field"==d.editingThing&&d.editingThingId==g&&d.loadNewFieldsPanel(),d.loadFieldsList(d.currentPageId))}}})};h.getOrderedMergeFieldsForFields=function(d){var a=[],b=[],c={},f;for(f in this.tuix.pages[d].fields)if(r(this.tuix.pages[d].fields,
f)){var e=_._cl(this.tuix.items[f]);e.lov=this.getOrderedFieldValues(f);e.is_consent&&(e.type="consent");"field"==this.editingThing&&this.editingThingId==e.id&&(e._is_current_field=!0);e.dataset_field_id&&(e._hide_duplicate_button=!0);e.dataset_repeat_grouping?(c[e.dataset_repeat_grouping]||(c[e.dataset_repeat_grouping]={},c[e.dataset_repeat_grouping].fields=[]),"repeat_start"!=e.type&&(e._hide_drag_button=!0,e._hide_delete_button=!0,e._hide_duplicate_button=!0),b.push(e)):(e._is_sortable=!0,a.push(e))}if(0<
b.length)for(d=0;d<b.length;d++)c[b[d].dataset_repeat_grouping].fields.push(b[d]);for(var g in c)r(c,g)&&(b=c[g],b.fields.sort(this.sortByOrd),b.fields.length&&(b.ord=b.fields[0].ord,b._is_sortable=!0,a.push(b)));a.sort(this.sortByOrd);c=!1;for(d=0;d<a.length;d++)"repeat_start"==a[d].type?c=!0:"repeat_end"==a[d].type?c=!1:c&&(a[d]._is_repeat_field=!0);return a};h.getOrderedMergeFieldsForDatasetFields=function(){for(var d=[],a={},b=this.getOrderedFields(),c=0;c<b.length;c++)b[c].dataset_field_id&&
(a[b[c].dataset_field_id]=!0);for(var f in this.tuix.dataset.tabs)if(r(this.tuix.dataset.tabs,f)){b=this.tuix.dataset.tabs[f];c=_._cl(b);c.fields=[];for(var e in b.fields)if(r(b.fields,e)){var g=_._cl(this.tuix.dataset.fields[e]);a[e]||0!=g.repeat_start_id||(g.tab_label=c.label?c.label:c.default_label,c.fields.push(g))}c.fields.sort(this.sortByOrd);d.push(c)}d.sort(this.sortByOrd);return d};h.getFormFieldMergeName=function(d){var a=this.getItem("field",d);return a.db_column?a.db_column:"unlinked_"+
a.type+"_"+d};h.createPage=function(){var d="t"+ ++this.newItemCount,a=1,b=this.getOrderedPages();b.length&&(a=b[b.length-1].ord+1);var c={};c.id=d;c.ord=a;c._just_added=!0;c.fields={};c.name="Page "+(b.length+1);for(var f in this.tuix.form_page_details.tabs)if(r(this.tuix.form_page_details.tabs,f)&&(a=this.tuix.form_page_details.tabs[f],a.fields))for(var e in a.fields)r(a.fields,e)&&(b=a.fields[e],w(b.value)&&!w(c[e])&&(c[e]=b.value));this.tuix.pages[d]=c;return d};h.createField=function(d,a,b,c){var f=
"t"+ ++this.newItemCount,e={};if(b){if(d=this.tuix.dataset.fields[b],e.type=d.type,"consent"==e.type&&(e.type="checkbox",e.is_consent=!0),e.name=d.label,e.label=d.label,e.dataset_field_id=b,e.values_source=d.values_source,e.values_source_filter=d.values_source_filter,e.db_column=d.db_column,"terms_and_conditions_accepted"==d.db_column&&(e.label="By submitting your details you are agreeing that we can store your data for legitimate business purposes and contact you to inform you about our products and services.",
e.note_to_user='Full details can be found in our <a href="privacy" target="_blank">privacy policy</a>.'),d.repeat_start_id&&(e.dataset_repeat_grouping=d.repeat_start_id),d.lov&&(e.lov=d.lov),"repeat_start"==d.type){e.dataset_repeat_grouping=d.id;var g=[],k;for(k in this.tuix.dataset.tabs[d.tab_name].fields)r(this.tuix.dataset.tabs[d.tab_name].fields,k)&&(c=this.tuix.dataset.fields[k],c.repeat_start_id==b&&(c=_._cl(c),g.push(c)));g.sort(this.sortByOrd);for(b=0;b<g.length;b++)this.createField(q,a+0.001*
(b+1),g[b].id)}}else if(c){if(e=JSON.parse(JSON.stringify(this.getItem("field",c))),"checkboxes"==e.type||"select"==e.type||"radios"==e.type)for(g in b=e.lov,delete e.lov,e.lov={},b)this.addFieldValue(e,b[g].label,b[g].ord)}else if(e.type=d,e.label="Untitled",e.name="Untitled "+this.getFieldReadableType(d).toLowerCase(),"checkboxes"==d||"radios"==d||"select"==d)for(e.lov={},b=1;3>=b;b++)this.addFieldValue(e,"Option "+b);else"repeat_start"==d&&this.createField("repeat_end",a+0.001);for(var m in this.tuix.form_field_details.tabs)if(r(this.tuix.form_field_details.tabs,
m)&&(b=this.tuix.form_field_details.tabs[m],b.fields))for(var n in b.fields)r(b.fields,n)&&(k=b.fields[n],w(k.value)&&!w(e[n])&&(e[n]=k.value));e.id=f;e.page_id=this.currentPageId;e.ord=a;e._just_added=!0;this.tuix.pages[this.currentPageId].fields[f]=1;this.tuix.items[f]=e;this.loadFieldsList(this.currentPageId);return f};h.clickPage=function(d,a){if(("page"!=this.editingThing||this.editingThingId!=d)&&this.saveCurrentOpenDetails()&&this.displayPageFieldOrderErrors())if(this.currentPageId!=d){var b=
!this.editingThing;this.currentPageId=d;this.editingThing=!1;this.loadPagesList();this.loadFieldsList(d);this.loadNewFieldsPanel(b);a&&this.clickPage(d)}else this.editingThing="page",this.editingThingId=d,this.editingThingTUIXTabId=!1,this.openPageEdit(d)};h.clickField=function(d,a){if(("field"!=this.editingThing||this.editingThingId!=d)&&"repeat_end"!=this.tuix.items[d].type&&this.saveCurrentOpenDetails()){var b=this.getItem("field",d);!a&&b._just_added&&delete b._just_added;this.editingThing="field";
this.editingThingId=d;this.editingThingTUIXTabId=!1;this.loadFieldsList(this.currentPageId);this.openFieldEdit(d)}};h.openEdit=function(d,a,b,c){var f=this;f.editingNameField=!1;f.editingNameFieldComplete=!1;var e=f.getItem(d,a),g=f.getTUIXModeForItemType(d),g=f.tuix[g],k={name:e.name,hide_tab_bar:g.hide_tab_bar};"page"==d?(k.type="page_break",k.mode="edit_page",e.type=k.type):"field"==d&&(k.type=e.type,k.mode="edit_field");k.type_phrase=f.getFieldReadableType(e);e.dataset_field_id&&(k.type_phrase+=
", linked field \u2192 "+e.db_column);var m=f.microTemplate("zenario_organizer_form_builder_left_panel",k),k=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(m),e=f.getTUIXTabs(g,b,e);b=f.editingThingTUIXTabId;m=f.getTUIXTabsHTML(e);$("#organizer_field_details_tabs").html(m);f.openItemTUIXTab(d,a,b);c||k.hide().show("drop",{direction:"left"},200);$("#organizer_field_details_tabs .tab").on("click",function(){var c=$(this).data("id");c&&c!=b&&f.saveCurrentOpenDetails()&&
f.openEdit(d,a,c,!0)});$("#organizer_field_details_inner span.add_new_field").on("click",function(){f.saveCurrentOpenDetails()&&(f.loadNewFieldsPanel(),f.loadFieldsList(f.currentPageId))});$("input.form_settings").on("click",function(){f.openFormSettings()});$("#zenario_field_details_header_content .edit_field_name_button").on("click",function(){$("#zenario_field_details_header_content .view_mode").hide();$("#zenario_field_details_header_content .edit_mode").show();f.editingNameField=!0});$("#zenario_field_details_header_content .done_field_name_button").on("click",
function(){$("#zenario_field_details_header_content .edit_mode").hide();$("#zenario_field_details_header_content .view_mode").show();f.editingNameField=!1;f.editingNameFieldComplete=!0;var a=$("#field__name").val();$("#zenario_field_details_header_content .view_mode h5").text(a)});$("#field__name").on("keyup",function(){f.changeMadeToPanel();if("page"==d){var a=f.formatPageLabel($(this).val());$("#organizer_form_tab_"+f.currentPageId+" span").text(a)}})};h.deletePage=function(d){var a=this.getOrderedPages();
if(!(2>a.length))for(var b=this.getOrderedFields(d),c=0;c<a.length;c++)if(a[c].id==d){if(a[c-1])for(a=a[c-1].id,c=0;c<b.length;c++)this.moveFieldToPage(d,a,b[c].id);else for(a=a[c+1].id,c=b.length-1;0<=c;c--)this.moveFieldToPage(d,a,b[c].id,!0);this.deletedPages.push(d);delete this.tuix.pages[d];this.clickPage(a);this.changeMadeToPanel();break}};h.deleteField=function(d){var a=this.tuix.items[d],b=this.getOrderedFields(a.page_id);if("repeat_start"==a.type){var c=this.getMatchingRepeatEnd(d);if(c){var f=
this.tuix.items[c];this.deletedFields.push(c);delete this.tuix.pages[f.page_id].fields[c];delete this.tuix.items[c]}}if(a.dataset_repeat_grouping&&"repeat_start"==a.type)for(c=0;c<b.length;c++)b[c].dataset_repeat_grouping&&b[c].dataset_repeat_grouping==a.dataset_repeat_grouping&&"repeat_start"!=b[c].type&&(this.deletedFields.push(b[c].id),delete this.tuix.pages[a.page_id].fields[b[c].id],delete this.tuix.items[b[c].id]);for(var e=f=!1,b=this.getOrderedFields(a.page_id),c=0;c<b.length;c++)if(b[c].id==
d&&(f=c),!1!==f)if(0<f){e=b[f-1].id;break}else if(d!=b[c].id){e=b[c].id;break}e&&"repeat_end"==this.tuix.items[e].type&&(e=!1);this.deletedFields.push(d);delete this.tuix.pages[a.page_id].fields[d];delete this.tuix.items[d];this.changeMadeToPanel();this.loadFieldsList(a.page_id);e?this.clickField(e):this.loadNewFieldsPanel()};h.addTUIXTabEvents=function(d,a,b){var c=this,f=c.getItem(d,a),e=c.tuix[c.getTUIXModeForItemType(d)];if("page"==d)$("#organizer_remove_form_page").on("click",function(b){b="<p>Are you sure you want to delete this page?</p>";
f.fields.length&&(b+="<p>All fields on this page will be moved onto the previous page.</p>");s._flBo(b,"Delete","warning",!0,!1,q,q,function(){c.deletePage(a)})});else if("field"==d)if("details"==b)$("#field__label").on("keyup",function(){$("#organizer_form_field_"+a+" .label").text($(this).val());if(f._just_added&&!c.editingNameField&&!c.editingNameFieldComplete){var b=$(this).val().r(/:/g,"");$("#field__name").val(b);$("#field_display__name").text(b)}}),$("#field__note_to_user").on("keyup",function(){var b=
$(this).val().trim();$("#organizer_form_field_note_below_"+a+" div.zenario_note_content").text(b);$("#organizer_form_field_note_below_"+a).toggle(""!==b)}),$("#field__placeholder").on("keyup",function(){$("#organizer_form_field_"+a+" :input").prop("placeholder",$(this).val())}),$("#field__description").on("keyup",function(){$("#organizer_form_field_"+a+" .description").text($(this).val())}),$("#edit_field_calculation").on("click",function(){for(var e={},k=c.getOrderedFields(),m=0;m<k.length;m++){var n=
k[m];if("text"==n.type&&-1!=["number","integer","floating_point"].indexOf(n.field_validation)||"calculated"==n.type&&n.id!=a)e[n.id]={label:n.name,ord:m}}k={id:a,title:'Editing the calculation for the field "'+f.name+'"',calculation_code:JSON.stringify(f.calculation_code)};e={details:{dummy_field:JSON.stringify(e)}};x.open("zenario_field_calculation",k,q,e,function(e,g){f.calculation_code=g.details.calculation_code?JSON.parse(g.details.calculation_code):"";c.tuixFieldDetailsChanged(d,a,b,"calculation_code")})});
else if("advanced"==b)$("#field__css_classes").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .css").toggle(!!$(this).val()).prop("title",$(this).val())}),$("#field__div_wrap_class").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .div").toggle(!!$(this).val()).prop("title",$(this).val())}),$("#field__rows").on("keyup",function(){$("#organizer_form_field_"+a+" :input").attr("rows",$(this).val())});else if("values"==b)$("#field_values_list").sortable({containment:"parent",
tolerance:"pointer",axis:"y",start:function(a,b){c.startIndex=b.item.index()},stop:function(b,d){c.startIndex!=d.item.index()&&(c.saveFieldListOfValues(a),c.loadFieldValuesListPreview(a),c.changeMadeToPanel())}}),$("#field_values_list input").on("keyup",function(){var a=$(this).data("id");$("#organizer_field_value_"+a+" label").text($(this).val());c.changeMadeToPanel()}),$("#organizer_add_a_field_value").on("click",function(){c.addFieldValue(f);c.saveTUIXTab(e,b,f);c.openItemTUIXTab(d,a,b);c.loadFieldValuesListPreview(a);
c.changeMadeToPanel()}),$("#field_values_list .delete_icon").on("click",function(){var g=$(this).data("id");f.lov[g]&&(c.deletedValues.push(g),delete f.lov[g],delete f.crm_lov[g]);c.saveTUIXTab(e,b,f);c.openItemTUIXTab(d,a,b);c.loadFieldValuesListPreview(a);c.changeMadeToPanel()});else if("translations"==b)$("#organizer_field_translations input").on("keyup",function(){c.changeMadeToPanel()});else"crm"==b&&($("#field__crm_validate_test").on("click",function(){c.saveTUIXTab(e,b,f);actionRequests={mode:"validate_salesforce_field",
item:JSON.stringify(f)};c.sendAJAXRequest(actionRequests,function(b){if(!0===b)c.openItemTUIXTab(d,a,c.editingThingTUIXTabId,q,q,["Field is valid."]);else if(!1===b){var e=["Something went wrong. Validation could not be completed."];c.openItemTUIXTab(d,a,c.editingThingTUIXTabId,e)}else if(b.error){e=[];if("missing_values"==b.error)for(var f=0;f<b.values.length;f++)e.push('Field value not found: "'+b.values[f]+'"');else"not_found"==b.error?e.push("Field not found."):"too_many_values"==b.error?e.push("Too many values to load from Salesforce."):
e.push("Unknown error.");c.openItemTUIXTab(d,a,c.editingThingTUIXTabId,e)}})}),$("#organizer_crm_button__set_labels").on("click",function(){c.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(a,b){var c=$(this).data("id"),d="";f.lov&&f.lov[c]&&(d=f.lov[c].label);$(this).val(d)})}),$("#organizer_crm_button__set_values").on("click",function(){c.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(a,b){$(this).val($(this).data("id"))})}),
$("#organizer_field_crm_values input.crm_value_input").on("keyup",function(){c.changeMadeToPanel()}))};h.loadFieldsList=function(d){var a=this,b={fields:a.getOrderedMergeFieldsForFields(d)},b=a.microTemplate("zenario_organizer_form_builder_section",b);$("#organizer_form_fields").html(b);$("#organizer_form_fields div.form_field").on("click",function(){var b=$(this).data("id");a.tuix.items[b]&&a.clickField(b)});var c;$("#organizer_form_fields div.form_field").hover(function(){var a=this;c||(c=setTimeout(function(){c=
null;var b=$(a).data("id");$("#organizer_form_field_"+b+" .form_field_classes").show()},200))},function(){if(c)clearTimeout(c),c=null;else{var b=$(this).data("id");"field"==a.editingThing&&b!=a.editingThingId&&$("#organizer_form_field_"+b+" .form_field_classes").hide()}});$("#organizer_form_builder").tooltip();$("#organizer_form_fields .form_section").sortable({items:"div.is_sortable",tolerance:"pointer",placeholder:"preview",receive:function(b,c){$(this).find("div.field_type, div.dataset_field").each(function(){var b=
$(this).data("type"),c=$(this).data("id"),d=0.1,e=$(this).prev().data("id");e&&a.tuix.items[e]?d=a.tuix.items[e].ord+0.1:(e=$(this).next().data("id"))&&a.tuix.items[e]&&(d=a.tuix.items[e].ord-0.1);b=a.createField(b,d,c);a.clickField(b,!0);a.updateFieldOrds()})},start:function(b,c){a.startIndex=c.item.index()},stop:function(b,c){a.startIndex!=c.item.index()&&(a.tuix.pages[d].fields_reordered=!0,a.updateFieldOrds(),a.loadFieldsList(d))}});$("#organizer_form_fields .delete_icon").on("click",function(b){b.stopPropagation();
var c=$(this).data("id");if(a.saveCurrentOpenDetails(!0)){var d=a.tuix.items[c];b={};for(var k=a.getOrderedFields(),m=0;m<k.length;m++)(d.type==k[m].type||"group"==d.type&&"checkbox"==k[m].type)&&c!=k[m].id&&(b[k[m].id]=k[m].name);d={id:c,field_name:d.name,field_type:d.type,field_english_type:a.getFieldReadableType(d)};b={details:{dummy_field:JSON.stringify(b)}};x.open("zenario_delete_form_field",d,q,b,function(b,d){"delete_field_but_migrate_data"==d.details.delete_field_options&&d.details.migration_field&&
a.tuix.items[d.details.migration_field]&&(a.tuix.items[d.details.migration_field]._migrate_responses_from=c);a.deleteField(c)})}});$("#organizer_form_fields .duplicate_icon").on("click",function(b){b.stopPropagation();var c=$(this).data("id");if(a.saveCurrentOpenDetails()){var d=a.getItem("field",c);message='<p>Are you sure you want to duplicate the field "'+d.name+'"?</p>';s._flBo(message,"Duplicate","warning",!0,!1,q,q,function(){var b=a.createField(q,d.ord+0.1,q,c);a.clickField(b,!0);a.updateFieldOrds()})}});
$("#organizer_form_fields .update_repeat_field_icon").on("click",function(b){b.stopPropagation();b=$(this).data("id");var c=a.getItem("field",b);a.saveCurrentOpenDetails()&&(message="<p>Are you sure you want to update this dataset repeat field?</p>",s._flBo(message,"Update","warning",!0,!1,q,q,function(){for(var b=c.dataset_field_id,d=a.tuix.dataset.fields[b],f=[],h=[],p=a.getOrderedFields(a.currentPageId),l=0;l<p.length;l++)p[l].dataset_repeat_grouping==b&&"repeat_end"!=p[l].type&&"repeat_start"!=
p[l].type&&f.push(p[l].id);for(var t in a.tuix.dataset.tabs[d.tab_name].fields)r(a.tuix.dataset.tabs[d.tab_name].fields,t)&&(l=a.tuix.dataset.fields[t],l.repeat_start_id==b&&"repeat_end"!=l.type&&h.push(l));h.sort(a.sortByOrd);b=c.ord;for(l=0;l<h.length;l++){t=!1;for(p=0;p<f.length;p++){var s=a.getItem("field",f[p]);if(h[l].id==s.dataset_field_id){a.tuix.items[f[p]].ord=b+h[l].ord/1E3;t=!0;break}}t||(h[l].dataset_repeat_grouping=d.id,a.createField(q,b+h[l].ord/1E3,h[l].id))}for(l=0;l<f.length;l++){t=
!1;for(p=0;p<h.length;p++)a.tuix.items[f[l]].dataset_field_id==h[p].id&&(t=!0);t||a.deleteField(f[l])}a.tuix.pages[a.currentPageId].fields_reordered=!0;a.loadFieldsList(a.currentPageId);a.updateFieldOrds();a.changeMadeToPanel()}))})};h.updateFieldOrds=function(){var d=this;$("#organizer_form_fields div.form_field").each(function(a){var b=$(this).data("id");b&&(d.tuix.items[b].ord=a+1)});d.changeMadeToPanel()};h.loadNewFieldsPanel=function(d){var a=this;a.editingThing=!1;var b={mode:"new_fields",link_to_dataset:a.tuix.link_to_dataset,
datasetTabs:a.getOrderedMergeFieldsForDatasetFields()},b=a.microTemplate("zenario_organizer_form_builder_left_panel",b),b=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(b);d||b.hide().show("drop",{direction:"right"},200);$("#organizer_field_type_list div.field_type, #organizer_centralised_field_type_list div.field_type, #organizer_linked_field_type_list div.dataset_field").draggable({connectToSortable:"#organizer_form_fields .form_section",appendTo:"#organizer_form_builder",
helper:"clone"});$("input.form_settings").on("click",function(){a.openFormSettings()})};h.formatTUIX=function(d,a,b,c,f){var e=this;if("details"==b&&a.visibility&&"visible_on_condition"==a.visibility&&a.visible_condition_field_id){var g=e.getItem("field",a.visible_condition_field_id);g&&("checkboxes"!=g.type&&"checkbox"!=g.type&&"group"!=g.type&&(c.tabs[b].fields.visible_condition_field_type.values.visible_if_one_of={label:"Visible if one of..."},c.tabs[b].fields.visible_condition_field_value.empty_value=
"-- Any value --",c.tabs[b].fields.visible_condition_field_value.values=JSON.parse(JSON.stringify(g.lov)),"visible_if_one_of"==a.visible_condition_field_type&&(c.tabs[b].fields.visible_condition_field_value.hidden=!0,c.tabs[b].fields.visible_condition_checkboxes_field_value.hidden=!1)),"checkboxes"==g.type&&(c.tabs[b].fields.visible_condition_field_value.hidden=!0,c.tabs[b].fields.visible_condition_checkboxes_operator.hidden=!1,c.tabs[b].fields.visible_condition_checkboxes_field_value.hidden=!1),
"checkbox"!=g.type&&"group"!=g.type&&(c.tabs[b].fields.visible_condition_checkboxes_field_value.values=JSON.parse(JSON.stringify(g.lov))))}if("page"==d)switch(b){case "details":f=e.getOrderedPages();for(var k=0;k<f.length;k++)if(f[k].id==a.id){0==k?c.tabs[b].fields.previous_button_text.hidden=!0:k!=f.length-1||e.tuix.form_enable_summary_page||(c.tabs[b].fields.next_button_text.hidden=!0,c.tabs[b].fields.visibility.readonly=!0,c.tabs[b].fields.visibility.value="visible");break}e.loadPagesList()}else if("field"==
d)switch(b){case "details":a.values_source&&e.tuix.centralised_lists.values[a.values_source]&&(k=e.tuix.centralised_lists.values[a.values_source],k.info.can_filter?c.tabs[b].fields.values_source_filter.label=k.info.filter_label:c.tabs[b].fields.values_source_filter.hidden=!0);a.readonly_or_mandatory&&"conditional_mandatory"==a.readonly_or_mandatory&&a.mandatory_condition_field_id&&(g=e.getItem("field",a.mandatory_condition_field_id))&&("checkboxes"==g.type?(c.tabs[b].fields.mandatory_condition_checkboxes_field_value.values=
JSON.parse(JSON.stringify(g.lov)),c.tabs[b].fields.mandatory_condition_field_value.hidden=!0,c.tabs[b].fields.mandatory_condition_checkboxes_operator.hidden=!1):(c.tabs[b].fields.mandatory_condition_checkboxes_field_value.hidden=!0,"checkbox"!=g.type&&"group"!=g.type&&(c.tabs[b].fields.mandatory_condition_field_type.values.mandatory_if_one_of={label:"Mandatory if one of..."},c.tabs[b].fields.mandatory_condition_field_value.values=JSON.parse(JSON.stringify(g.lov)),c.tabs[b].fields.mandatory_condition_field_value.empty_value=
"-- Any value --","mandatory_if_one_of"==a.mandatory_condition_field_type&&(c.tabs[b].fields.mandatory_condition_field_value.hidden=!0,c.tabs[b].fields.mandatory_condition_checkboxes_field_value.values=JSON.parse(JSON.stringify(g.lov)),c.tabs[b].fields.mandatory_condition_checkboxes_field_value.hidden=!1))));"field_validation"==f?("email"==a.field_validation?c.tabs[b].fields.field_validation_error_message.value="The email address you have entered is not valid, please enter a valid email address.":
"URL"==a.field_validation?c.tabs[b].fields.field_validation_error_message.value="Please enter a valid URL.":"number"==a.field_validation?c.tabs[b].fields.field_validation_error_message.value="Please enter a valid number.":"integer"==a.field_validation?c.tabs[b].fields.field_validation_error_message.value="Please enter a valid integer.":"floating_point"==a.field_validation&&(c.tabs[b].fields.field_validation_error_message.value="Please enter a valid floating point number."),$("#organizer_form_field_"+
a.id+" .form_field_classes .validation").toggle(a.field_validation&&"none"!=a.field_validation)):"visibility"==f?(f="","hidden"==a.visibility?f="Hidden":"visible_on_condition"==a.visibility&&(f="Visible on condition"),$("#organizer_form_field_"+a.id+" .form_field_classes .not_visible").toggle("visible"!=a.visibility).prop("title",f)):"values_source"==f&&(a.values_source?(actionRequests={mode:"get_centralised_lov",method:a.values_source},e.tuix.centralised_lists.values[a.values_source].info.can_filter&&
(actionRequests.filter=a.values_source_filter),e.sendAJAXRequest(actionRequests,function(b){a.lov=b;e.loadFieldValuesListPreview(a.id)})):(a.lov={},e.loadFieldValuesListPreview(a.id)));"calculated"==a.type&&a.calculation_code&&(c.tabs[b].fields.calculation_code.value=e.getCalculationCodeDisplay(a.calculation_code));a.dataset_field_id&&(c.tabs[b].fields.values_source.readonly=!0,c.tabs[b].fields.values_source_filter.readonly=!0,c.tabs[b].fields.min_rows.readonly=!0,c.tabs[b].fields.max_rows.readonly=
!0);"repeat_start"==a.type&&(c.tabs[b].fields.label.label="Section heading:",c.tabs[b].fields.label.note_below="This will be the heading at the start of the repeating section.");break;case "advanced":"select"==a.type&&(c.tabs[b].fields.default_value_options.label="Pre-select field:");-1!=["radios","centralised_radios","select","centralised_select"].indexOf(a.type)&&(c.tabs[b].fields.default_value_lov.values=JSON.parse(JSON.stringify(a.lov)));c.tabs[b].fields.merge_name.snippet.html=a.custom_code_name?
"<div><b>Merge names:</b> "+a.custom_code_name+", "+e.getFormFieldMergeName(a.id)+"</div>":"<div><b>Merge name:</b> "+e.getFormFieldMergeName(a.id)+"</div>";break;case "values":if(a.dataset_field_id&&"text"!=a.type&&(c.tabs[b].fields.values.readonly=!0),"salutation"==a.db_column){for(k in c.tabs[b].fields.suggested_values_source.values)"zenario_common_features::getSalutations"!=k&&delete c.tabs[b].fields.suggested_values_source.values[k];c.tabs[b].fields.suggested_values_source.note_below='<a href="'+
e.tuix.link+'zenario/admin/organizer.php?#zenario__languages/panels/salutations" target="_blank">Manage list of salutations</a>'}}};h.validateTUIX=function(d,a,b,c){a.name||(c.tabs[b].fields.name.error="Please enter a name.");if("details"==b&&a.visibility&&"visible_on_condition"==a.visibility)if(!a.visible_condition_field_id)c.tabs[b].fields.visible_condition_field_id.error="Please select a field on which its visibility is conditional.";else if(!a.visible_condition_field_value){var f=this.getItem("field",
a.visible_condition_field_id);!f||"checkbox"!=f.type&&"group"!=f.type||(c.tabs[b].fields.visible_condition_field_value.error="Please select a field value on which its visiblity is conditional.")}if("field"==d)switch(b){case "details":if("checkbox"==a.type||"group"==a.type)a.label||(c.tabs[b].fields.label.error="Please enter a label for this checkbox.");else if("repeat_start"==a.type)if(a.min_rows?+a.min_rows!=a.min_rows?c.tabs[b].fields.min_rows.error="Please a valid number for mininum rows.":1>a.min_rows||
10<a.min_rows?c.tabs[b].fields.min_rows.error="Mininum rows must be between 1 and 10.":+a.min_rows>+a.max_rows&&(c.tabs[b].fields.min_rows.error="Minimum rows cannot be greater than maximum rows."):c.tabs[b].fields.min_rows.error="Please enter the minimum rows.",!a.max_rows)c.tabs[b].fields.max_rows.error="Please enter the maximum rows.";else if(+a.max_rows!=a.max_rows)c.tabs[b].fields.max_rows.error="Please a valid number for maximum rows.";else{if(1>a.max_rows||20<a.max_rows)c.tabs[b].fields.max_rows.error=
"Maximum rows must be between 1 and 20."}else"restatement"==a.type?a.restatement_field||(c.tabs[b].fields.restatement_field.error="Please select the field to mirror."):"centralised_radios"!=a.type&&"centralised_select"!=a.type||a.values_source||(c.tabs[b].fields.values_source.error="Please select a values source.");if(a.readonly_or_mandatory)if("mandatory"!=a.readonly_or_mandatory&&"conditional_mandatory"!=a.readonly_or_mandatory&&"mandatory_if_visible"!=a.readonly_or_mandatory||a.required_error_message||
(c.tabs[b].fields.required_error_message.error="Please enter an error message when this field is incomplete."),"mandatory"==a.readonly_or_mandatory)"hidden"==a.visibility?c.tabs[b].fields.readonly_or_mandatory.error="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&(c.tabs[b].fields.readonly_or_mandatory.error="This field is marked as mandatory, but is only visible based on a condition. Either: change this field to be visible (without condition); or mandatory on condition, with the same condition as that on which visibility depends.");
else if("conditional_mandatory"==a.readonly_or_mandatory)if(a.mandatory_condition_field_id?a.mandatory_condition_field_value||(f=this.getItem("field",a.mandatory_condition_field_id))&&-1!=["checkbox","group"].indexOf(f.type)&&(c.tabs[b].fields.mandatory_condition_field_value.error="Please select a mandatory on condition form field value."):c.tabs[b].fields.mandatory_condition_field_id.error="Please select a mandatory on condition form field.","hidden"==a.visibility)c.tabs[b].fields.visibility.error=
"A field cannot be mandatory while hidden.";else if("visible_if_one_of"==a.visible_condition_field_type&&""!=a.visible_condition_field_id&&_._isEm(a.visible_condition_checkboxes_field_value))c.tabs[b].fields.visibility.error="Please select a checkbox for visibility condition.";else if("visible_if_one_of"==a.visible_condition_field_type&&"mandatory_if_one_of"!=a.mandatory_condition_field_type){error=0;switch(a.mandatory_condition_field_type){case "mandatory_if_not":if(""==a.mandatory_condition_field_value&&
!_._isEm(a.visible_condition_checkboxes_field_value)||""==a.mandatory_condition_field_value&&_._isEm(a.visible_condition_checkboxes_field_value)||!_.contains(a.visible_condition_checkboxes_field_value,a.mandatory_condition_field_value))error=1;break;case "mandatory_if":""==a.mandatory_condition_field_value?error=1:a.visible_condition_checkboxes_field_value&&(error=_.contains(a.visible_condition_checkboxes_field_value,a.mandatory_condition_field_value)?0:1)}1==error&&(c.tabs[b].fields.visibility.error=
"A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")}else if("mandatory_if_one_of"==a.mandatory_condition_field_type)if(error=0,_._isEm(a.mandatory_condition_checkboxes_field_value)&&""!=a.mandatory_condition_field_id)c.tabs[b].fields.mandatory_condition_field_value.error="Please select a checkbox for mandatory condition.";else{if("visible"==a.visibility)error=0;else if(a.visible_condition_field_id!=a.mandatory_condition_field_id)error=
1;else switch(a.visible_condition_field_type){case "visible_if_one_of":if(""!=a.visible_condition_checkboxes_field_value&&a.mandatory_condition_checkboxes_field_value)for(f=0;f<a.mandatory_condition_checkboxes_field_value.length;f++)if(!_.contains(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value[f])){error=1;break}break;case "visible_if_not":if(""==a.visible_condition_field_value&&!_._isEm(a.mandatory_condition_checkboxes_field_value)||""==a.visible_condition_field_value&&
_._isEm(a.mandatory_condition_checkboxes_field_value)||_.contains(a.mandatory_condition_checkboxes_field_value,a.visible_condition_field_value))error=1;break;case "visible_if":if(""!=a.visible_condition_field_value)if(a.mandatory_condition_checkboxes_field_value&&1!=a.mandatory_condition_checkboxes_field_value.length)error=1;else if(a.mandatory_condition_checkboxes_field_value)for(f=0;f<a.mandatory_condition_checkboxes_field_value.length;f++)if(a.mandatory_condition_checkboxes_field_value[f]!=a.visible_condition_field_value){error=
1;break}}0!=error&&(c.tabs[b].fields.mandatory_condition_field_value.error="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")}else"visible_on_condition"==a.visibility&&"conditional_mandatory"==a.readonly_or_mandatory&&a.visible_condition_field_id&&a.mandatory_condition_field_id&&(a.visible_condition_field_id!=a.mandatory_condition_field_id||"visible_if"==a.visible_condition_field_type&&"mandatory_if_not"==
a.mandatory_condition_field_type||"visible_if_not"==a.visible_condition_field_type&&"mandatory_if"==a.mandatory_condition_field_type||(f=this.getItem("field",a.mandatory_condition_field_id))&&"checkboxes"!=f.type&&a.visible_condition_field_value!=a.mandatory_condition_field_value||"checkboxes"==f.type&&(a.visible_condition_checkboxes_operator!=a.mandatory_condition_checkboxes_operator||!_._isEq(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value)))&&(c.tabs[b].fields.visibility.error=
"A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.");a.field_validation&&"none"!=a.field_validation&&!a.field_validation_error_message&&(c.tabs[b].fields.field_validation_error_message.error="Please enter a validation error message for this field.");if("text"==a.type&&a.field_validation&&-1==["number","integer","floating_point"].indexOf(a.field_validation))for(d=this.getOrderedFields(),f=0;f<d.length;f++){var e=
d[f];if("calculated"==e.type&&e.calculation_code)for(j=0;j<e.calculation_code.length;j++)if("field"==e.calculation_code[j].type&&e.calculation_code[j].value==a.id){c.tabs[b].fields.field_validation.error='The field "'+e.name+'" requires this field to be numeric. You must first remove this from this field.';break}}break;case "values":a.enable_suggested_values&&("pre_defined"!=a.suggested_values_type||a.suggested_values_source?"custom"!=a.suggested_values_type||a.lov&&0!=Object.keys(a.lov).length||
(c.tabs[b].fields.values.error="Please add at least one value."):c.tabs[b].fields.suggested_values_source.error="Please select a values source.");break;case "advanced":a.default_value_options&&("value"==a.default_value_options?a.default_value_lov||a.default_value_text||(e.default_value.error="Please enter a default value."):"method"==a.default_value_options&&(a.default_value_class_name||(e.default_value_class_name.error="Please enter a class name."),a.default_value_method_name||(e.default_value_method_name.error=
"Please enter the name of a static method.")));if(a.custom_code_name)for(d=this.getOrderedFields(),f=0;f<d.length;f++)e=d[f],e.id!=a.id&&a.custom_code_name==e.custom_code_name&&(c.tabs[b].fields.custom_code_name.error="Another field already has this code name on this form.");a.invalid_responses&&a.invalid_responses.length&&!a.invalid_field_value_error_message&&(c.tabs[b].fields.invalid_field_value_error_message.error="Please enter an error message when an invalid response is chosen.");if("textarea"==
a.type&&(a.word_count_max&&(+a.word_count_max!=a.word_count_max?c.tabs[b].fields.word_count_max.error="Please enter a valid number for the max word count.":1>a.word_count_max&&(c.tabs[b].fields.word_count_max.error="Word count must be greater than 0.")),a.word_count_min&&(+a.word_count_min!=a.word_count_min?c.tabs[b].fields.word_count_min.error="Please enter a valid number for the min word count.":1>a.word_count_min&&(c.tabs[b].fields.word_count_min.error="Word count must be greater than 0.")),a.rows))if(+a.rows!=
a.rows)c.tabs[b].fields.rows.error="Please enter a valid number for the rows.";else if(1>a.rows||100<a.rows)c.tabs[b].fields.rows.error="Rows must be greater than 0 and less than 100.";break;case "crm":a.send_to_crm&&!a.field_crm_name&&(c.tabs[b].fields.field_crm_name.error="Please enter a CRM field name.")}};h.getTUIXFieldCustomValues=function(d){var a={};if("centralised_lists"==d)a=JSON.parse(JSON.stringify(this.tuix.centralised_lists.values));else if("centralised_list_filter_fields"==d||"conditional_fields"==
d||"mirror_fields"==d)for(var b=this.getOrderedPages(),c=1<b.length,f=0,e=0;e<b.length;e++)for(var g=b[e],k=this.getOrderedFields(b[e].id),h=0;h<k.length;h++){var n=k[h];if(this.canAddFieldToList(d,n.id)&&(a[n.id]={label:n.name,ord:++f},c)){var p="page_"+g.id;a[n.id].parent=p;a[p]||(a[p]={label:g.name,ord:++f})}}else"field_lov"==d&&"field"==this.editingThing&&this.editingThingId&&(n=this.getItem(this.editingThing,this.editingThingId))&&n.lov&&(a=JSON.parse(JSON.stringify(n.lov)));return a};h.canAddFieldToList=
function(d,a){var b=this.tuix.items[a];return"centralised_list_filter_fields"==d?("field"!=this.editingThing||b.id!=this.editingThingId)&&("centralised_select"==b.type||"text"==b.type&&b.enable_suggested_values&&"pre_defined"==b.suggested_values&&b.suggested_values_source):"conditional_fields"==d?("field"!=this.editingThing||b.id!=this.editingThingId)&&-1!="checkbox group radios select centralised_radios centralised_select checkboxes".split(" ").indexOf(b.type):"mirror_fields"==d?("field"!=this.editingThing||
b.id!=this.editingThingId)&&-1!=["text","calculated","select","centralised_select"].indexOf(b.type):!1};h.saveCurrentOpenDetails=function(d){var a=[],b=this.editingThing,c=this.editingThingId;if(b&&c&&this.editingThingTUIXTabId){var f=this.getTUIXModeForItemType(b),e=this.tuix[f],g=this.getItem(b,c);if(g){this.saveTUIXTab(e,this.editingThingTUIXTabId,g);if(d)a=this.getDeleteErrors(b,c);else{g.name=$("#field__name").val().trim();d=this.getTUIXTags(f,g,b);this.validateTUIX(b,g,this.editingThingTUIXTabId,
d);for(var k in d.tabs)if(r(d.tabs,k)){var g=d.tabs[k],h;for(h in g.fields)r(g.fields,h)&&(tuixField=g.fields[h],tuixField.error&&a.push(tuixField.error))}}a.length&&this.openItemTUIXTab(b,c,this.editingThingTUIXTabId,a)}}return 0==a.length};h.getDeleteErrors=function(d,a){var b=[];if("field"==d){this.getItem(d,a);for(var c=this.getOrderedFields(),f=0;f<c.length;f++){var e=c[f],g=!1;if("calculated"==e.type&&e.calculation_code)for(var k=0;k<e.calculation_code.length;k++){var h=e.calculation_code[k];
if("field"==h.type&&h.value==a){g=!0;break}}if(e.visibility&&"visible_on_condition"==e.visibility&&e.visible_condition_field_id==a||e.readonly_or_mandatory&&"conditional_mandatory"==e.readonly_or_mandatory&&e.mandatory_condition_field_id==a)g=!0;g&&b.push('Unable to delete field because the field "'+e.name+'" depends on it.')}}return b};h.displayPageFieldOrderErrors=function(){if(!this.getItem("page",this.currentPageId))return!0;for(var d=[],a=this.getOrderedFields(this.currentPageId),b="checkbox checkboxes date radios centralised_radios select centralised_select text textarea url attachment section_description calculated group".split(" "),
c=!1,f=0;f<a.length;f++)field=a[f],"repeat_start"!=field.type||c?"repeat_end"==field.type?c?c=!1:d.push("Repeat ends must be placed after repeat starts."):c&&-1==b.indexOf(field.type)&&d.push('Field type "'+this.getFieldReadableType(field).toLowerCase()+'" is not allowed in a repeat block.'):c=!0;a=0<d.length;b=$("#organizer_fields_error");b.html("");for(f=0;f<d.length;f++)b.append('<p class="error">'+d[f]+"</p>");b.toggle(a);return!a};h.getTUIXModeForItemType=function(d){return"page"==d?"form_page_details":
"field"==d?"form_field_details":!1};h.getFieldReadableType=function(d){if("string"==typeof d)var a=d;else a=d.type,d.is_consent&&(a="consent");switch(a){case "checkbox":return"Checkbox";case "checkboxes":return"Checkboxes";case "date":return"Date";case "editor":return"Editor";case "radios":return"Radios";case "centralised_radios":return"Centralised radios";case "select":return"Select";case "centralised_select":return"Centralised select";case "text":return"Text";case "textarea":return"Textarea";case "url":return"URL";
case "attachment":return"Attachment";case "page_break":return"Page";case "section_description":return"Subheading";case "calculated":return"Calculated";case "restatement":return"Mirror";case "repeat_start":return"Start of repeating section";case "repeat_end":return"End of repeating section";case "document_upload":return"Multi-upload";default:return"Unknown";case "group":return"Group";case "consent":return"Consent";case "file_picker":return"File picker"}};h.getCalculationCodeDisplay=function(d){var a=
"";if(d)for(var b=!1,c=0;c<d.length;c++){b||"parentheses_close"==d[c].type?b&&(b=!1):a+=" ";switch(d[c].type){case "operation_addition":a+="+";break;case "operation_subtraction":a+="-";break;case "operation_multiplication":a+="\u00d7";break;case "operation_division":a+="\u00f7";break;case "parentheses_open":a+="(";b=!0;break;case "parentheses_close":a+=")";break;case "static_value":a+=d[c].value;break;case "field":var f="",f=(f=this.getItem("field",d[c].value))?f.name:"UNKNOWN FIELD",a=a+('"'+f+'"')}a=
a.trim()}return a};h.calculationAdminBoxAddSomthing=function(d,a){var b=!1;switch(d){case "operation_addition":case "operation_subtraction":case "operation_multiplication":case "operation_division":case "parentheses_open":case "parentheses_close":b={type:d};break;case "static_value":""===a||isNaN(+a)||(b={type:d,value:+a},$("#static_value").val(""));break;case "field":b={type:d,value:a},$("#numeric_field").val("")}if(b){var c=[];$("#calculation_code").val()&&(c=JSON.parse($("#calculation_code").val()));
c.push(b);$("#calculation_code").val(JSON.stringify(c));this.calculationAdminBoxUpdateDisplay(c)}};h.calculationAdminBoxDelete=function(){var d=[];$("#calculation_code").val()&&(d=JSON.parse($("#calculation_code").val()))&&(d.pop(),$("#calculation_code").val(JSON.stringify(d)));this.calculationAdminBoxUpdateDisplay(d)};h.calculationAdminBoxUpdateDisplay=function(d){d=this.getCalculationCodeDisplay(d);$("#zenario_calculation_display").text(d)};h.openFormSettings=function(){var d=this;x.open("zenario_user_form",
{id:v.pi.refiner.id},q,q,function(a,b){var c="";b.details.show_title&&(c=b.details.title);d.tuix.title=c;$("#organizer_form_builder .form_outer .form_header h5").text(c)})};h.changeMadeToPanel=function(){this.changeMadeOnPanel||(this.changeMadeOnPanel=!0,y.onbeforeunload=function(){return"You are currently editing this form. If you leave now you will lose any unsaved changes."},v._dI("Please either save your changes, or click Reset to discard them, before exiting the form editor."),v._sB())};h.saveChanges=
function(){var d=this;if(d.tuix.not_used_or_on_public_page){for(var a=!1,b=!1,c=d.getOrderedFields(),f=0;f<c.length;f++)c[f].dataset_field_id&&("email"==c[f].db_column?b=!0:a=!0);if(a&&!b&&!confirm("Warning: this form contains fields that are linked to the Users Dataset, but doesn't contain the Email field from the Users Dataset.\n\nIf this form is used on a public web page by anonymous visitors, form responses will not be stored in the Users & Contacts database table.\n\nTo overcome this, please add the Email field linked to the Users Dataset.\n\nSave anyway?"))return}a=
{mode:"save",pages:JSON.stringify(d.tuix.pages),fields:JSON.stringify(d.tuix.items),fieldsTUIX:JSON.stringify(d.tuix.form_field_details),pagesReordered:d.pagesReordered,deletedPages:JSON.stringify(d.deletedPages),deletedFields:JSON.stringify(d.deletedFields),deletedValues:JSON.stringify(d.deletedValues),currentPageId:d.currentPageId,editingThing:d.editingThing,editingThingId:d.editingThingId};s._nDS("saving",!0);d.sendAJAXRequest(a,function(a){s._nDS();if(a){if(a.errors){for(var b="",c=0;c<a.errors.length;c++)b+=
a.errors[c]+"<br>";b&&s._flBo(b)}d.currentPageId=a.currentPageId;d.editingThing=a.editingThing;d.editingThingId=a.editingThingId}y.onbeforeunload=!1;v._eI();d.changeMadeOnPanel=!1;d.changesSaved=!0;v._r()})}},zenarioO.panelTypes);
