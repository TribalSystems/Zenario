zenario.lib(function(p,g,C,y,D,E,F,u,G,x,H,v,I,J,K,L,M,N,A,B,m,z,O,t,P,Q,R,S,r){g=B(z.form_builder=A(z.form_builder_base_class));g.showPanel=function(b,a,c){b.html("").hide();c.html("").show();this.sortOutItems();b=this.loadPanelHTML();a.html(b).show();_._isEm(this.tuix.items)&&this.addNewPage(!0);this.currentPageId||(a=this.getOrderedPages(),0<a.length&&(this.currentPageId=a[0].id));this.pagesReordered=!1;this.deletedPages=[];this.deletedFields=[];this.deletedValues=[];this.changeDetected=!1;this.maxNewCustomFieldValue=
this.maxNewCustomField=1;this.selectedDetailsPage=this.selectedDetailsPage?this.selectedDetailsPage:!1;this.selectedFieldId=this.selectedFieldId?this.selectedFieldId:!1;this.selectedPageId=this.selectedPageId?this.selectedPageId:!1;this.loadPagesList(this.currentPageId);this.loadFieldsList(this.currentPageId);this.selectedFieldId?this.loadFieldDetailsPanel(this.selectedFieldId,!0):this.selectedPageId?this.loadPageDetailsPanel(this.selectedPageId,!0):this.loadNewFieldsPanel(!0);this.changesSaved&&
(this.changesSaved=!1,u._t({message_type:"success",message:"Your changes have been saved!"}))};g.sortOutItems=function(){var b,a,c;for(a in this.tuix.fields)m(this.tuix.fields,a)&&(c=this.tuix.fields[a],c.invalid_responses&&(c.invalid_responses=_._tA(c.invalid_responses)),c.visible_condition_checkboxes_field_value&&(c.visible_condition_checkboxes_field_value=_._tA(c.visible_condition_checkboxes_field_value)),c.mandatory_condition_checkboxes_field_value&&(c.mandatory_condition_checkboxes_field_value=
_._tA(c.mandatory_condition_checkboxes_field_value)));for(b in this.tuix.items)m(this.tuix.items,b)&&(a=this.tuix.items[b],a.visible_condition_checkboxes_field_value&&(a.visible_condition_checkboxes_field_value=_._tA(a.visible_condition_checkboxes_field_value)),a.mandatory_condition_checkboxes_field_value&&(a.mandatory_condition_checkboxes_field_value=_._tA(a.mandatory_condition_checkboxes_field_value)))};g.loadPanelHTML=function(){return this.microTemplate(t+"organizer_form_builder",{form_title:this.tuix.form_title})};
g.loadPageDetailsPanel=function(b,a){this.loadFieldDetailsPanel(b,a,!0);var c=this,d,e,f,q;$("#field__name").on("keyup",function(){d=c.getPageLabel($(this).val());$("#organizer_form_tab_"+b+" span").text(d)});$("#organizer_remove_form_tab").on("click",function(a){if(e=c.tuix.items[b])f="<p>Are you sure you want to delete this page?</p>",q=c.getOrderedFields(b),q.length&&(f+="<p>All fields on this page will be moved onto the previous page.</p>"),u._flBo(f,"Delete","warning",!0,!1,function(){c.deletePage(b)})})};
g.loadFieldDetailsPanel=function(b,a,c){var d;c?(d=this.tuix.items[b],d.type="page_break"):d=this.tuix.fields[b];c={mode:"field_details",name:d.name,type:d.type,typePhrase:this.getFieldReadableType(d.type),just_added:d.just_added,hide_tab_bar:this.tuix.field_details.hide_tab_bar,is_tab:c};d.dataset_field_id&&(c.type+=", dataset field",d.db_column&&(c.type+=" ("+d.db_column+")"));c=this.microTemplate(t+"organizer_form_builder_left_panel",c);c=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(c);
a||c.hide().show("drop",{direction:"left"},200);a=this.sortAndLoadTUIXPages(this.tuix.field_details.tabs,d,this.selectedDetailsPage);c=this.getTUIXPagesHTML(a);$("#organizer_field_details_tabs").html(c);var e=this;$("#organizer_field_details_tabs .tab").on("click",function(){var a=$(this).data("name");a&&a!=e.selectedDetailsPage&&(e.saveCurrentOpenDetails()||e.loadFieldDetailsPage(a,b))});this.loadFieldDetailsPage(this.selectedDetailsPage,b);$("#organizer_field_details_inner span.add_new_field").on("click",
function(){e.saveCurrentOpenDetails()||(e.highlightField(!1),e.loadNewFieldsPanel())});$(r+"field_details_header_content .edit_field_name_button").on("click",function(){$(r+"field_details_header_content .view_mode").hide();$(r+"field_details_header_content .edit_mode").show()});$(r+"field_details_header_content .done_field_name_button").on("click",function(){$(r+"field_details_header_content .edit_mode").hide();$(r+"field_details_header_content .view_mode").show();var a=$(r+'field_details_header_content .edit_mode input[name="name"]').val();
d.name=a;$(r+"field_details_header_content .view_mode h5").text(a)});$("#field__name").on("keyup",function(){e.changeMadeToPanel()});$("input.form_settings").on("click",function(){e.openFormSettings()})};g.openFormSettings=function(){x.open(t+"user_form",{id:v.pi.refiner.id},p,p,function(b,a){var c="";a.details.show_title&&(c=a.details.title);this.tuix.title=c;$("#organizer_form_builder .form_outer .form_header h5").text(c)})};g.loadPageDetailsPage=function(b,a,c){this.loadFieldDetailsPage(b,a,c)};
g.loadFieldDetailsPage=function(b,a,c){this.selectedDetailsPage=b;var d;if(this.selectedFieldId&&this.tuix.fields[a])d=this.tuix.fields[a];else if(this.selectedPageId&&this.tuix.items[a]){d=this.tuix.items[a];for(var e=this.getOrderedPages(),f=0;f<e.length;f++)if(e[f].id==d.id){f==e.length-1&&(d.visibility="visible");break}}var e=this.tuix.field_details.tabs[b].fields,q=this.loadFields("field_details/"+b,e,d),q=this.formatFieldDetails(q,d,"field",b),l=this.sortFields(q,d),e="";if(!_._isEm(c))for(c=
this.sortErrors(c),f=0;f<c.length;f++)e+='<p class="error">'+c[f]+"</p>";e+=this.getTUIXFieldsHTML(l);$("#organizer_field_details").html(e);$("#organizer_field_details_tabs .tab").removeClass("on");$("#field_tab__"+b).addClass("on");_._isEm(c)||$("#organizer_field_details_form").effect({effect:"bounce",duration:125,direction:"right",times:2,distance:5,mode:"effect"});var k=this;if("details"==b)if($("#field__field_label").on("keyup",function(){$("#organizer_form_field_"+a+" .label").text($(this).val());
d.just_added&&$("#field__name").val($(this).val())}),$("#field__note_to_user").on("keyup",function(){var c=$(this).val().trim();$("#organizer_form_field_note_below_"+a+" div.zenario_note_content").text(c);$("#organizer_form_field_note_below_"+a).toggle(""!==c)}),"text"==d.type||"textarea"==d.type)$("#field__placeholder").on("keyup",function(){$("#organizer_form_field_"+a+" :input").prop("placeholder",$(this).val())});else if("section_description"==d.type)$("#field__description").on("keyup",function(){$("#organizer_form_field_"+
a+" .description").text($(this).val())});else{if("calculated"==d.type)$("#edit_field_calculation").on("click",function(){var c={},b;for(b in k.tuix.fields)if(m(k.tuix.fields,b)){var e=k.tuix.fields[b];if("text"==e.type&&-1!=["number","integer","floating_point"].indexOf(e.field_validation)||"calculated"==e.type&&a!=b)c[b]={label:e.name,ord:e.ord}}b={id:a,title:'Editing the calculation for the field "'+d.name+'"',calculation_code:JSON.stringify(d.calculation_code)};c={details:{dummy_field:JSON.stringify(c)}};
x.open(t+"field_calculation",b,p,c,function(c,b){d.calculation_code=b.details.calculation_code?JSON.parse(b.details.calculation_code):"";k.changeMadeToPanel();k.saveCurrentOpenDetails();k.loadFieldDetailsPage("details",a)})})}else if("advanced"==b)$("#field__css_classes").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .css").toggle(!!$(this).val()).prop("title",$(this).val())}),$("#field__div_wrap_class").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .div").toggle(!!$(this).val()).prop("title",
$(this).val())});else if("values"==b)q.values&&!q.values._hidden&&(f=this.getOrderedFieldValues(a),e=this.microTemplate(t+"organizer_admin_box_builder_field_value",f),$("#field_values_list").html(e).sortable({containment:"parent",tolerance:"pointer",axis:"y",start:function(a,b){k.startIndex=b.item.index()},stop:function(b,c){k.startIndex!=c.item.index()&&(k.saveFieldListOfValues(k.tuix.fields[a]),k.loadFieldValuesListPreview(a),k.changeMadeToPanel())}}),$("#field_values_list input").on("keyup",function(){var a=
$(this).data("id");$("#organizer_field_value_"+a+" label").text($(this).val());k.changeMadeToPanel()}),$("#organizer_add_a_field_value").on("click",function(){k.addFieldValue(d);k.saveItemTUIXPage("field_details",b,d);k.loadFieldDetailsPage(b,a);k.loadFieldValuesListPreview(a);k.changeMadeToPanel()}),$("#field_values_list .delete_icon").on("click",function(){var c=$(this).data("id");d.lov[c]&&(k.deletedValues.push(c),delete d.lov[c]);k.saveItemTUIXPage("field_details",b,d);k.loadFieldDetailsPage(b,
a);k.loadFieldValuesListPreview(a);k.changeMadeToPanel()}));else if("translations"==b){e=_._tA(this.tuix.field_details.tabs[b].translapagele_fields);c={};for(f=0;f<e.length;f++)c[e[f]]=!0;b="details";var e=this.tuix.field_details.tabs[b].fields,q=this.loadFields("field_details/"+b,e,d),q=this.formatFieldDetails(q,d,"field",b),l=this.sortFields(q,d),h=[];for(f in l)if(m(l,f)){var s=l[f];c[s.id]&&!s._hidden&&h.push(s.id)}l=this.sortLanguages(this.tuix.languages);c=[];for(f in h)if(m(h,f)&&(s=h[f],q[s]&&
!q[s]._hidden)){var g={};d._translations&&d._translations[s]&&(g=d._translations[s]);var n={};e[s]&&e[s].label&&(n.label=e[s].label);d[s]?n.value=d[s]:(n.value="(No text is defined in the default language)",n.disabled=!0);n.phrases=[];for(var w in l)if(m(l,w)){var r=l[w];parseInt(r.translate_phrases)&&n.phrases.push({field_column:s,language_id:r.id,language_name:r.english_name,phrase:g.phrases&&g.phrases[r.id]&&!n.disabled?g.phrases[r.id]:"",disabled:n.disabled})}c.push(n)}e=this.microTemplate(t+
"organizer_form_builder_translatable_field",c);$("#organizer_field_translations").html(e);$("#organizer_field_translations input").on("keyup",function(){k.changeMadeToPanel()})}else if("crm"==b){$("#organizer_crm_button__set_labels").on("click",function(){k.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(c,b){var d=$(this).data("id"),e="";k.tuix.fields[a].lov&&k.tuix.fields[a].lov[d]&&(e=k.tuix.fields[a].lov[d].label);$(this).val(e)})});$("#organizer_crm_button__set_values").on("click",
function(){k.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(a,c){var b=$(this).data("id");$(this).val(b)})});w={values:[]};if("checkbox"==d.type||"group"==d.type){f={unchecked:{label:0,ord:1},checked:{label:1,ord:2}};if(d._crm_data&&d._crm_data.values)for(h in d._crm_data.values)m(d._crm_data.values,h)&&(e=d._crm_data.values[h],f[h]&&e.crm_value!==p&&(f[h].crm_value=e.crm_value));for(h in f)m(f,h)&&(e=f[h],e.id=h,w.values.push(e));w.values.sort(this.sortByOrd)}else w.values=
this.getOrderedFieldValues(a);e=this.microTemplate(t+"organizer_form_builder_crm_values",w);$("#organizer_field_crm_values").html(e);$("#organizer_field_crm_values input.crm_value_input").on("keyup",function(){k.changeMadeToPanel()})}};g.calculationAdminBoxAddSomthing=function(b,a){var c=!1;switch(b){case "operation_addition":case "operation_subtraction":case "operation_multiplication":case "operation_division":case "parentheses_open":case "parentheses_close":c={type:b};break;case "static_value":""===
a||isNaN(+a)||(c={type:b,value:+a},$("#static_value").val(""));break;case "field":c={type:b,value:a},$("#numeric_field").val("")}if(c){var d=[];$("#calculation_code").val()&&(d=JSON.parse($("#calculation_code").val()));d.push(c);$("#calculation_code").val(JSON.stringify(d));this.calculationAdminBoxUpdateDisplay(d)}};g.calculationAdminBoxDelete=function(){var b=[];$("#calculation_code").val()&&(b=JSON.parse($("#calculation_code").val()))&&(b.pop(),$("#calculation_code").val(JSON.stringify(b)));this.calculationAdminBoxUpdateDisplay(b)};
g.calculationAdminBoxUpdateDisplay=function(b){b=this.getCalculationCodeDisplay(b);$(r+"calculation_display").text(b)};g.getCalculationCodeDisplay=function(b){var a="",c,d,e,f;if(b){c={};for(d in this.tuix.fields)m(this.tuix.fields,d)&&(e=this.tuix.fields[d],c[d]=e);d=!1;for(e=0;e<b.length;e++){d||"parentheses_close"==b[e].type?d&&(d=!1):a+=" ";switch(b[e].type){case "operation_addition":a+="+";break;case "operation_subtraction":a+="-";break;case "operation_multiplication":a+="\u00d7";break;case "operation_division":a+=
"\u00f7";break;case "parentheses_open":a+="(";d=!0;break;case "parentheses_close":a+=")";break;case "static_value":a+=b[e].value;break;case "field":f=c[b[e].value]?c[b[e].value].name:"UNKNOWN FIELD",a+='"'+f+'"'}a=a.trim()}}return a};g.formatFieldDetails=function(b,a,c,d){if("field"==c)if("details"==d)if(a.dataset_field_id&&(b.values_source._disabled=!0,b.values_source_filter._readonly=!0,b.min_rows._readonly=!0,b.max_rows._readonly=!0),(c=b.values_source._value)&&this.tuix.centralised_lists.values[c]&&
(c=this.tuix.centralised_lists.values[c],c.info.can_filter?b.values_source_filter.label=c.info.filter_label:b.values_source_filter._hidden=!0),"visible_on_condition"==a.visibility&&a.visible_condition_field_id&&(c=this.getField(a.visible_condition_field_id))&&("checkboxes"==c.type?(b.visible_condition_checkboxes_field_value.values=c.lov,b.visible_condition_field_value._hidden=!0,b.visible_condition_checkboxes_operator._hidden=!1):("checkbox"!=c.type&&"group"!=c.type&&(b.visible_condition_field_value.values=
c.lov,b.visible_condition_field_value.empty_value="-- Any value --"),b.visible_condition_checkboxes_field_value._hidden=!0)),"conditional_mandatory"==a.readonly_or_mandatory&&a.mandatory_condition_field_id&&(c=this.getField(a.mandatory_condition_field_id),"checkboxes"==c.type?(b.mandatory_condition_checkboxes_field_value.values=c.lov,b.mandatory_condition_field_value._hidden=!0,b.mandatory_condition_checkboxes_operator._hidden=!1):(c&&"checkbox"!=c.type&&"group"!=c.type&&(b.mandatory_condition_field_value.values=
c.lov,b.mandatory_condition_field_value.empty_value="-- Any value --"),b.mandatory_condition_checkboxes_field_value._hidden=!0)),"repeat_start"==a.type)b.field_label.label="Section heading:",b.field_label.note_below="This will be the heading at the start of the repeating section.";else if("calculated"==a.type)a.calculation_code&&(Array.isArray(a.calculation_code)||(a.calculation_code=$.map(a.calculation_code,function(a){return a})),b.calculation_code._value=this.getCalculationCodeDisplay(a.calculation_code));
else{if("page_break"==a.type)for(c=this.getOrderedPages(),d=0;d<c.length;d++)if(c[d].id==a.id){0==d?b.previous_button_text._hidden=!0:d==c.length-1&&(b.next_button_text._hidden=!0,b.visibility._disabled=!0);break}}else"advanced"==d&&("value"==a.default_value_options&&-1!=["radios","centralised_radios","select","centralised_select"].indexOf(a.type)&&(b.default_value_lov.values=a.lov),"select"==a.type&&(b.default_value_options.label="Pre-select field:"));"page_break"==a.type&&this.loadPagesList(this.currentPageId);
return b};g.getField=function(b){return this.tuix.fields[b]?this.tuix.fields[b]:!1};g.getFieldValuesList=function(b){var a=[],c=b.id,d=b.values,e=b._value,f=b._disabled,q=!1;if("object"==typeof d){var l=0,k;for(k in d)if(m(d,k)){var h=d[k],h={label:h.label,value:k,ord:h.ord!==p?h.ord:++l};a.push(h)}}else if("centralised_lists"==d){var l=0,g;for(g in this.tuix.centralised_lists.values)m(this.tuix.centralised_lists.values,g)&&(d=this.tuix.centralised_lists.values[g],h={ord:++l,label:d.label,value:g},
a.push(h))}else if("centralised_list_filter_fields"==d||"conditional_fields"==d||"mirror_fields"==d)for(k=this.getOrderedPages(),q=1<k.length,g=1,l=0;l<k.length;l++)for(var r=this.getOrderedFields(k[l].id),n=!1,t=k[l],u=0;u<r.length;u++)h=r[u],this.canAddFieldToList(d,h)&&(!1===n&&q&&(n=a.push({ord:g++,label:t.name,hasChildren:!0,options:[]})-1),h={ord:g++,label:h.name,value:h.id,parent:n},a.push(h));else if("field_lov"==d&&this.tuix.fields[this.selectedFieldId]&&this.tuix.fields[this.selectedFieldId].lov)for(k in this.tuix.fields[this.selectedFieldId].lov)m(this.tuix.fields[this.selectedFieldId].lov,
k)&&(h=this.tuix.fields[this.selectedFieldId].lov[k],h={ord:h.ord,label:h.label,value:k},a.push(h));for(var v in a)m(a,v)&&(h=a[v],"checkboxes"==b.type?e&&-1!=e.indexOf(h.value)&&(h.selected=!0):h.value==e&&(h.selected=!0),f&&(h.disabled=!0),h.name=c,h.path=b.path,q&&h.parent!==p&&(a[h.parent].options.push(h),delete a[v]));a.sort(this.sortByOrd);return a};g.canAddFieldToList=function(b,a){return"centralised_list_filter_fields"==b?a.id!=this.selectedFieldId&&("centralised_select"==a.type||"text"==
a.type&&a.autocomplete&&a.values_source):"conditional_fields"==b?a.id!=this.selectedFieldId&&-1!="checkbox group radios select centralised_radios centralised_select checkboxes".split(" ").indexOf(a.type):"mirror_fields"==b?a.id!=this.selectedFieldId&&-1!=["text","calculated","select","centralised_select"].indexOf(a.type):!1};g.loadNewFieldsPanel=function(b){this.selectedFieldId=this.selectedPageId=!1;var a={mode:"new_fields",datasetTabs:this.getOrderedDatasetPagesAndFields(),link_to_dataset:this.tuix.link_to_dataset},
a=this.microTemplate(t+"organizer_form_builder_left_panel",a),a=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(a);b||a.hide().show("drop",{direction:"right"},200);var c=this;$("#organizer_field_type_list div.field_type, #organizer_centralised_field_type_list div.field_type, #organizer_linked_field_type_list div.dataset_field").draggable({connectToSortable:"#organizer_form_fields .form_section",appendTo:"#organizer_form_builder",helper:"clone"});$("input.form_settings").on("click",
function(){c.openFormSettings()})};g.loadPagesList=function(b){for(var a in this.tuix.items)if(m(this.tuix.items,a)){var c=this.tuix.items[a];b==a?c._selected=!0:delete c._selected}b=this.getOrderedPages();1>=b.length&&(b=!1);b=this.microTemplate(t+"organizer_form_builder_tabs",{pages:b});$("#organizer_form_tabs").html(b);var d=this;$("#organizer_form_tabs .tab").on("click",function(){var a=$(this).data("id");d.tuix.items[a]&&d.clickPage(a)});$("#organizer_add_new_tab").on("click",function(){d.saveCurrentOpenDetails()||
(d.addNewPage(),d.changeMadeToPanel())});$("#organizer_form_tabs").sortable({containment:"parent",tolerance:"pointer",items:"div.sort",start:function(a,c){d.startIndex=c.item.index()},stop:function(a,c){d.startIndex!=c.item.index()&&($("#organizer_form_tabs .tab.sort").each(function(a){var c=$(this).data("id");d.tuix.items[c].ord=a+1}),d.pagesReordered=!0,d.changeMadeToPanel(),d.selectedPageId&&(d.saveCurrentOpenDetails(),d.loadPageDetailsPanel(d.selectedPageId,!0)))}});$("#organizer_form_tabs .tab").droppable({accept:"div.is_sortable:not(.repeat_end)",
greedy:!0,hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(a,c){if(!d.saveCurrentOpenDetails()){var b=$(this).data("id"),l=$(c.draggable).data("id");d.moveFieldToPage(d.currentPageId,b,l);l==d.selectedFieldId&&d.loadNewFieldsPanel();d.loadFieldsList(d.currentPageId)}}})};g.moveFieldToPage=function(b,a,c,d){if(b!=a&&this.tuix.items[a]&&this.tuix.items[b]&&this.tuix.items[b].fields[c]&&"repeat_end"!=this.tuix.fields[c].type){this.tuix.items[a]._pageFieldsReordered=!0;this.tuix.items[b]._pageFieldsReordered=
!0;var e=1,f=this.getOrderedFields(a);f.length&&(e=d?f[0].ord-1:f[f.length-1].ord+1);"repeat_start"==this.tuix.fields[c].type&&(d=this.getMatchingRepeatEnd(c),this.tuix.fields[d].ord=e+0.001,this.tuix.items[a].fields[d]=1,delete this.tuix.items[b].fields[d]);this.tuix.fields[c].ord=e;this.tuix.items[a].fields[c]=1;delete this.tuix.items[b].fields[c];this.changeMadeToPanel()}};g.addNewPage=function(b){var a=1,c=this.getOrderedPages();c.length&&(a=c[c.length-1].ord+1);this.addNewField("page_break",
a,p,p,p,p,b)};g.clickPage=function(b,a){if(this.selectedPageId!=b){var c=this.saveCurrentOpenDetails(),d=this.displayPageFieldStructureErrors(this.currentPageId);c||d||(this.currentPageId==b?(this.selectedFieldId=!1,this.selectedPageId=b,this.selectedDetailsPage=!1,this.loadPageDetailsPanel(b)):this.clickPage2(b,a))}};g.clickPage2=function(b,a){this.currentPageId=b;if(a)this.selectedPageId=b,this.loadPageDetailsPanel(b);else{var c=!1;this.selectedFieldId||this.selectedPageId||(c=!0);this.loadNewFieldsPanel(c)}this.selectedFieldId=
!1;this.loadPagesList(b);this.loadFieldsList(b)};g.getOrderedPages=function(){var b=[],a,c;for(a in this.tuix.items)m(this.tuix.items,a)&&(c=this.tuix.items[a],b.push(c));b.sort(this.sortByOrd);return b};g.fieldDetailsChanged=function(b,a){b=b.split("/");var c=b[0],d=b[1],e,f,q,l;d&&c&&this.tuix[c]&&this.tuix[c].tabs[d]&&this.tuix[c].tabs[d].fields[a]&&(this.changeMadeToPanel(),e=this.tuix[c].tabs[d].fields[a],e.format_onchange&&"field_details"==c&&(l=this.selectedFieldId?this.tuix.fields[this.selectedFieldId]:
this.tuix.items[this.selectedPageId],this.saveItemTUIXPage(c,this.selectedDetailsPage,l),"details"==d&&"field_validation"==a&&("email"==l.field_validation?l.field_validation_error_message="The email address you have entered is not valid, please enter a valid email address.":"URL"==l.field_validation?l.field_validation_error_message="Please enter a valid URL.":"number"==l.field_validation?l.field_validation_error_message="Please enter a valid number.":"integer"==l.field_validation?l.field_validation_error_message=
"Please enter a valid integer.":"floating_point"==l.field_validation&&(l.field_validation_error_message="Please enter a valid floating point number.")),this.loadFieldDetailsPage(this.selectedDetailsPage,l.id),"details"==d&&("visibility"==a?(c=$("#field__visibility").val(),"hidden"==c?f="Hidden":"visible_on_condition"==c&&(f="Visible on condition"),$("#organizer_form_field_"+this.selectedFieldId+" .form_field_classes .not_visible").toggle("visible"!=c).prop("title",f)):"readonly_or_mandatory"==a?(c=
$("#field__readonly_or_mandatory").val(),"mandatory"==c?f="Mandatory":"conditional_mandatory"==c&&(f="Mandatory on condition"),$("#organizer_form_field_"+this.selectedFieldId+" .form_field_classes .mandatory").toggle("mandatory"==c||"conditional_mandatory"==c||"mandatory_if_visible"==c).prop("title",f)):"field_validation"==a?(c=$("#field__field_validation").val(),$("#organizer_form_field_"+this.selectedFieldId+" .form_field_classes .validation").toggle("none"!=c)):"values_source"==a&&((f=$("#field__values_source").val())?
(f={mode:"get_centralised_lov",method:f,filter:$("#field__values_source_filter").val()},q=this,this.sendAJAXRequest(f).after(function(a){a=JSON.parse(a);l.lov=a;q.loadFieldValuesListPreview(q.selectedFieldId)})):(l.lov={},this.loadFieldValuesListPreview(this.selectedFieldId))))))};g.loadFieldValuesListPreview=function(b){if(this.tuix.fields[b]){var a=this.tuix.fields[b],c=this.getOrderedFieldValues(b,!0),d=!1;"select"==a.type||"centralised_select"==a.type?(d=this.microTemplate(t+"organizer_admin_box_builder_select_values",
c),$("#organizer_form_field_"+b+" select").html(d)):"radios"==a.type||"centralised_radios"==a.type?(d=this.microTemplate(t+"organizer_admin_box_builder_radio_values_preview",c),$("#organizer_form_field_values_"+b).html(d)):"checkboxes"==a.type&&(d=this.microTemplate(t+"organizer_admin_box_builder_checkbox_values_preview",c),$("#organizer_form_field_values_"+b).html(d))}};g.loadFieldsList=function(b){var a={fields:this.getOrderedFields(b,!0,!0)},a=this.microTemplate(t+"organizer_form_builder_section",
a);$("#organizer_form_fields").html(a);this.selectedFieldId&&this.highlightField(this.selectedFieldId);var c=this;$("#organizer_form_fields div.form_field").on("click",function(){var a=$(this).data("id");c.tuix.fields[a]&&c.clickField(a)});var d;$("#organizer_form_fields div.form_field").hover(function(){var a=this;d||(d=setTimeout(function(){d=null;var c=$(a).data("id");$("#organizer_form_field_"+c+" .form_field_classes").show()},200))},function(){if(d)clearTimeout(d),d=null;else{var a=$(this).data("id");
a!=c.selectedFieldId&&$("#organizer_form_field_"+a+" .form_field_classes").hide()}});$("#organizer_form_fields").tooltip();$("#organizer_form_fields .form_section").sortable({items:"div.is_sortable",tolerance:"pointer",placeholder:"preview",receive:function(a,b){$(this).find("div.field_type, div.dataset_field").each(function(){var a=$(this).data("type"),b=$(this).data("id"),d=$(this).data("tab_name"),e=0.1,f=$(this).prev().data("id");f&&c.tuix.fields[f]?e=c.tuix.fields[f].ord+0.1:(f=$(this).next().data("id"))&&
c.tuix.fields[f]&&(e=c.tuix.fields[f].ord-0.1);c.addNewField(a,e,b,d);c.updateFieldOrds()})},start:function(a,b){c.startIndex=b.item.index()},stop:function(a,d){c.startIndex!=d.item.index()&&(c.tuix.items[b]._pageFieldsReordered=!0,c.updateFieldOrds(),c.loadFieldsList(b))}});$("#organizer_form_fields .delete_icon").on("click",function(a){a.stopPropagation();var b=$(this).data("id");if(c.tuix.fields[b]&&!c.saveCurrentOpenDetails(!0)){var d=c.tuix.fields[b];a={};for(var l in c.tuix.fields)if(m(c.tuix.fields,
l)){var k=c.tuix.fields[l];k.type==d.type&&l!=b&&(a[l]=k.name)}l={id:b,field_name:d.name,field_type:d.type,field_english_type:c.getFieldReadableType(d.type)};a={details:{dummy_field:JSON.stringify(a)}};x.open(t+"delete_form_field",l,p,a,function(a,d){"delete_field_but_migrate_data"==d.details.delete_field_options&&d.details.migration_field&&c.tuix.fields[d.details.migration_field]&&(c.tuix.fields[d.details.migration_field]._migrate_responses_from=b);c.deleteField(b)})}});$("#organizer_form_fields .duplicate_icon").on("click",
function(a){a.stopPropagation();var b=$(this).data("id");if(c.tuix.fields[b]&&!c.saveCurrentOpenDetails()){var d=c.tuix.fields[b];message='<p>Are you sure you want to duplicate the field "'+d.name+'"?</p>';u._flBo(message,"Duplicate","warning",!0,!1,function(){c.addNewField(d.type,d.ord+0.1,p,p,p,b);c.updateFieldOrds()})}});$("#organizer_form_fields .update_repeat_field_icon").on("click",function(a){a.stopPropagation();var b=$(this).data("id");c.tuix.fields[b]&&c.tuix.fields[b].dataset_field_id&&
!c.saveCurrentOpenDetails()&&(message="<p>Are you sure you want to update this dataset repeat field?</p>",u._flBo(message,"Update","warning",!0,!1,function(){var a=c.tuix.fields[b].dataset_field_id,d=!1,e;for(e in c.tuix.dataset_fields)if(c.tuix.dataset_fields[e].fields&&c.tuix.dataset_fields[e].fields[a]){d=c.tuix.dataset_fields[e].fields[a];break}if(d){a=[];e=[];for(var h in c.tuix.fields)if(m(c.tuix.fields,h)){var g=c.tuix.fields[h];g.dataset_repeat_grouping==d.id&&"repeat_end"!=g.type&&"repeat_start"!=
g.type&&a.push(h)}for(var p in d.fields)m(d.fields,p)&&(h=d.fields[p],"repeat_end"!=h.type&&e.push(h));e.sort(c.sortByOrd);p=c.tuix.fields[b].ord;for(h=0;h<e.length;h++){for(var g=!1,n=0;n<a.length;n++)if(e[h].id==c.tuix.fields[a[n]].dataset_field_id){c.tuix.fields[a[n]].ord=p+e[h].ord/1E3;g=!0;break}g||(e[h].dataset_repeat_grouping=d.id,c.addNewField(e[h].type,p+e[h].ord/1E3,!1,!1,e[h]))}for(h=0;h<a.length;h++){g=!1;for(n=0;n<e.length;n++)c.tuix.fields[a[h]].dataset_field_id==e[n].id&&(g=!0);g||
c.deleteField(a[h])}c.tuix.items[c.currentPageId]._pageFieldsReordered=!0;c.loadFieldsList(c.currentPageId);c.changeMadeToPanel()}}))})};g.updateFieldOrds=function(){var b=this;$("#organizer_form_fields div.form_field").each(function(a){var c=$(this).data("id");c&&(b.tuix.fields[c].ord=a+1)});this.changeMadeToPanel()};g.deletePage=function(b){var a=this.getOrderedPages(),c,d;if(2<=a.length)for(c=this.getOrderedFields(b),d=0;d<a.length;d++)if(a[d].id==b){if(a[d-1])for(d=a[d-1].id,a=0;a<c.length;a++)this.moveFieldToPage(b,
d,c[a].id);else for(d=a[d+1].id,a=c.length-1;0<=a;a--)this.moveFieldToPage(b,d,c[a].id,!0);this.deletedPages.push(b);delete this.tuix.items[b];this.clickPage(d);this.changeMadeToPanel();break}};g.deleteField=function(b){pageId=this.currentPageId;if(this.tuix.fields[b]){this.changeMadeToPanel();this.deletedFields.push(b);var a=this.tuix.fields[b];if("repeat_start"==a.type){var c=this.getMatchingRepeatEnd(b);c&&(this.deletedFields.push(c),delete this.tuix.items[pageId].fields[c],delete this.tuix.fields[c])}if(a.dataset_repeat_grouping)for(var c=
this.getOrderedFields(pageId),d=0;d<c.length;d++)c[d].dataset_repeat_grouping&&c[d].dataset_repeat_grouping==a.dataset_repeat_grouping&&"repeat_start"!=c[d].type&&(this.deletedFields.push(c[d].id),delete this.tuix.items[pageId].fields[c[d].id],delete this.tuix.fields[c[d].id]);for(var c=this.getOrderedFields(pageId),e=!1,f=!1,d=0;d<c.length;d++)if(c[d].id==a.id&&(e=d),!1!==e)if(0<e){f=c[e-1].id;break}else if(b!=c[d].id){f=c[d].id;break}f&&"repeat_end"==this.tuix.fields[f].type&&(f=!1);delete this.tuix.items[pageId].fields[b];
delete this.tuix.fields[b];this.loadFieldsList(pageId);f?this.clickField(f):this.loadNewFieldsPanel()}};g.addNewField=function(b,a,c,d,e,f,g){var l="t"+this.maxNewCustomField++,k=!1;if(e||c&&this.tuix.dataset_fields[d]&&this.tuix.dataset_fields[d].fields[c]){if(e||(e=this.tuix.dataset_fields[d].fields[c]),k={type:e.type,name:e.label,field_label:e.label,dataset_field_id:e.id,values_source:e.values_source,values_source_filter:e.values_source_filter,db_column:e.db_column},e.dataset_repeat_grouping&&
(k.dataset_repeat_grouping=e.dataset_repeat_grouping),e.lov&&(k.lov=e.lov),"repeat_start"==e.type){k.dataset_repeat_grouping=e.id;d=[];for(var h in e.fields)if(m(e.fields,h)){var s=e.fields[h];d.push(s)}d.sort(this.sortByOrd);for(h=0;h<d.length;h++)s=d[h],s.dataset_repeat_grouping=e.id,this.addNewField(s.type,a+0.001*(h+1),p,p,s)}}else if(b)if(k={type:b,field_label:"Untitled",name:"Untitled "+this.getFieldReadableType(b).toLowerCase()},"checkboxes"==b||"radios"==b||"select"==b)for(k.lov={},h=1;3>=
h;h++)this.addFieldValue(k,"Option "+h);else"repeat_start"==b&&this.addNewField("repeat_end",a+0.001);for(var r in this.tuix.field_details.tabs)if(m(this.tuix.field_details.tabs,r)&&(page=this.tuix.field_details.tabs[r],page.fields))for(var n in page.fields)m(page.fields,n)&&(d=page.fields[n],d.value!==p&&k[n]===p&&(k[n]=d.value));if(k){if(f&&(k=JSON.parse(JSON.stringify(this.tuix.fields[f])),"checkboxes"==k.type||"select"==k.type||"radios"==k.type)){f=k.lov;delete k.lov;k.lov={};for(var t in f)this.addFieldValue(k,
f[t].label,f[t].ord)}k.ord=a;k._is_new=!0;k.just_added=!0;k.id=l;if("page_break"==b)b=this.getOrderedPages(),k.name="Page "+(b.length+1),k.fields={},this.tuix.items[l]=k,g||this.clickPage(l,!0);else if(this.tuix.items[this.currentPageId].fields[l]=1,this.tuix.fields[l]=k,!e||c)this.loadFieldsList(this.currentPageId),g||this.clickField(l)}};g.clickField=function(b){this.selectedFieldId!=b&&this.tuix.fields[b]&&"repeat_end"!=this.tuix.fields[b].type&&!this.saveCurrentOpenDetails()&&(this.highlightField(b),
this.selectedFieldId=b,this.selectedDetailsPage=this.selectedPageId=!1,this.loadFieldDetailsPanel(b))};g.saveCurrentOpenDetails=function(b){var a=!1;this.selectedFieldId&&this.tuix.fields[this.selectedFieldId]?(a=$("#field__name"),a.length&&(this.tuix.fields[this.selectedFieldId].name=a.val()),b?a=this.getDeleteFieldErrors(this.selectedFieldId):(b=this.tuix.fields[this.selectedFieldId],a=this.saveItemTUIXPage("field_details",this.selectedDetailsPage,b)),_._isEm(a)||this.loadFieldDetailsPage(this.selectedDetailsPage,
this.selectedFieldId,a)):this.selectedPageId&&this.tuix.items[this.selectedPageId]&&(a=$("#field__name"),a.length&&(this.tuix.items[this.selectedPageId].name=a.val()),b=this.tuix.items[this.selectedPageId],a=this.saveItemTUIXPage("field_details",this.selectedDetailsPage,b),_._isEm(a)||this.loadPageDetailsPage(this.selectedDetailsPage,this.selectedPageId,a));return!_._isEm(a)};g.displayPageFieldStructureErrors=function(b){var a=[],c=this.getOrderedFields(b),d=!1,e,f="checkbox checkboxes date radios centralised_radios select centralised_select text textarea url attachment section_description calculated group".split(" ");
for(b=0;b<c.length;b++)e=c[b],"repeat_start"!=e.type||d?"repeat_end"==e.type?d?d=!1:a.push("Repeat ends must be placed after repeat starts."):d&&-1==f.indexOf(e.type)&&a.push('Field type "'+this.getFieldReadableType(e.type).toLowerCase()+'" is not allowed in a repeat block.'):d=!0;c=0<a.length;d=$("#organizer_fields_error");d.html("");for(b=0;b<a.length;b++)d.append('<p class="error">'+a[b]+"</p>");d.toggle(c);return c};g.getDeleteFieldErrors=function(b){var a={},c,d;for(c in this.tuix.fields)if(m(this.tuix.fields,
c)&&(d=this.tuix.fields[c],b!=c)){var e=!1;if("calculated"==d.type&&d.calculation_code)for(var f in d.calculation_code)if(m(d.calculation_code,f)){var g=d.calculation_code[f];if("field"==g.type&&g.value==b){e=!0;break}}if(d.visibility&&"visible_on_condition"==d.visibility&&d.visible_condition_field_id==b||d.readonly_or_mandatory&&"conditional_mandatory"==d.readonly_or_mandatory&&d.mandatory_condition_field_id==b||e)a[c]='Unable to delete field because the field "'+d.name+'" depends on it.'}return a};
g.validateFieldDetails=function(b,a,c,d,e){var f,g;if("field_details"==c)if(a.name||(e.name="Please enter a name for this form field."),"details"==d){if("checkbox"==a.type||"group"==a.type)a.field_label||(e.field_label="Please enter a label for this checkbox.");else if("repeat_start"==a.type){if(!a.min_rows)e.min_rows="Please enter the minimum rows.";else if(+a.min_rows!=a.min_rows)e.min_rows="Please a valid number for mininum rows.";else if(1>a.min_rows||10<a.min_rows)e.min_rows="Mininum rows must be between 1 and 10.";
if(!a.max_rows)e.max_rows="Please enter the maximum rows.";else if(+a.max_rows!=a.max_rows)e.max_rows="Please a valid number for maximum rows.";else if(1>a.max_rows||20<a.max_rows)e.max_rows="Maximum rows must be between 1 and 20.";!e.min_rows&&!e.max_rows&&+a.min_rows>+a.max_rows&&(e.min_rows="Minimum rows cannot be greater than maximum rows.")}else"restatement"==a.type?a.restatement_field||(e.restatement_field="Please select the field to mirror."):"centralised_radios"!=a.type&&"centralised_select"!=
a.type||a.values_source||(e.values_source="Please select a values source.");a.visibility&&"visible_on_condition"==a.visibility&&(a.visible_condition_field_id?a.visible_condition_field_value||(f=this.getField(a.visible_condition_field_id))&&-1!=["checkbox","group"].indexOf(f.type)&&(e.visible_condition_field_value="Please select a visible on condition form field value."):e.visible_condition_field_id="Please select a visible on conditional form field.");a.readonly_or_mandatory&&(("mandatory"!=a.readonly_or_mandatory&&
"conditional_mandatory"!=a.readonly_or_mandatory&&"mandatory_if_visible"!=a.readonly_or_mandatory||a.required_error_message||(e.required_error_message="Please enter an error message when this field is incomplete."),"mandatory"==a.readonly_or_mandatory)?"hidden"==a.visibility?e.readonly_or_mandatory="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&(e.readonly_or_mandatory="This field is always mandatory but is conditionally visible. You must change this field to be either visible all the time or conditionally mandatory with the same condition as it's visibility."):
"conditional_mandatory"==a.readonly_or_mandatory&&(a.mandatory_condition_field_id?a.mandatory_condition_field_value||(f=this.getField(a.mandatory_condition_field_id))&&-1!=["checkbox","group"].indexOf(f.type)&&(e.mandatory_condition_field_value="Please select a mandatory on condition form field value."):e.mandatory_condition_field_id="Please select a mandatory on condition form field.","hidden"==a.visibility?e.visibility="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&
"conditional_mandatory"==a.readonly_or_mandatory&&a.visible_condition_field_id&&a.mandatory_condition_field_id&&(a.visible_condition_field_id!=a.mandatory_condition_field_id||"visible_if"==a.visible_condition_field_type&&"mandatory_if_not"==a.mandatory_condition_field_type||"visible_if_not"==a.visible_condition_field_type&&"mandatory_if"==a.mandatory_condition_field_type||(f=this.getField(a.mandatory_condition_field_id))&&"checkboxes"!=f.type&&a.visible_condition_field_value!=a.mandatory_condition_field_value||
"checkboxes"==f.type&&(a.visible_condition_checkboxes_operator!=a.mandatory_condition_checkboxes_operator||!_._isEq(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value)))&&(e.visibility="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")));a.field_validation&&"none"!=a.field_validation&&!a.field_validation_error_message&&(e.field_validation_error_message="Please enter a validation error message for this field.");
if("text"==a.type&&a.field_validation&&-1==["number","integer","floating_point"].indexOf(a.field_validation))for(g in this.tuix.fields)if(m(this.tuix.fields,g)&&(b=this.tuix.fields[g],"calculated"==b.type&&b.calculation_code))for(c=0;c<b.calculation_code.length;c++)if("field"==b.calculation_code[c].type&&b.calculation_code[c].value==a.id){e.field_validation='The field "'+b.name+'" requires this field to be numeric. You must first remove this from that field.';break}}else if("advanced"==d){a.default_value_options&&
("value"==a.default_value_options?a.default_value_lov||a.default_value_text||(e.default_value="Please enter a default value."):"method"==a.default_value_options&&(a.default_value_class_name||(e.default_value_class_name="Please enter a class name."),a.default_value_method_name||(e.default_value_method_name="Please enter the name of a static method.")));if(a.custom_code_name)for(g in this.tuix.fields)m(this.tuix.fields,g)&&(b=this.tuix.fields[g],g!=a.id&&a.custom_code_name==b.custom_code_name&&(e.custom_code_name=
"Another field already has that code name on this form."));a.autocomplete&&("method"==a.autocomplete_options?(a.autocomplete_class_name||(e.autocomplete_class_name="Please enter a class name."),a.autocomplete_method_name||(e.autocomplete_method_name="Please enter the name of a static method.")):"centralised_list"!=a.autocomplete_options||a.values_source||(e.values_source="Please select a value source for the autocomplete lists."));a.invalid_responses&&a.invalid_responses.length&&!a.invalid_field_value_error_message&&
(e.invalid_field_value_error_message="Please enter an error message when an invalid response is chosen.");"textarea"==a.type&&(a.word_count_max&&(+a.word_count_max!=a.word_count_max?e.word_count_max="Please a valid number for the max word count.":1>a.word_count_max&&(e.word_count_max="Word count must be greater than 0.")),a.word_count_min&&(+a.word_count_min!=a.word_count_min?e.word_count_min="Please a valid number for the min word count.":1>a.word_count_min&&(e.word_count_min="Word count must be greater than 0.")))}else"crm"==
d&&a.send_to_crm&&!a.field_crm_name&&(e.field_crm_name="Please enter a CRM field name.")};g.highlightField=function(b){$("#organizer_form_fields .form_field .form_field_classes").hide();$("#organizer_form_fields .form_field .form_field_inline_buttons").hide();$("#organizer_form_fields .form_field").removeClass("selected");b&&($("#organizer_form_field_"+b).addClass("selected"),$("#organizer_form_field_"+b+" .form_field_classes").show(),$("#organizer_form_field_"+b+" .form_field_inline_buttons").show())};
g.getFieldReadableType=function(b){switch(b){case "checkbox":return"Checkbox";case "checkboxes":return"Checkboxes";case "date":return"Date";case "editor":return"Editor";case "radios":return"Radios";case "centralised_radios":return"Centralised radios";case "select":return"Select";case "centralised_select":return"Centralised select";case "text":return"Text";case "textarea":return"Textarea";case "url":return"URL";case "attachment":return"Attachment";case "page_break":return"Page";case "section_description":return"Subheading";
case "calculated":return"Calculated";case "restatement":return"Mirror";case "repeat_start":return"Start of repeating section";case "repeat_end":return"End of repeating section";case "document_upload":return"Multi-upload";default:return"Unknown";case "group":return"Group";case "file_picker":return"File picker"}};g.getOrderedFields=function(b,a,c){var d=[],e=[],f={},g,l=!1;if(this.tuix.items[b]&&this.tuix.items[b].fields)for(g in this.tuix.items[b].fields)b=this.tuix.fields[g],b=_._cl(b),a&&(b.lov=
this.getOrderedFieldValues(g,!0)),b.dataset_field_id&&(b._hideDuplicateButton=!0),c&&b.dataset_repeat_grouping?(f[b.dataset_repeat_grouping]||(f[b.dataset_repeat_grouping]={},f[b.dataset_repeat_grouping]._fields=[]),"repeat_start"!=b.type&&(b._hideDragButton=!0,b._hideDeleteButton=!0,b._hideDuplicateButton=!0),e.push(b)):(b._isSortable=!0,d.push(b));if(0<e.length)for(a=0;a<e.length;a++)f[e[a].dataset_repeat_grouping]._fields.push(e[a]);for(groupName in f)m(f,groupName)&&(group=f[groupName],group._fields.sort(this.sortByOrd),
group._fields.length&&(group.ord=group._fields[0].ord,group._isSortable=!0,d.push(group)));d.sort(this.sortByOrd);for(a=0;a<d.length;a++)"repeat_start"==d[a].type?l=!0:"repeat_end"==d[a].type?l=!1:l&&(d[a]._inRepeat=!0);return d};g.getOrderedFieldValues=function(b,a){var c=[],d,e;if(this.tuix.fields[b]&&this.tuix.fields[b].lov){for(d in this.tuix.fields[b].lov)m(this.tuix.fields[b].lov,d)&&(e=this.tuix.fields[b].lov[d],c.push(e));d=this.tuix.fields[b].type;!a||"select"!=d&&"centralised_select"!=d||
c.push({id:"empty_value",label:"-- Select --",ord:-1})}c.sort(this.sortByOrd);return c};g.sortErrors=function(b){var a=[],c;for(c in b)m(b,c)&&a.push(b[c]);return a};g.sortLanguages=function(b){var a=[],c;for(c in b)m(b,c)&&a.push(b[c]);return a};g.getOrderedDatasetPagesAndFields=function(){var b=[],a={},c;for(c in this.tuix.fields)if(m(this.tuix.fields,c)){var d=this.tuix.fields[c];d.dataset_field_id&&(a[d.dataset_field_id]=!0)}for(var e in this.tuix.dataset_fields)if(m(this.tuix.dataset_fields,
e)){c=this.tuix.dataset_fields[e];d=_._cl(c);d.fields=[];if(c.fields){for(var f in c.fields)if(m(c.fields,f)){var g=c.fields[f];g.readableType=this.getFieldReadableType(g.type);a[f]||d.fields.push(g)}d.fields.sort(this.sortByOrd)}b.push(d)}b.sort(this.sortByOrd);return b};g.changeMadeToPanel=function(){this.changeDetected||(this.changeDetected=!0,y.onbeforeunload=function(){return"You are currently editing this form. If you leave now you will lose any unsaved changes."},v._dI("Please either save your changes, or click Reset to discard them, before exiting the form editor."),
v._sB())};g.saveChanges=function(){var b=this,a={mode:"save",pages:JSON.stringify(this.tuix.items),fields:JSON.stringify(this.tuix.fields),pagesReordered:this.pagesReordered,deletedPages:JSON.stringify(this.deletedPages),deletedFields:JSON.stringify(this.deletedFields),deletedValues:JSON.stringify(this.deletedValues),currentPageId:this.currentPageId};this.selectedPageId&&(a.selectedPageId=this.selectedPageId);this.selectedFieldId&&(a.selectedFieldId=this.selectedFieldId);u._nDS("saving",!0);this.sendAJAXRequest(a).after(function(a){if(a){a=
JSON.parse(a);if(a.errors){for(var d="",e=0;e<a.errors.length;e++)d+=a.errors[e]+"<br>";d&&u._flBo(d)}b.currentPageId=a.currentPageId;b.selectedPageId=a.selectedPageId;b.selectedFieldId=a.selectedFieldId}u._nDS();y.onbeforeunload=!1;v._eI();b.changeDetected=!1;b.changesSaved=!0;v._r()})}},zenarioO.panelTypes);
