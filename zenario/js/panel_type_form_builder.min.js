zenario.lib(function(q,g,C,y,D,E,F,t,G,x,H,v,I,w,J,K,L,M,N,A,B,n,z){g=B(z.form_builder=A(z.form_builder_base_class));g.showPanel=function(b,a,d){b.html("").hide();d.html("").show();this.sortOutItems();b=this.loadPanelHTML();a.html(b).show();_._isEm(this.tuix.items)&&this.addNewPage(!0);this.currentPageId||(a=this.getOrderedPages(),0<a.length&&(this.currentPageId=a[0].id));this.pagesReordered=!1;this.deletedPages=[];this.deletedFields=[];this.deletedValues=[];this.changeDetected=!1;this.maxNewCustomFieldValue=
this.maxNewCustomField=1;this.selectedDetailsPage=this.selectedDetailsPage?this.selectedDetailsPage:!1;this.selectedFieldId=this.selectedFieldId?this.selectedFieldId:!1;this.selectedPageId=this.selectedPageId?this.selectedPageId:!1;this.loadPagesList(this.currentPageId);this.loadFieldsList(this.currentPageId);this.selectedFieldId?this.loadFieldDetailsPanel(this.selectedFieldId,!0):this.selectedPageId?this.loadPageDetailsPanel(this.selectedPageId,!0):this.loadNewFieldsPanel(!0);this.changesSaved&&
(this.changesSaved=!1,t._t({message_type:"success",message:"Your changes have been saved!"}))};g.sortOutItems=function(){var b,a,d;for(a in this.tuix.fields)n(this.tuix.fields,a)&&(d=this.tuix.fields[a],d.invalid_responses&&(d.invalid_responses=_._tA(d.invalid_responses)),d.visible_condition_checkboxes_field_value&&(d.visible_condition_checkboxes_field_value=_._tA(d.visible_condition_checkboxes_field_value)),d.mandatory_condition_checkboxes_field_value&&(d.mandatory_condition_checkboxes_field_value=
_._tA(d.mandatory_condition_checkboxes_field_value)));for(b in this.tuix.items)n(this.tuix.items,b)&&(a=this.tuix.items[b],a.visible_condition_checkboxes_field_value&&(a.visible_condition_checkboxes_field_value=_._tA(a.visible_condition_checkboxes_field_value)),a.mandatory_condition_checkboxes_field_value&&(a.mandatory_condition_checkboxes_field_value=_._tA(a.mandatory_condition_checkboxes_field_value)))};g.loadPanelHTML=function(){return this.microTemplate("zenario_organizer_form_builder",{form_title:this.tuix.form_title})};
g.loadPageDetailsPanel=function(b,a){var d=this;d.loadFieldDetailsPanel(b,a,!0);var c,e,f,m;$("#field__name").on("keyup",function(){c=d.getPageLabel($(this).val());$("#organizer_form_tab_"+b+" span").text(c)});$("#organizer_remove_form_tab").on("click",function(a){if(e=d.tuix.items[b])f="<p>Are you sure you want to delete this page?</p>",m=d.getOrderedFields(b),m.length&&(f+="<p>All fields on this page will be moved onto the previous page.</p>"),t._flBo(f,"Delete","warning",!0,!1,function(){d.deletePage(b)})})};
g.loadFieldDetailsPanel=function(b,a,d){var c=this,e;d?(e=c.tuix.items[b],e.type="page_break"):e=c.tuix.fields[b];var f=c.getFieldReadableType(e.type);e.dataset_field_id&&(f+=", linked field \u2192 "+e.db_column);d={mode:"field_details",name:e.name,type:e.type,typePhrase:f,just_added:e.just_added,hide_tab_bar:c.tuix.field_details.hide_tab_bar,is_tab:d};e.dataset_field_id&&(d.type+=", dataset field",e.db_column&&(d.type+=" ("+e.db_column+")"));d=c.microTemplate("zenario_organizer_form_builder_left_panel",
d);d=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(d);a||d.hide().show("drop",{direction:"left"},200);a=c.sortAndLoadTUIXPages(c.tuix.field_details.tabs,e,c.selectedDetailsPage);d=c.getTUIXPagesHTML(a);$("#organizer_field_details_tabs").html(d);$("#organizer_field_details_tabs .tab").on("click",function(){var a=$(this).data("name");a&&a!=c.selectedDetailsPage&&(c.saveCurrentOpenDetails()||c.loadFieldDetailsPage(a,b))});c.loadFieldDetailsPage(c.selectedDetailsPage,
b);$("#organizer_field_details_inner span.add_new_field").on("click",function(){c.saveCurrentOpenDetails()||(c.highlightField(!1),c.loadNewFieldsPanel())});$("#zenario_field_details_header_content .edit_field_name_button").on("click",function(){$("#zenario_field_details_header_content .view_mode").hide();$("#zenario_field_details_header_content .edit_mode").show()});$("#zenario_field_details_header_content .done_field_name_button").on("click",function(){$("#zenario_field_details_header_content .edit_mode").hide();
$("#zenario_field_details_header_content .view_mode").show();var a=$('#zenario_field_details_header_content .edit_mode input[name="name"]').val();e.name=a;$("#zenario_field_details_header_content .view_mode h5").text(a)});$("#field__name").on("keyup",function(){c.changeMadeToPanel()});$("input.form_settings").on("click",function(){c.openFormSettings()})};g.openFormSettings=function(){var b=this;x.open("zenario_user_form",{id:v.pi.refiner.id},q,q,function(a,d){var c="";d.details.show_title&&(c=d.details.title);
b.tuix.title=c;$("#organizer_form_builder .form_outer .form_header h5").text(c)})};g.loadPageDetailsPage=function(b,a,d){this.loadFieldDetailsPage(b,a,d)};g.loadFieldDetailsPage=function(b,a,d){var c=this,e;c.selectedDetailsPage=b;if(c.selectedFieldId&&c.tuix.fields[a])e=c.tuix.fields[a];else if(c.selectedPageId&&c.tuix.items[a]){e=c.tuix.items[a];for(var f=c.getOrderedPages(),m=0;m<f.length;m++)if(f[m].id==e.id){m!=f.length-1||c.tuix.form_enable_summary_page||(e.visibility="visible");break}}var f=
c.tuix.field_details.tabs[b].fields,l=c.loadFields("field_details/"+b,f,e),l=c.formatFieldDetails(l,e,"field",b),k=c.sortFields(l,e),f="";if(!_._isEm(d))for(d=c.sortErrors(d),m=0;m<d.length;m++)f+='<p class="error">'+d[m]+"</p>";f+=c.getTUIXFieldsHTML(k);$("#organizer_field_details").html(f);$("#organizer_field_details_tabs .tab").removeClass("on");$("#field_tab__"+b).addClass("on");_._isEm(d)||$("#organizer_field_details_form").effect({effect:"bounce",duration:125,direction:"right",times:2,distance:5,
mode:"effect"});if("details"==b)if($("#field__field_label").on("keyup",function(){$("#organizer_form_field_"+a+" .label").text($(this).val());e.just_added&&$("#field__name").val($(this).val().r(/:/g,""))}),$("#field__note_to_user").on("keyup",function(){var b=$(this).val().trim();$("#organizer_form_field_note_below_"+a+" div.zenario_note_content").text(b);$("#organizer_form_field_note_below_"+a).toggle(""!==b)}),"text"==e.type||"textarea"==e.type)$("#field__placeholder").on("keyup",function(){$("#organizer_form_field_"+
a+" :input").prop("placeholder",$(this).val())});else if("section_description"==e.type)$("#field__description").on("keyup",function(){$("#organizer_form_field_"+a+" .description").text($(this).val())});else{if("calculated"==e.type)$("#edit_field_calculation").on("click",function(){var b={},d;for(d in c.tuix.fields)if(n(c.tuix.fields,d)){var f=c.tuix.fields[d];if("text"==f.type&&-1!=["number","integer","floating_point"].indexOf(f.field_validation)||"calculated"==f.type&&a!=d)b[d]={label:f.name,ord:f.ord}}d=
{id:a,title:'Editing the calculation for the field "'+e.name+'"',calculation_code:JSON.stringify(e.calculation_code)};b={details:{dummy_field:JSON.stringify(b)}};x.open("zenario_field_calculation",d,q,b,function(b,d){e.calculation_code=d.details.calculation_code?JSON.parse(d.details.calculation_code):"";c.changeMadeToPanel();c.saveCurrentOpenDetails();c.loadFieldDetailsPage("details",a)})})}else if("advanced"==b)$("#field__css_classes").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .css").toggle(!!$(this).val()).prop("title",
$(this).val())}),$("#field__div_wrap_class").on("keyup",function(){$("#organizer_form_field_"+a+" .form_field_classes .div").toggle(!!$(this).val()).prop("title",$(this).val())});else if("values"==b)l.values&&!l.values._hidden&&(m=c.getOrderedFieldValues(a),f=c.microTemplate("zenario_organizer_admin_box_builder_field_value",m),$("#field_values_list").html(f).sortable({containment:"parent",tolerance:"pointer",axis:"y",start:function(a,b){c.startIndex=b.item.index()},stop:function(b,d){c.startIndex!=
d.item.index()&&(c.saveFieldListOfValues(c.tuix.fields[a]),c.loadFieldValuesListPreview(a),c.changeMadeToPanel())}}),$("#field_values_list input").on("keyup",function(){var a=$(this).data("id");$("#organizer_field_value_"+a+" label").text($(this).val());c.changeMadeToPanel()}),$("#organizer_add_a_field_value").on("click",function(){c.addFieldValue(e);c.saveItemTUIXPage("field_details",b,e);c.loadFieldDetailsPage(b,a);c.loadFieldValuesListPreview(a);c.changeMadeToPanel()}),$("#field_values_list .delete_icon").on("click",
function(){var d=$(this).data("id");e.lov[d]&&(c.deletedValues.push(d),delete e.lov[d]);c.saveItemTUIXPage("field_details",b,e);c.loadFieldDetailsPage(b,a);c.loadFieldValuesListPreview(a);c.changeMadeToPanel()}));else if("translations"==b){f=_._tA(c.tuix.field_details.tabs[b].translapagele_fields);d={};for(m=0;m<f.length;m++)d[f[m]]=!0;b="details";var f=c.tuix.field_details.tabs[b].fields,l=c.loadFields("field_details/"+b,f,e),l=c.formatFieldDetails(l,e,"field",b),k=c.sortFields(l,e),h=[];for(m in k)if(n(k,
m)){var r=k[m];d[r.id]&&!r._hidden&&h.push(r.id)}k=c.sortLanguages(c.tuix.languages);d=[];for(m in h)if(n(h,m)&&(r=h[m],l[r]&&!l[r]._hidden)){var g={};e._translations&&e._translations[r]&&(g=e._translations[r]);var p={};f[r]&&f[r].label&&(p.label=f[r].label);e[r]?p.value=e[r]:(p.value="(No text is defined in the default language)",p.disabled=!0);p.phrases=[];for(var s in k)if(n(k,s)){var u=k[s];parseInt(u.translate_phrases)&&p.phrases.push({field_column:r,language_id:u.id,language_name:u.english_name,
phrase:g.phrases&&g.phrases[u.id]&&!p.disabled?g.phrases[u.id]:"",disabled:p.disabled})}d.push(p)}f=c.microTemplate("zenario_organizer_form_builder_translatable_field",d);$("#organizer_field_translations").html(f);$("#organizer_field_translations input").on("keyup",function(){c.changeMadeToPanel()})}else if("crm"==b||"salesforce_api"==b){s="";"crm"==b?s="crm":"salesforce_api"==b&&(s="salesforce");f=s+"_value";$("#organizer_crm_button__set_labels").on("click",function(){c.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(b,
d){var e=$(this).data("id"),f="";c.tuix.fields[a].lov&&c.tuix.fields[a].lov[e]&&(f=c.tuix.fields[a].lov[e].label);$(this).val(f)})});$("#organizer_crm_button__set_values").on("click",function(){c.changeMadeToPanel();$("#organizer_field_crm_values input.crm_value_input").each(function(a,b){var c=$(this).data("id");$(this).val(c)})});l={values:[]};if("checkbox"==e.type||"group"==e.type){m={unchecked:{label:0,ord:1},checked:{label:1,ord:2}};if(e["_"+s+"_data"]&&e["_"+s+"_data"].values)for(h in e["_"+
s+"_data"].values)n(e["_"+s+"_data"].values,h)&&(k=e["_"+s+"_data"].values[h],m[h]&&w(k[s+"_value"])&&(m[h][s+"_value"]=k[s+"_value"]));for(h in m)n(m,h)&&(k=m[h],k.id=h,k.crm_value_name=f,l.values.push(k));l.values.sort(c.sortByOrd)}else for(h in m=c.getOrderedFieldValues(a),m)n(m,h)&&(k=m[h],k.crm_value_name=f,l.values.push(k));f=c.microTemplate("zenario_organizer_form_builder_crm_values",l);$("#organizer_field_crm_values").html(f);$("#organizer_field_crm_values input.crm_value_input").on("keyup",
function(){c.changeMadeToPanel()})}};g.calculationAdminBoxAddSomthing=function(b,a){var d=!1;switch(b){case "operation_addition":case "operation_subtraction":case "operation_multiplication":case "operation_division":case "parentheses_open":case "parentheses_close":d={type:b};break;case "static_value":""===a||isNaN(+a)||(d={type:b,value:+a},$("#static_value").val(""));break;case "field":d={type:b,value:a},$("#numeric_field").val("")}if(d){var c=[];$("#calculation_code").val()&&(c=JSON.parse($("#calculation_code").val()));
c.push(d);$("#calculation_code").val(JSON.stringify(c));this.calculationAdminBoxUpdateDisplay(c)}};g.calculationAdminBoxDelete=function(){var b=[];$("#calculation_code").val()&&(b=JSON.parse($("#calculation_code").val()))&&(b.pop(),$("#calculation_code").val(JSON.stringify(b)));this.calculationAdminBoxUpdateDisplay(b)};g.calculationAdminBoxUpdateDisplay=function(b){b=this.getCalculationCodeDisplay(b);$("#zenario_calculation_display").text(b)};g.getCalculationCodeDisplay=function(b){var a="",d,c,e,
f;if(b){d={};for(c in this.tuix.fields)n(this.tuix.fields,c)&&(e=this.tuix.fields[c],d[c]=e);c=!1;for(e=0;e<b.length;e++){c||"parentheses_close"==b[e].type?c&&(c=!1):a+=" ";switch(b[e].type){case "operation_addition":a+="+";break;case "operation_subtraction":a+="-";break;case "operation_multiplication":a+="\u00d7";break;case "operation_division":a+="\u00f7";break;case "parentheses_open":a+="(";c=!0;break;case "parentheses_close":a+=")";break;case "static_value":a+=b[e].value;break;case "field":f=
d[b[e].value]?d[b[e].value].name:"UNKNOWN FIELD",a+='"'+f+'"'}a=a.trim()}}return a};g.formatFieldDetails=function(b,a,d,c){if("field"==d)if("details"==c)if(a.dataset_field_id&&(b.values_source._disabled=!0,b.values_source_filter._readonly=!0,b.min_rows._readonly=!0,b.max_rows._readonly=!0),(d=b.values_source._value)&&this.tuix.centralised_lists.values[d]&&(d=this.tuix.centralised_lists.values[d],d.info.can_filter?b.values_source_filter.label=d.info.filter_label:b.values_source_filter._hidden=!0),
"visible_on_condition"==a.visibility&&a.visible_condition_field_id&&(d=this.getField(a.visible_condition_field_id))&&("checkboxes"==d.type?(b.visible_condition_checkboxes_field_value.values=d.lov,b.visible_condition_field_value._hidden=!0,b.visible_condition_checkboxes_operator._hidden=!1):"checkbox"!=d.type&&"group"!=d.type&&(b.visible_condition_field_value.empty_value="-- Any value --",b.visible_condition_field_value.values=d.lov,b.visible_condition_field_type.values=_._cl(b.visible_condition_field_type.values),
b.visible_condition_field_type.values.visible_if_one_of={label:"Visible if one of..."},"visible_if_one_of"==a.visible_condition_field_type&&(b.visible_condition_checkboxes_field_value.values=d.lov,b.visible_condition_field_value._hidden=!0))),"conditional_mandatory"==a.readonly_or_mandatory&&a.mandatory_condition_field_id&&(d=this.getField(a.mandatory_condition_field_id),"checkboxes"==d.type?(b.mandatory_condition_checkboxes_field_value.values=d.lov,b.mandatory_condition_field_value._hidden=!0,b.mandatory_condition_checkboxes_operator._hidden=
!1):(d&&"checkbox"!=d.type&&"group"!=d.type&&(b.mandatory_condition_field_value.values=d.lov,b.mandatory_condition_field_value.empty_value="-- Any value --"),b.mandatory_condition_checkboxes_field_value._hidden=!0)),"repeat_start"==a.type)b.field_label.label="Section heading:",b.field_label.note_below="This will be the heading at the start of the repeating section.";else if("calculated"==a.type)a.calculation_code&&(Array.isArray(a.calculation_code)||(a.calculation_code=$.map(a.calculation_code,function(a){return a})),
b.calculation_code._value=this.getCalculationCodeDisplay(a.calculation_code));else{if("page_break"==a.type)for(d=this.getOrderedPages(),c=0;c<d.length;c++)if(d[c].id==a.id){0==c?b.previous_button_text._hidden=!0:c!=d.length-1||this.tuix.form_enable_summary_page||(b.next_button_text._hidden=!0,b.visibility._disabled=!0);break}}else"advanced"==c&&("value"==a.default_value_options&&-1!=["radios","centralised_radios","select","centralised_select"].indexOf(a.type)&&(b.default_value_lov.values=a.lov),"select"==
a.type&&(b.default_value_options.label="Pre-select field:"));"page_break"==a.type&&this.loadPagesList(this.currentPageId);return b};g.getField=function(b){return this.tuix.fields[b]?this.tuix.fields[b]:!1};g.getFieldValuesList=function(b){var a=[],d=b.id,c=b.values,e=b._value,f=b._disabled,m=!1;if("object"==typeof c){var l=0,k;for(k in c)if(n(c,k)){var h=c[k],h={label:h.label,value:k,ord:w(h.ord)?h.ord:++l};a.push(h)}}else if("centralised_lists"==c){var l=0,g;for(g in this.tuix.centralised_lists.values)n(this.tuix.centralised_lists.values,
g)&&(c=this.tuix.centralised_lists.values[g],h={ord:++l,label:c.label,value:g},a.push(h))}else if("centralised_list_filter_fields"==c||"conditional_fields"==c||"mirror_fields"==c)for(k=this.getOrderedPages(),m=1<k.length,g=1,l=0;l<k.length;l++)for(var q=this.getOrderedFields(k[l].id),p=!1,s=k[l],u=0;u<q.length;u++)h=q[u],this.canAddFieldToList(c,h)&&(!1===p&&m&&(p=a.push({ord:g++,label:s.name,hasChildren:!0,options:[]})-1),h={ord:g++,label:h.name,value:h.id,parent:p},a.push(h));else if("field_lov"==
c&&this.tuix.fields[this.selectedFieldId]&&this.tuix.fields[this.selectedFieldId].lov)for(k in this.tuix.fields[this.selectedFieldId].lov)n(this.tuix.fields[this.selectedFieldId].lov,k)&&(h=this.tuix.fields[this.selectedFieldId].lov[k],h={ord:h.ord,label:h.label,value:k},a.push(h));for(var t in a)n(a,t)&&(h=a[t],"checkboxes"==b.type?e&&-1!=e.indexOf(h.value)&&(h.selected=!0):h.value==e&&(h.selected=!0),f&&(h.disabled=!0),h.name=d,h.path=b.path,m&&w(h.parent)&&(a[h.parent].options.push(h),delete a[t]));
a.sort(this.sortByOrd);return a};g.canAddFieldToList=function(b,a){return"centralised_list_filter_fields"==b?a.id!=this.selectedFieldId&&("centralised_select"==a.type||"text"==a.type&&a.autocomplete&&a.values_source):"conditional_fields"==b?a.id!=this.selectedFieldId&&-1!="checkbox group radios select centralised_radios centralised_select checkboxes".split(" ").indexOf(a.type):"mirror_fields"==b?a.id!=this.selectedFieldId&&-1!=["text","calculated","select","centralised_select"].indexOf(a.type):!1};
g.loadNewFieldsPanel=function(b){var a=this;a.selectedPageId=!1;a.selectedFieldId=!1;var d={mode:"new_fields",datasetTabs:a.getOrderedDatasetPagesAndFields(),link_to_dataset:a.tuix.link_to_dataset},d=a.microTemplate("zenario_organizer_form_builder_left_panel",d),d=$("#organizer_form_builder .form_fields_palette .form_fields_palette_outer").html(d);b||d.hide().show("drop",{direction:"right"},200);$("#organizer_field_type_list div.field_type, #organizer_centralised_field_type_list div.field_type, #organizer_linked_field_type_list div.dataset_field").draggable({connectToSortable:"#organizer_form_fields .form_section",
appendTo:"#organizer_form_builder",helper:"clone"});$("input.form_settings").on("click",function(){a.openFormSettings()})};g.loadPagesList=function(b){var a=this,d;for(d in a.tuix.items)if(n(a.tuix.items,d)){var c=a.tuix.items[d];b==d?c._selected=!0:delete c._selected}b=a.getOrderedPages();1>=b.length&&(b=!1);b=a.microTemplate("zenario_organizer_form_builder_tabs",{pages:b});$("#organizer_form_tabs").html(b);$("#organizer_form_tabs .tab").on("click",function(){var b=$(this).data("id");a.tuix.items[b]&&
a.clickPage(b)});$("#organizer_add_new_tab").on("click",function(){a.saveCurrentOpenDetails()||(a.addNewPage(),a.changeMadeToPanel())});$("#organizer_form_tabs").sortable({containment:"parent",tolerance:"pointer",items:"div.sort",start:function(b,c){a.startIndex=c.item.index()},stop:function(b,c){a.startIndex!=c.item.index()&&($("#organizer_form_tabs .tab.sort").each(function(b){var c=$(this).data("id");a.tuix.items[c].ord=b+1}),a.pagesReordered=!0,a.changeMadeToPanel(),a.selectedPageId&&(a.saveCurrentOpenDetails(),
a.loadPageDetailsPanel(a.selectedPageId,!0)))}});$("#organizer_form_tabs .tab").droppable({accept:"div.is_sortable:not(.repeat_end)",greedy:!0,hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(b,c){if(!a.saveCurrentOpenDetails()){var d=$(this).data("id"),l=$(c.draggable).data("id");a.moveFieldToPage(a.currentPageId,d,l);l==a.selectedFieldId&&a.loadNewFieldsPanel();a.loadFieldsList(a.currentPageId)}}})};g.moveFieldToPage=function(b,a,d,c){if(b!=a&&this.tuix.items[a]&&this.tuix.items[b]&&
this.tuix.items[b].fields[d]&&"repeat_end"!=this.tuix.fields[d].type){this.tuix.items[a]._pageFieldsReordered=!0;this.tuix.items[b]._pageFieldsReordered=!0;var e=1,f=this.getOrderedFields(a);f.length&&(e=c?f[0].ord-1:f[f.length-1].ord+1);"repeat_start"==this.tuix.fields[d].type&&(c=this.getMatchingRepeatEnd(d),this.tuix.fields[c].ord=e+0.001,this.tuix.items[a].fields[c]=1,delete this.tuix.items[b].fields[c]);this.tuix.fields[d].ord=e;this.tuix.items[a].fields[d]=1;delete this.tuix.items[b].fields[d];
this.changeMadeToPanel()}};g.addNewPage=function(b){var a=1,d=this.getOrderedPages();d.length&&(a=d[d.length-1].ord+1);this.addNewField("page_break",a,q,q,q,q,b)};g.clickPage=function(b,a){if(this.selectedPageId!=b){var d=this.saveCurrentOpenDetails(),c=this.displayPageFieldStructureErrors(this.currentPageId);d||c||(this.currentPageId==b?(this.selectedFieldId=!1,this.selectedPageId=b,this.selectedDetailsPage=!1,this.loadPageDetailsPanel(b)):this.clickPage2(b,a))}};g.clickPage2=function(b,a){this.currentPageId=
b;if(a)this.selectedPageId=b,this.loadPageDetailsPanel(b);else{var d=!1;this.selectedFieldId||this.selectedPageId||(d=!0);this.loadNewFieldsPanel(d)}this.selectedFieldId=!1;this.loadPagesList(b);this.loadFieldsList(b)};g.getOrderedPages=function(){var b=[],a,d;for(a in this.tuix.items)n(this.tuix.items,a)&&(d=this.tuix.items[a],b.push(d));b.sort(this.sortByOrd);return b};g.fieldDetailsChanged=function(b,a){var d=this;b=b.s("/");var c=b[0],e=b[1],f,m,l;e&&c&&d.tuix[c]&&d.tuix[c].tabs[e]&&d.tuix[c].tabs[e].fields[a]&&
(d.changeMadeToPanel(),f=d.tuix[c].tabs[e].fields[a],f.format_onchange&&"field_details"==c&&(l=d.selectedFieldId?d.tuix.fields[d.selectedFieldId]:d.tuix.items[d.selectedPageId],d.saveItemTUIXPage(c,d.selectedDetailsPage,l),"details"==e&&"field_validation"==a&&("email"==l.field_validation?l.field_validation_error_message="The email address you have entered is not valid, please enter a valid email address.":"URL"==l.field_validation?l.field_validation_error_message="Please enter a valid URL.":"number"==
l.field_validation?l.field_validation_error_message="Please enter a valid number.":"integer"==l.field_validation?l.field_validation_error_message="Please enter a valid integer.":"floating_point"==l.field_validation&&(l.field_validation_error_message="Please enter a valid floating point number.")),d.loadFieldDetailsPage(d.selectedDetailsPage,l.id),"details"==e&&("visibility"==a?(c=$("#field__visibility").val(),"hidden"==c?m="Hidden":"visible_on_condition"==c&&(m="Visible on condition"),$("#organizer_form_field_"+
d.selectedFieldId+" .form_field_classes .not_visible").toggle("visible"!=c).prop("title",m)):"readonly_or_mandatory"==a?(c=$("#field__readonly_or_mandatory").val(),"mandatory"==c?m="Mandatory":"conditional_mandatory"==c&&(m="Mandatory on condition"),$("#organizer_form_field_"+d.selectedFieldId+" .form_field_classes .mandatory").toggle("mandatory"==c||"conditional_mandatory"==c||"mandatory_if_visible"==c).prop("title",m)):"field_validation"==a?(c=$("#field__field_validation").val(),$("#organizer_form_field_"+
d.selectedFieldId+" .form_field_classes .validation").toggle("none"!=c)):"values_source"==a&&((m=$("#field__values_source").val())?(m={mode:"get_centralised_lov",method:m,filter:$("#field__values_source_filter").val()},d.sendAJAXRequest(m).after(function(a){l.lov=a;d.loadFieldValuesListPreview(d.selectedFieldId)})):(l.lov={},d.loadFieldValuesListPreview(d.selectedFieldId))))))};g.loadFieldValuesListPreview=function(b){if(this.tuix.fields[b]){var a=this.tuix.fields[b],d=this.getOrderedFieldValues(b,
!0),c=!1;"select"==a.type||"centralised_select"==a.type?(c=this.microTemplate("zenario_organizer_admin_box_builder_select_values",d),$("#organizer_form_field_"+b+" select").html(c)):"radios"==a.type||"centralised_radios"==a.type?(c=this.microTemplate("zenario_organizer_admin_box_builder_radio_values_preview",d),$("#organizer_form_field_values_"+b).html(c)):"checkboxes"==a.type&&(c=this.microTemplate("zenario_organizer_admin_box_builder_checkbox_values_preview",d),$("#organizer_form_field_values_"+
b).html(c))}};g.loadFieldsList=function(b){var a=this,d={fields:a.getOrderedFields(b,!0,!0)},d=a.microTemplate("zenario_organizer_form_builder_section",d);$("#organizer_form_fields").html(d);a.selectedFieldId&&a.highlightField(a.selectedFieldId);$("#organizer_form_fields div.form_field").on("click",function(){var b=$(this).data("id");a.tuix.fields[b]&&a.clickField(b)});var c;$("#organizer_form_fields div.form_field").hover(function(){c||(c=setTimeout(function(){c=null;var b=$(a).data("id");$("#organizer_form_field_"+
b+" .form_field_classes").show()},200))},function(){if(c)clearTimeout(c),c=null;else{var b=$(this).data("id");b!=a.selectedFieldId&&$("#organizer_form_field_"+b+" .form_field_classes").hide()}});$("#organizer_form_builder").tooltip();$("#organizer_form_fields .form_section").sortable({items:"div.is_sortable",tolerance:"pointer",placeholder:"preview",receive:function(b,c){$(this).find("div.field_type, div.dataset_field").each(function(){var b=$(this).data("type"),c=$(this).data("id"),d=$(this).data("tab_name"),
e=0.1,f=$(this).prev().data("id");f&&a.tuix.fields[f]?e=a.tuix.fields[f].ord+0.1:(f=$(this).next().data("id"))&&a.tuix.fields[f]&&(e=a.tuix.fields[f].ord-0.1);a.addNewField(b,e,c,d);a.updateFieldOrds()})},start:function(b,c){a.startIndex=c.item.index()},stop:function(c,d){a.startIndex!=d.item.index()&&(a.tuix.items[b]._pageFieldsReordered=!0,a.updateFieldOrds(),a.loadFieldsList(b))}});$("#organizer_form_fields .delete_icon").on("click",function(b){b.stopPropagation();var c=$(this).data("id");if(a.tuix.fields[c]&&
!a.saveCurrentOpenDetails(!0)){var d=a.tuix.fields[c];b={};for(var l in a.tuix.fields)if(n(a.tuix.fields,l)){var k=a.tuix.fields[l];k.type==d.type&&l!=c&&(b[l]=k.name)}l={id:c,field_name:d.name,field_type:d.type,field_english_type:a.getFieldReadableType(d.type)};b={details:{dummy_field:JSON.stringify(b)}};x.open("zenario_delete_form_field",l,q,b,function(b,d){"delete_field_but_migrate_data"==d.details.delete_field_options&&d.details.migration_field&&a.tuix.fields[d.details.migration_field]&&(a.tuix.fields[d.details.migration_field]._migrate_responses_from=
c);a.deleteField(c)})}});$("#organizer_form_fields .duplicate_icon").on("click",function(b){b.stopPropagation();var c=$(this).data("id");if(a.tuix.fields[c]&&!a.saveCurrentOpenDetails()){var d=a.tuix.fields[c];message='<p>Are you sure you want to duplicate the field "'+d.name+'"?</p>';t._flBo(message,"Duplicate","warning",!0,!1,function(){a.addNewField(d.type,d.ord+0.1,q,q,q,c);a.updateFieldOrds()})}});$("#organizer_form_fields .update_repeat_field_icon").on("click",function(b){b.stopPropagation();
var c=$(this).data("id");a.tuix.fields[c]&&a.tuix.fields[c].dataset_field_id&&!a.saveCurrentOpenDetails()&&(message="<p>Are you sure you want to update this dataset repeat field?</p>",t._flBo(message,"Update","warning",!0,!1,function(){var b=a.tuix.fields[c].dataset_field_id,d=!1,e;for(e in a.tuix.dataset_fields)if(a.tuix.dataset_fields[e].fields&&a.tuix.dataset_fields[e].fields[b]){d=a.tuix.dataset_fields[e].fields[b];break}if(d){b=[];e=[];for(var h in a.tuix.fields)if(n(a.tuix.fields,h)){var g=
a.tuix.fields[h];g.dataset_repeat_grouping==d.id&&"repeat_end"!=g.type&&"repeat_start"!=g.type&&b.push(h)}for(var q in d.fields)n(d.fields,q)&&(h=d.fields[q],"repeat_end"!=h.type&&e.push(h));e.sort(a.sortByOrd);q=a.tuix.fields[c].ord;for(h=0;h<e.length;h++){for(var g=!1,p=0;p<b.length;p++)if(e[h].id==a.tuix.fields[b[p]].dataset_field_id){a.tuix.fields[b[p]].ord=q+e[h].ord/1E3;g=!0;break}g||(e[h].dataset_repeat_grouping=d.id,a.addNewField(e[h].type,q+e[h].ord/1E3,!1,!1,e[h]))}for(h=0;h<b.length;h++){g=
!1;for(p=0;p<e.length;p++)a.tuix.fields[b[h]].dataset_field_id==e[p].id&&(g=!0);g||a.deleteField(b[h])}a.tuix.items[a.currentPageId]._pageFieldsReordered=!0;a.loadFieldsList(a.currentPageId);a.changeMadeToPanel()}}))})};g.updateFieldOrds=function(){var b=this;$("#organizer_form_fields div.form_field").each(function(a){var d=$(this).data("id");d&&(b.tuix.fields[d].ord=a+1)});b.changeMadeToPanel()};g.deletePage=function(b){var a=this.getOrderedPages(),d,c;if(2<=a.length)for(d=this.getOrderedFields(b),
c=0;c<a.length;c++)if(a[c].id==b){if(a[c-1])for(c=a[c-1].id,a=0;a<d.length;a++)this.moveFieldToPage(b,c,d[a].id);else for(c=a[c+1].id,a=d.length-1;0<=a;a--)this.moveFieldToPage(b,c,d[a].id,!0);this.deletedPages.push(b);delete this.tuix.items[b];this.clickPage(c);this.changeMadeToPanel();break}};g.deleteField=function(b){pageId=this.currentPageId;if(this.tuix.fields[b]){this.changeMadeToPanel();this.deletedFields.push(b);var a=this.tuix.fields[b];if("repeat_start"==a.type){var d=this.getMatchingRepeatEnd(b);
d&&(this.deletedFields.push(d),delete this.tuix.items[pageId].fields[d],delete this.tuix.fields[d])}if(a.dataset_repeat_grouping)for(var d=this.getOrderedFields(pageId),c=0;c<d.length;c++)d[c].dataset_repeat_grouping&&d[c].dataset_repeat_grouping==a.dataset_repeat_grouping&&"repeat_start"!=d[c].type&&(this.deletedFields.push(d[c].id),delete this.tuix.items[pageId].fields[d[c].id],delete this.tuix.fields[d[c].id]);for(var d=this.getOrderedFields(pageId),e=!1,f=!1,c=0;c<d.length;c++)if(d[c].id==a.id&&
(e=c),!1!==e)if(0<e){f=d[e-1].id;break}else if(b!=d[c].id){f=d[c].id;break}f&&"repeat_end"==this.tuix.fields[f].type&&(f=!1);delete this.tuix.items[pageId].fields[b];delete this.tuix.fields[b];this.loadFieldsList(pageId);f?this.clickField(f):this.loadNewFieldsPanel()}};g.addNewField=function(b,a,d,c,e,f,m){var g="t"+this.maxNewCustomField++,k=!1;if(e||d&&this.tuix.dataset_fields[c]&&this.tuix.dataset_fields[c].fields[d]){if(e||(e=this.tuix.dataset_fields[c].fields[d]),k={type:e.type,name:e.label,
field_label:e.label,dataset_field_id:e.id,values_source:e.values_source,values_source_filter:e.values_source_filter,db_column:e.db_column},e.dataset_repeat_grouping&&(k.dataset_repeat_grouping=e.dataset_repeat_grouping),e.lov&&(k.lov=e.lov),"repeat_start"==e.type){k.dataset_repeat_grouping=e.id;c=[];for(var h in e.fields)if(n(e.fields,h)){var r=e.fields[h];c.push(r)}c.sort(this.sortByOrd);for(h=0;h<c.length;h++)r=c[h],r.dataset_repeat_grouping=e.id,this.addNewField(r.type,a+0.001*(h+1),q,q,r)}}else if(b)if(k=
{type:b,field_label:"Untitled",name:"Untitled "+this.getFieldReadableType(b).toLowerCase()},"checkboxes"==b||"radios"==b||"select"==b)for(k.lov={},h=1;3>=h;h++)this.addFieldValue(k,"Option "+h);else"repeat_start"==b&&this.addNewField("repeat_end",a+0.001);for(var t in this.tuix.field_details.tabs)if(n(this.tuix.field_details.tabs,t)&&(page=this.tuix.field_details.tabs[t],page.fields))for(var p in page.fields)n(page.fields,p)&&(c=page.fields[p],w(c.value)&&!w(k[p])&&(k[p]=c.value));if(k){if(f&&(k=
JSON.parse(JSON.stringify(this.tuix.fields[f])),"checkboxes"==k.type||"select"==k.type||"radios"==k.type)){f=k.lov;delete k.lov;k.lov={};for(var s in f)this.addFieldValue(k,f[s].label,f[s].ord)}k.ord=a;k._is_new=!0;k.just_added=!0;k.id=g;if("page_break"==b)b=this.getOrderedPages(),k.name="Page "+(b.length+1),k.fields={},this.tuix.items[g]=k,m||this.clickPage(g,!0);else if(this.tuix.items[this.currentPageId].fields[g]=1,this.tuix.fields[g]=k,!e||d)this.loadFieldsList(this.currentPageId),m||this.clickField(g)}};
g.clickField=function(b){this.selectedFieldId!=b&&this.tuix.fields[b]&&"repeat_end"!=this.tuix.fields[b].type&&!this.saveCurrentOpenDetails()&&(this.highlightField(b),this.selectedFieldId=b,this.selectedDetailsPage=this.selectedPageId=!1,this.loadFieldDetailsPanel(b))};g.saveCurrentOpenDetails=function(b){var a=!1;this.selectedFieldId&&this.tuix.fields[this.selectedFieldId]?(a=$("#field__name"),a.length&&(this.tuix.fields[this.selectedFieldId].name=a.val()),b?a=this.getDeleteFieldErrors(this.selectedFieldId):
(b=this.tuix.fields[this.selectedFieldId],a=this.saveItemTUIXPage("field_details",this.selectedDetailsPage,b)),_._isEm(a)||this.loadFieldDetailsPage(this.selectedDetailsPage,this.selectedFieldId,a)):this.selectedPageId&&this.tuix.items[this.selectedPageId]&&(a=$("#field__name"),a.length&&(this.tuix.items[this.selectedPageId].name=a.val()),b=this.tuix.items[this.selectedPageId],a=this.saveItemTUIXPage("field_details",this.selectedDetailsPage,b),_._isEm(a)||this.loadPageDetailsPage(this.selectedDetailsPage,
this.selectedPageId,a));return!_._isEm(a)};g.displayPageFieldStructureErrors=function(b){var a=[],d=this.getOrderedFields(b),c=!1,e,f="checkbox checkboxes date radios centralised_radios select centralised_select text textarea url attachment section_description calculated group".split(" ");for(b=0;b<d.length;b++)e=d[b],"repeat_start"!=e.type||c?"repeat_end"==e.type?c?c=!1:a.push("Repeat ends must be placed after repeat starts."):c&&-1==f.indexOf(e.type)&&a.push('Field type "'+this.getFieldReadableType(e.type).toLowerCase()+
'" is not allowed in a repeat block.'):c=!0;d=0<a.length;c=$("#organizer_fields_error");c.html("");for(b=0;b<a.length;b++)c.append('<p class="error">'+a[b]+"</p>");c.toggle(d);return d};g.getDeleteFieldErrors=function(b){var a={},d,c;for(d in this.tuix.fields)if(n(this.tuix.fields,d)&&(c=this.tuix.fields[d],b!=d)){var e=!1;if("calculated"==c.type&&c.calculation_code)for(var f in c.calculation_code)if(n(c.calculation_code,f)){var g=c.calculation_code[f];if("field"==g.type&&g.value==b){e=!0;break}}if(c.visibility&&
"visible_on_condition"==c.visibility&&c.visible_condition_field_id==b||c.readonly_or_mandatory&&"conditional_mandatory"==c.readonly_or_mandatory&&c.mandatory_condition_field_id==b||e)a[d]='Unable to delete field because the field "'+c.name+'" depends on it.'}return a};g.validateFieldDetails=function(b,a,d,c,e){var f,g;if("field_details"==d)if(a.name||(e.name="Please enter a name for this form field."),"details"==c){if("checkbox"==a.type||"group"==a.type)a.field_label||(e.field_label="Please enter a label for this checkbox.");
else if("repeat_start"==a.type){if(!a.min_rows)e.min_rows="Please enter the minimum rows.";else if(+a.min_rows!=a.min_rows)e.min_rows="Please a valid number for mininum rows.";else if(1>a.min_rows||10<a.min_rows)e.min_rows="Mininum rows must be between 1 and 10.";if(!a.max_rows)e.max_rows="Please enter the maximum rows.";else if(+a.max_rows!=a.max_rows)e.max_rows="Please a valid number for maximum rows.";else if(1>a.max_rows||20<a.max_rows)e.max_rows="Maximum rows must be between 1 and 20.";!e.min_rows&&
!e.max_rows&&+a.min_rows>+a.max_rows&&(e.min_rows="Minimum rows cannot be greater than maximum rows.")}else"restatement"==a.type?a.restatement_field||(e.restatement_field="Please select the field to mirror."):"centralised_radios"!=a.type&&"centralised_select"!=a.type||a.values_source||(e.values_source="Please select a values source.");a.visibility&&"visible_on_condition"==a.visibility&&(a.visible_condition_field_id?a.visible_condition_field_value||(f=this.getField(a.visible_condition_field_id))&&
-1!=["checkbox","group"].indexOf(f.type)&&(e.visible_condition_field_value="Please select a visible on condition form field value."):e.visible_condition_field_id="Please select a visible on conditional form field.");a.readonly_or_mandatory&&(("mandatory"!=a.readonly_or_mandatory&&"conditional_mandatory"!=a.readonly_or_mandatory&&"mandatory_if_visible"!=a.readonly_or_mandatory||a.required_error_message||(e.required_error_message="Please enter an error message when this field is incomplete."),"mandatory"==
a.readonly_or_mandatory)?"hidden"==a.visibility?e.readonly_or_mandatory="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&(e.readonly_or_mandatory="This field is always mandatory but is conditionally visible. You must change this field to be either visible all the time or conditionally mandatory with the same condition as it's visibility."):"conditional_mandatory"==a.readonly_or_mandatory&&(a.mandatory_condition_field_id?a.mandatory_condition_field_value||(f=this.getField(a.mandatory_condition_field_id))&&
-1!=["checkbox","group"].indexOf(f.type)&&(e.mandatory_condition_field_value="Please select a mandatory on condition form field value."):e.mandatory_condition_field_id="Please select a mandatory on condition form field.","hidden"==a.visibility?e.visibility="A field cannot be mandatory while hidden.":"visible_on_condition"==a.visibility&&"conditional_mandatory"==a.readonly_or_mandatory&&a.visible_condition_field_id&&a.mandatory_condition_field_id&&(a.visible_condition_field_id!=a.mandatory_condition_field_id||
"visible_if"==a.visible_condition_field_type&&"mandatory_if_not"==a.mandatory_condition_field_type||"visible_if_not"==a.visible_condition_field_type&&"mandatory_if"==a.mandatory_condition_field_type||(f=this.getField(a.mandatory_condition_field_id))&&"checkboxes"!=f.type&&a.visible_condition_field_value!=a.mandatory_condition_field_value||"checkboxes"==f.type&&(a.visible_condition_checkboxes_operator!=a.mandatory_condition_checkboxes_operator||!_._isEq(a.visible_condition_checkboxes_field_value,a.mandatory_condition_checkboxes_field_value)))&&
(e.visibility="A field cannot be mandatory while hidden. If this field is both mandatory and visible on a condition, both fields and values must be the same.")));a.field_validation&&"none"!=a.field_validation&&!a.field_validation_error_message&&(e.field_validation_error_message="Please enter a validation error message for this field.");if("text"==a.type&&a.field_validation&&-1==["number","integer","floating_point"].indexOf(a.field_validation))for(g in this.tuix.fields)if(n(this.tuix.fields,g)&&(b=
this.tuix.fields[g],"calculated"==b.type&&b.calculation_code))for(d=0;d<b.calculation_code.length;d++)if("field"==b.calculation_code[d].type&&b.calculation_code[d].value==a.id){e.field_validation='The field "'+b.name+'" requires this field to be numeric. You must first remove this from this field.';break}}else if("advanced"==c){a.default_value_options&&("value"==a.default_value_options?a.default_value_lov||a.default_value_text||(e.default_value="Please enter a default value."):"method"==a.default_value_options&&
(a.default_value_class_name||(e.default_value_class_name="Please enter a class name."),a.default_value_method_name||(e.default_value_method_name="Please enter the name of a static method.")));if(a.custom_code_name)for(g in this.tuix.fields)n(this.tuix.fields,g)&&(b=this.tuix.fields[g],g!=a.id&&a.custom_code_name==b.custom_code_name&&(e.custom_code_name="Another field already has this code name on this form."));a.autocomplete&&("method"==a.autocomplete_options?(a.autocomplete_class_name||(e.autocomplete_class_name=
"Please enter a class name."),a.autocomplete_method_name||(e.autocomplete_method_name="Please enter the name of a static method.")):"centralised_list"!=a.autocomplete_options||a.values_source||(e.values_source="Please select a value source for the autocomplete lists."));a.invalid_responses&&a.invalid_responses.length&&!a.invalid_field_value_error_message&&(e.invalid_field_value_error_message="Please enter an error message when an invalid response is chosen.");"textarea"==a.type&&(a.word_count_max&&
(+a.word_count_max!=a.word_count_max?e.word_count_max="Please a valid number for the max word count.":1>a.word_count_max&&(e.word_count_max="Word count must be greater than 0.")),a.word_count_min&&(+a.word_count_min!=a.word_count_min?e.word_count_min="Please a valid number for the min word count.":1>a.word_count_min&&(e.word_count_min="Word count must be greater than 0.")))}else"crm"==c?a.send_to_crm&&!a.field_crm_name&&(e.field_crm_name="Please enter a CRM field name."):"salesforce_api"==c&&a.salesforce_send_to_crm&&
!a.salesforce_field_crm_name&&(e.salesforce_field_crm_name="Please enter a CRM field name.")};g.highlightField=function(b){$("#organizer_form_fields .form_field .form_field_classes").hide();$("#organizer_form_fields .form_field .form_field_inline_buttons").hide();$("#organizer_form_fields .form_field").removeClass("selected");b&&($("#organizer_form_field_"+b).addClass("selected"),$("#organizer_form_field_"+b+" .form_field_classes").show(),$("#organizer_form_field_"+b+" .form_field_inline_buttons").show())};
g.getFieldReadableType=function(b){switch(b){case "checkbox":return"Checkbox";case "checkboxes":return"Checkboxes";case "date":return"Date";case "editor":return"Editor";case "radios":return"Radios";case "centralised_radios":return"Centralised radios";case "select":return"Select";case "centralised_select":return"Centralised select";case "text":return"Text";case "textarea":return"Textarea";case "url":return"URL";case "attachment":return"Attachment";case "page_break":return"Page";case "section_description":return"Subheading";
case "calculated":return"Calculated";case "restatement":return"Mirror";case "repeat_start":return"Start of repeating section";case "repeat_end":return"End of repeating section";case "document_upload":return"Multi-upload";default:return"Unknown";case "group":return"Group";case "file_picker":return"File picker"}};g.getOrderedFields=function(b,a,d){var c=[],e=[],f={},g,l=!1;if(this.tuix.items[b]&&this.tuix.items[b].fields)for(g in this.tuix.items[b].fields)b=this.tuix.fields[g],b=_._cl(b),a&&(b.lov=
this.getOrderedFieldValues(g,!0)),b.dataset_field_id&&(b._hideDuplicateButton=!0),d&&b.dataset_repeat_grouping?(f[b.dataset_repeat_grouping]||(f[b.dataset_repeat_grouping]={},f[b.dataset_repeat_grouping]._fields=[]),"repeat_start"!=b.type&&(b._hideDragButton=!0,b._hideDeleteButton=!0,b._hideDuplicateButton=!0),e.push(b)):(b._isSortable=!0,c.push(b));if(0<e.length)for(a=0;a<e.length;a++)f[e[a].dataset_repeat_grouping]._fields.push(e[a]);for(groupName in f)n(f,groupName)&&(group=f[groupName],group._fields.sort(this.sortByOrd),
group._fields.length&&(group.ord=group._fields[0].ord,group._isSortable=!0,c.push(group)));c.sort(this.sortByOrd);for(a=0;a<c.length;a++)"repeat_start"==c[a].type?l=!0:"repeat_end"==c[a].type?l=!1:l&&(c[a]._inRepeat=!0);return c};g.getOrderedFieldValues=function(b,a){var d=[],c,e;if(this.tuix.fields[b]&&this.tuix.fields[b].lov){for(c in this.tuix.fields[b].lov)n(this.tuix.fields[b].lov,c)&&(e=this.tuix.fields[b].lov[c],d.push(e));c=this.tuix.fields[b].type;!a||"select"!=c&&"centralised_select"!=c||
d.push({id:"empty_value",label:"-- Select --",ord:-1})}d.sort(this.sortByOrd);return d};g.sortErrors=function(b){var a=[],d;for(d in b)n(b,d)&&a.push(b[d]);return a};g.sortLanguages=function(b){var a=[],d;for(d in b)n(b,d)&&a.push(b[d]);return a};g.getOrderedDatasetPagesAndFields=function(){var b=[],a={},d;for(d in this.tuix.fields)if(n(this.tuix.fields,d)){var c=this.tuix.fields[d];c.dataset_field_id&&(a[c.dataset_field_id]=!0)}for(var e in this.tuix.dataset_fields)if(n(this.tuix.dataset_fields,
e)){d=this.tuix.dataset_fields[e];c=_._cl(d);c.fields=[];if(d.fields){for(var f in d.fields)if(n(d.fields,f)){var g=d.fields[f];g.readableType=this.getFieldReadableType(g.type);g.tab_label=d.label?d.label:d.default_label;a[f]||c.fields.push(g)}c.fields.sort(this.sortByOrd)}b.push(c)}b.sort(this.sortByOrd);return b};g.changeMadeToPanel=function(){this.changeDetected||(this.changeDetected=!0,y.onbeforeunload=function(){return"You are currently editing this form. If you leave now you will lose any unsaved changes."},
v._dI("Please either save your changes, or click Reset to discard them, before exiting the form editor."),v._sB())};g.saveChanges=function(){var b=this,a={mode:"save",pages:JSON.stringify(b.tuix.items),fields:JSON.stringify(b.tuix.fields),pagesReordered:b.pagesReordered,deletedPages:JSON.stringify(b.deletedPages),deletedFields:JSON.stringify(b.deletedFields),deletedValues:JSON.stringify(b.deletedValues),currentPageId:b.currentPageId};b.selectedPageId&&(a.selectedPageId=b.selectedPageId);b.selectedFieldId&&
(a.selectedFieldId=b.selectedFieldId);t._nDS("saving",!0);b.sendAJAXRequest(a).after(function(a){t._nDS();if(a){if(a.errors){for(var c="",e=0;e<a.errors.length;e++)c+=a.errors[e]+"<br>";c&&t._flBo(c)}b.currentPageId=a.currentPageId;b.selectedPageId=a.selectedPageId;b.selectedFieldId=a.selectedFieldId}y.onbeforeunload=!1;v._eI();b.changeDetected=!1;b.changesSaved=!0;v._r()})}},zenarioO.panelTypes);
