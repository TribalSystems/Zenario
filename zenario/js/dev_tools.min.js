zenario.lib(function(z,B,t,w,q,E,r,x,u,F,G,H,C,n,I,s,J,K,L,M,N,p,a,h,A,v,y,D){a.internalCMSProperties={class_name:{description:"This property tracks which module created each element."},priv:{isGlobal:!0,description:"If you give an element the <code>priv</code> property and enter the name of an admin permission, the element will be <code>unset()</code> if the current admin does not have the permission you specified.\n\nThis property must be written in your .yaml file. It can't be changed in php."},
_filters:{description:"Data on the filters that the admin selected"},_path_here:{description:"This is the tag-path to a panel; i.e. the names of all of the elements and properties that lead here."},_sync:{description:"This property helps sync the TUIX of this Admin Box between the client and the server. All elements and properties are download from the server to the client, but only certain elements and properties may be uploaded by the client."},_was_hidden_before:{description:"This flags that a field was hidden when the admin box was last drawn. It can be modified by the client, so you shouldn't rely on it in your PHP code for security decisions."}};
a.initR=function(b){if("object"==typeof b){for(var d in b)p(b,d)&&a.initR(b[d]);b.properties&&!b.additionalProperties&&(b.additionalProperties=!1)}};a.init=function(b,d,c,e){a.schemaName=d;a.mode=b;a.orgMap="zenarioO"==b&&e;a.rootPath="";a.pages={};if(c){a.initR(c);if("zenarioO"==b){b=c.additionalProperties.properties.panels.additionalProperties;q&&q.zenarioO&&q.zenarioO.panelTypes&&(delete b.properties.panel_type.type,b.properties.panel_type["enum"]=_._k(w.opener.zenarioO.panelTypes));$.extend(!0,
b.properties,b.merge);d=$.extend(!0,{},b);e=$.extend(!0,{},b);var g=$.extend(!0,{},b);e.properties.item.properties.panel=g;d.properties.item.properties.panel=e;b.properties.item.properties.panel=d;e.properties.trash.properties.panel=g;d.properties.trash.properties.panel=e;b.properties.trash.properties.panel=d;e.properties.items.additionalProperties.properties.panel=g;d.properties.items.additionalProperties.properties.panel=e;b.properties.items.additionalProperties.properties.panel=d;e.properties.item_buttons.additionalProperties.properties.panel=
g;d.properties.item_buttons.additionalProperties.properties.panel=e;b.properties.item_buttons.additionalProperties.properties.panel=d;e.properties.collection_buttons.additionalProperties.properties.panel=g;d.properties.collection_buttons.additionalProperties.properties.panel=e;b.properties.collection_buttons.additionalProperties.properties.panel=d;e.properties.hidden_nav.additionalProperties.properties.panel=g;d.properties.hidden_nav.additionalProperties.properties.panel=e;b.properties.hidden_nav.additionalProperties.properties.panel=
d;c.additionalProperties.properties.nav.additionalProperties.properties.panel=b}a.schema=c;if(c.pages)for(var m in c.pages)p(c.pages,m)&&(a.pages[c.pages[m]]=!0)}else a.schema=!1;h.setTheme("ace/theme/textmate");h.commands.removeCommand("blockoutdent");h.setBehavioursEnabled(!1);t.getElementById("editor").style.fontSize="13px";h.setShowPrintMargin(!1);v.height();c=A.height();m=Math.floor($(w).height());v.resizable({containment:"document",minWidth:75,minHeight:m-c,maxHeight:m-c,handles:"e, s, se",
start:a.handleResize,resize:a.handleResize,stop:a.handleResize});a.load();var k=$('<div class="editor_tooltip" style="position: absolute; display: none;"></div>');k.appendTo(t.body);var l=-1,f="";h.on("mousemove",function(b){var c=b.getDocumentPosition();c&&(l!=c.row&&("yaml"==a.format?a.locatePosition(c,function(b,c){var d=a.drillDownIntoSchema(b,c);d.parent&&a.formatRequiredPropertiesInSchema(d.parent);d.tag=b.s("/").pop();d.isRequired=d.parent&&d.parent.requiredProperties&&d.parent.requiredProperties[d.tag];
f="";f=d.exact?u._mT("zenario_dev_tools_tooltip",d):(d.internalCMSProperty=a.internalCMSProperties[d.tag])?u._mT("zenario_dev_tools_internal_property_tooltip",d):"";k.html(f)}):(f="",k.html(f)),l=c.row),f?k.show().css("top",b.clientY+20).css("left",b.clientX):k.hide())});v.on("mouseout",function(){k.hide()})};a.load=function(){x._nDS("loading");if(a.mode&&q&&q[a.mode]&&(a.orgMap||q[a.mode].url)){var b;a.orgMap?(b=B+"zenario/admin/organizer.ajax.php?_debug=1",a.path=""):(b=q[a.mode].devToolsURL?q[a.mode].devToolsURL+
"&_debug=1":q[a.mode].url+"&_debug=1",a.path=q[a.mode].path);r._a(b,!1,!0).after(function(b){a.focus=b;a.tagPath=a.focus.tag_path||a.path||"";a.orgMap&&(a.map=$.extend(!0,{},q[a.mode].map),a.filterNav(a.map),a.filterNav(a.focus.tuix));a.focus.files={};var c,e,g=a.focus.modules_files_loaded,m,k={},h;for(c in g)if(p(g,c)&&(e=g[c],m=e.paths))for(h in m)p(m,h)&&(k[c+"."+h]=!1);b="zenario/admin/dev_tools/ajax.php?mode="+C(a.mode);k={load_tuix_files:JSON.stringify(k)};r._a(b,k,!0).after(function(b){if(b)for(c in g)if(p(g,
c)&&(e=g[c],m=e.paths))for(h in m)p(m,h)&&b[c+"."+h]&&(b[c+"."+h].path=m[h],a.focus.files[c+"."+h]=b[c+"."+h]);a.draw();x._nDS(!1)})})}else alert("Error, could not load!")};a.filterNav=function(b,d,c,e){n(d)||(d=q[a.mode].currentTopLevelPath.s("/"),d=d[0]);delete b.branch;for(var g in b)p(b,g)&&(n(c)||"dummy_item"!=g&&"top_right_buttons"!=g)&&("class_name"===g||n(c)&&"nav"!==c&&n(e)&&"nav"!==e&&"link"!==c&&("panel"!==c||"_path_here"!==g)?delete b[g]:"object"==typeof b[g]&&a.filterNav(b[g],d,g,c))};
a.draw=function(){if(!a.focus)return!1;a.updateToolbar(!0);a.updateEditor()};a.updateToolbar=function(b){b={files:{},paths:{},selectedFile:a.orgMap?"orgmap":"current",query_ids:a.focus.query_ids,query_select_count:a.focus.query_select_count,query_full_select:a.focus.query_full_select};var d,c,e,g,h,k=a.focus.modules_files_loaded;for(h in k)if(p(k,h)&&(e=k[h],e=e.paths))for(d in e)p(e,d)&&(c=e[d],g=c.s("/"),g.pop(),c=g.join("/"),c+="/",b.paths[c]=g.slice(-3).join("/"),b.files[h+"."+d]=e[d]);s("view")&&
(b.selectedFile=s("view").value);s("toolbar").innerHTML=u._mT("zenario_dev_tools_toolbar",b)};a.removeHiddenItems=function(b){var d,c;for(d in b)p(b,d)&&(c=b[d],"object"==typeof c&&(c._was_hidden_before?delete b[d]:a.removeHiddenItems(c)))};a.lastView=!1;a.updateEditor=function(){var b=s("view").value,d="yaml";a.editorSetValueByScript=!0;a.lastView=b;if("current"==b||"visible"==b){var c=q[a.mode].tuix;"visible"==b&&(c=JSON.parse(JSON.stringify(c)),a.removeHiddenItems(c));h.setValue(a.toFormat(c,d)+
"\n\n\n\n");a.rootPath=a.tagPath}else if("orgmap"==b)h.setValue(a.toFormat(a.map,d)+"\n\n\n\n"),a.rootPath=a.tagPath;else if("combined"==b)h.setValue(a.toFormat(a.focus.tuix,d)+"\n\n\n\n"),a.rootPath=a.tagPath;else if("query_ids"==b)h.setValue(a.focus.query_ids),d="mysql";else if("query_select_count"==b)h.setValue(a.focus.query_select_count),d="mysql";else if("query_full_select"==b)h.setValue(a.focus.query_full_select),d="mysql";else if(c=a.focus.files[b])b=b.s("."),b=b[b.length-1],d==b||"json"==
d&&"js"==b||"yaml"==d&&"yml"==b?h.setValue(c.source):h.setValue(a.toFormat(c.tags,d)),a.rootPath="";h.setReadOnly(!0);var e=h.getSession();a.format=d;e.setMode("ace/mode/"+d);a.showPathOnLoad?a.editorSelectFullPath(a.showPathOnLoad):a.editorSelectPath(z,!0);delete a.showPathOnLoad;a.editorSetValueByScript=!0;a.validate();h.focus();setTimeout(function(){e.getUndoManager().reset()},1);a.editorSetValueByScript=!1};a.handleResize=function(b,d){d.element.attr("id");var c=d.element.width(),e=Math.floor($(w).width())-
c;A.width(c).css("right",e);v.width(c).css("right",e);y.css("left",c).width(e);h.resize();a.sizePropertyTable()};a.toFormat=function(b,d){if("yaml"==d)return a.toYAML(b);if("json"==d)return JSON.stringify(b,z,"\t")};a.fromFormat=function(b,d,c){try{return"yaml"==d?a.fromYAML(b):"json"==d?JSON.parse(b):!1}catch(e){return!1}};a.toYAML=function(a){return jsyaml.safeDump(a,{indent:4,skipInvalid:!0})};a.fromYAML=function(a){return jsyaml.safeLoad(a.r(/\t/g,"    "))};a.arrayToString=function(a){_._isAr(a)&&
(a=a.join("\n"));return a};a.arrayToList=function(a){return"string"==typeof a?a.r(/,/g,", "):a.join(", ")};a.checkPathIsInData=function(a,d,c){var e;a=a.s("/");for(e in a)if(p(a,e)){var g=a[e];if(""!==g)if("object"==typeof d&&n(d[g]))d=d[g];else return!1}return c?d:!0};a.highlightFilesContainingSelection=function(b){var d={},c,e;a.rootPath?(c=b.r(a.rootPath+"/",""),e=a.tagPath+"/"+c):a.tagPath?(c=b.r(a.tagPath+"/",""),e=a.tagPath+"/"+c):e=c=b;$("#view option").each(function(b,h){var k=h.value,l=$(h).text(),
f=!1;"* "==l.substr(0,2)&&(l=l.substr(2));if("current"==k||"visible"==k)f=a.checkPathIsInData(c,q[a.mode].focus);else if("orgmap"==k)f=a.checkPathIsInData(c,a.map);else if("combined"==k)f=a.checkPathIsInData(c,a.focus.tuix);else if(a.focus.files[k]&&a.focus.files[k].tags)(f=a.checkPathIsInData(e,a.focus.files[k].tags))&&(d[k]=l);else return;f&&(l="* "+l);$(h).text(l)});return d};a.drillDownIntoSchema=function(b,d){n(b)||(b="");var c,e,g,h,k="",l=[a.rootPath,b],f={schema:a.schema,data:d,exact:!1,parent:{schema:{},
path:""},object:{tag:"",data:d||{},schema:a.schema,path:"",parent:{schema:{},path:""},url:a.schemaName?"http://zenar.io/ref-"+a.schemaName+"-"+a.schema.top_level_page:!1},path:""};if(!f.schema)return f;for(e in l)if(p(l,e))for(c in h=l[e].s("/"),h)if(p(h,c)){g=h[c];if(""!==g){f.parent.schema=f.schema;f.parent.path=f.path;if(f.schema.properties&&f.schema.properties[g])f.path+=(f.path?"/":"")+g,f.schema=f.schema.properties[g];else if(f.schema.additionalProperties)f.path+=(f.path?"/":"")+g,f.schema=
f.schema.additionalProperties;else return a.formatRequiredPropertiesInSchema(f);0<e&&(n(f.data)&&"object"==typeof f.data&&n(f.data[g])?f.data=f.data[g]:delete f.data);f.schema.properties&&(f.object.tag=g,f.object.lastTag=k,f.object.schema=f.schema,f.object.path=f.path,f.object.data=f.data,f.object.parent.schema=f.parent.schema,f.object.parent.path=f.parent.path,a.schemaName&&(a.pages[g]?f.object.url="http://zenar.io/ref-"+a.schemaName+"-"+g:k&&a.pages[k]&&(f.object.url="http://zenar.io/ref-"+a.schemaName+
"-"+k)))}k=g}f.exact=!0;return a.formatRequiredPropertiesInSchema(f)};a.formatRequiredPropertiesInSchema=function(b){var d;b.requiredProperties={};if(b.schema&&b.schema.required)if("object"==typeof b.schema.required)for(d in b.schema.required)p(b.schema.required,d)&&(b.requiredProperties[b.schema.required[d]]=!0);else b.requiredProperties[b.schema.required]=!0;b.object&&(b.object=a.formatRequiredPropertiesInSchema(b.object));return b};a.validate=function(){var b=h.getSession(),d="current"==a.lastView||
"visible"==a.lastView||"combined"==a.lastView||"orgmap"==a.lastView,c="query_ids"!=a.lastView&&"query_select_count"!=a.lastView&&"query_full_select"!=a.lastView;if(d||c){var e=a.drillDownIntoSchema(),g,m,k=[],l;if(e.exact){if(g=a.fromFormat(h.getValue(),a.format))if(e=tv4.validateMultiple(g,e.schema),e.errors&&e.errors.length)for(l in e.errors)if(p(e.errors,l)){g=e.errors[l].code;var f=e.errors[l].dataPath,n=f.s("/").pop(),s=e.errors[l].message,r="error";if(12!=g||"zenarioAB"!=a.mode||"Propeties pick_items and upload may not appear together"!=
s){"/"==f.substr(0,1)&&(f=f.substr(1));if(500==g){var t=a.checkPathIsInData(f,a.focus.tuix,!0),u=a.checkPathIsInData(f,q[a.mode].focus,!0);if("object"==typeof t||"object"==typeof u||t==u)continue}if(303==g)if(a.mode.m("zenario"))if("custom_"==(""+n).substr(0,7))continue;else if(a.internalCMSProperties[n])continue;else r="warning";else continue;"error"==r&&!d||"warning"==r&&!c||(m=a.editorGetLineNumberFromPath(f))&&k.push({row:m.number-1,column:m.indent.r(/\t/g,"    ").length,text:s,type:r})}}b.setAnnotations(k)}else b.setAnnotations([])}else b.setAnnotations([])};
a.splitLineByKey=function(b,d){var c,e={},g;n(d)||(d=a.format);if("yaml"==d)g=/^([\s\t]*)("?)([\w-]+)\2:/;else if("json"==d)g=/^([\s\t]*)("?)([\w-]+)\2:/;else if("log"==d)g=/^([\s\t]*)()([\w\/-]+):/;else return!1;return n(b)&&(c=b.m(g))?(e.indent=c[1],e.quote=c[2],e.key=c[3],e.rest=b.substr(c[0].length),e):!1};a.locatePosition=function(b,d){var c=h.getValue(),e=b||h.getCursorPosition(),g=d||a.showSidebar,m=h.session,k;if("yaml"==a.format||"json"==a.format){if(c&&m&&e&&n(e.row)&&(k=m.getLines(0,m.getLength())))for(c=
e.row;0<=c;--c)if(e=a.splitLineByKey(k[c])){k[c]=e.indent+e.quote+"____here____"+e.key+e.quote+":"+e.rest;k=k.join("\n");if(k=a.fromFormat(k,a.format))c=a.locatePositionR(k,""),g(c,k);return}g("")}};a.locatePositionR=function(b,d){var c="",e;for(e in b)if(p(b,e)){if("____here____"===e.substr(0,12))return c=e.substr(12),b[c]=b[e],delete b[e],d+(d?"/":"")+c;if("object"==typeof b[e]&&(c=a.locatePositionR(b[e],d+(d?"/":"")+e)))return c}};a.editorGetLineNumberFromPath=function(b,d){var c=b.s("/"),e=-1,
g=-1,m=h.getValue(),k=h.session,l,f,n=0;if(m&&k&&(l=k.getLines(0,k.getLength()))){a:for(;++e<c.length;){if(!c[e])continue a;for(;n<l.length;++n)if(f=a.splitLineByKey(l[n]))if(f.indent=f.indent.r("\t","    "),f.key==c[e]&&f.indent.length>g&&(d||f.indent.length<g+5)){g=f.indent.length;f.number=++n;continue a}else if(f.indent.length<=g)break;return!1}return f}return!1};a.editorSelectPath=function(b,d){b=a.setupPath(b,!0);var c;(c=a.editorGetLineNumberFromPath(b))?(a.editorSetValueByScript=!0,h.gotoLine(c.number),
h.scrollToLine(c.number,!0,!1),c.indent&&h.navigateWordRight(),h.getSelection().selectWordRight(),h.focus(),a.showSidebar(b),a.editorSetValueByScript=!1):d?(c=b.s("/"),c.pop(),c.length?(b=c.join("/"),a.editorSelectPath(b,d)):(h.gotoLine(1),h.scrollToLine(1,!0,!1),a.showSidebar(""))):a.showSidebar(b)};a.editorSelectFullPath=function(b){n(a.rootPath)?(a.rootPath&&(b=b.r(a.rootPath+"/","")),a.editorSelectPath(b,!0)):a.showPathOnLoad=b};a.lastPath="";a.lastRootPath="";a.setupPath=function(b,d){n(b)||
(b=a.lastPath,a.lastRootPath!=a.rootPath&&(a.lastRootPath&&(b=a.lastRootPath+"/"+b),a.rootPath&&(b=b.r(a.rootPath+"/",""))));a.lastPath=b;a.lastRootPath=a.rootPath;return b};a.setHash=function(a){t.location.hash=a;r.currentHash=t.location.hash};a.showSidebar=function(b,d){b=a.setupPath(b);n(d)||(d=a.fromFormat(h.getValue(),a.format));var c;b&&(c=a.drillDownIntoSchema(b,d));c||(c=a.drillDownIntoSchema("",d));c.paths=[];if(c.path){a.setHash(c.path);a.rootPath?(c.fullPath=a.rootPath+"/"+b,c.localPath=
b):c.fullPath=c.localPath=b;"zenarioO"==a.mode&&(c.shortPath=q[a.mode].shortenPath(c.fullPath));b="";var e=c.localPath.s("/"),g;for(g in e)p(e,g)&&(c.tag=e[g],b+=(b?"/":"")+e[g],c.paths.push({tag:e[g],path:b}))}c.object.files=a.highlightFilesContainingSelection(b||c.object.path);s("sidebar_inner").innerHTML=u._mT("zenario_dev_tools_sidepanel",c);y.removeClass("sidebarEmpty").addClass("sidebarFull");a.sizePropertyTable();x._to("#sidebar_inner tr[title]",{tooltipClass:"zenario_devtools_tooltip",position:{my:"right top+2",
at:"left center",collision:"flipfit"},show:!1,hide:!1})};a.sizePropertyTable=function(){if(s("properties_table")){var a=$("#properties_table .property_name").width()||0,a=D.innerWidth()-a-20;$("#properties_table .property_desc").width(a);$("#properties_table .property_desc div").width(a)}};a.editorOnChange=function(b){a.editorSetValueByScript||r._aADINS("dev_tools_editor_change",function(){a.validate()},2E3)};a.editorOnSelect=function(b){a.editorSetValueByScript||(s("sidebar_inner").innerHTML="",
y.addClass("sidebarEmpty").removeClass("sidebarFull"),r._aADINS("dev_tools_editor_select",function(){a.locatePosition()},500))};h.on("change",a.editorOnChange);h.on("changeSelection",a.editorOnSelect);h.on("changeCursor",a.editorOnSelect);h.session.setUseSoftTabs(!1)},window.devTools=function(){},window.editor=ace.edit("editor"),$("#toolbar"),$("#editor"),$("#sidebar"),$("#sidebar_inner"));
