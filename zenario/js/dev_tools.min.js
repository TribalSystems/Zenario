var sourceLib;
zenario.lib(function(H,J,z,D,r,M,t,A,y,N,O,P,K,q,Q,w,R,S,T,U,V,p,a,k){var E=$("#toolbar"),B=$("#editor"),F=$("#lowerbar"),G=$("#sidebar"),L=$("#sidebar_inner");a.internalCMSProperties={class_name:{description:"This property tracks which module created each element."},only_merge_into_an_existing_object:{isGlobal:!0,description:"This property is helpful when trying to add properties to an existing object defined in another TUIX file, but cannot be sure if the object will be there or not. If this property is set, its sibling properties will be ignored if the object is not there when the TUIX is merged."},priv:{isGlobal:!0,
description:"If you give an element the <code>priv</code> property and enter the name of an admin permission, the element will be <code>unset()</code> if the current admin does not have the permission you specified.\n\nThis property must be written in your .yaml file. It can't be changed in php."},_filters:{description:"Data on the filters that the admin selected"},_path_here:{description:"This is the tag-path to a panel; i.e. the names of all of the elements and properties that lead here."},_sync:{description:"This property helps sync the TUIX of this Admin Box between the client and the server. All elements and properties are download from the server to the client, but only certain elements and properties may be uploaded by the client."},
_was_hidden_before:{description:"This flags that a field was hidden when the admin box was last drawn. It can be modified by the client, so you shouldn't rely on it in your PHP code for security decisions."}};a.initR=function(b){if("object"==typeof b){for(var c in b)p(b,c)&&a.initR(b[c]);b.properties&&!b.additionalProperties&&(b.additionalProperties=!1)}};a.init=function(b,c,d,e){a.schemaName=c;a.mode=b;a.orgMap="zenarioO"==b&&e;a.rootPath="";a.pages={};if(d){a.initR(d);if("zenarioO"==b){b=d.additionalProperties.properties.panels.additionalProperties;
r&&r.zenarioO&&r.zenarioO.panelTypes&&(delete b.properties.panel_type.type,b.properties.panel_type["enum"]=_.keys(D.opener.zenarioO.panelTypes));$.extend(!0,b.properties,b.merge);c=$.extend(!0,{},b);e=$.extend(!0,{},b);var g=$.extend(!0,{},b);e.properties.item.properties.panel=g;c.properties.item.properties.panel=e;b.properties.item.properties.panel=c;e.properties.trash.properties.panel=g;c.properties.trash.properties.panel=e;b.properties.trash.properties.panel=c;e.properties.items.additionalProperties.properties.panel=
g;c.properties.items.additionalProperties.properties.panel=e;b.properties.items.additionalProperties.properties.panel=c;e.properties.item_buttons.additionalProperties.properties.panel=g;c.properties.item_buttons.additionalProperties.properties.panel=e;b.properties.item_buttons.additionalProperties.properties.panel=c;e.properties.collection_buttons.additionalProperties.properties.panel=g;c.properties.collection_buttons.additionalProperties.properties.panel=e;b.properties.collection_buttons.additionalProperties.properties.panel=
c;e.properties.hidden_nav.additionalProperties.properties.panel=g;c.properties.hidden_nav.additionalProperties.properties.panel=e;b.properties.hidden_nav.additionalProperties.properties.panel=c;d.additionalProperties.properties.nav.additionalProperties.properties.panel=b}a.schema=d;if(d.pages)for(var f in d.pages)p(d.pages,f)&&(a.pages[d.pages[f]]=!0)}else a.schema=!1;k.setTheme("ace/theme/textmate");k.commands.removeCommand("blockoutdent");k.setBehavioursEnabled(!1);z.getElementById("editor").style.fontSize=
"13px";k.setShowPrintMargin(!1);B.height();d=E.height()+F.height();f=Math.floor($(D).height());B.resizable({containment:"document",minWidth:75,minHeight:f-d,maxHeight:f-d,handles:"e, s, se",start:a.handleResize,resize:a.handleResize,stop:a.handleResize});a.load();var h=$('<div class="editor_tooltip" style="position: absolute; display: none;"></div>');h.appendTo(z.body);var l=-1,m="";k.on("mousemove",function(x){var u=x.getDocumentPosition();u&&(l!=u.row&&("yaml"==a.format?a.locatePosition(u,function(v,
n){n=a.drillDownIntoSchema(v,n);n.parent&&a.formatRequiredPropertiesInSchema(n.parent);n.tag=v.s("/").pop();n.isRequired=n.parent&&n.parent.requiredProperties&&n.parent.requiredProperties[n.tag];m="";m=n.exact?y._sbf("zenario_dev_tools_tooltip",n):(n.internalCMSProperty=a.internalCMSProperties[n.tag])?y._sbf("zenario_dev_tools_internal_property_tooltip",n):"";h.html(m)}):(m="",h.html(m)),l=u.row),m?h.show().css("top",x.clientY+20).css("left",x.clientX):h.hide())});B.on("mouseout",function(){h.hide()})};
a.load=function(){A._8nu("loading");if(a.mode&&r&&r[a.mode]&&(a.orgMap||r[a.mode].url)){sourceLib=r[a.mode];if(a.orgMap){var b=J+"zenario/admin/organizer.ajax.php?_debug=1";a.path=""}else b=sourceLib.devToolsURL?sourceLib.devToolsURL+"&_debug=1":sourceLib.url+"&_debug=1",a.path=sourceLib.path;t.ajax(b,!1,!0).after(function(c){a.focus=c;a.tagPath=a.focus.tag_path||a.path||"";a.orgMap&&(a.map=$.extend(!0,{},sourceLib.map),a.filterNav(a.map),a.filterNav(a.focus.tuix));a.focus.files={};var d,e=a.focus.modules_files_loaded,
g,f={},h;for(d in e)if(p(e,d)){var l=e[d];if(g=l.paths)for(h in g)p(g,h)&&(f[d+"."+h]=!1)}c="zenario/admin/dev_tools/ajax.php?mode="+K(a.mode);f={load_tuix_files:JSON.stringify(f)};t.ajax(c,f,!0).after(function(m){if(m)for(d in e)if(p(e,d)&&(l=e[d],g=l.paths))for(h in g)p(g,h)&&m[d+"."+h]&&(m[d+"."+h].path=g[h],a.focus.files[d+"."+h]=m[d+"."+h]);a.draw();A._8nu(!1)})})}else alert("Error, could not load!")};a.filterNav=function(b,c,d,e){q(c)||(c=sourceLib.currentTopLevelPath.s("/"),c=c[0]);delete b.branch;
for(var g in b)p(b,g)&&(q(d)||"dummy_item"!=g&&"top_right_buttons"!=g)&&("class_name"===g||q(d)&&"nav"!==d&&q(e)&&"nav"!==e&&"link"!==d&&("panel"!==d||"_path_here"!==g)?delete b[g]:"object"==typeof b[g]&&a.filterNav(b[g],c,g,d))};a.draw=function(){if(!a.focus)return!1;a.updateToolbar(!0);a.updateEditor()};var C;a.updateToolbar=function(b){b={files:{},paths:{},selectedFile:a.orgMap?"orgmap":"current",query_ids:a.focus.query_ids,query_select_count:a.focus.query_select_count,query_full_select:a.focus.query_full_select};
var c,d,e=a.focus.modules_files_loaded;C={};for(d in e)if(p(e,d)){var g=e[d];if(g=g.paths)for(c in g)if(p(g,c)){var f=g[c];var h=f.s("/");h.pop();f=h.join("/");f+="/";b.paths[f]=h.slice(-3).join("/");b.files[d+"."+c]=C[d+"."+c]=g[c]}}w("view")&&(b.selectedFile=w("view").value);E.html(y._sbf("zenario_dev_tools_toolbar",b));F.html(y._sbf("zenario_dev_tools_lowerbar",b));a.setupCopyButton()};a.setupCopyButton=function(){var b=$("#copyFilePath"),c=$("#view").val();if(c&&C[c]&&t._8qy())b.show().on("click",
function(){t.copy(C[c]);toastr.success(A.phrase.copied)});else b.off().hide()};a.removeHiddenItems=function(b){var c;for(c in b)if(p(b,c)){var d=b[c];"object"==typeof d&&(d._was_hidden_before?delete b[c]:a.removeHiddenItems(d))}};a.lastView=!1;a.updateEditor=function(){var b=w("view").value,c="yaml",d=!1;a.editorSetValueByScript=!0;a.lastView=b;if("current"==b||"visible"==b){var e=sourceLib.tuix;"visible"==b&&(e=JSON.parse(JSON.stringify(e)),a.removeHiddenItems(e));k.setValue(a.toFormat(e,c)+"\n\n\n\n");
a.rootPath=a.tagPath}else if("orgmap"==b)k.setValue(a.toFormat(a.map,c)+"\n\n\n\n"),a.rootPath=a.tagPath;else if("combined"==b)k.setValue(a.toFormat(a.focus.tuix,c)+"\n\n\n\n"),a.rootPath=a.tagPath;else if("query_ids"==b)k.setValue(a.focus.query_ids),c="mysql";else if("query_select_count"==b)k.setValue(a.focus.query_select_count),c="mysql";else if("query_full_select"==b)k.setValue(a.focus.query_full_select),c="mysql";else if("form_html"==b)k.setValue(sourceLib.__lastFormHTML||""),c="html",d=!0;else if(e=
a.focus.files[b])b=b.s("."),b=b[b.length-1],c==b||"json"==c&&"js"==b||"yaml"==c&&"yml"==b?k.setValue(e.source):k.setValue(a.toFormat(e.tags,c)),a.rootPath="";k.setReadOnly(!0);k.setOption("wrap",d);var g=k.getSession();a.format=c;g.setMode("ace/mode/"+c);a.showPathOnLoad?a.editorSelectFullPath(a.showPathOnLoad):a.editorSelectPath(H,!0);delete a.showPathOnLoad;a.editorSetValueByScript=!0;a.validate();k.focus();setTimeout(function(){g.getUndoManager().reset()},1);a.editorSetValueByScript=!1};a.handleResize=
function(b,c){c.element.attr("id");b=c.element.width();c=Math.floor($(D).width())-b;E.width(b).css("right",c);B.width(b).css("right",c).css("height","");F.width(b).css("right",c);G.css("left",b).width(c);k.resize();a.sizePropertyTable()};a.toFormat=function(b,c){if("yaml"==c)return a.toYAML(b);if("json"==c)return JSON.stringify(b,H,"\t")};a.fromFormat=function(b,c,d){try{return"yaml"==c?a.fromYAML(b):"json"==c?JSON.parse(b):!1}catch(e){return!1}};a.toYAML=function(b){return jsyaml.safeDump(b,{indent:4,
skipInvalid:!0})};a.fromYAML=function(b){return jsyaml.safeLoad(b.r(/\t/g,"    "))};a.arrayToString=function(b){_._ge1(b)&&(b=b.join("\n"));return b};a.arrayToList=function(b){return"string"==typeof b?b.r(/,/g,", "):b.join(", ")};a.ksort=function(b,c){var d={},e=_.keys(b);e.sort(c);for(c=0;c<e.length;++c)d[e[c]]=b[e[c]];return d};a.underscoresLast=function(b,c){b=b.r(/_/g,"~");c=c.r(/_/g,"~");return b<c?-1:1};a.checkPathIsInData=function(b,c,d){var e;b=b.s("/");for(e in b)if(p(b,e)){var g=b[e];if(""!==
g)if("object"==typeof c&&q(c[g]))c=c[g];else return!1}return d?c:!0};a.highlightFilesContainingSelection=function(b){var c={};if(a.rootPath){var d=b.r(a.rootPath+"/","");var e=a.tagPath+"/"+d}else a.tagPath?(d=b.r(a.tagPath+"/",""),e=a.tagPath+"/"+d):e=d=b;$("#view option").each(function(g,f){g=f.value;var h=$(f).text();"* "==h.substr(0,2)&&(h=h.substr(2));if("current"==g||"visible"==g)var l=a.checkPathIsInData(d,sourceLib.focus);else if("orgmap"==g)l=a.checkPathIsInData(d,a.map);else if("combined"==
g)l=a.checkPathIsInData(d,a.focus.tuix);else if(a.focus.files[g]&&a.focus.files[g].tags)(l=a.checkPathIsInData(e,a.focus.files[g].tags))&&(c[g]=h);else return;l&&(h="* "+h);$(f).text(h)});return c};a.drillDownIntoSchema=function(b,c){q(b)||(b="");var d,e,g="";b=[a.rootPath,b];var f={schema:a.schema,data:c,exact:!1,parent:{schema:{},path:""},object:{tag:"",data:c||{},schema:a.schema,path:"",parent:{schema:{},path:""},url:a.schemaName?"https://zenar.io/ref-"+a.schemaName+"-"+a.schema.top_level_page:
!1},path:""};if(!f.schema)return f;for(e in b)if(p(b,e)){var h=b[e].s("/");for(d in h)if(p(h,d)){c=h[d];if(""!==c){f.parent.schema=f.schema;f.parent.path=f.path;if(f.schema.properties&&f.schema.properties[c])f.path+=(f.path?"/":"")+c,f.schema=f.schema.properties[c];else if(f.schema.additionalProperties)f.path+=(f.path?"/":"")+c,f.schema=f.schema.additionalProperties;else return f.depthReached=d,f.totalDepth=h.length,a.formatRequiredPropertiesInSchema(f);0<e&&(q(f.data)&&"object"==typeof f.data&&q(f.data[c])?
f.data=f.data[c]:delete f.data);f.schema.properties&&(f.object.tag=c,f.object.lastTag=g,f.object.schema=f.schema,f.object.path=f.path,f.object.data=f.data,f.object.parent.schema=f.parent.schema,f.object.parent.path=f.parent.path,a.schemaName&&(a.pages[c]?(f.object.documentedTag=c,f.object.url="https://zenar.io/ref-"+a.schemaName+"-"+c):g&&a.pages[g]&&(f.object.documentedTag=g,f.object.url="https://zenar.io/ref-"+a.schemaName+"-"+g)))}g=c}}f.exact=!0;return a.formatRequiredPropertiesInSchema(f)};a.formatRequiredPropertiesInSchema=
function(b){var c;b.requiredProperties={};if(b.schema&&b.schema.required)if("object"==typeof b.schema.required)for(c in b.schema.required)p(b.schema.required,c)&&(b.requiredProperties[b.schema.required[c]]=!0);else b.requiredProperties[b.schema.required]=!0;b.object&&(b.object=a.formatRequiredPropertiesInSchema(b.object));return b};a.validate=function(){var b=k.getSession(),c="current"==a.lastView||"visible"==a.lastView||"combined"==a.lastView||"orgmap"==a.lastView,d="query_ids"!=a.lastView&&"query_select_count"!=
a.lastView&&"query_full_select"!=a.lastView;if(c||d){var e=a.drillDownIntoSchema(),g,f,h=[],l;if(e.exact){if(g=a.fromFormat(k.getValue(),a.format))if(e=tv4.validateMultiple(g,e.schema),e.errors&&e.errors.length)for(l in e.errors)if(p(e.errors,l)){g=e.errors[l].code;var m=e.errors[l].dataPath,x=m.s("/").pop(),u=e.errors[l].message,v="error";if(12!=g||"zenarioAB"!=a.mode||"Propeties pick_items and upload may not appear together"!=u){"/"==m.substr(0,1)&&(m=m.substr(1));if(500==g){var n=a.checkPathIsInData(m,
a.focus.tuix,!0),I=a.checkPathIsInData(m,sourceLib.focus,!0);if("object"==typeof n||"object"==typeof I||n==I)continue}if(303==g)if(a.mode.m("zenario"))if("custom_"==(""+x).substr(0,7))continue;else if(a.internalCMSProperties[x])continue;else v="warning";else continue;"error"==v&&!c||"warning"==v&&!d||(f=a.editorGetLineNumberFromPath(m))&&h.push({row:f.number-1,column:f.indent.r(/\t/g,"    ").length,text:u,type:v})}}b.setAnnotations(h)}else b.setAnnotations([])}else b.setAnnotations([])};a.splitLineByKey=
function(b,c){var d,e={};q(c)||(c=a.format);if("yaml"==c)c=/^([\s\t]*)("?)([\w-]+)\2:/;else if("json"==c)c=/^([\s\t]*)("?)([\w-]+)\2:/;else if("log"==c)c=/^([\s\t]*)()([\w\/-]+):/;else return!1;return q(b)&&(d=b.m(c))?(e.indent=d[1],e.quote=d[2],e.key=d[3],e.rest=b.substr(d[0].length),e):!1};a.locatePosition=function(b,c){var d=k.getValue();b=b||k.getCursorPosition();c=c||a.showSidebar;var e=k.session,g;if("yaml"==a.format||"json"==a.format){if(d&&e&&b&&q(b.row)&&(g=e.getLines(0,e.getLength())))for(d=
b.row;0<=d;--d)if(b=a.splitLineByKey(g[d])){g[d]=b.indent+b.quote+"____here____"+b.key+b.quote+":"+b.rest;g=g.join("\n");if(g=a.fromFormat(g,a.format))d=a.locatePositionR(g,""),c(d,g);return}c("")}};a.locatePositionR=function(b,c){var d;for(d in b)if(p(b,d)){if("____here____"===d.substr(0,12)){var e=d.substr(12);b[e]=b[d];delete b[d];return c+(c?"/":"")+e}if("object"==typeof b[d]&&(e=a.locatePositionR(b[d],c+(c?"/":"")+d)))return e}};a.editorGetLineNumberFromPath=function(b,c){b=b.s("/");var d=-1,
e=-1,g=k.getValue(),f=k.session,h,l,m=0;if(g&&f&&(h=f.getLines(0,f.getLength()))){a:for(;++d<b.length;){if(!b[d])continue a;for(;m<h.length;++m)if(l=a.splitLineByKey(h[m]))if(l.indent=l.indent.r("\t","    "),l.key==b[d]&&l.indent.length>e&&(c||l.indent.length<e+5)){e=l.indent.length;l.number=++m;continue a}else if(l.indent.length<=e)break;return!1}return l}return!1};a.editorSelectPath=function(b,c){b=a.setupPath(b,!0);var d;(d=a.editorGetLineNumberFromPath(b))?(a.editorSetValueByScript=!0,k.gotoLine(d.number),
k.scrollToLine(d.number,!0,!1),d.indent&&k.navigateWordRight(),k.getSelection().selectWordRight(),k.focus(),a.showSidebar(b),a.editorSetValueByScript=!1):c?(b=b.s("/"),b.pop(),b.length?(b=b.join("/"),a.editorSelectPath(b,c)):(k.gotoLine(1),k.scrollToLine(1,!0,!1),a.showSidebar(""))):a.showSidebar(b)};a.editorSelectFullPath=function(b){q(a.rootPath)?(a.rootPath&&(b=b.r(a.rootPath+"/","")),a.editorSelectPath(b,!0)):a.showPathOnLoad=b};a.lastPath="";a.lastRootPath="";a.setupPath=function(b,c){q(b)||
(b=a.lastPath,a.lastRootPath!=a.rootPath&&(a.lastRootPath&&(b=a.lastRootPath+"/"+b),a.rootPath&&(b=b.r(a.rootPath+"/",""))));a.lastPath=b;a.lastRootPath=a.rootPath;return b};a.setHash=function(b){z.location.hash=b;t.currentHash=z.location.hash};a.showSidebar=function(b,c){b=a.setupPath(b);q(c)||(c=a.fromFormat(k.getValue(),a.format));var d;b&&(d=a.drillDownIntoSchema(b,c));d||(d=a.drillDownIntoSchema("",c));d.paths=[];if(d.path){a.setHash(d.path);a.rootPath?(d.fullPath=a.rootPath+"/"+b,d.localPath=
b):d.fullPath=d.localPath=b;"zenarioO"==a.mode&&(d.shortPath=sourceLib.shortenPath(d.fullPath));b="";c=d.localPath.s("/");for(var e in c)p(c,e)&&(d.tag=c[e],b+=(b?"/":"")+c[e],d.paths.push({tag:c[e],path:b}),d.displayedPath=b)}d.object.files=a.highlightFilesContainingSelection(b||d.object.path);w("sidebar_inner").innerHTML=y._sbf("zenario_dev_tools_sidepanel",d);G.removeClass("sidebarEmpty").addClass("sidebarFull");a.sizePropertyTable();A._cjm("#sidebar_inner tr[title]",{tooltipClass:"zenario_devtools_tooltip",
position:{my:"right top+2",at:"left center",collision:"flipfit"},show:!1,hide:!1})};a.sizePropertyTable=function(){if(w("properties_table")){var b=$("#properties_table .property_name").width()||0;b=L.innerWidth()-b-20;$("#properties_table .property_desc").width(b);$("#properties_table .property_desc div").width(b)}};a.editorOnChange=function(b){a.editorSetValueByScript||t._9fm("dev_tools_editor_change",function(){a.validate()},2E3)};a.editorOnSelect=function(b){a.editorSetValueByScript||(w("sidebar_inner").innerHTML=
"",G.addClass("sidebarEmpty").removeClass("sidebarFull"),t._9fm("dev_tools_editor_select",function(){a.locatePosition()},500))};k.on("change",a.editorOnChange);k.on("changeCursor",a.editorOnSelect);k.on("changeSelection",a.editorOnSelect);k.session.setUseSoftTabs(!1)},window.devTools=function(){},window.editor=ace.edit("editor"));
