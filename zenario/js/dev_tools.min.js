zenario.lib(function(n,z,s,v,p,B,m,q,C,D,E,r,F,G,w,H,I,J,K,x,t,u,A,a,h){a.internalCMSProperties={ord:!0,count:!0,class_name:!0,_h:!0,_h_js:!0,_sync:!0,_path_here:!0,__page__:!0,__item_sort_order__:!0};a.initR=function(b){if("object"==typeof b){for(var e in b)m.has(b,e)&&a.initR(b[e]);b.properties&&!b.additionalProperties&&(b.additionalProperties=!1)}};a.init=function(b,e,c,d){a.schemaName=e;a.mode=b;a.skMap="zenarioO"==b&&d;a.rootPath="";a.pages={};if(c){a.initR(c);if("zenarioO"==b){b=c.additionalProperties.properties.panels.additionalProperties;
$.extend(!0,b.properties,b.merge);e=$.extend(!0,{},b);d=$.extend(!0,{},b);var f=$.extend(!0,{},b);d.properties.item.properties.panel=f;e.properties.item.properties.panel=d;b.properties.item.properties.panel=e;d.properties.trash.properties.panel=f;e.properties.trash.properties.panel=d;b.properties.trash.properties.panel=e;d.properties.items.additionalProperties.properties.panel=f;e.properties.items.additionalProperties.properties.panel=d;b.properties.items.additionalProperties.properties.panel=e;d.properties.item_buttons.additionalProperties.properties.panel=
f;e.properties.item_buttons.additionalProperties.properties.panel=d;b.properties.item_buttons.additionalProperties.properties.panel=e;d.properties.collection_buttons.additionalProperties.properties.panel=f;e.properties.collection_buttons.additionalProperties.properties.panel=d;b.properties.collection_buttons.additionalProperties.properties.panel=e;d.properties.hidden_nav.additionalProperties.properties.panel=f;e.properties.hidden_nav.additionalProperties.properties.panel=d;b.properties.hidden_nav.additionalProperties.properties.panel=
e;c.additionalProperties.properties.nav.additionalProperties.properties.panel=b}a.schema=c;if(c.pages)for(var l in c.pages)m.has(c.pages,l)&&(a.pages[c.pages[l]]=!0)}else a.schema=!1;h.setTheme("ace/theme/textmate");h.commands.removeCommand("blockoutdent");h.setBehavioursEnabled(!1);s.getElementById("editor").style.fontSize="13px";h.setShowPrintMargin(!1);t.height();c=x.height();l=Math.floor($(v).height());t.resizable({containment:"document",minWidth:75,minHeight:l-c,maxHeight:l-c,handles:"e, s, se",
start:a.handleResize,resize:a.handleResize,stop:a.handleResize});a.load();var k=$('<div class="editor_tooltip" style="position: absolute; display: none;"></div>');k.appendTo(s.body);var y=-1,g="";h.on("mousemove",function(b){var c=b.getDocumentPosition();c&&(y!=c.row&&(a.locatePosition(c,function(b,c){var d=a.drillDownIntoSchema(b,c);d.tag=b.split("/").pop();g="";g=d.exact?q.microTemplate("zenario_dev_tools_tooltip",d):a.internalCMSProperties[d.tag]?"<strong>Internal CMS property</strong>":"";k.html(g)}),
y=c.row),g?k.show().css("top",b.clientY+20).css("left",b.clientX):k.hide())});t.on("mouseout",function(){k.hide()})};a.load=function(){q.nowDoingSomething("loading");if(a.mode&&p&&p[a.mode]&&(a.skMap||p[a.mode].url)){var b;a.skMap?(b=z+"zenario/admin/ajax.php?_debug=1",a.path=""):(b=p[a.mode].devToolsURL?p[a.mode].devToolsURL+"&_debug=1":p[a.mode].url+"&_debug=1",a.path=p[a.mode].path);m.ajax(b,!1,!0).after(function(b){a.focus=b;a.tagPath=w(a.focus.tag_path,a.path,"");a.skMap&&a.filterNav(a.focus.tuix);
a.focus.files={};var c,d=a.focus.modules_files_loaded,f;b={};var l;for(c in d)if(m.has(d,c)&&(f=d[c].paths))for(l in f)m.has(f,l)&&(b[c+"."+l]=!1);b="zenario/admin/dev_tools/ajax.php?mode="+encodeURIComponent(a.mode)+"&load_tuix_files="+encodeURIComponent(JSON.stringify(b));if(b=m.nonAsyncAJAX(b,!1,!0))for(c in d)if(m.has(d,c)&&(f=d[c].paths))for(l in f)m.has(f,l)&&b[c+"."+l]&&(b[c+"."+l].path=f[l],a.focus.files[c+"."+l]=b[c+"."+l]);a.draw();q.nowDoingSomething(!1)})}else alert("Error, could not load!")};
a.filterNav=function(b,e,c,d){e===n&&(e=p[a.mode].currentTopLevelPath.split("/"),e=e[0]);for(var f in b)m.has(b,f)&&("class_name"!==f&&(c===n||"nav"===c||d===n||"nav"===d||"link"===c||"panel"===c&&"_path_here"===f)?d!==n||c==e||"nav"!==f&&"panel"!==f?"object"==typeof b[f]&&a.filterNav(b[f],e,f,c):"panel"===f?delete b[f]:b[f]={}:delete b[f])};a.draw=function(){if(!a.focus)return!1;a.updateToolbar(!0);a.updateEditor()};a.updateToolbar=function(b){b={files:{},selectedFile:a.skMap?"combined":"current",
organizer_query_ids:a.focus.organizer_query_ids,organizer_query_details:a.focus.organizer_query_details};var e,c,d,f=a.focus.modules_files_loaded;for(d in f)if(m.has(f,d)&&(c=f[d].paths))for(e in c)m.has(c,e)&&(b.files[d+"."+e]=c[e]);r("view")&&(b.selectedFile=r("view").value);r("toolbar").innerHTML=q.microTemplate("zenario_dev_tools_toolbar",b)};a.lastView=!1;a.updateEditor=function(){var b=r("view").value,e="yaml";a.editorSetValueByScript=!0;a.lastView=b;if("current"==b)h.setValue(a.toFormat(p[a.mode].focus,
e)),a.rootPath=a.tagPath;else if("combined"==b)h.setValue(a.toFormat(a.focus.tuix,e)),a.rootPath=a.tagPath;else if("organizer_query_ids"==b)h.setValue(a.focus.organizer_query_ids),e="mysql";else if("organizer_query_details"==b)h.setValue(a.focus.organizer_query_details),e="mysql";else{var c;if(c=a.focus.files[b])b=b.split("."),b=b[b.length-1],e==b||"json"==e&&"js"==b||"yaml"==e&&"yml"==b?h.setValue(c.source):h.setValue(a.toFormat(c.tags,e)),a.rootPath=""}h.setReadOnly(!0);var d=h.getSession();a.format=
e;d.setMode("ace/mode/"+e);a.showPathOnLoad?a.editorSelectFullPath(a.showPathOnLoad):a.editorSelectPath(n,!0);delete a.showPathOnLoad;a.editorSetValueByScript=!0;a.validate();h.focus();setTimeout(function(){d.getUndoManager().reset()},1);a.editorSetValueByScript=!1};a.handleResize=function(b,e){e.element.attr("id");var c=e.element.width(),d=Math.floor($(v).width())-c;x.width(c).css("right",d);t.width(c).css("right",d);u.css("left",c).width(d);h.resize();a.sizePropertyTable()};a.toFormat=function(b,
e){if("yaml"==e)return a.toYAML(b);if("json"==e)return JSON.stringify(b,n,"\t")};a.fromFormat=function(b,e,c){try{return"yaml"==e?a.fromYAML(b):"json"==e?JSON.parse(b):!1}catch(d){return!1}};a.toYAML=function(a){return jsyaml.safeDump(a,{indent:4,skipInvalid:!0})};a.fromYAML=function(a){return jsyaml.safeLoad(a.replace(/\t/g,"    "))};a.arrayToString=function(a){_.isArray(a)&&(a=a.join("\n"));return a};a.arrayToList=function(a){return"string"==typeof a?a.replace(/,/g,", "):a.join(", ")};a.checkPathIsInData=
function(a,e){var c,d=a.split("/");for(c in d)if(m.has(d,c)){var f=d[c];if(""!==f)if("object"==typeof e&&e[f]!==n)e=e[f];else return!1}return!0};a.highlightFilesContainingSelection=function(b){var e={},c,d;a.rootPath?(c=b.replace(a.rootPath+"/",""),d=a.tagPath+"/"+c):a.tagPath?(c=b.replace(a.tagPath+"/",""),d=a.tagPath+"/"+c):d=c=b;$("#view option").each(function(b,l){var k=l.value,h=$(l).text(),g=!1;"* "==h.substr(0,2)&&(h=h.substr(2));if("current"==k)g=a.checkPathIsInData(c,p[a.mode].focus);else if("combined"==
k)g=a.checkPathIsInData(c,a.focus.tuix);else if("map"==k)g=a.checkPathIsInData(d,p[a.mode].map);else if(a.focus.files[k]&&a.focus.files[k].tags)(g=a.checkPathIsInData(d,a.focus.files[k].tags))&&(e[k]=h);else return;g&&(h="* "+h);$(l).text(h)});return e};a.drillDownIntoSchema=function(b,e){b===n&&(b="");var c,d,f,h,k="",p=[a.rootPath,b],g={schema:a.schema,data:e,exact:!1,parent:{schema:{},path:""},object:{tag:"",data:e||{},schema:a.schema,path:"",parent:{schema:{},path:""},url:"http://zenar.io/ref-"+
a.schemaName+"-"+a.schema.top_level_page},path:""};if(!g.schema)return g;for(d in p)if(m.has(p,d))for(c in h=p[d].split("/"),h)if(m.has(h,c)){f=h[c];if(""!==f){g.parent.schema=g.schema;g.parent.path=g.path;if(g.schema.properties&&g.schema.properties[f])g.path+=(g.path?"/":"")+f,g.schema=g.schema.properties[f];else if(g.schema.additionalProperties)g.path+=(g.path?"/":"")+f,g.schema=g.schema.additionalProperties;else return a.drillDownIntoSchema2(g);0<d&&(g.data!==n&&"object"==typeof g.data&&g.data[f]!==
n?g.data=g.data[f]:delete g.data);g.schema.properties&&(g.object.tag=f,g.object.lastTag=k,g.object.schema=g.schema,g.object.path=g.path,g.object.data=g.data,g.object.parent.schema=g.parent.schema,g.object.parent.path=g.parent.path,a.pages[f]?g.object.url="http://zenar.io/ref-"+a.schemaName+"-"+f:k&&a.pages[k]&&(g.object.url="http://zenar.io/ref-"+a.schemaName+"-"+k))}k=f}g.exact=!0;return a.drillDownIntoSchema2(g)};a.drillDownIntoSchema2=function(b){var e;b.requiredProperties={};if(b.schema&&b.schema.required)if("object"==
typeof b.schema.required)for(e in b.schema.required)m.has(b.schema.required,e)&&(b.requiredProperties[b.schema.required[e]]=!0);else b.requiredProperties[b.schema.required]=!0;b.object&&(b.object=a.drillDownIntoSchema2(b.object));return b};a.validate=function(){var b=h.getSession(),e="current"==a.lastView||"combined"==a.lastView||"map"==a.lastView,c="organizer_query_ids"!=a.lastView&&"organizer_query_details"!=a.lastView;if(e||c){var d=a.drillDownIntoSchema(),f,l,k=[];if(d.exact){if(f=a.fromFormat(h.getValue(),
a.format))if(d=tv4.validateMultiple(f,d.schema),d.errors&&d.errors.length)for(f=0;f<d.errors.length;++f){var m=d.errors[f].code,g=d.errors[f].dataPath,n=g.split("/").pop(),p=d.errors[f].message,q="error";"/"==g.substr(0,1)&&(g=g.substr(1));if(303==m)if("custom_"==(""+n).substr(0,7))continue;else if(a.internalCMSProperties[n])continue;else q="warning";"error"==q&&!e||"warning"==q&&!c||(l=a.editorGetLineNumberFromPath(g))&&k.push({row:l.number-1,column:l.indent.replace(/\t/g,"    ").length,text:p,type:q})}b.setAnnotations(k)}else b.setAnnotations([])}else b.setAnnotations([])};
a.splitLineByKey=function(b,e){var c,d={},f;e===n&&(e=a.format);if("yaml"==e)f=/^[\s\t]*(\w+):/,d.quote="";else if("json"==e)f=/^[\s\t]*"?(\w+)"?:/,d.quote='"';else if("log"==e)f=/^[\s\t]*([\w\/]+):/,d.quote="";else return!1;return b!==n&&(c=b.match(f))?(c=c[0],d.indent=c.split(/["\w\/]+/),d.key=c.match(/[\w\/]+/),d.indent=d.indent[0],d.key=d.key[0],d.rest=b.substr(c.length),d):!1};a.locatePosition=function(b,e){var c=h.getValue(),d=b||h.getCursorPosition(),f=e||a.showSidebar,l=h.session,k;if("yaml"!=
a.format)if("json"==a.format)quote='"';else return;if(c&&l&&d&&d.row!==n&&(k=l.getLines(0,l.getLength())))for(c=d.row;0<=c;--c)if(d=a.splitLineByKey(k[c])){k[c]=d.indent+d.quote+"____here____"+d.key+d.quote+":"+d.rest;k=k.join("\n");if(k=a.fromFormat(k,a.format))c=a.locatePositionR(k,""),f(c,k);return}f("")};a.locatePositionR=function(b,e){var c="",d;for(d in b)if(m.has(b,d)&&b.hasOwnProperty(d)){if("____here____"===d.substr(0,12))return c=d.substr(12),b[c]=b[d],delete b[d],e+(e?"/":"")+c;if("object"==
typeof b[d]&&(c=a.locatePositionR(b[d],e+(e?"/":"")+d)))return c}};a.editorGetLineNumberFromPath=function(b,e){var c=b.split("/"),d=-1,f=-1,l=h.getValue(),k=h.session,m,g,n=0;if(l&&k&&(m=k.getLines(0,k.getLength()))){a:for(;++d<c.length;){if(!c[d])continue a;for(;n<m.length;++n)if(g=a.splitLineByKey(m[n]))if(g.indent=g.indent.replace("\t","    "),g.key==c[d]&&g.indent.length>f&&(e||g.indent.length<f+5)){f=g.indent.length;g.number=++n;continue a}else if(g.indent.length<=f)break;return!1}return g}return!1};
a.editorSelectPath=function(b,e){b=a.setupPath(b,!0);var c;(c=a.editorGetLineNumberFromPath(b))?(a.editorSetValueByScript=!0,h.gotoLine(c.number),h.scrollToLine(c.number,!0,!1),c.indent&&h.navigateWordRight(),h.getSelection().selectWordRight(),h.focus(),a.showSidebar(b),a.editorSetValueByScript=!1):e?(c=b.split("/"),c.pop(),c.length?(b=c.join("/"),a.editorSelectPath(b,e)):(h.gotoLine(1),h.scrollToLine(1,!0,!1),a.showSidebar(""))):a.showSidebar(b)};a.editorSelectFullPath=function(b){a.rootPath===n?
a.showPathOnLoad=b:(a.rootPath&&(b=b.replace(a.rootPath+"/","")),a.editorSelectPath(b,!0))};a.lastPath="";a.lastRootPath="";a.setupPath=function(b,e){b===n&&(b=a.lastPath,a.lastRootPath!=a.rootPath&&(a.lastRootPath&&(b=a.lastRootPath+"/"+b),a.rootPath&&(b=b.replace(a.rootPath+"/",""))));a.lastPath=b;a.lastRootPath=a.rootPath;return b};a.setHash=function(a){s.location.hash=a;m.currentHash=s.location.hash};a.showSidebar=function(b,e){b=a.setupPath(b);e===n&&(e=a.fromFormat(h.getValue(),a.format));var c;
b&&(c=a.drillDownIntoSchema(b,e));c||(c=a.drillDownIntoSchema("",e));c.paths=[];if(c.path){a.setHash(c.path);a.rootPath?(c.fullPath=a.rootPath+"/"+b,c.localPath=b):c.fullPath=c.localPath=b;"zenarioO"==a.mode&&(c.shortPath=p[a.mode].shortenPath(c.fullPath));b="";var d=c.localPath.split("/"),f;for(f in d)m.has(d,f)&&(c.tag=d[f],b+=(b?"/":"")+d[f],c.paths.push({tag:d[f],path:b}))}c.object.files=a.highlightFilesContainingSelection(b||c.object.path);r("sidebar_inner").innerHTML=q.microTemplate("zenario_dev_tools_sidepanel",
c);u.removeClass("sidebarEmpty").addClass("sidebarFull");a.sizePropertyTable();q.tooltips("#sidebar_inner a[title]");q.tooltips("#sidebar_inner ul[title]");q.tooltips("#sidebar_inner input[title]")};a.sizePropertyTable=function(){if(r("properties_table")){var a=w($("#properties_table .property_name").width(),0,0),a=A.innerWidth()-a-20;$("#properties_table .property_desc").width(a);$("#properties_table .property_desc div").width(a)}};a.editorOnChange=function(b){a.editorSetValueByScript||m.actAfterDelayIfNotSuperseded("dev_tools_editor_change",
function(){a.validate()},2E3)};a.editorOnSelect=function(b){a.editorSetValueByScript||(r("sidebar_inner").innerHTML="",u.addClass("sidebarEmpty").removeClass("sidebarFull"),m.actAfterDelayIfNotSuperseded("dev_tools_editor_select",function(){a.locatePosition()},500))};h.on("change",a.editorOnChange);h.on("changeSelection",a.editorOnSelect);h.on("changeCursor",a.editorOnSelect);h.session.setUseSoftTabs(!1)},$("#toolbar"),$("#editor"),$("#sidebar"),$("#sidebar_inner"),window.devTools=function(){},window.editor=
ace.edit("editor"));
