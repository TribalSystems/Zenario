zenario.lib(function(k,c,A,z,B,t,f,l,C,D,E,r,u,x,F,v,G,H,w,m,q,y){c=createZenarioLibrary("FEA",zenarioF);c=w(c);c.validateFormatOrRedrawForField=function(b){b=this.field(b);return u(b.save_onchange)?(this.save(),!0):w(zenarioF).validateFormatOrRedrawForField.apply(this,arguments)};c.fill=function(){return this.ffov("fill")};c.format=function(){return this.ffov("format")};c.validate=function(){return this.ffov("validate")};c.save=function(){return this.ffov("save")};c.setData=function(b){this.setDataDiff(b)};
c.sendStateToServer=function(){return this.sendStateToServerDiff()};c.ffov=function(b){var a=this,d=new f.callback,e=this.url=f.pluginVisitorTUIXLink(this.moduleClassName,this.slotName,this.path,this.customisationName,this.request,b,!0),g=!1;"fill"!=b&&(this.prevPath=this.path,this.checkValues(),g={_format:!0,_tuix:this.sendStateToServer()});this.loading||(this.showLoader(),this.ajax(e,g,!0).after(function(e){a.hideLoader();"fill"==b?a.tuix=e:a.setData(e);a.tuix.go?(a.tuix.transition_out&&a.transitionOut(a.tuix.transition_out),
a.tuix.transition_in_on_next_screen&&(a.transitionInOnNextScreen=a.tuix.transition_in_on_next_screen),a.go(a.slotName,a.tuix.go)):(a.sortOutTUIX(a.slotName,a.tuix),a.draw(),d.call())}));return d};c.draw=function(){this.draw2()};c.draw2=function(){this.sortTabs();this.tuix.form_title=this.getTitle();var b=new f.callback;$("#plgslt_"+this.slotName).html(this.drawFields(b,this.mtPrefix+"_form",this.tuix));f.addJQueryElements("#plgslt_"+this.slotName+" ");b.call()};c.microTemplate=function(b,a,d){var e;
if(_.isArray(a))for(e in a)a[e].that=this,a[e].tuix||(a[e].tuix=this.tuix);else a.that=this,a.tuix||(a.tuix=this.tuix);b=f.microTemplate(b,a,d);if(_.isArray(a))for(e in a)delete a[e].that,delete a[e].tuix;else delete a.that,delete a.tuix;return b};c.showLoader=function(b){this.removeResponsiveHandler();var a="plgslt_"+this.slotName,d="loader_for_"+a,e=r(a),a=r(d),e=$(e);b?(this.loading=!1,e.removeClass("fea_loading").addClass("fea_loaded").addClass("fea_initial_load_done")):(this.loading=!0,e.removeClass("fea_loaded").addClass("fea_loading"));
if(a)d=$(a);else{if(b)return;d=$(this.microTemplate(this.mtPrefix+"_loading",{loaderId:d}));e.prepend(d)}b?d.hide():d.width(e.width()).height(e.height()).show()};c.hideLoader=function(){this.showLoader(!0)};c.reload=function(b){this.slotName&&this.runLogic(this.slotName,this.request,b||function(){})};c.checkModeAndPathOnRequest=function(b){b.mode?b.path=this.getPathFromMode(b.mode):b.path?b.mode=this.getModeFromPath(b.path):(b.mode=this.defaultMode,b.path=this.getPathFromMode(this.defaultMode))};
c.runLogic=function(b,a,d){this.removeResponsiveHandler();this.checkModeAndPathOnRequest(a);this.mode=a.mode;this.path=a.path;this.request=a;this.slotName=b;this.logic(b,a,d)};c.logic=function(b,a,d){a.path.match(/list/)?this.showList(d):this.showForm(d)};c.showForm=function(b){this.changed={};this.fill().after(b)};c.showList=function(b){if(!this.loading){var a=this,d=this.url=f.pluginVisitorTUIXLink(this.moduleClassName,this.slotName,this.request.path,this.customisationName,this.request);this.showLoader();
this.ajax(d,!1,!0).after(function(d){a.hideLoader();a.tuix=d;a.sortOutTUIX(a.slotName,a.tuix);delete a.responsiveHandler;(d=z.matchMedia&&y.responsive&&1*y.minWidth)?enquire.register(a.responsiveQuery="screen and (min-width: "+d+"px)",a.responsiveHandler={match:function(){a.drawList();b()},doesntMatch:function(){a.drawList(!0);b()}}):(a.drawList(),b())})}};c.drawList=function(b){this.responsive=b;this.hadSparkline=!1;$("#plgslt_"+this.slotName).html(this.microTemplate(this.mtPrefix+"_list",{}));var a=
this;b=1*this.tuix.__page__;var d=1*this.tuix.__page_size__,e=1*this.tuix.__item_count__,g;b&&d&&e&&e>d&&(g="#pagination_"+this.containerId,$(g).show().jPaginator({nbPages:Math.ceil(e/d),selectedPage:b,overBtnLeft:g+"_o_left",overBtnRight:g+"_o_right",maxBtnLeft:g+"_m_left",maxBtnRight:g+"_m_right",onPageClicked:function(b,d){a.go(a.slotName,{page:d})}}));f.addJQueryElements("#plgslt_"+this.slotName+" ");this.hadSparkline&&this.initSparklineChart()};c.removeResponsiveHandler=function(){this.responsiveHandler&&
(enquire.unregister(this.responsiveQuery,this.responsiveHandler),delete this.responsiveHandler)};c.getPathFromMode=function(b){return"zenario_"+b.replace(/^create_/,"edit_")};c.getModeFromPath=function(b){return b.replace(/^zenario_/,"").replace(/^create_/,"edit_")};c.recordRequestsInURL=function(b,a){f.recordRequestsInURL(b,this.checkRequests(a,!0))};c.checkRequests=function(b,a,d,e){var g;b=_.extend({},b,d);this.checkModeAndPathOnRequest(b);if(this.tuix&&this.tuix.key)for(g in this.tuix.key)m(this.tuix.key,
g)&&(d=this.tuix.key[g],b[g]===k&&(b[g]=d));if(!e)for(g in b)m(b,g)&&(d=b[g],""!==d&&!1!==d||delete b[g]);a&&(delete b.path,b.mode==this.defaultMode&&delete b.mode);return b};c.init=function(b,a,d,e,g,c,f,h,n){w(zenarioF).init.call(this,b,a);this.last={};this.pages=f||{};this.prevPath=this.path=this.mode="";this.customisationName=n||"";this.slotName=e;this.containerId="plgslt_"+e;this.defaultMode=c;this.hasEditPerms=h;this.moduleClassName=d;this.go(e,g,k,!0);this.hardcodedPhrase={ok:"OK",retry:"Retry",
unknownMode:"Unknown mode requested",error404:"Could not access a file on the server. Please check that you have uploaded all of the CMS files to the server, and that you have no misconfigured rewrite rules in your Apache config or .htaccess file that might cause a 404 error.",error500:"Something on the server is incorrectly set up or misconfigured.",errorTimedOut:"There was no reply or a blank reply from the server.\n\nThis could be a temporary network problem, or could be a bug in the application."}};
c.editModeOn=function(b){return this.hasEditPerms};c.editModeAlwaysOn=function(b){return this.hasEditPerms};c.debug=function(){this.path&&this.tuix&&this.url&&l.debug(this.globalName)};c.doSearch=function(b){f.stop(b);b=this.request;var a={search:r("search_"+this.containerId).value};this.go(this.slotName,this.checkRequests(b,!1,a));return!1};c.go=function(b,a,d,e){b=q(b);a.mode===k&&a.path===k&&(a.path=this.path);a=this.checkRequests(a,!1,d?{id:d}:k);this.last[b]={request:a};this.prevPath=this.path;
var g,c=this;e||!a.mode||a.mode==this.defaultMode||!(g=this.pages[a.mode])||g.cID==f.cID&&g.cType==f.cType?this.runLogic(b,a,function(){e||c.recordRequestsInURL(b,a);c.transitionInOnNextScreen?c.transitionIn(c.transitionInOnNextScreen):c.newlyNavigated&&c.tuix.transition_in&&c.transitionIn(c.tuix.transition_in);delete c.transitionInOnNextScreen}):(delete a.mode,f.goToURL(f.linkToItem(g.cID,g.cType,a)))};c.hidden=function(b,a,d){return!this.hasEditPerms&&u(b.needs_edit_perms)?!0:l.hidden(b,!0,a,d)};
c.sortOutTUIX=function(b,a){b=q(b);this.newlyNavigated=this.path!=this.prevPath;a.collection_buttons=a.collection_buttons||{};a.item_buttons=a.item_buttons||{};a.columns=a.columns||{};a.items=a.items||{};var d,e,g,c,f,h,n=!1;e=a.sort_by||"name";sortDesc=u(a.sort_desc);a.sortedCollectionButtonIds=l.getSortedIdsOfTUIXElements(a,a.collection_buttons);a.sortedCollectionButtons=[];a.sortedItemButtonIds=l.getSortedIdsOfTUIXElements(a,a.item_buttons);a.sortedItemButtons=[];a.sortedColumnIds=l.getSortedIdsOfTUIXElements(a,
a.columns);a.sortedColumns=[];a.sortedItemIds=a.__item_sort_order__?a.__item_sort_order__:l.getSortedIdsOfTUIXElements(a,"items",e,sortDesc);a.sortedItems=[];for(d in a.sortedColumnIds)m(a.sortedColumnIds,d)&&(e=a.sortedColumnIds[d],f=a.columns[e],f.id=e,this.hidden(f,k,e)||a.sortedColumns.push(f));l.setKin(a.sortedColumns);for(d in a.sortedItemIds)if(m(a.sortedItemIds,d)){e=a.sortedItemIds[d];h=a.items[e];h.id=e;a.sortedItems.push(h);h.sortedItemButtons=[];for(g in a.sortedItemButtonIds)m(a.sortedItemButtonIds,
g)&&(c=a.sortedItemButtonIds[g],f=_.clone(a.item_buttons[c]),f.id=c,this.setupButtonLinks(b,f,e),n&&a.sortedItemButtons.push(f),this.hidden(f,h,c)||h.sortedItemButtons.push(f));n=!1}for(d in a.sortedCollectionButtonIds)m(a.sortedCollectionButtonIds,d)&&(e=a.sortedCollectionButtonIds[d],f=a.collection_buttons[e],f.id=e,this.hidden(f,k,e)||(this.setupButtonLinks(b,f),this.hidden(f,h,c)||a.sortedCollectionButtons.push(f)));this.last[b].tuix=a};c.setupButtonLinks=function(b,a,d){b=q(b);var e,c;if(a.go||
a.ajax||a.confirm)b=this.globalName+".button(this, '"+v(b)+"', '"+v(a.id)+"'",d?(b+=", '"+v(d)+"'",a.go&&(c=this.checkRequests(a.go,!0,{id:d}))):(b+=", undefined",a.go&&(c=this.checkRequests(a.go,!0))),a.onclick&&(b+=", function () {"+a.onclick+"}"),a.onclick=b+"); return false;";a.href===k&&c&&(c.mode&&c.mode!=this.defaultMode&&(e=this.pages[c.mode])&&(e.cID!=f.cID||e.cType!=f.cType)?(delete c.mode,a.href=f.linkToItem(e.cID,e.cType,c)):a.href=f.linkToItem(f.cID,f.cType,c))};c.button=function(b,a,
d,e,c,s){if(!this.loading){delete this.transitionInOnNextScreen;a=q(a);var m=this,h,n=!1,l=this.last[a],p;e!==k?(n=l.tuix.items[e],h=l.tuix.item_buttons[d]):h=l.tuix.collection_buttons[d];if(s||!(p=h.confirm||h.go&&h.go.confirm||h.ajax&&h.ajax.confirm)||this.hidden(p,e,d)){if(c&&(s=c.call(b),s!==k&&!s))return;h.ajax?(h=this.checkRequests(h.ajax.request,!1,{id:e},!0),this.command(a,h,l.request)):(h.transition_out&&this.transitionOut(h.transition_out),h.transition_in_on_next_screen&&(this.transitionInOnNextScreen=
h.transition_in_on_next_screen),this.go(a,h.go,e))}else n&&(p=_.extend({},p),p.message=f.applyMergeFields(p.message,n)),this.confirm(p,function(){m.button(b,a,d,e,c,!0)})}};c.sparkline=function(){Highcharts.SparkLine=function(a,b,d){var c="string"===typeof a||a.nodeName,e=arguments[c?1:0],e=Highcharts.merge({chart:{renderTo:e.chart&&e.chart.renderTo||this,backgroundColor:null,borderWidth:0,type:"area",margin:[2,0,2,0],width:120,height:40,style:{overflow:"visible"},skipClone:!0},title:{text:""},credits:{enabled:!1},
xAxis:{labels:{enabled:!1},title:{text:null},startOnTick:!1,endOnTick:!1,tickPositions:[]},yAxis:{endOnTick:!1,startOnTick:!1,labels:{enabled:!1},title:{text:null},tickPositions:[0]},legend:{enabled:!1},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,hideDelay:0,shared:!0,padding:0,positioner:function(a,b,d){return{x:d.plotX-a/2,y:d.plotY-b}}},plotOptions:{series:{animation:!1,lineWidth:1,shadow:!1,states:{hover:{enabled:!1}},marker:{radius:1,states:{hover:{radius:2}}},fillOpacity:0.25},
column:{negativeColor:"#910000",borderColor:"silver"}}},e);return c?new Highcharts.Chart(a,e,d):new Highcharts.Chart(e,b)};$("td[data-sparkline]");var b,a,d,c;for(d in this.tuix.sortedColumns)if(m(this.tuix.sortedColumns,d)&&(c=this.tuix.sortedColumns[d],c.sparkline))for(b in this.tuix.sortedItems)if(m(this.tuix.sortedItems,b)){a=this.tuix.sortedItems[b];var g=$(r("zfea_"+this.slotName+"_row_"+b+"_col_"+d));a=a[c.id];var f={};a.values?(a.values=$.map(a.values,parseFloat),g.highcharts("SparkLine",
{colors:[a.colour?a.colour:"#82CAFF"],series:[{data:a.values,pointStart:1}],tooltip:{headerFormat:'<span style="font-size: 10px">'+a.label+":</span><br/>",pointFormat:"<b>{point.y}</b> "+a.units},chart:f})):$("#"+("zfea_"+this.slotName+"_row_"+b+"_col_"+d)).html(a.no_data_message)}};c.initSparklineChart=function(){var b=this;f.loadLibrary("zenario/libraries/not_to_redistribute/highcharts/highcharts.min.js",function(){b.sparkline()})};c.transitionIn=function(b){var a=$("#plgslt_"+this.slotName).find(".zfea"),
d=b.options||{};_.isString(d.duration)&&(d.duration*=1);_.isArray(d.easing)&&(d.easing=$.bez(d.easing));b.initial&&a.css(b.initial);b.animate&&a.animate(b.animate,d)};c.transitionOut=function(b){if(b&&b.animate){var a=$("#plgslt_"+this.slotName),d=a.clone().attr("id","").css("position","absolute").addClass("zenario_slot_dummy_for_transition").width(a.width()).height(a.height()).insertBefore(a),c=a.find(".zfea"),g=d.find(".zfea").removeClass("zfea_newly_navigated").addClass("zfea_dummy_for_transition"),
f=b.options||{},k=a.height(),h=a.css("min-height");f.complete=function(){d.remove();a.css("min-height",h)};a.css("min-height",k+"px");_.isString(f.duration)&&(f.duration*=1);_.isArray(f.easing)&&(f.easing=$.bez(f.easing));g.animate(b.animate,f);c.hide()}};c.confirm=function(b,a){if(!this.loading){if(!_.isFunction(a)&&a._zenario_confirmed)return delete a._zenario_confirmed,!0;$.colorbox({transition:"none",closeButton:!1,html:this.microTemplate(this.mtPrefix+"_confirm",b),className:"zfea_colorbox_content"+
(b.css_class?" "+b.css_class:"")});_.isFunction(a)?$("#zfea_do_it").click(function(){$.colorbox.remove();a()}):$("#zfea_do_it").click(function(){$.colorbox.remove();a._zenario_confirmed=!0;$(a).click()})}};c.command=function(b,a,d){if(!this.loading){b=q(b);$.colorbox.remove();var c=this,g=f.pluginAJAXLink(this.moduleClassName,b);this.showLoader();this.ajax(g,a).after(function(a){c.hideLoader();a?c.AJAXErrorHandler(a):c.go(b,d)})}};c.phrase=function(b,a){return f.phrase(f.slots[this.slotName]&&f.slots[this.slotName].moduleClassNameForPhrases,
b,a)};c.ajax=function(b,a,d){var c=t&&t.zenarioAB&&t.zenarioAB.previewValues;if(c){if(!1===a||a===k)a={};_.isObject(a)?a.overrideSettings=c:a+="&overrideSettings="+encodeURIComponent(c)}return f.ajax(b,a,d,!1,!0,k,k,this.AJAXErrorHandler,function(){$.colorbox.remove()})};c.pickerLink=function(b,a){var c;return(c=this.pages[b])?this.showSingleSlotLink(c.slotName,a,!1,c.cID,c.cType):!1};c.AJAXErrorHandler=function(b,a,c){var e=this,f="",k={};if(_.isString(b))f=x(b);else{c&&(f+="<h1><b>"+x(b.status+
" "+c)+"</b></h1>");if(404==b.status)f+="<p>"+this.hardcodedPhrase.error404+"</p>";else if(500==b.status)f+="<p>"+this.hardcodedPhrase.error500+"</p>";else if(0==b.status||"timeout"==a)f+="<p>"+this.hardcodedPhrase.errorTimedOut+"</p>";b.responseText&&(f+="<div>"+b.responseText+"</div>")}showErrorMessage=function(){k.body=f;k.retry=!!b.zenario_retry;$.colorbox({transition:"none",closeButton:!1,html:e.microTemplate(e.mtPrefix+"_error",k)});b.zenario_retry&&$("#zfea_retry").click(function(){setTimeout(b.zenario_retry,
1)})};0==b.status||"timeout"==a?setTimeout(showErrorMessage,750):showErrorMessage()}},zenario.getSlotnameFromEl,window.zenarioGrid||{});
