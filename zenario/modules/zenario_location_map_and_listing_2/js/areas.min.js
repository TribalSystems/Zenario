var defaultMapCentreLat,defaultMapCentreLng,defaultMapZoom,ne_lat,ne_lng,sw_lat,sw_lng,polygon_colour,map,editMode,drawingManager,polygons=[],selectedShape,all_overlays=[],flightPath;
function init(){new google.maps.LatLng(-34.397,150.644);if(ne_lat&&ne_lng&&sw_lat&&sw_lng&&zoom){var a=new google.maps.LatLng(ne_lat,ne_lng),c=new google.maps.LatLng(sw_lat,sw_lng);a=new google.maps.LatLngBounds(c,a);c={mapTypeId:google.maps.MapTypeId.ROADMAP}}else c={center:new google.maps.LatLng(defaultMapCentreLat,defaultMapCentreLng),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),c);ne_lat&&ne_lng&&sw_lat&&sw_lng&&zoom&&(map.setCenter(a.getCenter()),
map.setZoom(zoom));ne_lat&&ne_lng&&sw_lat&&sw_lng&&zoom&&(map.setCenter(a.getCenter()),map.setZoom(zoom));drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{strokeColor:"#"+polygon_colour,strokeOpacity:1,strokeWeight:2,fillColor:"#"+polygon_colour,fillOpacity:.45,draggable:!0,editable:!0}});drawingManager.setMap(map);parent.document.getElementById("polygon_points").value&&
(paintPath(),drawingManager.setDrawingMode(null),drawingManager.setOptions({drawingControl:!1}));google.maps.event.addListener(drawingManager,"overlaycomplete",function(d){all_overlays.push(d);if(d.type!=google.maps.drawing.OverlayType.MARKER){var b=d.overlay;b.type=d.type;google.maps.event.addListener(b,"click",function(){setSelection(b)});setSelection(b)}});google.maps.event.addListener(drawingManager,"polygoncomplete",function(d){var b=d.getPath().getArray();var e=getStringPoints(b);parent.document.getElementById("polygon_points").value=
e;google.maps.event.addListener(d.getPath(),"set_at",function(){b=d.getPath().getArray();e=getStringPoints(b);parent.document.getElementById("polygon_points").value=e});google.maps.event.addListener(d.getPath(),"insert_at",function(){b=d.getPath().getArray();e=getStringPoints(b);parent.document.getElementById("polygon_points").value=e});drawingManager.setMap(null)});google.maps.event.addListener(map,"bounds_changed",function(){var d=map.getBounds(),b=d.getNorthEast();d=d.getSouthWest();ne_lat=b.lat();
ne_lng=b.lng();sw_lat=d.lat();sw_lng=d.lng();parent.document.getElementById("ne_lat").value=ne_lat;parent.document.getElementById("ne_lng").value=ne_lng;parent.document.getElementById("sw_lat").value=sw_lat;parent.document.getElementById("sw_lng").value=sw_lng;parent.document.getElementById("zoom").value=map.getZoom()});google.maps.event.addDomListener(document.getElementById("delete-button"),"click",deleteAllShape)}
function deleteAllShape(){drawingManager.setOptions({drawingControl:!0});deleteSelectedShape();parent.document.getElementById("polygon_points").value=null;for(var a=0;a<all_overlays.length;a++)all_overlays[a].overlay.setMap(null);all_overlays=[];removeLine();drawingManager.setMap(map);drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)}function setSelection(a){selectedShape=a;a.setEditable(!0)}
function deleteSelectedShape(){selectedShape&&selectedShape.setMap(null);removeLine();drawingManager.setOptions({drawingControl:!0})}function removeLine(){parent.document.getElementById("polygon_points").value&&flightPath&&flightPath.setMap(null)}function getStringPoints(a){var c,d=a.length;for(c=0;c<d;c++)var b=b?b+","+a[c].lat()+"_"+a[c].lng():a[c].lat()+"_"+a[c].lng();return b}
function paintPath(){var a=[],c=[],d=[],b=parent.document.getElementById("polygon_points").value.split(","),e;for(e=0;e<b.length;e++){var f=b[e].split("_"),g=f[1];a.push(f[0]);c.push(g)}for(b=0;b<a.length;b++)d.push(new google.maps.LatLng(a[b],c[b]));d.push(new google.maps.LatLng(a[0],c[0]));flightPath=new google.maps.Polygon({path:d,geodesic:!0,draggable:!0,editable:!0,strokeColor:"#"+polygon_colour,strokeOpacity:1,strokeWeight:2,fillColor:"#"+polygon_colour,fillOpacity:.45});flightPath.setMap(map);
google.maps.event.addListener(flightPath.getPath(),"set_at",function(){arrayOfPoints=flightPath.getPath().getArray();stringPoints=getStringPoints(arrayOfPoints);parent.document.getElementById("polygon_points").value=stringPoints});google.maps.event.addListener(flightPath.getPath(),"insert_at",function(){arrayOfPoints=flightPath.getPath().getArray();stringPoints=getStringPoints(arrayOfPoints);parent.document.getElementById("polygon_points").value=stringPoints})}
function geocodeAddress(){(new google.maps.Geocoder).geocode({address:document.getElementById("address_to_geocode").value},function(a,c){c==google.maps.GeocoderStatus.OK?(map.setCenter(a[0].geometry.location),map.fitBounds(a[0].geometry.viewport)):alert("Geocode was not successful for the following reason: "+c)})}
function geoCodeViewport(){(new google.maps.Geocoder).geocode({address:document.getElementById("address").value},function(a,c){c==google.maps.GeocoderStatus.OK?(map.setCenter(a[0].geometry.location),map.fitBounds(a[0].geometry.viewport)):alert("Geocode was not successful for the following reason: "+c)})};
