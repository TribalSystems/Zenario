zenario_slideshow_2.openImageManager=function(b,c,a){b.blur();var d=this;this.AJAXLink=a;this.slotName=c;this.errors={};this.tempSlideId=1;this.uploadChangeImage=!1;zenario.ajax(a+"&mode=get_details").after(function(a){a=JSON.parse(a);d.data=a;d.slides=a.slides;d.tabs=a.tabs;d.dataset_fields=a.dataset_fields;d.mobile_option=a.mobile_option;_.isEmpty(a.slides)&&(a.slides={});var b=_.toArray(d.slides);b.sort(function(a,b){return a.ordinal-b.ordinal});0==d.slides.length?(d.slides={},d.current=0):d.current=
b[0].id;b={slotName:c,instanceId:zenario.slots[c].instanceId,slideDetails:b};a.recommededSize&&(b.recommededSize=!0,b.recommededSizeMessage=a.recommededSizeMessage);a=zenarioA.microTemplate("zenario_image_manager",b);zenarioA.openBox(a,"zenario_fbAdminImageManager","AdminImageManager",void 0,1E3,void 0,2,!0,!0,".zenario_dragMe",!1,!1);d.makeListSortable();d.tempSaveOrder();d.selectSlide(d.current,!0);zenarioA.canDoHTML5Upload()&&zenarioA.setHTML5UploadFromDragDrop(d.AJAXLink,{mode:"file_upload"},
!1,d.uploadImagesCallback,document.getElementById("zenario_slideshow_drop_target"));d.resize();d.size();$("input").change(function(){d.somethingChanged=!0})})};
zenario_slideshow_2.selectSlide=function(b,c){if(b&&this.data.slides[b]){c||this.tempSaveData(this.current);this.highlightSlide(b);var a=this.data.slides[b];"internal"!=a.target_loc||a.content_item_tag_id||(a.content_item_link="Nothing selected");a.rollover_image_id||(a.rollover_image_src_thumbnail_1="zenario/modules/zenario_slideshow_2/images/image-in-slot-placeholder.png",a.r_alt_tag="No image");a.mobile_image_id||(a.mobile_image_src_thumbnail_1="zenario/modules/zenario_slideshow_2/images/image-in-slot-placeholder.png",
a.m_alt_tag="No image");a.open_in_new_window=zenario.engToBoolean(a.open_in_new_window);a.link_to_translation_chain=zenario.engToBoolean(a.link_to_translation_chain);a.use_transition_code=zenario.engToBoolean(a.use_transition_code);a.hidden=zenario.engToBoolean(a.hidden);a.has_tabs=this.tabs;var d=function(a,b){var c=[];for(key in a)a.hasOwnProperty(key)&&(key==b&&(a[key].selected=!0),a[key].value=key,c.push(a[key]));c.sort(e);return c},e=function(a,b){return+a.ord<+b.ord?-1:+a.ord>+b.ord?1:0},g=
{},g={none:{label:"Don't link",ord:1},internal:{label:"Internal - link to a content item",ord:2},external:{label:"External - link to a full URL",ord:3}};a.target_loc_list=d(g,a.target_loc);g={everyone:{label:"Everyone",ord:1},logged_in:{label:"Logged-in users",ord:2},logged_out:{label:"Anonymous visitors",ord:3},logged_in_with_field:{label:"Logged-in users with dataset field",ord:4},logged_in_without_field:{label:"Logged-in users without dataset field",ord:5},call_static_method:{label:"Call a module's static method (advanced)",
ord:6}};a.slide_visibility_list=d(g,a.slide_visibility);this.dataset_fields[""]={label:"-- Select --",ord:0};a.field_id_list=d(this.dataset_fields,a.field_id);this.displaySlideDetails(a);this.current=b}else 0===b&&this.displaySlideDetails({id:b});this.size()};zenario_slideshow_2.displaySlideDetails=function(b){b=zenarioA.microTemplate("zenario_slide_details",b);$("#zenario_slide_attributes_inner").html(b);this.bindEventListeners()};
zenario_slideshow_2.highlightSlide=function(b){b&&this.data.slides[b]&&($("#zenario_sortable li#zenario_slide_image_"+this.current).css("border","none").removeClass("slideshow_selected_image"),$("#zenario_sortable li#zenario_slide_image_"+b).css("border","solid 2px red").addClass("slideshow_selected_image"))};
zenario_slideshow_2.tempSaveData=function(b){if(b&&this.data.slides[b]){var c=[];serial=$("#zenario_slide_settings_form").serializeArray();for(var a in serial)serial.hasOwnProperty(a)&&(c[serial[a].name]=serial[a].value);a=["open_in_new_window","link_to_translation_chain","use_transition_code","hidden"];for(var d in a)a.hasOwnProperty(d)&&void 0===c[a[d]]&&(c[a[d]]=0);for(d in c)if(c.hasOwnProperty(d)){var e=c[d];-1!=$.inArray(d,a)&&(e=zenario.engToBoolean(e));this.data.slides[b][d]=e}}};
zenario_slideshow_2.tempSaveOrder=function(){this.slideOrderedIds=$("#zenario_sortable").sortable("toArray",{attribute:"data-id"})};zenario_slideshow_2.closeImageManager=function(b){if(b||!this.somethingChanged||confirm("You are currently editing this floating admin box. If you leave now you will loose any unsaved changes."))this.sizing&&clearTimeout(this.sizing),zenario.nonAsyncAJAX(this.AJAXLink,{mode:"close_image_manager",save:void 0==b?0:1}),this.somethingChanged=!1,zenarioA.closeBox("AdminImageManager")};
zenario_slideshow_2.bindEventListenersImageChanger=function(){var b=this;$("#zenario_organizer_option").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger");b.organizerChangeImage()});$("#zenario_upload_option").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger");b.uploadChangeImage=!0;b.uploadImages()});$("#zenario_close_image_changer").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger")})};
zenario_slideshow_2.bindEventListenersTransitionCodes=function(){var b=this;$("#zenario_transition_code").change(function(){b.somethingChanged=!0});$("#zenario_transition_code").keyup(function(){b.somethingChanged=!0});$("#zenario_close_transition_code_box").off().on("click",function(){b.slides[b.current].transition_code=$("#zenario_transition_code").val();zenarioA.closeBox("AdminImageManager_TransitionCodes")})};
zenario_slideshow_2.bindEventListeners=function(){var b=this;$("#zenario_show_transition_box").off().on("click",function(){var a=zenarioA.microTemplate("zenario_transition_code_box",{code:b.slides[b.current].transition_code});zenarioA.openBox(a,"zenario_fbAdminImageManager_TransitionCodes","AdminImageManager_TransitionCodes",void 0,200,void 0,void 0,!0,!0,".zenario_dragMe",!1);b.bindEventListenersTransitionCodes()});$("#zenario_change_image").off().on("click",function(a,c){b.rememberImageType=c;var e=
zenarioA.microTemplate("zenario_image_changer",{});zenarioA.openBox(e,"zenario_fbAdminImageManager_ImageChanger","AdminImageManager_ImageChanger",void 0,200,void 0,void 0,!0,!0,".zenario_image_changer",!1);b.bindEventListenersImageChanger()});$("#zenario_change_rollover_image").off().on("click",function(){$("#zenario_change_image").trigger("click","rollover")});$("#zenario_change_mobile_image").off().on("click",function(){$("#zenario_change_image").trigger("click","mobile")});$("#zenario_remove_rollover_image").off().on("click",
function(){var a=b.slides[b.current];a.r_filename=a.r_alt_tag=a.r_height=a.r_width=a.true_r_width=a.true_r_height=a.rollover_image_id=a.rollover_image_src=a.rollover_image_src_thumbnail_1=a.rollover_overwrite_alt_tag=null;b.selectSlide(b.current);b.somethingChanged=!0});$("#zenario_remove_mobile_image").off().on("click",function(){var a=b.slides[b.current];a.m_filename=a.m_alt_tag=a.m_height=a.m_width=a.true_m_width=a.true_m_height=a.mobile_image_id=a.mobile_image_src=a.mobile_image_src_thumbnail_1=
a.mobile_overwrite_alt_tag=a.mobile_tab_name=a.mobile_slide_title=a.mobile_slide_extra_html=null;b.selectSlide(b.current);b.somethingChanged=!0});$("#zenario_edit_main_image").off().on("click",function(){b.rememberImageType="";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").show();$("#zenario_rollover_image_details").hide();$("#zenario_mobile_image_details").hide()});$("#zenario_edit_rollover_image").off().on("click",function(){b.rememberImageType=
"rollover";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").hide();$("#zenario_rollover_image_details").show();$("#zenario_mobile_image_details").hide()});if("seperate_fixed"==this.mobile_option)$("#zenario_edit_mobile_image").off().on("click",function(){b.rememberImageType="mobile";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").hide();$("#zenario_rollover_image_details").hide();$("#zenario_mobile_image_details").show()});
else $("#zenario_edit_mobile_image").text("Mobile Image (Disabled in properties)").addClass("disabled");$("#zenario_select_link_type").off().on("change",function(){b.selectSlide(b.current)});$("#zenario_select_slide_visibility").off().on("change",function(){b.selectSlide(b.current)});$("#zenario_external_link").off().on("blur",function(){"http://"==this.value&&(this.value="")});$("#zenario_external_link").on("focus",function(){this.value||(this.value="http://")});var c=function(a){b.tempSaveData(b.current);
data={mode:"save_slides",slides:JSON.stringify(b.data.slides),ordinals:b.slideOrderedIds.join(",")};zenario.ajax(zenario.addBasePath(b.AJAXLink),data).after(function(c){b.errors=JSON.parse(c);if(_.isEmpty(b.errors))zenario.refreshPluginSlot(b.slotName,"lookup"),$("#zenario_slideshow_error_display").html("");else{var e="";for(key in b.errors)b.errors.hasOwnProperty(key)&&b.errors[key].forEach(function(a){e+='<div class="error">Slide '+(+key+1)+": "+a+"</div>"});$("#zenario_slideshow_error_display").html(e)}a&&
_.isEmpty(b.errors)&&b.closeImageManager("save")})};$("#zenario_save_continue").off().on("click",function(){c(!1)});$("#zenario_save_close").off().on("click",function(){c(!0)})};zenario_slideshow_2.organizerChangeImage=function(){zenarioA.organizerSelect("zenario_slideshow_2","organizerChangeImageCallback",!1,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};
zenario_slideshow_2.organizerChangeImageCallback=function(b,c,a){b=this.rememberImageType;c=zenario.nonAsyncAJAX(this.AJAXLink+"&mode=change_image_from_organizer&new_image_id="+c.id,!1,!0);a=this.slides[this.current];switch(b){case "rollover":a.r_filename=c.filename;a.r_alt_tag=c.alt_tag;a.rollover_image_src=c.image_src;a.rollover_image_src_thumbnail_1=c.image_src_thumbnail_1;a.rollover_image_id=c.image_id;a.r_height=a.true_r_height=c.height;a.r_width=a.true_r_width=c.width;break;case "mobile":a.m_filename=
c.filename;a.m_alt_tag=c.alt_tag;a.mobile_image_src=c.image_src;a.mobile_image_src_thumbnail_1=c.image_src_thumbnail_1;a.mobile_image_id=c.image_id;a.m_height=a.true_m_height=c.height;a.m_width=a.true_m_width=c.width;break;default:a.filename=c.filename,a.alt_tag=c.alt_tag,a.image_src=c.image_src,a.image_src_thumbnail_2=c.image_src_thumbnail_2,a.image_src_thumbnail_1=c.image_src_thumbnail_1,a.image_id=c.image_id,a.true_height=a.height=c.height,a.true_width=a.width=c.width,$("#zenario_slide_"+this.current).attr({src:a.image_src_thumbnail_2,
alt:a.alt})}this.selectSlide(this.current);this.rememberImageType=void 0};zenario_slideshow_2.organizerPickUserCharacteristicCallback=function(b,c,a){$("#zenario_user_characteristic").val(a.name)};
zenario_slideshow_2.pickContentItemLinkFromOrganizer=function(){var b="zenario__content/panels/content";$("#zenario_content_item_id").val()&&(b="zenario__content/panels/content//"+$("#zenario_content_item_id").val());zenarioA.organizerSelect("zenario_slideshow_2","organizerPickContentItemLinkCallback",!1,b,"zenario__content/panels/content","zenario__content/panels/content",!1,!0)};zenario_slideshow_2.organizerPickContentItemLinkCallback=function(b,c,a){$("#zenario_content_item_link").val(a.tag);$("#zenario_content_item_id").val(c.id)};
zenario_slideshow_2.pickImagesFromOrganizer=function(){zenarioA.organizerSelect("zenario_slideshow_2","organizerPickImagesCallback",!0,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};
zenario_slideshow_2.uploadImages=function(){var b=this,c={mode:"file_upload"},a=!zenarioA.canDoHTML5Upload(),d='<input type="file" name="Filedata" accept="image/*"';a&&(c._html5_backwards_compatibility_hack=1,d+=' id="zenario_fallback_fileupload"');a||(d+=" multiple");d+="/>";if(a){var a="",d='<form id="zenario_bc_form" action="'+htmlspecialchars(this.AJAXLink)+'" onsubmit="/*...*/" target="zenario_iframe" method="post" enctype="multipart/form-data">'+d,e;for(e in c)d+='<input type="hidden" value="'+
htmlspecialchars(c[e])+'" name="'+htmlspecialchars(e)+'"/>';a='<input type="button" class="submit_selected" value="'+zenarioA.phrase.upload+'" onclick="get(\'zenario_bc_form\').submit();"/>';a+='<input type="button" class="submit" value="'+zenarioA.phrase.cancel+'"/>';zenarioA.showMessage(d+"</form>",a);zenario.browserIsIE()||$("#zenario_fallback_fileupload").click()}else d=$(d),d.change(function(){zenarioA.doHTML5Upload(this.files,b.AJAXLink,c,function(a){b.uploadImagesCallback(a)})}),d.click()};
zenario_slideshow_2.organizerPickImagesCallback=function(b,c,a){var d=this;this.somethingChanged=!0;var e=[];zenario.nonAsyncAJAX(this.AJAXLink+"&mode=add_slides_from_organizer&ids="+c.id,!1,!0).forEach(function(a){var b="t"+d.tempSlideId;e.push(b);d.data.slides[b]=a;d.addGenericImageAttributes(b);d.addSlideToList(d.data.slides[b]);d.tempSlideId++});this.addNewImagesCallback(e)};
zenario_slideshow_2.uploadImagesCallback=function(b){var c=this;this.somethingChanged=!0;if(this.uploadChangeImage){var a=this.slides[this.current];switch(this.rememberImageType){case "rollover":a.r_filename=b[0].filename;a.r_alt_tag=b[0].filename;a.rollover_image_src=b[0].link;a.rollover_image_src_thumbnail_1=b[0].link+"&height=150&width=300";a.rollover_image_id=0;a.r_height=a.true_r_height=b[0].height;a.r_width=a.true_r_width=b[0].width;a.r_cache_id=b[0].id;break;case "mobile":a.m_filename=b[0].filename;
a.m_alt_tag=b[0].filename;a.mobile_image_src=b[0].link;a.mobile_image_src_thumbnail_1=b[0].link+"&height=150&width=300";a.mobile_image_id=0;a.m_height=a.true_m_height=b[0].height;a.m_width=a.true_m_width=b[0].width;a.m_cache_id=b[0].id;break;default:a.filename=b[0].filename,a.alt_tag=b[0].filename,a.image_src=b[0].link,a.image_src_thumbnail_1=b[0].link+"&height=150&width=300",a.image_src_thumbnail_2=b[0].link+"&height=150&width=150",a.image_id=0,a.true_height=a.height=b[0].height,a.true_width=a.width=
b[0].width,a.cache_id=b[0].id,$("#zenario_slide_"+this.current).attr({src:a.image_src_thumbnail_1,alt:a.alt})}this.selectSlide(this.current);this.uploadChangeImage=!1;this.rememberImageType=void 0}else{var d=[];b.forEach(function(a){var b="t"+c.tempSlideId;d.push(b);c.data.slides[b]={};var f=c.data.slides[b];c.addGenericImageAttributes(b);f.filename=a.filename;f.alt_tag=a.filename;f.width=f.true_width=a.width;f.height=f.true_height=a.height;f.image_src=a.link;f.image_src_thumbnail_1=a.link+"&height=150&width=300";
f.image_src_thumbnail_2=a.link+"&height=150&width=150";f.image_id=0;f.cache_id=a.id;c.addSlideToList(f);c.tempSlideId++});this.addNewImagesCallback(d)}};
zenario_slideshow_2.addGenericImageAttributes=function(b){var c=this.data.slides[b];c.id=b;c.overwrite_alt_tag="";c.tab_name="";c.slide_title="";c.slide_extra_html="";c.slide_more_link_text="";c.rollover_overwrite_alt_tag="";c.mobile_overwrite_alt_tag="";c.mobile_tab_name="";c.mobile_slide_title="";c.mobile_slide_extra_html="";c.target_loc="none";c.dest_url="";c.open_in_new_window=0;c.slide_visibility="everyone";c.plugin_class="";c.method_name="";c.param_1="";c.param_2="";c.field_id=0;c.link_to_translation_chain=
"";c.transition_code="";c.use_transition_code=0;c.hidden=0};zenario_slideshow_2.addSlideToList=function(b){b='<li id="zenario_slide_image_'+b.id+'" data-id="'+b.id+'"> \t\t\t<div onclick="zenario_slideshow_2.selectSlide(\''+b.id+'\', true);"> \t\t\t\t<img src="'+b.image_src_thumbnail_2+'" alt="'+b.alt_tag+'" id="zenario_slide_'+b.id+'"/> \t\t\t</div> \t\t</li>';$("#zenario_sortable").append(b)};zenario_slideshow_2.addNewImagesCallback=function(b){this.tempSaveOrder();0==this.current&&this.selectSlide(this.slideOrderedIds[0])};
zenario_slideshow_2.makeListSortable=function(){var b=this;$("#zenario_sortable").sortable({update:function(c,a){b.tempSaveOrder()}})};zenario_slideshow_2.deleteSlide=function(){if(!_.isEmpty(this.data.slides)){this.somethingChanged=!0;var b=this.current,c=0<=this.slideOrderedIds.indexOf(b)-1?this.slideOrderedIds.indexOf(b)-1:0;delete this.data.slides[b];$("li#zenario_slide_image_"+b).remove();this.tempSaveOrder();nextSlideId=_.isEmpty(this.data.slides)?this.current=0:this.slideOrderedIds[c];this.selectSlide(nextSlideId)}};
zenario_slideshow_2.selectLastImage=function(){_.isEmpty(this.data.slides)||this.selectSlide(this.slideOrderedIds[this.slideOrderedIds.length-1])};zenario_slideshow_2.selectFirstImage=function(){_.isEmpty(this.slides)||this.selectSlide(this.slideOrderedIds[0])};zenario_slideshow_2.nudgeImageUp=function(){if(!_.isEmpty(this.data.slides)){var b=$(".slideshow_selected_image");b.prev().before(b);this.tempSaveOrder()}};
zenario_slideshow_2.nudgeImageDown=function(){if(!_.isEmpty(this.data.slides)){var b=$(".slideshow_selected_image");b.next().after(b);this.tempSaveOrder()}};
zenario_slideshow_2.resize=function(){maxHeight=800;this.sizing&&clearTimeout(this.sizing);if(get("zenario_fbAdminInner")){var b=Math.floor(0.96*$(window).height()-150);b>maxHeight&&(b=maxHeight);0<(b*=1)&&(get("zenario_fbAdminInner").style.height=b+"px",get("zenario_slides").style.height=get("zenario_slide_attributes").style.height=b-60+"px")}this.sizing=setTimeout(zenario_slideshow_2.resize,250)};
zenario_slideshow_2.size=function(){var b=$("#zenario_main_image_details"),c=$("#zenario_rollover_image_details"),a=$("#zenario_mobile_image_details"),d=$("#zenario_slide_settings"),e;b.css("height","auto");c.css("height","auto");a.css("height","auto");d.css("height","auto");e=Math.max(b.height(),c.height(),a.height(),d.height());b.height(e);c.height(e);a.height(e);d.height(e)};
