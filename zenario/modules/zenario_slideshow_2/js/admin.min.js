zenario_slideshow_2.openImageManager=function(a,c,b){a.blur();var d=this;this.AJAXLink=b;this.slotName=c;this.errors={};this.tempSlideId=1;this.uploadChangeImage=!1;zenario.ajax(b+"&mode=get_details").after(function(a){a=JSON.parse(a);d.data=a;d.slides=a.slides;d.tabs=a.tabs;d.dataset_fields=a.dataset_fields;d.mobile_option=a.mobile_option;_.isEmpty(a.slides)&&(a.slides={});var b=_.toArray(d.slides);b.sort(function(a,b){return a.ordinal-b.ordinal});0==d.slides.length?(d.slides={},d.current=0):d.current=
b[0].id;b={slotName:c,instanceId:zenario.slots[c].instanceId,slideDetails:b};a.recommededSize&&(b.recommededSize=!0,b.recommededSizeMessage=a.recommededSizeMessage);a=zenarioA.microTemplate("zenario_image_manager",b);zenarioA.openBox(a,"zenario_fbAdminImageManager","AdminImageManager",void 0,1E3,void 0,2,!0,!0,".zenario_dragMe",!1,!1);d.makeListSortable();d.tempSaveOrder();d.selectSlide(d.current);zenarioA.canDoHTML5Upload()&&zenarioA.setHTML5UploadFromDragDrop(d.AJAXLink,{mode:"file_upload"},!1,
d.uploadImagesCallback,document.getElementById("zenario_slideshow_drop_target"));d.resize();d.size();$("input").change(function(){d.somethingChanged=!0})})};
zenario_slideshow_2.selectSlide=function(a){if(a&&this.data.slides[a]){this.tempSaveData(this.current);this.highlightSlide(a);var c=this.data.slides[a];c.has_tabs=this.data.tabs;switch(c.target_loc){case "internal":c.content_item_tag_id=c.dest_url;break;case "external":c.external_link=c.dest_url}c.rollover_image_id||(c.rollover_image_src_thumbnail_1="zenario/modules/zenario_slideshow_2/images/image-in-slot-placeholder.png",c.r_alt_tag="No image");c.mobile_image_id||(c.mobile_image_src_thumbnail_1=
"zenario/modules/zenario_slideshow_2/images/image-in-slot-placeholder.png",c.m_alt_tag="No image");c.open_in_new_window=zenario.engToBoolean(c.open_in_new_window);c.link_to_translation_chain=zenario.engToBoolean(c.link_to_translation_chain);c.use_transition_code=zenario.engToBoolean(c.use_transition_code);c.hidden=zenario.engToBoolean(c.hidden);var b=function(a,b){var c=[];for(key in a)a.hasOwnProperty(key)&&(key==b&&(a[key].selected=!0),a[key].value=key,c.push(a[key]));c.sort(d);return c},d=function(a,
b){return+a.ord<+b.ord?-1:+a.ord>+b.ord?1:0},e={},e={none:{label:"Don't link",ord:1},internal:{label:"Internal - link to a content item",ord:2},external:{label:"External - link to a full URL",ord:3}};c.target_loc_list=b(e,c.target_loc);e={everyone:{label:"Everyone",ord:1},logged_in:{label:"Logged-in users",ord:2},logged_out:{label:"Anonymous visitors",ord:3},logged_in_with_field:{label:"Logged-in users with dataset field",ord:4},logged_in_without_field:{label:"Logged-in users without dataset field",
ord:5},call_static_method:{label:"Call a module's static method (advanced)",ord:6}};c.slide_visibility_list=b(e,c.slide_visibility);this.dataset_fields[""]={label:"-- Select --",ord:0};c.field_id_list=b(this.dataset_fields,c.field_id);this.displaySlideDetails(c);this.current=a}else 0===a&&this.displaySlideDetails({id:a});zenario_slideshow_2.size()};
zenario_slideshow_2.displaySlideDetails=function(a){a=zenarioA.microTemplate("zenario_slide_details",a);$("#zenario_slide_attributes_inner").html(a);this.bindEventListeners();$("#zenario_select_link_type").change();$("#zenario_select_slide_visibility").change()};
zenario_slideshow_2.highlightSlide=function(a){a&&this.data.slides[a]&&($("#zenario_sortable li#zenario_slide_image_"+this.current).css("border","none").removeClass("slideshow_selected_image"),$("#zenario_sortable li#zenario_slide_image_"+a).css("border","solid 2px red").addClass("slideshow_selected_image"))};
zenario_slideshow_2.tempSaveData=function(a){if(a&&this.data.slides[a]){var c=[];serial=$("#zenario_slide_settings_form").serializeArray();for(var b in serial)serial.hasOwnProperty(b)&&(c[serial[b].name]=serial[b].value);b=["open_in_new_window","link_to_translation_chain","use_transition_code","hidden"];for(var d in b)b.hasOwnProperty(d)&&void 0===c[b[d]]&&(c[b[d]]=0);for(d in c)if(c.hasOwnProperty(d)){var e=c[d];-1!=$.inArray(d,b)&&(e=zenario.engToBoolean(e));if(-1==$.inArray(d,["content_item_link",
"content_item_tag_id","external_link"])){if("target_loc"==d)switch(c[d]){case "internal":this.data.slides[a].content_item_link=c.content_item_link;this.data.slides[a].dest_url=c.content_item_tag_id;break;case "external":this.data.slides[a].dest_url=c.external_link;break;case "none":this.data.slides[a].dest_url=""}this.data.slides[a][d]=e}}}};zenario_slideshow_2.tempSaveOrder=function(){this.slideOrderedIds=$("#zenario_sortable").sortable("toArray",{attribute:"data-id"})};
zenario_slideshow_2.closeImageManager=function(a){if(a||!this.somethingChanged||confirm("You are currently editing this floating admin box. If you leave now you will loose any unsaved changes."))this.sizing&&clearTimeout(this.sizing),zenario.nonAsyncAJAX(this.AJAXLink,{mode:"close_image_manager",save:void 0==a?0:1}),this.somethingChanged=!1,zenarioA.closeBox("AdminImageManager")};
zenario_slideshow_2.bindEventListenersImageChanger=function(){var a=this;$("#zenario_organizer_option").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger");a.organizerChangeImage()});$("#zenario_upload_option").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger");a.uploadChangeImage=!0;a.uploadImages()});$("#zenario_close_image_changer").off().on("click",function(){zenarioA.closeBox("AdminImageManager_ImageChanger")})};
zenario_slideshow_2.bindEventListenersTransitionCodes=function(){var a=this;$("#zenario_transition_code").change(function(){a.somethingChanged=!0});$("#zenario_transition_code").keyup(function(){a.somethingChanged=!0});$("#zenario_close_transition_code_box").off().on("click",function(){a.slides[a.current].transition_code=$("#zenario_transition_code").val();zenarioA.closeBox("AdminImageManager_TransitionCodes")})};
zenario_slideshow_2.bindEventListeners=function(){var a=this;$("#zenario_show_transition_box").off().on("click",function(){var b=zenarioA.microTemplate("zenario_transition_code_box",{code:a.slides[a.current].transition_code});zenarioA.openBox(b,"zenario_fbAdminImageManager_TransitionCodes","AdminImageManager_TransitionCodes",void 0,200,void 0,void 0,!0,!0,".zenario_dragMe",!1);a.bindEventListenersTransitionCodes()});$("#zenario_change_image").off().on("click",function(b,c){a.rememberImageType=c;var e=
zenarioA.microTemplate("zenario_image_changer",{});zenarioA.openBox(e,"zenario_fbAdminImageManager_ImageChanger","AdminImageManager_ImageChanger",void 0,200,void 0,void 0,!0,!0,".zenario_image_changer",!1);a.bindEventListenersImageChanger()});$("#zenario_change_rollover_image").off().on("click",function(){$("#zenario_change_image").trigger("click","rollover")});$("#zenario_change_mobile_image").off().on("click",function(){$("#zenario_change_image").trigger("click","mobile")});$("#zenario_remove_rollover_image").off().on("click",
function(){var b=a.slides[a.current];b.r_filename=b.r_alt_tag=b.r_height=b.r_width=b.true_r_width=b.true_r_height=b.rollover_image_id=b.rollover_image_src=b.rollover_image_src_thumbnail_1=b.rollover_overwrite_alt_tag=null;a.selectSlide(a.current);a.somethingChanged=!0});$("#zenario_remove_mobile_image").off().on("click",function(){var b=a.slides[a.current];b.m_filename=b.m_alt_tag=b.m_height=b.m_width=b.true_m_width=b.true_m_height=b.mobile_image_id=b.mobile_image_src=b.mobile_image_src_thumbnail_1=
b.mobile_overwrite_alt_tag=b.mobile_tab_name=b.mobile_slide_title=b.mobile_slide_extra_html=null;a.selectSlide(a.current);a.somethingChanged=!0});$("#zenario_edit_main_image").off().on("click",function(){a.rememberImageType="";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").show();$("#zenario_rollover_image_details").hide();$("#zenario_mobile_image_details").hide()});$("#zenario_edit_rollover_image").off().on("click",function(){a.rememberImageType=
"rollover";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").hide();$("#zenario_rollover_image_details").show();$("#zenario_mobile_image_details").hide()});if("seperate_fixed"==this.mobile_option)$("#zenario_edit_mobile_image").off().on("click",function(){a.rememberImageType="mobile";$("div.slide_tab").removeClass("current");$(this).addClass("current");$("#zenario_main_image_details").hide();$("#zenario_rollover_image_details").hide();$("#zenario_mobile_image_details").show()});
else $("#zenario_edit_mobile_image").text("Mobile Image (Disabled in properties)").addClass("disabled");$("#zenario_select_link_type").off().on("change",function(){"none"==$("#zenario_select_link_type").val()?($("#zenario_static_method_settings").hide(),$("#zenario_open_in_new_window_settings").hide(),$("#zenario_open_in_new_window").attr("checked",!1),$("#zenario_slide_more_link_text").hide()):($("#zenario_open_in_new_window_settings").show(),$("#zenario_slide_more_link_text").show());"internal"==
$("#zenario_select_link_type").val()?($("#zenario_internal_link_settings").show(),$("#zenario_link_to_translation_chain_settings").show(),""==$("#zenario_content_item_id").val()&&$("#zenario_content_item_link").val("Nothing selected")):($("#zenario_internal_link_settings").hide(),$("#zenario_content_item_link").val(""),$("#zenario_content_item_id").val(""),$("#zenario_link_to_translation_chain_settings").hide(),$("#zenario_link_to_translation_chain").attr("checked",!1));"external"==$("#zenario_select_link_type").val()?
$("#zenario_external_link_settings").show():($("#zenario_external_link_settings").hide(),$("#zenario_external_link").val(""))});$("#zenario_select_slide_visibility").off().on("change",function(){"call_static_method"==$("#zenario_select_slide_visibility").val()?$("#zenario_static_method_settings").show():($("#zenario_static_method_settings").hide(),$("#zenario_module_class_name").val(""),$("#zenario_static_method_name").val(""),$("#zenario_parameter_1").val(""),$("#zenario_parameter_2").val(""));-1!=
$.inArray($("#zenario_select_slide_visibility").val(),["logged_in_with_field","logged_in_without_field","without_field"])?$("#zenario_user_field_settings").show():$("#zenario_user_field_settings").hide();$("#caching_message").toggle("everyone"!=$(this).val())});$("#zenario_external_link").off().on("blur",function(){"http://"==this.value&&(this.value="")});$("#zenario_external_link").on("focus",function(){this.value||(this.value="http://")});var c=function(b){a.tempSaveData(a.current);data={mode:"save_slides",
slides:JSON.stringify(a.data.slides),ordinals:a.slideOrderedIds.join(",")};zenario.ajax(zenario.addBasePath(a.AJAXLink),data).after(function(c){a.errors=JSON.parse(c);if(_.isEmpty(a.errors))zenario.refreshPluginSlot(a.slotName,"lookup");else{var e="";for(key in a.errors)a.errors.hasOwnProperty(key)&&a.errors[key].forEach(function(a){e+='<div class="error">Slide '+(+key+1)+": "+a+"</div>"});$("#zenario_slideshow_error_display").html(e)}b&&_.isEmpty(a.errors)&&a.closeImageManager("save")})};$("#zenario_save_continue").off().on("click",
function(){c(!1)});$("#zenario_save_close").off().on("click",function(){c(!0)})};zenario_slideshow_2.organizerChangeImage=function(){zenarioA.organizerSelect("zenario_slideshow_2","organizerChangeImageCallback",!1,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};
zenario_slideshow_2.organizerChangeImageCallback=function(a,c,b){a=this.rememberImageType;c=zenario.nonAsyncAJAX(this.AJAXLink+"&mode=change_image_from_organizer&new_image_id="+c.id,!1,!0);b=this.slides[this.current];switch(a){case "rollover":b.r_filename=c.filename;b.r_alt_tag=c.alt_tag;b.rollover_image_src=c.image_src;b.rollover_image_src_thumbnail_1=c.image_src_thumbnail_1;b.rollover_image_id=c.image_id;b.r_height=b.true_r_height=c.height;b.r_width=b.true_r_width=c.width;break;case "mobile":b.m_filename=
c.filename;b.m_alt_tag=c.alt_tag;b.mobile_image_src=c.image_src;b.mobile_image_src_thumbnail_1=c.image_src_thumbnail_1;b.mobile_image_id=c.image_id;b.m_height=b.true_m_height=c.height;b.m_width=b.true_m_width=c.width;break;default:b.filename=c.filename,b.alt_tag=c.alt_tag,b.image_src=c.image_src,b.image_src_thumbnail_2=c.image_src_thumbnail_2,b.image_src_thumbnail_1=c.image_src_thumbnail_1,b.image_id=c.image_id,b.true_height=b.height=c.height,b.true_width=b.width=c.width,$("#zenario_slide_"+this.current).attr({src:b.image_src_thumbnail_2,
alt:b.alt})}this.selectSlide(this.current);this.rememberImageType=void 0};zenario_slideshow_2.organizerPickUserCharacteristicCallback=function(a,c,b){$("#zenario_user_characteristic").val(b.name)};
zenario_slideshow_2.pickContentItemLinkFromOrganizer=function(){var a="zenario__content/panels/content_types";$("#zenario_content_item_id").val()&&(a="zenario__content/panels/content//"+$("#zenario_content_item_id").val());zenarioA.organizerSelect("zenario_slideshow_2","organizerPickContentItemLinkCallback",!1,a,"zenario__content/panels/content","zenario__content/panels/content_types",!1,!0)};
zenario_slideshow_2.organizerPickContentItemLinkCallback=function(a,c,b){$("#zenario_content_item_link").val(b.tag);$("#zenario_content_item_id").val(c.id)};zenario_slideshow_2.pickImagesFromOrganizer=function(){zenarioA.organizerSelect("zenario_slideshow_2","organizerPickImagesCallback",!0,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};
zenario_slideshow_2.uploadImages=function(){var a=this,c={mode:"file_upload"},b=!zenarioA.canDoHTML5Upload(),d='<input type="file" name="Filedata" accept="image/*"';b&&(c._html5_backwards_compatibility_hack=1,d+=' id="zenario_fallback_fileupload"');b||(d+=" multiple");d+="/>";if(b){var b="",d='<form id="jqmodal_form" action="'+htmlspecialchars(this.AJAXLink)+'" onsubmit="/*...*/" target="zenario_iframe" method="post" enctype="multipart/form-data">'+d,e;for(e in c)d+='<input type="hidden" value="'+
htmlspecialchars(c[e])+'" name="'+htmlspecialchars(e)+'"/>';b='<input type="button" class="submit_selected" value="'+zenarioA.phrase.upload+'" onclick="get(\'jqmodal_form\').submit();"/>';b+='<input type="button" class="submit" value="'+zenarioA.phrase.cancel+'"/>';zenarioA.showMessage(d+"</form>",b);zenario.browserIsIE()||$("#zenario_fallback_fileupload").click()}else d=$(d),d.change(function(){zenarioA.doHTML5Upload(this.files,a.AJAXLink,c,function(b){a.uploadImagesCallback(b)})}),d.click()};
zenario_slideshow_2.organizerPickImagesCallback=function(a,c,b){var d=this;this.somethingChanged=!0;var e=[];zenario.nonAsyncAJAX(this.AJAXLink+"&mode=add_slides_from_organizer&ids="+c.id,!1,!0).forEach(function(a){var b="t"+d.tempSlideId;e.push(b);d.data.slides[b]=a;d.addGenericImageAttributes(b);d.addSlideToList(d.data.slides[b]);d.tempSlideId++});this.addNewImagesCallback(e)};
zenario_slideshow_2.uploadImagesCallback=function(a){var c=this;this.somethingChanged=!0;if(this.uploadChangeImage){var b=this.slides[this.current];switch(this.rememberImageType){case "rollover":b.r_filename=a[0].filename;b.r_alt_tag=a[0].filename;b.rollover_image_src=a[0].link;b.rollover_image_src_thumbnail_1=a[0].link+"&height=150&width=300";b.rollover_image_id=0;b.r_height=b.true_r_height=a[0].height;b.r_width=b.true_r_width=a[0].width;b.r_cache_id=a[0].id;break;case "mobile":b.m_filename=a[0].filename;
b.m_alt_tag=a[0].filename;b.mobile_image_src=a[0].link;b.mobile_image_src_thumbnail_1=a[0].link+"&height=150&width=300";b.mobile_image_id=0;b.m_height=b.true_m_height=a[0].height;b.m_width=b.true_m_width=a[0].width;b.m_cache_id=a[0].id;break;default:b.filename=a[0].filename,b.alt_tag=a[0].filename,b.image_src=a[0].link,b.image_src_thumbnail_1=a[0].link+"&height=150&width=300",b.image_src_thumbnail_2=a[0].link+"&height=150&width=150",b.image_id=0,b.true_height=b.height=a[0].height,b.true_width=b.width=
a[0].width,b.cache_id=a[0].id,$("#zenario_slide_"+this.current).attr({src:b.image_src_thumbnail_1,alt:b.alt})}this.selectSlide(this.current);this.uploadChangeImage=!1;this.rememberImageType=void 0}else{var d=[];a.forEach(function(a){var b="t"+c.tempSlideId;d.push(b);c.data.slides[b]={};var f=c.data.slides[b];c.addGenericImageAttributes(b);f.filename=a.filename;f.alt_tag=a.filename;f.width=f.true_width=a.width;f.height=f.true_height=a.height;f.image_src=a.link;f.image_src_thumbnail_1=a.link+"&height=150&width=300";
f.image_src_thumbnail_2=a.link+"&height=150&width=150";f.image_id=0;f.cache_id=a.id;c.addSlideToList(f);c.tempSlideId++});this.addNewImagesCallback(d)}};
zenario_slideshow_2.addGenericImageAttributes=function(a){var c=this.data.slides[a];c.id=a;c.overwrite_alt_tag="";c.tab_name="";c.slide_title="";c.slide_extra_html="";c.slide_more_link_text="";c.rollover_overwrite_alt_tag="";c.mobile_overwrite_alt_tag="";c.mobile_tab_name="";c.mobile_slide_title="";c.mobile_slide_extra_html="";c.target_loc="none";c.dest_url="";c.open_in_new_window=0;c.slide_visibility="everyone";c.plugin_class="";c.method_name="";c.param_1="";c.param_2="";c.field_id=0;c.link_to_translation_chain=
"";c.transition_code="";c.use_transition_code=0;c.hidden=0};zenario_slideshow_2.addSlideToList=function(a){a='<li id="zenario_slide_image_'+a.id+'" data-id="'+a.id+'"> \t\t\t<div onclick="zenario_slideshow_2.selectSlide(\''+a.id+'\', true);"> \t\t\t\t<img src="'+a.image_src_thumbnail_2+'" alt="'+a.alt_tag+'" id="zenario_slide_'+a.id+'"/> \t\t\t</div> \t\t</li>';$("#zenario_sortable").append(a)};zenario_slideshow_2.addNewImagesCallback=function(a){this.tempSaveOrder();0==this.current&&this.selectSlide(this.slideOrderedIds[0])};
zenario_slideshow_2.makeListSortable=function(){var a=this;$("#zenario_sortable").sortable({update:function(c,b){a.tempSaveOrder()}})};zenario_slideshow_2.deleteSlide=function(){if(!_.isEmpty(this.data.slides)){this.somethingChanged=!0;var a=this.current,c=0<=this.slideOrderedIds.indexOf(a)-1?this.slideOrderedIds.indexOf(a)-1:0;delete this.data.slides[a];$("li#zenario_slide_image_"+a).remove();this.tempSaveOrder();nextSlideId=_.isEmpty(this.data.slides)?this.current=0:this.slideOrderedIds[c];this.selectSlide(nextSlideId)}};
zenario_slideshow_2.selectLastImage=function(){_.isEmpty(this.data.slides)||this.selectSlide(this.slideOrderedIds[this.slideOrderedIds.length-1])};zenario_slideshow_2.selectFirstImage=function(){_.isEmpty(this.slides)||this.selectSlide(this.slideOrderedIds[0])};zenario_slideshow_2.nudgeImageUp=function(){if(!_.isEmpty(this.data.slides)){var a=$(".slideshow_selected_image");a.prev().before(a);this.tempSaveOrder()}};
zenario_slideshow_2.nudgeImageDown=function(){if(!_.isEmpty(this.data.slides)){var a=$(".slideshow_selected_image");a.next().after(a);this.tempSaveOrder()}};
zenario_slideshow_2.resize=function(){maxHeight=800;this.sizing&&clearTimeout(this.sizing);if(get("zenario_fbAdminInner")){var a=Math.floor(0.96*$(window).height()-(zenario.browserIsIE()?210:zenario.browserIsSafari()?202:205));a>maxHeight&&(a=maxHeight);0<(a*=1)&&(get("zenario_fbAdminInner").style.height=a+"px",get("zenario_slides").style.height=get("zenario_slide_attributes").style.height=a-60+"px")}this.sizing=setTimeout(this.resize,250)};
zenario_slideshow_2.size=function(){var a=$("#zenario_main_image_details"),c=$("#zenario_rollover_image_details"),b=$("#zenario_mobile_image_details"),d=$("#zenario_slide_settings"),e;a.css("height","auto");c.css("height","auto");b.css("height","auto");d.css("height","auto");e=Math.max(a.height(),c.height(),b.height(),d.height());a.height(e);c.height(e);b.height(e);d.height(e)};
