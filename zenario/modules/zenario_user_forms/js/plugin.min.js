(function(c){c.initForm=function(a,k,d,b,g,A,B,C,x,D,E){this.containerId=a;var w=this;E&&$("#"+a+"_user_form").effect("shake",{distance:10,times:3,duration:300});$("#"+a+"_user_form form").on("submit",function(){window.onbeforeunload=null});this.startPoking();D&&(1<x&&(window.onbeforeunload=function(){return!0}),g&&(window.onbeforeunload=null));if(B)$("#"+a+" .page_switcher li.step").on("click",function(){var e=$(this).data("page");e<=x&&e!=C&&(window.onbeforeunload=null,w.submitForm(a,k,{target_page:e},
!0))});b&&($.colorbox({transition:"none",html:b,escKey:!1,overlayClose:!1,onOpen:function(){var a=get("colorbox");a.className=c.moduleClassName;$(a).hide().fadeIn()}}),zenario._rC());$("#"+a+"_print_page").on("click",function(){w.printFormPage(a)});var y=$("#"+a+"_fullscreen"),F=$("#"+a+' input[name="inFullScreen"]');y.on("click",function(){$("#ui-datepicker-div").detach().appendTo("#"+a);zenario._eFS($("#"+a)[0])});$(document).on(zenario.fullScreenChangeEvent,function(){var e=zenario._iFS();y.toggle(!e);
F.val(e?1:0);$("#"+a+"_form_wrapper").toggleClass("in_fullscreen",e)});g&&zenario._exFuSc();$("#"+a+"_user_form input.jquery_form_datepicker").each(function(e,n){zenario._lDP();if(n.id){n.value=$.datepicker.formatDate(zenario.dpf,$.datepicker.parseDate("yy-mm-dd",get(n.id+"__0").value));var t={dateFormat:zenario.dpf,altField:"#"+n.id+"__0",altFormat:"yy-mm-dd",showOn:"focus"};$(this).data("selectors")&&(t.changeMonth=!0,t.changeYear=!0,t.yearRange="c-100:c+5");var f=$("#"+n.id);f.datepicker(t);$("#"+
n.id+"__clear").on("click",function(){f.datepicker("setDate",null)});A&&zenario._iFS()&&$("#ui-datepicker-div").detach().appendTo("#"+a)}});$("#"+a+"_user_form select.source_field").on("change",function(){c.submitForm(a,k,{filter:1})});$("#"+a+"_user_form .form_field.visible_on_condition, #"+a+"_user_form .repeat_block.visible_on_condition, .page_switcher li.visible_on_condition").each(function(e,n){var t=this,f=$(this).data("cfieldid"),b=$(this).data("cfieldvalue"),q=$(this).data("cfieldinvert"),
c=$(this).data("cfieldtype"),k=$(this).data("cfieldoperator");$(this).data("id");if(f)if("checkboxes"==c)$("#"+a+"_field_"+f+" input").on("change",function(){var e=[],n,c,h;$("#"+a+"_field_"+f+" input").each(function(){$(this).is(":checked")&&e.push($(this).data("value"))});n=b?_._m(b.toString().split(","),Number):[];if("AND"==k)c=_.intersection(e,n),c=_.intersection(e,c),c=_._isEq(c,n);else for(h=0;h<e.length;h++)if(-1!=n.indexOf(e[h])){c=!0;break}c=q?!c:c;$(t).toggle(c)});else $("#"+a+"_field_"+
f+" :input").on("change",function(){var a;a=$(this).is(":checkbox")?$(this).is(":checked"):$(this).val();a=""===b&&a||""!==b&&b==a;a=q?!a:a;$(t).toggle(a)})});$("#"+a+"_user_form .form_field.restatement").each(function(e,c){var b=this,f=$(this).data("fieldid");if(f&&(f=$("#"+a+'_user_form .form_field :input[name="field_'+f+'"]'),0<f.length))if(f.is("input"))f.on("keyup",function(){$(b).find(":input").val($(this).val())});else if(f.is("select"))f.on("change",function(){$(b).find(":input").val(""===
$(this).val()?"":$(this).find("option:selected").text())})});$("#"+a+"_user_form .form_field.calculated").each(function(e,c){var b=$(this).find("input"),f=$(this).data("prefix"),k=$(this).data("postfix"),q=b.data("repeated"),s=b.data("repeated_row"),g=b.data("repeat_id"),d=$("#"+a+"_field_"+$(c).data("id")+"_calculation_code").text();if(d){var d=JSON.parse(d),p={},u="";if(d&&(u=w.buildFieldCalculation(a,d,p))){var h,l={};for(e in p)if(h=$("#"+a+'_user_form .form_field input[name="field_'+e+'"]'),
0<h.length){if(h.data("repeated")&&q&&h.data("repeat_id")==g){if(1<s&&(h=$("#"+a+'_user_form .form_field input[name="field_'+e+"_"+s+'"]'),0==h.length))continue}else h.data("repeated")&&(h._repeatedFields=[],d=$("#"+a+"_user_form .form_field.field_"+e+"_repeat input"),d.each(function(a,b){h._repeatedFields.push($(this));l[e+"_"+a]=$(this)}));l[e]=h}else u=u.replace("[[FIELD_"+e+"]]",+p[e]);var r,v,z;for(e in l)l[e].on("keyup",function(){var e=u,q=!1,m=0;for(r in l){v=l[r].val();if(""==v||isNaN(v)||
-1<v.toLowerCase().indexOf("e")){q=!0;break}if(l[r]._repeatedFields&&l[r]._repeatedFields.length){for(var d=[v],h=0;h<l[r]._repeatedFields.length;h++){var g=l[r]._repeatedFields[h].val();if(""==g||isNaN(g)||-1<g.toLowerCase().indexOf("e")){q=!0;break}d.push(g)}v="("+d.join(" + ")+")"}z="\\[\\[FIELD_"+r+"\\]\\]";e=e.replace(RegExp(z,"g"),v)}!q&&(m=Parser.evaluate(e),!_._iF(m)||999999999999999<m||-999999999999999>m)&&(q=!0);q?m="NaN":(m=+m.toFixed(2),f&&(m=f+""+m),k&&(m=m+""+k));b.val(m);$("#"+a+'_user_form .form_field.restatement[data-fieldid="'+
$(c).data("id")+'"] :input').val(m)})}}});$("#"+a+"_user_form .repeat_block").each(function(e,b){var d=$(this).data("id");$(this).find("div.add").on("click",function(){c.submitForm(a,k,{add_repeat_row:d})});$(this).find("div.delete").on("click",function(){var e=$(this).data("row");c.submitForm(a,k,{delete_repeat_row:d,row:e})})});$("#"+a+"_user_form .autocomplete_json").each(function(){var e=this,b=JSON.parse($(this).text());if(b){for(var d=[],f=0;f<b.length;f++)d.push({value:b[f].v,label:b[f].l});
$(this).prev().autocomplete({minLength:0,source:d,select:function(b,d){b.preventDefault();var f="",g="";d.item&&(f=d.item.label,g=d.item.value);$(e).next().val(g);$(e).prev().val(f);$(e).data("source_field")&&c.submitForm(a,k,{filter:1})},focus:function(a,b){this.value=b.item.label;a.preventDefault()},change:function(a,b){if(!b.item){var e=$(this).val(),c=d.find(function(a){return a.label.toLowerCase()===e.toLowerCase()});$(this).data("ui-autocomplete")._trigger("select","autocompleteselect",{item:c})}},
open:function(b,e){var c=this;$("#"+a+"_user_form").scroll(function(){$(c).autocomplete("close")})}}).on("click",function(){if(0==d.length){var a=$(e).data("auto_placeholder");a&&$(this).prop("placeholder",a)}$(this).autocomplete("search","")})}});$("#"+a+"_user_form .field_file_picker").each(function(){var a=this,b=$(this).find(".file_picker_field"),c=$(this).find(".progress_bar"),f=$(this).find(".file_upload_button"),g=b.data("limit"),k=b.data("extensions"),s=0,w=0,a=this,x=$(this).data("id"),p=
void 0;if(k){for(var p="\\.(",u=k.split(","),h=[],l=0;l<u.length;l++){var r=u[l].replace(/\./i,"").trim();r&&h.push(r)}p+=h.join("|");p=RegExp(p+")$","i")}c.progressbar();b.fileupload({url:d+"&filePickerUpload=1",dataType:"json",maxFileSize:1E7,acceptFileTypes:p,maxNumberOfFiles:g,getNumberOfFiles:function(){return s},submit:function(a,b){s++},start:function(a){c.show()},done:function(b,c){$.each(c.result.files,function(b,c){var d;d='<div class="file_row">';d=c.download_link?d+('<p><a href="'+c.download_link+
'" target="_blank">'+c.name+"</a></p>"):d+("<p>"+c.name+"</p>");d+='<input name="field_'+x+"_"+ ++w+'" type="hidden" value="'+c.id+'" />';d+='<span class="delete_file_button">'+zenario._p("zenario_user_forms","Delete")+"</span>";d+="</div>";$(a).find(".files").append($(d));s>=g&&f.hide()});$(a).find(".delete_file_button").off().on("click",function(){$(this).parent().remove();s--;s<g&&f.show()})},always:function(a,b){c.hide()},processfail:function(a,b){alert(b.files[b.index].error)},progressall:function(a,
b){var d=parseInt(100*(b.loaded/b.total),10);c.progressbar("option","value",d)},messages:{acceptFileTypes:zenario._p("zenario_user_forms","Allowed file types: [[types]]",{types:k}),maxFileSize:zenario._p("zenario_user_forms","File exceeds maximum allowed size of 10MB"),maxNumberOfFiles:zenario._p("zenario_user_forms","Maximum number of files exceeded")}});k={};p=$(this).find(".loaded_files").text();k.files=JSON.parse(p);0<k.files.length&&(s=k.files.length,b.fileupload("option","done").call(b,$.Event("done"),
{result:k}))})};c.printFormPage=function(){var a=$("#"+this.containerId+" .form_fields").html(),c=window.screenX+$(window).width()/2,d=window.open("","Print-Window","width=300,height=300,left="+c+",top="+window.screenY);d.document.open();d.document.write('<html><body onload="window.print()">'+a+"</body></html>");d.document.close();setTimeout(function(){d.close()},10)};c.buildFieldCalculation=function(a,c,d){for(var b="",g=0;g<c.length;g++)switch(c[g].type){case "static_value":b+=+c[g].value;break;
case "field":if("NaN"==c[g].v&&0>=$("#"+a+'_user_form .form_field input[name="field_'+c[g].value+'"]').length)return!1;d[c[g].value]=c[g].v;b+="[[FIELD_"+c[g].value+"]]";break;case "parentheses_open":b+="(";break;case "parentheses_close":b+=")";break;case "operation_addition":b+="+";break;case "operation_subtraction":b+="-";break;case "operation_multiplication":b+="*";break;case "operation_division":b+="/"}return b};c.submitForm=function(a,c,d,b){a=$("#"+a+"_user_form form");b||(zenario.blockScrollToTop=
!0);if(d)for(var g in d)a.append('<input type="hidden" name="'+g+'" value="'+d[g]+'"/>');a.submit()};c.stopPoking=function(){c.poking&&clearInterval(c.poking);c.poking=!1};c.startPoking=function(){c.poking||(c.poking=setInterval(c.poke,12E4))};c.poke=function(){zenario._a(URLBasePath+"zenario/admin/quick_ajax.php?keep_session_alive=1")}})(zenario_user_forms);zenario_user_forms.recaptchaCallback=function(){recaptchaCallback()};
