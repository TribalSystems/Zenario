(function(e){e.initForm=function(a,x,u,f,q,E,F,G,y,H,I,w){function z(a,l){return a.ord<l.ord?-1:a.ord>l.ord?1:0}this.containerId=a;var r=this;w=JSON.parse(w);I&&$("#"+a+"_user_form").effect("shake",{distance:10,times:3,duration:300});$("#"+a+"_user_form form").on("submit",function(){window.onbeforeunload=null});this.startPoking();if(H){if(1<y&&(window.onbeforeunload=function(){return!0},void 0!==zenario_conductor)){var A=this.phrase("Changes you made may not be saved.");zenario_conductor._cOC(a,function(){return!0},
function(a){confirm(A)&&a()},A)}q&&(window.onbeforeunload=null)}if(F)$("#"+a+" .page_switcher li.step").on("click",function(){var c=$(this).data("page");c<=y&&c!=G&&(window.onbeforeunload=null,r.submitForm(a,{target_page:c},!0))});f&&($.colorbox({transition:"none",html:f,escKey:!1,overlayClose:!1,onOpen:function(){var a=get("colorbox");a.className=e.moduleClassName;$(a).hide().fadeIn()}}),zenario._rC());$("#"+a+"_user_form .form_buttons .next.submit").on("click",function(){r.submitForm(a,{submitForm:!0},
!0)});$("#"+a+"_user_form .form_buttons .next:not(.submit)").on("click",function(){r.submitForm(a,{next:!0},!0)});$("#"+a+"_user_form .form_buttons .previous").on("click",function(){r.submitForm(a,{previous:!0},!0)});$("#"+a+" input.saveLater").on("click",function(){var c=$(this).data("message");confirm(c)&&r.submitForm(a,{saveLater:!0})});$("#"+a+"_user_form .field_attachment .remove_attachment").on("click",function(){var c=$(this).data("id"),l={};l["remove_attachment_"+c]=!0;r.submitForm(a,l)});
$("#"+a+"_print_page").on("click",function(){r.printFormPage(a)});var B=$("#"+a+"_fullscreen"),J=$("#"+a+' input[name="inFullScreen"]');B.on("click",function(){$("#ui-datepicker-div").detach().appendTo("#"+a);zenario._eFS($("#"+a)[0])});$(document).on(zenario.fullScreenChangeEvent,function(){var c=zenario._iFS();B.toggle(!c);J.val(c?1:0);$("#"+a+"_form_wrapper").toggleClass("in_fullscreen",c)});q&&zenario._exFuSc();$("#"+a+"_user_form input.jquery_form_datepicker").each(function(c,l){if(l.id){l.value=
$.datepicker.formatDate(zenario.dpf,$.datepicker.parseDate("yy-mm-dd",get(l.id+"__0").value));var g={dateFormat:zenario.dpf,altField:"#"+l.id+"__0",altFormat:"yy-mm-dd",showOn:"focus",onClose:function(a,c){get(l.id+"__0");var b=$.datepicker.formatDate(zenario.dpf,$.datepicker.parseDate("yy-mm-dd",get(l.id+"__0").value));a&&b?a&&b&&(l.value=b):d.datepicker("setDate",null)}};$(this).data("selectors")&&(g.changeMonth=!0,g.changeYear=!0,g.yearRange="c-100:c+5");$(this).data("no_past_dates")&&(g.minDate=
new Date);$(this).data("no_future_dates")&&(g.maxDate=new Date);var d=$("#"+l.id);d.datepicker(g);$("#"+l.id+"__clear").on("click",function(){d.datepicker("setDate",null)});E&&zenario._iFS()&&$("#ui-datepicker-div").detach().appendTo("#"+a)}});$("#"+a+"_user_form select.source_field").on("change",function(){e.submitForm(a,{filter:1})});$("#"+a+"_user_form .form_field.visible_on_condition, #"+a+"_user_form .repeat_block.visible_on_condition, .page_switcher li.visible_on_condition").each(function(c,
l){var g=this,d=$(this).data("cfields");$(this).data("id");if(d.length)for(c=0;c<d.length;c++){var h=d[c];(function(c){$("#"+a+"_field_"+h.id+" :input").on("change",function(){for(var b=!0,p=c;p<d.length;p++){var k=d[p],h=$("#"+a+"_field_"+k.id+" :input");if("checkboxes"==k.type){var l=[];h.each(function(){$(this).is(":checked")&&l.push($(this).data("value"))});h=k.value?_._m(k.value.toString().split(","),Number):[];if("AND"==k.operator)b=_.intersection(l,h),b=_.intersection(l,b),b=_._isEq(b,h);else for(var b=
!1,f=0;f<l.length;f++)if(-1!=h.indexOf(l[f])){b=!0;break}}else h=h.is(":checkbox")?h.is(":checked"):"radios"==k.type?h.filter(":checked").val():h.val(),b="string"==typeof k.value&&1<k.value.split(",").length?-1!==k.value.split(",").indexOf(h):Boolean(""===k.value&&h||""!==k.value&&k.value==h);b=k.invert?!b:b;if(!b||p==d.length-1){$(g).toggle(b);break}}})})(c)}});$("#"+a+"_user_form .form_field.restatement").each(function(c,l){var g=this,d=$(this).data("fieldid");if(d&&(d=$("#"+a+'_user_form .form_field :input[name="field_'+
d+'"]'),0<d.length))if(d.is("input"))d.on("keyup",function(){$(g).find(":input").val($(this).val())});else if(d.is("select"))d.on("change",function(){$(g).find(":input").val(""===$(this).val()?"":$(this).find("option:selected").text())})});var C=function(a){return""===a||isNaN(a)||-1<a.toString().toLowerCase().indexOf("e")};$("#"+a+"_user_form .form_field.calculated").each(function(c,l){var g=$(this).find("input"),d=$(this).data("prefix"),h=$(this).data("postfix"),m=g.data("repeated"),b=g.data("repeated_row"),
p=g.data("repeat_id"),k=$("#"+a+"_field_"+$(l).data("id")+"_calculation_code").text();if(k){var k=JSON.parse(k),f={},v="";if(k&&(v=r.buildFieldCalculation(a,k,f))){var e,t={};for(c in f)if(e=$("#"+a+'_user_form .form_field input[name="field_'+c+'"]'),0<e.length){if(e.data("repeated")&&m&&e.data("repeat_id")==p){if(1<b&&(e=$("#"+a+'_user_form .form_field input[name="field_'+c+"_"+b+'"]'),0==e.length))continue}else e.data("repeated")&&(e._repeatedFields=[],k=$("#"+a+"_user_form .form_field.field_"+
c+"_repeat input"),k.each(function(a,b){e._repeatedFields.push($(this));t[c+"_"+a]=$(this)}));t[c]=e}else v=v.replace("[[FIELD_"+c+"]]",+f[c]);var n,s,D;for(c in t)t[c].on("keyup",function(){var b=v,c=!1,m=0;for(n in t){(s=t[n].val())||(s=0);if(C(s)){c=!0;break}if(t[n]._repeatedFields&&t[n]._repeatedFields.length){for(var k=[s],p=0;p<t[n]._repeatedFields.length;p++){var f=t[n]._repeatedFields[p].val();f||(f=0);if(C(f)){c=!0;break}k.push(f)}s="("+k.join(" + ")+")"}D="\\[\\[FIELD_"+n+"\\]\\]";b=b.replace(RegExp(D,
"g"),s)}!c&&(m=Parser.evaluate(b),!_._iF(m)||999999999999999<m||-999999999999999>m)&&(c=!0);c?m="NaN":(m=+m.toFixed(2),d&&(m=d+""+m),h&&(m=m+""+h));g.val(m);$("#"+a+'_user_form .form_field.restatement[data-fieldid="'+$(l).data("id")+'"] :input').val(m)})}}});$("#"+a+"_user_form .repeat_block").each(function(c,l){var g=$(this).data("id");$(this).find("div.add").on("click",function(){e.submitForm(a,{add_repeat_row:g})});$(this).find("div.delete").on("click",function(){var c=$(this).data("row");e.submitForm(a,
{delete_repeat_row:g,row:c})})});$("#"+a+"_user_form .autocomplete_json").each(function(){var c=this,l=JSON.parse($(this).text());if(l){for(var g=[],d=0;d<l.length;d++)g.push({value:l[d].v,label:l[d].l});$(this).prev().autocomplete({minLength:0,source:g,select:function(d,m){d.preventDefault();var b="",p="";m.item&&(b=m.item.label,p=m.item.value);$(c).next().val(p);$(c).prev().val(b);$(c).data("source_field")&&e.submitForm(a,{filter:1})},focus:function(a,c){this.value=c.item.label;a.preventDefault()},
change:function(a,c){if(!c.item){var b=$(this).val(),d=g.find(function(a){return a.label.toLowerCase()===b.toLowerCase()});$(this).data("ui-autocomplete")._trigger("select","autocompleteselect",{item:d})}},open:function(c,d){var b=this;$("#"+a+"_user_form").scroll(function(){$(b).autocomplete("close")})}}).on("click",function(){if(0==g.length){var a=$(c).data("auto_placeholder");a&&$(this).prop("placeholder",a)}$(this).autocomplete("search","")})}});$("#"+a+"_user_form .suggested_values_json").each(function(){var a=
JSON.parse($(this).text());if(a)$(this).prev().autocomplete({minLength:0,source:a}).on("click",function(){$(this).autocomplete("search","")})});(function(){function c(d,h){var m=l(h),m=zenario._mT("file_upload_row",m),b=$("#"+a+"_field_"+d+" .files");b.html(m);b.find(".file_row .delete").on("click",function(){if(confirm(w.delete_file)){var a=$(this).parent().data("id");delete h[a];c(d,h)}});$('input[name="field_'+d+'"]').val(JSON.stringify(h))}function l(a){var c=[],m;for(m in a)c.push(a[m]);c.sort(z);
return c}function g(c,l,m,b){$("#"+a+"_field_"+c+NaN).toggle(b).find(".progress_bar").css("width",m+"%")}$("#"+a+"_user_form .field_file_picker:not(.readonly)").each(function(){var a=$(this).data("id"),f=JSON.parse($('input[name="field_'+a+'"]').val());f||(f={});c(a,f);$(this).find(".file_picker_field").fileupload({url:u+"&fileUpload=1",dataType:"json",start:function(c){g(a,0,!0)},progressall:function(c,b){var f=parseInt(100*(b.loaded/b.total),10);g(a,f,!0)},done:function(m,b){var g=l(f),k=g.length&&
g[g.length-1].ord?g[g.length-1].ord:1;$.each(b.result.files,function(a,b){k++;b.id="t"+k;b.ord=k;f[b.id]=b});c(a,f)},stop:function(c){g(a,0,!1)}})})})();(function(){function c(f,b){var d=g(b),d=zenario._mT("document_upload_row",d),k=$("#"+a+"_field_"+f+" .popup_1 .files");k.html(d);k.find(".file_row .delete").on("click",function(){if(confirm(w.delete_file)){var a=$(this).parent().data("id");delete b[a];c(f,b)}})}function f(c,b){var d=g(b),k=zenario._mT("document_upload_uploaded_file",d),e=$("#"+a+
"_field_"+c+" .popup_2 .files");e.html(k);e.find(".file_row .delete").on("click",function(){if(confirm(w.delete_file)){var a=$(this).parent().data("id");delete b[a];f(c,b)}});e.find(".file_row .rotate").on("click",function(){var a=$(this).parent().data("id");b[a].rotate||(b[a].rotate=0);b[a].rotate=(b[a].rotate+90)%360;JSON.stringify(b[a]);e.find(".file_"+a+" .icon img").css({transform:"rotate("+b[a].rotate+"deg)","-ms-transform":"rotate("+b[a].rotate+"deg)","-moz-transform":"rotate("+b[a].rotate+
"deg)","-webkit-transform":"rotate("+b[a].rotate+"deg)","-o-transform":"rotate("+b[a].rotate+"deg)"})});d.length&&e.sortable({containment:"parent",tolerance:"pointer",items:"div.file_row",start:function(a,b){r.startIndex=b.item.index()},stop:function(a,c){r.startIndex!=c.item.index()&&e.find(".file_row").each(function(a){var c=$(this).data("id");b[c].ord=a+1})}})}function g(a){var b=[],c;for(c in a)b.push(a[c]);b.sort(z);return b}function d(c,b,f,d){$("#"+a+"_field_"+c+" ."+b+" .progress").toggle(d).find(".progress_bar").css("width",
f+"%")}function e(a,b){g(b).length?confirm(w.are_you_sure_message)&&a.hide():a.hide()}$("#"+a+"_user_form .field_document_upload").each(function(){var a=this,b=$(this).data("id"),p=$(this).find(".overlay_1"),k=$(this).find(".overlay_2"),x=$(this).find(".popup_1 .files"),q=$(this).find(".popup_2 .files"),r=$(this).find('input[name="field_'+b+'"]'),t=$(this).data("filename"),n={},s={};$(this).find(".open_popup_1").on("click",function(){r.val()&&(n=JSON.parse(r.val()));n||(n={});c(b,n);p.show()});$(this).find(".open_popup_2").on("click",
function(){s={};f(b,s);k.show()});$(this).find(".popup_1 .close").on("click",function(){e(p,n)});$(this).find(".popup_2 .close").on("click",function(){e(k,s)});window.onclick=function(){event.target==p[0]?e(p,n):event.target==k[0]&&e(k,s)};$(this).find(".popup_1 .upload_complete_files").fileupload({url:u+"&fileUpload=1",dataType:"json",dropZone:x,start:function(a){d(b,"popup_1",0,!0)},progressall:function(a,c){var f=parseInt(100*(c.loaded/c.total),10);d(b,"popup_1",f,!0)},done:function(a,f){var d=
g(n),e=d.length&&d[d.length-1].ord?d[d.length-1].ord:1;$.each(f.result.files,function(a,b){e++;b.id="t"+e;b.ord=e;n[b.id]=b});c(b,n)},stop:function(a){d(b,"popup_1",0,!1)}});$(this).find(".popup_1 .save").on("click",function(){var b=g(n),c="",c=[],f,d;for(f=0;f<b.length;f++)d=b[f],c.push('<a href="'+d.path+'" target="_blank">'+d.name+"</a>");c=c.join(", ");$(a).find(".files_preview").html(c);r.val(JSON.stringify(n));p.hide();k.hide()});$(this).find(".popup_2 .upload_file_fragments").fileupload({url:u+
"&fileUpload=1&thumbnail=1",dataType:"json",dropZone:q,start:function(a){d(b,"popup_2",0,!0)},progressall:function(a,c){var f=parseInt(100*(c.loaded/c.total),10);d(b,"popup_2",f,!0)},done:function(a,c){var d=g(s),e=d.length&&d[d.length-1].ord?d[d.length-1].ord:1;$.each(c.result.files,function(a,b){e++;b.id="t"+e;b.ord=e;s[b.id]=b});f(b,s)},stop:function(a){d(b,"popup_2",0,!1)}});$(this).find(".popup_2 .combine").on("click",function(){var d=g(s);if(d.length){var e=this,h;$(e).val(w.combining);if(t){h=
t;var p=1,x=g(n),q=RegExp(h+"(?:_(\\d+))?.pdf$"),r=!1,v;for(v=0;v<x.length;v++)(r=x[v].name.match(q))&&(p=+r[1]+1);h+="_"+p}else h=$(a).find(".filename").val();d={name:h,files:JSON.stringify(d)};zenario._a(u+"&combineFiles=1",d).after(function(d){if((d=JSON.parse(d))&&d.path){var h=g(n),h=h.length&&h[h.length-1].ord?h[h.length-1].ord:1;h++;d.id="t"+h;d.ord=h;n[d.id]=d;c(b,n);$(a).find(".filename").val(t?t:"my-combined-file");k.hide();s={};f(b,[])}$(e).val(w.combine)})}})})})()};e.printFormPage=function(){var a=
$("#"+this.containerId+" .form_fields").html(),e=window.screenX+$(window).width()/2,u=window.open("","Print-Window","width=300,height=300,left="+e+",top="+window.screenY);u.document.open();u.document.write('<html><body onload="window.print()">'+a+"</body></html>");u.document.close();setTimeout(function(){u.close()},10)};e.buildFieldCalculation=function(a,e,u){for(var f="",q=0;q<e.length;q++)switch(e[q].type){case "static_value":f+=+e[q].value;break;case "field":if("NaN"==e[q].v&&0>=$("#"+a+'_user_form .form_field input[name="field_'+
e[q].value+'"]').length)return!1;u[e[q].value]=e[q].v;f+="[[FIELD_"+e[q].value+"]]";break;case "parentheses_open":f+="(";break;case "parentheses_close":f+=")";break;case "operation_addition":f+="+";break;case "operation_subtraction":f+="-";break;case "operation_multiplication":f+="*";break;case "operation_division":f+="/"}return f};e.submitForm=function(a,e,u){var f=$("#"+a+"_user_form form");u||(zenario.blockScrollToTop=!0);if(e)for(var q in e)f.append('<input type="hidden" name="'+q+'" value="'+
e[q]+'"/>');$("#"+a+"_user_form .field_document_upload, #"+a+"_user_form .field_file_picker").each(function(){$(this).find('input[type="file"]').remove()});f.submit()};e.stopPoking=function(){e.poking&&clearInterval(e.poking);e.poking=!1};e.startPoking=function(){e.poking||(e.poking=setInterval(e.poke,12E4))};e.poke=function(){zenario._a(URLBasePath+"zenario/admin/quick_ajax.php?keep_session_alive=1")};e.toggleForm=function(a){$("#"+a).toggleClass("show").toggleClass("hide")}})(zenario_user_forms);
zenario_user_forms.recaptchaCallback=function(){$(recaptchaCallback)};
