(function(b){b.initForm=function(a,l,g,c,h,A,B,C,x,D,E){this.containerId=a;var w=this;E&&$("#"+a+"_user_form").effect("shake",{distance:10,times:3,duration:300});$("#"+a+"_user_form form").on("submit",function(){window.onbeforeunload=null});this.startPoking();D&&(1<x&&(window.onbeforeunload=function(){return!0}),h&&(window.onbeforeunload=null));if(B)$("#"+a+" .page_switcher li.step").on("click",function(){var d=$(this).data("page");d<=x&&d!=C&&(window.onbeforeunload=null,w.submitForm(a,l,{target_page:d},
!0))});c&&($.colorbox({transition:"none",html:c,escKey:!1,overlayClose:!1,onOpen:function(){var a=get("colorbox");a.className=b.moduleClassName;$(a).hide().fadeIn()}}),zenario._rC());$("#"+a+"_print_page").on("click",function(){w.printFormPage(a)});var y=$("#"+a+"_fullscreen"),F=$("#"+a+' input[name="inFullScreen"]');y.on("click",function(){$("#ui-datepicker-div").detach().appendTo("#"+a);zenario._eFS($("#"+a)[0])});$(document).on(zenario.fullScreenChangeEvent,function(){var d=zenario._iFS();y.toggle(!d);
F.val(d?1:0);$("#"+a+"_form_wrapper").toggleClass("in_fullscreen",d)});h&&zenario._exFuSc();$("#"+a+"_user_form input.jquery_form_datepicker").each(function(d,m){zenario._lDP();if(m.id){m.value=$.datepicker.formatDate(zenario.dpf,$.datepicker.parseDate("yy-mm-dd",get(m.id+"__0").value));var e={dateFormat:zenario.dpf,altField:"#"+m.id+"__0",altFormat:"yy-mm-dd",showOn:"focus",onClose:function(a,d){get(m.id+"__0");var e=$.datepicker.formatDate(zenario.dpf,$.datepicker.parseDate("yy-mm-dd",get(m.id+
"__0").value));a&&e?a&&e&&(m.value=e):f.datepicker("setDate",null)}};$(this).data("selectors")&&(e.changeMonth=!0,e.changeYear=!0,e.yearRange="c-100:c+5");var f=$("#"+m.id);f.datepicker(e);$("#"+m.id+"__clear").on("click",function(){f.datepicker("setDate",null)});A&&zenario._iFS()&&$("#ui-datepicker-div").detach().appendTo("#"+a)}});$("#"+a+"_user_form select.source_field").on("change",function(){b.submitForm(a,l,{filter:1})});$("#"+a+"_user_form .form_field.visible_on_condition, #"+a+"_user_form .repeat_block.visible_on_condition, .page_switcher li.visible_on_condition").each(function(d,
m){var e=this,f=$(this).data("cfieldid"),c=$(this).data("cfieldvalue"),s=$(this).data("cfieldinvert"),b=$(this).data("cfieldtype"),l=$(this).data("cfieldoperator");$(this).data("id");if(f)if("checkboxes"==b)$("#"+a+"_field_"+f+" input").on("change",function(){var d=[],m,b,k;$("#"+a+"_field_"+f+" input").each(function(){$(this).is(":checked")&&d.push($(this).data("value"))});m=c?_._m(c.toString().split(","),Number):[];if("AND"==l)b=_.intersection(d,m),b=_.intersection(d,b),b=_._isEq(b,m);else for(k=
0;k<d.length;k++)if(-1!=m.indexOf(d[k])){b=!0;break}b=s?!b:b;$(e).toggle(b)});else $("#"+a+"_field_"+f+" :input").on("change",function(){var a;a=$(this).is(":checkbox")?$(this).is(":checked"):$(this).val();a=""===c&&a||""!==c&&c==a;a=s?!a:a;$(e).toggle(a)})});$("#"+a+"_user_form .form_field.restatement").each(function(d,b){var e=this,f=$(this).data("fieldid");if(f&&(f=$("#"+a+'_user_form .form_field :input[name="field_'+f+'"]'),0<f.length))if(f.is("input"))f.on("keyup",function(){$(e).find(":input").val($(this).val())});
else if(f.is("select"))f.on("change",function(){$(e).find(":input").val(""===$(this).val()?"":$(this).find("option:selected").text())})});$("#"+a+"_user_form .form_field.calculated").each(function(d,b){var e=$(this).find("input"),f=$(this).data("prefix"),c=$(this).data("postfix"),s=e.data("repeated"),l=e.data("repeated_row"),h=e.data("repeat_id"),g=$("#"+a+"_field_"+$(b).data("id")+"_calculation_code").text();if(g){var g=JSON.parse(g),q={},t="";if(g&&(t=w.buildFieldCalculation(a,g,q))){var k,n={};
for(d in q)if(k=$("#"+a+'_user_form .form_field input[name="field_'+d+'"]'),0<k.length){if(k.data("repeated")&&s&&k.data("repeat_id")==h){if(1<l&&(k=$("#"+a+'_user_form .form_field input[name="field_'+d+"_"+l+'"]'),0==k.length))continue}else k.data("repeated")&&(k._repeatedFields=[],g=$("#"+a+"_user_form .form_field.field_"+d+"_repeat input"),g.each(function(a,b){k._repeatedFields.push($(this));n[d+"_"+a]=$(this)}));n[d]=k}else t=t.replace("[[FIELD_"+d+"]]",+q[d]);var r,u,z;for(d in n)n[d].on("keyup",
function(){var d=t,l=!1,p=0;for(r in n){u=n[r].val();if(""==u||isNaN(u)||-1<u.toLowerCase().indexOf("e")){l=!0;break}if(n[r]._repeatedFields&&n[r]._repeatedFields.length){for(var s=[u],g=0;g<n[r]._repeatedFields.length;g++){var k=n[r]._repeatedFields[g].val();if(""==k||isNaN(k)||-1<k.toLowerCase().indexOf("e")){l=!0;break}s.push(k)}u="("+s.join(" + ")+")"}z="\\[\\[FIELD_"+r+"\\]\\]";d=d.replace(RegExp(z,"g"),u)}!l&&(p=Parser.evaluate(d),!_._iF(p)||999999999999999<p||-999999999999999>p)&&(l=!0);l?
p="NaN":(p=+p.toFixed(2),f&&(p=f+""+p),c&&(p=p+""+c));e.val(p);$("#"+a+'_user_form .form_field.restatement[data-fieldid="'+$(b).data("id")+'"] :input').val(p)})}}});$("#"+a+"_user_form .repeat_block").each(function(d,c){var e=$(this).data("id");$(this).find("div.add").on("click",function(){b.submitForm(a,l,{add_repeat_row:e})});$(this).find("div.delete").on("click",function(){var d=$(this).data("row");b.submitForm(a,l,{delete_repeat_row:e,row:d})})});$("#"+a+"_user_form .autocomplete_json").each(function(){var d=
this,c=JSON.parse($(this).text());if(c){for(var e=[],f=0;f<c.length;f++)e.push({value:c[f].v,label:c[f].l});$(this).prev().autocomplete({minLength:0,source:e,select:function(c,e){c.preventDefault();var f="",g="";e.item&&(f=e.item.label,g=e.item.value);$(d).next().val(g);$(d).prev().val(f);$(d).data("source_field")&&b.submitForm(a,l,{filter:1})},focus:function(a,d){this.value=d.item.label;a.preventDefault()},change:function(a,d){if(!d.item){var c=$(this).val(),b=e.find(function(a){return a.label.toLowerCase()===
c.toLowerCase()});$(this).data("ui-autocomplete")._trigger("select","autocompleteselect",{item:b})}},open:function(d,c){var b=this;$("#"+a+"_user_form").scroll(function(){$(b).autocomplete("close")})}}).on("click",function(){if(0==e.length){var a=$(d).data("auto_placeholder");a&&$(this).prop("placeholder",a)}$(this).autocomplete("search","")})}});$("#"+a+"_user_form .field_file_picker").each(function(){var a=this,c=$(this).find(".file_picker_field"),b=$(this).find(".progress_bar"),f=$(this).find(".file_upload_button"),
l=c.data("limit"),h=c.data("extensions"),v=0,w=0,a=this,x=$(this).data("id"),q=void 0;if(h){for(var q="\\.(",t=h.split(","),k=[],n=0;n<t.length;n++){var r=t[n].replace(/\./i,"").trim();r&&k.push(r)}q+=k.join("|");q=RegExp(q+")$","i")}b.progressbar();c.fileupload({url:g+"&filePickerUpload=1",dataType:"json",maxFileSize:1E7,acceptFileTypes:q,maxNumberOfFiles:l,getNumberOfFiles:function(){return v},submit:function(a,c){v++},start:function(a){b.show()},done:function(c,b){$.each(b.result.files,function(c,
b){var e;e='<div class="file_row">';e=b.download_link?e+('<p><a href="'+b.download_link+'" target="_blank">'+b.name+"</a></p>"):e+("<p>"+b.name+"</p>");e+='<input name="field_'+x+"_"+ ++w+'" type="hidden" value="'+b.id+'" />';e+='<span class="delete_file_button">'+zenario._p("zenario_user_forms","Delete")+"</span>";e+="</div>";$(a).find(".files").append($(e));v>=l&&f.hide()});$(a).find(".delete_file_button").off().on("click",function(){$(this).parent().remove();v--;v<l&&f.show()})},always:function(a,
c){b.hide()},processfail:function(a,b){alert(b.files[b.index].error)},progressall:function(a,c){var d=parseInt(100*(c.loaded/c.total),10);b.progressbar("option","value",d)},messages:{acceptFileTypes:zenario._p("zenario_user_forms","Allowed file types: [[types]]",{types:h}),maxFileSize:zenario._p("zenario_user_forms","File exceeds maximum allowed size of 10MB"),maxNumberOfFiles:zenario._p("zenario_user_forms","Maximum number of files exceeded")}});h={};q=$(this).find(".loaded_files").text();h.files=
JSON.parse(q);0<h.files.length&&(v=h.files.length,c.fileupload("option","done").call(c,$.Event("done"),{result:h}))})};b.printFormPage=function(){var a=$("#"+this.containerId+" .form_fields").html(),b=window.screenX+$(window).width()/2,g=window.open("","Print-Window","width=300,height=300,left="+b+",top="+window.screenY);g.document.open();g.document.write('<html><body onload="window.print()">'+a+"</body></html>");g.document.close();setTimeout(function(){g.close()},10)};b.buildFieldCalculation=function(a,
b,g){for(var c="",h=0;h<b.length;h++)switch(b[h].type){case "static_value":c+=+b[h].value;break;case "field":if("NaN"==b[h].v&&0>=$("#"+a+'_user_form .form_field input[name="field_'+b[h].value+'"]').length)return!1;g[b[h].value]=b[h].v;c+="[[FIELD_"+b[h].value+"]]";break;case "parentheses_open":c+="(";break;case "parentheses_close":c+=")";break;case "operation_addition":c+="+";break;case "operation_subtraction":c+="-";break;case "operation_multiplication":c+="*";break;case "operation_division":c+=
"/"}return c};b.submitForm=function(a,b,g,c){a=$("#"+a+"_user_form form");c||(zenario.blockScrollToTop=!0);if(g)for(var h in g)a.append('<input type="hidden" name="'+h+'" value="'+g[h]+'"/>');a.submit()};b.stopPoking=function(){b.poking&&clearInterval(b.poking);b.poking=!1};b.startPoking=function(){b.poking||(b.poking=setInterval(b.poke,12E4))};b.poke=function(){zenario._a(URLBasePath+"zenario/admin/quick_ajax.php?keep_session_alive=1")}})(zenario_user_forms);
zenario_user_forms.recaptchaCallback=function(){recaptchaCallback()};
