var defaultMapCentreLat,defaultMapCentreLng,defaultMapZoom,map,mapZoom,mapCenter,mapCenterLat,mapCenterLng,marker,markerLat,markerLng,pinPlacementMethod,editMode,initialized=!1;
function init(){var b={center:new google.maps.LatLng(defaultMapCentreLat,defaultMapCentreLng),zoom:defaultMapZoom,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),b);markerLat&&markerLng&&placeMarkerAction(new google.maps.LatLng(markerLat,markerLng),!0);google.maps.event.addListener(map,"bounds_changed",function(){mapZoom=map.getZoom();mapCenter=map.getCenter();mapCenterLat=mapCenter.lat();mapCenterLng=mapCenter.lng();updateMapLatLngZoomFields()});map.setOptions({scrollwheel:!1});
editMode||(void 0!=marker&&marker.setOptions({draggable:!1}),map.setOptions({disableDefaultUI:!0,draggable:!1,disableDoubleClickZoom:!0}))}
function placeMarker(b){var a="";pinPlacementMethod=b;"postcode_country"==pinPlacementMethod?(""!=parent.document.getElementById("postcode").value&&(a+=parent.document.getElementById("postcode").value.replace(" ","")+","),""!=parent.document.getElementById("country").value&&(b=parent.zenario.moduleNonAsyncAJAX("zenario_location_manager","&mode=get_country_name&country_id="+parent.document.getElementById("country").value),a+=b+","),a=trimTrailingComma(a),geoCode(a)):"street_postcode_country"==pinPlacementMethod?
(""!=parent.document.getElementById("address_line_1").value&&(a+=parent.document.getElementById("address_line_1").value+","),""!=parent.document.getElementById("postcode").value&&(a+=parent.document.getElementById("postcode").value.replace(" ","")+","),""!=parent.document.getElementById("country").value&&(b=parent.zenario.moduleNonAsyncAJAX("zenario_location_manager","&mode=get_country_name&country_id="+parent.document.getElementById("country").value),a+=b+","),a=trimTrailingComma(a),geoCode(a)):
"street_city_country"==pinPlacementMethod?(""!=parent.document.getElementById("address_line_1").value&&(a+=parent.document.getElementById("address_line_1").value+","),""!=parent.document.getElementById("city").value&&(a+=parent.document.getElementById("city").value+","),""!=parent.document.getElementById("country").value&&(b=parent.zenario.moduleNonAsyncAJAX("zenario_location_manager","&mode=get_country_name&country_id="+parent.document.getElementById("country").value),a+=b+","),a=trimTrailingComma(a),
geoCode(a)):"locality_postcode_country"==pinPlacementMethod&&(""!=parent.document.getElementById("locality").value&&(a+=parent.document.getElementById("locality").value+","),""!=parent.document.getElementById("postcode").value&&(a+=parent.document.getElementById("postcode").value.replace(" ","")+","),""!=parent.document.getElementById("country").value&&(b=parent.zenario.moduleNonAsyncAJAX("zenario_location_manager","&mode=get_country_name&country_id="+parent.document.getElementById("country").value),
a+=b+","),a=trimTrailingComma(a),geoCode(a))}function latLngInRange(b,a,c){return!isNaN(a)&&a>=b&&a<=c?!0:!1}function placeLatLng(b,a){if(latLngInRange(-90,b,90)&&latLngInRange(-180,a,180)){var c=new google.maps.LatLng(b,a);placeMarkerAction(c)}else alert("Please enter valid latitude/longitude values.")}
function geoCode(b){var a=new google.maps.Geocoder;a&&a.geocode({address:b},function(a,b){b==google.maps.GeocoderStatus.OK?(placeMarkerAction(a[0].geometry.location),map.fitBounds(a[0].geometry.viewport)):alert("Geocoding was not successful.  Google returned the following error code: "+b)})}function trimTrailingComma(b){","==b.substr(-1)&&(b=b.substr(0,b.length-1));return b}
function placeMarkerAction(b,a){a||(void 0!=marker&&marker.setMap(null),marker=void 0);markerLatLng=b;markerLat=markerLatLng.lat();markerLng=markerLatLng.lng();marker=new google.maps.Marker({position:markerLatLng,map:map,draggable:!0});updateMarkerLatLngFields();google.maps.event.addListener(marker,"dragend",function(a){b=a.latLng;markerLat=b.lat();markerLng=b.lng();updateMarkerLatLngFields()});a||map.setCenter(marker.getPosition())}
function clearMap(){defaultMapCentreLng=defaultMapCentreLat=0;defaultMapZoom=1;markerLng=markerLat=marker=void 0;updateMarkerLatLngFields();init()}function updateMarkerLatLngFields(){void 0==markerLat&&(markerLat="");void 0==markerLng&&(markerLng="");parent.document.getElementById("marker_lat").value=markerLat;parent.document.getElementById("marker_lng").value=markerLng;initialized&&window.parent.zenarioAB.fieldChange("map_edit")}
function updateMapLatLngZoomFields(){parent.document.getElementById("map_center_lat").value=mapCenterLat;parent.document.getElementById("map_center_lng").value=mapCenterLng;parent.document.getElementById("zoom").value=mapZoom;initialized&&window.parent.zenarioAB.fieldChange("map_edit");initialized=!0}
function success(b){defaultMapCentreLat=b.coords.latitude;defaultMapCentreLng=b.coords.longitude;markerLat=b.coords.latitude;markerLng=b.coords.longitude;defaultMapZoom=16;map.setCenter(new google.maps.LatLng(defaultMapCentreLat,defaultMapCentreLng));map.setZoom(defaultMapZoom);placeMarkerAction(new google.maps.LatLng(defaultMapCentreLat,defaultMapCentreLng))}function error(){alert("Your browser does not support this method")};
