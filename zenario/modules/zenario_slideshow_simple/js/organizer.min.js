zenario.lib(function(m,q,r,p,s,t,h,g,k,u,v,w,x,y,z,l,n,A,B,C,D,E,f){f.openSlideManager=function(b,c,a,e){var d=this;b&&b.blur();d.ajaxURL=a;d.slotName=c;d.instanceId=e;d.nextNewId=0;d.slides={};d.groups={};d.smartGroups={};d.showTabs=!1;d.deletedSlideIds=[];d.selectedSlideId=!1;d.changeMade=!1;d.desktop_canvas_setting=!1;d.desktop_canvas_setting_nice_name=!1;d.mobile_canvas_setting=!1;d.mobile_canvas_setting_nice_name=!1;d.mobile_canvas_width=!1;d.mobile_canvas_height=!1;d.dimensions=!1;d.mobileDimensions=
!1;d.errors=!1;d.setEditorHTML();h._a(a+"&mode=get_data").after(function(a){a=JSON.parse(a);Array.isArray(a.slides)||(d.slides=a.slides);Array.isArray(a.groups)||(d.groups=a.groups);Array.isArray(a.smartGroups)||(d.smartGroups=a.smartGroups);d.showTabs=a.showTabs;a.desktopCanvasSetting&&(d.desktop_canvas_setting=a.desktopCanvasSetting,d.desktop_canvas_setting_nice_name=a.desktopCanvasSettingNiceName);a.mobileCanvasSetting&&(d.mobile_canvas_setting=a.mobileCanvasSetting,d.mobile_canvas_setting_nice_name=
a.mobileCanvasSettingNiceName);a.width&&a.height&&(d.dimensions=a.width+" x "+a.height+"px");a.mobileWidth&&a.mobileHeight&&(d.mobileDimensions=a.mobileWidth+" x "+a.mobileHeight+"px");d.mobile_canvas_width=a.mobileWidth;d.mobile_canvas_height=a.mobileHeight;a=d.getOrderedSlides();d.selectedSlideId=0<a.length?a[0].id:!1;d.setSlidesHTML();d.selectSlide(d.selectedSlideId)})};f.setEditorHTML=function(){var b=this,c=k._mT("zenario_image_manager",{});g._oB(c,"zenario_fbAdminImageManager","AdminImageManager",
m,1E3,m,2,!0,!0,".zenario_dragMe",!1,!1);var a=function(){b.resizing&&clearTimeout(b.resizing);if(l("zenario_fbAdminInner")){var c=Math.floor(0.96*$(p).height()-150);800<c&&(c=800);0<(c*=1)&&(l("zenario_fbAdminInner").style.height=c+"px",l("zenario_slides").style.height=l("zenario_slide_attributes").style.height=c-60+"px")}b.resizing=setTimeout(a,250)};a();$("#zenario_slides .slide_navigation .last").on("click",function(){b.selectLastImage()});$("#zenario_slides .slide_navigation .first").on("click",
function(){b.selectFirstImage()});$("#zenario_slides .slide_navigation .up").on("click",function(){b.selectedSlideId&&b.nudgeImageUp(b.selectedSlideId)});$("#zenario_slides .slide_navigation .down").on("click",function(){b.selectedSlideId&&b.nudgeImageDown(b.selectedSlideId)});$("#zenario_slides .slide_navigation .delete").on("click",function(){b.selectedSlideId&&b.deleteSlide(b.selectedSlideId)});$("#zenario_image_manager .button_upload_images").on("click",function(){b.uploadImages()});$("#zenario_image_manager .button_add_images_organizer").on("click",
function(){b.pickImagesFromOrganizer()});$("#zenario_image_manager .zenario_close_image_manager").on("click",function(){b.closeImageManager()});$("#zenario_save_continue").on("click",function(){b.save()});$("#zenario_save_close").on("click",function(){b.save(!0)})};f.setSlidesHTML=function(){for(var b=this,c=b.getOrderedSlides(),a=0;a<c.length;a++)c[a].id==b.selectedSlideId&&(c[a].selected=!0);c=k._mT("zenario_slide_image",c);$("#zenario_sortable").html(c);$("#zenario_sortable").sortable({update:function(a,
c){b.saveSlideOrder();b.changeMade=!0}});$("#zenario_sortable li").on("click",function(){var a=$(this).data("id");b.selectSlide(a)})};f.setSlideDetailsHTML=function(b,c){var a=this,e={},d=new h.callback;c=c===m?"main":c;b&&(e=a.getSlideDetailsMergeFields(b,c,d));e=k._mT("zenario_slide_details",e);$("#zenario_slide_attributes_inner").html(e);d.done();$("#zenario_external_link").on("blur",function(){"http://"==this.value&&(this.value="")});$("#zenario_external_link").on("focus",function(){this.value||
(this.value="http://")});$("#zenario_select_content_item").on("click",function(){a.pickContentItemLinkFromOrganizer(b)});$("#zenario_image_type .slide_tab").on("click",function(){a.selectSlide(b,$(this).data("type"))});$("#zenario_upload_option").on("click",function(){a.uploadImages(b,"main")});$("#zenario_organizer_option").on("click",function(){a.pickImagesFromOrganizer(b,"main")});$("#zenario_rollover_upload_option").on("click",function(){a.uploadImages(b,"rollover")});$("#zenario_rollover_organizer_option").on("click",
function(){a.pickImagesFromOrganizer(b,"rollover")});$("#zenario_remove_rollover_image").on("click",function(c){a.slides[b].rollover_image_id=!1;a.selectSlide(b,"rollover");a.changeMade=!0});$("#zenario_mobile_upload_option").on("click",function(){a.uploadImages(b,"mobile")});$("#zenario_mobile_organizer_option").on("click",function(){a.pickImagesFromOrganizer(b,"mobile")});$("#zenario_remove_mobile_image").on("click",function(c){a.slides[b].mobile_image_id=!1;a.selectSlide(b,"mobile");a.changeMade=
!0})};f.getSlideDetailsMergeFields=function(b,c,a){a=JSON.parse(JSON.stringify(this.slides[b]));a.imageType=c;a.showTabs=this.showTabs;this.errors&&this.errors[b]&&this.errors[b][c]&&(a["error_"+c]=this.errors[b][c][0]);a.link_type_values=[{value:"_NO_LINK",label:"No link"},{value:"_CONTENT_ITEM",label:"Link to a content item"},{value:"_EXTERNAL_URL",label:"Link to an external URL"}];for(c=0;c<a.link_type_values.length;c++)a.link_type==a.link_type_values[c].value&&(a.link_type_values[c].selected=
!0);a.privacy_values=[{value:"public",label:"Everyone"},{value:"logged_in",label:"Private, only show to extranet users"},{value:"group_members",label:"Private, only show to extranet users in group(s)..."},{value:"in_smart_group",label:"Private, only show to extranet users in smart group..."},{value:"logged_in_not_in_smart_group",label:"Private, only show to extranet users NOT in the smart group..."},{value:"logged_out",label:"Only show to visitors who are NOT logged in"},{value:"call_static_method",
label:"Call a module's static method (advanced):"},{value:"hidden",label:"Hidden"}];for(c=0;c<a.privacy_values.length;c++)a.privacy==a.privacy_values[c].value&&(a.privacy_values[c].selected=!0);c=[];for(var e in this.groups)c.push({value:e,label:this.groups[e].label,checked:a.group_ids&&a.group_ids[e],ord:this.groups[e].ord});c.sort(function(a,b){return a.ord-b.ord});a.groups=c;c=[];for(e in this.smartGroups)c.push({value:e,label:this.smartGroups[e].label,selected:a.smart_group_id==e,ord:this.smartGroups[e].ord});
c.sort(function(a,b){return a.ord-b.ord});a.smart_groups_values=c;a.mobile_behaviour||(a.mobile_behaviour="same_image");a.mobile_behaviour_values=[{value:"same_image",label:"Use the same image as desktop"},{value:"same_image_different_size",label:"Use the desktop image at a different size"},{value:"different_image",label:"Use a different image"}];for(c=0;c<a.mobile_behaviour_values.length;c++)a.mobile_behaviour_values[c].id=b,a.mobile_behaviour_values[c].imageType="mobile",a.mobile_behaviour_values[c].name=
"mobile_behaviour",a.mobile_behaviour_values[c].format_onchange=!0,a.mobile_behaviour==a.mobile_behaviour_values[c].value&&(a.mobile_behaviour_values[c].selected=!0);a.m_width||(a.m_width=this.mobile_canvas_width);a.m_height||(a.m_height=this.mobile_canvas_height);if("same_image"==a.mobile_behaviour||"same_image_different_size"==a.mobile_behaviour)a.mobile_image_id=a.image_id,a.mobile_image_details_thumbnail_url=a.image_details_thumbnail_url,a.m_width=a.width,a.m_height=a.height;a.desktop_canvas_setting=
this.desktop_canvas_setting;a.desktop_canvas_setting_nice_name=this.desktop_canvas_setting_nice_name;a.mobile_canvas_setting=this.mobile_canvas_setting;a.mobile_canvas_setting_nice_name=this.mobile_canvas_setting_nice_name;this.dimensions&&(a.dimensions=this.dimensions);this.mobileDimensions&&(a.mobileDimensions=this.mobileDimensions);return a};f.getOrderedSlides=function(){var b=[],c;for(c in this.slides)b.push(_._cl(this.slides[c]));b.sort(function(a,b){return a.ord-b.ord});return b};f.saveSlideOrder=
function(){for(var b=$("#zenario_sortable").sortable("toArray",{attribute:"data-id"}),c=0;c<b.length;c++)this.slides[b[c]].ord=c+1};f.selectSlide=function(b,c){this.saveOpenDetails();this.selectedSlideId=b;this.setSlidesHTML();this.setSlideDetailsHTML(b,c)};f.saveOpenDetails=function(){var b=this.slides[this.selectedSlideId];if(b){for(var c=$("#zenario_slide_settings_form").serializeArray(),a=0;a<c.length;a++)b[c[a].name]=c[a].value;var e={};$("#zenario_slide_settings_form input:checkbox").each(function(){var a=
this.name.indexOf("[]");-1!==a?(a=this.name.substr(0,a),e[a]||(e[a]={}),this.checked&&(e[a][this.value]=!0)):b[this.name]=this.checked});for(var d in e)b[d]=e[d]}};f.deleteSlide=function(b){for(var c=this.getOrderedSlides(),a=!1,e=0;e<c.length;e++)if(c[e].id==b){c[e-1]?a=c[e-1].id:c[e+1]&&(a=c[e+1].id);break}this.deletedSlideIds.push(b);delete this.slides[b];this.selectedSlideId=a;this.selectSlide(a);this.saveSlideOrder();this.changeMade=!0};f.selectLastImage=function(){var b=this.getOrderedSlides();
b.length&&this.selectSlide(b[b.length-1].id)};f.selectFirstImage=function(){var b=this.getOrderedSlides();b.length&&this.selectSlide(b[0].id)};f.nudgeImageUp=function(b){this.slides[b].ord-=1.1;this.setSlidesHTML();this.saveSlideOrder();this.changeMade=!0};f.nudgeImageDown=function(b){this.slides[b].ord+=1.1;this.setSlidesHTML();this.saveSlideOrder();this.changeMade=!0};f.uploadImages=function(b,c){var a=this,e={mode:"file_upload"},d='<input type="file" name="Filedata" accept="image/*"';if(k._cDHTML5U())d=
$(d+" multiple/>"),d.change(function(){k._dHTML5U(this.files,a.ajaxURL,e,function(d){a.uploadImagesCallback(b,c,d)})}),d.click();else{d+=' id="zenario_fallback_fileupload"/>';e._html5_backwards_compatibility_hack=1;var d='<form id="zenario_bc_form" action="'+n(a.ajaxURL)+'" onsubmit="" target="zenario_iframe" method="post" enctype="multipart/form-data">'+d,f;for(f in e)d+='<input type="hidden" value="'+n(e[f])+'" name="'+n(f)+'"/>';d+="</form>";f='<input type="button" class="submit_selected" value="'+
g.phrase.upload+'" onclick="get(\'zenario_bc_form\').submit();"/>';f+='<input type="button" class="submit" value="'+g.phrase.cancel+'"/>';g._sM(d,f);h._bII()||$("#zenario_fallback_fileupload").click()}};f.uploadImagesCallback=function(b,c,a){if(a.length){if(b)"rollover"==c?(this.slides[b].rollover_image_id=a[0].id,this.slides[b].r_filename=a[0].filename,this.slides[b].r_alt_tag=a[0].alt_tag,this.slides[b].r_width=a[0].width,this.slides[b].r_height=a[0].height,this.slides[b].rollover_image_details_thumbnail_url=
a[0].link+"&height=150&width=300"):"mobile"==c?(this.slides[b].mobile_image_id=a[0].id,this.slides[b].m_filename=a[0].filename,this.slides[b].m_alt_tag=a[0].alt_tag,this.slides[b].m_width=a[0].width,this.slides[b].m_height=a[0].height,this.slides[b].mobile_image_details_thumbnail_url=a[0].link+"&height=150&width=300"):(this.slides[b].image_id=a[0].id,this.slides[b].filename=a[0].filename,this.slides[b].alt_tag=a[0].alt_tag,this.slides[b].width=a[0].width,this.slides[b].height=a[0].height,this.slides[b].image_details_thumbnail_url=
a[0].link+"&height=150&width=300",this.slides[b].image_list_thumbnail_url=a[0].link+"&height=150&width=150");else for(var e=0;e<a.length;e++)b=this.addNewSlide({image_id:a[e].id,filename:a[e].filename,alt_tag:a[e].alt_tag,width:a[e].width,height:a[e].height,image_details_thumbnail_url:a[e].link+"&height=150&width=300",image_list_thumbnail_url:a[e].link+"&height=150&width=150"});this.selectSlide(b,c);this.changeMade=!0}};f.pickImagesFromOrganizer=function(b,c){this.remember={slideId:b,imageType:c};
g._oS("zenario_slideshow_simple","pickImagesFromOrganizerCallback",!0,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};f.pickImagesFromOrganizerCallback=function(b,c,a){var e=this,d=e.remember.slideId,f=e.remember.imageType;e.remember=!1;h._a(e.ajaxURL+"&mode=add_slides_from_organizer&ids="+c.id).after(function(a){a=JSON.parse(a);if(a.length){if(d)"rollover"==f?(e.slides[d].rollover_image_id=
a[0].image_id,e.slides[d].r_filename=a[0].filename,e.slides[d].r_alt_tag=a[0].alt_tag,e.slides[d].r_width=a[0].width,e.slides[d].r_height=a[0].height,e.slides[d].rollover_image_details_thumbnail_url=a[0].image_details_thumbnail_url):"mobile"==f?(e.slides[d].mobile_image_id=a[0].image_id,e.slides[d].m_filename=a[0].filename,e.slides[d].m_alt_tag=a[0].alt_tag,e.slides[d].m_width=a[0].width,e.slides[d].m_height=a[0].height,e.slides[d].mobile_image_details_thumbnail_url=a[0].image_details_thumbnail_url):
(e.slides[d].image_id=a[0].image_id,e.slides[d].filename=a[0].filename,e.slides[d].alt_tag=a[0].alt_tag,e.slides[d].width=a[0].width,e.slides[d].height=a[0].height,e.slides[d].image_details_thumbnail_url=a[0].image_details_thumbnail_url,e.slides[d].image_list_thumbnail_url=a[0].image_list_thumbnail_url);else for(var b=0;b<a.length;b++)d=e.addNewSlide(a[b]);e.selectSlide(d,f);e.changeMade=!0}})};f.addNewSlide=function(b){b.id="t"+ ++this.nextNewId;var c=this.getOrderedSlides();b.ord=c.length?c[c.length-
1].ord+1:1;this.slides[b.id]=b;this.changeMade=!0;return b.id};f.pickContentItemLinkFromOrganizer=function(b){var c="zenario__content/panels/content";$("#zenario_content_item_id").val()&&(c="zenario__content/panels/content//"+$("#zenario_content_item_id").val());this.remember={slideId:b};g._oS("zenario_slideshow_simple","organizerPickContentItemLinkCallback",!1,c,"zenario__content/panels/content","zenario__content/panels/content",!1,!0)};f.organizerPickContentItemLinkCallback=function(b,c,a){b=this.remember.slideId;
this.remember=!1;this.slides[b].hyperlink_target_display=a.tag;this.slides[b].hyperlink_target=c.id;this.selectSlide(b);this.changeMade=!0};f.closeImageManager=function(){this.saveOpenDetails();this.changeMade&&!confirm("You are currently editing thus floating admin box. If you leave now you will loose any unsaved changes.")||g._cB("AdminImageManager")};f.save=function(b){var c=this;c.saveOpenDetails();var a={slides:JSON.stringify(c.slides),deletedSlideIds:JSON.stringify(c.deletedSlideIds)};h._a(c.ajaxURL+
"&mode=save_slides",a).after(function(a){a=JSON.parse(a);if(_._isEm(a))c.slotName&&h._rPS(c.slotName,"lookup"),b&&g._cB("AdminImageManager");else{c.errors=a;for(var d in a){for(var f in a[d]){c.selectSlide(d,f);break}break}}})}},zenario_slideshow_simple);
