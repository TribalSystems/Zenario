'use strict';zenario.lib(function(p,u,v,t,w,x,l,k,m,y,z,A,B,C,D,n,q,E,F,G,H,I,h){h.openSlideManager=function(b,c,a,d){var e=this;b&&b.blur();e.ajaxURL=a;e.slotName=c;e.instanceId=d;e.nextNewId=0;e.slides={};e.groups={};e.smartGroups={};e.showTabs=!1;e.deletedSlideIds=[];e.selectedSlideId=!1;e.changeMade=!1;e.desktop_canvas_setting=!1;e.desktop_canvas_setting_nice_name=!1;e.mobile_canvas_setting=!1;e.mobile_canvas_setting_nice_name=!1;e.mobile_canvas_width=!1;e.mobile_canvas_height=!1;e.dimensions=
!1;e.mobileDimensions=!1;e.errors=!1;e.setEditorHTML();l._a(a+"&mode=get_data").after(function(f){f=JSON.parse(f);Array.isArray(f.slides)||(e.slides=f.slides);Array.isArray(f.groups)||(e.groups=f.groups);Array.isArray(f.smartGroups)||(e.smartGroups=f.smartGroups);e.showTabs=f.showTabs;f.desktopCanvasSetting&&(e.desktop_canvas_setting=f.desktopCanvasSetting,e.desktop_canvas_setting_nice_name=f.desktopCanvasSettingNiceName);f.mobileCanvasSetting&&(e.mobile_canvas_setting=f.mobileCanvasSetting,e.mobile_canvas_setting_nice_name=
f.mobileCanvasSettingNiceName);f.width&&f.height&&(e.dimensions=f.width+" x "+f.height+"px");f.mobileWidth&&f.mobileHeight&&(e.mobileDimensions=f.mobileWidth+" x "+f.mobileHeight+"px");e.mobile_canvas_width=f.mobileWidth;e.mobile_canvas_height=f.mobileHeight;f=e.getOrderedSlides();e.selectedSlideId=0<f.length?f[0].id:!1;e.setSlidesHTML();e.selectSlide(e.selectedSlideId)})};h.setEditorHTML=function(){var b=this,c=m._mT("zenario_image_manager",{});k._oB(c,"zenario_fbAdminImageManager","AdminImageManager",
p,1E3,p,2,!0,!0,".zenario_dragMe",!1,!1);var a=function(){b.resizing&&clearTimeout(b.resizing);if(n("zenario_fbAdminInner")){var d=Math.floor(.96*$(t).height()-150);800<d&&(d=800);0<(d*=1)&&(n("zenario_fbAdminInner").style.height=d+"px",n("zenario_slides").style.height=n("zenario_slide_attributes").style.height=d-60+"px")}b.resizing=setTimeout(a,250)};a();$("#zenario_slides .slide_navigation .last").on("click",function(){b.selectLastImage()});$("#zenario_slides .slide_navigation .first").on("click",
function(){b.selectFirstImage()});$("#zenario_slides .slide_navigation .up").on("click",function(){b.selectedSlideId&&b.nudgeImageUp(b.selectedSlideId)});$("#zenario_slides .slide_navigation .down").on("click",function(){b.selectedSlideId&&b.nudgeImageDown(b.selectedSlideId)});$("#zenario_slides .slide_navigation .delete").on("click",function(){b.selectedSlideId&&b.deleteSlide(b.selectedSlideId)});$("#zenario_image_manager .button_upload_images").on("click",function(){b.uploadImages()});$("#zenario_image_manager .button_add_images_organizer").on("click",
function(){b.pickImagesFromOrganizer()});$("#zenario_image_manager .zenario_close_image_manager").on("click",function(){b.closeImageManager()});$("#zenario_save_continue").on("click",function(){b.save()});$("#zenario_save_close").on("click",function(){b.save(!0)})};h.setSlidesHTML=function(){for(var b=this,c=b.getOrderedSlides(),a=0;a<c.length;a++)c[a].id==b.selectedSlideId&&(c[a].selected=!0);c=m._mT("zenario_slide_image",c);$("#zenario_sortable").html(c);$("#zenario_sortable").sortable({update:function(d,
e){b.saveSlideOrder();b.changeMade=!0}});$("#zenario_sortable li").on("click",function(){var d=$(this).data("id");b.selectSlide(d)})};h.setSlideDetailsHTML=function(b,c){var a=this,d={},e=new l.callback;c=c===p?"main":c;b&&(d=a.getSlideDetailsMergeFields(b,c,e));c=m._mT("zenario_slide_details",d);$("#zenario_slide_attributes_inner").html(c);e.done();$("#zenario_external_link").on("blur",function(){"http://"==this.value&&(this.value="")});$("#zenario_external_link").on("focus",function(){this.value||
(this.value="http://")});$("#zenario_select_content_item").on("click",function(){a.pickContentItemLinkFromOrganizer(b)});$("#zenario_image_type .slide_tab").on("click",function(){a.selectSlide(b,$(this).data("type"))});$("#zenario_upload_option").on("click",function(){a.uploadImages(b,"main")});$("#zenario_organizer_option").on("click",function(){a.pickImagesFromOrganizer(b,"main")});$("#zenario_rollover_upload_option").on("click",function(){a.uploadImages(b,"rollover")});$("#zenario_rollover_organizer_option").on("click",
function(){a.pickImagesFromOrganizer(b,"rollover")});$("#zenario_remove_rollover_image").on("click",function(f){a.slides[b].rollover_image_id=!1;a.selectSlide(b,"rollover");a.changeMade=!0});$("#zenario_mobile_upload_option").on("click",function(){a.uploadImages(b,"mobile")});$("#zenario_mobile_organizer_option").on("click",function(){a.pickImagesFromOrganizer(b,"mobile")});$("#zenario_remove_mobile_image").on("click",function(f){a.slides[b].mobile_image_id=!1;a.selectSlide(b,"mobile");a.changeMade=
!0})};h.getSlideDetailsMergeFields=function(b,c,a){a=JSON.parse(JSON.stringify(this.slides[b]));a.imageType=c;a.showTabs=this.showTabs;this.errors&&this.errors[b]&&this.errors[b][c]&&(a["error_"+c]=this.errors[b][c][0]);a.link_type_values=[{value:"_NO_LINK",label:"No link"},{value:"_CONTENT_ITEM",label:"Link to a content item"},{value:"_EXTERNAL_URL",label:"Link to an external URL"}];for(c=0;c<a.link_type_values.length;c++)a.link_type==a.link_type_values[c].value&&(a.link_type_values[c].selected=
!0);a.privacy_values=[{value:"public",label:"Everyone"},{value:"logged_in",label:"Private, only show to extranet users"},{value:"group_members",label:"Private, only show to extranet users in group(s)..."},{value:"in_smart_group",label:"Private, only show to extranet users in smart group..."},{value:"logged_in_not_in_smart_group",label:"Private, only show to extranet users NOT in the smart group..."},{value:"logged_out",label:"Only show to visitors who are NOT logged in"},{value:"call_static_method",
label:"Call a module's static method (advanced):"},{value:"hidden",label:"Hidden"}];for(c=0;c<a.privacy_values.length;c++)a.privacy==a.privacy_values[c].value&&(a.privacy_values[c].selected=!0);c=[];for(var d in this.groups)c.push({value:d,label:this.groups[d].label,checked:a.group_ids&&a.group_ids[d],ord:this.groups[d].ord});c.sort(function(e,f){return e.ord-f.ord});a.groups=c;c=[];for(d in this.smartGroups)c.push({value:d,label:this.smartGroups[d].label,selected:a.smart_group_id==d,ord:this.smartGroups[d].ord});
c.sort(function(e,f){return e.ord-f.ord});a.smart_groups_values=c;a.mobile_behaviour||(a.mobile_behaviour="same_image");a.mobile_behaviour_values=[{value:"same_image",label:"Use the same image as desktop"},{value:"same_image_different_size",label:"Use the desktop image at a different size"},{value:"different_image",label:"Use a different image"}];for(c=0;c<a.mobile_behaviour_values.length;c++)a.mobile_behaviour_values[c].id=b,a.mobile_behaviour_values[c].imageType="mobile",a.mobile_behaviour_values[c].name=
"mobile_behaviour",a.mobile_behaviour_values[c].format_onchange=!0,a.mobile_behaviour==a.mobile_behaviour_values[c].value&&(a.mobile_behaviour_values[c].selected=!0);a.m_width||(a.m_width=this.mobile_canvas_width);a.m_height||(a.m_height=this.mobile_canvas_height);if("same_image"==a.mobile_behaviour||"same_image_different_size"==a.mobile_behaviour)a.mobile_image_id=a.image_id,a.mobile_image_details_thumbnail_url=a.image_details_thumbnail_url,a.m_width=a.width,a.m_height=a.height;a.desktop_canvas_setting=
this.desktop_canvas_setting;a.desktop_canvas_setting_nice_name=this.desktop_canvas_setting_nice_name;a.mobile_canvas_setting=this.mobile_canvas_setting;a.mobile_canvas_setting_nice_name=this.mobile_canvas_setting_nice_name;this.dimensions&&(a.dimensions=this.dimensions);this.mobileDimensions&&(a.mobileDimensions=this.mobileDimensions);return a};h.getOrderedSlides=function(){var b=[],c;for(c in this.slides)b.push(_._cl(this.slides[c]));b.sort(function(a,d){return a.ord-d.ord});return b};h.saveSlideOrder=
function(){for(var b=$("#zenario_sortable").sortable("toArray",{attribute:"data-id"}),c=0;c<b.length;c++)this.slides[b[c]].ord=c+1};h.selectSlide=function(b,c){this.saveOpenDetails();this.selectedSlideId=b;this.setSlidesHTML();this.setSlideDetailsHTML(b,c)};h.saveOpenDetails=function(){var b=this.slides[this.selectedSlideId];if(b){for(var c=$("#zenario_slide_settings_form").serializeArray(),a=0;a<c.length;a++)b[c[a].name]=c[a].value;var d={};$("#zenario_slide_settings_form input:checkbox").each(function(){var f=
this.name.indexOf("[]");-1!==f?(f=this.name.substr(0,f),d[f]||(d[f]={}),this.checked&&(d[f][this.value]=!0)):b[this.name]=this.checked});for(var e in d)b[e]=d[e]}};h.deleteSlide=function(b){for(var c=this.getOrderedSlides(),a=!1,d=0;d<c.length;d++)if(c[d].id==b){c[d-1]?a=c[d-1].id:c[d+1]&&(a=c[d+1].id);break}this.deletedSlideIds.push(b);delete this.slides[b];this.selectedSlideId=a;this.selectSlide(a);this.saveSlideOrder();this.changeMade=!0};h.selectLastImage=function(){var b=this.getOrderedSlides();
b.length&&this.selectSlide(b[b.length-1].id)};h.selectFirstImage=function(){var b=this.getOrderedSlides();b.length&&this.selectSlide(b[0].id)};h.nudgeImageUp=function(b){this.slides[b].ord-=1.1;this.setSlidesHTML();this.saveSlideOrder();this.changeMade=!0};h.nudgeImageDown=function(b){this.slides[b].ord+=1.1;this.setSlidesHTML();this.saveSlideOrder();this.changeMade=!0};h.uploadImages=function(b,c){var a=this,d={mode:"file_upload"},e='<input type="file" name="Filedata" accept="image/*"';if(m._cDHTML5U())e=
$(e+" multiple/>"),e.change(function(){m._dHTML5U(this.files,a.ajaxURL,d,function(g){a.uploadImagesCallback(b,c,g)})}),e.click();else{e+=' id="zenario_fallback_fileupload"/>';d._html5_backwards_compatibility_hack=1;e='<form id="zenario_bc_form" action="'+q(a.ajaxURL)+'" onsubmit="" target="zenario_iframe" method="post" enctype="multipart/form-data">'+e;for(var f in d)e+='<input type="hidden" value="'+q(d[f])+'" name="'+q(f)+'"/>';f='<input type="button" class="submit_selected" value="'+k.phrase.upload+
'" onclick="get(\'zenario_bc_form\').submit();"/>';f+='<input type="button" class="submit" value="'+k.phrase.cancel+'"/>';k._sM(e+"</form>",f);l._bII()||$("#zenario_fallback_fileupload").click()}};h.uploadImagesCallback=function(b,c,a){if(a.length){if(b)"rollover"==c?(this.slides[b].rollover_image_id=a[0].id,this.slides[b].r_filename=a[0].filename,this.slides[b].r_alt_tag=a[0].alt_tag,this.slides[b].r_width=a[0].width,this.slides[b].r_height=a[0].height,this.slides[b].rollover_image_details_thumbnail_url=
a[0].link+"&height=150&width=300"):"mobile"==c?(this.slides[b].mobile_image_id=a[0].id,this.slides[b].m_filename=a[0].filename,this.slides[b].m_alt_tag=a[0].alt_tag,this.slides[b].m_width=a[0].width,this.slides[b].m_height=a[0].height,this.slides[b].mobile_image_details_thumbnail_url=a[0].link+"&height=150&width=300"):(this.slides[b].image_id=a[0].id,this.slides[b].filename=a[0].filename,this.slides[b].alt_tag=a[0].alt_tag,this.slides[b].width=a[0].width,this.slides[b].height=a[0].height,this.slides[b].image_details_thumbnail_url=
a[0].link+"&height=150&width=300",this.slides[b].image_list_thumbnail_url=a[0].link+"&height=150&width=150");else for(var d=0;d<a.length;d++)b=this.addNewSlide({image_id:a[d].id,filename:a[d].filename,alt_tag:a[d].alt_tag,width:a[d].width,height:a[d].height,image_details_thumbnail_url:a[d].link+"&height=150&width=300",image_list_thumbnail_url:a[d].link+"&height=150&width=150"});this.selectSlide(b,c);this.changeMade=!0}};h.pickImagesFromOrganizer=function(b,c){this.remember={slideId:b,imageType:c};
k._oS("zenario_slideshow_simple","pickImagesFromOrganizerCallback",!0,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};h.pickImagesFromOrganizerCallback=function(b,c,a){var d=this,e=d.remember.slideId,f=d.remember.imageType;d.remember=!1;l._a(d.ajaxURL+"&mode=add_slides_from_organizer&ids="+c.id).after(function(g){g=JSON.parse(g);if(g.length){if(e)"rollover"==f?(d.slides[e].rollover_image_id=
g[0].image_id,d.slides[e].r_filename=g[0].filename,d.slides[e].r_alt_tag=g[0].alt_tag,d.slides[e].r_width=g[0].width,d.slides[e].r_height=g[0].height,d.slides[e].rollover_image_details_thumbnail_url=g[0].image_details_thumbnail_url):"mobile"==f?(d.slides[e].mobile_image_id=g[0].image_id,d.slides[e].m_filename=g[0].filename,d.slides[e].m_alt_tag=g[0].alt_tag,d.slides[e].m_width=g[0].width,d.slides[e].m_height=g[0].height,d.slides[e].mobile_image_details_thumbnail_url=g[0].image_details_thumbnail_url):
(d.slides[e].image_id=g[0].image_id,d.slides[e].filename=g[0].filename,d.slides[e].alt_tag=g[0].alt_tag,d.slides[e].width=g[0].width,d.slides[e].height=g[0].height,d.slides[e].image_details_thumbnail_url=g[0].image_details_thumbnail_url,d.slides[e].image_list_thumbnail_url=g[0].image_list_thumbnail_url);else for(var r=0;r<g.length;r++)e=d.addNewSlide(g[r]);d.selectSlide(e,f);d.changeMade=!0}})};h.addNewSlide=function(b){b.id="t"+ ++this.nextNewId;var c=this.getOrderedSlides();b.ord=c.length?c[c.length-
1].ord+1:1;this.slides[b.id]=b;this.changeMade=!0;return b.id};h.pickContentItemLinkFromOrganizer=function(b){var c="zenario__content/panels/content";$("#zenario_content_item_id").val()&&(c="zenario__content/panels/content//"+$("#zenario_content_item_id").val());this.remember={slideId:b};k._oS("zenario_slideshow_simple","organizerPickContentItemLinkCallback",!1,c,"zenario__content/panels/content","zenario__content/panels/content",!1,!0)};h.organizerPickContentItemLinkCallback=function(b,c,a){b=this.remember.slideId;
this.remember=!1;this.slides[b].hyperlink_target_display=a.tag;this.slides[b].hyperlink_target=c.id;this.selectSlide(b);this.changeMade=!0};h.closeImageManager=function(){this.saveOpenDetails();this.changeMade&&!confirm("You are currently editing thus floating admin box. If you leave now you will loose any unsaved changes.")||k._cB("AdminImageManager")};h.save=function(b){var c=this;c.saveOpenDetails();var a={slides:JSON.stringify(c.slides),deletedSlideIds:JSON.stringify(c.deletedSlideIds)};l._a(c.ajaxURL+
"&mode=save_slides",a).after(function(d){d=JSON.parse(d);if(_._isEm(d))c.slotName&&l._rPS(c.slotName,"lookup"),b&&k._cB("AdminImageManager");else{c.errors=d;for(var e in d){for(var f in d[e]){c.selectSlide(e,f);break}break}}})}},zenario_slideshow_simple);
