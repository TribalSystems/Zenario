zenario.lib(function(m,q,r,p,s,t,h,g,k,u,v,w,x,y,z,l,n,A,B,C,D,E,f){f.openSlideManager=function(a,c,b,d){var e=this;a&&a.blur();e.ajaxURL=b;e.slotName=c;e.instanceId=d;e.nextNewId=0;e.slides={};e.groups={};e.smartGroups={};e.showTabs=!1;e.deletedSlideIds=[];e.selectedSlideId=!1;e.changeMade=!1;e.dimensions=!1;e.mobileDimensions=!1;e.errors=!1;e.setEditorHTML();h._a(b+"&mode=get_data").after(function(a){a=JSON.parse(a);Array.isArray(a.slides)||(e.slides=a.slides);Array.isArray(a.groups)||(e.groups=
a.groups);Array.isArray(a.smartGroups)||(e.smartGroups=a.smartGroups);e.showTabs=a.showTabs;a.width&&a.height&&(e.dimensions=a.width+"px wide, "+a.height+"px high");a.mobileWidth&&a.mobileHeight&&(e.mobileDimensions=a.mobileWidth+"px wide, "+a.mobileHeight+"px high");a=e.getOrderedSlides();e.selectedSlideId=0<a.length?a[0].id:!1;e.setSlidesHTML();e.selectSlide(e.selectedSlideId)})};f.setEditorHTML=function(){var a=this,c=k._mT("zenario_image_manager",{});g._oB(c,"zenario_fbAdminImageManager","AdminImageManager",
m,1E3,m,2,!0,!0,".zenario_dragMe",!1,!1);var b=function(){a.resizing&&clearTimeout(a.resizing);if(l("zenario_fbAdminInner")){var c=Math.floor(0.96*$(p).height()-150);800<c&&(c=800);0<(c*=1)&&(l("zenario_fbAdminInner").style.height=c+"px",l("zenario_slides").style.height=l("zenario_slide_attributes").style.height=c-60+"px")}a.resizing=setTimeout(b,250)};b();$("#zenario_slides .slide_navigation .last").on("click",function(){a.selectLastImage()});$("#zenario_slides .slide_navigation .first").on("click",
function(){a.selectFirstImage()});$("#zenario_slides .slide_navigation .up").on("click",function(){a.selectedSlideId&&a.nudgeImageUp(a.selectedSlideId)});$("#zenario_slides .slide_navigation .down").on("click",function(){a.selectedSlideId&&a.nudgeImageDown(a.selectedSlideId)});$("#zenario_slides .slide_navigation .delete").on("click",function(){a.selectedSlideId&&a.deleteSlide(a.selectedSlideId)});$("#zenario_image_manager .button_upload_images").on("click",function(){a.uploadImages()});$("#zenario_image_manager .button_add_images_organizer").on("click",
function(){a.pickImagesFromOrganizer()});$("#zenario_image_manager .zenario_close_image_manager").on("click",function(){a.closeImageManager()});$("#zenario_save_continue").on("click",function(){a.save()});$("#zenario_save_close").on("click",function(){a.save(!0)})};f.setSlidesHTML=function(){for(var a=this,c=a.getOrderedSlides(),b=0;b<c.length;b++)c[b].id==a.selectedSlideId&&(c[b].selected=!0);c=k._mT("zenario_slide_image",c);$("#zenario_sortable").html(c);$("#zenario_sortable").sortable({update:function(b,
c){a.saveSlideOrder();a.changeMade=!0}});$("#zenario_sortable li").on("click",function(){var b=$(this).data("id");a.selectSlide(b)})};f.setSlideDetailsHTML=function(a,c){var b=this,d={},e=new h.callback;c=c===m?"main":c;a&&(d=b.getSlideDetailsMergeFields(a,c,e));d=k._mT("zenario_slide_details",d);$("#zenario_slide_attributes_inner").html(d);e.done();$("#zenario_external_link").on("blur",function(){"http://"==this.value&&(this.value="")});$("#zenario_external_link").on("focus",function(){this.value||
(this.value="http://")});$("#zenario_select_content_item").on("click",function(){b.pickContentItemLinkFromOrganizer(a)});$("#zenario_image_type .slide_tab").on("click",function(){b.selectSlide(a,$(this).data("type"))});$("#zenario_upload_option").on("click",function(){b.uploadImages(a,"main")});$("#zenario_organizer_option").on("click",function(){b.pickImagesFromOrganizer(a,"main")});$("#zenario_rollover_upload_option").on("click",function(){b.uploadImages(a,"rollover")});$("#zenario_rollover_organizer_option").on("click",
function(){b.pickImagesFromOrganizer(a,"rollover")});$("#zenario_remove_rollover_image").on("click",function(c){b.slides[a].rollover_image_id=!1;b.selectSlide(a,"rollover");b.changeMade=!0});$("#zenario_mobile_upload_option").on("click",function(){b.uploadImages(a,"mobile")});$("#zenario_mobile_organizer_option").on("click",function(){b.pickImagesFromOrganizer(a,"mobile")});$("#zenario_remove_mobile_image").on("click",function(c){b.slides[a].mobile_image_id=!1;b.selectSlide(a,"mobile");b.changeMade=
!0})};f.getSlideDetailsMergeFields=function(a,c,b){b=JSON.parse(JSON.stringify(this.slides[a]));b.imageType=c;b.showTabs=this.showTabs;this.errors&&this.errors[a]&&this.errors[a][c]&&(b["error_"+c]=this.errors[a][c][0]);b.link_type_values=[{value:"_NO_LINK",label:"No link"},{value:"_CONTENT_ITEM",label:"Link to a content item"},{value:"_EXTERNAL_URL",label:"Link to an external URL"}];for(c=0;c<b.link_type_values.length;c++)b.link_type==b.link_type_values[c].value&&(b.link_type_values[c].selected=
!0);b.privacy_values=[{value:"public",label:"Everyone"},{value:"logged_out",label:"Only show to visitors who are NOT logged in"},{value:"logged_in",label:"Private, only show to extranet users who are logged in"},{value:"group_members",label:"Private, only show to extranet users in the group(s):"},{value:"in_smart_group",label:"Private, only show to extranet users in the smart group:"},{value:"logged_in_not_in_smart_group",label:"Private, only show to extranet users NOT in the smart group:"},{value:"call_static_method",
label:"Call a module's static method (advanced):"},{value:"hidden",label:"Hidden"}];for(c=0;c<b.privacy_values.length;c++)b.privacy==b.privacy_values[c].value&&(b.privacy_values[c].selected=!0);c=[];for(var d in this.groups)c.push({value:d,label:this.groups[d].label,checked:b.group_ids&&b.group_ids[d],ord:this.groups[d].ord});c.sort(function(a,b){return a.ord-b.ord});b.groups=c;c=[];for(d in this.smartGroups)c.push({value:d,label:this.smartGroups[d].label,selected:b.smart_group_id==d,ord:this.smartGroups[d].ord});
c.sort(function(a,b){return a.ord-b.ord});b.smart_groups_values=c;b.mobile_behaviour||(b.mobile_behaviour="same_image");b.mobile_behaviour_values=[{value:"same_image",label:"Use the same image as desktop"},{value:"same_image_different_size",label:"Use the desktop image at a different size"},{value:"different_image",label:"Use a different image"}];for(c=0;c<b.mobile_behaviour_values.length;c++)b.mobile_behaviour_values[c].id=a,b.mobile_behaviour_values[c].imageType="mobile",b.mobile_behaviour_values[c].name=
"mobile_behaviour",b.mobile_behaviour_values[c].format_onchange=!0,b.mobile_behaviour==b.mobile_behaviour_values[c].value&&(b.mobile_behaviour_values[c].selected=!0);if("same_image"==b.mobile_behaviour||"same_image_different_size"==b.mobile_behaviour)b.mobile_image_id=b.image_id,b.mobile_image_details_thumbnail_url=b.image_details_thumbnail_url,b.m_width=b.width,b.m_height=b.height;this.dimensions&&(b.dimensions=this.dimensions);this.mobileDimensions&&(b.mobileDimensions=this.mobileDimensions);return b};
f.getOrderedSlides=function(){var a=[],c;for(c in this.slides)a.push(_._cl(this.slides[c]));a.sort(function(a,c){return a.ord-c.ord});return a};f.saveSlideOrder=function(){for(var a=$("#zenario_sortable").sortable("toArray",{attribute:"data-id"}),c=0;c<a.length;c++)this.slides[a[c]].ord=c+1};f.selectSlide=function(a,c){this.saveOpenDetails();this.selectedSlideId=a;this.setSlidesHTML();this.setSlideDetailsHTML(a,c)};f.saveOpenDetails=function(){var a=this.slides[this.selectedSlideId];if(a){for(var c=
$("#zenario_slide_settings_form").serializeArray(),b=0;b<c.length;b++)a[c[b].name]=c[b].value;var d={};$("#zenario_slide_settings_form input:checkbox").each(function(){var b=this.name.indexOf("[]");-1!==b?(b=this.name.substr(0,b),d[b]||(d[b]={}),this.checked&&(d[b][this.value]=!0)):a[this.name]=this.checked});for(var e in d)a[e]=d[e]}};f.deleteSlide=function(a){for(var c=this.getOrderedSlides(),b=!1,d=0;d<c.length;d++)if(c[d].id==a){c[d-1]?b=c[d-1].id:c[d+1]&&(b=c[d+1].id);break}this.deletedSlideIds.push(a);
delete this.slides[a];this.selectedSlideId=b;this.selectSlide(b);this.saveSlideOrder();this.changeMade=!0};f.selectLastImage=function(){var a=this.getOrderedSlides();a.length&&this.selectSlide(a[a.length-1].id)};f.selectFirstImage=function(){var a=this.getOrderedSlides();a.length&&this.selectSlide(a[0].id)};f.nudgeImageUp=function(a){this.slides[a].ord-=1.1;this.setSlidesHTML();this.saveSlideOrder();this.changeMade=!0};f.nudgeImageDown=function(a){this.slides[a].ord+=1.1;this.setSlidesHTML();this.saveSlideOrder();
this.changeMade=!0};f.uploadImages=function(a,c){var b=this,d={mode:"file_upload"},e='<input type="file" name="Filedata" accept="image/*"';if(k._cDHTML5U())e=$(e+" multiple/>"),e.change(function(){k._dHTML5U(this.files,b.ajaxURL,d,function(d){b.uploadImagesCallback(a,c,d)})}),e.click();else{e+=' id="zenario_fallback_fileupload"/>';d._html5_backwards_compatibility_hack=1;var e='<form id="zenario_bc_form" action="'+n(b.ajaxURL)+'" onsubmit="" target="zenario_iframe" method="post" enctype="multipart/form-data">'+
e,f;for(f in d)e+='<input type="hidden" value="'+n(d[f])+'" name="'+n(f)+'"/>';e+="</form>";f='<input type="button" class="submit_selected" value="'+g.phrase.upload+'" onclick="get(\'zenario_bc_form\').submit();"/>';f+='<input type="button" class="submit" value="'+g.phrase.cancel+'"/>';g._sM(e,f);h._bII()||$("#zenario_fallback_fileupload").click()}};f.uploadImagesCallback=function(a,c,b){if(b.length){if(a)"rollover"==c?(this.slides[a].rollover_image_id=b[0].id,this.slides[a].r_filename=b[0].filename,
this.slides[a].r_alt_tag=b[0].alt_tag,this.slides[a].r_width=b[0].width,this.slides[a].r_height=b[0].height,this.slides[a].rollover_image_details_thumbnail_url=b[0].link+"&height=150&width=300"):"mobile"==c?(this.slides[a].mobile_image_id=b[0].id,this.slides[a].m_filename=b[0].filename,this.slides[a].m_alt_tag=b[0].alt_tag,this.slides[a].m_width=b[0].width,this.slides[a].m_height=b[0].height,this.slides[a].mobile_image_details_thumbnail_url=b[0].link+"&height=150&width=300"):(this.slides[a].image_id=
b[0].id,this.slides[a].filename=b[0].filename,this.slides[a].alt_tag=b[0].alt_tag,this.slides[a].width=b[0].width,this.slides[a].height=b[0].height,this.slides[a].image_details_thumbnail_url=b[0].link+"&height=150&width=300",this.slides[a].image_list_thumbnail_url=b[0].link+"&height=150&width=150");else for(var d=0;d<b.length;d++)a=this.addNewSlide({image_id:b[d].id,filename:b[d].filename,alt_tag:b[d].alt_tag,width:b[d].width,height:b[d].height,image_details_thumbnail_url:b[d].link+"&height=150&width=300",
image_list_thumbnail_url:b[d].link+"&height=150&width=150"});this.selectSlide(a,c);this.changeMade=!0}};f.pickImagesFromOrganizer=function(a,c){this.remember={slideId:a,imageType:c};g._oS("zenario_slideshow_simple","pickImagesFromOrganizerCallback",!0,"zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library","zenario__content/panels/image_library",!0)};f.pickImagesFromOrganizerCallback=function(a,c,b){var d=this,e=d.remember.slideId,f=
d.remember.imageType;d.remember=!1;h._a(d.ajaxURL+"&mode=add_slides_from_organizer&ids="+c.id).after(function(a){a=JSON.parse(a);if(a.length){if(e)"rollover"==f?(d.slides[e].rollover_image_id=a[0].image_id,d.slides[e].r_filename=a[0].filename,d.slides[e].r_alt_tag=a[0].alt_tag,d.slides[e].r_width=a[0].width,d.slides[e].r_height=a[0].height,d.slides[e].rollover_image_details_thumbnail_url=a[0].image_details_thumbnail_url):"mobile"==f?(d.slides[e].mobile_image_id=a[0].image_id,d.slides[e].m_filename=
a[0].filename,d.slides[e].m_alt_tag=a[0].alt_tag,d.slides[e].m_width=a[0].width,d.slides[e].m_height=a[0].height,d.slides[e].mobile_image_details_thumbnail_url=a[0].image_details_thumbnail_url):(d.slides[e].image_id=a[0].image_id,d.slides[e].filename=a[0].filename,d.slides[e].alt_tag=a[0].alt_tag,d.slides[e].width=a[0].width,d.slides[e].height=a[0].height,d.slides[e].image_details_thumbnail_url=a[0].image_details_thumbnail_url,d.slides[e].image_list_thumbnail_url=a[0].image_list_thumbnail_url);else for(var b=
0;b<a.length;b++)e=d.addNewSlide(a[b]);d.selectSlide(e,f);d.changeMade=!0}})};f.addNewSlide=function(a){a.id="t"+ ++this.nextNewId;var c=this.getOrderedSlides();a.ord=c.length?c[c.length-1].ord+1:1;this.slides[a.id]=a;this.changeMade=!0;return a.id};f.pickContentItemLinkFromOrganizer=function(a){var c="zenario__content/panels/content";$("#zenario_content_item_id").val()&&(c="zenario__content/panels/content//"+$("#zenario_content_item_id").val());this.remember={slideId:a};g._oS("zenario_slideshow_simple",
"organizerPickContentItemLinkCallback",!1,c,"zenario__content/panels/content","zenario__content/panels/content",!1,!0)};f.organizerPickContentItemLinkCallback=function(a,c,b){a=this.remember.slideId;this.remember=!1;this.slides[a].hyperlink_target_display=b.tag;this.slides[a].hyperlink_target=c.id;this.selectSlide(a);this.changeMade=!0};f.closeImageManager=function(){this.saveOpenDetails();this.changeMade&&!confirm("You are currently editing thus floating admin box. If you leave now you will loose any unsaved changes.")||
g._cB("AdminImageManager")};f.save=function(a){var c=this;c.saveOpenDetails();var b={slides:JSON.stringify(c.slides),deletedSlideIds:JSON.stringify(c.deletedSlideIds)};h._a(c.ajaxURL+"&mode=save_slides",b).after(function(b){b=JSON.parse(b);if(_._isEm(b))c.slotName&&h._rPS(c.slotName,"lookup"),a&&g._cB("AdminImageManager");else{c.errors=b;for(var e in b){for(var f in b[e]){c.selectSlide(e,f);break}break}}})}},zenario_slideshow_simple);
